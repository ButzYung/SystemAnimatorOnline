// 2019-07-10(v3)

var _0x51f9=['w6pmesOwZsOvw6XDuMOuwrRJwrdQwpbDvsOdw5HCqk0Nw6IQcw==','RsOgeA15','w7syw7HCs0c=','eBTDoBdiEMOTw67DusOF','DMKYNE1G','FnDChVM0GFQ=','wq3DtsKKwqvDhA==','w7nCqCUjw5Y=','D27Cum0J','BDgJwoclLcO1','w6Agw7M3SsOMwq0Jw7XDq3YfPMKww6spw53DvcK/wo0nwp5a','w4sZw54LS8OL','wo9Vw51GWsOKMUJBfA==','V1Q+PHs4dAw=','JzTDlcKe','KsO7wrk=','DGzCjA==','eC7DiRDDtQ==','wqNbw5VCcMOJBFNR','woJfHA==','wqrDvMKvwqo=','woUOw6FswrI=','IRZRZmQ=','w7QeRsKgIw==','w6sJe0kV','w4VPesKDZw==','w5YJwrfCo8Kt','HcOTwqzCt8O9','H8OmwowGMQ==','NhFzZEE=','BBtET3E=','H8O6wpLCj8O8','w6BaOsOuKg==','w7BrwoXDqzQ=','wq7DkMKPwr3DvQ==','fsKWSBjCoQ==','IxVkVV0=','I8ORLj1H','w49nwpzDszw=','wqttw5IVwqo=','w7Ahdk8f','TMK4ZxnCiU4=','ZiEU','E8KSwohWw5Ac','w4NNwprDnQ==','w6vCozINw4Rlwo4=','PMOhwr8HKH/Dvg==','w4lxeMK+woA=','w5ZtZMOwXQ==','axjDsD7DiQ==','w6JwFMO5Oxw=','Y8OJEsKPwqI=','w48DTcO8w4Q=','w5tpRybDiw==','w4xQw54fPQ==','w7NdQBTDoA==','wppyw7F/aA==','ZMK3UTpjwpx0DGsdwpJqwr4=','RMO5D8Kbwoo=','wpHCt8KDw5TDqg==','wpVgw74WwpY=','RsKkQDN/w55SPkIqwqU=','w50QQsKqHg==','w63CogXCkcOW','wpFSwpUSAsKZ','F8O/wqMjHA==','w4dQK8KxDC0U','A8OeBSJB','w6BzYizDpA==','w6ROwrvDkTE=','w4VGw5sJPw==','w4FEbcKZRA==','w63CkBDCpsOb','N8O/JyR2','DMKPHG5V','w7dTXjfDgQ==','w5k1SGs2','eMOlw47CpCc=','QMKyP0XDiQ==','w59YH8KYP8K7','w64yQcKlIw==','w4chwrjCq8Kt','wqrCqMKnw6TDpA==','BcO8w4khZA==','w6daRcOXeA==','w75mF8OKOQ==','w6lzWgvDmsOHfcOOwrPDn8KnZgbDh2p4Sj3DvSLCoMOMw6DClQ==','wrvCkcKEw67Dhg==','wolmw7dFTA==','OsK1FFk=','w7M3w54+dg==','wptjPsOQwrI=','wpLCsMOewpzDrQ==','QTUMXTE=','wr51FMOuwo4=','DxNZwog6','wqTCs8KGw43Dig==','YsK6w7bDpg8=','YsKcYyhK','wrIjwrJ1w4A=','wqbClsKVw5M=','YMKcw5TDkwE=','w5QuVHsi','eRc1XgM=','XMKtfg/Ckg==','T8OqEcKtwq0=','wqREw6UKwrA=','bcOZYztWAQ==','wrk5w4Bmwpk=','C8K5w4XCgQ==','ecKew5jDjxBW','eBXDoxd7Bg==','w4lSScKEwrbCrTs=','wqjCqngJ','w4AaZA==','wqbCsmgLQw==','OsOGw603TQ==','w7pUYcKhwpc=','JiRm','w7IJw5IUag==','w604wrPCncK+VV/Dl8Kc','F8Olwp06IQ==','TMK2fRnCgA==','w5dZRMOXYA==','fj3DjxzDrw==','wq3CpMOgwqLDmMKOwoQ=','QkI8A0M=','ecKAw47DkQE=','X8Kmw7DDhSg=','w4hlw7wlAA==','eMOpw7LChw==','HThEwqEB','w5ANc8OAw7M=','OCQuw6PClQ==','K8KvA1hx','EcKOwq9uw40=','w4YNwpvCgAMqw6jCqUk=','AA53d1LCrDrDlsOQNA==','w7EQSsO5w4vDv8OIAxzCvg==','w4FLYg==','w5kHbw==','w60jw5DChG0=','VkUsOGElUwwccw==','w751w6Mm','AcKWwp9aw5M=','wo1WPMOMwpM=','BcOewq3CvMOg','w5sAU2QOGMOTw4TCqmkEREbCkQ==','w60KR8Oiw5/DqA==','w6Z/w68lPcKQAA==','K8KNwp9T','wo9Ew5JW','wpvDusKXwpnDvA==','HcOEHQZc','w7cobFg=','w6NyWsKTcg==','YMKFw5E=','SsO3MMK+wrPCosKhA2s=','w7JRQ8KawqrCgj80f1g=','VAbDqA9yPMO3w6rDtsOZ','NTcfw57Ch8KTwqTCtVc=','KMO7w4wVbg==','ARE9wrs4','NcOTwrvCp8OD','WS7DmhjDg8OUw4/Dug==','U8Oxw7bCnRXCqjk3EV5kdg==','EcKtEENrb8OpwpzCrlMGw6w=','G8O8AD5oJMOFDlM=','wotMw5w1wq4=','ecOVw6LCviQ=','w4hjw7sBIw==','w6kCwoY=','w4Yqwr/Cgw==','Xxw/','wr7CkcKX','wqbClcKIw7TDvg==','wr98w7YUwqTDg8OufhQ=','w7ABWMO9w5HDosOvAzDCs2PDog==','w6BTwofDngBmwrbCthAAw5E=','w7JNQ8KGwpDCrS4hYw==','DsOVwqg=','NsK1Aw==','w6YmWcKrAw==','w7F7w64uKygowr8L','w60fwpfCng==','w4hcV8KKX8KyEcK/Hw==','dsOow6c=','w5LCqCUrw4piwoM=','acOzw6XChg8=','RMKRQxHCoA==','dHw4HlU=','LgRTwoAc','QcOdYztLLRDClijCvsOVwpA=','w7skw4wWWw==','wrgowqhqw7XCsMKVLB4=','w6V8w70=','w5kTYsKwHg==','w55EV8OcU8Oow6zDhMOo','wqVNB8OwwpoFNcKXVA==','CRNm','w55FwpDDnBZgwqY=','bhLDswxl','cTPDmB7Dq8KGw4bDo8Olw5omOsKrSlXCj8OCw7AFUVXClcO5','CgY8wpM0','H8OMw7Erd1jDrsKaw7A=','w5RMZCzDnA==','w5x9WsKiwoI=','HxVx','KzdaS1PCqx7DocONMcKnIMKMw77DngzDl8KZwo8owoYNw6LDhE/ChkQ=','BcO0wqQyFmzDt0zDgQ==','wppvw68=','ZsOFcA==','RsOgTgdXBhTCqxLCoMOCwp9NwobDgsKCw4IxFMObwqjDkXrDvw==','wrLCq3g0Uw==','fcK/Rjdf','wqrCoMOnwrrDhQ==','U8KiOHbDuQ==','ZRELVhM=','NMOXKwhT','w6dcRSDDqg==','X8OeA8Knwpw=','YcOlPMKg','w7JTT8KVwqDCuSo=','DcKqw5vCgg8=','wq/CknwPQg==','MDDDisKG','K8OGwrHClMOrwqR0wohT','JCR2','NcKYwrtVw5g=','w6hiZsKYdsO+w7bDmMOywrVIwrtMwozChMOnw7XDq3orwpByAQ==','KsKSwo0=','w703w4bCk2nDlQ==','LcOrGSFFIMOvH0I=','ckI0BVM=','wpjCkMO4wrPDqMKXwrrDlMOuw6zDgsOCS8Otwq7CvCU2bMKOw7DDnMKddsK+dsO5DyRVXMOXwrnCt8OEwohhwoBxVEczw4c=','TsKVVxVJ','U8OcbC52','wqoaw5VkwqUvVg==','wrp+w4gjwrc=','w7J9HcOy','ecKsLmDDng==','UsKuw4jDpwI=','f8OVw5zCmzg=','RcOLw6PCkTk=','dsO/IMK+wpjCvQ==','Oz5zwoYVVg==','HXvCg1M/B1I=','w4BORcOIfcO1w6bDjw==','MMOuDCA=','w5p1UDPDjQ==','WDgeRTQ=','VsOvaxdF','w6PCozc=','w6RydcKIRQ==','wpAOw59mwoMvQxxF','bsKcRipC','w751w7spAg==','Dz8Ew4HCqg==','w6HCji87w6w=','w7sKemoL','VgEqWiU=','wrzCl8KVw67Dug==','BxJzbQ==','Q8KVZgnCoQ==','fcKJDWLDj0XDtA==','w6Esw4HClXfDn8Kj','w4dZWg==','cjYIUxM=','w7jCsyDCj8ON','QibDkg/DmMOWw4HDvsOh','w4t2w5wpLg==','DXrCuWwc','w557w6wECw==','BcKHwolbw5E=','wr0mwrt9w78=','DiQewpol','Gy/DkMKCwoEawpAJIQ==','w73Cvi88w4pywp/DqjY=','FghkbFU=','wpNyw74Qwo7DgMObbwR8','w50eQsO9w6HDvMO9Egw=','DR4Zw4jCmw==','wq0Zw59fwo0=','GMKww7HCpAQ=','wrdDw5Qhwrg=','eMOmw7vCvhE=','w40jw4fCj2DCkMKCKcO3EsKZw7jCsw==','U8K+Vzw=','wqzCt2k=','fwjDpA0=','w6HCoyc=','fwfDrTR7','a8Ofbg==','V8K/ew==','woxUw49a','wr9iw7oHwpTDl8Oq','w7NEwobDjxZqwrDCtQ==','w7plw6sjOsKM','HBR6bEbCuw==','NsOjGj5YOsOXHw==','w7A5flgPH8O3w7PCt2w=','w5zCjQEqw6w=','IcKzFEVxX8Ov','SMK4VyB0w5NV','w6FGF8O6DA==','YcOkw6PCgRLCkQ==','wpV0w7M=','w6hiw7M5LA==','w4gfw5ALUcOMwqQrw7U=','BT0Tw4A=','wr52w5VwXw==','w5ZEwqbDtQ0=','KcOjHSZYMA==','woYhwrh0w4k=','K8KzEFVvVcO5','LcK8El9mQw==','wr3CgU8mSw==','w6w6w4bCgUg=','CTZgYUw=','JjdBdWM=','w69xw74/Dygl','w7cYw5/Cgyg1w7vCuA==','w7ZgDA==','KSwVw4bCvcODwo3CiGs6','w5wyw63ChUA=','wrlWDcOowqBVB8K3c3dQwq93','IcOEw6o6UWrDusKIw77CgcOJ','FcOOwqrChcONwrZgwppdY8OD','woE7w6Zxwqk=','cCnCiMKOw60Ww4EBexbDpg==','Wxd3d0TCt07DkcORYMK8KsOfw77DpSLCrg==','w6lIRSXDqw==','OsOzwojCg8OB','w49rcsKydMK2AMKZEsKfCMOVw5cwwpQAw4Now4xvw5HDh8OGwqQ=','wqBQK8OFwr0=','CypywpocExvChcOCwqDDsMKaCEE=','w6XCvyMQw6Q=','w6Yxw4fCv0Q=','w68UYMKqFsOMHFN2bsObMsOj','Z8KtYCnCmw==','O8O8wr8jMF7Do17Dj0vDnQ==','wrnCr3QKbw==','QFwkIV0=','ZsKwEENgWMK9wpHCiBwhw5LDsi8P','w5UATEUQ','WsOMw4TCgBc=','SsKqJFjDiV7DtnBmw6dGFXXDusOGwpQdwrfDuwvCqRTChw==','A8KOM2Vq','w7DCiRfCjMOx','KcK1wr9Rw7s=','RsOgTgdXBhTCqxLCoMOCwp9NwobDgsKCw4IxFMObwqjDkXo=','w7JhAsOoAg==','w6Agw7M3SsOMwq0Jw7XDq3YfPMKww6spw53DvcK/wo0nwp5aw7s=','w7pqRsKDSQ==','wohow51TWw==','D8OowroWIQ==','YcKgUQhV','XMK/bT3Chw==','w6/CvxYNw50=','wqEKwpdQw4w=','IBkrwp8D','KjNiwog4','w6V2w40vDQ==','wr5Vw7JfRQ==','FcOwMTpt','S8KHw6nDiws=','fCXDtjvDlA==','w4Iow4DCjmY=','SsKCPkjDug==','w4ZpQBXDvw==','MMKVw6XCpQlHw57Dv3txwq7CssOlTMOrwrYxw6ZHEcOdw4TDuw==','w70xUsKXJA==','HMKwwrZ1w4Eaw7obC8K/b8OefXzDs33CtxfDux8fw5M5VQ==','ccOpFcKDwoI=','BMKeGURq','O8O+wrPCscO5','w7nCtCUgw5A=','NMK6F15a','XsKHw6bDjSU=','DMOfJSpR','ZsK0cwLCsA==','Hxciw6/CjA==','KsORMDMSDlfChUc=','w5YKYcO+w4w=','w5Yaw5QTbg==','w5EdWMO5w5vDocOdCA3Cp3LDs8K2wpU=','wovDisKuwp7Dvw==','wog5w5Fuwqg=','wpHCrnsKfA==','EgMpwqIh','w6nCiRYaw60=','w7hFSg==','wq4fw4Zfwo8=','w4ATw4DCiTpQwpE=','HhkSw4fCqg==','w6Fcw54ZCQ==','w5hJVsKwYw==','XC7DiinDqw==','w6dmZcOzVw==','w4wGw4c2Tw==','GMOTwrvChcOYw7RzwpVXY8KRwpTCikwCecKwXwt1OMOJ','a8OSw7jCjz4=','woJrw7Ytwqo=','wp7DnMKV','wpc6wplTw5M=','wozDjsK1wr/DhA==','cMKTeRdF','w6DCjjUKw60=','w54zwrvCvMKW','w7lOd8KrYg==','w48Hw7fDikbDpMKD','wqZ0w74hwqg=','wr9Aw59aSsKZLW5tMg==','TMKTXirCnA==','fC7DiR7DvsOkw5XDrMOvw5p0','Pjsxw63Cjg==','w5Qnwq7CjsKJ','wpo9w6Z5wpM=','bMOoK8KIwrU=','NcOkHBZj','UMKmw5XDui4=','w4EtwpTCvzo=','wojDi8Kwwq/DiA==','wrhbAcOi','w7wEwrPCocKk','RcKCClvDlF7DhE5sw7RxBW/DosO4wrg/','IiA/wrAZ','JcK3w5PCrxFcw4zDr2tpwrfCs8OzSg==','woQfw7tnwo0=','aGIPIHs0RRwNawAmw5w=','ecOkSRdT','NGVYwoXChMONwr/CqE8pN8Oke3zCtcKzw6bCicKDw7EkVMKz','wrdQCMOxwr8=','woPDr8OwwrLDjsKhw57DusK/w67CrQ==','w4dge8KTwqo=','w5NYw5p3K8KaERkRDMOMESZ+TQh+w7jCpEQ=','w7NpfwHDng==','SjnDqDXDsw==','eMKEEXjDkA==','w6htAcO4PQ==','CRjDvcKhwqoLwoMJLA4=','w7zCpTbCpcOJwrIrIcOxdTbClzXDvsK4Ag==','wqLCjMKfw4nDoMKKwpHDkmY=','w4J3w6MvCyk=','Gj8Zw5rCt8KXwrzCsVo=','w4JZWcOMfcOvw6zDmsOu','woU3w55lwrU=','w7VZwpDDlww=','cjLDng3DtcOJw5I=','wolTw5A=','w7Q4T8KKB8KYP1VcTcOrE8KqwpHDpsOqwp1/L29EwqBy','wobDo8Kowr7DrSBRwo3ChA==','cwjDsw==','ScK4ez/CiVkf','LCYfw6DCsg==','ZcOHw4LCswk=','MgAMw6zCgg==','wqnCskgzZA==','w4VacyjDnQ==','NsOGw4IXZw==','fsKEMFvDmQ==','QsKhw63DtxBNwobCiF7Cnwlow4YUDMK5OmTDocKCGiFULA==','w4tXZg==','IsKUwpZY','wrY5woluw4U=','cMKxYBbCjWUHwrIWZg==','ZA7DpBFlDMO1','w5F+w6sjCQ==','L8O8wqE=','UmYbGkU=','w65PwpDDjQtrwrE=','wo9FAg==','w5sAU2QOGMOTw4TCqmkEREbCkcKowpkhw4jDrcK7wovCp8OY','FzF4woImQz/CqcO6','w6I+ZkIZ','C3vCk1EpGVVfY8O4LBM=','w5x8AMOaDQ==','w6oeasKMGQ==','w5FQXcKgUw==','THcYFmA=','KcO6wqw2PG8=','wo5Ew49CQMOXFkI=','w7YZwp7Cnz0+','UQnDuSVV','V8OIHMK0wqk='];(function(_0x58a396,_0x3e5c4a){var _0x1ee463=function(_0x25d28d){while(--_0x25d28d){_0x58a396['push'](_0x58a396['shift']());}};var _0x461d50=function(){var _0x101ccb={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0xa5011b,_0x2cdd40,_0x8babf0,_0xedfa66){_0xedfa66=_0xedfa66||{};var _0x355f6d=_0x2cdd40+'='+_0x8babf0;var _0x3bed72=0x0;for(var _0x3bed72=0x0,_0x4a2f87=_0xa5011b['length'];_0x3bed72<_0x4a2f87;_0x3bed72++){var _0x2d6a5a=_0xa5011b[_0x3bed72];_0x355f6d+=';\x20'+_0x2d6a5a;var _0x40f9c7=_0xa5011b[_0x2d6a5a];_0xa5011b['push'](_0x40f9c7);_0x4a2f87=_0xa5011b['length'];if(_0x40f9c7!==!![]){_0x355f6d+='='+_0x40f9c7;}}_0xedfa66['cookie']=_0x355f6d;},'removeCookie':function(){return'dev';},'getCookie':function(_0x3edcde,_0x3dedca){_0x3edcde=_0x3edcde||function(_0x4b6378){return _0x4b6378;};var _0x5f3f5b=_0x3edcde(new RegExp('(?:^|;\x20)'+_0x3dedca['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));var _0x428db4=function(_0xa02cc1,_0x3abed6){_0xa02cc1(++_0x3abed6);};_0x428db4(_0x1ee463,_0x3e5c4a);return _0x5f3f5b?decodeURIComponent(_0x5f3f5b[0x1]):undefined;}};var _0x5e86ec=function(){var _0x3bd381=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0x3bd381['test'](_0x101ccb['removeCookie']['toString']());};_0x101ccb['updateCookie']=_0x5e86ec;var _0x53d6d6='';var _0x2cc81a=_0x101ccb['updateCookie']();if(!_0x2cc81a){_0x101ccb['setCookie'](['*'],'counter',0x1);}else if(_0x2cc81a){_0x53d6d6=_0x101ccb['getCookie'](null,'counter');}else{_0x101ccb['removeCookie']();}};_0x461d50();}(_0x51f9,0x161));var _0x17f2=function(_0x4afd36,_0x3cec54){_0x4afd36=_0x4afd36-0x0;var _0x334f97=_0x51f9[_0x4afd36];if(_0x17f2['NiIPxM']===undefined){(function(){var _0x1863b3;try{var _0x4d0f49=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x1863b3=_0x4d0f49();}catch(_0x35b10b){_0x1863b3=window;}var _0x199ceb='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x1863b3['atob']||(_0x1863b3['atob']=function(_0x3d69d6){var _0x4cd3de=String(_0x3d69d6)['replace'](/=+$/,'');for(var _0x246762=0x0,_0x13202c,_0x1a38b5,_0x4dbd0d=0x0,_0x5cfc89='';_0x1a38b5=_0x4cd3de['charAt'](_0x4dbd0d++);~_0x1a38b5&&(_0x13202c=_0x246762%0x4?_0x13202c*0x40+_0x1a38b5:_0x1a38b5,_0x246762++%0x4)?_0x5cfc89+=String['fromCharCode'](0xff&_0x13202c>>(-0x2*_0x246762&0x6)):0x0){_0x1a38b5=_0x199ceb['indexOf'](_0x1a38b5);}return _0x5cfc89;});}());var _0x44df0b=function(_0x5ef59f,_0x3cec54){var _0x36ac09=[],_0x261180=0x0,_0x37a9e9,_0x3b03ba='',_0x5b58d4='';_0x5ef59f=atob(_0x5ef59f);for(var _0x594c91=0x0,_0x1f2d2d=_0x5ef59f['length'];_0x594c91<_0x1f2d2d;_0x594c91++){_0x5b58d4+='%'+('00'+_0x5ef59f['charCodeAt'](_0x594c91)['toString'](0x10))['slice'](-0x2);}_0x5ef59f=decodeURIComponent(_0x5b58d4);for(var _0x2075c3=0x0;_0x2075c3<0x100;_0x2075c3++){_0x36ac09[_0x2075c3]=_0x2075c3;}for(_0x2075c3=0x0;_0x2075c3<0x100;_0x2075c3++){_0x261180=(_0x261180+_0x36ac09[_0x2075c3]+_0x3cec54['charCodeAt'](_0x2075c3%_0x3cec54['length']))%0x100;_0x37a9e9=_0x36ac09[_0x2075c3];_0x36ac09[_0x2075c3]=_0x36ac09[_0x261180];_0x36ac09[_0x261180]=_0x37a9e9;}_0x2075c3=0x0;_0x261180=0x0;for(var _0x39ac2e=0x0;_0x39ac2e<_0x5ef59f['length'];_0x39ac2e++){_0x2075c3=(_0x2075c3+0x1)%0x100;_0x261180=(_0x261180+_0x36ac09[_0x2075c3])%0x100;_0x37a9e9=_0x36ac09[_0x2075c3];_0x36ac09[_0x2075c3]=_0x36ac09[_0x261180];_0x36ac09[_0x261180]=_0x37a9e9;_0x3b03ba+=String['fromCharCode'](_0x5ef59f['charCodeAt'](_0x39ac2e)^_0x36ac09[(_0x36ac09[_0x2075c3]+_0x36ac09[_0x261180])%0x100]);}return _0x3b03ba;};_0x17f2['lItjXH']=_0x44df0b;_0x17f2['BoaNMH']={};_0x17f2['NiIPxM']=!![];}var _0x344efc=_0x17f2['BoaNMH'][_0x4afd36];if(_0x344efc===undefined){if(_0x17f2['arAMid']===undefined){var _0x41a846=function(_0x9c518b){this['btEtGM']=_0x9c518b;this['jKtQUO']=[0x1,0x0,0x0];this['icHzwK']=function(){return'newState';};this['uYIDdG']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*';this['VXWyEI']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x41a846['prototype']['OVHOPX']=function(){var _0x57689e=new RegExp(this['uYIDdG']+this['VXWyEI']);var _0xf44f9f=_0x57689e['test'](this['icHzwK']['toString']())?--this['jKtQUO'][0x1]:--this['jKtQUO'][0x0];return this['ZmWbhU'](_0xf44f9f);};_0x41a846['prototype']['ZmWbhU']=function(_0x2c1cc0){if(!Boolean(~_0x2c1cc0)){return _0x2c1cc0;}return this['eepSdl'](this['btEtGM']);};_0x41a846['prototype']['eepSdl']=function(_0x134a5c){for(var _0x2544fe=0x0,_0x30ed97=this['jKtQUO']['length'];_0x2544fe<_0x30ed97;_0x2544fe++){this['jKtQUO']['push'](Math['round'](Math['random']()));_0x30ed97=this['jKtQUO']['length'];}return _0x134a5c(this['jKtQUO'][0x0]);};new _0x41a846(_0x17f2)['OVHOPX']();_0x17f2['arAMid']=!![];}_0x334f97=_0x17f2['lItjXH'](_0x334f97,_0x3cec54);_0x17f2['BoaNMH'][_0x4afd36]=_0x334f97;}else{_0x334f97=_0x344efc;}return _0x334f97;};var XMLHttpRequestZIP=function(){};(function(){var _0x2e1959=function(){var _0x46f1f8=!![];return function(_0x38b56c,_0x8d08c){var _0x4da3e9=_0x46f1f8?function(){if(_0x8d08c){var _0x3e0d9a=_0x8d08c['apply'](_0x38b56c,arguments);_0x8d08c=null;return _0x3e0d9a;}}:function(){};_0x46f1f8=![];return _0x4da3e9;};}();var _0x571dde={};_0x571dde[_0x17f2('0x0','rT2U')]=function(_0x580fc2,_0x2d4deb,_0x459905){return _0x580fc2(_0x2d4deb,_0x459905);};_0x571dde[_0x17f2('0x1','US*g')]=function(_0x586dbc,_0x189c1a){return _0x586dbc===_0x189c1a;};_0x571dde[_0x17f2('0x2','jivn')]=_0x17f2('0x3','Fg*P');_0x571dde[_0x17f2('0x4','aB$m')]=_0x17f2('0x5','#DVS');_0x571dde[_0x17f2('0x6','43Zl')]=_0x17f2('0x7','Jgt2');_0x571dde[_0x17f2('0x8','$QXW')]=_0x17f2('0x9','uKD9');_0x571dde[_0x17f2('0xa','US*g')]=_0x17f2('0xb','AI^^');_0x571dde[_0x17f2('0xc','n$&b')]=function(_0x2be7dc,_0x4722dc){return _0x2be7dc(_0x4722dc);};_0x571dde[_0x17f2('0xd','W[e)')]=function(_0x9a3fd9,_0x36eddf){return _0x9a3fd9===_0x36eddf;};_0x571dde[_0x17f2('0xe','LTLx')]=_0x17f2('0xf','LjKb');_0x571dde[_0x17f2('0x10','iY)3')]=_0x17f2('0x11','OGW7');_0x571dde[_0x17f2('0x12','8ZAz')]=_0x17f2('0x13','Be8k');_0x571dde[_0x17f2('0x14','c[t)')]=function(_0x284b7b,_0x2d0f05){return _0x284b7b===_0x2d0f05;};_0x571dde[_0x17f2('0x15','Mctn')]=_0x17f2('0x16','Vv)#');_0x571dde[_0x17f2('0x17','#DVS')]=_0x17f2('0x18','Mctn');_0x571dde['dFRHO']=_0x17f2('0x19','n$&b');_0x571dde[_0x17f2('0x1a','AI^^')]=function(_0x48802f,_0x1508c6){return _0x48802f(_0x1508c6);};_0x571dde[_0x17f2('0x1b','aB$m')]=function(_0x5ae3e3){return _0x5ae3e3();};_0x571dde[_0x17f2('0x1c','iC(M')]=_0x17f2('0x1d','BfQO');_0x571dde[_0x17f2('0x1e','OIEr')]=function(_0x5ec6f6,_0x5f4706){return _0x5ec6f6+_0x5f4706;};_0x571dde[_0x17f2('0x1f','H!)p')]=_0x17f2('0x20','OIEr');_0x571dde[_0x17f2('0x21',')jJe')]=_0x17f2('0x22','a)VW');_0x571dde[_0x17f2('0x23','BNZ7')]='EZgBX';_0x571dde['ZFJjt']='gOXpj';_0x571dde[_0x17f2('0x24','Jgt2')]='jwk';_0x571dde[_0x17f2('0x25','#DVS')]=_0x17f2('0x26','rT2U');_0x571dde[_0x17f2('0x27','a)VW')]=_0x17f2('0x28',']z]r');_0x571dde['YBtHk']=function(_0x3358c9,_0x1dba41){return _0x3358c9(_0x1dba41);};_0x571dde[_0x17f2('0x29','iC(M')]=function(_0x6edb90,_0x547dc5){return _0x6edb90!==_0x547dc5;};_0x571dde[_0x17f2('0x2a','t3)9')]=function(_0x3534da,_0x45e386){return _0x3534da!==_0x45e386;};_0x571dde['jGQNo']=_0x17f2('0x2b','rT2U');_0x571dde['kJCQU']=function(_0x5c4ca4,_0x4c6f95){return _0x5c4ca4===_0x4c6f95;};_0x571dde[_0x17f2('0x2c','W[e)')]=_0x17f2('0x2d','@IGL');_0x571dde[_0x17f2('0x2e','H!)p')]=_0x17f2('0x2f','Vv)#');_0x571dde[_0x17f2('0x30','03c6')]=function(_0x5abf84,_0x5f0e08,_0x270911,_0x3a8642,_0xb09027,_0x4bf4bc,_0x1688c5){return _0x5abf84(_0x5f0e08,_0x270911,_0x3a8642,_0xb09027,_0x4bf4bc,_0x1688c5);};_0x571dde[_0x17f2('0x31','ENX7')]=_0x17f2('0x32',')jJe');_0x571dde[_0x17f2('0x33','43Zl')]=_0x17f2('0x34',')jJe');_0x571dde[_0x17f2('0x35','Fg*P')]=_0x17f2('0x36','#DVS');_0x571dde[_0x17f2('0x37',']cak')]=function(_0x490a79,_0x55b5e5){return _0x490a79-_0x55b5e5;};_0x571dde[_0x17f2('0x38','rT2U')]=_0x17f2('0x39','LTLx');_0x571dde[_0x17f2('0x3a','ENX7')]=_0x17f2('0x3b','US*g');_0x571dde['venpf']=function(_0x1e06b6,_0x803010){return _0x1e06b6==_0x803010;};_0x571dde[_0x17f2('0x3c','aB$m')]=_0x17f2('0x3d','W[e)');_0x571dde[_0x17f2('0x3e','iC(M')]=_0x17f2('0x3f',']cak');_0x571dde[_0x17f2('0x40','a)VW')]='ixsWP';_0x571dde[_0x17f2('0x41','c[t)')]=_0x17f2('0x42','AI^^');_0x571dde[_0x17f2('0x43','n$&b')]=function(_0x2ec354,_0x1f4328){return _0x2ec354!==_0x1f4328;};_0x571dde[_0x17f2('0x44','6o(^')]='QMuRA';_0x571dde[_0x17f2('0x45',')jJe')]='local\x20file\x20-\x20ZIP\x20ERROR:';_0x571dde['PorVz']=_0x17f2('0x46','d!ib');_0x571dde['gWGsp']='BlobBuilder';_0x571dde[_0x17f2('0x47',']cak')]=_0x17f2('0x48','LjKb');_0x571dde[_0x17f2('0x49','Jgt2')]=_0x17f2('0x4a','OGW7');_0x571dde[_0x17f2('0x4b','a)VW')]=_0x17f2('0x4c','o3B*');_0x571dde[_0x17f2('0x4d','BfQO')]=_0x17f2('0x4e','iC(M');_0x571dde[_0x17f2('0x4f','d!ib')]=_0x17f2('0x50','QdWq');_0x571dde[_0x17f2('0x51','D$E#')]=_0x17f2('0x52','t3)9');_0x571dde[_0x17f2('0x53','iY)3')]=function(_0x205fd4,_0x123181){return _0x205fd4!==_0x123181;};_0x571dde[_0x17f2('0x54','W[e)')]=_0x17f2('0x55','LjKb');_0x571dde[_0x17f2('0x56','Ae9[')]=_0x17f2('0x57','!o1N');var _0x2401a9={};window[_0x17f2('0x58','vRou')](_0x571dde['nxydr'],function(_0x151f15){XMLHttpRequestZIP[_0x17f2('0x59','k$VF')][_0x17f2('0x5a','uKD9')]();});XMLHttpRequestZIP[_0x17f2('0x5b','iC(M')]['_clear']=function(){_0x2401a9={};};XMLHttpRequestZIP[_0x17f2('0x5c','@IGL')]['_decode']=function(){if(_0x571dde['ddLMn'](_0x571dde[_0x17f2('0x5d','a)VW')],_0x571dde[_0x17f2('0x5e',']z]r')])){that[_0x17f2('0x5f','W[e)')](that[_0x17f2('0x60','US*g')],_0x17f2('0x61','8ZAz'));}else{var _0x47badd=_0x2401a9[this[_0x17f2('0x62',')jJe')]];_0x47badd[_0x17f2('0x63','Zz8c')][_0x17f2('0x64','aB$m')](function(_0x56b36c){var _0x11e346={};_0x11e346['rKdvu']=function(_0x87f018,_0x306086,_0x5a22b8){return _0x571dde.mLxyI(_0x87f018,_0x306086,_0x5a22b8);};_0x11e346[_0x17f2('0x65','iC(M')]=function(_0x595484,_0xe60a70){return _0x571dde.tIaat(_0x595484,_0xe60a70);};_0x11e346[_0x17f2('0x66','03c6')]=_0x571dde.UfwTh;_0x11e346[_0x17f2('0x67','iC(M')]=_0x571dde.shdGo;_0x11e346[_0x17f2('0x68','BNZ7')]=_0x571dde.FXVJf;_0x11e346['toKev']=function(_0x118cfc,_0x1822af){return _0x118cfc!==_0x1822af;};_0x11e346[_0x17f2('0x69','iY)3')]=_0x571dde.bxszA;_0x11e346[_0x17f2('0x6a','QOiR')]=_0x571dde.BtNmj;_0x11e346[_0x17f2('0x6b','LjKb')]=_0x17f2('0x6c','n$&b');var _0x159cfe=_0x47badd[_0x17f2('0x6d','iY)3')][_0x17f2('0x6e','Be8k')](new RegExp(_0x571dde[_0x17f2('0x6f','43Zl')](toRegExp,_0x56b36c[_0x17f2('0x70','aB$m')]),'i'))[0x0];if(!_0x159cfe){if(_0x56b36c[_0x17f2('0x71','Zz8c')]){if(_0x571dde['ayMDS'](_0x571dde[_0x17f2('0xe','LTLx')],_0x571dde[_0x17f2('0x72','uKD9')])){_0x56b36c[_0x17f2('0x71','Zz8c')](_0x56b36c[_0x17f2('0x73','jivn')],_0x571dde[_0x17f2('0x74','o3B*')]);}else{_0x56b36c[_0x17f2('0x75',']z]r')](_0x56b36c[_0x17f2('0x76','d!ib')],_0x17f2('0x77','ST5Z'));}}console['error'](_0x571dde['QDQUW'],_0x56b36c[_0x17f2('0x78','$QXW')],_0x56b36c['_file_path']);return;}(function(){var _0x45d693=_0x56b36c;_0x159cfe[_0x17f2('0x79','ST5Z')](_0x45d693[_0x17f2('0x7a','eWpS')])['then'](function(_0x2e3da0){var _0x38e841={};_0x38e841[_0x17f2('0x7b','Ae9[')]=function(_0x55e894,_0x1c827f,_0x50f0f9){return _0x11e346.rKdvu(_0x55e894,_0x1c827f,_0x50f0f9);};if(_0x11e346[_0x17f2('0x7c','8ZAz')](_0x17f2('0x7d','rT2U'),_0x11e346[_0x17f2('0x7e','o3B*')])){_0x45d693[_0x17f2('0x7f','jivn')]=0xc8;_0x45d693[_0x17f2('0x80','US*g')]=_0x2e3da0;_0x45d693[_0x17f2('0x81','6o(^')]();_0x2e3da0=_0x45d693=null;}else{_0x38e841[_0x17f2('0x82','Zz8c')](setTimeout,function(){resolve(cache);},0x0);}},function(_0x2cc211){var _0x17044c={};_0x17044c[_0x17f2('0x83','c[t)')]=_0x17f2('0x84','@IGL');if(_0x11e346['FkiNj'](_0x11e346[_0x17f2('0x85','BfQO')],_0x11e346[_0x17f2('0x86','LTLx')])){_0x45d693[_0x17f2('0x87','Zz8c')]=_0x17044c[_0x17f2('0x88','Mctn')];_0x45d693['onerror']&&_0x45d693['onerror']();}else{if(_0x45d693[_0x17f2('0x89','eWpS')]){if(_0x11e346[_0x17f2('0x8a',')jJe')](_0x11e346[_0x17f2('0x8b','#DVS')],_0x11e346[_0x17f2('0x8c','eWpS')])){_0x45d693[_0x17f2('0x8d','Jgt2')](_0x45d693['url'],_0x17f2('0x8e','H!)p'));}else{_0x56b36c={};_0x56b36c[_0x17f2('0x8f','H!)p')]=response.status;_0x56b36c[_0x17f2('0x90','US*g')]=response.statusText;_0x56b36c[_0x17f2('0x91','o3B*')]=buffer;onload[_0x17f2('0x92','!o1N')](_0x56b36c);SystemAnimator_caches[_0x17f2('0x93','jivn')](response[_0x17f2('0x94','eWpS')],response);}}console[_0x17f2('0x95','W[e)')](_0x11e346['lcXKd'],_0x45d693[_0x17f2('0x96','US*g')],_0x45d693['_file_path'],_0x2cc211);}});}());});_0x47badd[_0x17f2('0x97','d!ib')]=[];}};XMLHttpRequestZIP[_0x17f2('0x5b','iC(M')][_0x17f2('0x98',')jJe')]=function(){var _0x3c4673=_0x2e1959(this,function(){var _0x3ed7eb=function(){return'\x64\x65\x76';},_0x4e1947=function(){return'\x77\x69\x6e\x64\x6f\x77';};var _0x164779=function(){var _0x986787=new RegExp('\x5c\x77\x2b\x20\x2a\x5c\x28\x5c\x29\x20\x2a\x7b\x5c\x77\x2b\x20\x2a\x5b\x27\x7c\x22\x5d\x2e\x2b\x5b\x27\x7c\x22\x5d\x3b\x3f\x20\x2a\x7d');return!_0x986787['\x74\x65\x73\x74'](_0x3ed7eb['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x46279d=function(){var _0x5caf49=new RegExp('\x28\x5c\x5c\x5b\x78\x7c\x75\x5d\x28\x5c\x77\x29\x7b\x32\x2c\x34\x7d\x29\x2b');return _0x5caf49['\x74\x65\x73\x74'](_0x4e1947['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x24da83=function(_0x57f45b){var _0x1347a6=~-0x1>>0x1+0xff%0x0;if(_0x57f45b['\x69\x6e\x64\x65\x78\x4f\x66']('\x69'===_0x1347a6)){_0x4769f2(_0x57f45b);}};var _0x4769f2=function(_0x116b5f){var _0x5a8952=~-0x4>>0x1+0xff%0x0;if(_0x116b5f['\x69\x6e\x64\x65\x78\x4f\x66']((!![]+'')[0x3])!==_0x5a8952){_0x24da83(_0x116b5f);}};if(!_0x164779()){if(!_0x46279d()){_0x24da83('\x69\x6e\x64\u0435\x78\x4f\x66');}else{_0x24da83('\x69\x6e\x64\x65\x78\x4f\x66');}}else{_0x24da83('\x69\x6e\x64\u0435\x78\x4f\x66');}});_0x3c4673();var _0x5599db={};_0x5599db[_0x17f2('0x99','a)VW')]=function(_0x1d1405,_0x5ec6a6){return _0x571dde.lqaQw(_0x1d1405,_0x5ec6a6);};_0x5599db[_0x17f2('0x9a','tFf*')]=_0x571dde.nhIQb;_0x5599db[_0x17f2('0x9b','8ZAz')]=_0x571dde.FraES;_0x5599db[_0x17f2('0x9c','ST5Z')]=function(_0x4b64fa,_0x3a98ae){return _0x571dde.venpf(_0x4b64fa,_0x3a98ae);};_0x5599db[_0x17f2('0x9d','rT2U')]='arraybuffer';_0x5599db[_0x17f2('0x9e',']cak')]=_0x571dde.cDWPt;_0x5599db[_0x17f2('0x9f','Vv)#')]=_0x571dde.TvGCV;_0x5599db[_0x17f2('0xa0','jivn')]=_0x571dde.UIPoO;_0x5599db[_0x17f2('0xa1','tFf*')]=function(_0x6a1c19,_0x2371c1){return _0x571dde.kJCQU(_0x6a1c19,_0x2371c1);};_0x5599db[_0x17f2('0xa2','tFf*')]=_0x571dde.yerFY;_0x5599db[_0x17f2('0xa3','Vv)#')]=function(_0x5d54b8,_0x58567f){return _0x571dde.JJtEJ(_0x5d54b8,_0x58567f);};_0x5599db[_0x17f2('0xa4','Ae9[')]=_0x571dde.XZfOf;_0x5599db[_0x17f2('0xa5',']z]r')]=_0x571dde.QRqaz;_0x5599db[_0x17f2('0xa6',')jJe')]=_0x571dde.QDQUW;_0x5599db[_0x17f2('0xa7','aB$m')]=_0x571dde.wWVVQ;var _0x44b07d=[_0x571dde[_0x17f2('0xa8','tFf*')],_0x571dde[_0x17f2('0xa9','AI^^')],_0x571dde[_0x17f2('0xaa',']z]r')],_0x571dde['IvSEN'],_0x571dde[_0x17f2('0xab','ENX7')]];var _0x4d2cbe=_0x44b07d[_0x17f2('0xac','ST5Z')]()[_0x17f2('0xad','aB$m')]([_0x17f2('0xae','50nX'),_0x17f2('0xaf','Be8k')]);var _0x11e4e4={};_0x11e4e4[_0x17f2('0xb0',']z]r')]='Bb';_0x4d2cbe[_0x17f2('0xb1','#DVS')](function(_0x57de6e){var _0x33bc9e=_0x11e4e4[_0x57de6e]?_0x11e4e4[_0x57de6e]:_0x57de6e;System[_0x33bc9e]=self[_0x57de6e];});_0x44b07d[_0x17f2('0xb2','jivn')](function(_0xe69a76){if(_0x571dde[_0x17f2('0xb3','D$E#')]!==_0x571dde[_0x17f2('0xb4','@IGL')]){var _0x1883f8={};_0x1883f8[_0x17f2('0xb5','W[e)')]=function(_0x1cd3b3,_0x300178){return _0x1cd3b3(_0x300178);};cache[_0x17f2('0xb6','Ae9[')](request,options||{'ignoreSearch':!![]})['then'](function(_0x46fad7){_0x1883f8[_0x17f2('0xb7','c[t)')](resolve,_0x46fad7);});}else{self[_0xe69a76]=null;}});var _0x337597=new RegExp(_0x571dde['gIKXp'],'i');var _0x31a811=new RegExp(_0x571dde[_0x17f2('0xb8','OIEr')],'i');var _0x28460e=_0x571dde[_0x17f2('0xb9','iY)3')];var _0x386fad=_0x571dde[_0x17f2('0xba','uKD9')];return function(){var _0x2d68b3={};_0x2d68b3['XFMIB']=function(_0x477faf,_0x3f07fc){return _0x571dde.HYLdf(_0x477faf,_0x3f07fc);};_0x2d68b3[_0x17f2('0xbb','iY)3')]=function(_0x1d5a08){return _0x571dde.IczxX(_0x1d5a08);};_0x2d68b3[_0x17f2('0xbc','US*g')]=_0x17f2('0xbd','Fg*P');_0x2d68b3[_0x17f2('0xbe','c[t)')]='wHfLx';_0x2d68b3[_0x17f2('0xbf','k$VF')]=_0x571dde.uZTAT;_0x2d68b3[_0x17f2('0xc0','ENX7')]=_0x17f2('0xc1','Fg*P');_0x2d68b3['aPPfc']='local\x20file\x20-\x20zip\x20path:';_0x2d68b3[_0x17f2('0xc2','8ZAz')]=function(_0x30e824,_0x502c4a){return _0x571dde.TnJsr(_0x30e824,_0x502c4a);};_0x2d68b3[_0x17f2('0xc3','vRou')]=_0x17f2('0xc4','US*g');_0x2d68b3['Azsfd']=function(_0x1d9fb1,_0x38d648){return _0x1d9fb1(_0x38d648);};_0x2d68b3[_0x17f2('0xc5','jivn')]=_0x17f2('0xc6','Ae9[');_0x2d68b3[_0x17f2('0xc7','AI^^')]=_0x571dde.nwklP;_0x2d68b3[_0x17f2('0xc8','iY)3')]=_0x571dde.RSoPM;_0x2d68b3[_0x17f2('0xc9',']z]r')]=_0x571dde.MlfmZ;_0x2d68b3[_0x17f2('0xca','uKD9')]=_0x571dde.wWVVQ;_0x2d68b3[_0x17f2('0xcb','rT2U')]=function(_0x5afd2a,_0x5ced83){return _0x5afd2a===_0x5ced83;};_0x2d68b3[_0x17f2('0xcc','vRou')]=_0x571dde.ZFJjt;_0x2d68b3[_0x17f2('0xcd','AI^^')]=_0x17f2('0xce','Mctn');_0x2d68b3['WsyIG']=_0x571dde.yUEWv;_0x2d68b3[_0x17f2('0xcf','iY)3')]=_0x571dde.dEVRH;_0x2d68b3['iCeGO']=_0x571dde.akpIS;_0x2d68b3[_0x17f2('0xd0','ST5Z')]='decrypt';_0x2d68b3[_0x17f2('0xd1','03c6')]='yTvmQ';_0x2d68b3['ZtzgU']=function(_0x1a21d0,_0x2dfa10){return _0x571dde.YBtHk(_0x1a21d0,_0x2dfa10);};var _0x33b089=this;var _0x12503b;var _0x5bc5ac,_0x34cb00,_0x103dda;function _0x29dd65(_0x5924b8,_0x12503b,_0x599556,_0x43a0b3,_0x56c6ce,_0xe4002c){var _0x375c9d={};_0x375c9d[_0x17f2('0xd2','LjKb')]=function(_0x335f45,_0x179eba){return _0x5599db.JzWzn(_0x335f45,_0x179eba);};_0x375c9d['Flcbd']=_0x17f2('0xd3','@IGL');_0x375c9d[_0x17f2('0xd4','8ZAz')]=function(_0x3ac608,_0x1964f8){return _0x3ac608(_0x1964f8);};_0x375c9d['owKtR']=_0x5599db.RlGeC;_0x375c9d[_0x17f2('0xd5',']cak')]=_0x5599db.XkEbP;_0x375c9d[_0x17f2('0xd6','k$VF')]=function(_0x3be869,_0x2aeead){return _0x5599db.hDdeo(_0x3be869,_0x2aeead);};_0x375c9d[_0x17f2('0xd7','QOiR')]=_0x5599db.RiDyg;_0x375c9d[_0x17f2('0xd8','@IGL')]=_0x5599db.dKmNL;_0x375c9d[_0x17f2('0xd9','Ae9[')]=_0x17f2('0xda','iY)3');_0x375c9d['rzTZF']=function(_0x773116,_0x3def70){return _0x773116!==_0x3def70;};if(_0x5599db[_0x17f2('0xdb','k$VF')]in self&&_0x599556){if(_0x17f2('0xdc','US*g')!==_0x5599db['EhADx']){SystemAnimator_caches['match'](_0x12503b)[_0x17f2('0xdd','Mctn')](function(_0x151cec){var _0x455194={};_0x455194[_0x17f2('0xde','H!)p')]=function(_0x56b2a4,_0x56c8d5){return _0x375c9d.RUWUt(_0x56b2a4,_0x56c8d5);};_0x455194[_0x17f2('0xdf','d!ib')]=_0x375c9d.Flcbd;_0x455194[_0x17f2('0xe0','QdWq')]=function(_0x46eb53,_0xa31442){return _0x375c9d.BGBgP(_0x46eb53,_0xa31442);};_0x455194[_0x17f2('0xe1','50nX')]=_0x375c9d.owKtR;_0x455194['ZgHcA']=function(_0x5a40bc,_0x57ca5d){return _0x5a40bc!==_0x57ca5d;};_0x455194[_0x17f2('0xe2','d!ib')]=_0x17f2('0xe3','$QXW');_0x455194[_0x17f2('0xe4','k$VF')]=_0x375c9d.ucbFL;_0x151cec[_0x375c9d[_0x17f2('0xe5','n$&b')](_0x43a0b3,_0x375c9d[_0x17f2('0xe6','Fg*P')])&&_0x375c9d[_0x17f2('0xe7','43Zl')]||_0x43a0b3]()[_0x17f2('0xe8','k$VF')](function(_0x50178b){var _0x17084e={};_0x17084e[_0x17f2('0xe9','n$&b')]=function(_0x136e2f,_0x4befb7){return _0x136e2f+_0x4befb7;};_0x17084e[_0x17f2('0xea','ST5Z')]=function(_0x42e141,_0x2799bc){return _0x455194.KZaAH(_0x42e141,_0x2799bc);};_0x17084e[_0x17f2('0xeb','50nX')]=_0x455194.aTPPw;_0x17084e['MkPxh']=function(_0x1fcc6d,_0x1f55fd){return _0x455194.MqOKP(_0x1fcc6d,_0x1f55fd);};_0x17084e[_0x17f2('0xec','aB$m')]=_0x455194.rFThf;if(_0x455194[_0x17f2('0xed','c[t)')]('MseLS',_0x455194[_0x17f2('0xee','ENX7')])){_0x5bc5ac={};_0x5bc5ac[_0x17f2('0xef','BfQO')]=_0x151cec.status;_0x5bc5ac[_0x17f2('0x90','US*g')]=_0x151cec.statusText;_0x5bc5ac['response']=_0x50178b;console['log'](_0x455194[_0x17f2('0xf0','a)VW')],_0x151cec['url']);_0x56c6ce[_0x17f2('0xf1','OGW7')](_0x5bc5ac);}else{window[_0x17f2('0xf2','n$&b')][_0x17f2('0xf3','Zz8c')][_0x17f2('0xf4','D$E#')]({'name':_0x17084e['szwuz'],'counter':new ArrayBuffer(0x10),'length':0x80},key,_0x5bc5ac['response'])[_0x17f2('0xf5','BNZ7')](function(_0x58c183){console[_0x17f2('0xf6','8ZAz')](_0x17084e[_0x17f2('0xf7','BNZ7')](_0x17084e[_0x17f2('0xf8','QOiR')](_0x28460e,_0x17084e[_0x17f2('0xf9','D$E#')](performance[_0x17f2('0xfa','$QXW')](),t_ini)),_0x17084e[_0x17f2('0xfb','H!)p')])+_0x33b089[_0x17f2('0xfc',']cak')]);_0x17084e[_0x17f2('0xfd','jivn')](ZLA,_0x58c183);})[_0x17f2('0xfe','aB$m')](function(_0xafc6a2){console[_0x17f2('0xff','@IGL')](_0xafc6a2);});}});})[_0x17f2('0x100','W[e)')](function(){_0x2d68b3['XFMIB'](fetch,SystemAnimator_caches[_0x17f2('0x101','QdWq')](_0x12503b))[_0x17f2('0xdd','Mctn')](function(_0x2b85fb){var _0x358c19={};_0x358c19['LXBWY']=_0x375c9d.xsoVv;_0x358c19['ubvtj']=function(_0x12d651,_0xd694a0){return _0x375c9d.rzTZF(_0x12d651,_0xd694a0);};_0x358c19['RiXMM']=_0x17f2('0x102','o3B*');if(!_0x2b85fb['ok']){throw _0x375c9d['BGBgP'](Error,_0x2b85fb['statusText']);}_0x2b85fb[_0x17f2('0x103','n$&b')]()[_0x43a0b3==_0x375c9d[_0x17f2('0x104','n$&b')]&&_0x375c9d[_0x17f2('0x105','uKD9')]||_0x43a0b3]()[_0x17f2('0x106','03c6')](function(_0x474db0){var _0x42c9a6={};_0x42c9a6[_0x17f2('0x107','$QXW')]=_0x358c19.LXBWY;if(_0x358c19['ubvtj'](_0x358c19[_0x17f2('0x108','OIEr')],_0x358c19[_0x17f2('0x109','iC(M')])){console[_0x17f2('0x10a','Mctn')](_0x42c9a6[_0x17f2('0x10b','Be8k')],_0x33b089[_0x17f2('0x10c','6o(^')],_0x5bc5ac[_0x17f2('0x10d','tFf*')]);}else{_0x5bc5ac={};_0x5bc5ac[_0x17f2('0x7f','jivn')]=_0x2b85fb.status;_0x5bc5ac[_0x17f2('0x10e','OIEr')]=_0x2b85fb.statusText;_0x5bc5ac['response']=_0x474db0;_0x56c6ce['call'](_0x5bc5ac);SystemAnimator_caches[_0x17f2('0x10f','iY)3')](_0x2b85fb[_0x17f2('0x110','8ZAz')],_0x2b85fb);}});})[_0x17f2('0x111','LTLx')](function(_0x402d63){_0x5bc5ac={};_0x5bc5ac[_0x17f2('0x112','o3B*')]=_0x402d63;_0xe4002c[_0x17f2('0x113','uKD9')](_0x5bc5ac);});});}else{console['error'](err);}}else{if(_0x5599db[_0x17f2('0x114','Be8k')](_0x5599db[_0x17f2('0x115','d!ib')],_0x17f2('0x116','Vv)#'))){_0x5bc5ac=new self[(_0x17f2('0x117','ST5Z'))]();_0x5bc5ac[_0x17f2('0x118','OIEr')]=_0x56c6ce;_0x5bc5ac[_0x17f2('0x119','t3)9')]=_0xe4002c;_0x5bc5ac[_0x17f2('0x11a','Be8k')](_0x5924b8,_0x12503b,_0x599556);_0x5bc5ac['responseType']=_0x43a0b3;_0x5bc5ac[_0x17f2('0x11b','US*g')]();}else{_0x2d68b3[_0x17f2('0x11c',')jJe')](reject);return;}}}_0x12503b=_0x571dde[_0x17f2('0x11d','AI^^')](toLocalPath,this['url']);if(_0x337597[_0x17f2('0x11e','ST5Z')](_0x12503b)){if(_0x571dde[_0x17f2('0x11f','rT2U')]('WIGzL','WIGzL')){_0x2401a9[_0x33b089[_0x17f2('0x78','$QXW')]][_0x17f2('0x120','n$&b')]=zip;_0x33b089['_decode']();}else{this[_0x17f2('0x121','c[t)')]=RegExp['$1'];this[_0x17f2('0x122','D$E#')]=RegExp['$2'];this[_0x17f2('0x123','Zz8c')]=this['_file_path']['replace'](/[\/\\]/g,'/');var _0x2e1ba6=_0x2401a9[this[_0x17f2('0x124','iC(M')]];if(!_0x2e1ba6){if(_0x571dde[_0x17f2('0x125','QOiR')](_0x571dde[_0x17f2('0x126','Jgt2')],_0x17f2('0x127','Vv)#'))){var _0x3055ff=top[_0x17f2('0x128','W[e)')];if(_0x3055ff&&_0x3055ff[_0x17f2('0x129','03c6')]){var _0x52e7b0=_0x3055ff[_0x17f2('0x12a','Mctn')][this[_0x17f2('0x12b','AI^^')]];if(_0x52e7b0){if(_0x571dde[_0x17f2('0x12c','ENX7')](_0x17f2('0x12d','03c6'),_0x571dde[_0x17f2('0x12e','t3)9')])){cache[_0x17f2('0x12f','6o(^')](request,response)[_0x17f2('0x130',']cak')](function(){console[_0x17f2('0x131','50nX')](_0x2d68b3['fSMMG'],response[_0x17f2('0x60','US*g')]);});}else{console[_0x17f2('0x132','k$VF')](_0x571dde[_0x17f2('0x133','k$VF')],this[_0x17f2('0x134','ENX7')]);this[_0x17f2('0x135','OIEr')]=_0x17f2('0x136',']z]r');_0x2401a9[this[_0x17f2('0x137','D$E#')]]={};_0x2401a9[this[_0x17f2('0x137','D$E#')]][_0x17f2('0x138','Vv)#')]=null;_0x2401a9[this[_0x17f2('0x137','D$E#')]][_0x17f2('0x139','Mctn')]=[this];new self[(_0x17f2('0x13a','8ZAz'))]()[_0x17f2('0x13b','uKD9')](_0x52e7b0)[_0x17f2('0x13c','6o(^')](function(_0x1a900c){if('goLzP'!==_0x2d68b3['QtVUf']){_0x2401a9[_0x33b089[_0x17f2('0x13d','rT2U')]][_0x17f2('0x13e','03c6')]=_0x1a900c;_0x33b089[_0x17f2('0x13f','#DVS')]();}else{console[_0x17f2('0x140','03c6')](err);}},function(_0x1c512f){if(_0x5599db[_0x17f2('0x141','aB$m')](_0x17f2('0x142','o3B*'),_0x5599db[_0x17f2('0x143','$QXW')])){var _0x4fa0a4=_0x3055ff[_0x17f2('0x144','BfQO')][this[_0x17f2('0x124','iC(M')]];if(_0x4fa0a4){var _0x208517=_0x2d68b3[_0x17f2('0x145','H!)p')]['split']('|'),_0x1b2947=0x0;while(!![]){switch(_0x208517[_0x1b2947++]){case'0':return;case'1':_0x2401a9[this[_0x17f2('0x146','43Zl')]]={};_0x2401a9[this[_0x17f2('0x146','43Zl')]]['zip']=null;_0x2401a9[this[_0x17f2('0x146','43Zl')]][_0x17f2('0x147','uKD9')]=[this];continue;case'2':this['responseType']=_0x2d68b3[_0x17f2('0x148','8ZAz')];continue;case'3':new self['JSZip']()[_0x17f2('0x149','@IGL')](_0x4fa0a4)['then'](function(_0x4b3cb6){_0x2401a9[_0x33b089[_0x17f2('0x14a','d!ib')]][_0x17f2('0x14b','tFf*')]=_0x4b3cb6;_0x33b089[_0x17f2('0x14c',']z]r')]();},function(_0x341fe0){console[_0x17f2('0x14d','Zz8c')](_0x17f2('0x14e','W[e)'),_0x33b089[_0x17f2('0x134','ENX7')],_0x341fe0);});continue;case'4':console[_0x17f2('0x131','50nX')](_0x2d68b3[_0x17f2('0x14f','Jgt2')],this[_0x17f2('0x150','QOiR')]);continue;}break;}}}else{console[_0x17f2('0x151','iY)3')](_0x5599db[_0x17f2('0x152','D$E#')],_0x33b089[_0x17f2('0x124','iC(M')],_0x1c512f);}});return;}}}console[_0x17f2('0x153','tFf*')](_0x17f2('0x154','tFf*'),this['_zip_path']);_0x2401a9[this[_0x17f2('0x155','jivn')]]={};_0x2401a9[this[_0x17f2('0x155','jivn')]][_0x17f2('0x156','ENX7')]=null;_0x2401a9[this[_0x17f2('0x155','jivn')]][_0x17f2('0x157','BfQO')]=[this];_0x34cb00=function(){var _0x44d7a4={};_0x44d7a4['sPahd']=_0x17f2('0x158','BfQO');_0x44d7a4[_0x17f2('0x159','BNZ7')]=_0x2d68b3.GXllv;_0x44d7a4[_0x17f2('0x15a','Fg*P')]=function(_0x128445,_0x5c8e67){return _0x2d68b3.Azsfd(_0x128445,_0x5c8e67);};_0x44d7a4['xGeFq']=_0x2d68b3.QMtoJ;_0x44d7a4[_0x17f2('0x15b','QdWq')]=_0x2d68b3.eoNnH;_0x44d7a4[_0x17f2('0x15c','LjKb')]=_0x2d68b3.XRTCU;if(_0x2d68b3[_0x17f2('0x15d','50nX')]('gOXpj',_0x2d68b3[_0x17f2('0x15e','AI^^')])){if(0x1||_0x2d68b3[_0x17f2('0x15f','iY)3')](_0x5bc5ac['status'],0xc8)){function _0x1e96cd(_0x23eeae){_0x5bc5ac=null;new self[(_0x17f2('0x160','c[t)'))]()['loadAsync'](_0x23eeae)[_0x17f2('0x161','c[t)')](function(_0x1372cd){_0x2401a9[_0x33b089['_zip_path']]['zip']=_0x1372cd;_0x33b089[_0x17f2('0x162','D$E#')]();},function(_0x3b1b6c){console[_0x17f2('0x163','OGW7')](_0x44d7a4[_0x17f2('0x164','BNZ7')],_0x33b089['_zip_path'],_0x3b1b6c);});}if(_0x31a811[_0x17f2('0x165','!o1N')](_0x33b089[_0x17f2('0x166','Vv)#')])){if(_0x2d68b3['syNjA']!=='SpAQf'){console[_0x17f2('0x167','$QXW')](_0x2d68b3[_0x17f2('0x168','Be8k')](_0x17f2('0x169','@IGL'),_0x33b089['_zip_path']));var _0x41f4a7=performance[_0x17f2('0x16a','Be8k')]();window['crypto'][_0x17f2('0x16b','LTLx')][_0x17f2('0x16c','AI^^')](_0x2d68b3[_0x17f2('0x16d','o3B*')],{'kty':_0x2d68b3['FmHto'],'k':_0x17f2('0x16e','QdWq'),'alg':_0x2d68b3[_0x17f2('0x16f','Fg*P')],'ext':!![]},{'name':_0x2d68b3[_0x17f2('0x170','BfQO')]},!![],[_0x17f2('0x171','a)VW'),_0x2d68b3[_0x17f2('0x172','ENX7')]])[_0x17f2('0x173','Ae9[')](function(_0x41358c){var _0x574a35={};_0x574a35[_0x17f2('0x174','LjKb')]=function(_0x1d5b47,_0x16af38){return _0x2d68b3.qeAhm(_0x1d5b47,_0x16af38);};_0x574a35[_0x17f2('0x175','n$&b')]=function(_0x30f5ce,_0x381872){return _0x2d68b3.qeAhm(_0x30f5ce,_0x381872);};_0x574a35[_0x17f2('0x176','03c6')]=_0x2d68b3.pcWqi;_0x574a35[_0x17f2('0x177','03c6')]=function(_0x5d1b87,_0x138327){return _0x2d68b3.Azsfd(_0x5d1b87,_0x138327);};window[_0x17f2('0x178','c[t)')][_0x17f2('0x179','$QXW')][_0x17f2('0x17a','eWpS')]({'name':_0x2d68b3['MqnaU'],'counter':new ArrayBuffer(0x10),'length':0x80},_0x41358c,_0x5bc5ac[_0x17f2('0x17b','@IGL')])[_0x17f2('0x17c','AI^^')](function(_0x175849){console[_0x17f2('0x153','tFf*')](_0x574a35[_0x17f2('0x17d','iY)3')](_0x574a35[_0x17f2('0x17e','50nX')](_0x574a35[_0x17f2('0x17f','BfQO')](_0x28460e,performance[_0x17f2('0x180','#DVS')]()-_0x41f4a7),_0x574a35[_0x17f2('0x181','rT2U')]),_0x33b089[_0x17f2('0x182','a)VW')]));_0x574a35[_0x17f2('0x183','Fg*P')](_0x1e96cd,_0x175849);})[_0x17f2('0x184','uKD9')](function(_0x4dc7ef){console[_0x17f2('0x185','iC(M')](_0x4dc7ef);});})['catch'](function(_0x4464f3){var _0x1dc78b={};_0x1dc78b[_0x17f2('0x186','#DVS')]=function(_0x72d51b,_0x28204e){return _0x44d7a4.ZiteY(_0x72d51b,_0x28204e);};if(_0x44d7a4[_0x17f2('0x187','ST5Z')]!==_0x44d7a4['uavmx']){console[_0x17f2('0x188','50nX')](_0x4464f3);}else{caches['open'](_0x44d7a4[_0x17f2('0x189','k$VF')])[_0x17f2('0x18a','tFf*')](_0x5b3689=>{cache=_0x5b3689;_0x1dc78b[_0x17f2('0x18b','aB$m')](resolve,cache);});}});}else{if(_0x33b089[_0x17f2('0x18c','LjKb')]){_0x33b089[_0x17f2('0x18d','LTLx')](_0x33b089[_0x17f2('0x18e','@IGL')],_0x44d7a4[_0x17f2('0x18f','50nX')]);}console[_0x17f2('0x190','vRou')](_0x44d7a4['sPahd'],_0x33b089[_0x17f2('0x191','W[e)')],_0x33b089['_file_path'],e);}}else{if(_0x2d68b3[_0x17f2('0x192','uKD9')](_0x2d68b3[_0x17f2('0x193','eWpS')],_0x17f2('0x194','uKD9'))){_0x2d68b3[_0x17f2('0x195','Be8k')](resolve,response);return;}else{_0x2d68b3[_0x17f2('0x196','43Zl')](_0x1e96cd,_0x5bc5ac[_0x17f2('0x80','US*g')]);}}}else{console[_0x17f2('0x197','Jgt2')](_0x386fad,_0x33b089[_0x17f2('0x198','!o1N')],_0x5bc5ac['statusText']);}}else{XMLHttpRequestZIP[_0x17f2('0x199','#DVS')]['_clear']();}};_0x103dda=function(){console[_0x17f2('0x19a','tFf*')](_0x5599db['wINsO'],_0x33b089[_0x17f2('0x198','!o1N')],_0x5bc5ac[_0x17f2('0x19b','ENX7')]);};_0x12503b=toFileProtocol(this[_0x17f2('0x19c','OIEr')]);_0x571dde[_0x17f2('0x19d','iC(M')](_0x29dd65,_0x571dde[_0x17f2('0x19e','a)VW')],_0x12503b,!![],_0x17f2('0xc1','Fg*P'),_0x34cb00,_0x103dda);}else{var _0xa8e28a=_0x11e4e4[p]?_0x11e4e4[p]:p;System[_0xa8e28a]=self[p];}}else{if(_0x571dde[_0x17f2('0x19f','OGW7')]===_0x571dde[_0x17f2('0x1a0','ENX7')]){var _0x1d89bc={};_0x1d89bc[_0x17f2('0x1a1','03c6')]=_0x17f2('0x1a2','LTLx');SystemAnimator_caches['open']()[_0x17f2('0x1a3','Fg*P')](function(_0xdf5b49){_0xdf5b49[_0x17f2('0x1a4','BNZ7')](request,response)[_0x17f2('0x1a5','Zz8c')](function(){console[_0x17f2('0x1a6','#DVS')](_0x1d89bc[_0x17f2('0x1a7','Zz8c')],response[_0x17f2('0x1a8','BfQO')]);});});}else{_0x2e1ba6[_0x17f2('0x1a9','aB$m')][_0x17f2('0x1aa','US*g')](this);if(_0x2e1ba6['zip'])this[_0x17f2('0x1ab','ENX7')]();}}}}else{_0x34cb00=function(){_0x33b089[_0x17f2('0x1ac',']z]r')]=this['response'];_0x33b089[_0x17f2('0x1ad','t3)9')]=0xc8;_0x33b089[_0x17f2('0x1ae','tFf*')]();_0x33b089[_0x17f2('0x1af','AI^^')]=_0x33b089=_0x5bc5ac=null;};_0x103dda=function(){_0x33b089[_0x17f2('0x1b0','ST5Z')]=_0x5599db[_0x17f2('0x1b1','#DVS')];_0x33b089[_0x17f2('0x1b2','Mctn')]&&_0x33b089[_0x17f2('0x1b3','Fg*P')]();};_0x571dde[_0x17f2('0x1b4','Ae9[')](_0x29dd65,this[_0x17f2('0x1b5','03c6')],this[_0x17f2('0x1b6','ENX7')],this[_0x17f2('0x1b7','t3)9')],this['responseType'],_0x34cb00,_0x103dda);}};}();XMLHttpRequestZIP[_0x17f2('0x1b8','H!)p')][_0x17f2('0x1b9','iC(M')]=function(_0x1d28ee,_0x239532,_0x269643){if(_0x571dde[_0x17f2('0x1ba','US*g')](_0x571dde[_0x17f2('0x1bb',']z]r')],'geXKH')){this[_0x17f2('0x1bc','AI^^')]=_0x1d28ee;this['url']=_0x239532;this[_0x17f2('0x1bd','43Zl')]=!!_0x269643;}else{ZLA(xhr['response']);}};}());var SystemAnimator_caches={};SystemAnimator_caches[_0x17f2('0x1be','Mctn')]=_0x17f2('0x1bf','Mctn')in self&&browser_native_mode;SystemAnimator_caches['open']=function(){var _0x313bd8={oBlQG:_0x17f2('0x1c0','BNZ7'),OtSfZ:function(_0xa06920,_0x3b0e33){return _0xa06920(_0x3b0e33);},reLcv:_0x17f2('0x1c1','LTLx'),ixmrY:_0x17f2('0x1c2','tFf*'),rqXhl:'vcQvH',csCTT:function(_0x8ece20,_0x50990d,_0x4bac4e){return _0x8ece20(_0x50990d,_0x4bac4e);}};var _0x3c4a81;return function(){var _0x18dbf3={LivJP:function(_0x316351,_0x1e0acf){return _0x316351!==_0x1e0acf;},RCbDv:_0x313bd8.oBlQG,WaBbl:function(_0x275252,_0x1e01d5){return _0x313bd8.OtSfZ(_0x275252,_0x1e01d5);},shxfa:function(_0x2263b0,_0xeb2051){return _0x313bd8.OtSfZ(_0x2263b0,_0xeb2051);},RlPxn:_0x313bd8.reLcv,IsCGF:_0x313bd8.ixmrY,DGOsC:_0x313bd8.rqXhl,koQkI:function(_0x2d9e5b,_0x5471c1,_0x2d4a56){return _0x313bd8.csCTT(_0x2d9e5b,_0x5471c1,_0x2d4a56);},FdFdG:'SystemAnimator'};return new Promise(function(_0x3c9f5a){var _0x55a907={BxEFK:function(_0x3b7aab,_0x33fd7b){return _0x18dbf3.shxfa(_0x3b7aab,_0x33fd7b);},pIHMZ:_0x18dbf3.RlPxn};if(_0x18dbf3.IsCGF===_0x18dbf3.DGOsC){self[p]=null;}else{if(!SystemAnimator_caches.enabled)return;if(_0x3c4a81){_0x18dbf3.koQkI(setTimeout,function(){if(_0x18dbf3.LivJP(_0x18dbf3.RCbDv,_0x18dbf3.RCbDv)){xhr={statusText:err};onerror.call(xhr);}else{_0x18dbf3.WaBbl(_0x3c9f5a,_0x3c4a81);}},0x0);}else{caches.open(_0x18dbf3.FdFdG).then(_0x1c9cbe=>{var _0x2a0807={bGdmI:function(_0x32b22f,_0x6d9922){return _0x55a907.BxEFK(_0x32b22f,_0x6d9922);}};if(_0x17f2('0x1c3','tFf*')===_0x55a907.pIHMZ){_0x2a0807.bGdmI(_0x3c9f5a,response);}else{_0x3c4a81=_0x1c9cbe;_0x3c9f5a(_0x3c4a81);}});}}});};}();SystemAnimator_caches[_0x17f2('0x1c4','uKD9')]=function(_0x15d21c,_0x632b9d){var _0x24dace={cTpJM:function(_0x25b323,_0xbf35de){return _0x25b323==_0xbf35de;},toNTb:'string'};return this.enabled&&_0x24dace.cTpJM(typeof _0x15d21c,_0x24dace.toNTb)?new Request(_0x15d21c,_0x632b9d||(localhost_mode?{cache:_0x17f2('0x1c5','6o(^')}:{})):_0x15d21c;};SystemAnimator_caches[_0x17f2('0x1c6','Ae9[')]=function(_0x437115,_0x1a7871){var _0x1a2f64={WAquU:_0x17f2('0x1c7','iC(M'),yMqhU:_0x17f2('0x1c8','LTLx'),BRxti:_0x17f2('0x1c9','d!ib'),UNhmU:function(_0xeb4c60,_0x872d9f){return _0xeb4c60==_0x872d9f;},HcODs:_0x17f2('0x1ca','QOiR')};SystemAnimator_caches.open().then(function(_0x7f60df){var _0x5ad63f={HQTzE:function(_0x4a6615,_0x4452fb){return _0x1a2f64.UNhmU(_0x4a6615,_0x4452fb);},splFP:_0x17f2('0x1cb','Vv)#'),QFdqG:_0x1a2f64.HcODs};_0x7f60df.put(_0x437115,_0x1a7871).then(function(){var _0x35b3c1={pseWb:_0x1a2f64.WAquU};if(_0x1a2f64.yMqhU===_0x1a2f64.yMqhU){console.log(_0x1a2f64.BRxti,_0x1a7871.url);}else{_0x1a7871[_0x5ad63f.HQTzE(responseType,_0x5ad63f.splFP)&&_0x5ad63f.QFdqG||responseType]().then(function(_0x220997){xhr={status:_0x1a7871.status,statusText:_0x1a7871.statusText,response:_0x220997};console.log(_0x35b3c1.pseWb,_0x1a7871.url);onload.call(xhr);});}});});};SystemAnimator_caches['match']=function(_0x2d4cc4,_0x6448cc){var _0x55d9ab={KjuTN:function(_0x2f5136,_0x11b0c6){return _0x2f5136+_0x11b0c6;},DlZGg:function(_0x9b33a5,_0x2c10d2){return _0x9b33a5-_0x2c10d2;},AUgfE:function(_0x524c10,_0x522e31){return _0x524c10!==_0x522e31;},ivhZG:_0x17f2('0x1cc','a)VW'),vEwFo:_0x17f2('0x1cd','!o1N'),bSCas:'arraybuffer',NCMRC:function(_0x1a25ea,_0x5c94f7){return _0x1a25ea===_0x5c94f7;},OOQEj:'ETag',IiLRF:'Content-Length',aWouZ:'(match\x20by\x20Content-Length)',sBcKM:function(_0x42a22a){return _0x42a22a();},RbCTy:function(_0xfc48c1){return _0xfc48c1();},yAIlm:'HEAD',PkUnq:function(_0x39830e,_0x3eba2d){return _0x39830e!==_0x3eba2d;}};_0x2d4cc4=SystemAnimator_caches.request(_0x2d4cc4);return new Promise(function(_0x4948f8,_0x290528){var _0xc5f237={dNpwh:_0x55d9ab.vEwFo,UqmRT:_0x55d9ab.bSCas,gWRUY:function(_0x55e84f,_0x4ff6bf){return _0x55d9ab.NCMRC(_0x55e84f,_0x4ff6bf);},fABOt:_0x55d9ab.OOQEj,QAwhN:_0x55d9ab.IiLRF,SECox:_0x17f2('0x1ce','tFf*'),WlCdK:_0x55d9ab.aWouZ,kfdzy:function(_0x3205b9,_0x563fc6){return _0x55d9ab.AUgfE(_0x3205b9,_0x563fc6);},bEwrK:function(_0x2adb99){return _0x55d9ab.sBcKM(_0x2adb99);},MSJjP:function(_0x453735){return _0x55d9ab.RbCTy(_0x453735);},muDBL:function(_0xfcaa25,_0x4b1455){return _0xfcaa25(_0x4b1455);},pAqBo:_0x55d9ab.yAIlm,liLCk:function(_0x40bff3,_0x3a814e){return _0x55d9ab.PkUnq(_0x40bff3,_0x3a814e);},kopHX:_0x17f2('0x1cf','iY)3')};if(!SystemAnimator_caches.enabled){setTimeout(function(){var _0x3b2edb={jVZAv:function(_0x4ddd15,_0x5d4b07){return _0x55d9ab.KjuTN(_0x4ddd15,_0x5d4b07);},WFzBQ:function(_0x1a870e,_0x31eeb8){return _0x1a870e+_0x31eeb8;},CrRBR:function(_0x32a014,_0x58a0f9){return _0x55d9ab.DlZGg(_0x32a014,_0x58a0f9);},nRudH:function(_0x573c7d,_0x57e9fc){return _0x573c7d(_0x57e9fc);}};if(_0x55d9ab.AUgfE(_0x55d9ab.ivhZG,_0x17f2('0x1d0','Vv)#'))){console.log(_0x3b2edb.jVZAv(_0x3b2edb.jVZAv(_0x3b2edb.WFzBQ(msg0,_0x3b2edb.CrRBR(performance.now(),t_ini)),'ms)\x20-\x20'),that._zip_path));_0x3b2edb.nRudH(ZLA,decrypted);}else{_0x290528();}},0x0);return;}SystemAnimator_caches.open().then(function(_0x1a879a){var _0x11dec6={mCfGX:function(_0x127b50,_0x3c0fd0){return _0x127b50(_0x3c0fd0);},iwcnP:_0xc5f237.UqmRT,GtzIC:_0x17f2('0x1d1','rT2U'),vkBNS:function(_0xcb7f6d,_0x137c8b){return _0xc5f237.gWRUY(_0xcb7f6d,_0x137c8b);},aPaJU:'gXMXK',yVSUN:'sFKsJ',LXDRC:_0xc5f237.fABOt,fWdDd:_0xc5f237.QAwhN,cbDZh:function(_0x3270af,_0x2154a0){return _0x3270af==_0x2154a0;},kRlXo:function(_0x529014,_0x18a621){return _0x529014&&_0x18a621;},mvdxD:_0xc5f237.SECox,FKhup:_0xc5f237.WlCdK,sdjGc:function(_0x2018d3,_0x3f1932){return _0xc5f237.kfdzy(_0x2018d3,_0x3f1932);},zDFEH:function(_0x4f9a19){return _0xc5f237.bEwrK(_0x4f9a19);},liLlz:_0x17f2('0x1d2','d!ib'),zUUUA:function(_0x221f3d){return _0xc5f237.MSJjP(_0x221f3d);},CNAjO:function(_0x1bf026,_0x154baa){return _0xc5f237.muDBL(_0x1bf026,_0x154baa);},pdWje:function(_0x3e9d1c,_0x31a9b7,_0x362ce5){return _0x3e9d1c(_0x31a9b7,_0x362ce5);},ZBCnM:_0xc5f237.pAqBo};if(_0xc5f237.liLCk('XvSfE',_0xc5f237.kopHX)){var _0x5e2044=_0xc5f237.dNpwh.split('|'),_0x303258=0x0;while(!![]){switch(_0x5e2044[_0x303258++]){case'0':xhr.open(method,url,is_async);continue;case'1':xhr.onload=onload;continue;case'2':xhr.responseType=responseType;continue;case'3':xhr.onerror=onerror;continue;case'4':xhr=new self.XMLHttpRequest();continue;case'5':xhr.send();continue;}break;}}else{_0x1a879a.match(_0x2d4cc4,_0x6448cc||{ignoreSearch:!![]}).then(function(_0x2e4636){var _0x4500b5={ZpZNc:_0x11dec6.GtzIC,YWaFR:function(_0x46e8dd,_0x2295a8){return _0x11dec6.vkBNS(_0x46e8dd,_0x2295a8);},XYwEl:_0x11dec6.aPaJU,ddouw:_0x11dec6.yVSUN,ekeSR:_0x11dec6.LXDRC,TKDoX:_0x11dec6.fWdDd,SuXUM:function(_0x2d4b7d,_0x30da3b){return _0x2d4b7d||_0x30da3b;},UKQEv:function(_0x23a85e,_0x3d43cd){return _0x23a85e==_0x3d43cd;},oraiv:function(_0x24e46b,_0x2a1734){return _0x11dec6.cbDZh(_0x24e46b,_0x2a1734);},qfaXO:function(_0x296e9c,_0x568c0b){return _0x11dec6.kRlXo(_0x296e9c,_0x568c0b);},oKDSQ:_0x11dec6.mvdxD,RxmqF:_0x11dec6.FKhup,fJKDS:function(_0x5eb8b0,_0x2c79bd){return _0x5eb8b0(_0x2c79bd);},EBJmx:function(_0x1a7ce7,_0x4a887b){return _0x11dec6.sdjGc(_0x1a7ce7,_0x4a887b);},Mmnan:_0x17f2('0x1d3','$QXW'),QFhKV:function(_0x57e49e){return _0x11dec6.zDFEH(_0x57e49e);}};if(_0x11dec6.sdjGc(_0x17f2('0x1d4','#DVS'),_0x17f2('0x1d5','LTLx'))){console.log(_0x17f2('0x1d6','8ZAz'),_0x2e4636.url);}else{if(!_0x2e4636){if(_0x11dec6.liLlz!==_0x17f2('0x1d7','aB$m')){_0x11dec6.zUUUA(_0x290528);return;}else{if(!_0x2e4636.ok){throw _0x11dec6.mCfGX(Error,_0x2e4636.statusText);}_0x2e4636.clone()[responseType==_0x11dec6.iwcnP&&_0x17f2('0x1d8','jivn')||responseType]().then(function(_0x2b6096){xhr={status:_0x2e4636.status,statusText:_0x2e4636.statusText,response:_0x2b6096};onload.call(xhr);SystemAnimator_caches.put(_0x2e4636.url,_0x2e4636);});}}if(/\/user\-defined\-local\//.test(_0x2d4cc4.url)){if(_0x11dec6.sdjGc(_0x17f2('0x1d9','BNZ7'),_0x17f2('0x1da','o3B*'))){zip_by_url={};}else{_0x11dec6.CNAjO(_0x4948f8,_0x2e4636);return;}}var _0x61333a=_0x2e4636.headers.get(_0x11dec6.LXDRC);var _0x4bdac9=_0x2e4636.headers.get(_0x11dec6.fWdDd);_0x11dec6.pdWje(fetch,SystemAnimator_caches.request(_0x2e4636.url),{method:_0x11dec6.ZBCnM}).then(function(_0x40ab61){var _0x4c9fb0={rAssE:function(_0x2160d1,_0x2ef5ba){return _0x2160d1(_0x2ef5ba);}};if(_0x4500b5.YWaFR(_0x4500b5.XYwEl,_0x4500b5.ddouw)){_0x4c9fb0.rAssE(_0x4948f8,_0x1a879a);}else{var _0x4bdaa3=_0x40ab61.headers.get(_0x4500b5.ekeSR);var _0x332d39=_0x40ab61.headers.get(_0x4500b5.TKDoX);var _0x2a1826=!_0x61333a||!_0x4bdaa3||/sao\.animetheme\.com/i.test(window.location.host);var _0x48cfc9=_0x4500b5.SuXUM(!_0x4bdac9,!_0x332d39);if(!_0x2a1826&&_0x4500b5.UKQEv(_0x4bdaa3,_0x61333a)||!_0x48cfc9&&_0x4500b5.oraiv(_0x332d39,_0x4bdac9)||_0x4500b5.qfaXO(_0x2a1826,_0x48cfc9)){if(_0x4500b5.qfaXO(_0x2a1826,_0x48cfc9))console.log(_0x4500b5.oKDSQ);else if(!_0x2a1826)console.log(_0x17f2('0x1db','Mctn'));else console.log(_0x4500b5.RxmqF);_0x4500b5.fJKDS(_0x4948f8,_0x2e4636);}else{if(_0x4500b5.EBJmx(_0x17f2('0x1dc','ST5Z'),_0x17f2('0x1dd','03c6'))){var _0x3fd0b8={zrSrk:_0x4500b5.ZpZNc};var _0x58873f=xhr;zip.async(_0x58873f.responseType).then(function(_0x30bbad){_0x58873f.status=0xc8;_0x58873f.response=_0x30bbad;_0x58873f.onload();_0x30bbad=_0x58873f=null;},function(_0x58fd91){if(_0x58873f.onerror){_0x58873f.onerror(_0x58873f.url,_0x17f2('0x1de','LjKb'));}console.error(_0x3fd0b8.zrSrk,_0x58873f._zip_path,_0x58873f._file_path,_0x58fd91);});}else{console.log(_0x4500b5.Mmnan,_0x2e4636.url,_0x61333a,_0x4bdaa3,_0x4bdac9,_0x332d39);_0x4500b5.QFhKV(_0x290528);}}}});}});}});});};SystemAnimator_caches['delete']=function(_0x5b5a15,_0x42855a){var _0x1fb797={JAyNi:_0x17f2('0x1df','Mctn'),YjruQ:_0x17f2('0x1e0','vRou'),pZwTJ:function(_0x22d3fd,_0x243fec){return _0x22d3fd||_0x243fec;}};return new Promise(function(_0x20d34a){var _0x2f7567={fOxRU:_0x1fb797.JAyNi,RtZkQ:_0x1fb797.YjruQ,wwXWb:function(_0x4c2bf8,_0x7c2d5b){return _0x1fb797.pZwTJ(_0x4c2bf8,_0x7c2d5b);}};if(!SystemAnimator_caches.enabled)return;SystemAnimator_caches.open().then(function(_0x10a6f2){var _0x135993={fKgyu:_0x2f7567.fOxRU};if(_0x17f2('0x1e1','Be8k')!==_0x2f7567.RtZkQ){this.method=method;this.url=url;this.async=!!is_async;}else{_0x10a6f2.delete(_0x5b5a15,_0x2f7567.wwXWb(_0x42855a,{ignoreSearch:!![]})).then(function(_0x174e6a){var _0x45f485={rjmPG:_0x17f2('0x1e2','BfQO')};if(_0x135993.fKgyu!==_0x17f2('0x1e3','Ae9[')){_0x20d34a(_0x174e6a);}else{if(xhr.onerror){xhr.onerror(xhr.url,_0x45f485.rjmPG);}console.error(_0x17f2('0x1e4','H!)p'),xhr._zip_path,xhr._file_path);return;}});}});});};
(function(d){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=d();else if("function"==typeof define&&define.amd)define([],d);else{var _;_="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?this:self:global:window,_.JSZip=d()}})(function(){return function x(z,E,I){function A(T,D){if(!E[T]){if(!z[T]){var N="function"==typeof require&&require;if(!D&&N)return N(T,!0);if(B)return B(T,!0);var L=new Error("Cannot find module '"+T+"'");throw L.code="MODULE_NOT_FOUND",L}var U=E[T]={exports:{}};z[T][0].call(U.exports,function(W){var Z=z[T][1][W];return A(Z?Z:W)},U,U.exports,x,z,E,I)}return E[T].exports}for(var B="function"==typeof require&&require,R=0;R<I.length;R++)A(I[R]);return A}({1:[function(x,z,E){"use strict";var I=x("./utils"),A=x("./support"),B="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";E.encode=function(R){for(var T=[],H=0,G=R.length,Y=G,K="string"!==I.getTypeOf(R),D,N,L,U,W,Z,M;H<R.length;)Y=G-H,K?(D=R[H++],N=H<G?R[H++]:0,L=H<G?R[H++]:0):(D=R.charCodeAt(H++),N=H<G?R.charCodeAt(H++):0,L=H<G?R.charCodeAt(H++):0),U=D>>2,W=(3&D)<<4|N>>4,Z=1<Y?(15&N)<<2|L>>6:64,M=2<Y?63&L:64,T.push(B.charAt(U)+B.charAt(W)+B.charAt(Z)+B.charAt(M));return T.join("")},E.decode=function(R){var M=0,H=0,G="data:",T,D,N,L,U,W,Z;if(R.substr(0,G.length)===G)throw new Error("Invalid base64 input, it looks like a data url.");R=R.replace(/[^A-Za-z0-9\+\/\=]/g,"");var Y=3*R.length/4;if(R.charAt(R.length-1)===B.charAt(64)&&Y--,R.charAt(R.length-2)===B.charAt(64)&&Y--,0!=Y%1)throw new Error("Invalid base64 input, bad content length.");var K;for(K=A.uint8array?new Uint8Array(0|Y):Array(0|Y);M<R.length;)L=B.indexOf(R.charAt(M++)),U=B.indexOf(R.charAt(M++)),W=B.indexOf(R.charAt(M++)),Z=B.indexOf(R.charAt(M++)),T=L<<2|U>>4,D=(15&U)<<4|W>>2,N=(3&W)<<6|Z,K[H++]=T,64!==W&&(K[H++]=D),64!==Z&&(K[H++]=N);return K}},{"./support":30,"./utils":32}],2:[function(x,z){"use strict";function I(D,N,L,U,W){this.compressedSize=D,this.uncompressedSize=N,this.crc32=L,this.compression=U,this.compressedContent=W}var A=x("./external"),B=x("./stream/DataWorker"),R=x("./stream/DataLengthProbe"),T=x("./stream/Crc32Probe"),R=x("./stream/DataLengthProbe");I.prototype={getContentWorker:function(){var D=new B(A.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new R("data_length")),N=this;return D.on("end",function(){if(this.streamInfo.data_length!==N.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),D},getCompressedWorker:function(){return new B(A.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},I.createWorkerFrom=function(D,N,L){return D.pipe(new T).pipe(new R("uncompressedSize")).pipe(N.compressWorker(L)).pipe(new R("compressedSize")).withStreamInfo("compression",N)},z.exports=I},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(x,z,E){"use strict";var I=x("./stream/GenericWorker");E.STORE={magic:"\0\0",compressWorker:function(){return new I("STORE compression")},uncompressWorker:function(){return new I("STORE decompression")}},E.DEFLATE=x("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(x,z){"use strict";function A(D,N,L,U){D^=-1;for(var M=U;M<U+L;M++)D=D>>>8^T[255&(D^N[M])];return-1^D}function B(D,N,L,U){D^=-1;for(var M=U;M<U+L;M++)D=D>>>8^T[255&(D^N.charCodeAt(M))];return-1^D}var R=x("./utils"),T=function(){for(var N=[],L=0,D;256>L;L++){D=L;for(var U=0;8>U;U++)D=1&D?3988292384^D>>>1:D>>>1;N[L]=D}return N}();z.exports=function(N,L){if("undefined"==typeof N||!N.length)return 0;var U="string"!==R.getTypeOf(N);return U?A(0|L,N,N.length,0):B(0|L,N,N.length,0)}},{"./utils":32}],5:[function(x,z,E){"use strict";E.base64=!1,E.binary=!1,E.dir=!1,E.createFolders=!0,E.date=null,E.compression=null,E.compressionOptions=null,E.comment=null,E.unixPermissions=null,E.dosPermissions=null},{}],6:[function(x,z){"use strict";var I=null;I="undefined"==typeof Promise?x("lie"):Promise,z.exports={Promise:I}},{lie:58}],7:[function(x,z,E){"use strict";function I(N,L){T.call(this,"FlateWorker/"+N),this._pako=null,this._pakoAction=N,this._pakoOptions=L,this.meta={}}var A="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,B=x("pako"),R=x("./utils"),T=x("./stream/GenericWorker"),D=A?"uint8array":"array";E.magic="\b\0",R.inherits(I,T),I.prototype.processChunk=function(N){this.meta=N.meta,null===this._pako&&this._createPako(),this._pako.push(R.transformTo(D,N.data),!1)},I.prototype.flush=function(){T.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},I.prototype.cleanUp=function(){T.prototype.cleanUp.call(this),this._pako=null},I.prototype._createPako=function(){this._pako=new B[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var N=this;this._pako.onData=function(L){N.push({data:L,meta:N.meta})}},E.compressWorker=function(N){return new I("Deflate",N)},E.uncompressWorker=function(){return new I("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:59}],8:[function(x,z){"use strict";function I(H,G,Y,K){B.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=G,this.zipPlatform=Y,this.encodeFileName=K,this.streamFiles=H,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}var A=x("../utils"),B=x("../stream/GenericWorker"),R=x("../utf8"),T=x("../crc32"),D=x("../signature"),N=function(H,G){var Y="",K;for(K=0;K<G;K++)Y+=String.fromCharCode(255&H),H>>>=8;return Y},L=function(H,G){var Y=H;return H||(Y=G?16893:33204),(65535&Y)<<16},U=function(H){return 63&(H||0)},W=function(H,G,Y,K,X,V){var J=H.file,Q=H.compression,$=V!==R.utf8encode,ee=A.transformTo("string",V(J.name)),te=A.transformTo("string",R.utf8encode(J.name)),re=J.comment,ae=A.transformTo("string",V(re)),ne=A.transformTo("string",R.utf8encode(re)),se=te.length!==J.name.length,ie=ne.length!==re.length,le="",ue="",ce="",pe=J.dir,he=J.date,oe,de,fe={crc32:0,compressedSize:0,uncompressedSize:0};(!G||Y)&&(fe.crc32=H.crc32,fe.compressedSize=H.compressedSize,fe.uncompressedSize=H.uncompressedSize);var _e=0;G&&(_e|=8),!$&&(se||ie)&&(_e|=2048);var ge=0,be=0;pe&&(ge|=16),"UNIX"===X?(be=798,ge|=L(J.unixPermissions,pe)):(be=20,ge|=U(J.dosPermissions,pe)),oe=he.getUTCHours(),oe<<=6,oe|=he.getUTCMinutes(),oe<<=5,oe|=he.getUTCSeconds()/2,de=he.getUTCFullYear()-1980,de<<=4,de|=he.getUTCMonth()+1,de<<=5,de|=he.getUTCDate(),se&&(ue=N(1,1)+N(T(ee),4)+te,le+="up"+N(ue.length,2)+ue),ie&&(ce=N(1,1)+N(T(ae),4)+ne,le+="uc"+N(ce.length,2)+ce);var ye="";ye+="\n\0",ye+=N(_e,2),ye+=Q.magic,ye+=N(oe,2),ye+=N(de,2),ye+=N(fe.crc32,4),ye+=N(fe.compressedSize,4),ye+=N(fe.uncompressedSize,4),ye+=N(ee.length,2),ye+=N(le.length,2);var ke=D.LOCAL_FILE_HEADER+ye+ee+le,xe=D.CENTRAL_FILE_HEADER+N(be,2)+ye+N(ae.length,2)+"\0\0\0\0"+N(ge,4)+N(K,4)+ee+le+ae;return{fileRecord:ke,dirRecord:xe}},Z=function(H,G,Y,K,X){var V="",J=A.transformTo("string",X(K));return V=D.CENTRAL_DIRECTORY_END+"\0\0\0\0"+N(H,2)+N(H,2)+N(G,4)+N(Y,4)+N(J.length,2)+J,V},M=function(H){var G="";return G=D.DATA_DESCRIPTOR+N(H.crc32,4)+N(H.compressedSize,4)+N(H.uncompressedSize,4),G};A.inherits(I,B),I.prototype.push=function(H){var G=H.meta.percent||0,Y=this.entriesCount,K=this._sources.length;this.accumulate?this.contentBuffer.push(H):(this.bytesWritten+=H.data.length,B.prototype.push.call(this,{data:H.data,meta:{currentFile:this.currentFile,percent:Y?(G+100*(Y-K-1))/Y:100}}))},I.prototype.openedSource=function(H){this.currentSourceOffset=this.bytesWritten,this.currentFile=H.file.name;var G=this.streamFiles&&!H.file.dir;if(G){var Y=W(H,G,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:Y.fileRecord,meta:{percent:0}})}else this.accumulate=!0},I.prototype.closedSource=function(H){this.accumulate=!1;var G=this.streamFiles&&!H.file.dir,Y=W(H,G,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(Y.dirRecord),G)this.push({data:M(H),meta:{percent:100}});else for(this.push({data:Y.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},I.prototype.flush=function(){for(var H=this.bytesWritten,G=0;G<this.dirRecords.length;G++)this.push({data:this.dirRecords[G],meta:{percent:100}});var Y=this.bytesWritten-H,K=Z(this.dirRecords.length,Y,H,this.zipComment,this.encodeFileName);this.push({data:K,meta:{percent:100}})},I.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},I.prototype.registerPrevious=function(H){this._sources.push(H);var G=this;return H.on("data",function(Y){G.processChunk(Y)}),H.on("end",function(){G.closedSource(G.previous.streamInfo),G._sources.length?G.prepareNextSource():G.end()}),H.on("error",function(Y){G.error(Y)}),this},I.prototype.resume=function(){return!!B.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},I.prototype.error=function(H){var G=this._sources;if(!B.prototype.error.call(this,H))return!1;for(var Y=0;Y<G.length;Y++)try{G[Y].error(H)}catch(K){}return!0},I.prototype.lock=function(){B.prototype.lock.call(this);for(var H=this._sources,G=0;G<H.length;G++)H[G].lock()},z.exports=I},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(x,z,E){"use strict";var I=x("../compressions"),A=x("./ZipFileWorker"),B=function(R,T){var D=R||T,N=I[D];if(!N)throw new Error(D+" is not a valid compression method !");return N};E.generateWorker=function(R,T,D){var N=new A(T.streamFiles,D,T.platform,T.encodeFileName),L=0;try{R.forEach(function(U,W){L++;var Z=B(W.options.compression,T.compression),M=W.options.compressionOptions||T.compressionOptions||{},H=W.dir,G=W.date;W._compressWorker(Z,M).withStreamInfo("file",{name:U,dir:H,date:G,comment:W.comment||"",unixPermissions:W.unixPermissions,dosPermissions:W.dosPermissions}).pipe(N)}),N.entriesCount=L}catch(U){N.error(U)}return N}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(x,z){"use strict";function I(){if(!(this instanceof I))return new I;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var A=new I;for(var B in this)"function"!=typeof this[B]&&(A[B]=this[B]);return A}}I.prototype=x("./object"),I.prototype.loadAsync=x("./load"),I.support=x("./support"),I.defaults=x("./defaults"),I.version="3.1.5",I.loadAsync=function(A,B){return new I().loadAsync(A,B)},I.external=x("./external"),z.exports=I},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(x,z){"use strict";function I(L){return new B.Promise(function(U,W){var Z=L.decompressed.getContentWorker().pipe(new D);Z.on("error",function(M){W(M)}).on("end",function(){Z.streamInfo.crc32===L.decompressed.crc32?U():W(new Error("Corrupted zip : CRC32 mismatch"))}).resume()})}var A=x("./utils"),B=x("./external"),R=x("./utf8"),A=x("./utils"),T=x("./zipEntries"),D=x("./stream/Crc32Probe"),N=x("./nodejsUtils");z.exports=function(L,U){var W=this;return U=A.extend(U||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:R.utf8decode}),N.isNode&&N.isStream(L)?B.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):A.prepareContent("the loaded zip file",L,!0,U.optimizedBinaryString,U.base64).then(function(Z){var M=new T(U);return M.load(Z),M}).then(function(M){var H=[B.Promise.resolve(M)],G=M.files;if(U.checkCRC32)for(var Y=0;Y<G.length;Y++)H.push(I(G[Y]));return B.Promise.all(H)}).then(function(M){for(var H=M.shift(),G=H.files,Y=0,K;Y<G.length;Y++)K=G[Y],W.file(K.fileNameStr,K.decompressed,{binary:!0,optimizedBinaryString:!0,date:K.date,dir:K.dir,comment:K.fileCommentStr.length?K.fileCommentStr:null,unixPermissions:K.unixPermissions,dosPermissions:K.dosPermissions,createFolders:U.createFolders});return H.zipComment.length&&(W.comment=H.zipComment),W})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(x,z){"use strict";function I(R,T){B.call(this,"Nodejs stream input adapter for "+R),this._upstreamEnded=!1,this._bindStream(T)}var A=x("../utils"),B=x("../stream/GenericWorker");A.inherits(I,B),I.prototype._bindStream=function(R){var T=this;this._stream=R,R.pause(),R.on("data",function(D){T.push({data:D,meta:{percent:0}})}).on("error",function(D){T.isPaused?this.generatedError=D:T.error(D)}).on("end",function(){T.isPaused?T._upstreamEnded=!0:T.end()})},I.prototype.pause=function(){return!!B.prototype.pause.call(this)&&(this._stream.pause(),!0)},I.prototype.resume=function(){return!!B.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},z.exports=I},{"../stream/GenericWorker":28,"../utils":32}],13:[function(x,z){"use strict";function I(R,T,D){A.call(this,T),this._helper=R;var N=this;R.on("data",function(L,U){N.push(L)||N._helper.pause(),D&&D(U)}).on("error",function(L){N.emit("error",L)}).on("end",function(){N.push(null)})}var A=x("readable-stream").Readable,B=x("../utils");B.inherits(I,A),I.prototype._read=function(){this._helper.resume()},z.exports=I},{"../utils":32,"readable-stream":16}],14:[function(x,z){"use strict";z.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(I,A){return new Buffer(I,A)},allocBuffer:function(I){return Buffer.alloc?Buffer.alloc(I):new Buffer(I)},isBuffer:function(I){return Buffer.isBuffer(I)},isStream:function(I){return I&&"function"==typeof I.on&&"function"==typeof I.pause&&"function"==typeof I.resume}}},{}],15:[function(x,z){"use strict";function I(X){return"[object RegExp]"===Object.prototype.toString.call(X)}var A=x("./utf8"),B=x("./utils"),R=x("./stream/GenericWorker"),T=x("./stream/StreamHelper"),D=x("./defaults"),N=x("./compressedObject"),L=x("./zipObject"),U=x("./generate"),W=x("./nodejsUtils"),Z=x("./nodejs/NodejsStreamInputAdapter"),M=function(X,V,J){var Q=B.getTypeOf(V),$,ee=B.extend(J||{},D);ee.date=ee.date||new Date,null!==ee.compression&&(ee.compression=ee.compression.toUpperCase()),"string"==typeof ee.unixPermissions&&(ee.unixPermissions=parseInt(ee.unixPermissions,8)),ee.unixPermissions&&16384&ee.unixPermissions&&(ee.dir=!0),ee.dosPermissions&&16&ee.dosPermissions&&(ee.dir=!0),ee.dir&&(X=G(X)),ee.createFolders&&($=H(X))&&Y.call(this,$,!0);var te="string"===Q&&!1===ee.binary&&!1===ee.base64;J&&"undefined"!=typeof J.binary||(ee.binary=!te);var re=V instanceof N&&0===V.uncompressedSize;(re||ee.dir||!V||0===V.length)&&(ee.base64=!1,ee.binary=!0,V="",ee.compression="STORE",Q="string");var ae=null;ae=V instanceof N||V instanceof R?V:W.isNode&&W.isStream(V)?new Z(X,V):B.prepareContent(X,V,ee.binary,ee.optimizedBinaryString,ee.base64);var ne=new L(X,ae,ee);this.files[X]=ne},H=function(X){"/"===X.slice(-1)&&(X=X.substring(0,X.length-1));var V=X.lastIndexOf("/");return 0<V?X.substring(0,V):""},G=function(X){return"/"!==X.slice(-1)&&(X+="/"),X},Y=function(X,V){return V="undefined"==typeof V?D.createFolders:V,X=G(X),this.files[X]||M.call(this,X,null,{dir:!0,createFolders:V}),this.files[X]};z.exports={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(X){var V,J,Q;for(V in this.files)this.files.hasOwnProperty(V)&&(Q=this.files[V],J=V.slice(this.root.length,V.length),J&&V.slice(0,this.root.length)===this.root&&X(J,Q))},filter:function(X){var V=[];return this.forEach(function(J,Q){X(J,Q)&&V.push(Q)}),V},file:function(X,V,J){if(1===arguments.length){if(I(X)){var Q=X;return this.filter(function(ee,te){return!te.dir&&Q.test(ee)})}var $=this.files[this.root+X];return $&&!$.dir?$:null}return X=this.root+X,M.call(this,X,V,J),this},folder:function(X){if(!X)return this;if(I(X))return this.filter(function($,ee){return ee.dir&&X.test($)});var V=this.root+X,J=Y.call(this,V),Q=this.clone();return Q.root=J.name,Q},remove:function(X){X=this.root+X;var V=this.files[X];if(V||("/"!==X.slice(-1)&&(X+="/"),V=this.files[X]),V&&!V.dir)delete this.files[X];else for(var J=this.filter(function($,ee){return ee.name.slice(0,X.length)===X}),Q=0;Q<J.length;Q++)delete this.files[J[Q].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(X){var J={},V;try{if(J=B.extend(X||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:A.utf8encode}),J.type=J.type.toLowerCase(),J.compression=J.compression.toUpperCase(),"binarystring"===J.type&&(J.type="string"),!J.type)throw new Error("No output type specified.");B.checkSupport(J.type),("darwin"===J.platform||"freebsd"===J.platform||"linux"===J.platform||"sunos"===J.platform)&&(J.platform="UNIX"),"win32"===J.platform&&(J.platform="DOS");var Q=J.comment||this.comment||"";V=U.generateWorker(this,J,Q)}catch($){V=new R("error"),V.error($)}return new T(V,J.type||"string",J.mimeType)},generateAsync:function(X,V){return this.generateInternalStream(X).accumulate(V)},generateNodeStream:function(X,V){return X=X||{},X.type||(X.type="nodebuffer"),this.generateInternalStream(X).toNodejsStream(V)}}},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(x,z){z.exports=x("stream")},{stream:void 0}],17:[function(x,z){"use strict";function I(R){A.call(this,R);for(var T=0;T<this.data.length;T++)R[T]&=255}var A=x("./DataReader"),B=x("../utils");B.inherits(I,A),I.prototype.byteAt=function(R){return this.data[this.zero+R]},I.prototype.lastIndexOfSignature=function(R){for(var T=R.charCodeAt(0),D=R.charCodeAt(1),N=R.charCodeAt(2),L=R.charCodeAt(3),U=this.length-4;0<=U;--U)if(this.data[U]===T&&this.data[U+1]===D&&this.data[U+2]===N&&this.data[U+3]===L)return U-this.zero;return-1},I.prototype.readAndCheckSignature=function(R){var T=R.charCodeAt(0),D=R.charCodeAt(1),N=R.charCodeAt(2),L=R.charCodeAt(3),U=this.readData(4);return T===U[0]&&D===U[1]&&N===U[2]&&L===U[3]},I.prototype.readData=function(R){if(this.checkOffset(R),0===R)return[];var T=this.data.slice(this.zero+this.index,this.zero+this.index+R);return this.index+=R,T},z.exports=I},{"../utils":32,"./DataReader":18}],18:[function(x,z){"use strict";function I(B){this.data=B,this.length=B.length,this.index=0,this.zero=0}var A=x("../utils");I.prototype={checkOffset:function(B){this.checkIndex(this.index+B)},checkIndex:function(B){if(this.length<this.zero+B||0>B)throw new Error("End of data reached (data length = "+this.length+", asked index = "+B+"). Corrupted zip ?")},setIndex:function(B){this.checkIndex(B),this.index=B},skip:function(B){this.setIndex(this.index+B)},byteAt:function(){},readInt:function(B){var R=0,T;for(this.checkOffset(B),T=this.index+B-1;T>=this.index;T--)R=(R<<8)+this.byteAt(T);return this.index+=B,R},readString:function(B){return A.transformTo("string",this.readData(B))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var B=this.readInt(4);return new Date(Date.UTC((127&B>>25)+1980,(15&B>>21)-1,31&B>>16,31&B>>11,63&B>>5,(31&B)<<1))}},z.exports=I},{"../utils":32}],19:[function(x,z){"use strict";function I(R){A.call(this,R)}var A=x("./Uint8ArrayReader"),B=x("../utils");B.inherits(I,A),I.prototype.readData=function(R){this.checkOffset(R);var T=this.data.slice(this.zero+this.index,this.zero+this.index+R);return this.index+=R,T},z.exports=I},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(x,z){"use strict";function I(R){A.call(this,R)}var A=x("./DataReader"),B=x("../utils");B.inherits(I,A),I.prototype.byteAt=function(R){return this.data.charCodeAt(this.zero+R)},I.prototype.lastIndexOfSignature=function(R){return this.data.lastIndexOf(R)-this.zero},I.prototype.readAndCheckSignature=function(R){var T=this.readData(4);return R===T},I.prototype.readData=function(R){this.checkOffset(R);var T=this.data.slice(this.zero+this.index,this.zero+this.index+R);return this.index+=R,T},z.exports=I},{"../utils":32,"./DataReader":18}],21:[function(x,z){"use strict";function I(R){A.call(this,R)}var A=x("./ArrayReader"),B=x("../utils");B.inherits(I,A),I.prototype.readData=function(R){if(this.checkOffset(R),0===R)return new Uint8Array(0);var T=this.data.subarray(this.zero+this.index,this.zero+this.index+R);return this.index+=R,T},z.exports=I},{"../utils":32,"./ArrayReader":17}],22:[function(x,z){"use strict";var I=x("../utils"),A=x("../support"),B=x("./ArrayReader"),R=x("./StringReader"),T=x("./NodeBufferReader"),D=x("./Uint8ArrayReader");z.exports=function(N){var L=I.getTypeOf(N);return I.checkSupport(L),"string"!==L||A.uint8array?"nodebuffer"===L?new T(N):A.uint8array?new D(I.transformTo("uint8array",N)):new B(I.transformTo("array",N)):new R(N)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(x,z,E){"use strict";E.LOCAL_FILE_HEADER="PK\x03\x04",E.CENTRAL_FILE_HEADER="PK\x01\x02",E.CENTRAL_DIRECTORY_END="PK\x05\x06",E.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x06\x07",E.ZIP64_CENTRAL_DIRECTORY_END="PK\x06\x06",E.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(x,z){"use strict";function I(R){A.call(this,"ConvertWorker to "+R),this.destType=R}var A=x("./GenericWorker"),B=x("../utils");B.inherits(I,A),I.prototype.processChunk=function(R){this.push({data:B.transformTo(this.destType,R.data),meta:R.meta})},z.exports=I},{"../utils":32,"./GenericWorker":28}],25:[function(x,z){"use strict";function I(){A.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}var A=x("./GenericWorker"),B=x("../crc32"),R=x("../utils");R.inherits(I,A),I.prototype.processChunk=function(T){this.streamInfo.crc32=B(T.data,this.streamInfo.crc32||0),this.push(T)},z.exports=I},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(x,z){"use strict";function I(R){B.call(this,"DataLengthProbe for "+R),this.propName=R,this.withStreamInfo(R,0)}var A=x("../utils"),B=x("./GenericWorker");A.inherits(I,B),I.prototype.processChunk=function(R){if(R){var T=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=T+R.data.length}B.prototype.processChunk.call(this,R)},z.exports=I},{"../utils":32,"./GenericWorker":28}],27:[function(x,z){"use strict";function I(T){B.call(this,"DataWorker");var D=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,T.then(function(N){D.dataIsReady=!0,D.data=N,D.max=N&&N.length||0,D.type=A.getTypeOf(N),D.isPaused||D._tickAndRepeat()},function(N){D.error(N)})}var A=x("../utils"),B=x("./GenericWorker");A.inherits(I,B),I.prototype.cleanUp=function(){B.prototype.cleanUp.call(this),this.data=null},I.prototype.resume=function(){return!!B.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,A.delay(this._tickAndRepeat,[],this)),!0)},I.prototype._tickAndRepeat=function(){this._tickScheduled=!1;this.isPaused||this.isFinished||(this._tick(),!this.isFinished&&(A.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},I.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var D=null,N=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":D=this.data.substring(this.index,N);break;case"uint8array":D=this.data.subarray(this.index,N);break;case"array":case"nodebuffer":D=this.data.slice(this.index,N);}return this.index=N,this.push({data:D,meta:{percent:this.max?100*(this.index/this.max):0}})},z.exports=I},{"../utils":32,"./GenericWorker":28}],28:[function(x,z){"use strict";function I(A){this.name=A||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}I.prototype={push:function(A){this.emit("data",A)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(A){this.emit("error",A)}return!0},error:function(A){return!this.isFinished&&(this.isPaused?this.generatedError=A:(this.isFinished=!0,this.emit("error",A),this.previous&&this.previous.error(A),this.cleanUp()),!0)},on:function(A,B){return this._listeners[A].push(B),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(A,B){if(this._listeners[A])for(var R=0;R<this._listeners[A].length;R++)this._listeners[A][R].call(this,B)},pipe:function(A){return A.registerPrevious(this)},registerPrevious:function(A){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=A.streamInfo,this.mergeStreamInfo(),this.previous=A;var B=this;return A.on("data",function(R){B.processChunk(R)}),A.on("end",function(){B.end()}),A.on("error",function(R){B.error(R)}),this},pause:function(){return this.isPaused||this.isFinished?!1:(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var A=!1;return this.generatedError&&(this.error(this.generatedError),A=!0),this.previous&&this.previous.resume(),!A},flush:function(){},processChunk:function(A){this.push(A)},withStreamInfo:function(A,B){return this.extraStreamInfo[A]=B,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var A in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(A)&&(this.streamInfo[A]=this.extraStreamInfo[A])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var A="Worker "+this.name;return this.previous?this.previous+" -> "+A:A}},z.exports=I},{}],29:[function(x,z){"use strict";function I(M,H,G){return"blob"===M?T.newBlob(T.transformTo("arraybuffer",H),G):"base64"===M?L.encode(H):T.transformTo(M,H)}function A(M,H){var Y=0,K=null,X=0,G;for(G=0;G<H.length;G++)X+=H[G].length;switch(M){case"string":return H.join("");case"array":return Array.prototype.concat.apply([],H);case"uint8array":for(K=new Uint8Array(X),G=0;G<H.length;G++)K.set(H[G],Y),Y+=H[G].length;return K;case"nodebuffer":return Buffer.concat(H);default:throw new Error("concat : unsupported type '"+M+"'");}}function B(M,H){return new W.Promise(function(G,Y){var K=[],X=M._internalType,V=M._outputType,J=M._mimeType;M.on("data",function(Q,$){K.push(Q),H&&H($)}).on("error",function(Q){K=[],Y(Q)}).on("end",function(){try{var Q=I(V,A(X,K),J);G(Q)}catch($){Y($)}K=[]}).resume()})}function R(M,H,G){var Y=H;"blob"===H||"arraybuffer"===H?Y="uint8array":"base64"===H?Y="string":void 0;try{this._internalType=Y,this._outputType=H,this._mimeType=G,T.checkSupport(Y),this._worker=M.pipe(new D(Y)),M.lock()}catch(K){this._worker=new N("error"),this._worker.error(K)}}var T=x("../utils"),D=x("./ConvertWorker"),N=x("./GenericWorker"),L=x("../base64"),U=x("../support"),W=x("../external"),Z=null;if(U.nodestream)try{Z=x("../nodejs/NodejsStreamOutputAdapter")}catch(M){}R.prototype={accumulate:function(M){return B(this,M)},on:function(M,H){var G=this;return"data"===M?this._worker.on(M,function(Y){H.call(G,Y.data,Y.meta)}):this._worker.on(M,function(){T.delay(H,arguments,G)}),this},resume:function(){return T.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(M){if(T.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new Z(this,{objectMode:"nodebuffer"!==this._outputType},M)}},z.exports=R},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(x,z,E){"use strict";if(E.base64=!0,E.array=!0,E.string=!0,E.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,E.nodebuffer="undefined"!=typeof Buffer,E.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)E.blob=!1;else{var I=new ArrayBuffer(0);try{E.blob=0===new System.Bb([I],{type:"application/zip"}).size}catch(R){try{var A=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,B=new A;B.append(I),E.blob=0===B.getBlob("application/zip").size}catch(T){E.blob=!1}}}try{E.nodestream=!!x("readable-stream").Readable}catch(R){E.nodestream=!1}},{"readable-stream":16}],31:[function(x,z,E){"use strict";function I(){D.call(this,"utf-8 decode"),this.leftOver=null}function A(){D.call(this,"utf-8 encode")}for(var B=x("./utils"),R=x("./support"),T=x("./nodejsUtils"),D=x("./stream/GenericWorker"),N=Array(256),L=0;256>L;L++)N[L]=252<=L?6:248<=L?5:240<=L?4:224<=L?3:192<=L?2:1;N[254]=N[254]=1;var U=function(M){var V=M.length,J=0,H,G,Y,K,X;for(K=0;K<V;K++)G=M.charCodeAt(K),55296==(64512&G)&&K+1<V&&(Y=M.charCodeAt(K+1),56320==(64512&Y)&&(G=65536+(G-55296<<10)+(Y-56320),K++)),J+=128>G?1:2048>G?2:65536>G?3:4;for(H=R.uint8array?new Uint8Array(J):Array(J),X=0,K=0;X<J;K++)G=M.charCodeAt(K),55296==(64512&G)&&K+1<V&&(Y=M.charCodeAt(K+1),56320==(64512&Y)&&(G=65536+(G-55296<<10)+(Y-56320),K++)),128>G?H[X++]=G:2048>G?(H[X++]=192|G>>>6,H[X++]=128|63&G):65536>G?(H[X++]=224|G>>>12,H[X++]=128|63&G>>>6,H[X++]=128|63&G):(H[X++]=240|G>>>18,H[X++]=128|63&G>>>12,H[X++]=128|63&G>>>6,H[X++]=128|63&G);return H},W=function(M,H){var G;for(H=H||M.length,H>M.length&&(H=M.length),G=H-1;0<=G&&128==(192&M[G]);)G--;return 0>G?H:0===G?H:G+N[M[G]]>H?G:H},Z=function(M){var V=M.length,J=Array(2*V),G,Y,K,X;for(Y=0,G=0;G<V;){if(K=M[G++],128>K){J[Y++]=K;continue}if(X=N[K],4<X){J[Y++]=65533,G+=X-1;continue}for(K&=2===X?31:3===X?15:7;1<X&&G<V;)K=K<<6|63&M[G++],X--;if(1<X){J[Y++]=65533;continue}65536>K?J[Y++]=K:(K-=65536,J[Y++]=55296|1023&K>>10,J[Y++]=56320|1023&K)}return J.length!==Y&&(J.subarray?J=J.subarray(0,Y):J.length=Y),B.applyFromCharCode(J)};E.utf8encode=function(H){return R.nodebuffer?T.newBufferFrom(H,"utf-8"):U(H)},E.utf8decode=function(H){return R.nodebuffer?B.transformTo("nodebuffer",H).toString("utf-8"):(H=B.transformTo(R.uint8array?"uint8array":"array",H),Z(H))},B.inherits(I,D),I.prototype.processChunk=function(M){var H=B.transformTo(R.uint8array?"uint8array":"array",M.data);if(this.leftOver&&this.leftOver.length){if(R.uint8array){var G=H;H=new Uint8Array(G.length+this.leftOver.length),H.set(this.leftOver,0),H.set(G,this.leftOver.length)}else H=this.leftOver.concat(H);this.leftOver=null}var Y=W(H),K=H;Y!==H.length&&(R.uint8array?(K=H.subarray(0,Y),this.leftOver=H.subarray(Y,H.length)):(K=H.slice(0,Y),this.leftOver=H.slice(Y,H.length))),this.push({data:E.utf8decode(K),meta:M.meta})},I.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:E.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},E.Utf8DecodeWorker=I,B.inherits(A,D),A.prototype.processChunk=function(M){this.push({data:E.utf8encode(M.data),meta:M.meta})},E.Utf8EncodeWorker=A},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(x,z,E){"use strict";function I(H){var G=null;return G=D.uint8array?new Uint8Array(H.length):Array(H.length),B(H,G)}function A(H){return H}function B(H,G){for(var Y=0;Y<H.length;++Y)G[Y]=255&H.charCodeAt(Y);return G}function R(H){var G=65536,Y=E.getTypeOf(H),K=!0;if("uint8array"===Y?K=Z.applyCanBeUsed.uint8array:"nodebuffer"===Y&&(K=Z.applyCanBeUsed.nodebuffer),K)for(;1<G;)try{return Z.stringifyByChunk(H,Y,G)}catch(X){G=Math.floor(G/2)}return Z.stringifyByChar(H)}function T(H,G){for(var Y=0;Y<H.length;Y++)G[Y]=H[Y];return G}var D=x("./support"),N=x("./base64"),L=x("./nodejsUtils"),U=x("core-js/library/fn/set-immediate"),W=x("./external");E.newBlob=function(H,G){E.checkSupport("blob");try{return new System.Bb([H],{type:G})}catch(X){try{var Y=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,K=new Y;return K.append(H),K.getBlob(G)}catch(V){throw new Error("Bug : can't construct the Blob.")}}};var Z={stringifyByChunk:function(H,G,Y){var K=[],X=0,V=H.length;if(V<=Y)return String.fromCharCode.apply(null,H);for(;X<V;)"array"===G||"nodebuffer"===G?K.push(String.fromCharCode.apply(null,H.slice(X,Math.min(X+Y,V)))):K.push(String.fromCharCode.apply(null,H.subarray(X,Math.min(X+Y,V)))),X+=Y;return K.join("")},stringifyByChar:function(H){for(var G="",Y=0;Y<H.length;Y++)G+=String.fromCharCode(H[Y]);return G},applyCanBeUsed:{uint8array:function(){try{return D.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(H){return!1}}(),nodebuffer:function(){try{return D.nodebuffer&&1===String.fromCharCode.apply(null,L.allocBuffer(1)).length}catch(H){return!1}}()}};E.applyFromCharCode=R;var M={};M.string={string:A,array:function(H){return B(H,Array(H.length))},arraybuffer:function(H){return M.string.uint8array(H).buffer},uint8array:function(H){return B(H,new Uint8Array(H.length))},nodebuffer:function(H){return B(H,L.allocBuffer(H.length))}},M.array={string:R,array:A,arraybuffer:function(H){return new Uint8Array(H).buffer},uint8array:function(H){return new Uint8Array(H)},nodebuffer:function(H){return L.newBufferFrom(H)}},M.arraybuffer={string:function(H){return R(new Uint8Array(H))},array:function(H){return T(new Uint8Array(H),Array(H.byteLength))},arraybuffer:A,uint8array:function(H){return new Uint8Array(H)},nodebuffer:function(H){return L.newBufferFrom(new Uint8Array(H))}},M.uint8array={string:R,array:function(H){return T(H,Array(H.length))},arraybuffer:function(H){return H.buffer},uint8array:A,nodebuffer:function(H){return L.newBufferFrom(H)}},M.nodebuffer={string:R,array:function(H){return T(H,Array(H.length))},arraybuffer:function(H){return M.nodebuffer.uint8array(H).buffer},uint8array:function(H){return T(H,new Uint8Array(H.length))},nodebuffer:A},E.transformTo=function(H,G){if(G||(G=""),!H)return G;E.checkSupport(H);var Y=E.getTypeOf(G),K=M[Y][H](G);return K},E.getTypeOf=function(H){return"string"==typeof H?"string":"[object Array]"===Object.prototype.toString.call(H)?"array":D.nodebuffer&&L.isBuffer(H)?"nodebuffer":D.uint8array&&H instanceof Uint8Array?"uint8array":D.arraybuffer&&H instanceof ArrayBuffer?"arraybuffer":void 0},E.checkSupport=function(H){var G=D[H.toLowerCase()];if(!G)throw new Error(H+" is not supported by this platform")},E.MAX_VALUE_16BITS=65535,E.MAX_VALUE_32BITS=-1,E.pretty=function(H){var G="",Y,K;for(K=0;K<(H||"").length;K++)Y=H.charCodeAt(K),G+="\\x"+(16>Y?"0":"")+Y.toString(16).toUpperCase();return G},E.delay=function(H,G,Y){U(function(){H.apply(Y||null,G||[])})},E.inherits=function(H,G){var Y=function(){};Y.prototype=G.prototype,H.prototype=new Y},E.extend=function(){var H={},G,Y;for(G=0;G<arguments.length;G++)for(Y in arguments[G])arguments[G].hasOwnProperty(Y)&&"undefined"==typeof H[Y]&&(H[Y]=arguments[G][Y]);return H},E.prepareContent=function(H,G,Y,K,X){var V=W.Promise.resolve(G).then(function(J){var Q=D.blob&&(J instanceof System.Bb||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(J)));return Q&&"undefined"!=typeof FileReader?new W.Promise(function($,ee){var te=new FileReader;te.onload=function(re){$(re.target.result)},te.onerror=function(re){ee(re.target.error)},te.readAsArrayBuffer(J)}):J});return V.then(function(J){var Q=E.getTypeOf(J);return Q?("arraybuffer"===Q?J=E.transformTo("uint8array",J):"string"===Q&&(X?J=N.decode(J):Y&&!0!==K&&(J=I(J))),J):W.Promise.reject(new Error("Can't read the data of '"+H+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"core-js/library/fn/set-immediate":36}],33:[function(x,z){"use strict";function I(L){this.files=[],this.loadOptions=L}var A=x("./reader/readerFor"),B=x("./utils"),R=x("./signature"),T=x("./zipEntry"),D=x("./utf8"),N=x("./support");I.prototype={checkSignature:function(L){if(!this.reader.readAndCheckSignature(L)){this.reader.index-=4;var U=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+B.pretty(U)+", expected "+B.pretty(L)+")")}},isSignature:function(L,U){var W=this.reader.index;this.reader.setIndex(L);var Z=this.reader.readString(4);return this.reader.setIndex(W),Z===U},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var L=this.reader.readData(this.zipCommentLength),U=N.uint8array?"uint8array":"array",W=B.transformTo(U,L);this.zipComment=this.loadOptions.decodeFileName(W)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var L=this.zip64EndOfCentralSize-44,W,Z,M;0<L;)W=this.reader.readInt(2),Z=this.reader.readInt(4),M=this.reader.readData(Z),this.zip64ExtensibleData[W]={id:W,length:Z,value:M}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var L,U;for(L=0;L<this.files.length;L++)U=this.files[L],this.reader.setIndex(U.localHeaderOffset),this.checkSignature(R.LOCAL_FILE_HEADER),U.readLocalPart(this.reader),U.handleUTF8(),U.processAttributes()},readCentralDir:function(){var L;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(R.CENTRAL_FILE_HEADER);)L=new T({zip64:this.zip64},this.loadOptions),L.readCentralPart(this.reader),this.files.push(L);if(this.centralDirRecords!==this.files.length)if(0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length);else;},readEndOfCentral:function(){var L=this.reader.lastIndexOfSignature(R.CENTRAL_DIRECTORY_END);if(0>L){var U=!this.isSignature(0,R.LOCAL_FILE_HEADER);if(U)throw new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");else throw new Error("Corrupted zip: can't find end of central directory")}this.reader.setIndex(L);var W=L;if(this.checkSignature(R.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===B.MAX_VALUE_16BITS||this.diskWithCentralDirStart===B.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===B.MAX_VALUE_16BITS||this.centralDirRecords===B.MAX_VALUE_16BITS||this.centralDirSize===B.MAX_VALUE_32BITS||this.centralDirOffset===B.MAX_VALUE_32BITS){if(this.zip64=!0,L=this.reader.lastIndexOfSignature(R.ZIP64_CENTRAL_DIRECTORY_LOCATOR),0>L)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(L),this.checkSignature(R.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,R.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(R.ZIP64_CENTRAL_DIRECTORY_END),0>this.relativeOffsetEndOfZip64CentralDir))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(R.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var Z=this.centralDirOffset+this.centralDirSize;this.zip64&&(Z+=20,Z+=12+this.zip64EndOfCentralSize);var M=W-Z;if(0<M)this.isSignature(W,R.CENTRAL_FILE_HEADER)||(this.reader.zero=M);else if(0>M)throw new Error("Corrupted zip: missing "+Math.abs(M)+" bytes.")},prepareReader:function(L){this.reader=A(L)},load:function(L){this.prepareReader(L),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},z.exports=I},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(x,z){"use strict";function I(M,H){this.options=M,this.loadOptions=H}var A=x("./reader/readerFor"),B=x("./utils"),R=x("./compressedObject"),T=x("./crc32"),D=x("./utf8"),N=x("./compressions"),L=x("./support"),Z=function(M){for(var H in N)if(N.hasOwnProperty(H)&&N[H].magic===M)return N[H];return null};I.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(M){var H,G;if(M.skip(22),this.fileNameLength=M.readInt(2),G=M.readInt(2),this.fileName=M.readData(this.fileNameLength),M.skip(G),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(H=Z(this.compressionMethod),null===H)throw new Error("Corrupted zip : compression "+B.pretty(this.compressionMethod)+" unknown (inner file : "+B.transformTo("string",this.fileName)+")");this.decompressed=new R(this.compressedSize,this.uncompressedSize,this.crc32,H,M.readData(this.compressedSize))},readCentralPart:function(M){this.versionMadeBy=M.readInt(2),M.skip(2),this.bitFlag=M.readInt(2),this.compressionMethod=M.readString(2),this.date=M.readDate(),this.crc32=M.readInt(4),this.compressedSize=M.readInt(4),this.uncompressedSize=M.readInt(4);var H=M.readInt(2);if(this.extraFieldsLength=M.readInt(2),this.fileCommentLength=M.readInt(2),this.diskNumberStart=M.readInt(2),this.internalFileAttributes=M.readInt(2),this.externalFileAttributes=M.readInt(4),this.localHeaderOffset=M.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");M.skip(H),this.readExtraFields(M),this.parseZIP64ExtraField(M),this.fileComment=M.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var M=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),M==0&&(this.dosPermissions=63&this.externalFileAttributes),M==3&&(this.unixPermissions=65535&this.externalFileAttributes>>16),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var H=A(this.extraFields[1].value);this.uncompressedSize===B.MAX_VALUE_32BITS&&(this.uncompressedSize=H.readInt(8)),this.compressedSize===B.MAX_VALUE_32BITS&&(this.compressedSize=H.readInt(8)),this.localHeaderOffset===B.MAX_VALUE_32BITS&&(this.localHeaderOffset=H.readInt(8)),this.diskNumberStart===B.MAX_VALUE_32BITS&&(this.diskNumberStart=H.readInt(4))}},readExtraFields:function(M){var H=M.index+this.extraFieldsLength,G,Y,K;for(this.extraFields||(this.extraFields={});M.index<H;)G=M.readInt(2),Y=M.readInt(2),K=M.readData(Y),this.extraFields[G]={id:G,length:Y,value:K}},handleUTF8:function(){var M=L.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=D.utf8decode(this.fileName),this.fileCommentStr=D.utf8decode(this.fileComment);else{var H=this.findExtraFieldUnicodePath();if(null!==H)this.fileNameStr=H;else{var G=B.transformTo(M,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(G)}var Y=this.findExtraFieldUnicodeComment();if(null!==Y)this.fileCommentStr=Y;else{var K=B.transformTo(M,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(K)}}},findExtraFieldUnicodePath:function(){var M=this.extraFields[28789];if(M){var H=A(M.value);return 1===H.readInt(1)?T(this.fileName)===H.readInt(4)?D.utf8decode(H.readData(M.length-5)):null:null}return null},findExtraFieldUnicodeComment:function(){var M=this.extraFields[25461];if(M){var H=A(M.value);return 1===H.readInt(1)?T(this.fileComment)===H.readInt(4)?D.utf8decode(H.readData(M.length-5)):null:null}return null}},z.exports=I},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(x,z){"use strict";var I=x("./stream/StreamHelper"),A=x("./stream/DataWorker"),B=x("./utf8"),R=x("./compressedObject"),T=x("./stream/GenericWorker"),D=function(W,Z,M){this.name=W,this.dir=M.dir,this.date=M.date,this.comment=M.comment,this.unixPermissions=M.unixPermissions,this.dosPermissions=M.dosPermissions,this._data=Z,this._dataBinary=M.binary,this.options={compression:M.compression,compressionOptions:M.compressionOptions}};D.prototype={internalStream:function(W){var Z=null,M="string";try{if(!W)throw new Error("No output type specified.");M=W.toLowerCase();var H="string"==M||"text"==M;("binarystring"==M||"text"==M)&&(M="string"),Z=this._decompressWorker();var G=!this._dataBinary;G&&!H&&(Z=Z.pipe(new B.Utf8EncodeWorker)),!G&&H&&(Z=Z.pipe(new B.Utf8DecodeWorker))}catch(Y){Z=new T("error"),Z.error(Y)}return new I(Z,M,"")},async:function(W,Z){return this.internalStream(W).accumulate(Z)},nodeStream:function(W,Z){return this.internalStream(W||"nodebuffer").toNodejsStream(Z)},_compressWorker:function(W,Z){if(this._data instanceof R&&this._data.compression.magic===W.magic)return this._data.getCompressedWorker();var M=this._decompressWorker();return this._dataBinary||(M=M.pipe(new B.Utf8EncodeWorker)),R.createWorkerFrom(M,W,Z)},_decompressWorker:function(){return this._data instanceof R?this._data.getContentWorker():this._data instanceof T?this._data:new A(this._data)}};for(var N=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],L=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},U=0;U<N.length;U++)D.prototype[N[U]]=L;z.exports=D},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(x,z){x("../modules/web.immediate"),z.exports=x("../modules/_core").setImmediate},{"../modules/_core":40,"../modules/web.immediate":56}],37:[function(x,z){z.exports=function(I){if("function"!=typeof I)throw TypeError(I+" is not a function!");return I}},{}],38:[function(x,z){var I=x("./_is-object");z.exports=function(A){if(!I(A))throw TypeError(A+" is not an object!");return A}},{"./_is-object":51}],39:[function(x,z){var I={}.toString;z.exports=function(A){return I.call(A).slice(8,-1)}},{}],40:[function(x,z){var I=z.exports={version:"2.3.0"};"number"==typeof __e&&(__e=I)},{}],41:[function(x,z){var I=x("./_a-function");z.exports=function(A,B,R){return(I(A),void 0===B)?A:1===R?function(T){return A.call(B,T)}:2===R?function(T,D){return A.call(B,T,D)}:3===R?function(T,D,N){return A.call(B,T,D,N)}:function(){return A.apply(B,arguments)}}},{"./_a-function":37}],42:[function(x,z){z.exports=!x("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":45}],43:[function(x,z){var I=x("./_is-object"),A=x("./_global").document,B=I(A)&&I(A.createElement);z.exports=function(R){return B?A.createElement(R):{}}},{"./_global":46,"./_is-object":51}],44:[function(x,z){var I=x("./_global"),A=x("./_core"),B=x("./_ctx"),R=x("./_hide"),T="prototype",D=function(N,L,U){var W=N&D.F,Z=N&D.G,M=N&D.S,H=N&D.P,G=N&D.B,Y=N&D.W,K=Z?A:A[L]||(A[L]={}),X=K[T],V=Z?I:M?I[L]:(I[L]||{})[T],J,Q,$;for(J in Z&&(U=L),U)Q=!W&&V&&void 0!==V[J],Q&&J in K||($=Q?V[J]:U[J],K[J]=Z&&"function"!=typeof V[J]?U[J]:G&&Q?B($,I):Y&&V[J]==$?function(se){var ie=function(oe,de,le){if(this instanceof se){switch(arguments.length){case 0:return new se;case 1:return new se(oe);case 2:return new se(oe,de);}return new se(oe,de,le)}return se.apply(this,arguments)};return ie[T]=se[T],ie}($):H&&"function"==typeof $?B(Function.call,$):$,H&&((K.virtual||(K.virtual={}))[J]=$,N&D.R&&X&&!X[J]&&R(X,J,$)))};D.F=1,D.G=2,D.S=4,D.P=8,D.B=16,D.W=32,D.U=64,D.R=128,z.exports=D},{"./_core":40,"./_ctx":41,"./_global":46,"./_hide":47}],45:[function(x,z){z.exports=function(I){try{return!!I()}catch(A){return!0}}},{}],46:[function(x,z){var I=z.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=I)},{}],47:[function(x,z){var I=x("./_object-dp"),A=x("./_property-desc");z.exports=x("./_descriptors")?function(B,R,T){return I.f(B,R,A(1,T))}:function(B,R,T){return B[R]=T,B}},{"./_descriptors":42,"./_object-dp":52,"./_property-desc":53}],48:[function(x,z){z.exports=x("./_global").document&&document.documentElement},{"./_global":46}],49:[function(x,z){z.exports=!x("./_descriptors")&&!x("./_fails")(function(){return 7!=Object.defineProperty(x("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":42,"./_dom-create":43,"./_fails":45}],50:[function(x,z){z.exports=function(I,A,B){var R=B===void 0;switch(A.length){case 0:return R?I():I.call(B);case 1:return R?I(A[0]):I.call(B,A[0]);case 2:return R?I(A[0],A[1]):I.call(B,A[0],A[1]);case 3:return R?I(A[0],A[1],A[2]):I.call(B,A[0],A[1],A[2]);case 4:return R?I(A[0],A[1],A[2],A[3]):I.call(B,A[0],A[1],A[2],A[3]);}return I.apply(B,A)}},{}],51:[function(x,z){z.exports=function(I){return"object"==typeof I?null!==I:"function"==typeof I}},{}],52:[function(x,z,E){var I=x("./_an-object"),A=x("./_ie8-dom-define"),B=x("./_to-primitive"),R=Object.defineProperty;E.f=x("./_descriptors")?Object.defineProperty:function(D,N,L){if(I(D),N=B(N,!0),I(L),A)try{return R(D,N,L)}catch(U){}if("get"in L||"set"in L)throw TypeError("Accessors not supported!");return"value"in L&&(D[N]=L.value),D}},{"./_an-object":38,"./_descriptors":42,"./_ie8-dom-define":49,"./_to-primitive":55}],53:[function(x,z){z.exports=function(I,A){return{enumerable:!(1&I),configurable:!(2&I),writable:!(4&I),value:A}}},{}],54:[function(x,z){var I=x("./_ctx"),A=x("./_invoke"),B=x("./_html"),R=x("./_dom-create"),T=x("./_global"),D=T.process,N=T.setImmediate,L=T.clearImmediate,U=T.MessageChannel,W=0,Z={},M="onreadystatechange",H,G,Y,K=function(){var V=+this;if(Z.hasOwnProperty(V)){var J=Z[V];delete Z[V],J()}},X=function(V){K.call(V.data)};N&&L||(N=function(J){for(var Q=[],$=1;arguments.length>$;)Q.push(arguments[$++]);return Z[++W]=function(){A("function"==typeof J?J:Function(J),Q)},H(W),W},L=function(J){delete Z[J]},"process"==x("./_cof")(D)?H=function(V){D.nextTick(I(K,V,1))}:U?(G=new U,Y=G.port2,G.port1.onmessage=X,H=I(Y.postMessage,Y,1)):T.addEventListener&&"function"==typeof postMessage&&!T.importScripts?(H=function(V){T.postMessage(V+"","*")},T.addEventListener("message",X,!1)):M in R("script")?H=function(V){B.appendChild(R("script"))[M]=function(){B.removeChild(this),K.call(V)}}:H=function(V){setTimeout(I(K,V,1),0)}),z.exports={set:N,clear:L}},{"./_cof":39,"./_ctx":41,"./_dom-create":43,"./_global":46,"./_html":48,"./_invoke":50}],55:[function(x,z){var I=x("./_is-object");z.exports=function(A,B){if(!I(A))return A;var R,T;if(B&&"function"==typeof(R=A.toString)&&!I(T=R.call(A)))return T;if("function"==typeof(R=A.valueOf)&&!I(T=R.call(A)))return T;if(!B&&"function"==typeof(R=A.toString)&&!I(T=R.call(A)))return T;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":51}],56:[function(x){var I=x("./_export"),A=x("./_task");I(I.G+I.B,{setImmediate:A.set,clearImmediate:A.clear})},{"./_export":44,"./_task":54}],57:[function(x,z){(function(I){"use strict";function A(){W=!0;for(var G=Z.length,M,H;G;){for(H=Z,Z=[],M=-1;++M<G;)H[M]();G=Z.length}W=!1}var R=I.MutationObserver||I.WebKitMutationObserver,T;if(R){var D=0,N=new R(A),L=I.document.createTextNode("");N.observe(L,{characterData:!0}),T=function(){L.data=D=++D%2}}else if(!I.setImmediate&&"undefined"!=typeof I.MessageChannel){var U=new I.MessageChannel;U.port1.onmessage=A,T=function(){U.port2.postMessage(0)}}else T="document"in I&&"onreadystatechange"in I.document.createElement("script")?function(){var M=I.document.createElement("script");M.onreadystatechange=function(){A(),M.onreadystatechange=null,M.parentNode.removeChild(M),M=null},I.document.documentElement.appendChild(M)}:function(){setTimeout(A,0)};var W,Z=[];z.exports=function(M){1!==Z.push(M)||W||T()}}).call(this,"undefined"==typeof global?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:global)},{}],58:[function(x,z){"use strict";function I(){}function A(X){if("function"!=typeof X)throw new TypeError("resolver must be a function");this.state=K,this.queue=[],this.outcome=void 0,X!==I&&D(this,X)}function B(X,V,J){this.promise=X,"function"==typeof V&&(this.onFulfilled=V,this.callFulfilled=this.otherCallFulfilled),"function"==typeof J&&(this.onRejected=J,this.callRejected=this.otherCallRejected)}function R(X,V,J){M(function(){var Q;try{Q=V(J)}catch($){return H.reject(X,$)}Q===X?H.reject(X,new TypeError("Cannot resolve promise with itself")):H.resolve(X,Q)})}function T(X){var V=X&&X.then;if(X&&("object"==typeof X||"function"==typeof X)&&"function"==typeof V)return function(){V.apply(X,arguments)}}function D(X,V){function J(re){ee||(ee=!0,H.reject(X,re))}function Q(re){ee||(ee=!0,H.resolve(X,re))}var ee=!1,te=N(function(){V(Q,J)});"error"===te.status&&J(te.value)}function N(X,V){var J={};try{J.value=X(V),J.status="success"}catch(Q){J.status="error",J.value=Q}return J}var M=x("immediate"),H={},G=["REJECTED"],Y=["FULFILLED"],K=["PENDING"];z.exports=A,A.prototype["catch"]=function(X){return this.then(null,X)},A.prototype.then=function(X,V){if("function"!=typeof X&&this.state===Y||"function"!=typeof V&&this.state===G)return this;var J=new this.constructor(I);if(this.state!==K){var Q=this.state===Y?X:V;R(J,Q,this.outcome)}else this.queue.push(new B(J,X,V));return J},B.prototype.callFulfilled=function(X){H.resolve(this.promise,X)},B.prototype.otherCallFulfilled=function(X){R(this.promise,this.onFulfilled,X)},B.prototype.callRejected=function(X){H.reject(this.promise,X)},B.prototype.otherCallRejected=function(X){R(this.promise,this.onRejected,X)},H.resolve=function(X,V){var J=N(T,V);if("error"===J.status)return H.reject(X,J.value);var Q=J.value;if(Q)D(X,Q);else{X.state=Y,X.outcome=V;for(var $=-1,ee=X.queue.length;++$<ee;)X.queue[$].callFulfilled(V)}return X},H.reject=function(X,V){X.state=G,X.outcome=V;for(var J=-1,Q=X.queue.length;++J<Q;)X.queue[J].callRejected(V);return X},A.resolve=function(X){return X instanceof this?X:H.resolve(new this(I),X)},A.reject=function(X){var V=new this(I);return H.reject(V,X)},A.all=function(X){function V(ne,se){J.resolve(ne).then(function(oe){ee[se]=oe,++te!==Q||$||($=!0,H.resolve(ae,ee))},function(oe){$||($=!0,H.reject(ae,oe))})}var J=this;if("[object Array]"!==Object.prototype.toString.call(X))return this.reject(new TypeError("must be an array"));var Q=X.length,$=!1;if(!Q)return this.resolve([]);for(var ee=Array(Q),te=0,re=-1,ae=new this(I);++re<Q;)V(X[re],re);return ae},A.race=function(X){function V(re){J.resolve(re).then(function(ae){$||($=!0,H.resolve(te,ae))},function(ae){$||($=!0,H.reject(te,ae))})}var J=this;if("[object Array]"!==Object.prototype.toString.call(X))return this.reject(new TypeError("must be an array"));var Q=X.length,$=!1;if(!Q)return this.resolve([]);for(var ee=-1,te=new this(I);++ee<Q;)V(X[ee]);return te}},{immediate:57}],59:[function(x,z){"use strict";var I=x("./lib/utils/common").assign,A=x("./lib/deflate"),B=x("./lib/inflate"),R=x("./lib/zlib/constants"),T={};I(T,A,B,R),z.exports=T},{"./lib/deflate":60,"./lib/inflate":61,"./lib/utils/common":62,"./lib/zlib/constants":65}],60:[function(x,z,E){"use strict";function I(J){if(!(this instanceof I))return new I(J);this.options=D.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},J||{});var Q=this.options;Q.raw&&0<Q.windowBits?Q.windowBits=-Q.windowBits:Q.gzip&&0<Q.windowBits&&16>Q.windowBits&&(Q.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new U,this.strm.avail_out=0;var $=T.deflateInit2(this.strm,Q.level,Q.method,Q.windowBits,Q.memLevel,Q.strategy);if($!==H)throw new Error(L[$]);if(Q.header&&T.deflateSetHeader(this.strm,Q.header),Q.dictionary){var ee;if(ee="string"==typeof Q.dictionary?N.string2buf(Q.dictionary):"[object ArrayBuffer]"===W.call(Q.dictionary)?new Uint8Array(Q.dictionary):Q.dictionary,$=T.deflateSetDictionary(this.strm,ee),$!==H)throw new Error(L[$]);this._dict_set=!0}}function A(J,Q){var $=new I(Q);if($.push(J,!0),$.err)throw $.msg||L[$.err];return $.result}var T=x("./zlib/deflate"),D=x("./utils/common"),N=x("./utils/strings"),L=x("./zlib/messages"),U=x("./zlib/zstream"),W=Object.prototype.toString,M=4,H=0,G=1,Y=2;I.prototype.push=function(J,Q){var $=this.strm,ee=this.options.chunkSize,te,re;if(this.ended)return!1;re=Q===~~Q?Q:!0===Q?M:0,$.input="string"==typeof J?N.string2buf(J):"[object ArrayBuffer]"===W.call(J)?new Uint8Array(J):J,$.next_in=0,$.avail_in=$.input.length;do{if(0===$.avail_out&&($.output=new D.Buf8(ee),$.next_out=0,$.avail_out=ee),te=T.deflate($,re),te!==G&&te!==H)return this.onEnd(te),this.ended=!0,!1;(0===$.avail_out||0===$.avail_in&&(re===M||re===Y))&&("string"===this.options.to?this.onData(N.buf2binstring(D.shrinkBuf($.output,$.next_out))):this.onData(D.shrinkBuf($.output,$.next_out)))}while((0<$.avail_in||0===$.avail_out)&&te!==G);return re===M?(te=T.deflateEnd(this.strm),this.onEnd(te),this.ended=!0,te===H):re!==Y||(this.onEnd(H),$.avail_out=0,!0)},I.prototype.onData=function(J){this.chunks.push(J)},I.prototype.onEnd=function(J){J===H&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=D.flattenChunks(this.chunks)),this.chunks=[],this.err=J,this.msg=this.strm.msg},E.Deflate=I,E.deflate=A,E.deflateRaw=function(J,Q){return Q=Q||{},Q.raw=!0,A(J,Q)},E.gzip=function(J,Q){return Q=Q||{},Q.gzip=!0,A(J,Q)}},{"./utils/common":62,"./utils/strings":63,"./zlib/deflate":67,"./zlib/messages":72,"./zlib/zstream":74}],61:[function(x,z,E){"use strict";function I(M){if(!(this instanceof I))return new I(M);this.options=T.assign({chunkSize:16384,windowBits:0,to:""},M||{});var H=this.options;H.raw&&0<=H.windowBits&&16>H.windowBits&&(H.windowBits=-H.windowBits,0===H.windowBits&&(H.windowBits=-15)),0<=H.windowBits&&16>H.windowBits&&!(M&&M.windowBits)&&(H.windowBits+=32),15<H.windowBits&&48>H.windowBits&&0==(15&H.windowBits)&&(H.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new U,this.strm.avail_out=0;var G=R.inflateInit2(this.strm,H.windowBits);if(G!==N.Z_OK)throw new Error(L[G]);this.header=new W,R.inflateGetHeader(this.strm,this.header)}function A(M,H){var G=new I(H);if(G.push(M,!0),G.err)throw G.msg||L[G.err];return G.result}var R=x("./zlib/inflate"),T=x("./utils/common"),D=x("./utils/strings"),N=x("./zlib/constants"),L=x("./zlib/messages"),U=x("./zlib/zstream"),W=x("./zlib/gzheader"),Z=Object.prototype.toString;I.prototype.push=function(M,H){var G=this.strm,Y=this.options.chunkSize,K=this.options.dictionary,te=!1,X,V,J,Q,$,ee;if(this.ended)return!1;V=H===~~H?H:!0===H?N.Z_FINISH:N.Z_NO_FLUSH,G.input="string"==typeof M?D.binstring2buf(M):"[object ArrayBuffer]"===Z.call(M)?new Uint8Array(M):M,G.next_in=0,G.avail_in=G.input.length;do{if(0===G.avail_out&&(G.output=new T.Buf8(Y),G.next_out=0,G.avail_out=Y),X=R.inflate(G,N.Z_NO_FLUSH),X===N.Z_NEED_DICT&&K&&(ee="string"==typeof K?D.string2buf(K):"[object ArrayBuffer]"===Z.call(K)?new Uint8Array(K):K,X=R.inflateSetDictionary(this.strm,ee)),X===N.Z_BUF_ERROR&&!0==te&&(X=N.Z_OK,te=!1),X!==N.Z_STREAM_END&&X!==N.Z_OK)return this.onEnd(X),this.ended=!0,!1;G.next_out&&(0===G.avail_out||X===N.Z_STREAM_END||0===G.avail_in&&(V===N.Z_FINISH||V===N.Z_SYNC_FLUSH))&&("string"===this.options.to?(J=D.utf8border(G.output,G.next_out),Q=G.next_out-J,$=D.buf2string(G.output,J),G.next_out=Q,G.avail_out=Y-Q,Q&&T.arraySet(G.output,G.output,J,Q,0),this.onData($)):this.onData(T.shrinkBuf(G.output,G.next_out))),0===G.avail_in&&0===G.avail_out&&(te=!0)}while((0<G.avail_in||0===G.avail_out)&&X!==N.Z_STREAM_END);return X===N.Z_STREAM_END&&(V=N.Z_FINISH),V===N.Z_FINISH?(X=R.inflateEnd(this.strm),this.onEnd(X),this.ended=!0,X===N.Z_OK):V!==N.Z_SYNC_FLUSH||(this.onEnd(N.Z_OK),G.avail_out=0,!0)},I.prototype.onData=function(M){this.chunks.push(M)},I.prototype.onEnd=function(M){M===N.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=T.flattenChunks(this.chunks)),this.chunks=[],this.err=M,this.msg=this.strm.msg},E.Inflate=I,E.inflate=A,E.inflateRaw=function(M,H){return H=H||{},H.raw=!0,A(M,H)},E.ungzip=A},{"./utils/common":62,"./utils/strings":63,"./zlib/constants":65,"./zlib/gzheader":68,"./zlib/inflate":70,"./zlib/messages":72,"./zlib/zstream":74}],62:[function(x,z,E){"use strict";var I="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;E.assign=function(R){for(var T=Array.prototype.slice.call(arguments,1),D;T.length;)if(D=T.shift(),!!D){if("object"!=typeof D)throw new TypeError(D+"must be non-object");for(var N in D)D.hasOwnProperty(N)&&(R[N]=D[N])}return R},E.shrinkBuf=function(R,T){return R.length===T?R:R.subarray?R.subarray(0,T):(R.length=T,R)};var A={arraySet:function(R,T,D,N,L){if(T.subarray&&R.subarray)return void R.set(T.subarray(D,D+N),L);for(var U=0;U<N;U++)R[L+U]=T[D+U]},flattenChunks:function(R){var T,D,N,L,U,W;for(N=0,T=0,D=R.length;T<D;T++)N+=R[T].length;for(W=new Uint8Array(N),L=0,(T=0,D=R.length);T<D;T++)U=R[T],W.set(U,L),L+=U.length;return W}},B={arraySet:function(R,T,D,N,L){for(var U=0;U<N;U++)R[L+U]=T[D+U]},flattenChunks:function(R){return[].concat.apply([],R)}};E.setTyped=function(R){R?(E.Buf8=Uint8Array,E.Buf16=Uint16Array,E.Buf32=Int32Array,E.assign(E,A)):(E.Buf8=Array,E.Buf16=Array,E.Buf32=Array,E.assign(E,B))},E.setTyped(I)},{}],63:[function(x,z,E){"use strict";function I(N,L){if(65537>L&&(N.subarray&&R||!N.subarray&&B))return String.fromCharCode.apply(null,A.shrinkBuf(N,L));for(var U="",W=0;W<L;W++)U+=String.fromCharCode(N[W]);return U}var A=x("./common"),B=!0,R=!0;try{String.fromCharCode.apply(null,[0])}catch(N){B=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(N){R=!1}for(var T=new A.Buf8(256),D=0;256>D;D++)T[D]=252<=D?6:248<=D?5:240<=D?4:224<=D?3:192<=D?2:1;T[254]=T[254]=1,E.string2buf=function(N){var H=N.length,G=0,L,U,W,Z,M;for(Z=0;Z<H;Z++)U=N.charCodeAt(Z),55296==(64512&U)&&Z+1<H&&(W=N.charCodeAt(Z+1),56320==(64512&W)&&(U=65536+(U-55296<<10)+(W-56320),Z++)),G+=128>U?1:2048>U?2:65536>U?3:4;for(L=new A.Buf8(G),M=0,Z=0;M<G;Z++)U=N.charCodeAt(Z),55296==(64512&U)&&Z+1<H&&(W=N.charCodeAt(Z+1),56320==(64512&W)&&(U=65536+(U-55296<<10)+(W-56320),Z++)),128>U?L[M++]=U:2048>U?(L[M++]=192|U>>>6,L[M++]=128|63&U):65536>U?(L[M++]=224|U>>>12,L[M++]=128|63&U>>>6,L[M++]=128|63&U):(L[M++]=240|U>>>18,L[M++]=128|63&U>>>12,L[M++]=128|63&U>>>6,L[M++]=128|63&U);return L},E.buf2binstring=function(N){return I(N,N.length)},E.binstring2buf=function(N){for(var L=new A.Buf8(N.length),U=0,W=L.length;U<W;U++)L[U]=N.charCodeAt(U);return L},E.buf2string=function(N,L){var U,W,Z,M,H=L||N.length,G=Array(2*H);for(W=0,U=0;U<H;){if(Z=N[U++],128>Z){G[W++]=Z;continue}if(M=T[Z],4<M){G[W++]=65533,U+=M-1;continue}for(Z&=2===M?31:3===M?15:7;1<M&&U<H;)Z=Z<<6|63&N[U++],M--;if(1<M){G[W++]=65533;continue}65536>Z?G[W++]=Z:(Z-=65536,G[W++]=55296|1023&Z>>10,G[W++]=56320|1023&Z)}return I(G,W)},E.utf8border=function(N,L){var U;for(L=L||N.length,L>N.length&&(L=N.length),U=L-1;0<=U&&128==(192&N[U]);)U--;return 0>U?L:0===U?L:U+T[N[U]]>L?U:L}},{"./common":62}],64:[function(x,z){"use strict";z.exports=function(A,B,R,T){for(var D=0|65535&A,N=0|65535&A>>>16,L=0;0!==R;){L=2e3<R?2e3:R,R-=L;do D=0|D+B[T++],N=0|N+D;while(--L);D%=65521,N%=65521}return 0|(D|N<<16)}},{}],65:[function(x,z){"use strict";z.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],66:[function(x,z){"use strict";var B=function(){for(var T=[],D=0,R;256>D;D++){R=D;for(var N=0;8>N;N++)R=1&R?3988292384^R>>>1:R>>>1;T[D]=R}return T}();z.exports=function(R,T,D,N){R^=-1;for(var W=N;W<N+D;W++)R=R>>>8^B[255&(R^T[W])];return-1^R}},{}],67:[function(x,z,E){"use strict";function I(rt,at){return rt.msg=le[at],at}function A(rt){return(rt<<1)-(4<rt?9:0)}function B(rt){for(var at=rt.length;0<=--at;)rt[at]=0}function R(rt){var at=rt.state,nt=at.pending;nt>rt.avail_out&&(nt=rt.avail_out);0===nt||(se.arraySet(rt.output,at.pending_buf,at.pending_out,nt,rt.next_out),rt.next_out+=nt,at.pending_out+=nt,rt.total_out+=nt,rt.avail_out-=nt,at.pending-=nt,0===at.pending&&(at.pending_out=0))}function T(rt,at){ie._tr_flush_block(rt,0<=rt.block_start?rt.block_start:-1,rt.strstart-rt.block_start,at),rt.block_start=rt.strstart,R(rt.strm)}function D(rt,at){rt.pending_buf[rt.pending++]=at}function N(rt,at){rt.pending_buf[rt.pending++]=255&at>>>8,rt.pending_buf[rt.pending++]=255&at}function L(rt,at,nt,st){var ot=rt.avail_in;return(ot>st&&(ot=st),0===ot)?0:(rt.avail_in-=ot,se.arraySet(at,rt.input,rt.next_in,ot,nt),1===rt.state.wrap?rt.adler=oe(rt.adler,at,ot,nt):2===rt.state.wrap&&(rt.adler=de(rt.adler,at,ot,nt)),rt.next_in+=ot,rt.total_in+=ot,ot)}function U(rt,at){var nt=rt.max_chain_length,st=rt.strstart,ot,dt,lt=rt.prev_length,ut=rt.nice_match,ct=rt.strstart>rt.w_size-We?rt.strstart-(rt.w_size-We):0,pt=rt.window,ht=rt.w_mask,mt=rt.prev,ft=rt.strstart+Ue,_t=pt[st+lt-1],gt=pt[st+lt];rt.prev_length>=rt.good_match&&(nt>>=2),ut>rt.lookahead&&(ut=rt.lookahead);do{if(ot=at,pt[ot+lt]!==gt||pt[ot+lt-1]!==_t||pt[ot]!==pt[st]||pt[++ot]!==pt[st+1])continue;st+=2,ot++;do;while(pt[++st]===pt[++ot]&&pt[++st]===pt[++ot]&&pt[++st]===pt[++ot]&&pt[++st]===pt[++ot]&&pt[++st]===pt[++ot]&&pt[++st]===pt[++ot]&&pt[++st]===pt[++ot]&&pt[++st]===pt[++ot]&&st<ft);if(dt=Ue-(ft-st),st=ft-Ue,dt>lt){if(rt.match_start=at,lt=dt,dt>=ut)break;_t=pt[st+lt-1],gt=pt[st+lt]}}while((at=mt[at&ht])>ct&&0!=--nt);return lt<=rt.lookahead?lt:rt.lookahead}function W(rt){var at=rt.w_size,nt,st,ot,dt,lt;do{if(dt=rt.window_size-rt.lookahead-rt.strstart,rt.strstart>=at+(at-We)){se.arraySet(rt.window,rt.window,at,at,0),rt.match_start-=at,rt.strstart-=at,rt.block_start-=at,st=rt.hash_size,nt=st;do ot=rt.head[--nt],rt.head[nt]=ot>=at?ot-at:0;while(--st);st=at,nt=st;do ot=rt.prev[--nt],rt.prev[nt]=ot>=at?ot-at:0;while(--st);dt+=at}if(0===rt.strm.avail_in)break;if(st=L(rt.strm,rt.window,rt.strstart+rt.lookahead,dt),rt.lookahead+=st,rt.lookahead+rt.insert>=je)for(lt=rt.strstart-rt.insert,rt.ins_h=rt.window[lt],rt.ins_h=(rt.ins_h<<rt.hash_shift^rt.window[lt+1])&rt.hash_mask;rt.insert&&(rt.ins_h=(rt.ins_h<<rt.hash_shift^rt.window[lt+je-1])&rt.hash_mask,rt.prev[lt&rt.w_mask]=rt.head[rt.ins_h],rt.head[rt.ins_h]=lt,lt++,rt.insert--,!(rt.lookahead+rt.insert<je)););}while(rt.lookahead<We&&0!==rt.strm.avail_in)}function M(rt,at){for(var nt,st;;){if(rt.lookahead<We){if(W(rt),rt.lookahead<We&&at===ue)return Je;if(0===rt.lookahead)break}if(nt=0,rt.lookahead>=je&&(rt.ins_h=(rt.ins_h<<rt.hash_shift^rt.window[rt.strstart+je-1])&rt.hash_mask,nt=rt.prev[rt.strstart&rt.w_mask]=rt.head[rt.ins_h],rt.head[rt.ins_h]=rt.strstart),0!==nt&&rt.strstart-nt<=rt.w_size-We&&(rt.match_length=U(rt,nt)),!(rt.match_length>=je))st=ie._tr_tally(rt,0,rt.window[rt.strstart]),rt.lookahead--,rt.strstart++;else if(st=ie._tr_tally(rt,rt.strstart-rt.match_start,rt.match_length-je),rt.lookahead-=rt.match_length,rt.match_length<=rt.max_lazy_match&&rt.lookahead>=je){rt.match_length--;do rt.strstart++,rt.ins_h=(rt.ins_h<<rt.hash_shift^rt.window[rt.strstart+je-1])&rt.hash_mask,nt=rt.prev[rt.strstart&rt.w_mask]=rt.head[rt.ins_h],rt.head[rt.ins_h]=rt.strstart;while(0!=--rt.match_length);rt.strstart++}else rt.strstart+=rt.match_length,rt.match_length=0,rt.ins_h=rt.window[rt.strstart],rt.ins_h=(rt.ins_h<<rt.hash_shift^rt.window[rt.strstart+1])&rt.hash_mask;if(st&&(T(rt,!1),0===rt.strm.avail_out))return Je}return rt.insert=rt.strstart<je-1?rt.strstart:je-1,at===he?(T(rt,!0),0===rt.strm.avail_out?Qe:$e):rt.last_lit&&(T(rt,!1),0===rt.strm.avail_out)?Je:qe}function H(rt,at){for(var nt,st,ot;;){if(rt.lookahead<We){if(W(rt),rt.lookahead<We&&at===ue)return Je;if(0===rt.lookahead)break}if(nt=0,rt.lookahead>=je&&(rt.ins_h=(rt.ins_h<<rt.hash_shift^rt.window[rt.strstart+je-1])&rt.hash_mask,nt=rt.prev[rt.strstart&rt.w_mask]=rt.head[rt.ins_h],rt.head[rt.ins_h]=rt.strstart),rt.prev_length=rt.match_length,rt.prev_match=rt.match_start,rt.match_length=je-1,0!==nt&&rt.prev_length<rt.max_lazy_match&&rt.strstart-nt<=rt.w_size-We&&(rt.match_length=U(rt,nt),5>=rt.match_length&&(rt.strategy===1||rt.match_length===je&&4096<rt.strstart-rt.match_start)&&(rt.match_length=je-1)),rt.prev_length>=je&&rt.match_length<=rt.prev_length){ot=rt.strstart+rt.lookahead-je,st=ie._tr_tally(rt,rt.strstart-1-rt.prev_match,rt.prev_length-je),rt.lookahead-=rt.prev_length-1,rt.prev_length-=2;do++rt.strstart<=ot&&(rt.ins_h=(rt.ins_h<<rt.hash_shift^rt.window[rt.strstart+je-1])&rt.hash_mask,nt=rt.prev[rt.strstart&rt.w_mask]=rt.head[rt.ins_h],rt.head[rt.ins_h]=rt.strstart);while(0!=--rt.prev_length);if(rt.match_available=0,rt.match_length=je-1,rt.strstart++,st&&(T(rt,!1),0===rt.strm.avail_out))return Je}else if(!rt.match_available)rt.match_available=1,rt.strstart++,rt.lookahead--;else if(st=ie._tr_tally(rt,0,rt.window[rt.strstart-1]),st&&T(rt,!1),rt.strstart++,rt.lookahead--,0===rt.strm.avail_out)return Je}return rt.match_available&&(st=ie._tr_tally(rt,0,rt.window[rt.strstart-1]),rt.match_available=0),rt.insert=rt.strstart<je-1?rt.strstart:je-1,at===he?(T(rt,!0),0===rt.strm.avail_out?Qe:$e):rt.last_lit&&(T(rt,!1),0===rt.strm.avail_out)?Je:qe}function G(rt,at){for(var lt=rt.window,nt,st,ot,dt;;){if(rt.lookahead<=Ue){if(W(rt),rt.lookahead<=Ue&&at===ue)return Je;if(0===rt.lookahead)break}if(rt.match_length=0,rt.lookahead>=je&&0<rt.strstart&&(ot=rt.strstart-1,st=lt[ot],st===lt[++ot]&&st===lt[++ot]&&st===lt[++ot])){dt=rt.strstart+Ue;do;while(st===lt[++ot]&&st===lt[++ot]&&st===lt[++ot]&&st===lt[++ot]&&st===lt[++ot]&&st===lt[++ot]&&st===lt[++ot]&&st===lt[++ot]&&ot<dt);rt.match_length=Ue-(dt-ot),rt.match_length>rt.lookahead&&(rt.match_length=rt.lookahead)}if(rt.match_length>=je?(nt=ie._tr_tally(rt,1,rt.match_length-je),rt.lookahead-=rt.match_length,rt.strstart+=rt.match_length,rt.match_length=0):(nt=ie._tr_tally(rt,0,rt.window[rt.strstart]),rt.lookahead--,rt.strstart++),nt&&(T(rt,!1),0===rt.strm.avail_out))return Je}return rt.insert=0,at===he?(T(rt,!0),0===rt.strm.avail_out?Qe:$e):rt.last_lit&&(T(rt,!1),0===rt.strm.avail_out)?Je:qe}function Y(rt,at){for(var nt;;){if(0===rt.lookahead&&(W(rt),0===rt.lookahead)){if(at===ue)return Je;break}if(rt.match_length=0,nt=ie._tr_tally(rt,0,rt.window[rt.strstart]),rt.lookahead--,rt.strstart++,nt&&(T(rt,!1),0===rt.strm.avail_out))return Je}return rt.insert=0,at===he?(T(rt,!0),0===rt.strm.avail_out?Qe:$e):rt.last_lit&&(T(rt,!1),0===rt.strm.avail_out)?Je:qe}function K(rt,at,nt,st,ot){this.good_length=rt,this.max_lazy=at,this.nice_length=nt,this.max_chain=st,this.func=ot}function X(rt){rt.window_size=2*rt.w_size,B(rt.head),rt.max_lazy_match=tt[rt.level].max_lazy,rt.good_match=tt[rt.level].good_length,rt.nice_match=tt[rt.level].nice_length,rt.max_chain_length=tt[rt.level].max_chain,rt.strstart=0,rt.block_start=0,rt.lookahead=0,rt.insert=0,rt.match_length=rt.prev_length=je-1,rt.match_available=0,rt.ins_h=0}function V(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Ie,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new se.Buf16(2*(2*De+1)),this.dyn_dtree=new se.Buf16(2*(2*30+1)),this.bl_tree=new se.Buf16(2*(2*19+1)),B(this.dyn_ltree),B(this.dyn_dtree),B(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new se.Buf16(15+1),this.heap=new se.Buf16(2*De+1),B(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new se.Buf16(2*De+1),B(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function J(rt){var at;return rt&&rt.state?(rt.total_in=rt.total_out=0,rt.data_type=2,at=rt.state,at.pending=0,at.pending_out=0,0>at.wrap&&(at.wrap=-at.wrap),at.status=at.wrap?Me:Xe,rt.adler=2===at.wrap?0:1,at.last_flush=ue,ie._tr_init(at),_e):I(rt,be)}function Q(rt){var at=J(rt);return at===_e&&X(rt.state),at}function ee(rt,at,nt,st,ot,dt){if(!rt)return be;var lt=1;if(at===-1&&(at=6),0>st?(lt=0,st=-st):15<st&&(lt=2,st-=16),1>ot||ot>9||nt!==Ie||8>st||15<st||0>at||9<at||0>dt||dt>4)return I(rt,be);8===st&&(st=9);var ut=new V;return rt.state=ut,ut.strm=rt,ut.wrap=lt,ut.gzhead=null,ut.w_bits=st,ut.w_size=1<<ut.w_bits,ut.w_mask=ut.w_size-1,ut.hash_bits=ot+7,ut.hash_size=1<<ut.hash_bits,ut.hash_mask=ut.hash_size-1,ut.hash_shift=~~((ut.hash_bits+je-1)/je),ut.window=new se.Buf8(2*ut.w_size),ut.head=new se.Buf16(ut.hash_size),ut.prev=new se.Buf16(ut.w_size),ut.lit_bufsize=1<<ot+6,ut.pending_buf_size=4*ut.lit_bufsize,ut.pending_buf=new se.Buf8(ut.pending_buf_size),ut.d_buf=1*ut.lit_bufsize,ut.l_buf=3*ut.lit_bufsize,ut.level=at,ut.strategy=dt,ut.method=nt,Q(rt)}var se=x("../utils/common"),ie=x("./trees"),oe=x("./adler32"),de=x("./crc32"),le=x("./messages"),ue=0,he=4,fe=5,_e=0,ge=1,be=-2,ke=-5,we=2,Ie=8,De=256+1+29,je=3,Ue=258,We=Ue+je+1,Me=42,He=69,Ge=73,Ye=91,Ke=103,Xe=113,Ve=666,Je=1,qe=2,Qe=3,$e=4,tt;tt=[new K(0,0,0,0,function(rt,at){var nt=65535;for(nt>rt.pending_buf_size-5&&(nt=rt.pending_buf_size-5);;){if(1>=rt.lookahead){if(W(rt),0===rt.lookahead&&at===ue)return Je;if(0===rt.lookahead)break}rt.strstart+=rt.lookahead,rt.lookahead=0;var st=rt.block_start+nt;if((0===rt.strstart||rt.strstart>=st)&&(rt.lookahead=rt.strstart-st,rt.strstart=st,T(rt,!1),0===rt.strm.avail_out))return Je;if(rt.strstart-rt.block_start>=rt.w_size-We&&(T(rt,!1),0===rt.strm.avail_out))return Je}return rt.insert=0,at===he?(T(rt,!0),0===rt.strm.avail_out?Qe:$e):rt.strstart>rt.block_start&&(T(rt,!1),0===rt.strm.avail_out)?Je:Je}),new K(4,4,8,4,M),new K(4,5,16,8,M),new K(4,6,32,32,M),new K(4,4,16,16,H),new K(8,16,32,32,H),new K(8,16,128,128,H),new K(8,32,128,256,H),new K(32,128,258,1024,H),new K(32,258,258,4096,H)],E.deflateInit=function(rt,at){return ee(rt,at,Ie,15,8,0)},E.deflateInit2=ee,E.deflateReset=Q,E.deflateResetKeep=J,E.deflateSetHeader=function(rt,at){return rt&&rt.state?2===rt.state.wrap?(rt.state.gzhead=at,_e):be:be},E.deflate=function(rt,at){var nt,st,ot,dt;if(!rt||!rt.state||at>fe||0>at)return rt?I(rt,be):be;if(st=rt.state,!rt.output||!rt.input&&0!==rt.avail_in||st.status===Ve&&at!==he)return I(rt,0===rt.avail_out?ke:be);if(st.strm=rt,nt=st.last_flush,st.last_flush=at,st.status===Me)if(2===st.wrap)rt.adler=0,D(st,31),D(st,139),D(st,8),st.gzhead?(D(st,(st.gzhead.text?1:0)+(st.gzhead.hcrc?2:0)+(st.gzhead.extra?4:0)+(st.gzhead.name?8:0)+(st.gzhead.comment?16:0)),D(st,255&st.gzhead.time),D(st,255&st.gzhead.time>>8),D(st,255&st.gzhead.time>>16),D(st,255&st.gzhead.time>>24),D(st,9===st.level?2:st.strategy>=we||2>st.level?4:0),D(st,255&st.gzhead.os),st.gzhead.extra&&st.gzhead.extra.length&&(D(st,255&st.gzhead.extra.length),D(st,255&st.gzhead.extra.length>>8)),st.gzhead.hcrc&&(rt.adler=de(rt.adler,st.pending_buf,st.pending,0)),st.gzindex=0,st.status=He):(D(st,0),D(st,0),D(st,0),D(st,0),D(st,0),D(st,9===st.level?2:st.strategy>=we||2>st.level?4:0),D(st,3),st.status=Xe);else{var lt=Ie+(st.w_bits-8<<4)<<8,ut=-1;ut=st.strategy>=we||2>st.level?0:6>st.level?1:6===st.level?2:3,lt|=ut<<6,0!==st.strstart&&(lt|=32),lt+=31-lt%31,st.status=Xe,N(st,lt),0!==st.strstart&&(N(st,rt.adler>>>16),N(st,65535&rt.adler)),rt.adler=1}if(st.status===He)if(st.gzhead.extra){for(ot=st.pending;st.gzindex<(65535&st.gzhead.extra.length)&&!(st.pending===st.pending_buf_size&&(st.gzhead.hcrc&&st.pending>ot&&(rt.adler=de(rt.adler,st.pending_buf,st.pending-ot,ot)),R(rt),ot=st.pending,st.pending===st.pending_buf_size));)D(st,255&st.gzhead.extra[st.gzindex]),st.gzindex++;st.gzhead.hcrc&&st.pending>ot&&(rt.adler=de(rt.adler,st.pending_buf,st.pending-ot,ot)),st.gzindex===st.gzhead.extra.length&&(st.gzindex=0,st.status=Ge)}else st.status=Ge;if(st.status===Ge)if(st.gzhead.name){ot=st.pending;do{if(st.pending===st.pending_buf_size&&(st.gzhead.hcrc&&st.pending>ot&&(rt.adler=de(rt.adler,st.pending_buf,st.pending-ot,ot)),R(rt),ot=st.pending,st.pending===st.pending_buf_size)){dt=1;break}dt=st.gzindex<st.gzhead.name.length?255&st.gzhead.name.charCodeAt(st.gzindex++):0,D(st,dt)}while(0!==dt);st.gzhead.hcrc&&st.pending>ot&&(rt.adler=de(rt.adler,st.pending_buf,st.pending-ot,ot)),0===dt&&(st.gzindex=0,st.status=Ye)}else st.status=Ye;if(st.status===Ye)if(st.gzhead.comment){ot=st.pending;do{if(st.pending===st.pending_buf_size&&(st.gzhead.hcrc&&st.pending>ot&&(rt.adler=de(rt.adler,st.pending_buf,st.pending-ot,ot)),R(rt),ot=st.pending,st.pending===st.pending_buf_size)){dt=1;break}dt=st.gzindex<st.gzhead.comment.length?255&st.gzhead.comment.charCodeAt(st.gzindex++):0,D(st,dt)}while(0!==dt);st.gzhead.hcrc&&st.pending>ot&&(rt.adler=de(rt.adler,st.pending_buf,st.pending-ot,ot)),0===dt&&(st.status=Ke)}else st.status=Ke;if(st.status===Ke&&(st.gzhead.hcrc?(st.pending+2>st.pending_buf_size&&R(rt),st.pending+2<=st.pending_buf_size&&(D(st,255&rt.adler),D(st,255&rt.adler>>8),rt.adler=0,st.status=Xe)):st.status=Xe),0!==st.pending){if(R(rt),0===rt.avail_out)return st.last_flush=-1,_e;}else if(0===rt.avail_in&&A(at)<=A(nt)&&at!==he)return I(rt,ke);if(st.status===Ve&&0!==rt.avail_in)return I(rt,ke);if(0!==rt.avail_in||0!==st.lookahead||at!==ue&&st.status!==Ve){var ct=st.strategy===we?Y(st,at):st.strategy===3?G(st,at):tt[st.level].func(st,at);if((ct===Qe||ct===$e)&&(st.status=Ve),ct===Je||ct===Qe)return 0===rt.avail_out&&(st.last_flush=-1),_e;if(ct===qe&&(at===1?ie._tr_align(st):at!==fe&&(ie._tr_stored_block(st,0,0,!1),at===3&&(B(st.head),0===st.lookahead&&(st.strstart=0,st.block_start=0,st.insert=0))),R(rt),0===rt.avail_out))return st.last_flush=-1,_e}return at===he?0>=st.wrap?ge:(2===st.wrap?(D(st,255&rt.adler),D(st,255&rt.adler>>8),D(st,255&rt.adler>>16),D(st,255&rt.adler>>24),D(st,255&rt.total_in),D(st,255&rt.total_in>>8),D(st,255&rt.total_in>>16),D(st,255&rt.total_in>>24)):(N(st,rt.adler>>>16),N(st,65535&rt.adler)),R(rt),0<st.wrap&&(st.wrap=-st.wrap),0===st.pending?ge:_e):_e},E.deflateEnd=function(rt){var at;return rt&&rt.state?(at=rt.state.status,at!==Me&&at!==He&&at!==Ge&&at!==Ye&&at!==Ke&&at!==Xe&&at!==Ve)?I(rt,be):(rt.state=null,at===Xe?I(rt,-3):_e):be},E.deflateSetDictionary=function(rt,at){var nt=at.length,st,ot,dt,lt,ut,ct,pt,ht;if(!rt||!rt.state)return be;if(st=rt.state,lt=st.wrap,2===lt||1===lt&&st.status!==Me||st.lookahead)return be;for(1===lt&&(rt.adler=oe(rt.adler,at,nt,0)),st.wrap=0,nt>=st.w_size&&(0===lt&&(B(st.head),st.strstart=0,st.block_start=0,st.insert=0),ht=new se.Buf8(st.w_size),se.arraySet(ht,at,nt-st.w_size,st.w_size,0),at=ht,nt=st.w_size),ut=rt.avail_in,ct=rt.next_in,pt=rt.input,rt.avail_in=nt,rt.next_in=0,rt.input=at,W(st);st.lookahead>=je;){ot=st.strstart,dt=st.lookahead-(je-1);do st.ins_h=(st.ins_h<<st.hash_shift^st.window[ot+je-1])&st.hash_mask,st.prev[ot&st.w_mask]=st.head[st.ins_h],st.head[st.ins_h]=ot,ot++;while(--dt);st.strstart=ot,st.lookahead=je-1,W(st)}return st.strstart+=st.lookahead,st.block_start=st.strstart,st.insert=st.lookahead,st.lookahead=0,st.match_length=st.prev_length=je-1,st.match_available=0,rt.next_in=ct,rt.input=pt,rt.avail_in=ut,st.wrap=lt,_e},E.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./messages":72,"./trees":73}],68:[function(x,z){"use strict";z.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],69:[function(x,z){"use strict";var I=30;z.exports=function(R,T){var D,N,L,U,W,Z,M,H,G,Y,K,X,V,J,Q,$,ee,te,re,ae,ne,se,ie,oe,de;D=R.state,N=R.next_in,oe=R.input,L=N+(R.avail_in-5),U=R.next_out,de=R.output,W=U-(T-R.avail_out),Z=U+(R.avail_out-257),M=D.dmax,H=D.wsize,G=D.whave,Y=D.wnext,K=D.window,X=D.hold,V=D.bits,J=D.lencode,Q=D.distcode,$=(1<<D.lenbits)-1,ee=(1<<D.distbits)-1;top:do{15>V&&(X+=oe[N++]<<V,V+=8,X+=oe[N++]<<V,V+=8),te=J[X&$];dolen:for(;;){if(re=te>>>24,X>>>=re,V-=re,re=255&te>>>16,0===re)de[U++]=65535&te;else if(16&re){ae=65535&te,re&=15,re&&(V<re&&(X+=oe[N++]<<V,V+=8),ae+=X&(1<<re)-1,X>>>=re,V-=re),15>V&&(X+=oe[N++]<<V,V+=8,X+=oe[N++]<<V,V+=8),te=Q[X&ee];dodist:for(;;){if(re=te>>>24,X>>>=re,V-=re,re=255&te>>>16,16&re){if(ne=65535&te,re&=15,V<re&&(X+=oe[N++]<<V,V+=8,V<re&&(X+=oe[N++]<<V,V+=8)),ne+=X&(1<<re)-1,ne>M){R.msg="invalid distance too far back",D.mode=I;break top}if(X>>>=re,V-=re,re=U-W,ne>re){if(re=ne-re,re>G&&D.sane){R.msg="invalid distance too far back",D.mode=I;break top}if(se=0,ie=K,0===Y){if(se+=H-re,re<ae){ae-=re;do de[U++]=K[se++];while(--re);se=U-ne,ie=de}}else if(Y<re){if(se+=H+Y-re,re-=Y,re<ae){ae-=re;do de[U++]=K[se++];while(--re);if(se=0,Y<ae){re=Y,ae-=re;do de[U++]=K[se++];while(--re);se=U-ne,ie=de}}}else if(se+=Y-re,re<ae){ae-=re;do de[U++]=K[se++];while(--re);se=U-ne,ie=de}for(;2<ae;)de[U++]=ie[se++],de[U++]=ie[se++],de[U++]=ie[se++],ae-=3;ae&&(de[U++]=ie[se++],1<ae&&(de[U++]=ie[se++]))}else{se=U-ne;do de[U++]=de[se++],de[U++]=de[se++],de[U++]=de[se++],ae-=3;while(2<ae);ae&&(de[U++]=de[se++],1<ae&&(de[U++]=de[se++]))}}else if(0==(64&re)){te=Q[(65535&te)+(X&(1<<re)-1)];continue dodist}else{R.msg="invalid distance code",D.mode=I;break top}break}}else if(0==(64&re)){te=J[(65535&te)+(X&(1<<re)-1)];continue dolen}else if(32&re){D.mode=12;break top}else{R.msg="invalid literal/length code",D.mode=I;break top}break}}while(N<L&&U<Z);return ae=V>>3,N-=ae,V-=ae<<3,X&=(1<<V)-1,R.next_in=N,R.next_out=U,R.avail_in=N<L?5+(L-N):5-(N-L),R.avail_out=U<Z?257+(Z-U):257-(U-Z),D.hold=X,void(D.bits=V)}},{}],70:[function(x,z,E){"use strict";function I(qe){return(255&qe>>>24)+(65280&qe>>>8)+((65280&qe)<<8)+((255&qe)<<24)}function A(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new G.Buf16(320),this.work=new G.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function B(qe){var Qe;return qe&&qe.state?(Qe=qe.state,qe.total_in=qe.total_out=Qe.total=0,qe.msg="",Qe.wrap&&(qe.adler=1&Qe.wrap),Qe.mode=ce,Qe.last=0,Qe.havedict=0,Qe.dmax=32768,Qe.head=null,Qe.hold=0,Qe.bits=0,Qe.lencode=Qe.lendyn=new G.Buf32(852),Qe.distcode=Qe.distdyn=new G.Buf32(592),Qe.sane=1,Qe.back=-1,ae):ie}function R(qe){var Qe;return qe&&qe.state?(Qe=qe.state,Qe.wsize=0,Qe.whave=0,Qe.wnext=0,B(qe)):ie}function T(qe,Qe){var $e,et;return qe&&qe.state?(et=qe.state,0>Qe?($e=0,Qe=-Qe):($e=(Qe>>4)+1,48>Qe&&(Qe&=15)),Qe&&(8>Qe||15<Qe))?ie:(null!==et.window&&et.wbits!==Qe&&(et.window=null),et.wrap=$e,et.wbits=Qe,R(qe)):ie}function D(qe,Qe){var $e,et;return qe?(et=new A,qe.state=et,et.window=null,$e=T(qe,Qe),$e!==ae&&(qe.state=null),$e):ie}function L(qe){if(Xe){var Qe;for(Ve=new G.Buf32(512),Je=new G.Buf32(32),Qe=0;144>Qe;)qe.lens[Qe++]=8;for(;256>Qe;)qe.lens[Qe++]=9;for(;280>Qe;)qe.lens[Qe++]=7;for(;288>Qe;)qe.lens[Qe++]=8;for(V(Q,qe.lens,0,288,Ve,0,qe.work,{bits:9}),Qe=0;32>Qe;)qe.lens[Qe++]=5;V($,qe.lens,0,32,Je,0,qe.work,{bits:5}),Xe=!1}qe.lencode=Ve,qe.lenbits=9,qe.distcode=Je,qe.distbits=5}function U(qe,Qe,$e,et){var rt=qe.state,tt;return null===rt.window&&(rt.wsize=1<<rt.wbits,rt.wnext=0,rt.whave=0,rt.window=new G.Buf8(rt.wsize)),et>=rt.wsize?(G.arraySet(rt.window,Qe,$e-rt.wsize,rt.wsize,0),rt.wnext=0,rt.whave=rt.wsize):(tt=rt.wsize-rt.wnext,tt>et&&(tt=et),G.arraySet(rt.window,Qe,$e-et,tt,rt.wnext),et-=tt,et?(G.arraySet(rt.window,Qe,$e-et,et,0),rt.wnext=et,rt.whave=rt.wsize):(rt.wnext+=tt,rt.wnext===rt.wsize&&(rt.wnext=0),rt.whave<rt.wsize&&(rt.whave+=tt))),0}var G=x("../utils/common"),Y=x("./adler32"),K=x("./crc32"),X=x("./inffast"),V=x("./inftrees"),Q=1,$=2,ee=4,re=6,ae=0,ie=-2,oe=-3,de=-4,ue=8,ce=1,pe=2,he=3,fe=4,_e=5,ge=6,be=7,ye=8,ke=9,xe=10,ve=11,we=12,Se=13,ze=14,Ce=15,Ee=16,Ie=17,Oe=18,Ae=19,Be=20,Re=21,Te=22,De=23,Fe=24,Pe=25,Ne=26,Le=27,je=28,Ue=29,We=30,Ze=31,Xe=!0,Ve,Je;E.inflateReset=R,E.inflateReset2=T,E.inflateResetKeep=B,E.inflateInit=function(qe){return D(qe,15)},E.inflateInit2=D,E.inflate=function(qe,Qe){var mt=0,wt=new G.Buf8(4),Ct=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],$e,et,tt,rt,at,nt,st,ot,dt,lt,ut,ct,pt,ht,ft,_t,gt,bt,yt,kt,xt,vt,St,zt;if(!qe||!qe.state||!qe.output||!qe.input&&0!==qe.avail_in)return ie;$e=qe.state,$e.mode===we&&($e.mode=Se),at=qe.next_out,tt=qe.output,st=qe.avail_out,rt=qe.next_in,et=qe.input,nt=qe.avail_in,ot=$e.hold,dt=$e.bits,lt=nt,ut=st,vt=ae;inf_leave:for(;;)switch($e.mode){case ce:if(0===$e.wrap){$e.mode=Se;break}for(;16>dt;){if(0===nt)break inf_leave;nt--,ot+=et[rt++]<<dt,dt+=8}if(2&$e.wrap&&35615===ot){$e.check=0,wt[0]=255&ot,wt[1]=255&ot>>>8,$e.check=K($e.check,wt,2,0),ot=0,dt=0,$e.mode=pe;break}if($e.flags=0,$e.head&&($e.head.done=!1),!(1&$e.wrap)||(((255&ot)<<8)+(ot>>8))%31){qe.msg="incorrect header check",$e.mode=We;break}if((15&ot)!==ue){qe.msg="unknown compression method",$e.mode=We;break}if(ot>>>=4,dt-=4,xt=(15&ot)+8,0===$e.wbits)$e.wbits=xt;else if(xt>$e.wbits){qe.msg="invalid window size",$e.mode=We;break}$e.dmax=1<<xt,qe.adler=$e.check=1,$e.mode=512&ot?xe:we,ot=0,dt=0;break;case pe:for(;16>dt;){if(0===nt)break inf_leave;nt--,ot+=et[rt++]<<dt,dt+=8}if($e.flags=ot,(255&$e.flags)!==ue){qe.msg="unknown compression method",$e.mode=We;break}if(57344&$e.flags){qe.msg="unknown header flags set",$e.mode=We;break}$e.head&&($e.head.text=1&ot>>8),512&$e.flags&&(wt[0]=255&ot,wt[1]=255&ot>>>8,$e.check=K($e.check,wt,2,0)),ot=0,dt=0,$e.mode=he;case he:for(;32>dt;){if(0===nt)break inf_leave;nt--,ot+=et[rt++]<<dt,dt+=8}$e.head&&($e.head.time=ot),512&$e.flags&&(wt[0]=255&ot,wt[1]=255&ot>>>8,wt[2]=255&ot>>>16,wt[3]=255&ot>>>24,$e.check=K($e.check,wt,4,0)),ot=0,dt=0,$e.mode=fe;case fe:for(;16>dt;){if(0===nt)break inf_leave;nt--,ot+=et[rt++]<<dt,dt+=8}$e.head&&($e.head.xflags=255&ot,$e.head.os=ot>>8),512&$e.flags&&(wt[0]=255&ot,wt[1]=255&ot>>>8,$e.check=K($e.check,wt,2,0)),ot=0,dt=0,$e.mode=_e;case _e:if(1024&$e.flags){for(;16>dt;){if(0===nt)break inf_leave;nt--,ot+=et[rt++]<<dt,dt+=8}$e.length=ot,$e.head&&($e.head.extra_len=ot),512&$e.flags&&(wt[0]=255&ot,wt[1]=255&ot>>>8,$e.check=K($e.check,wt,2,0)),ot=0,dt=0}else $e.head&&($e.head.extra=null);$e.mode=ge;case ge:if(1024&$e.flags&&(ct=$e.length,ct>nt&&(ct=nt),ct&&($e.head&&(xt=$e.head.extra_len-$e.length,!$e.head.extra&&($e.head.extra=Array($e.head.extra_len)),G.arraySet($e.head.extra,et,rt,ct,xt)),512&$e.flags&&($e.check=K($e.check,et,ct,rt)),nt-=ct,rt+=ct,$e.length-=ct),$e.length))break inf_leave;$e.length=0,$e.mode=be;case be:if(2048&$e.flags){if(0===nt)break inf_leave;ct=0;do xt=et[rt+ct++],$e.head&&xt&&65536>$e.length&&($e.head.name+=String.fromCharCode(xt));while(xt&&ct<nt);if(512&$e.flags&&($e.check=K($e.check,et,ct,rt)),nt-=ct,rt+=ct,xt)break inf_leave}else $e.head&&($e.head.name=null);$e.length=0,$e.mode=ye;case ye:if(4096&$e.flags){if(0===nt)break inf_leave;ct=0;do xt=et[rt+ct++],$e.head&&xt&&65536>$e.length&&($e.head.comment+=String.fromCharCode(xt));while(xt&&ct<nt);if(512&$e.flags&&($e.check=K($e.check,et,ct,rt)),nt-=ct,rt+=ct,xt)break inf_leave}else $e.head&&($e.head.comment=null);$e.mode=ke;case ke:if(512&$e.flags){for(;16>dt;){if(0===nt)break inf_leave;nt--,ot+=et[rt++]<<dt,dt+=8}if(ot!==(65535&$e.check)){qe.msg="header crc mismatch",$e.mode=We;break}ot=0,dt=0}$e.head&&($e.head.hcrc=1&$e.flags>>9,$e.head.done=!0),qe.adler=$e.check=0,$e.mode=we;break;case xe:for(;32>dt;){if(0===nt)break inf_leave;nt--,ot+=et[rt++]<<dt,dt+=8}qe.adler=$e.check=I(ot),ot=0,dt=0,$e.mode=ve;case ve:if(0===$e.havedict)return qe.next_out=at,qe.avail_out=st,qe.next_in=rt,qe.avail_in=nt,$e.hold=ot,$e.bits=dt,2;qe.adler=$e.check=1,$e.mode=we;case we:if(Qe===5||Qe===re)break inf_leave;case Se:if($e.last){ot>>>=7&dt,dt-=7&dt,$e.mode=Le;break}for(;3>dt;){if(0===nt)break inf_leave;nt--,ot+=et[rt++]<<dt,dt+=8}switch($e.last=1&ot,ot>>>=1,dt-=1,3&ot){case 0:$e.mode=ze;break;case 1:if(L($e),$e.mode=Be,Qe===re){ot>>>=2,dt-=2;break inf_leave}break;case 2:$e.mode=Ie;break;case 3:qe.msg="invalid block type",$e.mode=We;}ot>>>=2,dt-=2;break;case ze:for(ot>>>=7&dt,dt-=7&dt;32>dt;){if(0===nt)break inf_leave;nt--,ot+=et[rt++]<<dt,dt+=8}if((65535&ot)!=(65535^ot>>>16)){qe.msg="invalid stored block lengths",$e.mode=We;break}if($e.length=65535&ot,ot=0,dt=0,$e.mode=Ce,Qe===re)break inf_leave;case Ce:$e.mode=Ee;case Ee:if(ct=$e.length,ct){if(ct>nt&&(ct=nt),ct>st&&(ct=st),0===ct)break inf_leave;G.arraySet(tt,et,rt,ct,at),nt-=ct,rt+=ct,st-=ct,at+=ct,$e.length-=ct;break}$e.mode=we;break;case Ie:for(;14>dt;){if(0===nt)break inf_leave;nt--,ot+=et[rt++]<<dt,dt+=8}if($e.nlen=(31&ot)+257,ot>>>=5,dt-=5,$e.ndist=(31&ot)+1,ot>>>=5,dt-=5,$e.ncode=(15&ot)+4,ot>>>=4,dt-=4,286<$e.nlen||30<$e.ndist){qe.msg="too many length or distance symbols",$e.mode=We;break}$e.have=0,$e.mode=Oe;case Oe:for(;$e.have<$e.ncode;){for(;3>dt;){if(0===nt)break inf_leave;nt--,ot+=et[rt++]<<dt,dt+=8}$e.lens[Ct[$e.have++]]=7&ot,ot>>>=3,dt-=3}for(;19>$e.have;)$e.lens[Ct[$e.have++]]=0;if($e.lencode=$e.lendyn,$e.lenbits=7,St={bits:$e.lenbits},vt=V(0,$e.lens,0,19,$e.lencode,0,$e.work,St),$e.lenbits=St.bits,vt){qe.msg="invalid code lengths set",$e.mode=We;break}$e.have=0,$e.mode=Ae;case Ae:for(;$e.have<$e.nlen+$e.ndist;){for(;;){if(mt=$e.lencode[ot&(1<<$e.lenbits)-1],ft=mt>>>24,_t=255&mt>>>16,gt=65535&mt,ft<=dt)break;if(0===nt)break inf_leave;nt--,ot+=et[rt++]<<dt,dt+=8}if(16>gt)ot>>>=ft,dt-=ft,$e.lens[$e.have++]=gt;else{if(16===gt){for(zt=ft+2;dt<zt;){if(0===nt)break inf_leave;nt--,ot+=et[rt++]<<dt,dt+=8}if(ot>>>=ft,dt-=ft,0===$e.have){qe.msg="invalid bit length repeat",$e.mode=We;break}xt=$e.lens[$e.have-1],ct=3+(3&ot),ot>>>=2,dt-=2}else if(17===gt){for(zt=ft+3;dt<zt;){if(0===nt)break inf_leave;nt--,ot+=et[rt++]<<dt,dt+=8}ot>>>=ft,dt-=ft,xt=0,ct=3+(7&ot),ot>>>=3,dt-=3}else{for(zt=ft+7;dt<zt;){if(0===nt)break inf_leave;nt--,ot+=et[rt++]<<dt,dt+=8}ot>>>=ft,dt-=ft,xt=0,ct=11+(127&ot),ot>>>=7,dt-=7}if($e.have+ct>$e.nlen+$e.ndist){qe.msg="invalid bit length repeat",$e.mode=We;break}for(;ct--;)$e.lens[$e.have++]=xt}}if($e.mode===We)break;if(0===$e.lens[256]){qe.msg="invalid code -- missing end-of-block",$e.mode=We;break}if($e.lenbits=9,St={bits:$e.lenbits},vt=V(Q,$e.lens,0,$e.nlen,$e.lencode,0,$e.work,St),$e.lenbits=St.bits,vt){qe.msg="invalid literal/lengths set",$e.mode=We;break}if($e.distbits=6,$e.distcode=$e.distdyn,St={bits:$e.distbits},vt=V($,$e.lens,$e.nlen,$e.ndist,$e.distcode,0,$e.work,St),$e.distbits=St.bits,vt){qe.msg="invalid distances set",$e.mode=We;break}if($e.mode=Be,Qe===re)break inf_leave;case Be:$e.mode=Re;case Re:if(6<=nt&&258<=st){qe.next_out=at,qe.avail_out=st,qe.next_in=rt,qe.avail_in=nt,$e.hold=ot,$e.bits=dt,X(qe,ut),at=qe.next_out,tt=qe.output,st=qe.avail_out,rt=qe.next_in,et=qe.input,nt=qe.avail_in,ot=$e.hold,dt=$e.bits,$e.mode===we&&($e.back=-1);break}for($e.back=0;;){if(mt=$e.lencode[ot&(1<<$e.lenbits)-1],ft=mt>>>24,_t=255&mt>>>16,gt=65535&mt,ft<=dt)break;if(0===nt)break inf_leave;nt--,ot+=et[rt++]<<dt,dt+=8}if(_t&&0==(240&_t)){for(bt=ft,yt=_t,kt=gt;;){if(mt=$e.lencode[kt+((ot&(1<<bt+yt)-1)>>bt)],ft=mt>>>24,_t=255&mt>>>16,gt=65535&mt,bt+ft<=dt)break;if(0===nt)break inf_leave;nt--,ot+=et[rt++]<<dt,dt+=8}ot>>>=bt,dt-=bt,$e.back+=bt}if(ot>>>=ft,dt-=ft,$e.back+=ft,$e.length=gt,0===_t){$e.mode=Ne;break}if(32&_t){$e.back=-1,$e.mode=we;break}if(64&_t){qe.msg="invalid literal/length code",$e.mode=We;break}$e.extra=15&_t,$e.mode=Te;case Te:if($e.extra){for(zt=$e.extra;dt<zt;){if(0===nt)break inf_leave;nt--,ot+=et[rt++]<<dt,dt+=8}$e.length+=ot&(1<<$e.extra)-1,ot>>>=$e.extra,dt-=$e.extra,$e.back+=$e.extra}$e.was=$e.length,$e.mode=De;case De:for(;;){if(mt=$e.distcode[ot&(1<<$e.distbits)-1],ft=mt>>>24,_t=255&mt>>>16,gt=65535&mt,ft<=dt)break;if(0===nt)break inf_leave;nt--,ot+=et[rt++]<<dt,dt+=8}if(0==(240&_t)){for(bt=ft,yt=_t,kt=gt;;){if(mt=$e.distcode[kt+((ot&(1<<bt+yt)-1)>>bt)],ft=mt>>>24,_t=255&mt>>>16,gt=65535&mt,bt+ft<=dt)break;if(0===nt)break inf_leave;nt--,ot+=et[rt++]<<dt,dt+=8}ot>>>=bt,dt-=bt,$e.back+=bt}if(ot>>>=ft,dt-=ft,$e.back+=ft,64&_t){qe.msg="invalid distance code",$e.mode=We;break}$e.offset=gt,$e.extra=15&_t,$e.mode=Fe;case Fe:if($e.extra){for(zt=$e.extra;dt<zt;){if(0===nt)break inf_leave;nt--,ot+=et[rt++]<<dt,dt+=8}$e.offset+=ot&(1<<$e.extra)-1,ot>>>=$e.extra,dt-=$e.extra,$e.back+=$e.extra}if($e.offset>$e.dmax){qe.msg="invalid distance too far back",$e.mode=We;break}$e.mode=Pe;case Pe:if(0===st)break inf_leave;if(ct=ut-st,$e.offset>ct){if(ct=$e.offset-ct,ct>$e.whave&&$e.sane){qe.msg="invalid distance too far back",$e.mode=We;break}ct>$e.wnext?(ct-=$e.wnext,pt=$e.wsize-ct):pt=$e.wnext-ct,ct>$e.length&&(ct=$e.length),ht=$e.window}else ht=tt,pt=at-$e.offset,ct=$e.length;ct>st&&(ct=st),st-=ct,$e.length-=ct;do tt[at++]=ht[pt++];while(--ct);0===$e.length&&($e.mode=Re);break;case Ne:if(0===st)break inf_leave;tt[at++]=$e.length,st--,$e.mode=Re;break;case Le:if($e.wrap){for(;32>dt;){if(0===nt)break inf_leave;nt--,ot|=et[rt++]<<dt,dt+=8}if(ut-=st,qe.total_out+=ut,$e.total+=ut,ut&&(qe.adler=$e.check=$e.flags?K($e.check,tt,ut,at-ut):Y($e.check,tt,ut,at-ut)),ut=st,($e.flags?ot:I(ot))!==$e.check){qe.msg="incorrect data check",$e.mode=We;break}ot=0,dt=0}$e.mode=je;case je:if($e.wrap&&$e.flags){for(;32>dt;){if(0===nt)break inf_leave;nt--,ot+=et[rt++]<<dt,dt+=8}if(ot!==(4294967295&$e.total)){qe.msg="incorrect length check",$e.mode=We;break}ot=0,dt=0}$e.mode=Ue;case Ue:vt=1;break inf_leave;case We:vt=oe;break inf_leave;case Ze:return de;case 32:default:return ie;}return(qe.next_out=at,qe.avail_out=st,qe.next_in=rt,qe.avail_in=nt,$e.hold=ot,$e.bits=dt,($e.wsize||ut!==qe.avail_out&&$e.mode<We&&($e.mode<Le||Qe!==ee))&&U(qe,qe.output,qe.next_out,ut-qe.avail_out))?($e.mode=Ze,de):(lt-=qe.avail_in,ut-=qe.avail_out,qe.total_in+=lt,qe.total_out+=ut,$e.total+=ut,$e.wrap&&ut&&(qe.adler=$e.check=$e.flags?K($e.check,tt,ut,qe.next_out-ut):Y($e.check,tt,ut,qe.next_out-ut)),qe.data_type=$e.bits+($e.last?64:0)+($e.mode===we?128:0)+($e.mode===Be||$e.mode===Ce?256:0),(0===lt&&0===ut||Qe===ee)&&vt===ae&&(vt=-5),vt)},E.inflateEnd=function(qe){if(!qe||!qe.state)return ie;var Qe=qe.state;return Qe.window&&(Qe.window=null),qe.state=null,ae},E.inflateGetHeader=function(qe,Qe){var $e;return qe&&qe.state?($e=qe.state,0==(2&$e.wrap))?ie:($e.head=Qe,Qe.done=!1,ae):ie},E.inflateSetDictionary=function(qe,Qe){var $e=Qe.length,et,tt,rt;return qe&&qe.state?(et=qe.state,0!==et.wrap&&et.mode!==ve)?ie:et.mode===ve&&(tt=1,tt=Y(tt,Qe,$e,0),tt!==et.check)?oe:(rt=U(qe,Qe,$e,$e),rt)?(et.mode=Ze,de):(et.havedict=1,ae):ie},E.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./inffast":69,"./inftrees":71}],71:[function(x,z){"use strict";var I=x("../utils/common"),A=15,B=852,R=592,T=0,D=1,N=2,L=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],U=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],W=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Z=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];z.exports=function(H,G,Y,K,X,V,J,Q){var $=Q.bits,ee=0,te=0,re=0,ae=0,ne=0,se=0,ie=0,oe=0,de=0,le=0,_e=null,ge=0,ye=new I.Buf16(A+1),ke=new I.Buf16(A+1),xe=null,ve=0,ue,ce,pe,he,fe,be,we,Se,ze;for(ee=0;ee<=A;ee++)ye[ee]=0;for(te=0;te<K;te++)ye[G[Y+te]]++;for(ne=$,ae=A;1<=ae&&0===ye[ae];ae--);if(ne>ae&&(ne=ae),0==ae)return X[V++]=20971520,X[V++]=20971520,Q.bits=1,0;for(re=1;re<ae&&0===ye[re];re++);for(ne<re&&(ne=re),oe=1,ee=1;ee<=A;ee++)if(oe<<=1,oe-=ye[ee],0>oe)return-1;if(0<oe&&(H===T||1!=ae))return-1;for(ke[1]=0,ee=1;ee<A;ee++)ke[ee+1]=ke[ee]+ye[ee];for(te=0;te<K;te++)0!==G[Y+te]&&(J[ke[G[Y+te]]++]=te);if(H===T?(_e=xe=J,be=19):H===D?(_e=L,ge-=257,xe=U,ve-=257,be=256):(_e=W,xe=Z,be=-1),le=0,te=0,ee=re,fe=V,se=ne,ie=0,pe=-1,de=1<<ne,he=de-1,H===D&&de>B||H===N&&de>R)return 1;for(;;){we=ee-ie,J[te]<be?(Se=0,ze=J[te]):J[te]>be?(Se=xe[ve+J[te]],ze=_e[ge+J[te]]):(Se=96,ze=0),ue=1<<ee-ie,ce=1<<se,re=ce;do ce-=ue,X[fe+(le>>ie)+ce]=0|(we<<24|Se<<16|ze);while(0!==ce);for(ue=1<<ee-1;le&ue;)ue>>=1;if(0===ue?le=0:(le&=ue-1,le+=ue),te++,0==--ye[ee]){if(ee==ae)break;ee=G[Y+J[te]]}if(ee>ne&&(le&he)!==pe){for(0==ie&&(ie=ne),fe+=re,se=ee-ie,oe=1<<se;se+ie<ae&&(oe-=ye[se+ie],!(0>=oe));)se++,oe<<=1;if(de+=1<<se,H===D&&de>B||H===N&&de>R)return 1;pe=le&he,X[pe]=0|(ne<<24|se<<16|fe-V)}}return 0!=le&&(X[fe+le]=0|(4194304|ee-ie<<24)),Q.bits=ne,0}},{"../utils/common":62}],72:[function(x,z){"use strict";z.exports={0:"",1:"stream end",2:"need dictionary","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],73:[function(x,z,E){"use strict";function I(Ke){for(var Xe=Ke.length;0<=--Xe;)Ke[Xe]=0}function A(Ke,Xe,Ve,Je,qe){this.static_tree=Ke,this.extra_bits=Xe,this.extra_base=Ve,this.elems=Je,this.max_length=qe,this.has_stree=Ke&&Ke.length}function B(Ke,Xe){this.dyn_tree=Ke,this.max_code=0,this.stat_desc=Xe}function R(Ke){return 256>Ke?je[Ke]:je[256+(Ke>>>7)]}function T(Ke,Xe){Ke.pending_buf[Ke.pending++]=255&Xe,Ke.pending_buf[Ke.pending++]=255&Xe>>>8}function D(Ke,Xe,Ve){Ke.bi_valid>Ce-Ve?(Ke.bi_buf|=65535&Xe<<Ke.bi_valid,T(Ke,Ke.bi_buf),Ke.bi_buf=Xe>>Ce-Ke.bi_valid,Ke.bi_valid+=Ve-Ce):(Ke.bi_buf|=65535&Xe<<Ke.bi_valid,Ke.bi_valid+=Ve)}function N(Ke,Xe,Ve){D(Ke,Ve[2*Xe],Ve[2*Xe+1])}function L(Ke,Xe){var Ve=0;do Ve|=1&Ke,Ke>>>=1,Ve<<=1;while(0<--Xe);return Ve>>>1}function U(Ke){16===Ke.bi_valid?(T(Ke,Ke.bi_buf),Ke.bi_buf=0,Ke.bi_valid=0):8<=Ke.bi_valid&&(Ke.pending_buf[Ke.pending++]=255&Ke.bi_buf,Ke.bi_buf>>=8,Ke.bi_valid-=8)}function W(Ke,Xe){var Ve=Xe.dyn_tree,Je=Xe.max_code,qe=Xe.stat_desc.static_tree,Qe=Xe.stat_desc.has_stree,$e=Xe.stat_desc.extra_bits,et=Xe.stat_desc.extra_base,tt=Xe.stat_desc.max_length,rt,at,nt,st,ot,dt,lt=0;for(st=0;st<=ze;st++)Ke.bl_count[st]=0;for(Ve[2*Ke.heap[Ke.heap_max]+1]=0,rt=Ke.heap_max+1;rt<Se;rt++)(at=Ke.heap[rt],st=Ve[2*Ve[2*at+1]+1]+1,st>tt&&(st=tt,lt++),Ve[2*at+1]=st,!(at>Je))&&(Ke.bl_count[st]++,ot=0,at>=et&&(ot=$e[at-et]),dt=Ve[2*at],Ke.opt_len+=dt*(st+ot),Qe&&(Ke.static_len+=dt*(qe[2*at+1]+ot)));if(0!=lt){do{for(st=tt-1;0===Ke.bl_count[st];)st--;Ke.bl_count[st]--,Ke.bl_count[st+1]+=2,Ke.bl_count[tt]--,lt-=2}while(0<lt);for(st=tt;0!==st;st--)for(at=Ke.bl_count[st];0!==at;)(nt=Ke.heap[--rt],!(nt>Je))&&(Ve[2*nt+1]!==st&&(Ke.opt_len+=(st-Ve[2*nt+1])*Ve[2*nt],Ve[2*nt+1]=st),at--)}}function Z(Ke,Xe,Ve){var Je=Array(ze+1),qe=0,Qe,$e;for(Qe=1;Qe<=ze;Qe++)Je[Qe]=qe=qe+Ve[Qe-1]<<1;for($e=0;$e<=Xe;$e++){var et=Ke[2*$e+1];0!==et&&(Ke[2*$e]=L(Je[et]++,et))}}function M(){var Ke,Xe,Ve,Je,qe,Qe=Array(ze+1);for(Ve=0,Je=0;Je<ye-1;Je++)for(We[Je]=Ve,Ke=0;Ke<1<<Re[Je];Ke++)Ue[Ve++]=Je;for(Ue[Ve-1]=Je,qe=0,Je=0;16>Je;Je++)for(Ze[Je]=qe,Ke=0;Ke<1<<Te[Je];Ke++)je[qe++]=Je;for(qe>>=7;Je<ve;Je++)for(Ze[Je]=qe<<7,Ke=0;Ke<1<<Te[Je]-7;Ke++)je[256+qe++]=Je;for(Xe=0;Xe<=ze;Xe++)Qe[Xe]=0;for(Ke=0;143>=Ke;)Ne[2*Ke+1]=8,Ke++,Qe[8]++;for(;255>=Ke;)Ne[2*Ke+1]=9,Ke++,Qe[9]++;for(;279>=Ke;)Ne[2*Ke+1]=7,Ke++,Qe[7]++;for(;287>=Ke;)Ne[2*Ke+1]=8,Ke++,Qe[8]++;for(Z(Ne,xe+1,Qe),Ke=0;Ke<ve;Ke++)Le[2*Ke+1]=5,Le[2*Ke]=L(Ke,5);Me=new A(Ne,Re,ke+1,xe,ze),He=new A(Le,Te,0,ve,ze),Ge=new A([],De,0,we,7)}function H(Ke){var Xe;for(Xe=0;Xe<xe;Xe++)Ke.dyn_ltree[2*Xe]=0;for(Xe=0;Xe<ve;Xe++)Ke.dyn_dtree[2*Xe]=0;for(Xe=0;Xe<we;Xe++)Ke.bl_tree[2*Xe]=0;Ke.dyn_ltree[2*Ie]=1,Ke.opt_len=Ke.static_len=0,Ke.last_lit=Ke.matches=0}function G(Ke){8<Ke.bi_valid?T(Ke,Ke.bi_buf):0<Ke.bi_valid&&(Ke.pending_buf[Ke.pending++]=Ke.bi_buf),Ke.bi_buf=0,Ke.bi_valid=0}function Y(Ke,Xe,Ve,Je){G(Ke),Je&&(T(Ke,Ve),T(Ke,~Ve)),de.arraySet(Ke.pending_buf,Ke.window,Xe,Ve,Ke.pending),Ke.pending+=Ve}function K(Ke,Xe,Ve,Je){var qe=2*Xe,Qe=2*Ve;return Ke[qe]<Ke[Qe]||Ke[qe]===Ke[Qe]&&Je[Xe]<=Je[Ve]}function X(Ke,Xe,Ve){for(var Je=Ke.heap[Ve],qe=Ve<<1;qe<=Ke.heap_len&&(qe<Ke.heap_len&&K(Xe,Ke.heap[qe+1],Ke.heap[qe],Ke.depth)&&qe++,!K(Xe,Je,Ke.heap[qe],Ke.depth));)Ke.heap[Ve]=Ke.heap[qe],Ve=qe,qe<<=1;Ke.heap[Ve]=Je}function V(Ke,Xe,Ve){var Je,qe,Qe=0,$e,et;if(0!==Ke.last_lit)do Je=Ke.pending_buf[Ke.d_buf+2*Qe]<<8|Ke.pending_buf[Ke.d_buf+2*Qe+1],qe=Ke.pending_buf[Ke.l_buf+Qe],Qe++,0===Je?N(Ke,qe,Xe):($e=Ue[qe],N(Ke,$e+ke+1,Xe),et=Re[$e],0!==et&&(qe-=We[$e],D(Ke,qe,et)),Je--,$e=R(Je),N(Ke,$e,Ve),et=Te[$e],0!==et&&(Je-=Ze[$e],D(Ke,Je,et)));while(Qe<Ke.last_lit);N(Ke,Ie,Xe)}function J(Ke,Xe){var Ve=Xe.dyn_tree,Je=Xe.stat_desc.static_tree,qe=Xe.stat_desc.has_stree,Qe=Xe.stat_desc.elems,$e,et,tt=-1,rt;for(Ke.heap_len=0,Ke.heap_max=Se,$e=0;$e<Qe;$e++)0===Ve[2*$e]?Ve[2*$e+1]=0:(Ke.heap[++Ke.heap_len]=tt=$e,Ke.depth[$e]=0);for(;2>Ke.heap_len;)rt=Ke.heap[++Ke.heap_len]=2>tt?++tt:0,Ve[2*rt]=1,Ke.depth[rt]=0,Ke.opt_len--,qe&&(Ke.static_len-=Je[2*rt+1]);for(Xe.max_code=tt,$e=Ke.heap_len>>1;1<=$e;$e--)X(Ke,Ve,$e);rt=Qe;do $e=Ke.heap[1],Ke.heap[1]=Ke.heap[Ke.heap_len--],X(Ke,Ve,1),et=Ke.heap[1],Ke.heap[--Ke.heap_max]=$e,Ke.heap[--Ke.heap_max]=et,Ve[2*rt]=Ve[2*$e]+Ve[2*et],Ke.depth[rt]=(Ke.depth[$e]>=Ke.depth[et]?Ke.depth[$e]:Ke.depth[et])+1,Ve[2*$e+1]=Ve[2*et+1]=rt,Ke.heap[1]=rt++,X(Ke,Ve,1);while(2<=Ke.heap_len);Ke.heap[--Ke.heap_max]=Ke.heap[1],W(Ke,Xe),Z(Ve,tt,Ke.bl_count)}function Q(Ke,Xe,Ve){var Je,qe=-1,Qe,$e=Xe[1],et=0,tt=7,rt=4;for(0===$e&&(tt=138,rt=3),Xe[2*(Ve+1)+1]=65535,Je=0;Je<=Ve;Je++){if(Qe=$e,$e=Xe[2*(Je+1)+1],++et<tt&&Qe===$e)continue;else et<rt?Ke.bl_tree[2*Qe]+=et:0===Qe?10>=et?Ke.bl_tree[2*Ae]++:Ke.bl_tree[2*Be]++:(Qe!==qe&&Ke.bl_tree[2*Qe]++,Ke.bl_tree[2*Oe]++);et=0,qe=Qe,0===$e?(tt=138,rt=3):Qe===$e?(tt=6,rt=3):(tt=7,rt=4)}}function $(Ke,Xe,Ve){var Je,qe=-1,Qe,$e=Xe[1],et=0,tt=7,rt=4;for(0===$e&&(tt=138,rt=3),Je=0;Je<=Ve;Je++){if(Qe=$e,$e=Xe[2*(Je+1)+1],++et<tt&&Qe===$e)continue;else if(et<rt)do N(Ke,Qe,Ke.bl_tree);while(0!=--et);else 0===Qe?10>=et?(N(Ke,Ae,Ke.bl_tree),D(Ke,et-3,3)):(N(Ke,Be,Ke.bl_tree),D(Ke,et-11,7)):(Qe!==qe&&(N(Ke,Qe,Ke.bl_tree),et--),N(Ke,Oe,Ke.bl_tree),D(Ke,et-3,2));et=0,qe=Qe,0===$e?(tt=138,rt=3):Qe===$e?(tt=6,rt=3):(tt=7,rt=4)}}function ee(Ke){var Xe;for(Q(Ke,Ke.dyn_ltree,Ke.l_desc.max_code),Q(Ke,Ke.dyn_dtree,Ke.d_desc.max_code),J(Ke,Ke.bl_desc),Xe=we-1;3<=Xe&&0===Ke.bl_tree[2*Fe[Xe]+1];Xe--);return Ke.opt_len+=3*(Xe+1)+5+5+4,Xe}function te(Ke,Xe,Ve,Je){var qe;for(D(Ke,Xe-257,5),D(Ke,Ve-1,5),D(Ke,Je-4,4),qe=0;qe<Je;qe++)D(Ke,Ke.bl_tree[2*Fe[qe]+1],3);$(Ke,Ke.dyn_ltree,Xe-1),$(Ke,Ke.dyn_dtree,Ve-1)}function re(Ke){var Xe=4093624447,Ve;for(Ve=0;31>=Ve;Ve++,Xe>>>=1)if(1&Xe&&0!==Ke.dyn_ltree[2*Ve])return ue;if(0!==Ke.dyn_ltree[18]||0!==Ke.dyn_ltree[20]||0!==Ke.dyn_ltree[26])return ce;for(Ve=32;Ve<ke;Ve++)if(0!==Ke.dyn_ltree[2*Ve])return ce;return ue}function ne(Ke,Xe,Ve,Je){D(Ke,(0<<1)+(Je?1:0),3),Y(Ke,Xe,Ve,!0)}var de=x("../utils/common"),ue=0,ce=1,fe=1,ye=29,ke=256,xe=ke+1+ye,ve=30,we=19,Se=2*xe+1,ze=15,Ce=16,Ie=256,Oe=16,Ae=17,Be=18,Re=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Te=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],De=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Fe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Ne=Array(2*(xe+2));I(Ne);var Le=Array(2*ve);I(Le);var je=Array(512);I(je);var Ue=Array(258-3+1);I(Ue);var We=Array(ye);I(We);var Ze=Array(ve);I(Ze);var Me,He,Ge,Ye=!1;E._tr_init=function(Ke){Ye||(M(),Ye=!0),Ke.l_desc=new B(Ke.dyn_ltree,Me),Ke.d_desc=new B(Ke.dyn_dtree,He),Ke.bl_desc=new B(Ke.bl_tree,Ge),Ke.bi_buf=0,Ke.bi_valid=0,H(Ke)},E._tr_stored_block=ne,E._tr_flush_block=function(Ke,Xe,Ve,Je){var qe,Qe,$e=0;0<Ke.level?(Ke.strm.data_type===2&&(Ke.strm.data_type=re(Ke)),J(Ke,Ke.l_desc),J(Ke,Ke.d_desc),$e=ee(Ke),qe=Ke.opt_len+3+7>>>3,Qe=Ke.static_len+3+7>>>3,Qe<=qe&&(qe=Qe)):qe=Qe=Ve+5,Ve+4<=qe&&-1!==Xe?ne(Ke,Xe,Ve,Je):Ke.strategy===4||Qe===qe?(D(Ke,(fe<<1)+(Je?1:0),3),V(Ke,Ne,Le)):(D(Ke,(2<<1)+(Je?1:0),3),te(Ke,Ke.l_desc.max_code+1,Ke.d_desc.max_code+1,$e+1),V(Ke,Ke.dyn_ltree,Ke.dyn_dtree)),H(Ke),Je&&G(Ke)},E._tr_tally=function(Ke,Xe,Ve){return Ke.pending_buf[Ke.d_buf+2*Ke.last_lit]=255&Xe>>>8,Ke.pending_buf[Ke.d_buf+2*Ke.last_lit+1]=255&Xe,Ke.pending_buf[Ke.l_buf+Ke.last_lit]=255&Ve,Ke.last_lit++,0===Xe?Ke.dyn_ltree[2*Ve]++:(Ke.matches++,Xe--,Ke.dyn_ltree[2*(Ue[Ve]+ke+1)]++,Ke.dyn_dtree[2*R(Xe)]++),Ke.last_lit===Ke.lit_bufsize-1},E._tr_align=function(Ke){D(Ke,fe<<1,3),N(Ke,Ie,Ne),U(Ke)}},{"../utils/common":62}],74:[function(x,z){"use strict";z.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}]},{},[10])(10)});

var THREE={REVISION:'58'};(function(){for(var _=0,S=['ms','moz','webkit','o'],M=0;M<S.length&&!window.requestAnimationFrame;++M)window.requestAnimationFrame=window[S[M]+'RequestAnimationFrame'],window.cancelAnimationFrame=window[S[M]+'CancelAnimationFrame']||window[S[M]+'CancelRequestAnimationFrame'];window.requestAnimationFrame===void 0&&(window.requestAnimationFrame=function(T){var A=Date.now(),C=Math.max(0,16-(A-_)),E=window.setTimeout(function(){T(A+C)},C);return _=A+C,E}),window.cancelAnimationFrame=window.cancelAnimationFrame||function(T){window.clearTimeout(T)}})(),THREE.CullFaceNone=0,THREE.CullFaceBack=1,THREE.CullFaceFront=2,THREE.CullFaceFrontBack=3,THREE.FrontFaceDirectionCW=0,THREE.FrontFaceDirectionCCW=1,THREE.BasicShadowMap=0,THREE.PCFShadowMap=1,THREE.PCFSoftShadowMap=2,THREE.FrontSide=0,THREE.BackSide=1,THREE.DoubleSide=2,THREE.NoShading=0,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NoBlending=0,THREE.NormalBlending=1,THREE.AdditiveBlending=2,THREE.SubtractiveBlending=3,THREE.MultiplyBlending=4,THREE.CustomBlending=5,THREE.AddEquation=100,THREE.SubtractEquation=101,THREE.ReverseSubtractEquation=102,THREE.ZeroFactor=200,THREE.OneFactor=201,THREE.SrcColorFactor=202,THREE.OneMinusSrcColorFactor=203,THREE.SrcAlphaFactor=204,THREE.OneMinusSrcAlphaFactor=205,THREE.DstAlphaFactor=206,THREE.OneMinusDstAlphaFactor=207,THREE.DstColorFactor=208,THREE.OneMinusDstColorFactor=209,THREE.SrcAlphaSaturateFactor=210,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.AddOperation=2,THREE.UVMapping=function(){},THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.RepeatWrapping=1e3,THREE.ClampToEdgeWrapping=1001,THREE.MirroredRepeatWrapping=1002,THREE.NearestFilter=1003,THREE.NearestMipMapNearestFilter=1004,THREE.NearestMipMapLinearFilter=1005,THREE.LinearFilter=1006,THREE.LinearMipMapNearestFilter=1007,THREE.LinearMipMapLinearFilter=1008,THREE.UnsignedByteType=1009,THREE.ByteType=1010,THREE.ShortType=1011,THREE.UnsignedShortType=1012,THREE.IntType=1013,THREE.UnsignedIntType=1014,THREE.FloatType=1015,THREE.UnsignedShort4444Type=1016,THREE.UnsignedShort5551Type=1017,THREE.UnsignedShort565Type=1018,THREE.AlphaFormat=1019,THREE.RGBFormat=1020,THREE.RGBAFormat=1021,THREE.LuminanceFormat=1022,THREE.LuminanceAlphaFormat=1023,THREE.RGB_S3TC_DXT1_Format=2001,THREE.RGBA_S3TC_DXT1_Format=2002,THREE.RGBA_S3TC_DXT3_Format=2003,THREE.RGBA_S3TC_DXT5_Format=2004,THREE.Color=function(_){return void 0!==_&&this.set(_),this},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(_){return this.value=_,_ instanceof THREE.Color?this.copy(_):'number'==typeof _?this.setHex(_):'string'==typeof _?this.setStyle(_):Array.isArray(_)&&this.setArray(_),this},setArray:function(_){return this.r=_[0]/255,this.g=_[1]/255,this.b=_[2]/255,this},setHex:function(_){return _=Math.floor(_),this.r=(255&_>>16)/255,this.g=(255&_>>8)/255,this.b=(255&_)/255,this},setRGB:function(_,S,M){return this.r=_,this.g=S,this.b=M,this},setHSL:function(_,S,M){if(0===S)this.r=this.g=this.b=M;else{var T=function(E,D,P){return 0>P&&(P+=1),1<P&&(P-=1),P<1/6?E+6*(D-E)*P:P<1/2?D:P<2/3?E+6*(D-E)*(2/3-P):E},A=0.5>=M?M*(1+S):M+S-M*S,C=2*M-A;this.r=T(C,A,_+1/3),this.g=T(C,A,_),this.b=T(C,A,_-1/3)}return this},setStyle:function(_){if(/^rgb\((\d+),(\d+),(\d+)\)$/i.test(_)){var S=/^rgb\((\d+),(\d+),(\d+)\)$/i.exec(_);return this.r=Math.min(255,parseInt(S[1],10))/255,this.g=Math.min(255,parseInt(S[2],10))/255,this.b=Math.min(255,parseInt(S[3],10))/255,this}if(/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.test(_)){var S=/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.exec(_);return this.r=Math.min(100,parseInt(S[1],10))/100,this.g=Math.min(100,parseInt(S[2],10))/100,this.b=Math.min(100,parseInt(S[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(_)){var S=/^\#([0-9a-f]{6})$/i.exec(_);return this.setHex(parseInt(S[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(_)){var S=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(_);return this.setHex(parseInt(S[1]+S[1]+S[2]+S[2]+S[3]+S[3],16)),this}return /^(\w+)$/i.test(_)?(this.setHex(THREE.ColorKeywords[_]),this):void 0},copy:function(_){return this.r=_.r,this.g=_.g,this.b=_.b,this},copyGammaToLinear:function(_){return this.r=_.r*_.r,this.g=_.g*_.g,this.b=_.b*_.b,this},copyLinearToGamma:function(_){return this.r=Math.sqrt(_.r),this.g=Math.sqrt(_.g),this.b=Math.sqrt(_.b),this},convertGammaToLinear:function(){var _=this.r,S=this.g,M=this.b;return this.r=_*_,this.g=S*S,this.b=M*M,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return('000000'+this.getHex().toString(16)).slice(-6)},getHSL:function(){var _={h:0,s:0,l:0};return function(){var S=this.r,M=this.g,T=this.b,A=Math.max(S,M,T),C=Math.min(S,M,T),P=(C+A)/2,E,D;if(C===A)E=0,D=0;else{var R=A-C;D=0.5>=P?R/(A+C):R/(2-A-C),A===S?E=(M-T)/R+(M<T?6:0):A===M?E=(T-S)/R+2:A===T?E=(S-M)/R+4:void 0,E/=6}return _.h=E,_.s=D,_.l=P,_}}(),getStyle:function(){return'rgb('+(0|255*this.r)+','+(0|255*this.g)+','+(0|255*this.b)+')'},offsetHSL:function(_,S,M){var T=this.getHSL();return T.h+=_,T.s+=S,T.l+=M,this.setHSL(T.h,T.s,T.l),this},add:function(_){return this.r+=_.r,this.g+=_.g,this.b+=_.b,this},addColors:function(_,S){return this.r=_.r+S.r,this.g=_.g+S.g,this.b=_.b+S.b,this},addScalar:function(_){return this.r+=_,this.g+=_,this.b+=_,this},multiply:function(_){return this.r*=_.r,this.g*=_.g,this.b*=_.b,this},multiplyScalar:function(_){return this.r*=_,this.g*=_,this.b*=_,this},lerp:function(_,S){return this.r+=(_.r-this.r)*S,this.g+=(_.g-this.g)*S,this.b+=(_.b-this.b)*S,this},equals:function(_){return _.r===this.r&&_.g===this.g&&_.b===this.b},clone:function(){return new THREE.Color().setRGB(this.r,this.g,this.b)}},THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},THREE.Quaternion=function(_,S,M,T){this.x=_||0,this.y=S||0,this.z=M||0,this.w=T===void 0?1:T},THREE.Quaternion.prototype={constructor:THREE.Quaternion,set:function(_,S,M,T){return this.x=_,this.y=S,this.z=M,this.w=T,this},copy:function(_){return this.x=_.x,this.y=_.y,this.z=_.z,this.w=_.w,this},setFromEuler:function(_,S){var M=Math.cos(_.x/2),T=Math.cos(_.y/2),A=Math.cos(_.z/2),C=Math.sin(_.x/2),E=Math.sin(_.y/2),D=Math.sin(_.z/2);return void 0===S||'XYZ'===S?(this.x=C*T*A+M*E*D,this.y=M*E*A-C*T*D,this.z=M*T*D+C*E*A,this.w=M*T*A-C*E*D):'YXZ'===S?(this.x=C*T*A+M*E*D,this.y=M*E*A-C*T*D,this.z=M*T*D-C*E*A,this.w=M*T*A+C*E*D):'ZXY'===S?(this.x=C*T*A-M*E*D,this.y=M*E*A+C*T*D,this.z=M*T*D+C*E*A,this.w=M*T*A-C*E*D):'ZYX'===S?(this.x=C*T*A-M*E*D,this.y=M*E*A+C*T*D,this.z=M*T*D-C*E*A,this.w=M*T*A+C*E*D):'YZX'===S?(this.x=C*T*A+M*E*D,this.y=M*E*A+C*T*D,this.z=M*T*D-C*E*A,this.w=M*T*A-C*E*D):'XZY'==S&&(this.x=C*T*A-M*E*D,this.y=M*E*A-C*T*D,this.z=M*T*D+C*E*A,this.w=M*T*A+C*E*D),this},setFromAxisAngle:function(_,S){var M=S/2,T=Math.sin(M);return this.x=_.x*T,this.y=_.y*T,this.z=_.z*T,this.w=Math.cos(M),this},setFromRotationMatrix:function(_){var S=_.elements,M=S[0],T=S[4],A=S[8],C=S[1],E=S[5],D=S[9],P=S[2],R=S[6],L=S[10],N=M+E+L,U;return 0<N?(U=0.5/Math.sqrt(N+1),this.w=0.25/U,this.x=(R-D)*U,this.y=(A-P)*U,this.z=(C-T)*U):M>E&&M>L?(U=2*Math.sqrt(1+M-E-L),this.w=(R-D)/U,this.x=0.25*U,this.y=(T+C)/U,this.z=(A+P)/U):E>L?(U=2*Math.sqrt(1+E-M-L),this.w=(A-P)/U,this.x=(T+C)/U,this.y=0.25*U,this.z=(D+R)/U):(U=2*Math.sqrt(1+L-M-E),this.w=(C-T)/U,this.x=(A+P)/U,this.y=(D+R)/U,this.z=0.25*U),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var _=this.length();return 0===_?(this.x=0,this.y=0,this.z=0,this.w=1):(_=1/_,this.x*=_,this.y*=_,this.z*=_,this.w*=_),this},multiply:function(_,S){return void 0===S?this.multiplyQuaternions(this,_):this.multiplyQuaternions(_,S)},multiplyQuaternions:function(_,S){var M=_.x,T=_.y,A=_.z,C=_.w,E=S.x,D=S.y,P=S.z,R=S.w;return this.x=M*R+C*E+T*P-A*D,this.y=T*R+C*D+A*E-M*P,this.z=A*R+C*P+M*D-T*E,this.w=C*R-M*E-T*D-A*P,this},slerp:function(_,S){var M=this.x,T=this.y,A=this.z,C=this.w,E=C*_.w+M*_.x+T*_.y+A*_.z;if(0>E?(this.w=-_.w,this.x=-_.x,this.y=-_.y,this.z=-_.z,E=-E):this.copy(_),1<=E)return this.w=C,this.x=M,this.y=T,this.z=A,this;var D=Math.acos(E),P=Math.sqrt(1-E*E);if(1e-3>Math.abs(P))return this.w=0.5*(C+this.w),this.x=0.5*(M+this.x),this.y=0.5*(T+this.y),this.z=0.5*(A+this.z),this;var R=Math.sin((1-S)*D)/P,L=Math.sin(S*D)/P;return this.w=C*R+this.w*L,this.x=M*R+this.x*L,this.y=T*R+this.y*L,this.z=A*R+this.z*L,this},equals:function(_){return _.x===this.x&&_.y===this.y&&_.z===this.z&&_.w===this.w},fromArray:function(_){return this.x=_[0],this.y=_[1],this.z=_[2],this.w=_[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new THREE.Quaternion(this.x,this.y,this.z,this.w)},toAxisAngle:function(){1<this.w&&this.normalise();var _=2*Math.acos(this.w),S=Math.sqrt(1-this.w*this.w);return 1e-3>S?(x=this.x,y=this.y,z=this.z):(x=this.x/S,y=this.y/S,z=this.z/S),[new THREE.Vector3(x,y,z),_]}},THREE.Quaternion.slerp=function(_,S,M,T){return M.copy(_).slerp(S,T)},THREE.Vector2=function(_,S){this.x=_||0,this.y=S||0},THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(_,S){return this.x=_,this.y=S,this},setX:function(_){return this.x=_,this},setY:function(_){return this.y=_,this},setComponent:function(_,S){this[_?'y':'x']=S},getComponent:function(_){return this[_?'y':'x']},copy:function(_){return this.x=_.x,this.y=_.y,this},add:function(_){return this.x+=_.x,this.y+=_.y,this},addVectors:function(_,S){return this.x=_.x+S.x,this.y=_.y+S.y,this},addScalar:function(_){return this.x+=_,this.y+=_,this},sub:function(_){return this.x-=_.x,this.y-=_.y,this},subVectors:function(_,S){return this.x=_.x-S.x,this.y=_.y-S.y,this},multiplyScalar:function(_){return this.x*=_,this.y*=_,this},divideScalar:function(_){return 0===_?this.set(0,0):(this.x/=_,this.y/=_),this},min:function(_){return this.x>_.x&&(this.x=_.x),this.y>_.y&&(this.y=_.y),this},max:function(_){return this.x<_.x&&(this.x=_.x),this.y<_.y&&(this.y=_.y),this},clamp:function(_,S){return this.x<_.x?this.x=_.x:this.x>S.x&&(this.x=S.x),this.y<_.y?this.y=_.y:this.y>S.y&&(this.y=S.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(_){return this.x*_.x+this.y*_.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(_){return Math.sqrt(this.distanceToSquared(_))},distanceToSquared:function(_){var S=this.x-_.x,M=this.y-_.y;return S*S+M*M},setLength:function(_){var S=this.length();return 0!==S&&_!==S&&this.multiplyScalar(_/S),this},lerp:function(_,S){return this.x+=(_.x-this.x)*S,this.y+=(_.y-this.y)*S,this},equals:function(_){return _.x===this.x&&_.y===this.y},fromArray:function(_){return this.x=_[0],this.y=_[1],this},toArray:function(){return[this.x,this.y]},clone:function(){return new THREE.Vector2(this.x,this.y)}},THREE.Vector3=function(_,S,M){this.x=_||0,this.y=S||0,this.z=M||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(_,S,M){return this.x=_,this.y=S,this.z=M,this},setX:function(_){return this.x=_,this},setY:function(_){return this.y=_,this},setZ:function(_){return this.z=_,this},setComponent:function(_,S){this[0===_?'x':1===_?'y':'z']=S},getComponent:function(_){return this[0===_?'x':1===_?'y':'z']},copy:function(_){return this.x=_.x,this.y=_.y,this.z=_.z,this},add:function(_){return this.x+=_.x,this.y+=_.y,this.z+=_.z,this},addScalar:function(_){return this.x+=_,this.y+=_,this.z+=_,this},addVectors:function(_,S){return this.x=_.x+S.x,this.y=_.y+S.y,this.z=_.z+S.z,this},sub:function(_){return this.x-=_.x,this.y-=_.y,this.z-=_.z,this},subVectors:function(_,S){return this.x=_.x-S.x,this.y=_.y-S.y,this.z=_.z-S.z,this},multiply:function(_){return this.x*=_.x,this.y*=_.y,this.z*=_.z,this},multiplyScalar:function(_){return this.x*=_,this.y*=_,this.z*=_,this},multiplyVectors:function(_,S){return this.x=_.x*S.x,this.y=_.y*S.y,this.z=_.z*S.z,this},applyMatrix3:function(_){var S=this.x,M=this.y,T=this.z,A=_.elements;return this.x=A[0]*S+A[3]*M+A[6]*T,this.y=A[1]*S+A[4]*M+A[7]*T,this.z=A[2]*S+A[5]*M+A[8]*T,this},applyMatrix4:function(_){var S=this.x,M=this.y,T=this.z,A=_.elements;return this.x=A[0]*S+A[4]*M+A[8]*T+A[12],this.y=A[1]*S+A[5]*M+A[9]*T+A[13],this.z=A[2]*S+A[6]*M+A[10]*T+A[14],this},applyProjection:function(_){var S=this.x,M=this.y,T=this.z,A=_.elements,C=1/(A[3]*S+A[7]*M+A[11]*T+A[15]);return this.x=(A[0]*S+A[4]*M+A[8]*T+A[12])*C,this.y=(A[1]*S+A[5]*M+A[9]*T+A[13])*C,this.z=(A[2]*S+A[6]*M+A[10]*T+A[14])*C,this},applyQuaternion:function(_){var S=this.x,M=this.y,T=this.z,A=_.x,C=_.y,E=_.z,D=_.w,P=D*S+C*T-E*M,R=D*M+E*S-A*T,L=D*T+A*M-C*S,N=-A*S-C*M-E*T;return this.x=P*D+N*-A+R*-E-L*-C,this.y=R*D+N*-C+L*-A-P*-E,this.z=L*D+N*-E+P*-C-R*-A,this},transformDirection:function(_){var S=this.x,M=this.y,T=this.z,A=_.elements;return this.x=A[0]*S+A[4]*M+A[8]*T,this.y=A[1]*S+A[5]*M+A[9]*T,this.z=A[2]*S+A[6]*M+A[10]*T,this.normalize(),this},divide:function(_){return this.x/=_.x,this.y/=_.y,this.z/=_.z,this},divideScalar:function(_){return 0===_?(this.x=0,this.y=0,this.z=0):(this.x/=_,this.y/=_,this.z/=_),this},min:function(_){return this.x>_.x&&(this.x=_.x),this.y>_.y&&(this.y=_.y),this.z>_.z&&(this.z=_.z),this},max:function(_){return this.x<_.x&&(this.x=_.x),this.y<_.y&&(this.y=_.y),this.z<_.z&&(this.z=_.z),this},clamp:function(_,S){return this.x<_.x?this.x=_.x:this.x>S.x&&(this.x=S.x),this.y<_.y?this.y=_.y:this.y>S.y&&(this.y=S.y),this.z<_.z?this.z=_.z:this.z>S.z&&(this.z=S.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(_){return this.x*_.x+this.y*_.y+this.z*_.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(_){var S=this.length();return 0!==S&&_!==S&&this.multiplyScalar(_/S),this},lerp:function(_,S){return this.x+=(_.x-this.x)*S,this.y+=(_.y-this.y)*S,this.z+=(_.z-this.z)*S,this},cross:function(_){var M=this.x,T=this.y,A=this.z;return this.x=T*_.z-A*_.y,this.y=A*_.x-M*_.z,this.z=M*_.y-T*_.x,this},crossVectors:function(_,S){return this.x=_.y*S.z-_.z*S.y,this.y=_.z*S.x-_.x*S.z,this.z=_.x*S.y-_.y*S.x,this},angleTo:function(_){var S=this.dot(_)/(this.length()*_.length());return Math.acos(THREE.Math.clamp(S,-1,1))},distanceTo:function(_){return Math.sqrt(this.distanceToSquared(_))},distanceToSquared:function(_){var S=this.x-_.x,M=this.y-_.y,T=this.z-_.z;return S*S+M*M+T*T},setEulerFromRotationMatrix:function(_,S){function M(F){return Math.min(Math.max(F,-1),1)}var T=_.elements,A=T[0],C=T[4],E=T[8],D=T[1],P=T[5],R=T[9],L=T[2],N=T[6],U=T[10];return void 0===S||'XYZ'===S?(this.y=Math.asin(M(E)),0.99999>Math.abs(E)?(this.x=Math.atan2(-R,U),this.z=Math.atan2(-C,A)):(this.x=Math.atan2(N,P),this.z=0)):'YXZ'===S?(this.x=Math.asin(-M(R)),0.99999>Math.abs(R)?(this.y=Math.atan2(E,U),this.z=Math.atan2(D,P)):(this.y=Math.atan2(-L,A),this.z=0)):'ZXY'===S?(this.x=Math.asin(M(N)),0.99999>Math.abs(N)?(this.y=Math.atan2(-L,U),this.z=Math.atan2(-C,P)):(this.y=0,this.z=Math.atan2(D,A))):'ZYX'===S?(this.y=Math.asin(-M(L)),0.99999>Math.abs(L)?(this.x=Math.atan2(N,U),this.z=Math.atan2(D,A)):(this.x=0,this.z=Math.atan2(-C,P))):'YZX'===S?(this.z=Math.asin(M(D)),0.99999>Math.abs(D)?(this.x=Math.atan2(-R,P),this.y=Math.atan2(-L,A)):(this.x=0,this.y=Math.atan2(E,U))):'XZY'==S&&(this.z=Math.asin(-M(C)),0.99999>Math.abs(C)?(this.x=Math.atan2(N,P),this.y=Math.atan2(E,A)):(this.x=Math.atan2(-R,U),this.y=0)),this},setEulerFromQuaternion:function(_,S){function M(D){return Math.min(Math.max(D,-1),1)}var T=_.x*_.x,A=_.y*_.y,C=_.z*_.z,E=_.w*_.w;return void 0===S||'XYZ'===S?(this.x=Math.atan2(2*(_.x*_.w-_.y*_.z),E-T-A+C),this.y=Math.asin(M(2*(_.x*_.z+_.y*_.w))),this.z=Math.atan2(2*(_.z*_.w-_.x*_.y),E+T-A-C)):'YXZ'===S?(this.x=Math.asin(M(2*(_.x*_.w-_.y*_.z))),this.y=Math.atan2(2*(_.x*_.z+_.y*_.w),E-T-A+C),this.z=Math.atan2(2*(_.x*_.y+_.z*_.w),E-T+A-C)):'ZXY'===S?(this.x=Math.asin(M(2*(_.x*_.w+_.y*_.z))),this.y=Math.atan2(2*(_.y*_.w-_.z*_.x),E-T-A+C),this.z=Math.atan2(2*(_.z*_.w-_.x*_.y),E-T+A-C)):'ZYX'===S?(this.x=Math.atan2(2*(_.x*_.w+_.z*_.y),E-T-A+C),this.y=Math.asin(M(2*(_.y*_.w-_.x*_.z))),this.z=Math.atan2(2*(_.x*_.y+_.z*_.w),E+T-A-C)):'YZX'===S?(this.x=Math.atan2(2*(_.x*_.w-_.z*_.y),E-T+A-C),this.y=Math.atan2(2*(_.y*_.w-_.x*_.z),E+T-A-C),this.z=Math.asin(M(2*(_.x*_.y+_.z*_.w)))):'XZY'==S&&(this.x=Math.atan2(2*(_.x*_.w+_.y*_.z),E-T+A-C),this.y=Math.atan2(2*(_.x*_.z+_.y*_.w),E+T-A-C),this.z=Math.asin(M(2*(_.z*_.w-_.x*_.y)))),this},getPositionFromMatrix:function(_){return this.x=_.elements[12],this.y=_.elements[13],this.z=_.elements[14],this},getScaleFromMatrix:function(_){var S=this.set(_.elements[0],_.elements[1],_.elements[2]).length(),M=this.set(_.elements[4],_.elements[5],_.elements[6]).length(),T=this.set(_.elements[8],_.elements[9],_.elements[10]).length();return this.x=S,this.y=M,this.z=T,this},getColumnFromMatrix:function(_,S){var M=4*_,T=S.elements;return this.x=T[M],this.y=T[M+1],this.z=T[M+2],this},equals:function(_){return _.x===this.x&&_.y===this.y&&_.z===this.z},fromArray:function(_){return this.x=_[0],this.y=_[1],this.z=_[2],this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)},applyEuler:function(){var _=new THREE.Quaternion;return function(S,M){var T=_.setFromEuler(S,M);return this.applyQuaternion(T),this}}(),applyAxisAngle:function(){var _=new THREE.Quaternion;return function(S,M){var T=_.setFromAxisAngle(S,M);return this.applyQuaternion(T),this}}(),project:function(){var _;return function(M){return void 0==_&&(_=new THREE.Matrix4),_.multiplyMatrices(M.projectionMatrix,_.getInverse(M.matrixWorld)),this.applyProjection(_)}}(),unproject:function(){var _;return function(M){return void 0==_&&(_=new THREE.Matrix4),_.multiplyMatrices(M.matrixWorld,_.getInverse(M.projectionMatrix)),this.applyProjection(_)}}()},THREE.Vector3.prototype.projectOnVector=function(){var _=new THREE.Vector3;return function(S){_.copy(S).normalize();var M=this.dot(_);return this.copy(_).multiplyScalar(M)}}(),THREE.Vector3.prototype.projectOnPlane=function(){var _=new THREE.Vector3;return function(S){return _.copy(this).projectOnVector(S),this.sub(_)}}(),THREE.Vector3.prototype.reflect=function(){var _=new THREE.Vector3;return function(S){return _.copy(this).projectOnVector(S).multiplyScalar(2),this.subVectors(_,this)}}(),THREE.Vector4=function(_,S,M,T){this.x=_||0,this.y=S||0,this.z=M||0,this.w=T===void 0?1:T},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(_,S,M,T){return this.x=_,this.y=S,this.z=M,this.w=T,this},setX:function(_){return this.x=_,this},setY:function(_){return this.y=_,this},setZ:function(_){return this.z=_,this},setW:function(_){return this.w=_,this},setComponent:function(_,S){this[0===_?'x':1===_?'y':2===_?'z':'w']=S},getComponent:function(_){return this[0===_?'x':1===_?'y':2===_?'z':'w']},copy:function(_){return this.x=_.x,this.y=_.y,this.z=_.z,this.w=void 0===_.w?1:_.w,this},add:function(_){return this.x+=_.x,this.y+=_.y,this.z+=_.z,this.w+=_.w,this},addScalar:function(_){return this.x+=_,this.y+=_,this.z+=_,this.w+=_,this},addVectors:function(_,S){return this.x=_.x+S.x,this.y=_.y+S.y,this.z=_.z+S.z,this.w=_.w+S.w,this},sub:function(_){return this.x-=_.x,this.y-=_.y,this.z-=_.z,this.w-=_.w,this},subVectors:function(_,S){return this.x=_.x-S.x,this.y=_.y-S.y,this.z=_.z-S.z,this.w=_.w-S.w,this},multiplyScalar:function(_){return this.x*=_,this.y*=_,this.z*=_,this.w*=_,this},applyMatrix4:function(_){var S=this.x,M=this.y,T=this.z,A=this.w,C=_.elements;return this.x=C[0]*S+C[4]*M+C[8]*T+C[12]*A,this.y=C[1]*S+C[5]*M+C[9]*T+C[13]*A,this.z=C[2]*S+C[6]*M+C[10]*T+C[14]*A,this.w=C[3]*S+C[7]*M+C[11]*T+C[15]*A,this},divideScalar:function(_){return 0===_?(this.x=0,this.y=0,this.z=0,this.w=1):(this.x/=_,this.y/=_,this.z/=_,this.w/=_),this},setAxisAngleFromQuaternion:function(_){this.w=2*Math.acos(_.w);var S=Math.sqrt(1-_.w*_.w);return 1e-4>S?(this.x=1,this.y=0,this.z=0):(this.x=_.x/S,this.y=_.y/S,this.z=_.z/S),this},setAxisAngleFromRotationMatrix:function(_){var C=0.01,E=0.1,D=_.elements,P=D[0],R=D[4],L=D[8],N=D[1],U=D[5],F=D[9],V=D[2],I=D[6],O=D[10],S,M,T,A;if(Math.abs(R-N)<C&&Math.abs(L-V)<C&&Math.abs(F-I)<C){if(Math.abs(R+N)<E&&Math.abs(L+V)<E&&Math.abs(F+I)<E&&Math.abs(P+U+O-3)<E)return this.set(1,0,0,0),this;S=Math.PI;var B=(P+1)/2,G=(U+1)/2,H=(O+1)/2,W=(R+N)/4,X=(L+V)/4,Y=(F+I)/4;return B>G&&B>H?B<C?(M=0,T=0.707106781,A=0.707106781):(M=Math.sqrt(B),T=W/M,A=X/M):G>H?G<C?(M=0.707106781,T=0,A=0.707106781):(T=Math.sqrt(G),M=W/T,A=Y/T):H<C?(M=0.707106781,T=0.707106781,A=0):(A=Math.sqrt(H),M=X/A,T=Y/A),this.set(M,T,A,S),this}var K=Math.sqrt((I-F)*(I-F)+(L-V)*(L-V)+(N-R)*(N-R));return 1e-3>Math.abs(K)&&(K=1),this.x=(I-F)/K,this.y=(L-V)/K,this.z=(N-R)/K,this.w=Math.acos((P+U+O-1)/2),this},min:function(_){return this.x>_.x&&(this.x=_.x),this.y>_.y&&(this.y=_.y),this.z>_.z&&(this.z=_.z),this.w>_.w&&(this.w=_.w),this},max:function(_){return this.x<_.x&&(this.x=_.x),this.y<_.y&&(this.y=_.y),this.z<_.z&&(this.z=_.z),this.w<_.w&&(this.w=_.w),this},clamp:function(_,S){return this.x<_.x?this.x=_.x:this.x>S.x&&(this.x=S.x),this.y<_.y?this.y=_.y:this.y>S.y&&(this.y=S.y),this.z<_.z?this.z=_.z:this.z>S.z&&(this.z=S.z),this.w<_.w?this.w=_.w:this.w>S.w&&(this.w=S.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(_){return this.x*_.x+this.y*_.y+this.z*_.z+this.w*_.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(_){var S=this.length();return 0!==S&&_!==S&&this.multiplyScalar(_/S),this},lerp:function(_,S){return this.x+=(_.x-this.x)*S,this.y+=(_.y-this.y)*S,this.z+=(_.z-this.z)*S,this.w+=(_.w-this.w)*S,this},equals:function(_){return _.x===this.x&&_.y===this.y&&_.z===this.z&&_.w===this.w},fromArray:function(_){return this.x=_[0],this.y=_[1],this.z=_[2],this.w=_[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}},THREE.Line3=function(_,S){this.start=_===void 0?new THREE.Vector3:_,this.end=S===void 0?new THREE.Vector3:S},THREE.Line3.prototype={constructor:THREE.Line3,set:function(_,S){return this.start.copy(_),this.end.copy(S),this},copy:function(_){return this.start.copy(_.start),this.end.copy(_.end),this},center:function(_){var S=_||new THREE.Vector3;return S.addVectors(this.start,this.end).multiplyScalar(0.5)},delta:function(_){var S=_||new THREE.Vector3;return S.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(_,S){var M=S||new THREE.Vector3;return this.delta(M).multiplyScalar(_).add(this.start)},closestPointToPointParameter:function(){var _=new THREE.Vector3,S=new THREE.Vector3;return function(M,T){_.subVectors(M,this.start),S.subVectors(this.end,this.start);var A=S.dot(S),C=S.dot(_),E=C/A;return T&&(E=THREE.Math.clamp(E,0,1)),E}}(),closestPointToPoint:function(_,S,M){var T=this.closestPointToPointParameter(_,S),A=M||new THREE.Vector3;return this.delta(A).multiplyScalar(T).add(this.start)},applyMatrix4:function(_){return this.start.applyMatrix4(_),this.end.applyMatrix4(_),this},equals:function(_){return _.start.equals(this.start)&&_.end.equals(this.end)},clone:function(){return new THREE.Line3().copy(this)}},THREE.Box2=function(_,S){this.min=_===void 0?new THREE.Vector2(Infinity,Infinity):_,this.max=S===void 0?new THREE.Vector2(-Infinity,-Infinity):S},THREE.Box2.prototype={constructor:THREE.Box2,set:function(_,S){return this.min.copy(_),this.max.copy(S),this},setFromPoints:function(_){if(0<_.length){var S=_[0];this.min.copy(S),this.max.copy(S);for(var M=1,T=_.length;M<T;M++)S=_[M],S.x<this.min.x?this.min.x=S.x:S.x>this.max.x&&(this.max.x=S.x),S.y<this.min.y?this.min.y=S.y:S.y>this.max.y&&(this.max.y=S.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var _=new THREE.Vector2;return function(S,M){var T=_.copy(M).multiplyScalar(0.5);return this.min.copy(S).sub(T),this.max.copy(S).add(T),this}}(),copy:function(_){return this.min.copy(_.min),this.max.copy(_.max),this},makeEmpty:function(){return this.min.x=this.min.y=Infinity,this.max.x=this.max.y=-Infinity,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(_){var S=_||new THREE.Vector2;return S.addVectors(this.min,this.max).multiplyScalar(0.5)},size:function(_){var S=_||new THREE.Vector2;return S.subVectors(this.max,this.min)},expandByPoint:function(_){return this.min.min(_),this.max.max(_),this},expandByVector:function(_){return this.min.sub(_),this.max.add(_),this},expandByScalar:function(_){return this.min.addScalar(-_),this.max.addScalar(_),this},containsPoint:function(_){return _.x<this.min.x||_.x>this.max.x||_.y<this.min.y||_.y>this.max.y?!1:!0},containsBox:function(_){return this.min.x<=_.min.x&&_.max.x<=this.max.x&&this.min.y<=_.min.y&&_.max.y<=this.max.y},getParameter:function(_){return new THREE.Vector2((_.x-this.min.x)/(this.max.x-this.min.x),(_.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(_){return _.max.x<this.min.x||_.min.x>this.max.x||_.max.y<this.min.y||_.min.y>this.max.y?!1:!0},clampPoint:function(_,S){var M=S||new THREE.Vector2;return M.copy(_).clamp(this.min,this.max)},distanceToPoint:function(){var _=new THREE.Vector2;return function(S){var M=_.copy(S).clamp(this.min,this.max);return M.sub(S).length()}}(),intersect:function(_){return this.min.max(_.min),this.max.min(_.max),this},union:function(_){return this.min.min(_.min),this.max.max(_.max),this},translate:function(_){return this.min.add(_),this.max.add(_),this},equals:function(_){return _.min.equals(this.min)&&_.max.equals(this.max)},clone:function(){return new THREE.Box2().copy(this)}},THREE.Box3=function(_,S){this.min=_===void 0?new THREE.Vector3(Infinity,Infinity,Infinity):_,this.max=S===void 0?new THREE.Vector3(-Infinity,-Infinity,-Infinity):S},THREE.Box3.prototype={constructor:THREE.Box3,set:function(_,S){return this.min.copy(_),this.max.copy(S),this},setFromPoints:function(_){if(0<_.length){var S=_[0];this.min.copy(S),this.max.copy(S);for(var M=1,T=_.length;M<T;M++)S=_[M],S.x<this.min.x?this.min.x=S.x:S.x>this.max.x&&(this.max.x=S.x),S.y<this.min.y?this.min.y=S.y:S.y>this.max.y&&(this.max.y=S.y),S.z<this.min.z?this.min.z=S.z:S.z>this.max.z&&(this.max.z=S.z)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var _=new THREE.Vector3;return function(S,M){var T=_.copy(M).multiplyScalar(0.5);return this.min.copy(S).sub(T),this.max.copy(S).add(T),this}}(),copy:function(_){return this.min.copy(_.min),this.max.copy(_.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=Infinity,this.max.x=this.max.y=this.max.z=-Infinity,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(_){var S=_||new THREE.Vector3;return S.addVectors(this.min,this.max).multiplyScalar(0.5)},size:function(_){var S=_||new THREE.Vector3;return S.subVectors(this.max,this.min)},expandByPoint:function(_){return this.min.min(_),this.max.max(_),this},expandByVector:function(_){return this.min.sub(_),this.max.add(_),this},expandByScalar:function(_){return this.min.addScalar(-_),this.max.addScalar(_),this},containsPoint:function(_){return _.x<this.min.x||_.x>this.max.x||_.y<this.min.y||_.y>this.max.y||_.z<this.min.z||_.z>this.max.z?!1:!0},containsBox:function(_){return this.min.x<=_.min.x&&_.max.x<=this.max.x&&this.min.y<=_.min.y&&_.max.y<=this.max.y&&this.min.z<=_.min.z&&_.max.z<=this.max.z},getParameter:function(_){return new THREE.Vector3((_.x-this.min.x)/(this.max.x-this.min.x),(_.y-this.min.y)/(this.max.y-this.min.y),(_.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(_){return _.max.x<this.min.x||_.min.x>this.max.x||_.max.y<this.min.y||_.min.y>this.max.y||_.max.z<this.min.z||_.min.z>this.max.z?!1:!0},clampPoint:function(_,S){var M=S||new THREE.Vector3;return M.copy(_).clamp(this.min,this.max)},distanceToPoint:function(){var _=new THREE.Vector3;return function(S){var M=_.copy(S).clamp(this.min,this.max);return M.sub(S).length()}}(),getBoundingSphere:function(){var _=new THREE.Vector3;return function(S){var M=S||new THREE.Sphere;return M.center=this.center(),M.radius=0.5*this.size(_).length(),M}}(),intersect:function(_){return this.min.max(_.min),this.max.min(_.max),this},union:function(_){return this.min.min(_.min),this.max.max(_.max),this},applyMatrix4:function(){var _=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(S){return _[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(S),_[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(S),_[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(S),_[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(S),_[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(S),_[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(S),_[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(S),_[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(S),this.makeEmpty(),this.setFromPoints(_),this}}(),translate:function(_){return this.min.add(_),this.max.add(_),this},equals:function(_){return _.min.equals(this.min)&&_.max.equals(this.max)},clone:function(){return new THREE.Box3().copy(this)}},THREE.Matrix3=function(_,S,M,T,A,C,E,D,P){this.elements=new Float32Array(9),this.set(_===void 0?1:_,S||0,M||0,T||0,A===void 0?1:A,C||0,E||0,D||0,P===void 0?1:P)},THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(_,S,M,T,A,C,E,D,P){var R=this.elements;return R[0]=_,R[3]=S,R[6]=M,R[1]=T,R[4]=A,R[7]=C,R[2]=E,R[5]=D,R[8]=P,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(_){var S=_.elements;return this.set(S[0],S[3],S[6],S[1],S[4],S[7],S[2],S[5],S[8]),this},multiplyVector3Array:function(){var _=new THREE.Vector3;return function(S){for(var M=0,T=S.length;M<T;M+=3)_.x=S[M],_.y=S[M+1],_.z=S[M+2],_.applyMatrix3(this),S[M]=_.x,S[M+1]=_.y,S[M+2]=_.z;return S}}(),multiplyScalar:function(_){var S=this.elements;return S[0]*=_,S[3]*=_,S[6]*=_,S[1]*=_,S[4]*=_,S[7]*=_,S[2]*=_,S[5]*=_,S[8]*=_,this},determinant:function(){var _=this.elements,S=_[0],M=_[1],T=_[2],A=_[3],C=_[4],E=_[5],D=_[6],P=_[7],R=_[8];return S*C*R-S*E*P-M*A*R+M*E*D+T*A*P-T*C*D},getInverse:function(_){var S=_.elements,M=this.elements;M[0]=S[10]*S[5]-S[6]*S[9],M[1]=-S[10]*S[1]+S[2]*S[9],M[2]=S[6]*S[1]-S[2]*S[5],M[3]=-S[10]*S[4]+S[6]*S[8],M[4]=S[10]*S[0]-S[2]*S[8],M[5]=-S[6]*S[0]+S[2]*S[4],M[6]=S[9]*S[4]-S[5]*S[8],M[7]=-S[9]*S[0]+S[1]*S[8],M[8]=S[5]*S[0]-S[1]*S[4];var T=S[0]*M[0]+S[1]*M[3]+S[2]*M[6];return 0==T?(this.identity(),this):(this.multiplyScalar(1/T),this)},transpose:function(){var S=this.elements,_;return _=S[1],S[1]=S[3],S[3]=_,_=S[2],S[2]=S[6],S[6]=_,_=S[5],S[5]=S[7],S[7]=_,this},getNormalMatrix:function(_){return this.getInverse(_).transpose(),this},transposeIntoArray:function(_){var S=this.elements;return _[0]=S[0],_[1]=S[3],_[2]=S[6],_[3]=S[1],_[4]=S[4],_[5]=S[7],_[6]=S[2],_[7]=S[5],_[8]=S[8],this},clone:function(){var _=this.elements;return new THREE.Matrix3(_[0],_[3],_[6],_[1],_[4],_[7],_[2],_[5],_[8])}},THREE.Matrix4=function(_,S,M,T,A,C,E,D,P,R,L,N,U,F,V,I){var O=this.elements=new Float32Array(16);O[0]=_===void 0?1:_,O[4]=S||0,O[8]=M||0,O[12]=T||0,O[1]=A||0,O[5]=C===void 0?1:C,O[9]=E||0,O[13]=D||0,O[2]=P||0,O[6]=R||0,O[10]=L===void 0?1:L,O[14]=N||0,O[3]=U||0,O[7]=F||0,O[11]=V||0,O[15]=I===void 0?1:I},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(_,S,M,T,A,C,E,D,P,R,L,N,U,F,V,I){var O=this.elements;return O[0]=_,O[4]=S,O[8]=M,O[12]=T,O[1]=A,O[5]=C,O[9]=E,O[13]=D,O[2]=P,O[6]=R,O[10]=L,O[14]=N,O[3]=U,O[7]=F,O[11]=V,O[15]=I,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(_){var S=_.elements;return this.set(S[0],S[4],S[8],S[12],S[1],S[5],S[9],S[13],S[2],S[6],S[10],S[14],S[3],S[7],S[11],S[15]),this},copyPosition:function(_){var S=this.elements,M=_.elements;return S[12]=M[12],S[13]=M[13],S[14]=M[14],this},extractRotation:function(){var _=new THREE.Vector3;return function(S){var M=this.elements,T=S.elements,A=1/_.set(T[0],T[1],T[2]).length(),C=1/_.set(T[4],T[5],T[6]).length(),E=1/_.set(T[8],T[9],T[10]).length();return M[0]=T[0]*A,M[1]=T[1]*A,M[2]=T[2]*A,M[4]=T[4]*C,M[5]=T[5]*C,M[6]=T[6]*C,M[8]=T[8]*E,M[9]=T[9]*E,M[10]=T[10]*E,this}}(),makeRotationFromEuler:function(_,S){var M=this.elements,T=_.x,A=_.y,C=_.z,E=Math.cos(T),D=Math.sin(T),P=Math.cos(A),R=Math.sin(A),L=Math.cos(C),N=Math.sin(C);if(void 0===S||'XYZ'===S){var U=E*L,F=E*N,V=D*L,I=D*N;M[0]=P*L,M[4]=-P*N,M[8]=R,M[1]=F+V*R,M[5]=U-I*R,M[9]=-D*P,M[2]=I-U*R,M[6]=V+F*R,M[10]=E*P}else if('YXZ'===S){var O=P*L,B=P*N,G=R*L,H=R*N;M[0]=O+H*D,M[4]=G*D-B,M[8]=E*R,M[1]=E*N,M[5]=E*L,M[9]=-D,M[2]=B*D-G,M[6]=H+O*D,M[10]=E*P}else if('ZXY'===S){var O=P*L,B=P*N,G=R*L,H=R*N;M[0]=O-H*D,M[4]=-E*N,M[8]=G+B*D,M[1]=B+G*D,M[5]=E*L,M[9]=H-O*D,M[2]=-E*R,M[6]=D,M[10]=E*P}else if('ZYX'===S){var U=E*L,F=E*N,V=D*L,I=D*N;M[0]=P*L,M[4]=V*R-F,M[8]=U*R+I,M[1]=P*N,M[5]=I*R+U,M[9]=F*R-V,M[2]=-R,M[6]=D*P,M[10]=E*P}else if('YZX'===S){var W=E*P,X=E*R,Y=D*P,K=D*R;M[0]=P*L,M[4]=K-W*N,M[8]=Y*N+X,M[1]=N,M[5]=E*L,M[9]=-D*L,M[2]=-R*L,M[6]=X*N+Y,M[10]=W-K*N}else if('XZY'===S){var W=E*P,X=E*R,Y=D*P,K=D*R;M[0]=P*L,M[4]=-N,M[8]=R*L,M[1]=W*N+K,M[5]=E*L,M[9]=X*N-Y,M[2]=Y*N-X,M[6]=D*L,M[10]=K*N+W}return M[3]=0,M[7]=0,M[11]=0,M[12]=0,M[13]=0,M[14]=0,M[15]=1,this},makeRotationFromQuaternion:function(_){var S=this.elements,M=_.x,T=_.y,A=_.z,C=_.w,E=M+M,D=T+T,P=A+A,R=M*E,L=M*D,N=M*P,U=T*D,F=T*P,V=A*P,I=C*E,O=C*D,B=C*P;return S[0]=1-(U+V),S[4]=L-B,S[8]=N+O,S[1]=L+B,S[5]=1-(R+V),S[9]=F-I,S[2]=N-O,S[6]=F+I,S[10]=1-(R+U),S[3]=0,S[7]=0,S[11]=0,S[12]=0,S[13]=0,S[14]=0,S[15]=1,this},lookAt:function(){var _=new THREE.Vector3,S=new THREE.Vector3,M=new THREE.Vector3;return function(T,A,C){var E=this.elements;return M.subVectors(T,A).normalize(),0===M.length()&&(M.z=1),_.crossVectors(C,M).normalize(),0===_.length()&&(M.x+=1e-4,_.crossVectors(C,M).normalize()),S.crossVectors(M,_),E[0]=_.x,E[4]=S.x,E[8]=M.x,E[1]=_.y,E[5]=S.y,E[9]=M.y,E[2]=_.z,E[6]=S.z,E[10]=M.z,this}}(),multiply:function(_){return this.multiplyMatrices(this,_)},multiplyMatrices:function(_,S){var M=_.elements,T=S.elements,A=this.elements,C=M[0],E=M[4],D=M[8],P=M[12],R=M[1],L=M[5],N=M[9],U=M[13],F=M[2],V=M[6],I=M[10],O=M[14],B=M[3],G=M[7],H=M[11],W=M[15],X=T[0],Y=T[4],K=T[8],Q=T[12],Z=T[1],J=T[5],ee=T[9],re=T[13],oe=T[2],ie=T[6],ne=T[10],se=T[14],le=T[3],pe=T[7],ue=T[11],fe=T[15];return A[0]=C*X+E*Z+D*oe+P*le,A[4]=C*Y+E*J+D*ie+P*pe,A[8]=C*K+E*ee+D*ne+P*ue,A[12]=C*Q+E*re+D*se+P*fe,A[1]=R*X+L*Z+N*oe+U*le,A[5]=R*Y+L*J+N*ie+U*pe,A[9]=R*K+L*ee+N*ne+U*ue,A[13]=R*Q+L*re+N*se+U*fe,A[2]=F*X+V*Z+I*oe+O*le,A[6]=F*Y+V*J+I*ie+O*pe,A[10]=F*K+V*ee+I*ne+O*ue,A[14]=F*Q+V*re+I*se+O*fe,A[3]=B*X+G*Z+H*oe+W*le,A[7]=B*Y+G*J+H*ie+W*pe,A[11]=B*K+G*ee+H*ne+W*ue,A[15]=B*Q+G*re+H*se+W*fe,this},multiplyToArray:function(_,S,M){var T=this.elements;return this.multiplyMatrices(_,S),M[0]=T[0],M[1]=T[1],M[2]=T[2],M[3]=T[3],M[4]=T[4],M[5]=T[5],M[6]=T[6],M[7]=T[7],M[8]=T[8],M[9]=T[9],M[10]=T[10],M[11]=T[11],M[12]=T[12],M[13]=T[13],M[14]=T[14],M[15]=T[15],this},multiplyScalar:function(_){var S=this.elements;return S[0]*=_,S[4]*=_,S[8]*=_,S[12]*=_,S[1]*=_,S[5]*=_,S[9]*=_,S[13]*=_,S[2]*=_,S[6]*=_,S[10]*=_,S[14]*=_,S[3]*=_,S[7]*=_,S[11]*=_,S[15]*=_,this},multiplyVector3Array:function(){var _=new THREE.Vector3;return function(S){for(var M=0,T=S.length;M<T;M+=3)_.x=S[M],_.y=S[M+1],_.z=S[M+2],_.applyProjection(this),S[M]=_.x,S[M+1]=_.y,S[M+2]=_.z;return S}}(),determinant:function(){var _=this.elements,S=_[0],M=_[4],T=_[8],A=_[12],C=_[1],E=_[5],D=_[9],P=_[13],R=_[2],L=_[6],N=_[10],U=_[14],F=_[3],V=_[7],I=_[11],O=_[15];return F*(+A*D*L-T*P*L-A*E*N+M*P*N+T*E*U-M*D*U)+V*(+S*D*U-S*P*N+A*C*N-T*C*U+T*P*R-A*D*R)+I*(+S*P*L-S*E*U-A*C*L+M*C*U+A*E*R-M*P*R)+O*(-T*E*R-S*D*L+S*E*N+T*C*L-M*C*N+M*D*R)},transpose:function(){var _=this.elements,S;return S=_[1],_[1]=_[4],_[4]=S,S=_[2],_[2]=_[8],_[8]=S,S=_[6],_[6]=_[9],_[9]=S,S=_[3],_[3]=_[12],_[12]=S,S=_[7],_[7]=_[13],_[13]=S,S=_[11],_[11]=_[14],_[14]=S,this},flattenToArray:function(_){var S=this.elements;return _[0]=S[0],_[1]=S[1],_[2]=S[2],_[3]=S[3],_[4]=S[4],_[5]=S[5],_[6]=S[6],_[7]=S[7],_[8]=S[8],_[9]=S[9],_[10]=S[10],_[11]=S[11],_[12]=S[12],_[13]=S[13],_[14]=S[14],_[15]=S[15],_},flattenToArrayOffset:function(_,S){var M=this.elements;return _[S]=M[0],_[S+1]=M[1],_[S+2]=M[2],_[S+3]=M[3],_[S+4]=M[4],_[S+5]=M[5],_[S+6]=M[6],_[S+7]=M[7],_[S+8]=M[8],_[S+9]=M[9],_[S+10]=M[10],_[S+11]=M[11],_[S+12]=M[12],_[S+13]=M[13],_[S+14]=M[14],_[S+15]=M[15],_},setPosition:function(_){var S=this.elements;return S[12]=_.x,S[13]=_.y,S[14]=_.z,this},getInverse:function(_){var S=this.elements,M=_.elements,T=M[0],A=M[4],C=M[8],E=M[12],D=M[1],P=M[5],R=M[9],L=M[13],N=M[2],U=M[6],F=M[10],V=M[14],I=M[3],O=M[7],B=M[11],G=M[15];S[0]=R*V*O-L*F*O+L*U*B-P*V*B-R*U*G+P*F*G,S[4]=E*F*O-C*V*O-E*U*B+A*V*B+C*U*G-A*F*G,S[8]=C*L*O-E*R*O+E*P*B-A*L*B-C*P*G+A*R*G,S[12]=E*R*U-C*L*U-E*P*F+A*L*F+C*P*V-A*R*V,S[1]=L*F*I-R*V*I-L*N*B+D*V*B+R*N*G-D*F*G,S[5]=C*V*I-E*F*I+E*N*B-T*V*B-C*N*G+T*F*G,S[9]=E*R*I-C*L*I-E*D*B+T*L*B+C*D*G-T*R*G,S[13]=C*L*N-E*R*N+E*D*F-T*L*F-C*D*V+T*R*V,S[2]=P*V*I-L*U*I+L*N*O-D*V*O-P*N*G+D*U*G,S[6]=E*U*I-A*V*I-E*N*O+T*V*O+A*N*G-T*U*G,S[10]=A*L*I-E*P*I+E*D*O-T*L*O-A*D*G+T*P*G,S[14]=E*P*N-A*L*N-E*D*U+T*L*U+A*D*V-T*P*V,S[3]=R*U*I-P*F*I-R*N*O+D*F*O+P*N*B-D*U*B,S[7]=A*F*I-C*U*I+C*N*O-T*F*O-A*N*B+T*U*B,S[11]=C*P*I-A*R*I-C*D*O+T*R*O+A*D*B-T*P*B,S[15]=A*R*N-C*P*N+C*D*U-T*R*U-A*D*F+T*P*F;var H=M[0]*S[0]+M[1]*S[4]+M[2]*S[8]+M[3]*S[12];return 0==H?(this.identity(),this):(this.multiplyScalar(1/H),this)},scale:function(_){var S=this.elements,M=_.x,T=_.y,A=_.z;return S[0]*=M,S[4]*=T,S[8]*=A,S[1]*=M,S[5]*=T,S[9]*=A,S[2]*=M,S[6]*=T,S[10]*=A,S[3]*=M,S[7]*=T,S[11]*=A,this},getMaxScaleOnAxis:function(){var _=this.elements,S=_[0]*_[0]+_[1]*_[1]+_[2]*_[2],M=_[4]*_[4]+_[5]*_[5]+_[6]*_[6],T=_[8]*_[8]+_[9]*_[9]+_[10]*_[10];return Math.sqrt(Math.max(S,Math.max(M,T)))},makeTranslation:function(_,S,M){return this.set(1,0,0,_,0,1,0,S,0,0,1,M,0,0,0,1),this},makeRotationX:function(_){var S=Math.cos(_),M=Math.sin(_);return this.set(1,0,0,0,0,S,-M,0,0,M,S,0,0,0,0,1),this},makeRotationY:function(_){var S=Math.cos(_),M=Math.sin(_);return this.set(S,0,M,0,0,1,0,0,-M,0,S,0,0,0,0,1),this},makeRotationZ:function(_){var S=Math.cos(_),M=Math.sin(_);return this.set(S,-M,0,0,M,S,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(_,S){var M=Math.cos(S),T=Math.sin(S),A=1-M,C=_.x,E=_.y,D=_.z,P=A*C,R=A*E;return this.set(P*C+M,P*E-T*D,P*D+T*E,0,P*E+T*D,R*E+M,R*D-T*C,0,P*D-T*E,R*D+T*C,A*D*D+M,0,0,0,0,1),this},makeScale:function(_,S,M){return this.set(_,0,0,0,0,S,0,0,0,0,M,0,0,0,0,1),this},makeFromPositionQuaternionScale:function(_,S,M){return this.makeRotationFromQuaternion(S),this.scale(M),this.setPosition(_),this},makeFromPositionEulerScale:function(_,S,M,T){return this.makeRotationFromEuler(S,M),this.scale(T),this.setPosition(_),this},makeFrustum:function(_,S,M,T,A,C){var E=this.elements;return E[0]=2*A/(S-_),E[4]=0,E[8]=(S+_)/(S-_),E[12]=0,E[1]=0,E[5]=2*A/(T-M),E[9]=(T+M)/(T-M),E[13]=0,E[2]=0,E[6]=0,E[10]=-(C+A)/(C-A),E[14]=-2*C*A/(C-A),E[3]=0,E[7]=0,E[11]=-1,E[15]=0,this},makePerspective:function(_,S,M,T){var A=M*Math.tan(THREE.Math.degToRad(0.5*_)),C=-A;return this.makeFrustum(C*S,A*S,C,A,M,T)},makeOrthographic:function(_,S,M,T,A,C){var E=this.elements,D=S-_,P=M-T,R=C-A;return E[0]=2/D,E[4]=0,E[8]=0,E[12]=-((S+_)/D),E[1]=0,E[5]=2/P,E[9]=0,E[13]=-((M+T)/P),E[2]=0,E[6]=0,E[10]=-2/R,E[14]=-((C+A)/R),E[3]=0,E[7]=0,E[11]=0,E[15]=1,this},clone:function(){var _=this.elements;return new THREE.Matrix4(_[0],_[4],_[8],_[12],_[1],_[5],_[9],_[13],_[2],_[6],_[10],_[14],_[3],_[7],_[11],_[15])}},THREE.Matrix4.prototype.decompose=function(){var _=new THREE.Vector3,S=new THREE.Vector3,M=new THREE.Vector3,T=new THREE.Matrix4;return function(A,C,E){var D=this.elements;return _.set(D[0],D[1],D[2]),S.set(D[4],D[5],D[6]),M.set(D[8],D[9],D[10]),A=A instanceof THREE.Vector3?A:new THREE.Vector3,C=C instanceof THREE.Quaternion?C:new THREE.Quaternion,E=E instanceof THREE.Vector3?E:new THREE.Vector3,E.x=_.length(),E.y=S.length(),E.z=M.length(),A.x=D[12],A.y=D[13],A.z=D[14],T instanceof THREE.Matrix4||(T=new THREE.Matrix4),T.copy(this),T.elements[0]/=E.x,T.elements[1]/=E.x,T.elements[2]/=E.x,T.elements[4]/=E.y,T.elements[5]/=E.y,T.elements[6]/=E.y,T.elements[8]/=E.z,T.elements[9]/=E.z,T.elements[10]/=E.z,C.setFromRotationMatrix(T),[A,C,E]}}(),THREE.Ray=function(_,S){this.origin=_===void 0?new THREE.Vector3:_,this.direction=S===void 0?new THREE.Vector3:S},THREE.Ray.prototype={constructor:THREE.Ray,set:function(_,S){return this.origin.copy(_),this.direction.copy(S),this},copy:function(_){return this.origin.copy(_.origin),this.direction.copy(_.direction),this},at:function(_,S){var M=S||new THREE.Vector3;return M.copy(this.direction).multiplyScalar(_).add(this.origin)},recast:function(){var _=new THREE.Vector3;return function(S){return this.origin.copy(this.at(S,_)),this}}(),closestPointToPoint:function(_,S){var M=S||new THREE.Vector3;M.subVectors(_,this.origin);var T=M.dot(this.direction);return M.copy(this.direction).multiplyScalar(T).add(this.origin)},distanceToPoint:function(){var _=new THREE.Vector3;return function(S){var M=_.subVectors(S,this.origin).dot(this.direction);return _.copy(this.direction).multiplyScalar(M).add(this.origin),_.distanceTo(S)}}(),isIntersectionSphere:function(_){return this.distanceToPoint(_.center)<=_.radius},isIntersectionPlane:function(_){var S=_.normal.dot(this.direction);return 0!=S||!(0!=_.distanceToPoint(this.origin))},distanceToPlane:function(_){var S=_.normal.dot(this.direction);if(0==S)return 0==_.distanceToPoint(this.origin)?0:void 0;var M=-(this.origin.dot(_.normal)+_.constant)/S;return M},intersectPlane:function(_,S){var M=this.distanceToPlane(_);return void 0===M?void 0:this.at(M,S)},applyMatrix4:function(_){return this.direction.add(this.origin).applyMatrix4(_),this.origin.applyMatrix4(_),this.direction.sub(this.origin),this},equals:function(_){return _.origin.equals(this.origin)&&_.direction.equals(this.direction)},clone:function(){return new THREE.Ray().copy(this)},intersectBox:function(_,S){var P=1/this.direction.x,R=1/this.direction.y,L=1/this.direction.z,N=this.origin,M,T,A,C,E,D;return(0<=P?(M=(_.min.x-N.x)*P,T=(_.max.x-N.x)*P):(M=(_.max.x-N.x)*P,T=(_.min.x-N.x)*P),0<=R?(A=(_.min.y-N.y)*R,C=(_.max.y-N.y)*R):(A=(_.max.y-N.y)*R,C=(_.min.y-N.y)*R),M>C||A>T)?null:((A>M||M!=M)&&(M=A),(C<T||T!=T)&&(T=C),0<=L?(E=(_.min.z-N.z)*L,D=(_.max.z-N.z)*L):(E=(_.max.z-N.z)*L,D=(_.min.z-N.z)*L),M>D||E>T)?null:((E>M||M!=M)&&(M=E),(D<T||T!=T)&&(T=D),0>T?null:this.at(0<=M?M:T,S))}},THREE.Sphere=function(_,S){this.center=_===void 0?new THREE.Vector3:_,this.radius=S===void 0?0:S},THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(_,S){return this.center.copy(_),this.radius=S,this},setFromCenterAndPoints:function(_,S){for(var M=0,T=0,A=S.length,C;T<A;T++)C=_.distanceToSquared(S[T]),M=Math.max(M,C);return this.center=_,this.radius=Math.sqrt(M),this},copy:function(_){return this.center.copy(_.center),this.radius=_.radius,this},empty:function(){return 0>=this.radius},containsPoint:function(_){return _.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(_){return _.distanceTo(this.center)-this.radius},intersectsSphere:function(_){var S=this.radius+_.radius;return _.center.distanceToSquared(this.center)<=S*S},clampPoint:function(_,S){var M=this.center.distanceToSquared(_),T=S||new THREE.Vector3;return T.copy(_),M>this.radius*this.radius&&(T.sub(this.center).normalize(),T.multiplyScalar(this.radius).add(this.center)),T},getBoundingBox:function(_){var S=_||new THREE.Box3;return S.set(this.center,this.center),S.expandByScalar(this.radius),S},applyMatrix4:function(_){return this.center.applyMatrix4(_),this.radius*=_.getMaxScaleOnAxis(),this},translate:function(_){return this.center.add(_),this},equals:function(_){return _.center.equals(this.center)&&_.radius===this.radius},clone:function(){return new THREE.Sphere().copy(this)}},THREE.Frustum=function(_,S,M,T,A,C){this.planes=[_===void 0?new THREE.Plane:_,S===void 0?new THREE.Plane:S,M===void 0?new THREE.Plane:M,T===void 0?new THREE.Plane:T,A===void 0?new THREE.Plane:A,C===void 0?new THREE.Plane:C]},THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(_,S,M,T,A,C){var E=this.planes;return E[0].copy(_),E[1].copy(S),E[2].copy(M),E[3].copy(T),E[4].copy(A),E[5].copy(C),this},copy:function(_){for(var S=this.planes,M=0;6>M;M++)S[M].copy(_.planes[M]);return this},setFromMatrix:function(_){var S=this.planes,M=_.elements,T=M[0],A=M[1],C=M[2],E=M[3],D=M[4],P=M[5],R=M[6],L=M[7],N=M[8],U=M[9],F=M[10],V=M[11],I=M[12],O=M[13],B=M[14],G=M[15];return S[0].setComponents(E-T,L-D,V-N,G-I).normalize(),S[1].setComponents(E+T,L+D,V+N,G+I).normalize(),S[2].setComponents(E+A,L+P,V+U,G+O).normalize(),S[3].setComponents(E-A,L-P,V-U,G-O).normalize(),S[4].setComponents(E-C,L-R,V-F,G-B).normalize(),S[5].setComponents(E+C,L+R,V+F,G+B).normalize(),this},_containing:!1,intersectsOrContainsObject:function(){var _=new THREE.Vector3;return function(S){this._containing=!0;var M=S.geometry,T=S.matrixWorld;null===M.boundingSphere&&M.computeBoundingSphere();var A=-M.boundingSphere.radius*T.getMaxScaleOnAxis();_.getPositionFromMatrix(T);for(var C=this.planes,E=0,D;6>E;E++){if(D=C[E].distanceToPoint(_),D<A)return!1;D<-A&&(this._containing=!1)}return!0}}(),intersectsObject:function(){var _=new THREE.Vector3;return function(S){var M=S.geometry,T=S.matrixWorld;null===M.boundingSphere&&M.computeBoundingSphere();var A=-M.boundingSphere.radius*T.getMaxScaleOnAxis();_.getPositionFromMatrix(T);for(var C=this.planes,E=0,D;6>E;E++)if(D=C[E].distanceToPoint(_),D<A)return!1;return!0}}(),intersectsSphere:function(_){for(var S=this.planes,M=_.center,T=-_.radius,A=0,C;6>A;A++)if(C=S[A].distanceToPoint(M),C<T)return!1;return!0},containsPoint:function(_){for(var S=this.planes,M=0;6>M;M++)if(0>S[M].distanceToPoint(_))return!1;return!0},clone:function(){return new THREE.Frustum().copy(this)}},THREE.Plane=function(_,S){this.normal=_===void 0?new THREE.Vector3(1,0,0):_,this.constant=S===void 0?0:S},THREE.Plane.prototype={constructor:THREE.Plane,set:function(_,S){return this.normal.copy(_),this.constant=S,this},setComponents:function(_,S,M,T){return this.normal.set(_,S,M),this.constant=T,this},setFromNormalAndCoplanarPoint:function(_,S){return this.normal.copy(_),this.constant=-S.dot(this.normal),this},setFromCoplanarPoints:function(){var _=new THREE.Vector3,S=new THREE.Vector3;return function(M,T,A){var C=_.subVectors(A,T).cross(S.subVectors(M,T)).normalize();return this.setFromNormalAndCoplanarPoint(C,M),this}}(),copy:function(_){return this.normal.copy(_.normal),this.constant=_.constant,this},normalize:function(){var _=1/this.normal.length();return this.normal.multiplyScalar(_),this.constant*=_,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(_){return this.normal.dot(_)+this.constant},distanceToSphere:function(_){return this.distanceToPoint(_.center)-_.radius},projectPoint:function(_,S){return this.orthoPoint(_,S).sub(_).negate()},orthoPoint:function(_,S){var M=this.distanceToPoint(_),T=S||new THREE.Vector3;return T.copy(this.normal).multiplyScalar(M)},isIntersectionLine:function(_){var S=this.distanceToPoint(_.start),M=this.distanceToPoint(_.end);return 0>S&&0<M||0>M&&0<S},intersectLine:function(){var _=new THREE.Vector3;return function(S,M){var T=M||new THREE.Vector3,A=S.delta(_),C=this.normal.dot(A);if(0==C)return 0==this.distanceToPoint(S.start)?T.copy(S.start):void 0;var E=-(S.start.dot(this.normal)+this.constant)/C;return 0>E||1<E?void 0:T.copy(A).multiplyScalar(E).add(S.start)}}(),coplanarPoint:function(_){var S=_||new THREE.Vector3;return S.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var _=new THREE.Vector3,S=new THREE.Vector3;return function(M,T){T=T||new THREE.Matrix3().getNormalMatrix(M);var A=_.copy(this.normal).applyMatrix3(T),C=this.coplanarPoint(S);return C.applyMatrix4(M),this.setFromNormalAndCoplanarPoint(A,C),this}}(),translate:function(_){return this.constant-=_.dot(this.normal),this},equals:function(_){return _.normal.equals(this.normal)&&_.constant==this.constant},clone:function(){return new THREE.Plane().copy(this)}},THREE.Math={generateUUID:function(){for(var _=[],S=0;256>S;S++)_[S]=(16>S?'0':'')+S.toString(16);return function(){var T=0|4294967295*Math.random(),A=0|4294967295*Math.random(),C=0|4294967295*Math.random(),E=0|4294967295*Math.random(),D=_[255&T]+_[255&T>>8]+_[255&T>>16]+_[255&T>>24]+'-'+_[255&A]+_[255&A>>8]+'-'+_[64|15&A>>16]+_[255&A>>24]+'-'+_[128|63&C]+_[255&C>>8]+'-'+_[255&C>>16]+_[255&C>>24]+_[255&E]+_[255&E>>8]+_[255&E>>16]+_[255&E>>24];return D.toUpperCase()}}(),clamp:function(_,S,M){return _<S?S:_>M?M:_},clampBottom:function(_,S){return _<S?S:_},mapLinear:function(_,S,M,T,A){return T+(_-S)*(A-T)/(M-S)},smoothstep:function(_,S,M){return _<=S?0:_>=M?1:(_=(_-S)/(M-S),_*_*(3-2*_))},smootherstep:function(_,S,M){return _<=S?0:_>=M?1:(_=(_-S)/(M-S),_*_*_*(_*(6*_-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(_,S){return _+Math.floor(Math.random()*(S-_+1))},randFloat:function(_,S){return _+Math.random()*(S-_)},randFloatSpread:function(_){return _*(0.5-Math.random())},sign:function(_){return 0>_?-1:0<_?1:0},degToRad:function(){var _=Math.PI/180;return function(S){return S*_}}(),radToDeg:function(){var _=180/Math.PI;return function(S){return S*_}}()},THREE.Spline=function(_){function S(F,V,I,O,B,G,H){var W=0.5*(I-F),X=0.5*(O-V);return(2*(V-I)+W+X)*H+(-3*(V-I)-2*W-X)*G+W*B+V}this.points=_;var M=[],T={x:0,y:0,z:0},A,C,E,D,P,R,L,N,U;this.initFromArray=function(F){this.points=[];for(var V=0;V<F.length;V++)this.points[V]={x:F[V][0],y:F[V][1],z:F[V][2]}},this.getPoint=function(F){return A=(this.points.length-1)*F,C=Math.floor(A),E=A-C,M[0]=0===C?C:C-1,M[1]=C,M[2]=C>this.points.length-2?this.points.length-1:C+1,M[3]=C>this.points.length-3?this.points.length-1:C+2,R=this.points[M[0]],L=this.points[M[1]],N=this.points[M[2]],U=this.points[M[3]],D=E*E,P=E*D,T.x=S(R.x,L.x,N.x,U.x,E,D,P),T.y=S(R.y,L.y,N.y,U.y,E,D,P),T.z=S(R.z,L.z,N.z,U.z,E,D,P),T},this.getControlPointsArray=function(){var I=this.points.length,O=[],F,V;for(F=0;F<I;F++)V=this.points[F],O[F]=[V.x,V.y,V.z];return O},this.getLength=function(F){var G=0,H=0,W=0,X=new THREE.Vector3,Y=new THREE.Vector3,K=[],Q=0,V,I,O,B;for(K[0]=0,F||(F=100),O=this.points.length*F,X.copy(this.points[0]),V=1;V<O;V++)I=V/O,B=this.getPoint(I),Y.copy(B),Q+=Y.distanceTo(X),X.copy(B),G=(this.points.length-1)*I,H=Math.floor(G),H!=W&&(K[H]=Q,W=H);return K[K.length]=Q,{chunks:K,total:Q}},this.reparametrizeByArcLength=function(F){var K=[],Q=new THREE.Vector3,Z=this.getLength(),V,I,O,B,G,W,X,Y;for(K.push(Q.copy(this.points[0]).clone()),V=1;V<this.points.length;V++){for(W=Z.chunks[V]-Z.chunks[V-1],X=Math.ceil(F*W/Z.total),B=(V-1)/(this.points.length-1),G=V/(this.points.length-1),I=1;I<X-1;I++)O=B+I*(1/X)*(G-B),Y=this.getPoint(O),K.push(Q.copy(Y).clone());K.push(Q.copy(this.points[V]).clone())}this.points=K}},THREE.Triangle=function(_,S,M){this.a=_===void 0?new THREE.Vector3:_,this.b=S===void 0?new THREE.Vector3:S,this.c=M===void 0?new THREE.Vector3:M},THREE.Triangle.normal=function(){var _=new THREE.Vector3;return function(S,M,T,A){var C=A||new THREE.Vector3;C.subVectors(T,M),_.subVectors(S,M),C.cross(_);var E=C.lengthSq();return 0<E?C.multiplyScalar(1/Math.sqrt(E)):C.set(0,0,0)}}(),THREE.Triangle.barycoordFromPoint=function(){var _=new THREE.Vector3,S=new THREE.Vector3,M=new THREE.Vector3;return function(T,A,C,E,D){_.subVectors(E,A),S.subVectors(C,A),M.subVectors(T,A);var P=_.dot(_),R=_.dot(S),L=_.dot(M),N=S.dot(S),U=S.dot(M),F=P*N-R*R,V=D||new THREE.Vector3;if(0==F)return V.set(-2,-1,-1);var I=1/F,O=(N*L-R*U)*I,B=(P*U-R*L)*I;return V.set(1-O-B,B,O)}}(),THREE.Triangle.containsPoint=function(){var _=new THREE.Vector3;return function(S,M,T,A){var C=THREE.Triangle.barycoordFromPoint(S,M,T,A,_);return 0<=C.x&&0<=C.y&&1>=C.x+C.y}}(),THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(_,S,M){return this.a.copy(_),this.b.copy(S),this.c.copy(M),this},setFromPointsAndIndices:function(_,S,M,T){return this.a.copy(_[S]),this.b.copy(_[M]),this.c.copy(_[T]),this},copy:function(_){return this.a.copy(_.a),this.b.copy(_.b),this.c.copy(_.c),this},area:function(){var _=new THREE.Vector3,S=new THREE.Vector3;return function(){return _.subVectors(this.c,this.b),S.subVectors(this.a,this.b),0.5*_.cross(S).length()}}(),midpoint:function(_){var S=_||new THREE.Vector3;return S.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(_){return THREE.Triangle.normal(this.a,this.b,this.c,_)},plane:function(_){var S=_||new THREE.Plane;return S.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(_,S){return THREE.Triangle.barycoordFromPoint(_,this.a,this.b,this.c,S)},containsPoint:function(_){return THREE.Triangle.containsPoint(_,this.a,this.b,this.c)},equals:function(_){return _.a.equals(this.a)&&_.b.equals(this.b)&&_.c.equals(this.c)},clone:function(){return new THREE.Triangle().copy(this)}},THREE.now=function(){var _=self.performance!==void 0&&self.performance.now!==void 0?self.performance:Date;return function(){return _.now()}}(),THREE.Clock=function(_){this.autoStart=!(_!==void 0)||_,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.startTime=('undefined'==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var _=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var S=('undefined'==typeof performance?Date:performance).now();_=(S-this.oldTime)/1e3,this.oldTime=S,this.elapsedTime+=_}return _}},THREE.EventDispatcher=function(){},THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(_){_.addEventListener=THREE.EventDispatcher.prototype.addEventListener,_.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener,_.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener,_.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(_,S){this._listeners===void 0&&(this._listeners={});var M=this._listeners;M[_]===void 0&&(M[_]=[]),-1===M[_].indexOf(S)&&M[_].push(S)},hasEventListener:function(_,S){if(this._listeners===void 0)return!1;var M=this._listeners;return void 0!==M[_]&&-1!==M[_].indexOf(S)},removeEventListener:function(_,S){if(void 0!==this._listeners){var M=this._listeners,T=M[_].indexOf(S);-1!==T&&M[_].splice(T,1)}},dispatchEvent:function(_){if(void 0!==this._listeners){var S=this._listeners,M=S[_.type];if(void 0!==M){_.target=this;for(var T=0,A=M.length;T<A;T++)M[T].call(this,_)}}}},function(_){_.Raycaster=function(L,N,U,F){this.ray=new _.Ray(L,N),0<this.ray.direction.lengthSq()&&this.ray.direction.normalize(),this.near=U||0,this.far=F||Infinity};var S=new _.Sphere,M=new _.Ray,T=new _.Plane,A=new _.Vector3,C=new _.Vector3,E=new _.Matrix4,D=function(L,N){return L.distance-N.distance},P=function(L,N,U){if(L instanceof _.Particle){C.getPositionFromMatrix(L.matrixWorld);var F=N.ray.distanceToPoint(C);if(F>L.scale.x)return U;U.push({distance:F,point:L.position,face:null,object:L})}else if(L instanceof _.LOD){C.getPositionFromMatrix(L.matrixWorld);var F=N.ray.origin.distanceTo(C);P(L.getObjectForDistance(F),N,U)}else if(L instanceof _.Mesh){if(C.getPositionFromMatrix(L.matrixWorld),S.set(C,L.geometry.boundingSphere.radius*L.matrixWorld.getMaxScaleOnAxis()),!N.ray.isIntersectionSphere(S))return U;var V=L.geometry,I=V.vertices,O=L.material instanceof _.MeshFaceMaterial,B=!0===O?L.material.materials:null,G=L.material.side,K=N.precision,H,W,X,Y;E.getInverse(L.matrixWorld),M.copy(N.ray).applyMatrix4(E);for(var Q=0,Z=V.faces.length;Q<Z;Q++){var J=V.faces[Q],ee=!0==O?B[J.materialIndex]:L.material;if(void 0!==ee){T.setFromNormalAndCoplanarPoint(J.normal,I[J.a]);var re=M.distanceToPlane(T);if(!(Math.abs(re)<K)&&!(0>re)){if(G=ee.side,G!==_.DoubleSide){var oe=M.direction.dot(T.normal);if(G===_.FrontSide?!(0>oe):!(0<oe))continue}if(!(re<N.near||re>N.far)){if(A=M.at(re,A),J instanceof _.Face3){if(H=I[J.a],W=I[J.b],X=I[J.c],!_.Triangle.containsPoint(A,H,W,X))continue;}else if(J instanceof _.Face4&&(H=I[J.a],W=I[J.b],X=I[J.c],Y=I[J.d],!_.Triangle.containsPoint(A,H,W,Y)&&!_.Triangle.containsPoint(A,W,X,Y)))continue;U.push({distance:re,point:N.ray.at(re),face:J,faceIndex:Q,object:L})}}}}}},R=function(L,N,U){for(var F=L.getDescendants(),V=0,I=F.length;V<I;V++)P(F[V],N,U)};_.Raycaster.prototype.precision=1e-4,_.Raycaster.prototype.set=function(L,N){this.ray.set(L,N),0<this.ray.direction.length()&&this.ray.direction.normalize()},_.Raycaster.prototype.intersectObject=function(L,N){var U=[];return!0===N&&R(L,this,U),P(L,this,U),U.sort(D),U},_.Raycaster.prototype.intersectObjects=function(L,N){for(var U=[],F=L.length;F;)P(L[--F],this,U),N&&R(L[F],this,U);return U.sort(D),U}}(THREE),THREE.Object3D=function(){this.id=THREE.Object3DIdCount++,this.name='',this.parent=void 0,this.children=[],this.up=new THREE.Vector3(0,1,0),this.position=new THREE.Vector3,this.rotate=this.rotation=new THREE.Vector3,this.eulerOrder=THREE.Object3D.defaultEulerOrder,this.scale=new THREE.Vector3(1,1,1),this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.quaternion=new THREE.Quaternion,this.useQuaternion=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.userData={},this._lookAt=new THREE.Vector3,this.qtAxisAngle=new THREE.Quaternion},THREE.Object3D.prototype={constructor:THREE.Object3D,applyMatrix:function(){var _=new THREE.Matrix4;return function(S){this.matrix.multiplyMatrices(S,this.matrix),this.position.getPositionFromMatrix(this.matrix),this.scale.getScaleFromMatrix(this.matrix),_.extractRotation(this.matrix),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(_):this.rotation.setEulerFromRotationMatrix(_,this.eulerOrder)}}(),rotateOnAxis:function(){var _=new THREE.Quaternion,S=new THREE.Quaternion;return function(M,T){return _.setFromAxisAngle(M,T),!0===this.useQuaternion?this.quaternion.multiply(_):(S.setFromEuler(this.rotation,this.eulerOrder),S.multiply(_),this.rotation.setEulerFromQuaternion(S,this.eulerOrder)),this}}(),translateOnAxis:function(){var _=new THREE.Vector3;return function(S,M){return _.copy(S),!0===this.useQuaternion?_.applyQuaternion(this.quaternion):_.applyEuler(this.rotation,this.eulerOrder),this.position.add(_.multiplyScalar(M)),this}}(),translateX:function(){var _=new THREE.Vector3(1,0,0);return function(S){return this.translateOnAxis(_,S)}}(),translateY:function(){var _=new THREE.Vector3(0,1,0);return function(S){return this.translateOnAxis(_,S)}}(),translateZ:function(){var _=new THREE.Vector3(0,0,1);return function(S){return this.translateOnAxis(_,S)}}(),localToWorld:function(_){return _.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var _=new THREE.Matrix4;return function(S){return S.applyMatrix4(_.getInverse(this.matrixWorld))}}(),lookAt:function(){var _=new THREE.Matrix4;return function(S){_.lookAt(S,this.position,this.up),this._lookAt.copy(S),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(_):this.rotation.setEulerFromRotationMatrix(_,this.eulerOrder)}}(),add:function(_){_.parent!==void 0&&_.parent.remove(_),_.parent=this,_.dispatchEvent({type:'added'}),jThree.styleHooks.display.set(_),jThree.styleHooks.opacity.set(_),this.children.push(_);for(var S=this;S.parent!==void 0;)S=S.parent;S!==void 0&&S instanceof THREE.Scene&&(S.__addObject(_),_.userData.dom&&(_.userData.scene=S,S.eventChange($._data(_.userData.dom,'events'),_)))},remove:function(_){var S=this.children.indexOf(_);if(-1!==S){_.parent=void 0,_.traverse(function(T){T.dispatchEvent({type:'removed'})}),this.children.splice(S,1);for(var M=this;M.parent!==void 0;)M=M.parent;M!==void 0&&M instanceof THREE.Scene&&(M.__removeObject(_),_.userData.dom&&(_.userData.scene=void 0,M.eventChange(!1,_)))}},traverse:function(_){_(this);for(var S=0,M=this.children.length;S<M&&!(!1===this.children[S].traverse(_));S++);},getObjectById:function(_,S){for(var M=0,T=this.children.length,A;M<T;M++){if(A=this.children[M],A.id===_)return A;if(!0===S&&(A=A.getObjectById(_,S),void 0!==A))return A}},getObjectByName:function(_,S){for(var M=0,T=this.children.length,A;M<T;M++){if(A=this.children[M],A.name===_)return A;if(!0===S&&(A=A.getObjectByName(_,S),void 0!==A))return A}},getDescendants:function(_){_===void 0&&(_=[]),Array.prototype.push.apply(_,this.children);for(var S=0,M=this.children.length;S<M;S++)this.children[S].getDescendants(_);return _},updateMatrix:function(){!1===this.useQuaternion?this.matrix.makeFromPositionEulerScale(this.position,this.rotation,this.eulerOrder,this.scale):this.matrix.makeFromPositionQuaternionScale(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(_){!0===this.matrixAutoUpdate&&this.updateMatrix(),(!0===this.matrixWorldNeedsUpdate||!0===_)&&(this.parent===void 0?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,_=!0);for(var S=0,M=this.children.length;S<M;S++)this.children[S].updateMatrixWorld(_)},clone:function(_){_===void 0&&(_=new THREE.Object3D),_.name=this.name,_.up.copy(this.up),_.position.copy(this.position),_.rotation instanceof THREE.Vector3&&_.rotation.copy(this.rotation),_.eulerOrder=this.eulerOrder,_.scale.copy(this.scale),_.renderDepth=this.renderDepth,_.rotationAutoUpdate=this.rotationAutoUpdate,_.matrix.copy(this.matrix),_.matrixWorld.copy(this.matrixWorld),_.matrixAutoUpdate=this.matrixAutoUpdate,_.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,_.quaternion.copy(this.quaternion),_.useQuaternion=this.useQuaternion,_.visible=this.visible,_.castShadow=this.castShadow,_.receiveShadow=this.receiveShadow,_.frustumCulled=this.frustumCulled,_.userData=this.userData.dom?jQuery.extend(!0,{},this.userData):JSON.parse(JSON.stringify(this.userData)),_._lookAt.copy(this._lookAt);for(var S=0,M;S<this.children.length;S++)M=this.children[S],_.add(M.clone());return _}},THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype),THREE.Object3D.defaultEulerOrder='XYZ',THREE.Object3DIdCount=0,THREE.Projector=function(){function _(){if(R===N){var Ee=new THREE.RenderableObject;return L.push(Ee),N++,R++,Ee}return L[R++]}function S(){if(F===I){var Ee=new THREE.RenderableVertex;return V.push(Ee),I++,F++,Ee}return V[F++]}function M(){if(B===H){var Ee=new THREE.RenderableFace3;return G.push(Ee),H++,B++,Ee}return G[B++]}function T(){if(W===Y){var Ee=new THREE.RenderableFace4;return X.push(Ee),Y++,W++,Ee}return X[W++]}function A(){if(Q===J){var Ee=new THREE.RenderableLine;return Z.push(Ee),J++,Q++,Ee}return Z[Q++]}function C(){if(re===ie){var Ee=new THREE.RenderableParticle;return oe.push(Ee),ie++,re++,Ee}return oe[re++]}function E(Ee,De){return De.z-Ee.z}function D(Ee,De){var Pe=0,Re=1,Le=Ee.z+Ee.w,Ne=De.z+De.w,Ue=-Ee.z+Ee.w,Fe=-De.z+De.w;return 0<=Le&&0<=Ne&&0<=Ue&&0<=Fe||(0>Le&&0>Ne||0>Ue&&0>Fe?!1:(0>Le?Pe=Math.max(Pe,Le/(Le-Ne)):0>Ne&&(Re=Math.min(Re,Le/(Le-Ne))),0>Ue?Pe=Math.max(Pe,Ue/(Ue-Fe)):0>Fe&&(Re=Math.min(Re,Ue/(Ue-Fe))),!(Re<Pe)&&(Ee.lerp(De,Pe),De.lerp(Ee,1-Re),!0)))}var L=[],N=0,V=[],I=0,G=[],H=0,X=[],Y=0,Z=[],J=0,oe=[],ie=0,ne={objects:[],sprites:[],lights:[],elements:[]},se=new THREE.Vector3,le=new THREE.Vector4,pe=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),ue=new THREE.Box3,fe=[,,,],he=[,,,,],ge=new THREE.Matrix4,ye=new THREE.Matrix4,_e=new THREE.Matrix4,ve=new THREE.Matrix3,Se=new THREE.Matrix3,Me=new THREE.Vector3,Te=new THREE.Frustum,Ae=new THREE.Vector4,we=new THREE.Vector4,P,R,U,F,O,B,W,K,Q,ee,re,xe;this.projectVector=function(Ee,De){return De.matrixWorldInverse.getInverse(De.matrixWorld),ye.multiplyMatrices(De.projectionMatrix,De.matrixWorldInverse),Ee.applyProjection(ye)},this.unprojectVector=function(Ee,De){return De.projectionMatrixInverse.getInverse(De.projectionMatrix),ye.multiplyMatrices(De.matrixWorld,De.projectionMatrixInverse),Ee.applyProjection(ye)},this.pickingRay=function(Ee,De){Ee.z=-1;var Pe=new THREE.Vector3(Ee.x,Ee.y,1);return this.unprojectVector(Ee,De),this.unprojectVector(Pe,De),Pe.sub(Ee).normalize(),new THREE.Raycaster(Ee,Pe)};var Ce=function(Ee,De){R=0,ne.objects.length=0,ne.sprites.length=0,ne.lights.length=0;var Pe=function(Re){for(var Le=0,Ne=Re.children.length,Ue;Le<Ne;Le++)Ue=Re.children[Le],!1===Ue.visible||(Ue instanceof THREE.Light?ne.lights.push(Ue):Ue instanceof THREE.Mesh||Ue instanceof THREE.Line?(!1===Ue.frustumCulled||!0===Te.intersectsObject(Ue))&&(P=_(),P.object=Ue,null===Ue.renderDepth?(se.getPositionFromMatrix(Ue.matrixWorld),se.applyProjection(ye),P.z=se.z):P.z=Ue.renderDepth,ne.objects.push(P)):Ue instanceof THREE.Sprite||Ue instanceof THREE.Particle?(P=_(),P.object=Ue,null===Ue.renderDepth?(se.getPositionFromMatrix(Ue.matrixWorld),se.applyProjection(ye),P.z=se.z):P.z=Ue.renderDepth,ne.sprites.push(P)):(P=_(),P.object=Ue,null===Ue.renderDepth?(se.getPositionFromMatrix(Ue.matrixWorld),se.applyProjection(ye),P.z=se.z):P.z=Ue.renderDepth,ne.objects.push(P)),Pe(Ue))};return Pe(Ee),!0===De&&ne.objects.sort(E),ne};this.projectScene=function(Ee,De,Pe,Re){var Le=!1,Ne,Ue,Fe,ze,Ve,Ie,Oe,Be,ke,Ge,He,je,We,Xe,Ye,qe,Ke,Qe,Ze,Je,$e,et,tt,rt,at,ot;for(B=0,W=0,Q=0,re=0,ne.elements.length=0,!0===Ee.autoUpdate&&Ee.updateMatrixWorld(),void 0===De.parent&&De.updateMatrixWorld(),ge.copy(De.matrixWorldInverse.getInverse(De.matrixWorld)),ye.multiplyMatrices(De.projectionMatrix,ge),Se.getNormalMatrix(ge),Te.setFromMatrix(ye),ne=Ce(Ee,Pe),(Ne=0,Ue=ne.objects.length);Ne<Ue;Ne++)if(We=ne.objects[Ne].object,xe=We.matrixWorld,F=0,We instanceof THREE.Mesh){for(Xe=We.geometry,Ye=Xe.vertices,qe=Xe.faces,Ze=Xe.faceVertexUvs,ve.getNormalMatrix(xe),at=We.material instanceof THREE.MeshFaceMaterial,ot=!0===at?We.material:null,(Fe=0,ze=Ye.length);Fe<ze;Fe++)U=S(),U.positionWorld.copy(Ye[Fe]).applyMatrix4(xe),U.positionScreen.copy(U.positionWorld).applyMatrix4(ye),U.positionScreen.x/=U.positionScreen.w,U.positionScreen.y/=U.positionScreen.w,U.positionScreen.z/=U.positionScreen.w,U.visible=!(-1>U.positionScreen.x||1<U.positionScreen.x||-1>U.positionScreen.y||1<U.positionScreen.y||-1>U.positionScreen.z||1<U.positionScreen.z);for(Ve=0,Ie=qe.length;Ve<Ie;Ve++){Ke=qe[Ve];var it=!0===at?ot.materials[Ke.materialIndex]:We.material;if(void 0!==it){var nt=it.side;if(Ke instanceof THREE.Face3){if($e=V[Ke.a],et=V[Ke.b],tt=V[Ke.c],fe[0]=$e.positionScreen,fe[1]=et.positionScreen,fe[2]=tt.positionScreen,!(!0===$e.visible||!0===et.visible||!0===tt.visible||pe.isIntersectionBox(ue.setFromPoints(fe))))continue;else if(Le=0>(tt.positionScreen.x-$e.positionScreen.x)*(et.positionScreen.y-$e.positionScreen.y)-(tt.positionScreen.y-$e.positionScreen.y)*(et.positionScreen.x-$e.positionScreen.x),nt===THREE.DoubleSide||Le==(nt===THREE.FrontSide))O=M(),O.v1.copy($e),O.v2.copy(et),O.v3.copy(tt);else continue;}else if(Ke instanceof THREE.Face4)if($e=V[Ke.a],et=V[Ke.b],tt=V[Ke.c],rt=V[Ke.d],he[0]=$e.positionScreen,he[1]=et.positionScreen,he[2]=tt.positionScreen,he[3]=rt.positionScreen,!(!0===$e.visible||!0===et.visible||!0===tt.visible||!0===rt.visible||pe.isIntersectionBox(ue.setFromPoints(he))))continue;else if(Le=0>(rt.positionScreen.x-$e.positionScreen.x)*(et.positionScreen.y-$e.positionScreen.y)-(rt.positionScreen.y-$e.positionScreen.y)*(et.positionScreen.x-$e.positionScreen.x)||0>(et.positionScreen.x-tt.positionScreen.x)*(rt.positionScreen.y-tt.positionScreen.y)-(et.positionScreen.y-tt.positionScreen.y)*(rt.positionScreen.x-tt.positionScreen.x),nt===THREE.DoubleSide||Le==(nt===THREE.FrontSide))O=T(),O.v1.copy($e),O.v2.copy(et),O.v3.copy(tt),O.v4.copy(rt);else continue;for(O.normalModel.copy(Ke.normal),!1==Le&&(nt===THREE.BackSide||nt===THREE.DoubleSide)&&O.normalModel.negate(),O.normalModel.applyMatrix3(ve).normalize(),O.normalModelView.copy(O.normalModel).applyMatrix3(Se),O.centroidModel.copy(Ke.centroid).applyMatrix4(xe),Qe=Ke.vertexNormals,(Oe=0,Be=Qe.length);Oe<Be;Oe++){var st=O.vertexNormalsModel[Oe];st.copy(Qe[Oe]),!1==Le&&(nt===THREE.BackSide||nt===THREE.DoubleSide)&&st.negate(),st.applyMatrix3(ve).normalize();var lt=O.vertexNormalsModelView[Oe];lt.copy(st).applyMatrix3(Se)}for(O.vertexNormalsLength=Qe.length,ke=0,Ge=Ze.length;ke<Ge;ke++)if(Je=Ze[ke][Ve],void 0!=Je)for(He=0,je=Je.length;He<je;He++)O.uvs[ke][He]=Je[He];O.color=Ke.color,O.material=it,Me.copy(O.centroidModel).applyProjection(ye),O.z=Me.z,ne.elements.push(O)}}}else if(We instanceof THREE.Line){_e.multiplyMatrices(ye,xe),Ye=We.geometry.vertices,$e=S(),$e.positionScreen.copy(Ye[0]).applyMatrix4(_e);var dt=We.type===THREE.LinePieces?2:1;for(Fe=1,ze=Ye.length;Fe<ze;Fe++)$e=S(),$e.positionScreen.copy(Ye[Fe]).applyMatrix4(_e),0<(Fe+1)%dt||(et=V[F-2],Ae.copy($e.positionScreen),we.copy(et.positionScreen),!0===D(Ae,we)&&(Ae.multiplyScalar(1/Ae.w),we.multiplyScalar(1/we.w),K=A(),K.v1.positionScreen.copy(Ae),K.v2.positionScreen.copy(we),K.z=Math.max(Ae.z,we.z),K.material=We.material,We.material.vertexColors===THREE.VertexColors&&(K.vertexColors[0].copy(We.geometry.colors[Fe]),K.vertexColors[1].copy(We.geometry.colors[Fe-1])),ne.elements.push(K)))}for(Ne=0,Ue=ne.sprites.length;Ne<Ue;Ne++)We=ne.sprites[Ne].object,xe=We.matrixWorld,We instanceof THREE.Particle&&(le.set(xe.elements[12],xe.elements[13],xe.elements[14],1),le.applyMatrix4(ye),le.z/=le.w,0<le.z&&1>le.z&&(ee=C(),ee.object=We,ee.x=le.x/le.w,ee.y=le.y/le.w,ee.z=le.z,ee.rotation=We.rotation.z,ee.scale.x=We.scale.x*Math.abs(ee.x-(le.x+De.projectionMatrix.elements[0])/(le.w+De.projectionMatrix.elements[12])),ee.scale.y=We.scale.y*Math.abs(ee.y-(le.y+De.projectionMatrix.elements[5])/(le.w+De.projectionMatrix.elements[13])),ee.material=We.material,ne.elements.push(ee)));return!0===Re&&ne.elements.sort(E),ne}},THREE.Face3=function(_,S,M,T,A,C){this.a=_,this.b=S,this.c=M,this.normal=T instanceof THREE.Vector3?T:new THREE.Vector3,this.vertexNormals=T instanceof Array?T:[],this.color=A instanceof THREE.Color?A:new THREE.Color,this.vertexColors=A instanceof Array?A:[],this.vertexTangents=[],this.materialIndex=C===void 0?0:C,this.centroid=new THREE.Vector3},THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var _=new THREE.Face3(this.a,this.b,this.c);_.normal.copy(this.normal),_.color.copy(this.color),_.centroid.copy(this.centroid),_.materialIndex=this.materialIndex;var S,M;for(S=0,M=this.vertexNormals.length;S<M;S++)_.vertexNormals[S]=this.vertexNormals[S].clone();for(S=0,M=this.vertexColors.length;S<M;S++)_.vertexColors[S]=this.vertexColors[S].clone();for(S=0,M=this.vertexTangents.length;S<M;S++)_.vertexTangents[S]=this.vertexTangents[S].clone();return _}},THREE.Face4=function(_,S,M,T,A,C,E){this.a=_,this.b=S,this.c=M,this.d=T,this.normal=A instanceof THREE.Vector3?A:new THREE.Vector3,this.vertexNormals=A instanceof Array?A:[],this.color=C instanceof THREE.Color?C:new THREE.Color,this.vertexColors=C instanceof Array?C:[],this.vertexTangents=[],this.materialIndex=E===void 0?0:E,this.centroid=new THREE.Vector3},THREE.Face4.prototype={constructor:THREE.Face4,clone:function(){var _=new THREE.Face4(this.a,this.b,this.c,this.d);_.normal.copy(this.normal),_.color.copy(this.color),_.centroid.copy(this.centroid),_.materialIndex=this.materialIndex;var S,M;for(S=0,M=this.vertexNormals.length;S<M;S++)_.vertexNormals[S]=this.vertexNormals[S].clone();for(S=0,M=this.vertexColors.length;S<M;S++)_.vertexColors[S]=this.vertexColors[S].clone();for(S=0,M=this.vertexTangents.length;S<M;S++)_.vertexTangents[S]=this.vertexTangents[S].clone();return _}},THREE.Geometry=function(){this.id=THREE.GeometryIdCount++,this.name='',this.vertices=[],this.colors=[],this.normals=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.buffersNeedUpdate=!1,this.userData={}},THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(_){for(var S=new THREE.Matrix3().getNormalMatrix(_),M=0,T=this.vertices.length,A;M<T;M++)A=this.vertices[M],A.applyMatrix4(_);for(var M=0,T=this.faces.length,C;M<T;M++){C=this.faces[M],C.normal.applyMatrix3(S).normalize();for(var E=0,D=C.vertexNormals.length;E<D;E++)C.vertexNormals[E].applyMatrix3(S).normalize();C.centroid.applyMatrix4(_)}},computeCentroids:function(){var _,S,M;for(_=0,S=this.faces.length;_<S;_++)M=this.faces[_],M.centroid.set(0,0,0),M instanceof THREE.Face3?(M.centroid.add(this.vertices[M.a]),M.centroid.add(this.vertices[M.b]),M.centroid.add(this.vertices[M.c]),M.centroid.divideScalar(3)):M instanceof THREE.Face4&&(M.centroid.add(this.vertices[M.a]),M.centroid.add(this.vertices[M.b]),M.centroid.add(this.vertices[M.c]),M.centroid.add(this.vertices[M.d]),M.centroid.divideScalar(4))},computeFaceNormals:function(){for(var _=new THREE.Vector3,S=new THREE.Vector3,M=0,T=this.faces.length;M<T;M++){var A=this.faces[M],C=this.vertices[A.a],E=this.vertices[A.b],D=this.vertices[A.c];_.subVectors(D,E),S.subVectors(C,E),_.cross(S),_.normalize(),A.normal.copy(_)}},computeVertexNormals:function(_){var S,M,T,A,C,E;if(this.__tmpVertices===void 0){for(this.__tmpVertices=Array(this.vertices.length),E=this.__tmpVertices,(S=0,M=this.vertices.length);S<M;S++)E[S]=new THREE.Vector3;for(T=0,A=this.faces.length;T<A;T++)C=this.faces[T],C instanceof THREE.Face3?C.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]:C instanceof THREE.Face4&&(C.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3])}else for(E=this.__tmpVertices,S=0,M=this.vertices.length;S<M;S++)E[S].set(0,0,0);if(_){var N=new THREE.Vector3,U=new THREE.Vector3,F=new THREE.Vector3,V=new THREE.Vector3,I=new THREE.Vector3,D,P,R,L;for(T=0,A=this.faces.length;T<A;T++)C=this.faces[T],C instanceof THREE.Face3?(D=this.vertices[C.a],P=this.vertices[C.b],R=this.vertices[C.c],N.subVectors(R,P),U.subVectors(D,P),N.cross(U),E[C.a].add(N),E[C.b].add(N),E[C.c].add(N)):C instanceof THREE.Face4&&(D=this.vertices[C.a],P=this.vertices[C.b],R=this.vertices[C.c],L=this.vertices[C.d],F.subVectors(L,P),U.subVectors(D,P),F.cross(U),E[C.a].add(F),E[C.b].add(F),E[C.d].add(F),V.subVectors(L,R),I.subVectors(P,R),V.cross(I),E[C.b].add(V),E[C.c].add(V),E[C.d].add(V))}else for(T=0,A=this.faces.length;T<A;T++)C=this.faces[T],C instanceof THREE.Face3?(E[C.a].add(C.normal),E[C.b].add(C.normal),E[C.c].add(C.normal)):C instanceof THREE.Face4&&(E[C.a].add(C.normal),E[C.b].add(C.normal),E[C.c].add(C.normal),E[C.d].add(C.normal));for(S=0,M=this.vertices.length;S<M;S++)E[S].normalize();for(T=0,A=this.faces.length;T<A;T++)C=this.faces[T],C instanceof THREE.Face3?(C.vertexNormals[0].copy(E[C.a]),C.vertexNormals[1].copy(E[C.b]),C.vertexNormals[2].copy(E[C.c])):C instanceof THREE.Face4&&(C.vertexNormals[0].copy(E[C.a]),C.vertexNormals[1].copy(E[C.b]),C.vertexNormals[2].copy(E[C.c]),C.vertexNormals[3].copy(E[C.d]))},computeMorphNormals:function(){var _,S,M,T,A;for(M=0,T=this.faces.length;M<T;M++)for(A=this.faces[M],A.__originalFaceNormal?A.__originalFaceNormal.copy(A.normal):A.__originalFaceNormal=A.normal.clone(),A.__originalVertexNormals||(A.__originalVertexNormals=[]),(_=0,S=A.vertexNormals.length);_<S;_++)A.__originalVertexNormals[_]?A.__originalVertexNormals[_].copy(A.vertexNormals[_]):A.__originalVertexNormals[_]=A.vertexNormals[_].clone();var C=new THREE.Geometry;for(C.faces=this.faces,_=0,S=this.morphTargets.length;_<S;_++){if(!this.morphNormals[_]){this.morphNormals[_]={},this.morphNormals[_].faceNormals=[],this.morphNormals[_].vertexNormals=[];var E=this.morphNormals[_].faceNormals,D=this.morphNormals[_].vertexNormals,P,R;for(M=0,T=this.faces.length;M<T;M++)A=this.faces[M],P=new THREE.Vector3,R=A instanceof THREE.Face3?{a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3}:{a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3,d:new THREE.Vector3},E.push(P),D.push(R)}var L=this.morphNormals[_];C.vertices=this.morphTargets[_].vertices,C.computeFaceNormals(),C.computeVertexNormals();var P,R;for(M=0,T=this.faces.length;M<T;M++)A=this.faces[M],P=L.faceNormals[M],R=L.vertexNormals[M],P.copy(A.normal),A instanceof THREE.Face3?(R.a.copy(A.vertexNormals[0]),R.b.copy(A.vertexNormals[1]),R.c.copy(A.vertexNormals[2])):(R.a.copy(A.vertexNormals[0]),R.b.copy(A.vertexNormals[1]),R.c.copy(A.vertexNormals[2]),R.d.copy(A.vertexNormals[3]))}for(M=0,T=this.faces.length;M<T;M++)A=this.faces[M],A.normal=A.__originalFaceNormal,A.vertexNormals=A.__originalVertexNormals},computeTangents:function(){function _(ge,ye,xe,_e,ve,Se,Me){L=ge.vertices[ye],N=ge.vertices[xe],U=ge.vertices[_e],F=R[ve],V=R[Se],I=R[Me],O=N.x-L.x,B=U.x-L.x,G=N.y-L.y,H=U.y-L.y,W=N.z-L.z,X=U.z-L.z,Y=V.x-F.x,K=I.x-F.x,Q=V.y-F.y,Z=I.y-F.y,J=1/(Y*Z-K*Q),ne.set((Z*O-Q*B)*J,(Z*G-Q*H)*J,(Z*W-Q*X)*J),se.set((Y*B-K*O)*J,(Y*H-K*G)*J,(Y*X-K*W)*J),oe[ye].add(ne),oe[xe].add(ne),oe[_e].add(ne),ie[ye].add(se),ie[xe].add(se),ie[_e].add(se)}var oe=[],ie=[],ne=new THREE.Vector3,se=new THREE.Vector3,le=new THREE.Vector3,pe=new THREE.Vector3,ue=new THREE.Vector3,S,M,T,A,C,D,P,R,L,N,U,F,V,I,O,B,G,H,W,X,Y,K,Q,Z,J,ee,re,fe;for(T=0,A=this.vertices.length;T<A;T++)oe[T]=new THREE.Vector3,ie[T]=new THREE.Vector3;for(S=0,M=this.faces.length;S<M;S++)P=this.faces[S],R=this.faceVertexUvs[0][S],P instanceof THREE.Face3?_(this,P.a,P.b,P.c,0,1,2):P instanceof THREE.Face4&&(_(this,P.a,P.b,P.d,0,1,3),_(this,P.b,P.c,P.d,1,2,3));var he=['a','b','c','d'];for(S=0,M=this.faces.length;S<M;S++)for(P=this.faces[S],C=0;C<P.vertexNormals.length;C++)ue.copy(P.vertexNormals[C]),D=P[he[C]],ee=oe[D],le.copy(ee),le.sub(ue.multiplyScalar(ue.dot(ee))).normalize(),pe.crossVectors(P.vertexNormals[C],ee),re=pe.dot(ie[D]),fe=0>re?-1:1,P.vertexTangents[C]=new THREE.Vector4(le.x,le.y,le.z,fe);this.hasTangents=!0},computeLineDistances:function(){for(var _=0,S=this.vertices,M=0,T=S.length;M<T;M++)0<M&&(_+=S[M].distanceTo(S[M-1])),this.lineDistances[M]=_},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3,!this.boundingBox_list&&(this.boundingBox_list=[this.boundingBox])),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere),this.boundingSphere.setFromCenterAndPoints(this.boundingSphere.center,this.vertices)},mergeVertices:function(){var _={},S=[],M=[],E=Math.pow(10,4),T,A,D,P,R,L,U,F,V;for(this.__tmpVertices=void 0,D=0,P=this.vertices.length;D<P;D++)T=this.vertices[D],A=[Math.round(T.x*E),Math.round(T.y*E),Math.round(T.z*E)].join('_'),void 0===_[A]?(_[A]=D,S.push(this.vertices[D]),M[D]=S.length-1):M[D]=M[_[A]];var I=[];for(D=0,P=this.faces.length;D<P;D++)if(R=this.faces[D],R instanceof THREE.Face3){R.a=M[R.a],R.b=M[R.b],R.c=M[R.c],L=[R.a,R.b,R.c];for(var O=-1,B=0;3>B;B++)if(L[B]==L[(B+1)%3]){O=B,I.push(D);break}}else if(R instanceof THREE.Face4){R.a=M[R.a],R.b=M[R.b],R.c=M[R.c],R.d=M[R.d],L=[R.a,R.b,R.c,R.d];for(var O=-1,B=0;4>B;B++)L[B]==L[(B+1)%4]&&(0<=O&&I.push(D),O=B);if(0<=O){L.splice(O,1);var G=new THREE.Face3(L[0],L[1],L[2],R.normal,R.color,R.materialIndex);for(U=0,F=this.faceVertexUvs.length;U<F;U++)V=this.faceVertexUvs[U][D],V&&V.splice(O,1);R.vertexNormals&&0<R.vertexNormals.length&&(G.vertexNormals=R.vertexNormals,G.vertexNormals.splice(O,1)),R.vertexColors&&0<R.vertexColors.length&&(G.vertexColors=R.vertexColors,G.vertexColors.splice(O,1)),this.faces[D]=G}}for(D=I.length-1;0<=D;D--)for(this.faces.splice(D,1),U=0,F=this.faceVertexUvs.length;U<F;U++)this.faceVertexUvs[U].splice(D,1);var H=this.vertices.length-S.length;return this.vertices=S,H},clone:function(){for(var _=new THREE.Geometry,S=this.vertices,M=0,T=S.length;M<T;M++)_.vertices.push(S[M].clone());for(var A=this.faces,M=0,T=A.length;M<T;M++)_.faces.push(A[M].clone());for(var C=this.faceVertexUvs[0],M=0,T=C.length;M<T;M++){for(var E=C[M],D=[],P=0,R=E.length;P<R;P++)D.push(new THREE.Vector2(E[P].x,E[P].y));_.faceVertexUvs[0].push(D)}return _},dispose:function(){this.dispatchEvent({type:'dispose'})}},THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype),THREE.GeometryIdCount=0,THREE.BufferGeometry=function(){this.id=THREE.GeometryIdCount++,this.attributes={},this.dynamic=!1,this.offsets=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.morphTargets=[]},THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,applyMatrix:function(_){var S,M;if(this.attributes.position&&(S=this.attributes.position.array),this.attributes.normal&&(M=this.attributes.normal.array),void 0!=S&&(_.multiplyVector3Array(S),this.verticesNeedUpdate=!0),void 0!=M){var T=new THREE.Matrix3().getNormalMatrix(_);T.multiplyVector3Array(M),this.normalizeNormals(),this.normalsNeedUpdate=!0}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var _=this.attributes.position.array;if(_){var S=this.boundingBox,M,T,A;3<=_.length&&(S.min.x=S.max.x=_[0],S.min.y=S.max.y=_[1],S.min.z=S.max.z=_[2]);for(var C=3,E=_.length;C<E;C+=3)M=_[C],T=_[C+1],A=_[C+2],M<S.min.x?S.min.x=M:M>S.max.x&&(S.max.x=M),T<S.min.y?S.min.y=T:T>S.max.y&&(S.max.y=T),A<S.min.z?S.min.z=A:A>S.max.z&&(S.max.z=A)}(_===void 0||0===_.length)&&(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var _=this.attributes.position.array;if(_){for(var M=0,E=0,D=_.length,S,T,A,C;E<D;E+=3)T=_[E],A=_[E+1],C=_[E+2],S=T*T+A*A+C*C,S>M&&(M=S);this.boundingSphere.radius=Math.sqrt(M)}},computeVertexNormals:function(){if(this.attributes.position){var _,S,M,T,A=this.attributes.position.array.length;if(this.attributes.normal===void 0)this.attributes.normal={itemSize:3,array:new Float32Array(A),numItems:A};else for(_=0,S=this.attributes.normal.array.length;_<S;_++)this.attributes.normal.array[_]=0;var C=this.attributes.position.array,E=this.attributes.normal.array,D,P,R,L,N,U,F=new THREE.Vector3,V=new THREE.Vector3,I=new THREE.Vector3,O=new THREE.Vector3,B=new THREE.Vector3;if(this.attributes.index){var G=this.attributes.index.array,H=this.offsets;for(M=0,T=H.length;M<T;++M){var W=H[M].start,X=H[M].count,Y=H[M].index;for(_=W,S=W+X;_<S;_+=3)D=Y+G[_],P=Y+G[_+1],R=Y+G[_+2],L=C[3*D],N=C[3*D+1],U=C[3*D+2],F.set(L,N,U),L=C[3*P],N=C[3*P+1],U=C[3*P+2],V.set(L,N,U),L=C[3*R],N=C[3*R+1],U=C[3*R+2],I.set(L,N,U),O.subVectors(I,V),B.subVectors(F,V),O.cross(B),E[3*D]+=O.x,E[3*D+1]+=O.y,E[3*D+2]+=O.z,E[3*P]+=O.x,E[3*P+1]+=O.y,E[3*P+2]+=O.z,E[3*R]+=O.x,E[3*R+1]+=O.y,E[3*R+2]+=O.z}}else for(_=0,S=C.length;_<S;_+=9)L=C[_],N=C[_+1],U=C[_+2],F.set(L,N,U),L=C[_+3],N=C[_+4],U=C[_+5],V.set(L,N,U),L=C[_+6],N=C[_+7],U=C[_+8],I.set(L,N,U),O.subVectors(I,V),B.subVectors(F,V),O.cross(B),E[_]=O.x,E[_+1]=O.y,E[_+2]=O.z,E[_+3]=O.x,E[_+4]=O.y,E[_+5]=O.z,E[_+6]=O.x,E[_+7]=O.y,E[_+8]=O.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){for(var _=this.attributes.normal.array,C=0,E=_.length,S,M,T,A;C<E;C+=3)S=_[C],M=_[C+1],T=_[C+2],A=1/Math.sqrt(S*S+M*M+T*T),_[C]*=A,_[C+1]*=A,_[C+2]*=A},computeTangents:function(){function _(Ve,Ie,Oe){U=T[3*Ve],F=T[3*Ve+1],V=T[3*Ve+2],I=T[3*Ie],O=T[3*Ie+1],B=T[3*Ie+2],G=T[3*Oe],H=T[3*Oe+1],W=T[3*Oe+2],X=C[2*Ve],Y=C[2*Ve+1],K=C[2*Ie],Q=C[2*Ie+1],Z=C[2*Oe],J=C[2*Oe+1],ee=I-U,re=G-U,oe=O-F,ie=H-F,ne=B-V,se=W-V,le=K-X,pe=Z-X,ue=Q-Y,fe=J-Y,he=1/(le*fe-pe*ue),ge.set((fe*ee-ue*re)*he,(fe*oe-ue*ie)*he,(fe*ne-ue*se)*he),ye.set((le*re-pe*ee)*he,(le*ie-pe*oe)*he,(le*se-pe*ne)*he),R[Ve].add(ge),R[Ie].add(ge),R[Oe].add(ge),L[Ve].add(ye),L[Ie].add(ye),L[Oe].add(ye)}function S(Ve){Le.x=A[3*Ve],Le.y=A[3*Ve+1],Le.z=A[3*Ve+2],Ne.copy(Le),Fe=R[Ve],Pe.copy(Fe),Pe.sub(Le.multiplyScalar(Le.dot(Fe))).normalize(),Re.crossVectors(Ne,Fe),ze=Re.dot(L[Ve]),Ue=0>ze?-1:1,P[4*Ve]=Pe.x,P[4*Ve+1]=Pe.y,P[4*Ve+2]=Pe.z,P[4*Ve+3]=Ue}var M=this.attributes.index.array,T=this.attributes.position.array,A=this.attributes.normal.array,C=this.attributes.uv.array,E=T.length/3;if(this.attributes.tangent===void 0){var D=4*E;this.attributes.tangent={itemSize:4,array:new Float32Array(D),numItems:D}}for(var P=this.attributes.tangent.array,R=[],L=[],N=0;N<E;N++)R[N]=new THREE.Vector3,L[N]=new THREE.Vector3;var U,F,V,I,O,B,G,H,W,X,Y,K,Q,Z,J,ee,re,oe,ie,ne,se,le,pe,ue,fe,he,ge=new THREE.Vector3,ye=new THREE.Vector3,xe,_e,ve,Se,Me,Te,Ae,we=this.offsets;for(ve=0,Se=we.length;ve<Se;++ve){var Ce=we[ve].start,Ee=we[ve].count,De=we[ve].index;for(xe=Ce,_e=Ce+Ee;xe<_e;xe+=3)Me=De+M[xe],Te=De+M[xe+1],Ae=De+M[xe+2],_(Me,Te,Ae)}var Pe=new THREE.Vector3,Re=new THREE.Vector3,Le=new THREE.Vector3,Ne=new THREE.Vector3,Ue,Fe,ze;for(ve=0,Se=we.length;ve<Se;++ve){var Ce=we[ve].start,Ee=we[ve].count,De=we[ve].index;for(xe=Ce,_e=Ce+Ee;xe<_e;xe+=3)Me=De+M[xe],Te=De+M[xe+1],Ae=De+M[xe+2],S(Me),S(Te),S(Ae)}this.hasTangents=!0,this.tangentsNeedUpdate=!0},dispose:function(){this.dispatchEvent({type:'dispose'})}},THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype),THREE.Camera=function(){THREE.Object3D.call(this),this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4,this.projectionMatrixInverse=new THREE.Matrix4},THREE.Camera.prototype=Object.create(THREE.Object3D.prototype),THREE.Camera.prototype.lookAt=function(){var _=new THREE.Matrix4;return function(S){_.lookAt(this.position,S,this.up),this._lookAt.copy(S),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(_):this.rotation.setEulerFromRotationMatrix(_,this.eulerOrder)}}(),THREE.OrthographicCamera=function(_,S,M,T,A,C){THREE.Camera.call(this),this.left=_,this.right=S,this.top=M,this.bottom=T,this.near=A===void 0?0.1:A,this.far=C===void 0?2e3:C,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype),THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},THREE.PerspectiveCamera=function(_,S,M,T){THREE.Camera.call(this),this.fov=_===void 0?50:_,this.aspect=S===void 0?1:S,this.near=M===void 0?0.1:M,this.far=T===void 0?2e3:T,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype),THREE.PerspectiveCamera.prototype.setLens=function(_,S){S===void 0&&(S=24),this.fov=2*THREE.Math.radToDeg(Math.atan(S/(2*_))),this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.setViewOffset=function(_,S,M,T,A,C){this.fullWidth=_,this.fullHeight=S,this.x=M,this.y=T,this.width=A,this.height=C,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var _=this.fullWidth/this.fullHeight,S=Math.tan(THREE.Math.degToRad(0.5*this.fov))*this.near,M=-S,T=_*M,C=Math.abs(_*S-T),E=Math.abs(S-M);this.projectionMatrix.makeFrustum(T+this.x*C/this.fullWidth,T+(this.x+this.width)*C/this.fullWidth,S-(this.y+this.height)*E/this.fullHeight,S-this.y*E/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},THREE.Light=function(_){THREE.Object3D.call(this),this.color=new THREE.Color(_||16777215)},THREE.Light.prototype=Object.create(THREE.Object3D.prototype),THREE.Light.prototype.clone=function(_){return void 0===_&&(_=new THREE.Light),THREE.Object3D.prototype.clone.call(this,_),_.color.copy(this.color),_},THREE.AmbientLight=function(_){'object'==typeof _&&(_=_.color),THREE.Light.call(this,_)},THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype),THREE.AmbientLight.prototype.clone=function(){var _=new THREE.AmbientLight;return THREE.Light.prototype.clone.call(this,_),_},THREE.AreaLight=function(_,S){'object'==typeof _&&(S=_.intensity,_=_.color),THREE.Light.call(this,_),this.normal=new THREE.Vector3(0,-1,0),this.right=new THREE.Vector3(1,0,0),this.intensity=S===void 0?1:S,this.width=1,this.height=1,this.constantAttenuation=1.5,this.linearAttenuation=0.5,this.quadraticAttenuation=0.1},THREE.AreaLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight=function(_,S){'object'==typeof _&&(S=_.intensity,_=_.color),THREE.Light.call(this,_),this.position.set(0,1,0),this.target=new THREE.Object3D,this.target.position=this._lookAt,this.intensity=S===void 0?1:S,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=0.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowBias_range=[0.1,100],this.shadowCascade=!1,this.shadowCascadeOffset=new THREE.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,0.99,0.998],this.shadowCascadeFarZ=[0.99,0.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight.prototype.clone=function(){var _=new THREE.DirectionalLight;return THREE.Light.prototype.clone.call(this,_),_.target=this.target.clone(),_.target.position=_._lookAt,_.intensity=this.intensity,_.castShadow=this.castShadow,_.onlyShadow=this.onlyShadow,_},THREE.HemisphereLight=function(_,S,M){'object'==typeof _&&(M=_.intensity,S=_.ground,_=_.sky),THREE.Light.call(this,_),this.sky=this.color,this.position.set(0,100,0),this.ground=this.groundColor=new THREE.Color(S),this.intensity=M===void 0?1:M},THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype),THREE.HemisphereLight.prototype.clone=function(){var _=new THREE.HemisphereLight;return THREE.Light.prototype.clone.call(this,_),_.groundColor.copy(this.groundColor),_.intensity=this.intensity,_},THREE.PointLight=function(_,S,M){'object'==typeof _&&(S=_.intensity,M=_.distance,_=_.color),THREE.Light.call(this,_),this.intensity=S===void 0?1:S,this.distance=M===void 0?0:M},THREE.PointLight.prototype=Object.create(THREE.Light.prototype),THREE.PointLight.prototype.clone=function(){var _=new THREE.PointLight;return THREE.Light.prototype.clone.call(this,_),_.intensity=this.intensity,_.distance=this.distance,_},THREE.SpotLight=function(_,S,M,T,A){'object'==typeof _&&(S=_.intensity,M=_.distance,T=_.angle,A=_.exponent,_=_.color),THREE.Light.call(this,_),this.position.set(0,1,0),this.target=new THREE.Object3D,this.target.position=this._lookAt,this.intensity=S===void 0?1:S,this.distance=M===void 0?0:M,this.angle=T===void 0?Math.PI/3:T,this.exponent=A===void 0?10:A,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=0.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},THREE.SpotLight.prototype=Object.create(THREE.Light.prototype),THREE.SpotLight.prototype.clone=function(){var _=new THREE.SpotLight;return THREE.Light.prototype.clone.call(this,_),_.target=this.target.clone(),_.target.position=_._lookAt,_.intensity=this.intensity,_.distance=this.distance,_.angle=this.angle,_.exponent=this.exponent,_.castShadow=this.castShadow,_.onlyShadow=this.onlyShadow,_},THREE.ImageLoader=function(){this.crossOrigin=null},THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(_,S){var M=this;if(void 0===S&&(S=new Image),S.addEventListener('load',function(){var C;self.MMD_SA&&MMD_SA_options.texture_resolution_limit&&(S.width>MMD_SA_options.texture_resolution_limit||S.height>MMD_SA_options.texture_resolution_limit)?(C=document.createElement('canvas'),C.width=Math.min(MMD_SA_options.texture_resolution_limit,S.width),C.height=Math.min(MMD_SA_options.texture_resolution_limit,S.height),C.getContext('2d').drawImage(S,0,0,C.width,C.height)):C=S,M.dispatchEvent({type:'load',content:C})},!1),S.addEventListener('error',function(){M.dispatchEvent({type:'error',message:'Couldn\'t load URL ['+_+']'})},!1),/^(tga|TGA)/.test(_.split('.').pop())){var T=new THREE.TGA;T.open(_,function(){delete S.crossOrigin,S.src=T.getDataURL(),T=null},function(){var C=document.createEvent('HTMLEvents');C.initEvent('error',!1,!0),S.dispatchEvent(C),T=null})}else if(/^data:image/.test(_)||(S.crossOrigin='anonymous'),!/^(data|blob)\:/.test(_)){var A=new XMLHttpRequestZIP;A.onload=function(){var C=URL.createObjectURL(this.response);if(/^(.+)\.jpga\.jpg$/i.test(_)){var E=RegExp.$1+'.alpha.png';console.log('Use JPG alpha - '+E);var D=new Image;D.addEventListener('load',function(){URL.revokeObjectURL(C);var P=new XMLHttpRequestZIP;P.onload=function(){C=URL.createObjectURL(this.response);var R=new Image;R.addEventListener('load',function(){URL.revokeObjectURL(C);var L=document.createElement('canvas'),N=L.getContext('2d');L.width=R.width,L.height=R.height,N.drawImage(R,0,0);for(var U=N.getImageData(0,0,L.width,L.height),F=new Uint32Array(U.data.buffer),V=0,I=F.length;V<I;)F[V]=F[V++]<<8;N.putImageData(U,0,0),U=F=null;var O=document.createElement('canvas');O.width=D.width,O.height=D.height;var B=O.getContext('2d');B.drawImage(D,0,0),B.globalCompositeOperation='destination-in',B.drawImage(L,0,0),O.toBlob(function(G){C=URL.createObjectURL(G),S.addEventListener('load',function(){URL.revokeObjectURL(C)}),S.src=C,D=R=null,L.width=L.height=O.width=O.height=0,L=N=O=B=null})}),R.src=C,this.response=P=null},P.open('GET',E,!0),P.responseType='blob',P.send()}),D.src=C}else S.addEventListener('load',function(){URL.revokeObjectURL(C)}),S.src=C;this.response=A=null},A.onerror=function(){var C=document.createElement('canvas');C.width=C.height=1;var E=C.getContext('2d');E.fillStyle='white',E.fillRect(0,0,1,1),M.dispatchEvent({type:'load',content:C})},A.open('GET',_,!0),A.responseType='blob',A.send()}else S.src=_}},THREE.EventDispatcher.prototype.apply(THREE.ImageLoader.prototype),THREE.Material=function(){this.id=THREE.MaterialIdCount++,this.name='',this.side=THREE.FrontSide,this.opacity=1,this.transparent=!0,this.blending=THREE.NormalBlending,this.blendSrc=THREE.SrcAlphaFactor,this.blendDst=THREE.OneMinusSrcAlphaFactor,this.blendEquation=THREE.AddEquation,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=!1,this.visible=!0,this.needsUpdate=!0,this.userData={}},THREE.Material.prototype={constructor:THREE.Material,setValues:function(_){if(void 0!==_)for(var S in _){var M=_[S];if(S in this){var T=this[S];T instanceof THREE.Color?T.set(M):T instanceof THREE.Vector3&&M instanceof THREE.Vector3?T.copy(M):this[S]=M}}},clone:function(_){return void 0===_&&(_=new THREE.Material),_.name=this.name,_.side=this.side,_.opacity=this.opacity,_.transparent=this.transparent,_.blending=this.blending,_.blendSrc=this.blendSrc,_.blendDst=this.blendDst,_.blendEquation=this.blendEquation,_.depthTest=this.depthTest,_.depthWrite=this.depthWrite,_.polygonOffset=this.polygonOffset,_.polygonOffsetFactor=this.polygonOffsetFactor,_.polygonOffsetUnits=this.polygonOffsetUnits,_.alphaTest=this.alphaTest,_.overdraw=this.overdraw,_.visible=this.visible,_.offset=this.offset&&this.offset.clone(),_.repeat=this.repeat&&this.repeat.clone(),_},dispose:function(){this.dispatchEvent({type:'dispose'})}},THREE.EventDispatcher.prototype.apply(THREE.Material.prototype),THREE.MaterialIdCount=0,THREE.LineBasicMaterial=function(_){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.linewidth=1,this.linecap='round',this.linejoin='round',this.vertexColors=!1,this.fog=!0,this.setValues(_)},THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineBasicMaterial.prototype.clone=function(){var _=new THREE.LineBasicMaterial;return THREE.Material.prototype.clone.call(this,_),_.color.copy(this.color),_.linewidth=this.linewidth,_.linecap=this.linecap,_.linejoin=this.linejoin,_.vertexColors=this.vertexColors,_.fog=this.fog,_},THREE.LineDashedMaterial=function(_){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(_)},THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineDashedMaterial.prototype.clone=function(){var _=new THREE.LineDashedMaterial;return THREE.Material.prototype.clone.call(this,_),_.color.copy(this.color),_.linewidth=this.linewidth,_.scale=this.scale,_.dashSize=this.dashSize,_.gapSize=this.gapSize,_.vertexColors=this.vertexColors,_.fog=this.fog,_},THREE.MeshBasicMaterial=function(_){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=0.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap='round',this.wireframeLinejoin='round',this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(_)},THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshBasicMaterial.prototype.clone=function(){var _=new THREE.MeshBasicMaterial;return THREE.Material.prototype.clone.call(this,_),_.color.copy(this.color),_.map=this.map,_.lightMap=this.lightMap,_.specularMap=this.specularMap,_.envMap=this.envMap,_.combine=this.combine,_.reflectivity=this.reflectivity,_.refractionRatio=this.refractionRatio,_.fog=this.fog,_.shading=this.shading,_.wireframe=this.wireframe,_.wireframeLinewidth=this.wireframeLinewidth,_.wireframeLinecap=this.wireframeLinecap,_.wireframeLinejoin=this.wireframeLinejoin,_.vertexColors=this.vertexColors,_.skinning=this.skinning,_.morphTargets=this.morphTargets,_},THREE.MeshLambertMaterial=function(_){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.wrapAround=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=0.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap='round',this.wireframeLinejoin='round',this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(_)},THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshLambertMaterial.prototype.clone=function(){var _=new THREE.MeshLambertMaterial;return THREE.Material.prototype.clone.call(this,_),_.color.copy(this.color),_.ambient.copy(this.ambient),_.emissive.copy(this.emissive),_.wrapAround=this.wrapAround,_.wrapRGB.copy(this.wrapRGB),_.map=this.map,_.lightMap=this.lightMap,_.specularMap=this.specularMap,_.envMap=this.envMap,_.combine=this.combine,_.reflectivity=this.reflectivity,_.refractionRatio=this.refractionRatio,_.fog=this.fog,_.shading=this.shading,_.wireframe=this.wireframe,_.wireframeLinewidth=this.wireframeLinewidth,_.wireframeLinecap=this.wireframeLinecap,_.wireframeLinejoin=this.wireframeLinejoin,_.vertexColors=this.vertexColors,_.skinning=this.skinning,_.morphTargets=this.morphTargets,_.morphNormals=this.morphNormals,_},THREE.MeshPhongMaterial=function(_){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.specular=new THREE.Color(1118481),this.shininess=30,this.metal=!1,this.perPixel=!0,this.wrapAround=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.displacementMap=null,this.uDisplacementBias=0,this.uDisplacementScale=1,this.uDisplacementCustomUVScale=0,this.uDisplacementCustomUVOffset=new THREE.Vector2(0,0),this.edgeRotateDisplacementL=0,this.edgeRotateDisplacementR=0,this.edgeScaleDisplacementU=1,this.waveBaseSpeed=null,this.waveNoiseTexture=null,this.waveNoiseScale=0.5337,this.waveBumpScale=5,this.mirrorTextureIndex=null,this.normalMap=null,this.normalScale=new THREE.Vector2(1,1),this.specularMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=0.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap='round',this.wireframeLinejoin='round',this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(_)},THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshPhongMaterial.prototype.clone=function(){var _=new THREE.MeshPhongMaterial;return THREE.Material.prototype.clone.call(this,_),_.color.copy(this.color),_.ambient.copy(this.ambient),_.emissive.copy(this.emissive),_.specular.copy(this.specular),_.shininess=this.shininess,_.metal=this.metal,_.perPixel=this.perPixel,_.wrapAround=this.wrapAround,_.wrapRGB.copy(this.wrapRGB),_.map=this.map,_.lightMap=this.lightMap,_.bumpMap=this.bumpMap,_.bumpScale=this.bumpScale,_.displacementMap=this.displacementMap,_.uDisplacementBias=this.uDisplacementBias,_.uDisplacementScale=this.uDisplacementScale,_.uDisplacementCustomUVScale=this.uDisplacementCustomUVScale,_.uDisplacementCustomUVOffset.copy(this.uDisplacementCustomUVOffset),_.edgeRotateDisplacementL=this.edgeRotateDisplacementL,_.edgeRotateDisplacementR=this.edgeRotateDisplacementR,_.edgeScaleDisplacementU=this.edgeScaleDisplacementU,_.waveBaseSpeed=this.waveBaseSpeed,_.waveNoiseTexture=this.waveNoiseTexture,_.waveNoiseScale=this.waveNoiseScale,_.waveBumpScale=this.waveBumpScale,_.mirrorTextureIndex=this.mirrorTextureIndex,_.normalMap=this.normalMap,_.normalScale.copy(this.normalScale),_.specularMap=this.specularMap,_.envMap=this.envMap,_.combine=this.combine,_.reflectivity=this.reflectivity,_.refractionRatio=this.refractionRatio,_.fog=this.fog,_.shading=this.shading,_.wireframe=this.wireframe,_.wireframeLinewidth=this.wireframeLinewidth,_.wireframeLinecap=this.wireframeLinecap,_.wireframeLinejoin=this.wireframeLinejoin,_.vertexColors=this.vertexColors,_.skinning=this.skinning,_.morphTargets=this.morphTargets,_.morphNormals=this.morphNormals,_},THREE.MeshDepthMaterial=function(_){THREE.Material.call(this),this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(_)},THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshDepthMaterial.prototype.clone=function(){var _=new THREE.MeshDepthMaterial;return THREE.Material.prototype.clone.call(this,_),_.wireframe=this.wireframe,_.wireframeLinewidth=this.wireframeLinewidth,_},THREE.MeshNormalMaterial=function(_){THREE.Material.call(this,_),this.shading=THREE.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(_)},THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshNormalMaterial.prototype.clone=function(){var _=new THREE.MeshNormalMaterial;return THREE.Material.prototype.clone.call(this,_),_.shading=this.shading,_.wireframe=this.wireframe,_.wireframeLinewidth=this.wireframeLinewidth,_},THREE.MeshFaceMaterial=function(_){this.materials=_ instanceof Array?_:[]},THREE.MeshFaceMaterial.prototype.clone=function(){return new THREE.MeshFaceMaterial(this.materials.slice(0))},THREE.ParticleBasicMaterial=function(_){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(_)},THREE.ParticleBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ParticleBasicMaterial.prototype.clone=function(){var _=new THREE.ParticleBasicMaterial;return THREE.Material.prototype.clone.call(this,_),_.color.copy(this.color),_.map=this.map,_.size=this.size,_.sizeAttenuation=this.sizeAttenuation,_.vertexColors=this.vertexColors,_.fog=this.fog,_},THREE.ParticleSystemMaterial=THREE.ParticleBasicMaterial,THREE.ShaderMaterial=function(_){THREE.Material.call(this),this.fragmentShader='void main() {}',this.vertexShader='void main() {}',this.uniforms={},this.defines={},this.attributes=null,this.shading=THREE.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(_)},THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ShaderMaterial.prototype.clone=function(){var _=new THREE.ShaderMaterial;return THREE.Material.prototype.clone.call(this,_),_.fragmentShader=this.fragmentShader,_.vertexShader=this.vertexShader,_.uniforms=THREE.UniformsUtils.clone(this.uniforms),_.attributes=this.attributes,_.defines=this.defines,_.shading=this.shading,_.wireframe=this.wireframe,_.wireframeLinewidth=this.wireframeLinewidth,_.fog=this.fog,_.lights=this.lights,_.vertexColors=this.vertexColors,_.skinning=this.skinning,_.morphTargets=this.morphTargets,_.morphNormals=this.morphNormals,_},THREE.SpriteMaterial=function(_){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=new THREE.Texture,this.useScreenCoordinates=!0,this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.scaleByViewport=!this.sizeAttenuation,this.alignment=THREE.SpriteAlignment.center.clone(),this.fog=!1,this.uvOffset=new THREE.Vector2(0,0),this.uvScale=new THREE.Vector2(1,1),this.setValues(_),_=_||{},_.depthTest===void 0&&(this.depthTest=!this.useScreenCoordinates),_.sizeAttenuation===void 0&&(this.sizeAttenuation=!this.useScreenCoordinates),_.scaleByViewport===void 0&&(this.scaleByViewport=!this.sizeAttenuation)},THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteMaterial.prototype.clone=function(){var _=new THREE.SpriteMaterial;return THREE.Material.prototype.clone.call(this,_),_.color.copy(this.color),_.map=this.map,_.useScreenCoordinates=this.useScreenCoordinates,_.sizeAttenuation=this.sizeAttenuation,_.scaleByViewport=this.scaleByViewport,_.alignment.copy(this.alignment),_.uvOffset.copy(this.uvOffset),_.uvScale.copy(this.uvScale),_.fog=this.fog,_},THREE.SpriteAlignment={},THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1),THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1),THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1),THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0),THREE.SpriteAlignment.center=new THREE.Vector2(0,0),THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0),THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1),THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1),THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1),THREE.Texture=function(_,S,M,T,A,C,E,D,P){this.id=THREE.TextureIdCount++,this.name='',this.image=_,this.mipmaps=[],this.mapping=S===void 0?new THREE.UVMapping:S,this.wrapS=M===void 0?THREE.ClampToEdgeWrapping:M,this.wrapT=T===void 0?THREE.ClampToEdgeWrapping:T,this.magFilter=A===void 0?THREE.LinearFilter:A,this.minFilter=C===void 0?THREE.LinearMipMapLinearFilter:C,this.anisotropy=P===void 0?1:P,this.format=E===void 0?THREE.RGBAFormat:E,this.type=D===void 0?THREE.UnsignedByteType:D,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},THREE.Texture.prototype={constructor:THREE.Texture,clone:function(_){return void 0===_&&(_=new THREE.Texture),_.image=this.image,_.mipmaps=this.mipmaps.slice(0),_.mapping=this.mapping,_.wrapS=this.wrapS,_.wrapT=this.wrapT,_.magFilter=this.magFilter,_.minFilter=this.minFilter,_.anisotropy=this.anisotropy,_.format=this.format,_.type=this.type,_.offset.copy(this.offset),_.repeat.copy(this.repeat),_.generateMipmaps=this.generateMipmaps,_.premultiplyAlpha=this.premultiplyAlpha,_.flipY=this.flipY,_.unpackAlignment=this.unpackAlignment,_},dispose:function(){this.dispatchEvent({type:'dispose'})}},THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype),THREE.TextureIdCount=0,THREE.CompressedTexture=function(_,S,M,T,A,C,E,D,P,R,L){THREE.Texture.call(this,null,C,E,D,P,R,T,A,L),this.image={width:S,height:M},this.mipmaps=_,this.generateMipmaps=!1},THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CompressedTexture.prototype.clone=function(){var _=new THREE.CompressedTexture;return THREE.Texture.prototype.clone.call(this,_),_},THREE.DataTexture=function(_,S,M,T,A,C,E,D,P,R,L){THREE.Texture.call(this,null,C,E,D,P,R,T,A,L),this.image={data:_,width:S,height:M}},THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype),THREE.DataTexture.prototype.clone=function(){var _=new THREE.DataTexture;return THREE.Texture.prototype.clone.call(this,_),_},THREE.Particle=function(_){THREE.Object3D.call(this),this.material=_},THREE.Particle.prototype=Object.create(THREE.Object3D.prototype),THREE.Particle.prototype.clone=function(_){return void 0===_&&(_=new THREE.Particle(this.material)),THREE.Object3D.prototype.clone.call(this,_),_},THREE.ParticleSystem=function(_,S){THREE.Object3D.call(this),this.geometry=_,this.material=S===void 0?new THREE.ParticleBasicMaterial({color:16777215*Math.random()}):S,this.sortParticles=!1,this.geometry&&null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.frustumCulled=!1},THREE.ParticleSystem.prototype=Object.create(THREE.Object3D.prototype),THREE.ParticleSystem.prototype.clone=function(_){return void 0===_&&(_=new THREE.ParticleSystem(this.geometry,this.material)),_.sortParticles=this.sortParticles,THREE.Object3D.prototype.clone.call(this,_),_},THREE.Line=function(_,S,M){THREE.Object3D.call(this),this.geometry=_,this.material=S===void 0?new THREE.LineBasicMaterial({color:16777215*Math.random()}):S,this.type=M===void 0?THREE.LineStrip:M,this.geometry&&!this.geometry.boundingSphere&&this.geometry.computeBoundingSphere()},THREE.LineStrip=0,THREE.LinePieces=1,THREE.Line.prototype=Object.create(THREE.Object3D.prototype),THREE.Line.prototype.clone=function(_){return void 0===_&&(_=new THREE.Line(this.geometry,this.material,this.type)),THREE.Object3D.prototype.clone.call(this,_),_},THREE.Mesh=function(_,S){THREE.Object3D.call(this),this.geometry=null,this.material=null,this.setGeometry(_),this.setMaterial(S)},THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype),THREE.Mesh.prototype.setGeometry=function(_){_!==void 0&&(this.geometry=_,null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.updateMorphTargets())},THREE.Mesh.prototype.setMaterial=function(_){this.material=void 0===_?new THREE.MeshBasicMaterial({color:16777215*Math.random(),wireframe:!0}):_},THREE.Mesh.prototype.updateMorphTargets=function(){if(0<this.geometry.morphTargets.length){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var _=0,S=this.geometry.morphTargets.length;_<S;_++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[_].name]=_}},THREE.Mesh.prototype.getMorphTargetIndexByName=function(_){return void 0===this.morphTargetDictionary[_]?0:this.morphTargetDictionary[_]},THREE.Mesh.prototype.clone=function(_){return void 0===_&&(_=new THREE.Mesh(this.geometry,this.material)),THREE.Object3D.prototype.clone.call(this,_),_},THREE.Bone=function(_){THREE.Object3D.call(this),this.skin=_,this.skinMatrix=new THREE.Matrix4},THREE.Bone.prototype=Object.create(THREE.Object3D.prototype),THREE.Bone.prototype.update=function(_,S){this.matrixAutoUpdate&&(S|=this.updateMatrix()),(S||this.matrixWorldNeedsUpdate)&&(_?this.skinMatrix.multiplyMatrices(_,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,S=!0);var A=this.children.length,T;for(T=0;T<A;T++)this.children[T].update(this.skinMatrix,S)},THREE.SkinnedMesh=function(_,S,M){THREE.Mesh.call(this,_,S),this.useVertexTexture=!(M!==void 0)||M,this.identityMatrix=new THREE.Matrix4,this.bones=[],this.boneMatrices=[];var T,A,C,E,D,P;if(this.geometry&&this.geometry.bones!==void 0){for(T=0;T<this.geometry.bones.length;T++)C=this.geometry.bones[T],E=C.pos,D=C.rotq,P=C.scl,A=this.addBone(),A.name=C.name,A.position.set(E[0],E[1],E[2]),A.quaternion.set(D[0],D[1],D[2],D[3]),A.useQuaternion=!0,void 0==P?A.scale.set(1,1,1):A.scale.set(P[0],P[1],P[2]);for(T=0;T<this.bones.length;T++)C=this.geometry.bones[T],A=this.bones[T],-1===C.parent?this.add(A):this.bones[C.parent].add(A);var R=this.bones.length;if(this.useVertexTexture){var L;L=256<R?64:64<R?32:16<R?16:8,this.boneTextureWidth=L,this.boneTextureHeight=L,this.boneMatrices=new Float32Array(4*(this.boneTextureWidth*this.boneTextureHeight)),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType),this.boneTexture.minFilter=THREE.NearestFilter,this.boneTexture.magFilter=THREE.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1}else this.boneMatrices=new Float32Array(16*R);this.pose()}},THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.SkinnedMesh.prototype.addBone=function(_){return void 0===_&&(_=new THREE.Bone(this)),this.bones.push(_),_},THREE.SkinnedMesh.prototype.updateMatrixWorld=function(_){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||_)&&(this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,_=!0);for(var S=0,M=this.children.length,T;S<M;S++)T=this.children[S],T instanceof THREE.Bone?T.update(this.identityMatrix,!1):T.updateMatrixWorld(!0);if(this.boneInverses==void 0){this.boneInverses=[];for(var A=0,C=this.bones.length,E;A<C;A++)E=new THREE.Matrix4,E.getInverse(this.bones[A].skinMatrix),this.boneInverses.push(E)}for(var A=0,C=this.bones.length;A<C;A++)THREE.SkinnedMesh.offsetMatrix.multiplyMatrices(this.bones[A].skinMatrix,this.boneInverses[A]),THREE.SkinnedMesh.offsetMatrix.flattenToArrayOffset(this.boneMatrices,16*A);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)},THREE.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var _=0;_<this.geometry.skinIndices.length;_++){var S=this.geometry.skinWeights[_],M=1/S.lengthManhattan();M==Infinity?S.set(1):S.multiplyScalar(M)}},THREE.SkinnedMesh.prototype.clone=function(_){return void 0===_&&(_=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),THREE.Mesh.prototype.clone.call(this,_),_},THREE.SkinnedMesh.offsetMatrix=new THREE.Matrix4,THREE.MorphAnimMesh=function(_,S){THREE.Mesh.call(this,_,S),this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphAnimMesh.prototype.setFrameRange=function(_,S){this.startKeyframe=_,this.endKeyframe=S,this.length=this.endKeyframe-this.startKeyframe+1},THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},THREE.MorphAnimMesh.prototype.parseAnimations=function(){var _=this.geometry;_.animations||(_.animations={});for(var M=_.animations,T=/([a-z]+)(\d+)/,A=0,C=_.morphTargets.length,S;A<C;A++){var E=_.morphTargets[A],D=E.name.match(T);if(D&&1<D.length){var P=D[1],R=D[2];M[P]||(M[P]={start:Infinity,end:-Infinity});var L=M[P];A<L.start&&(L.start=A),A>L.end&&(L.end=A),S||(S=P)}}_.firstAnimation=S},THREE.MorphAnimMesh.prototype.setAnimationLabel=function(_,S,M){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[_]={start:S,end:M}},THREE.MorphAnimMesh.prototype.playAnimation=function(_,S){var M=this.geometry.animations[_];M&&(this.setFrameRange(M.start,M.end),this.duration=1e3*((M.end-M.start)/S),this.time=0)},THREE.MorphAnimMesh.prototype.updateAnimation=function(_){var S=this.duration/this.length;this.time+=this.direction*_,this.mirroredLoop?(this.time>this.duration||0>this.time)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),0>this.time&&(this.time=0,this.directionBackwards=!1)):(this.time%=this.duration,0>this.time&&(this.time+=this.duration));var M=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/S),0,this.length-1);M!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[M]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=M);var T=this.time%S/S;this.directionBackwards&&(T=1-T),this.morphTargetInfluences[this.currentKeyframe]=T,this.morphTargetInfluences[this.lastKeyframe]=1-T},THREE.MorphAnimMesh.prototype.clone=function(_){return void 0===_&&(_=new THREE.MorphAnimMesh(this.geometry,this.material)),_.duration=this.duration,_.mirroredLoop=this.mirroredLoop,_.time=this.time,_.lastKeyframe=this.lastKeyframe,_.currentKeyframe=this.currentKeyframe,_.direction=this.direction,_.directionBackwards=this.directionBackwards,THREE.Mesh.prototype.clone.call(this,_),_},THREE.Ribbon=function(_,S){THREE.Object3D.call(this),this.geometry=_,this.material=S},THREE.Ribbon.prototype=Object.create(THREE.Object3D.prototype),THREE.Ribbon.prototype.clone=function(_){return void 0===_&&(_=new THREE.Ribbon(this.geometry,this.material)),THREE.Object3D.prototype.clone.call(this,_),_},THREE.LOD=function(){THREE.Object3D.call(this),this.objects=[]},THREE.LOD.prototype=Object.create(THREE.Object3D.prototype),THREE.LOD.prototype.addLevel=function(_,S){S===void 0&&(S=0),S=Math.abs(S);for(var M=0;M<this.objects.length&&!(S<this.objects[M].distance);M++);this.objects.splice(M,0,{distance:S,object:_}),this.add(_)},THREE.LOD.prototype.getObjectForDistance=function(_){for(var S=1,M=this.objects.length;S<M&&!(_<this.objects[S].distance);S++);return this.objects[S-1].object},THREE.LOD.prototype.update=function(){var _=new THREE.Vector3,S=new THREE.Vector3;return function(M){if(1<this.objects.length){_.getPositionFromMatrix(M.matrixWorld),S.getPositionFromMatrix(this.matrixWorld);var T=_.distanceTo(S);this.objects[0].object.visible=!0;for(var A=1,C=this.objects.length;A<C&&T>=this.objects[A].distance;A++)this.objects[A-1].object.visible=!1,this.objects[A].object.visible=!0;for(;A<C;A++)this.objects[A].object.visible=!1}}}(),THREE.LOD.prototype.clone=function(){},THREE.Sprite=function(_){THREE.Object3D.call(this),this.material=_===void 0?new THREE.SpriteMaterial:_,this.rotation3d=this.rotation,this.rotation=0},THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype),THREE.Sprite.prototype.updateMatrix=function(){this.rotation3d.set(0,0,this.rotation),this.quaternion.setFromEuler(this.rotation3d,this.eulerOrder),this.matrix.makeFromPositionQuaternionScale(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},THREE.Sprite.prototype.clone=function(_){return void 0===_&&(_=new THREE.Sprite(this.material)),THREE.Object3D.prototype.clone.call(this,_),_},THREE.Scene=function(){THREE.Object3D.call(this),this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},THREE.Scene.prototype=Object.create(THREE.Object3D.prototype),THREE.Scene.prototype.__addObject=function(_){if(_ instanceof THREE.Light)-1===this.__lights.indexOf(_)&&this.__lights.push(_),_.target&&void 0===_.target.parent&&this.add(_.target);else if(!(_ instanceof THREE.Camera||_ instanceof THREE.Bone)&&-1===this.__objects.indexOf(_)){this.__objects.push(_),this.__objectsAdded.push(_);var S=this.__objectsRemoved.indexOf(_);-1!==S&&this.__objectsRemoved.splice(S,1)}for(var M=0;M<_.children.length;M++)this.__addObject(_.children[M])},THREE.Scene.prototype.__removeObject=function(_){if(_ instanceof THREE.Light){var S=this.__lights.indexOf(_);-1!==S&&this.__lights.splice(S,1)}else if(!(_ instanceof THREE.Camera)){var S=this.__objects.indexOf(_);if(-1!==S){this.__objects.splice(S,1),this.__objectsRemoved.push(_);var M=this.__objectsAdded.indexOf(_);-1!==M&&this.__objectsAdded.splice(M,1)}}for(var T=0;T<_.children.length;T++)this.__removeObject(_.children[T])},THREE.Fog=function(_,S,M){this.name='',this.color=new THREE.Color(_),this.near=S===void 0?1:S,this.far=M===void 0?1e3:M},THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)},THREE.FogExp2=function(_,S){this.name='',this.color=new THREE.Color(_),this.density=S===void 0?2.5e-4:S},THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)},THREE.ShaderChunk={fog_pars_fragment:['#ifdef USE_FOG','uniform vec3 fogColor;','#ifdef FOG_EXP2','uniform float fogDensity;','#else','uniform float fogNear;','uniform float fogFar;','#endif','#endif'].join('\n'),fog_fragment:['#ifdef USE_FOG','float depth = gl_FragCoord.z / gl_FragCoord.w;','#ifdef FOG_EXP2','const float LOG2 = 1.442695;','float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );','fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );','#else','float fogFactor = smoothstep( fogNear, fogFar, depth );','#endif','gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );','#endif'].join('\n'),envmap_pars_fragment:['#ifdef USE_ENVMAP','uniform float reflectivity;','uniform samplerCube envMap;','uniform float flipEnvMap;','uniform int combine;','#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )','uniform bool useRefract;','uniform float refractionRatio;','#else','varying vec3 vReflect;','#endif','#endif'].join('\n'),envmap_fragment:['#ifdef USE_ENVMAP','vec3 reflectVec;','#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )','vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );','if ( useRefract ) {','reflectVec = refract( cameraToVertex, normal, refractionRatio );','} else { ','reflectVec = reflect( cameraToVertex, normal );','}','#else','reflectVec = vReflect;','#endif','#ifdef DOUBLE_SIDED','float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );','vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );','#else','vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );','#endif','#ifdef GAMMA_INPUT','cubeColor.xyz *= cubeColor.xyz;','#endif','if ( combine == 1 ) {','gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );','} else if ( combine == 2 ) {','gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;','} else {','gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );','}','#endif'].join('\n'),envmap_pars_vertex:['#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )','varying vec3 vReflect;','uniform float refractionRatio;','uniform bool useRefract;','#endif'].join('\n'),worldpos_vertex:['#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )','#ifdef USE_SKINNING','vec4 worldPosition = modelMatrix * skinned;','#endif','#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )','vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );','#endif','#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )','#if defined( VERTEX_TEXTURES ) && ( defined( USE_DISPLACEMENTMAP ) || defined( USE_WAVE_TEXTURE ) )','vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );','#else','vec4 worldPosition = modelMatrix * vec4( position, 1.0 );','#endif','#endif','#ifdef USE_MIRROR_TEXTURE','mirrorCoord = mirrorTextureMatrix * worldPosition;','#endif','#endif'].join('\n'),envmap_vertex:['#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )','vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;','worldNormal = normalize( worldNormal );','vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );','if ( useRefract ) {','vReflect = refract( cameraToVertex, worldNormal, refractionRatio );','} else {','vReflect = reflect( cameraToVertex, worldNormal );','}','#endif'].join('\n'),map_particle_pars_fragment:['#ifdef USE_MAP','uniform sampler2D map;','#endif'].join('\n'),map_particle_fragment:['#ifdef USE_MAP','gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );','#endif'].join('\n'),map_pars_vertex:['#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_DISPLACEMENTMAP ) || defined( USE_WAVE_TEXTURE )','varying vec2 vUv;','uniform vec4 offsetRepeat;','#endif'].join('\n'),map_pars_fragment:['#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )','varying vec2 vUv;','#endif','#ifdef USE_MAP','uniform sampler2D map;','#endif'].join('\n'),map_vertex:['#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_DISPLACEMENTMAP ) || defined( USE_WAVE_TEXTURE )','vUv = uv * offsetRepeat.zw + offsetRepeat.xy;','#endif'].join('\n'),map_fragment:['#ifdef USE_MAP','#if defined( VERTEX_TEXTURES ) && defined( USE_WAVE_TEXTURE )','  vec2 uvTimeShift = vUv + vec2( -0.7, 1.5 ) * time * waveBaseSpeed;','  vec4 noiseGeneratorTimeShift = texture2D( waveNoiseTexture, mod(uvTimeShift,1.0) );','  vec2 uvNoiseTimeShift = vUv + waveNoiseScale * vec2( noiseGeneratorTimeShift.r, noiseGeneratorTimeShift.b );','  vec4 texelColor = texture2D( map, mod(uvNoiseTimeShift,1.0) );','#else','vec4 texelColor = texture2D( map, vUv );','#endif','#ifdef GAMMA_INPUT','texelColor.xyz *= texelColor.xyz;','#endif','gl_FragColor = gl_FragColor * texelColor;','#endif'].join('\n'),lightmap_pars_fragment:['#ifdef USE_LIGHTMAP','varying vec2 vUv2;','uniform sampler2D lightMap;','#endif'].join('\n'),lightmap_pars_vertex:['#ifdef USE_LIGHTMAP','varying vec2 vUv2;','#endif'].join('\n'),lightmap_fragment:['#ifdef USE_LIGHTMAP','gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );','#endif'].join('\n'),lightmap_vertex:['#ifdef USE_LIGHTMAP','vUv2 = uv2;','#endif'].join('\n'),bumpmap_pars_fragment:['#ifdef USE_BUMPMAP','uniform sampler2D bumpMap;','uniform float bumpScale;','vec2 dHdxy_fwd() {','vec2 dSTdx = dFdx( vUv );','vec2 dSTdy = dFdy( vUv );','float Hll = bumpScale * texture2D( bumpMap, vUv ).x;','float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;','float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;','return vec2( dBx, dBy );','}','vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {','vec3 vSigmaX = dFdx( surf_pos );','vec3 vSigmaY = dFdy( surf_pos );','vec3 vN = surf_norm;','vec3 R1 = cross( vSigmaY, vN );','vec3 R2 = cross( vN, vSigmaX );','float fDet = dot( vSigmaX, R1 );','vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );','return normalize( abs( fDet ) * surf_norm - vGrad );','}','#endif'].join('\n'),normalmap_pars_fragment:['#ifdef USE_NORMALMAP','uniform sampler2D normalMap;','uniform vec2 normalScale;','vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {','vec3 q0 = dFdx( eye_pos.xyz );','vec3 q1 = dFdy( eye_pos.xyz );','vec2 st0 = dFdx( vUv.st );','vec2 st1 = dFdy( vUv.st );','vec3 S = normalize(  q0 * st1.t - q1 * st0.t );','vec3 T = normalize( -q0 * st1.s + q1 * st0.s );','vec3 N = normalize( surf_norm );','vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;','mapN.xy = normalScale * mapN.xy;','mat3 tsn = mat3( S, T, N );','return normalize( tsn * mapN );','}','#endif'].join('\n'),specularmap_pars_fragment:['#ifdef USE_SPECULARMAP','uniform sampler2D specularMap;','#endif'].join('\n'),specularmap_fragment:['float specularStrength;','#ifdef USE_SPECULARMAP','vec4 texelSpecular = texture2D( specularMap, vUv );','specularStrength = texelSpecular.r;','#else','specularStrength = 1.0;','#endif'].join('\n'),lights_lambert_pars_vertex:['uniform vec3 ambient;','uniform vec3 diffuse;','uniform vec3 emissive;','uniform vec3 ambientLightColor;','#if MAX_DIR_LIGHTS > 0','uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];','uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];','#endif','#if MAX_HEMI_LIGHTS > 0','uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];','uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];','uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];','#endif','#if MAX_POINT_LIGHTS > 0','uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];','uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];','uniform float pointLightDistance[ MAX_POINT_LIGHTS ];','#endif','#if MAX_SPOT_LIGHTS > 0','uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];','uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];','uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];','uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];','uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];','uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];','#endif','#ifdef WRAP_AROUND','uniform vec3 wrapRGB;','#endif'].join('\n'),lights_lambert_vertex:['vLightFront = vec3( 0.0 );','#ifdef DOUBLE_SIDED','vLightBack = vec3( 0.0 );','#endif','transformedNormal = normalize( transformedNormal );','#if MAX_DIR_LIGHTS > 0','for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {','vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );','vec3 dirVector = normalize( lDirection.xyz );','float dotProduct = dot( transformedNormal, dirVector );','vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );','#ifdef DOUBLE_SIDED','vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );','#ifdef WRAP_AROUND','vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );','#endif','#endif','#ifdef WRAP_AROUND','vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );','directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );','#ifdef DOUBLE_SIDED','directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );','#endif','#endif','vLightFront += directionalLightColor[ i ] * directionalLightWeighting;','#ifdef DOUBLE_SIDED','vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;','#endif','}','#endif','#if MAX_POINT_LIGHTS > 0','for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {','vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );','vec3 lVector = lPosition.xyz - mvPosition.xyz;','float lDistance = 1.0;','if ( pointLightDistance[ i ] > 0.0 )','lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );','lVector = normalize( lVector );','float dotProduct = dot( transformedNormal, lVector );','vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );','#ifdef DOUBLE_SIDED','vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );','#ifdef WRAP_AROUND','vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );','#endif','#endif','#ifdef WRAP_AROUND','vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );','pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );','#ifdef DOUBLE_SIDED','pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );','#endif','#endif','vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;','#ifdef DOUBLE_SIDED','vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;','#endif','}','#endif','#if MAX_SPOT_LIGHTS > 0','for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {','vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );','vec3 lVector = lPosition.xyz - mvPosition.xyz;','float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );','if ( spotEffect > spotLightAngleCos[ i ] ) {','spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );','float lDistance = 1.0;','if ( spotLightDistance[ i ] > 0.0 )','lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );','lVector = normalize( lVector );','float dotProduct = dot( transformedNormal, lVector );','vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );','#ifdef DOUBLE_SIDED','vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );','#ifdef WRAP_AROUND','vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );','#endif','#endif','#ifdef WRAP_AROUND','vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );','spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );','#ifdef DOUBLE_SIDED','spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );','#endif','#endif','vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;','#ifdef DOUBLE_SIDED','vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;','#endif','}','}','#endif','#if MAX_HEMI_LIGHTS > 0','for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {','vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );','vec3 lVector = normalize( lDirection.xyz );','float dotProduct = dot( transformedNormal, lVector );','float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;','float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;','vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );','#ifdef DOUBLE_SIDED','vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );','#endif','}','#endif','vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;','#ifdef DOUBLE_SIDED','vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;','#endif'].join('\n'),lights_phong_pars_vertex:['#ifndef PHONG_PER_PIXEL','#if MAX_POINT_LIGHTS > 0','uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];','uniform float pointLightDistance[ MAX_POINT_LIGHTS ];','varying vec4 vPointLight[ MAX_POINT_LIGHTS ];','#endif','#if MAX_SPOT_LIGHTS > 0','uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];','uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];','varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];','#endif','#endif','#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )','varying vec3 vWorldPosition;','#endif'].join('\n'),lights_phong_vertex:['#ifndef PHONG_PER_PIXEL','#if MAX_POINT_LIGHTS > 0','for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {','vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );','vec3 lVector = lPosition.xyz - mvPosition.xyz;','float lDistance = 1.0;','if ( pointLightDistance[ i ] > 0.0 )','lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );','vPointLight[ i ] = vec4( lVector, lDistance );','}','#endif','#if MAX_SPOT_LIGHTS > 0','for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {','vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );','vec3 lVector = lPosition.xyz - mvPosition.xyz;','float lDistance = 1.0;','if ( spotLightDistance[ i ] > 0.0 )','lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );','vSpotLight[ i ] = vec4( lVector, lDistance );','}','#endif','#endif','#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )','vWorldPosition = worldPosition.xyz;','#endif'].join('\n'),lights_phong_pars_fragment:['uniform vec3 ambientLightColor;','#if MAX_DIR_LIGHTS > 0','uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];','uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];','#endif','#if MAX_HEMI_LIGHTS > 0','uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];','uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];','uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];','#endif','#if MAX_POINT_LIGHTS > 0','uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];','#ifdef PHONG_PER_PIXEL','uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];','uniform float pointLightDistance[ MAX_POINT_LIGHTS ];','#else','varying vec4 vPointLight[ MAX_POINT_LIGHTS ];','#endif','#endif','#if MAX_SPOT_LIGHTS > 0','uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];','uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];','uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];','uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];','uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];','#ifdef PHONG_PER_PIXEL','uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];','#else','varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];','#endif','#endif','#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )','varying vec3 vWorldPosition;','#endif','#ifdef WRAP_AROUND','uniform vec3 wrapRGB;','#endif','varying vec3 vViewPosition;','varying vec3 vNormal;'].join('\n'),lights_phong_fragment:['#ifdef COMPUTE_NORMAL_FROM_DISPLACEMENT','  vec3 normal = normalize( cross( dFdx( vViewPosition ), dFdy( vViewPosition ) ) );','#else','vec3 normal = normalize( vNormal );','#endif','vec3 viewPosition = normalize( vViewPosition );','#ifdef DOUBLE_SIDED','normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );','#endif','#ifdef USE_NORMALMAP','normal = perturbNormal2Arb( -vViewPosition, normal );','#elif defined( USE_BUMPMAP )','normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );','#endif','#if MAX_POINT_LIGHTS > 0','vec3 pointDiffuse  = vec3( 0.0 );','vec3 pointSpecular = vec3( 0.0 );','for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {','#ifdef PHONG_PER_PIXEL','vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );','vec3 lVector = lPosition.xyz + vViewPosition.xyz;','float lDistance = 1.0;','if ( pointLightDistance[ i ] > 0.0 )','lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );','lVector = normalize( lVector );','#else','vec3 lVector = normalize( vPointLight[ i ].xyz );','float lDistance = vPointLight[ i ].w;','#endif','float dotProduct = dot( normal, lVector );','#ifdef WRAP_AROUND','float pointDiffuseWeightFull = max( dotProduct, 0.0 );','float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );','vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );','#else','float pointDiffuseWeight = max( dotProduct, 0.0 );','#endif','pointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;','vec3 pointHalfVector = normalize( lVector + viewPosition );','float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );','float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );','#ifdef PHYSICALLY_BASED_SHADING','float specularNormalization = ( shininess + 2.0001 ) / 8.0;','vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );','pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;','#else','pointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;','#endif','}','#endif','#if MAX_SPOT_LIGHTS > 0','vec3 spotDiffuse  = vec3( 0.0 );','vec3 spotSpecular = vec3( 0.0 );','for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {','#ifdef PHONG_PER_PIXEL','vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );','vec3 lVector = lPosition.xyz + vViewPosition.xyz;','float lDistance = 1.0;','if ( spotLightDistance[ i ] > 0.0 )','lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );','lVector = normalize( lVector );','#else','vec3 lVector = normalize( vSpotLight[ i ].xyz );','float lDistance = vSpotLight[ i ].w;','#endif','float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );','if ( spotEffect > spotLightAngleCos[ i ] ) {','spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );','float dotProduct = dot( normal, lVector );','#ifdef WRAP_AROUND','float spotDiffuseWeightFull = max( dotProduct, 0.0 );','float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );','vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );','#else','float spotDiffuseWeight = max( dotProduct, 0.0 );','#endif','spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;','vec3 spotHalfVector = normalize( lVector + viewPosition );','float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );','float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );','#ifdef PHYSICALLY_BASED_SHADING','float specularNormalization = ( shininess + 2.0001 ) / 8.0;','vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );','spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;','#else','spotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;','#endif','}','}','#endif','#if MAX_DIR_LIGHTS > 0','vec3 dirDiffuse  = vec3( 0.0 );','vec3 dirSpecular = vec3( 0.0 );','for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {','vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );','vec3 dirVector = normalize( lDirection.xyz );','float dotProduct = dot( normal, dirVector );','#ifdef WRAP_AROUND','float dirDiffuseWeightFull = max( dotProduct, 0.0 );','float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );','vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );','#else','float dirDiffuseWeight = max( dotProduct, 0.0 );','#endif','dirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;','vec3 dirHalfVector = normalize( dirVector + viewPosition );','float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );','float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );','#ifdef PHYSICALLY_BASED_SHADING','float specularNormalization = ( shininess + 2.0001 ) / 8.0;','vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );','dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;','#else','dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;','#endif','}','#endif','#if MAX_HEMI_LIGHTS > 0','vec3 hemiDiffuse  = vec3( 0.0 );','vec3 hemiSpecular = vec3( 0.0 );','for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {','vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );','vec3 lVector = normalize( lDirection.xyz );','float dotProduct = dot( normal, lVector );','float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;','vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );','hemiDiffuse += diffuse * hemiColor;','vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );','float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;','float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );','vec3 lVectorGround = -lVector;','vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );','float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;','float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );','#ifdef PHYSICALLY_BASED_SHADING','float dotProductGround = dot( normal, lVectorGround );','float specularNormalization = ( shininess + 2.0001 ) / 8.0;','vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );','vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );','hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );','#else','hemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;','#endif','}','#endif','vec3 totalDiffuse = vec3( 0.0 );','vec3 totalSpecular = vec3( 0.0 );','#if MAX_DIR_LIGHTS > 0','totalDiffuse += dirDiffuse;','totalSpecular += dirSpecular;','#endif','#if MAX_HEMI_LIGHTS > 0','totalDiffuse += hemiDiffuse;','totalSpecular += hemiSpecular;','#endif','#if MAX_POINT_LIGHTS > 0','totalDiffuse += pointDiffuse;','totalSpecular += pointSpecular;','#endif','#if MAX_SPOT_LIGHTS > 0','totalDiffuse += spotDiffuse;','totalSpecular += spotSpecular;','#endif','#ifdef METAL','#ifdef USE_SPECULARMAP','float metalness = texelSpecular.g;','gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular*(1.0-metalness) ) + totalSpecular*metalness;','#else','gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );','#endif','#else','gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;','#endif'].join('\n'),color_pars_fragment:['#ifdef USE_COLOR','varying vec3 vColor;','#endif'].join('\n'),color_fragment:['#ifdef USE_COLOR','gl_FragColor = gl_FragColor * vec4( vColor, opacity );','#endif'].join('\n'),color_pars_vertex:['#ifdef USE_COLOR','varying vec3 vColor;','#endif'].join('\n'),color_vertex:['#ifdef USE_COLOR','#ifdef GAMMA_INPUT','vColor = color * color;','#else','vColor = color;','#endif','#endif'].join('\n'),skinning_pars_vertex:['#ifdef USE_SKINNING','#ifdef BONE_TEXTURE','uniform sampler2D boneTexture;','mat4 getBoneMatrix( const in float i ) {','float j = i * 4.0;','float x = mod( j, N_BONE_PIXEL_X );','float y = floor( j / N_BONE_PIXEL_X );','const float dx = 1.0 / N_BONE_PIXEL_X;','const float dy = 1.0 / N_BONE_PIXEL_Y;','y = dy * ( y + 0.5 );','vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );','vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );','vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );','vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );','mat4 bone = mat4( v1, v2, v3, v4 );','return bone;','}','#else','uniform mat4 boneGlobalMatrices[ MAX_BONES ];','mat4 getBoneMatrix( const in float i ) {','mat4 bone = boneGlobalMatrices[ int(i) ];','return bone;','}','#endif','#endif'].join('\n'),skinbase_vertex:['#ifdef USE_SKINNING','mat4 boneMatX = getBoneMatrix( skinIndex.x );','mat4 boneMatY = getBoneMatrix( skinIndex.y );','#endif'].join('\n'),skinning_vertex:['#ifdef USE_SKINNING','#ifdef USE_MORPHTARGETS','vec4 skinVertex = vec4( morphed, 1.0 );','#else','vec4 skinVertex = vec4( position, 1.0 );','#endif','vec4 skinned  = boneMatX * skinVertex * skinWeight.x;','skinned \t  += boneMatY * skinVertex * skinWeight.y;','#endif'].join('\n'),morphtarget_pars_vertex:['#ifdef USE_MORPHTARGETS','#ifndef USE_MORPHNORMALS','uniform float morphTargetInfluences[ 8 ];','#else','uniform float morphTargetInfluences[ 4 ];','#endif','#endif'].join('\n'),morphtarget_vertex:['#ifdef USE_MORPHTARGETS','vec3 morphed = vec3( 0.0 );','morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];','morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];','morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];','morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];','#ifndef USE_MORPHNORMALS','morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];','morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];','morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];','morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];','#endif','morphed += position;','#endif'].join('\n'),default_vertex:['vec4 mvPosition;','#ifdef USE_SKINNING','mvPosition = modelViewMatrix * skinned;','#endif','#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )','mvPosition = modelViewMatrix * vec4( morphed, 1.0 );','#endif','#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )','#if defined( VERTEX_TEXTURES ) && ( defined( USE_DISPLACEMENTMAP ) || defined( USE_WAVE_TEXTURE ) )','mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );','#else','mvPosition = modelViewMatrix * vec4( position, 1.0 );','#endif','#endif','gl_Position = projectionMatrix * mvPosition;'].join('\n'),morphnormal_vertex:['#ifdef USE_MORPHNORMALS','vec3 morphedNormal = vec3( 0.0 );','morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];','morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];','morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];','morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];','morphedNormal += normal;','#endif'].join('\n'),skinnormal_vertex:['#ifdef USE_SKINNING','mat4 skinMatrix = skinWeight.x * boneMatX;','skinMatrix \t+= skinWeight.y * boneMatY;','#ifdef USE_MORPHNORMALS','vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );','#else','vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );','#endif','#endif'].join('\n'),defaultnormal_vertex:['vec3 objectNormal;','#ifdef USE_SKINNING','objectNormal = skinnedNormal.xyz;','#endif','#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )','objectNormal = morphedNormal;','#endif','#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )','objectNormal = normal;','#endif','#ifdef FLIP_SIDED','objectNormal = -objectNormal;','#endif','#ifdef USE_SHADOWMAP','  normal_untransformed = normalize(mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal);','#endif','vec3 transformedNormal = normalMatrix * objectNormal;'].join('\n'),shadowmap_pars_fragment:['#ifdef USE_SHADOWMAP','uniform sampler2D shadowMap[ MAX_SHADOWS ];','uniform vec2 shadowMapSize[ MAX_SHADOWS ];','uniform float shadowDarkness[ MAX_SHADOWS ];','uniform vec3 shadowBias[ MAX_SHADOWS ];','uniform vec3 shadowPara[ MAX_SHADOWS ];','varying vec3 normal_untransformed;','varying vec4 vShadowCoord[ MAX_SHADOWS ];','float unpackDepth( const in vec4 rgba_depth ) {','const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );','float depth = dot( rgba_depth, bit_shift );','return depth;','}','#endif'].join('\n'),shadowmap_fragment:['#ifdef USE_SHADOWMAP','#ifdef SHADOWMAP_DEBUG','vec3 frustumColors[3];','frustumColors[0] = vec3( 1.0, 0.5, 0.0 );','frustumColors[1] = vec3( 0.0, 1.0, 0.8 );','frustumColors[2] = vec3( 0.0, 0.5, 1.0 );','#endif','#ifdef SHADOWMAP_CASCADE','int inFrustumCount = 0;','float parent_light_id = 0.0;','#endif','float fDepth;','vec3 shadowColor = vec3( 1.0 );','vec3 SP;','for( int i = 0; i < MAX_SHADOWS; i ++ ) {','SP = shadowPara[i];','#ifdef SHADOWMAP_CASCADE','if (parent_light_id != SP.y) {','parent_light_id = SP.y;','inFrustumCount = 0;','}','#endif','vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;','bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );','bool inFrustum = all( inFrustumVec );','#ifdef SHADOWMAP_CASCADE','inFrustumCount += int( inFrustum );','bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );','#else','bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );','#endif','bool frustumTest = all( frustumTestVec );','if ( frustumTest ) {','shadowCoord.z += shadowBias[ i ].x * clamp(pow(abs(tan(acos(clamp(dot(directionalLightDirection[ int(SP.y) ], normal_untransformed), -1., 1.)))), 2.0), shadowBias[ i ].y, shadowBias[ i ].z);','float shadowDarkness_scale = (1.0-emissive.r) * opacity;','#if defined( SHADOWMAP_TYPE_PCF )','float shadow = 0.0;','const float shadowDelta = 1.0 / 9.0;','float xPixelOffset = 1.0 / shadowMapSize[ i ].x;','float yPixelOffset = 1.0 / shadowMapSize[ i ].y;','float dx0 = -1.25 * xPixelOffset;','float dy0 = -1.25 * yPixelOffset;','float dx1 = 1.25 * xPixelOffset;','float dy1 = 1.25 * yPixelOffset;','fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );','if ( fDepth < shadowCoord.z ) shadow += shadowDelta;','fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );','if ( fDepth < shadowCoord.z ) shadow += shadowDelta;','fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );','if ( fDepth < shadowCoord.z ) shadow += shadowDelta;','fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );','if ( fDepth < shadowCoord.z ) shadow += shadowDelta;','fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );','if ( fDepth < shadowCoord.z ) shadow += shadowDelta;','fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );','if ( fDepth < shadowCoord.z ) shadow += shadowDelta;','fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );','if ( fDepth < shadowCoord.z ) shadow += shadowDelta;','fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );','if ( fDepth < shadowCoord.z ) shadow += shadowDelta;','fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );','if ( fDepth < shadowCoord.z ) shadow += shadowDelta;','shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] *shadowDarkness_scale * shadow ) );','#elif defined( SHADOWMAP_TYPE_PCF_SOFT )','float shadow = 0.0;','float xPixelOffset = 1.0 / shadowMapSize[ i ].x;','float yPixelOffset = 1.0 / shadowMapSize[ i ].y;','float dx0 = -1.0 * xPixelOffset;','float dy0 = -1.0 * yPixelOffset;','float dx1 = 1.0 * xPixelOffset;','float dy1 = 1.0 * yPixelOffset;','mat3 shadowKernel;','mat3 depthKernel;','depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );','depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );','depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );','depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );','depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );','depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );','depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );','depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );','depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );','vec3 shadowZ = vec3( shadowCoord.z );','shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));','shadowKernel[0] *= vec3(0.25);','shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));','shadowKernel[1] *= vec3(0.25);','shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));','shadowKernel[2] *= vec3(0.25);','vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );','shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );','shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );','vec4 shadowValues;','shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );','shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );','shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );','shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );','shadow = dot( shadowValues, vec4( 1.0 ) );','shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ]*shadowDarkness_scale * shadow ) );','#ifndef SHADOWMAP_CASCADE','float shadow_opacity = 1. - min(pow(length((shadowCoord.xy-0.5)*2.),4.), 1.);','shadowColor = mix(vec3(1.), shadowColor, shadow_opacity);','#endif','#else','vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );','float fDepth = unpackDepth( rgbaDepth );','if ( fDepth < shadowCoord.z )','shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ]*shadowDarkness_scale );','#endif','}','#ifdef SHADOWMAP_DEBUG','#ifdef SHADOWMAP_CASCADE','if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];','#else','if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];','#endif','#endif','}','#ifdef GAMMA_OUTPUT','shadowColor *= shadowColor;','#endif','gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;','#endif'].join('\n'),shadowmap_pars_vertex:['#ifdef USE_SHADOWMAP','varying vec3 normal_untransformed;','varying vec4 vShadowCoord[ MAX_SHADOWS ];','uniform mat4 shadowMatrix[ MAX_SHADOWS ];','#endif'].join('\n'),shadowmap_vertex:['#ifdef USE_SHADOWMAP','for( int i = 0; i < MAX_SHADOWS; i ++ ) {','vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;','}','#endif'].join('\n'),alphatest_fragment:['#ifdef ALPHATEST','if ( gl_FragColor.a < ALPHATEST ) discard;','#endif'].join('\n'),linear_to_gamma_fragment:['#ifdef GAMMA_OUTPUT','gl_FragColor.xyz = sqrt( gl_FragColor.xyz );','#endif'].join('\n')},THREE.UniformsUtils={merge:function(_){var A={},S,M,T;for(S=0;S<_.length;S++)for(M in T=this.clone(_[S]),T)A[M]=T[M];return A},clone:function(_){var C={},S,M,A;for(S in _)for(M in C[S]={},_[S])A=_[S][M],C[S][M]=A instanceof THREE.Color||A instanceof THREE.Vector2||A instanceof THREE.Vector3||A instanceof THREE.Vector4||A instanceof THREE.Matrix4||A instanceof THREE.Texture?A.clone():A instanceof Array?A.slice():A;return C}},THREE.ShaderChunk.common='#define PI 3.14159265359\n#define PI2 6.28318530718\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\n\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\n\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\n\n\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n}\n\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\n\treturn - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n',THREE.ShaderChunk.packing='vec3 packNormalToRGB( const in vec3 normal ) {\n  return normalize( normal ) * 0.5 + 0.5;\n}\n\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n  return 1.0 - 2.0 * rgb.xyz;\n}\n\n\nvec4 packDepthToRGBA( const in float value ) {\n\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\n\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n\tvec4 res = mod( value * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\n\tres -= res.xxyz * bit_mask;\n\treturn res;\n}\nfloat unpackRGBAToDepth( const in vec4 rgba ) {\n\tconst vec4 bitSh = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\treturn dot( rgba, bitSh );\n}\n\n// NOTE: viewZ/eyeZ is < 0 when in front of the camera per OpenGL conventions\n\nfloat viewZToOrthoDepth( const in float viewZ, const in float near, const in float far ) {\n  return ( viewZ + near ) / ( near - far );\n}\nfloat OrthoDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n  return linearClipZ * ( near - far ) - near;\n}\n\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n  return (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n  return ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n',THREE.ShaderChunk.AT_depth_render_mode_pars_fragment='uniform int depth_render_mode;\n'+THREE.ShaderChunk.packing,THREE.ShaderChunk.AT_depth_render_mode_fragment='if (depth_render_mode > 0) {\n#ifdef MMD\n#ifdef USE_MAP\nif (mmdEdgeThick <= 0.25) {\n  if (texture2D( map, vUv ).a == 0.0) { discard; }\n}\n#endif\n#endif\n#ifndef SKIP_SAO_DEPTH\n gl_FragColor = packDepthToRGBA( ((depth_render_mode == 1) ? gl_FragCoord.z : gl_FragCoord.w) ); return;\n#else\n gl_FragColor = packDepthToRGBA(gl_FragCoord.w); return;\n#endif\n}\n',THREE.UniformsLib={common:{depth_render_mode:{type:'i',value:0},diffuse:{type:'c',value:new THREE.Color(15658734)},opacity:{type:'f',value:1},map:{type:'t',value:null},offsetRepeat:{type:'v4',value:new THREE.Vector4(0,0,1,1)},lightMap:{type:'t',value:null},specularMap:{type:'t',value:null},envMap:{type:'t',value:null},flipEnvMap:{type:'f',value:-1},useRefract:{type:'i',value:0},reflectivity:{type:'f',value:1},refractionRatio:{type:'f',value:0.98},combine:{type:'i',value:0},morphTargetInfluences:{type:'f',value:0}},bump:{bumpMap:{type:'t',value:null},bumpScale:{type:'f',value:1}},normalmap:{normalMap:{type:'t',value:null},normalScale:{type:'v2',value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:'f',value:2.5e-4},fogNear:{type:'f',value:1},fogFar:{type:'f',value:2e3},fogColor:{type:'c',value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:'fv',value:[]},directionalLightDirection:{type:'fv',value:[]},directionalLightColor:{type:'fv',value:[]},hemisphereLightDirection:{type:'fv',value:[]},hemisphereLightSkyColor:{type:'fv',value:[]},hemisphereLightGroundColor:{type:'fv',value:[]},pointLightColor:{type:'fv',value:[]},pointLightPosition:{type:'fv',value:[]},pointLightDistance:{type:'fv1',value:[]},spotLightColor:{type:'fv',value:[]},spotLightPosition:{type:'fv',value:[]},spotLightDirection:{type:'fv',value:[]},spotLightDistance:{type:'fv1',value:[]},spotLightAngleCos:{type:'fv1',value:[]},spotLightExponent:{type:'fv1',value:[]}},particle:{psColor:{type:'c',value:new THREE.Color(15658734)},opacity:{type:'f',value:1},size:{type:'f',value:1},scale:{type:'f',value:1},map:{type:'t',value:null},fogDensity:{type:'f',value:2.5e-4},fogNear:{type:'f',value:1},fogFar:{type:'f',value:2e3},fogColor:{type:'c',value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:'tv',value:[]},shadowMapSize:{type:'v2v',value:[]},shadowBias:{type:'v3v',value:[]},shadowPara:{type:'v3v',value:[]},shadowDarkness:{type:'fv1',value:[]},shadowMatrix:{type:'m4v',value:[]}}},THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,'void main() {',THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,'#ifdef USE_ENVMAP',THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,'#else','  #ifdef USE_SHADOWMAP','    normal_untransformed = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * normal;','  #endif','#endif',THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,'}'].join('\n'),fragmentShader:['uniform vec3 diffuse;','uniform float opacity;',THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.AT_depth_render_mode_pars_fragment,'void main() {',THREE.ShaderChunk.AT_depth_render_mode_fragment,'gl_FragColor = vec4( diffuse, opacity );',THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,'}'].join('\n')},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:'c',value:new THREE.Color(16777215)},emissive:{type:'c',value:new THREE.Color(0)},wrapRGB:{type:'v3',value:new THREE.Vector3(1,1,1)}}]),vertexShader:['#define LAMBERT','varying vec3 vLightFront;','#ifdef DOUBLE_SIDED','varying vec3 vLightBack;','#endif',THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,'void main() {',THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,'}'].join('\n'),fragmentShader:['uniform float opacity;','varying vec3 vLightFront;','#ifdef DOUBLE_SIDED','varying vec3 vLightBack;','#endif',THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.AT_depth_render_mode_pars_fragment,'void main() {',THREE.ShaderChunk.AT_depth_render_mode_fragment,'gl_FragColor = vec4( BASE_COLOR, opacity );',THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,'#ifdef DOUBLE_SIDED','if ( gl_FrontFacing )','gl_FragColor.xyz *= vLightFront;','else','gl_FragColor.xyz *= vLightBack;','#else','gl_FragColor.xyz *= vLightFront;','#endif',THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,'}'].join('\n')},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,{tDisplacement:{type:'t',value:null},uDisplacementBias:{type:'f',value:0},uDisplacementScale:{type:'f',value:1},uDisplacementCustomUVScale:{type:'f',value:0},uDisplacementCustomUVOffset:{type:'v2',value:new THREE.Vector2(0,0)},edgeRotateDisplacementL:{type:'f',value:0},edgeRotateDisplacementR:{type:'f',value:0},edgeScaleDisplacementU:{type:'f',value:1},waveBaseSpeed:{type:'f',value:0},waveNoiseTexture:{type:'t',value:null},waveNoiseScale:{type:'f',value:0.5337},waveBumpScale:{type:'f',value:5},time:{type:'f',value:0},waveDrops:{type:'v4v',value:[]},mirrorSampler:{type:'t',value:null},mirrorTextureMatrix:{type:'m4',value:new THREE.Matrix4},reflection_alpha:{type:'f',value:1}},THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:'c',value:new THREE.Color(16777215)},emissive:{type:'c',value:new THREE.Color(0)},specular:{type:'c',value:new THREE.Color(1118481)},shininess:{type:'f',value:30},wrapRGB:{type:'v3',value:new THREE.Vector3(1,1,1)}}]),vertexShader:['#define PHONG','varying vec3 vViewPosition;','varying vec3 vNormal;',THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,'#if defined( VERTEX_TEXTURES ) && defined( USE_DISPLACEMENTMAP )','uniform sampler2D tDisplacement;','uniform float uDisplacementScale;','uniform float uDisplacementBias;','uniform float uDisplacementCustomUVScale;','uniform vec2 uDisplacementCustomUVOffset;','uniform float edgeRotateDisplacementL;','uniform float edgeRotateDisplacementR;','uniform float edgeScaleDisplacementU;','vec3 rotate_vector( vec4 quat, vec3 vec ) {','  return vec + 2.0 * cross( cross( vec, quat.xyz ) + quat.w * vec, quat.xyz );','}','#endif','#if defined( VERTEX_TEXTURES ) && defined( USE_WAVE_TEXTURE )','uniform sampler2D waveNoiseTexture;','uniform float waveBumpScale;','uniform float time;','uniform vec4 waveDrops[RIPPLE_MAX];','#endif','#ifdef USE_MIRROR_TEXTURE','uniform mat4 mirrorTextureMatrix;','varying vec4 mirrorCoord;','#endif','void main() {',THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,'vNormal = normalize( transformedNormal );',THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,'#if defined( VERTEX_TEXTURES ) && ( defined( USE_DISPLACEMENTMAP ) || defined( USE_WAVE_TEXTURE ) )','vec3 displacedPosition;','#endif','#if defined( VERTEX_TEXTURES ) && defined( USE_DISPLACEMENTMAP )','float df = uDisplacementScale * texture2D( tDisplacement, ((uDisplacementCustomUVScale>0.0) ? uDisplacementCustomUVOffset + uv * uDisplacementCustomUVScale : vUv) ).r + uDisplacementBias;','if ((edgeScaleDisplacementU != 1.0) && (uv.y > 0.95)) {','  df *= mix(1.0, edgeScaleDisplacementU, 20.0*(uv.y-0.95));','}','float a_half = 0.0;','if (uv.x < 0.05) {','  a_half = mix(edgeRotateDisplacementL*0.5, 0.0, 20.0*uv.x);','}','else if (uv.x > 0.95) {','  a_half = mix(0.0, edgeRotateDisplacementR*0.5, 20.0*(uv.x-0.95));','}','if (a_half != 0.0) {','  vec4 quat = vec4(0.0, sin(a_half), 0.0, cos(a_half));','  displacedPosition = position + rotate_vector(quat, normalize(normal)) * df;','  vNormal = rotate_vector(quat, vNormal);','}','else {','  displacedPosition = position + normalize( normal ) * df;','}','#endif','#if defined( VERTEX_TEXTURES ) && defined( USE_WAVE_TEXTURE )','vec2 uvTimeShift = vUv + vec2( 1.1, 1.9 ) * time * 0.15;','vec4 bumpData = texture2D( waveNoiseTexture, mod(uvTimeShift,1.0) );','float displacement = (bumpData.g - 0.25) * waveBumpScale;','float drop_count = 0.0;','vec3 normal_total = vec3(0.0, 0.0, 0.0);','for (int i = 0; i < RIPPLE_MAX; i++) {','  if (waveDrops[i].z > 0.0) {','vec4 _position = modelMatrix * vec4( position, 1.0 );','float dist = distance(_position.xz, waveDrops[i].xy) / RIPPLE_RANGE;','float angle = -( ((4.0 / (1.0 + pow(2.0, dist * 50.0 - waveDrops[i].w))) * 3.14159265359)  + 1.5707963267948966192313216916398 );','float wave = (sin(angle)+1.0)*0.5;','float amp = pow(2.0, -dist * 8.0) * waveDrops[i].z;','displacement += wave * amp;','vec2 dir = normalize(_position.xz - waveDrops[i].xy) * (-amp * 256.0 * cos(angle));','drop_count += 1.0;','normal_total += vec3(dir, 1.0);','  }','}','if (drop_count > 0.0) { vNormal = normalMatrix * normalize(normal_total / drop_count); }','#ifdef USE_DISPLACEMENTMAP','  displacedPosition = displacedPosition + normal * displacement;','#else','  displacedPosition = position + normal * displacement;','#endif','#endif',THREE.ShaderChunk.default_vertex,'vViewPosition = -mvPosition.xyz;',THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,'}'].join('\n'),fragmentShader:['uniform vec3 diffuse;','uniform float opacity;','uniform vec3 ambient;','uniform vec3 emissive;','uniform vec3 specular;','uniform float shininess;','#if defined( VERTEX_TEXTURES ) && defined( USE_WAVE_TEXTURE )','uniform float waveBaseSpeed;','uniform sampler2D waveNoiseTexture;','uniform float waveNoiseScale;','uniform float time;','#endif','#ifdef USE_MIRROR_TEXTURE','uniform sampler2D mirrorSampler;','uniform float reflection_alpha;','varying vec4 mirrorCoord;','#endif',THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.AT_depth_render_mode_pars_fragment,'void main() {',THREE.ShaderChunk.AT_depth_render_mode_fragment,'gl_FragColor = vec4( BASE_COLOR, opacity );',THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,'#ifdef USE_MIRROR_TEXTURE','if (reflection_alpha > 0.0) {','vec4 mirror_color = texture2DProj(mirrorSampler, mirrorCoord);','gl_FragColor = vec4(mix(mirror_color.rgb, gl_FragColor.rgb, gl_FragColor.a * (1.0 - mirror_color.a*reflection_alpha)), gl_FragColor.a + ((1.0-gl_FragColor.a) * mirror_color.a*reflection_alpha));','}','#endif',THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,'}'].join('\n')},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:['uniform float size;','uniform float scale;',THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,'void main() {',THREE.ShaderChunk.color_vertex,'vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );','#ifdef USE_SIZEATTENUATION','gl_PointSize = size * ( scale / length( mvPosition.xyz ) );','#else','gl_PointSize = size;','#endif','gl_Position = projectionMatrix * mvPosition;',THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,'}'].join('\n'),fragmentShader:['uniform vec3 psColor;','uniform float opacity;',THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,'void main() {','gl_FragColor = vec4( psColor, opacity );',THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,'}'].join('\n')},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{type:'f',value:1},dashSize:{type:'f',value:1},totalSize:{type:'f',value:2}}]),vertexShader:['uniform float scale;','attribute float lineDistance;','varying float vLineDistance;',THREE.ShaderChunk.color_pars_vertex,'void main() {',THREE.ShaderChunk.color_vertex,'vLineDistance = scale * lineDistance;','vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );','gl_Position = projectionMatrix * mvPosition;','}'].join('\n'),fragmentShader:['uniform vec3 diffuse;','uniform float opacity;','uniform float dashSize;','uniform float totalSize;','varying float vLineDistance;',THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.AT_depth_render_mode_pars_fragment,'void main() {',THREE.ShaderChunk.AT_depth_render_mode_fragment,'if ( mod( vLineDistance, totalSize ) > dashSize ) {','discard;','}','gl_FragColor = vec4( diffuse, opacity );',THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,'}'].join('\n')},depth:{uniforms:{mNear:{type:'f',value:1},mFar:{type:'f',value:2e3},opacity:{type:'f',value:1}},vertexShader:['void main() {','gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );','}'].join('\n'),fragmentShader:['uniform float mNear;','uniform float mFar;','uniform float opacity;',THREE.ShaderChunk.packing,'void main() {','gl_FragColor = packDepthToRGBA( gl_FragCoord.z );','}'].join('\n')},normal:{uniforms:{opacity:{type:'f',value:1}},vertexShader:['varying vec3 vNormal;',THREE.ShaderChunk.morphtarget_pars_vertex,'void main() {','vNormal = normalize( normalMatrix * normal );',THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,'}'].join('\n'),fragmentShader:['uniform float opacity;','varying vec3 vNormal;','void main() {','gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );','}'].join('\n')},normalmap:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:'i',value:0},enableDiffuse:{type:'i',value:0},enableSpecular:{type:'i',value:0},enableReflection:{type:'i',value:0},enableDisplacement:{type:'i',value:0},tDisplacement:{type:'t',value:null},tDiffuse:{type:'t',value:null},tCube:{type:'t',value:null},tNormal:{type:'t',value:null},tSpecular:{type:'t',value:null},tAO:{type:'t',value:null},uNormalScale:{type:'v2',value:new THREE.Vector2(1,1)},uDisplacementBias:{type:'f',value:0},uDisplacementScale:{type:'f',value:1},uDiffuseColor:{type:'c',value:new THREE.Color(16777215)},uSpecularColor:{type:'c',value:new THREE.Color(1118481)},uAmbientColor:{type:'c',value:new THREE.Color(16777215)},uShininess:{type:'f',value:30},uOpacity:{type:'f',value:1},useRefract:{type:'i',value:0},uRefractionRatio:{type:'f',value:0.98},uReflectivity:{type:'f',value:0.5},uOffset:{type:'v2',value:new THREE.Vector2(0,0)},uRepeat:{type:'v2',value:new THREE.Vector2(1,1)},wrapRGB:{type:'v3',value:new THREE.Vector3(1,1,1)}}]),fragmentShader:['uniform vec3 uAmbientColor;','uniform vec3 uDiffuseColor;','uniform vec3 uSpecularColor;','uniform float uShininess;','uniform float uOpacity;','uniform bool enableDiffuse;','uniform bool enableSpecular;','uniform bool enableAO;','uniform bool enableReflection;','uniform sampler2D tDiffuse;','uniform sampler2D tNormal;','uniform sampler2D tSpecular;','uniform sampler2D tAO;','uniform samplerCube tCube;','uniform vec2 uNormalScale;','uniform bool useRefract;','uniform float uRefractionRatio;','uniform float uReflectivity;','varying vec3 vTangent;','varying vec3 vBinormal;','varying vec3 vNormal;','varying vec2 vUv;','uniform vec3 ambientLightColor;','#if MAX_DIR_LIGHTS > 0','uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];','uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];','#endif','#if MAX_HEMI_LIGHTS > 0','uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];','uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];','uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];','#endif','#if MAX_POINT_LIGHTS > 0','uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];','uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];','uniform float pointLightDistance[ MAX_POINT_LIGHTS ];','#endif','#if MAX_SPOT_LIGHTS > 0','uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];','uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];','uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];','uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];','uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];','uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];','#endif','#ifdef WRAP_AROUND','uniform vec3 wrapRGB;','#endif','varying vec3 vWorldPosition;','varying vec3 vViewPosition;',THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,'void main() {','gl_FragColor = vec4( vec3( 1.0 ), uOpacity );','vec3 specularTex = vec3( 1.0 );','vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;','normalTex.xy *= uNormalScale;','normalTex = normalize( normalTex );','if( enableDiffuse ) {','#ifdef GAMMA_INPUT','vec4 texelColor = texture2D( tDiffuse, vUv );','texelColor.xyz *= texelColor.xyz;','gl_FragColor = gl_FragColor * texelColor;','#else','gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );','#endif','}','if( enableAO ) {','#ifdef GAMMA_INPUT','vec4 aoColor = texture2D( tAO, vUv );','aoColor.xyz *= aoColor.xyz;','gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;','#else','gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;','#endif','}','if( enableSpecular )','specularTex = texture2D( tSpecular, vUv ).xyz;','mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );','vec3 finalNormal = tsb * normalTex;','#ifdef FLIP_SIDED','finalNormal = -finalNormal;','#endif','vec3 normal = normalize( finalNormal );','vec3 viewPosition = normalize( vViewPosition );','#if MAX_POINT_LIGHTS > 0','vec3 pointDiffuse = vec3( 0.0 );','vec3 pointSpecular = vec3( 0.0 );','for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {','vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );','vec3 pointVector = lPosition.xyz + vViewPosition.xyz;','float pointDistance = 1.0;','if ( pointLightDistance[ i ] > 0.0 )','pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );','pointVector = normalize( pointVector );','#ifdef WRAP_AROUND','float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );','float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );','vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );','#else','float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );','#endif','pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;','vec3 pointHalfVector = normalize( pointVector + viewPosition );','float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );','float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );','#ifdef PHYSICALLY_BASED_SHADING','float specularNormalization = ( uShininess + 2.0001 ) / 8.0;','vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );','pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;','#else','pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;','#endif','}','#endif','#if MAX_SPOT_LIGHTS > 0','vec3 spotDiffuse = vec3( 0.0 );','vec3 spotSpecular = vec3( 0.0 );','for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {','vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );','vec3 spotVector = lPosition.xyz + vViewPosition.xyz;','float spotDistance = 1.0;','if ( spotLightDistance[ i ] > 0.0 )','spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );','spotVector = normalize( spotVector );','float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );','if ( spotEffect > spotLightAngleCos[ i ] ) {','spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );','#ifdef WRAP_AROUND','float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );','float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );','vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );','#else','float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );','#endif','spotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;','vec3 spotHalfVector = normalize( spotVector + viewPosition );','float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );','float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );','#ifdef PHYSICALLY_BASED_SHADING','float specularNormalization = ( uShininess + 2.0001 ) / 8.0;','vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );','spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;','#else','spotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;','#endif','}','}','#endif','#if MAX_DIR_LIGHTS > 0','vec3 dirDiffuse = vec3( 0.0 );','vec3 dirSpecular = vec3( 0.0 );','for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {','vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );','vec3 dirVector = normalize( lDirection.xyz );','#ifdef WRAP_AROUND','float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );','float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );','vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );','#else','float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );','#endif','dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;','vec3 dirHalfVector = normalize( dirVector + viewPosition );','float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );','float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );','#ifdef PHYSICALLY_BASED_SHADING','float specularNormalization = ( uShininess + 2.0001 ) / 8.0;','vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );','dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;','#else','dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;','#endif','}','#endif','#if MAX_HEMI_LIGHTS > 0','vec3 hemiDiffuse  = vec3( 0.0 );','vec3 hemiSpecular = vec3( 0.0 );','for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {','vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );','vec3 lVector = normalize( lDirection.xyz );','float dotProduct = dot( normal, lVector );','float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;','vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );','hemiDiffuse += uDiffuseColor * hemiColor;','vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );','float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;','float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );','vec3 lVectorGround = -lVector;','vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );','float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;','float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );','#ifdef PHYSICALLY_BASED_SHADING','float dotProductGround = dot( normal, lVectorGround );','float specularNormalization = ( uShininess + 2.0001 ) / 8.0;','vec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );','vec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );','hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );','#else','hemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;','#endif','}','#endif','vec3 totalDiffuse = vec3( 0.0 );','vec3 totalSpecular = vec3( 0.0 );','#if MAX_DIR_LIGHTS > 0','totalDiffuse += dirDiffuse;','totalSpecular += dirSpecular;','#endif','#if MAX_HEMI_LIGHTS > 0','totalDiffuse += hemiDiffuse;','totalSpecular += hemiSpecular;','#endif','#if MAX_POINT_LIGHTS > 0','totalDiffuse += pointDiffuse;','totalSpecular += pointSpecular;','#endif','#if MAX_SPOT_LIGHTS > 0','totalDiffuse += spotDiffuse;','totalSpecular += spotSpecular;','#endif','#ifdef METAL','gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );','#else','gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;','#endif','if ( enableReflection ) {','vec3 vReflect;','vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );','if ( useRefract ) {','vReflect = refract( cameraToVertex, normal, uRefractionRatio );','} else {','vReflect = reflect( cameraToVertex, normal );','}','vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );','#ifdef GAMMA_INPUT','cubeColor.xyz *= cubeColor.xyz;','#endif','gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );','}',THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,'}'].join('\n'),vertexShader:['attribute vec4 tangent;','uniform vec2 uOffset;','uniform vec2 uRepeat;','uniform bool enableDisplacement;','#ifdef VERTEX_TEXTURES','uniform sampler2D tDisplacement;','uniform float uDisplacementScale;','uniform float uDisplacementBias;','#endif','varying vec3 vTangent;','varying vec3 vBinormal;','varying vec3 vNormal;','varying vec2 vUv;','varying vec3 vWorldPosition;','varying vec3 vViewPosition;',THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,'void main() {',THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,'#ifdef USE_SKINNING','vNormal = normalize( normalMatrix * skinnedNormal.xyz );','vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );','vTangent = normalize( normalMatrix * skinnedTangent.xyz );','#else','vNormal = normalize( normalMatrix * normal );','vTangent = normalize( normalMatrix * tangent.xyz );','#endif','vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );','vUv = uv * uRepeat + uOffset;','vec3 displacedPosition;','#ifdef VERTEX_TEXTURES','if ( enableDisplacement ) {','vec3 dv = texture2D( tDisplacement, uv ).xyz;','float df = uDisplacementScale * dv.x + uDisplacementBias;','displacedPosition = position + normalize( normal ) * df;','} else {','#ifdef USE_SKINNING','vec4 skinVertex = vec4( position, 1.0 );','vec4 skinned  = boneMatX * skinVertex * skinWeight.x;','skinned \t  += boneMatY * skinVertex * skinWeight.y;','displacedPosition  = skinned.xyz;','#else','displacedPosition = position;','#endif','}','#else','#ifdef USE_SKINNING','vec4 skinVertex = vec4( position, 1.0 );','vec4 skinned  = boneMatX * skinVertex * skinWeight.x;','skinned \t  += boneMatY * skinVertex * skinWeight.y;','displacedPosition  = skinned.xyz;','#else','displacedPosition = position;','#endif','#endif','vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );','vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );','gl_Position = projectionMatrix * mvPosition;','vWorldPosition = worldPosition.xyz;','vViewPosition = -mvPosition.xyz;','#ifdef USE_SHADOWMAP','for( int i = 0; i < MAX_SHADOWS; i ++ ) {','vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;','}','#endif','}'].join('\n')},cube:{uniforms:{tCube:{type:'t',value:null},tFlip:{type:'f',value:-1}},vertexShader:['varying vec3 vWorldPosition;','void main() {','vec4 worldPosition = modelMatrix * vec4( position, 1.0 );','vWorldPosition = worldPosition.xyz;','gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );','}'].join('\n'),fragmentShader:['uniform samplerCube tCube;','uniform float tFlip;','varying vec3 vWorldPosition;','void main() {','gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );','}'].join('\n')},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,'void main() {',THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,'}'].join('\n'),fragmentShader:[THREE.ShaderChunk.packing,'void main() {','gl_FragColor = packDepthToRGBA( gl_FragCoord.z );','}'].join('\n')}},THREE.WebGLRenderer=function(_){function S(Or){Or.__webglVertexBuffer=rr.createBuffer(),Or.__webglColorBuffer=rr.createBuffer(),xt.info.memory.geometries++}function M(Or){Or.__webglVertexBuffer=rr.createBuffer(),Or.__webglColorBuffer=rr.createBuffer(),Or.__webglLineDistanceBuffer=rr.createBuffer(),xt.info.memory.geometries++}function T(Or){Or.__webglVertexBuffer=rr.createBuffer(),Or.__webglColorBuffer=rr.createBuffer(),Or.__webglNormalBuffer=rr.createBuffer(),xt.info.memory.geometries++}function A(Or){Or.__webglVertexBuffer=rr.createBuffer(),Or.__webglNormalBuffer=rr.createBuffer(),Or.__webglTangentBuffer=rr.createBuffer(),Or.__webglColorBuffer=rr.createBuffer(),Or.__webglUVBuffer=rr.createBuffer(),Or.__webglUV2Buffer=rr.createBuffer(),Or.__webglSkinIndicesBuffer=rr.createBuffer(),Or.__webglSkinWeightsBuffer=rr.createBuffer(),Or.__webglFaceBuffer=rr.createBuffer(),Or.__webglLineBuffer=rr.createBuffer();var Br,kr;if(Or.numMorphTargets)for(Or.__webglMorphTargetsBuffers=[],Br=0,kr=Or.numMorphTargets;Br<kr;Br++)Or.__webglMorphTargetsBuffers.push(rr.createBuffer());if(Or.numMorphNormals)for(Or.__webglMorphNormalsBuffers=[],Br=0,kr=Or.numMorphNormals;Br<kr;Br++)Or.__webglMorphNormalsBuffers.push(rr.createBuffer());xt.info.memory.geometries++}function C(Or){if(Or.__webglCustomAttributesList)for(var Br in Or.__webglCustomAttributesList)rr.deleteBuffer(Or.__webglCustomAttributesList[Br].buffer)}function E(Or,Br){var kr=Or.vertices.length,Gr=Br.material;if(Gr.attributes)for(var Hr in void 0===Or.__webglCustomAttributesList&&(Or.__webglCustomAttributesList=[]),Gr.attributes){var jr=Gr.attributes[Hr];if(!jr.__webglInitialized||jr.createUniqueBuffers){jr.__webglInitialized=!0;var Wr=1;'v2'===jr.type?Wr=2:'v3'===jr.type?Wr=3:'v4'===jr.type?Wr=4:'c'===jr.type&&(Wr=3),jr.size=Wr,jr.array=new Float32Array(kr*Wr),jr.buffer=rr.createBuffer(),jr.buffer.belongsToAttribute=Hr,jr.needsUpdate=!0}Or.__webglCustomAttributesList.push(jr)}}function D(Or,Br){var kr=Or.vertices.length;Or.__vertexArray=new Float32Array(3*kr),Or.__colorArray=new Float32Array(3*kr),Or.__sortArray=[],Or.__webglParticleCount=kr,E(Or,Br)}function P(Or,Br){var kr=Or.vertices.length;Or.__vertexArray=new Float32Array(3*kr),Or.__colorArray=new Float32Array(3*kr),Or.__lineDistanceArray=new Float32Array(1*kr),Or.__webglLineCount=kr,E(Or,Br)}function R(Or,Br){var kr=Or.vertices.length;Or.__vertexArray=new Float32Array(3*kr),Or.__colorArray=new Float32Array(3*kr),Or.__normalArray=new Float32Array(3*kr),Or.__webglVertexCount=kr,E(Or,Br)}function L(Or,Br){var kr=Br.geometry,Gr=Or.faces3,Hr=Or.faces4,jr=3*Gr.length+4*Hr.length,Wr=1*Gr.length+2*Hr.length,Xr=3*Gr.length+4*Hr.length,Yr=N(Br,Or),qr=I(Yr),Kr=F(Yr),Qr=V(Yr);Or.__vertexArray=new Float32Array(3*jr),Kr&&(Or.__normalArray=new Float32Array(3*jr)),kr.hasTangents&&(Or.__tangentArray=new Float32Array(4*jr)),Qr&&(Or.__colorArray=new Float32Array(3*jr)),qr&&((0<kr.faceUvs.length||0<kr.faceVertexUvs.length)&&(Or.__uvArray=new Float32Array(2*jr)),(1<kr.faceUvs.length||1<kr.faceVertexUvs.length)&&(Or.__uv2Array=new Float32Array(2*jr))),Br.geometry.skinWeights.length&&Br.geometry.skinIndices.length&&(Or.__skinIndexArray=new Float32Array(4*jr),Or.__skinWeightArray=new Float32Array(4*jr)),Or.__faceArray=new Uint16Array(3*Wr),Or.__lineArray=new Uint16Array(2*Xr);var Zr,Jr;if(Or.numMorphTargets)for(Or.__morphTargetsArrays=[],Zr=0,Jr=Or.numMorphTargets;Zr<Jr;Zr++)Or.__morphTargetsArrays.push(new Float32Array(3*jr));if(Or.numMorphNormals)for(Or.__morphNormalsArrays=[],Zr=0,Jr=Or.numMorphNormals;Zr<Jr;Zr++)Or.__morphNormalsArrays.push(new Float32Array(3*jr));if(Or.__webglFaceCount=3*Wr,Or.__webglLineCount=2*Xr,Yr.attributes)for(var $r in void 0===Or.__webglCustomAttributesList&&(Or.__webglCustomAttributesList=[]),Yr.attributes){var ta=Yr.attributes[$r],ra={};for(var aa in ta)ra[aa]=ta[aa];if(!ra.__webglInitialized||ra.createUniqueBuffers){ra.__webglInitialized=!0;var oa=1;'v2'===ra.type?oa=2:'v3'===ra.type?oa=3:'v4'===ra.type?oa=4:'c'===ra.type&&(oa=3),ra.size=oa,ra.array=new Float32Array(jr*oa),ra.buffer=rr.createBuffer(),ra.buffer.belongsToAttribute=$r,ta.needsUpdate=!0,ra.__original=ta}Or.__webglCustomAttributesList.push(ra)}Or.__inittedArrays=!0}function N(Or,Br){return Or.material instanceof THREE.MeshFaceMaterial?Or.material.materials[Br.materialIndex]:Or.material}function U(Or){return Or&&Or.shading!==void 0&&Or.shading===THREE.SmoothShading}function F(Or){return Or instanceof THREE.MeshBasicMaterial&&!Or.envMap||Or instanceof THREE.MeshDepthMaterial?!1:U(Or)?THREE.SmoothShading:THREE.FlatShading}function V(Or){return!!Or.vertexColors&&Or.vertexColors}function I(Or){return Or.map||Or.lightMap||Or.bumpMap||Or.displacementMap||Or.waveNoiseTexture||Or.normalMap||Or.specularMap||Or instanceof THREE.ShaderMaterial}function O(Or){var Br,kr,Gr;for(Br in Or.attributes)Gr='index'===Br?rr.ELEMENT_ARRAY_BUFFER:rr.ARRAY_BUFFER,kr=Or.attributes[Br],kr.buffer=rr.createBuffer(),rr.bindBuffer(Gr,kr.buffer),rr.bufferData(Gr,kr.array,rr.STATIC_DRAW)}function B(Or,Br,kr){var qr=Or.vertices,Kr=qr.length,Qr=Or.colors,Zr=Qr.length,Jr=Or.__vertexArray,$r=Or.__colorArray,ta=Or.__sortArray,ra=Or.verticesNeedUpdate,aa=Or.elementsNeedUpdate,oa=Or.colorsNeedUpdate,ia=Or.__webglCustomAttributesList,Gr,Hr,jr,Wr,Xr,Yr,sa,la,ma,fa,ha,ga;if(kr.sortParticles){for(Qt.copy(Kt),Qt.multiply(kr.matrixWorld),Gr=0;Gr<Kr;Gr++)jr=qr[Gr],Zt.copy(jr),Zt.applyProjection(Qt),ta[Gr]=[Zt.z,Gr];for(ta.sort(J),Gr=0;Gr<Kr;Gr++)jr=qr[ta[Gr][1]],Wr=3*Gr,Jr[Wr]=jr.x,Jr[Wr+1]=jr.y,Jr[Wr+2]=jr.z;for(Hr=0;Hr<Zr;Hr++)Wr=3*Hr,Yr=Qr[ta[Hr][1]],$r[Wr]=Yr.r,$r[Wr+1]=Yr.g,$r[Wr+2]=Yr.b;if(ia)for(sa=0,la=ia.length;sa<la;sa++)if(ga=ia[sa],void 0===ga.boundTo||'vertices'===ga.boundTo)if(Wr=0,fa=ga.value.length,1===ga.size)for(ma=0;ma<fa;ma++)Xr=ta[ma][1],ga.array[ma]=ga.value[Xr];else if(2===ga.size)for(ma=0;ma<fa;ma++)Xr=ta[ma][1],ha=ga.value[Xr],ga.array[Wr]=ha.x,ga.array[Wr+1]=ha.y,Wr+=2;else if(3===ga.size){if('c'===ga.type)for(ma=0;ma<fa;ma++)Xr=ta[ma][1],ha=ga.value[Xr],ga.array[Wr]=ha.r,ga.array[Wr+1]=ha.g,ga.array[Wr+2]=ha.b,Wr+=3;else for(ma=0;ma<fa;ma++)Xr=ta[ma][1],ha=ga.value[Xr],ga.array[Wr]=ha.x,ga.array[Wr+1]=ha.y,ga.array[Wr+2]=ha.z,Wr+=3;}else if(4===ga.size)for(ma=0;ma<fa;ma++)Xr=ta[ma][1],ha=ga.value[Xr],ga.array[Wr]=ha.x,ga.array[Wr+1]=ha.y,ga.array[Wr+2]=ha.z,ga.array[Wr+3]=ha.w,Wr+=4}else{if(ra)for(Gr=0;Gr<Kr;Gr++)jr=qr[Gr],Wr=3*Gr,Jr[Wr]=jr.x,Jr[Wr+1]=jr.y,Jr[Wr+2]=jr.z;if(oa)for(Hr=0;Hr<Zr;Hr++)Yr=Qr[Hr],Wr=3*Hr,$r[Wr]=Yr.r,$r[Wr+1]=Yr.g,$r[Wr+2]=Yr.b;if(ia)for(sa=0,la=ia.length;sa<la;sa++)if(ga=ia[sa],ga.needsUpdate&&(void 0===ga.boundTo||'vertices'===ga.boundTo))if(fa=ga.value.length,Wr=0,1===ga.size)for(ma=0;ma<fa;ma++)ga.array[ma]=ga.value[ma];else if(2===ga.size)for(ma=0;ma<fa;ma++)ha=ga.value[ma],ga.array[Wr]=ha.x,ga.array[Wr+1]=ha.y,Wr+=2;else if(3===ga.size){if('c'===ga.type)for(ma=0;ma<fa;ma++)ha=ga.value[ma],ga.array[Wr]=ha.r,ga.array[Wr+1]=ha.g,ga.array[Wr+2]=ha.b,Wr+=3;else for(ma=0;ma<fa;ma++)ha=ga.value[ma],ga.array[Wr]=ha.x,ga.array[Wr+1]=ha.y,ga.array[Wr+2]=ha.z,Wr+=3;}else if(4===ga.size)for(ma=0;ma<fa;ma++)ha=ga.value[ma],ga.array[Wr]=ha.x,ga.array[Wr+1]=ha.y,ga.array[Wr+2]=ha.z,ga.array[Wr+3]=ha.w,Wr+=4}if((ra||kr.sortParticles)&&(rr.bindBuffer(rr.ARRAY_BUFFER,Or.__webglVertexBuffer),rr.bufferData(rr.ARRAY_BUFFER,Jr,Br)),(oa||kr.sortParticles)&&(rr.bindBuffer(rr.ARRAY_BUFFER,Or.__webglColorBuffer),rr.bufferData(rr.ARRAY_BUFFER,$r,Br)),ia)for(sa=0,la=ia.length;sa<la;sa++)ga=ia[sa],(ga.needsUpdate||kr.sortParticles)&&(rr.bindBuffer(rr.ARRAY_BUFFER,ga.buffer),rr.bufferData(rr.ARRAY_BUFFER,ga.array,Br))}function G(Or,Br){var Yr=Or.vertices,qr=Or.colors,Kr=Or.lineDistances,Qr=Yr.length,Zr=qr.length,Jr=Kr.length,$r=Or.__vertexArray,ta=Or.__colorArray,ra=Or.__lineDistanceArray,aa=Or.verticesNeedUpdate,oa=Or.colorsNeedUpdate,ia=Or.lineDistancesNeedUpdate,sa=Or.__webglCustomAttributesList,kr,Gr,Hr,jr,Wr,Xr,la,da,fa,ha,ga,ya;if(aa){for(kr=0;kr<Qr;kr++)jr=Yr[kr],Wr=3*kr,$r[Wr]=jr.x,$r[Wr+1]=jr.y,$r[Wr+2]=jr.z;rr.bindBuffer(rr.ARRAY_BUFFER,Or.__webglVertexBuffer),rr.bufferData(rr.ARRAY_BUFFER,$r,Br)}if(oa){for(Gr=0;Gr<Zr;Gr++)Xr=qr[Gr],Wr=3*Gr,ta[Wr]=Xr.r,ta[Wr+1]=Xr.g,ta[Wr+2]=Xr.b;rr.bindBuffer(rr.ARRAY_BUFFER,Or.__webglColorBuffer),rr.bufferData(rr.ARRAY_BUFFER,ta,Br)}if(ia){for(Hr=0;Hr<Jr;Hr++)ra[Hr]=Kr[Hr];rr.bindBuffer(rr.ARRAY_BUFFER,Or.__webglLineDistanceBuffer),rr.bufferData(rr.ARRAY_BUFFER,ra,Br)}if(sa)for(la=0,da=sa.length;la<da;la++)if(ya=sa[la],ya.needsUpdate&&(void 0===ya.boundTo||'vertices'===ya.boundTo)){if(Wr=0,ha=ya.value.length,1===ya.size)for(fa=0;fa<ha;fa++)ya.array[fa]=ya.value[fa];else if(2===ya.size)for(fa=0;fa<ha;fa++)ga=ya.value[fa],ya.array[Wr]=ga.x,ya.array[Wr+1]=ga.y,Wr+=2;else if(3===ya.size){if('c'===ya.type)for(fa=0;fa<ha;fa++)ga=ya.value[fa],ya.array[Wr]=ga.r,ya.array[Wr+1]=ga.g,ya.array[Wr+2]=ga.b,Wr+=3;else for(fa=0;fa<ha;fa++)ga=ya.value[fa],ya.array[Wr]=ga.x,ya.array[Wr+1]=ga.y,ya.array[Wr+2]=ga.z,Wr+=3;}else if(4===ya.size)for(fa=0;fa<ha;fa++)ga=ya.value[fa],ya.array[Wr]=ga.x,ya.array[Wr+1]=ga.y,ya.array[Wr+2]=ga.z,ya.array[Wr+3]=ga.w,Wr+=4;rr.bindBuffer(rr.ARRAY_BUFFER,ya.buffer),rr.bufferData(rr.ARRAY_BUFFER,ya.array,Br)}}function H(Or,Br){var ta=Or.vertices,ra=Or.colors,aa=Or.normals,oa=ta.length,ia=ra.length,sa=aa.length,la=Or.__vertexArray,da=Or.__colorArray,ma=Or.__normalArray,fa=Or.verticesNeedUpdate,ha=Or.colorsNeedUpdate,ga=Or.normalsNeedUpdate,ya=Or.__webglCustomAttributesList,kr,Gr,Hr,jr,Wr,Xr,Yr,qr,Kr,Qr,Zr,Jr,$r;if(fa){for(kr=0;kr<oa;kr++)jr=ta[kr],Wr=3*kr,la[Wr]=jr.x,la[Wr+1]=jr.y,la[Wr+2]=jr.z;rr.bindBuffer(rr.ARRAY_BUFFER,Or.__webglVertexBuffer),rr.bufferData(rr.ARRAY_BUFFER,la,Br)}if(ha){for(Gr=0;Gr<ia;Gr++)Xr=ra[Gr],Wr=3*Gr,da[Wr]=Xr.r,da[Wr+1]=Xr.g,da[Wr+2]=Xr.b;rr.bindBuffer(rr.ARRAY_BUFFER,Or.__webglColorBuffer),rr.bufferData(rr.ARRAY_BUFFER,da,Br)}if(ga){for(Hr=0;Hr<sa;Hr++)Yr=aa[Hr],Wr=3*Hr,ma[Wr]=Yr.x,ma[Wr+1]=Yr.y,ma[Wr+2]=Yr.z;rr.bindBuffer(rr.ARRAY_BUFFER,Or.__webglNormalBuffer),rr.bufferData(rr.ARRAY_BUFFER,ma,Br)}if(ya)for(qr=0,Kr=ya.length;qr<Kr;qr++)if(Jr=ya[qr],Jr.needsUpdate&&(void 0===Jr.boundTo||'vertices'===Jr.boundTo)){if(Wr=0,Zr=Jr.value.length,1===Jr.size)for(Qr=0;Qr<Zr;Qr++)Jr.array[Qr]=Jr.value[Qr];else if(2===Jr.size)for(Qr=0;Qr<Zr;Qr++)$r=Jr.value[Qr],Jr.array[Wr]=$r.x,Jr.array[Wr+1]=$r.y,Wr+=2;else if(3===Jr.size){if('c'===Jr.type)for(Qr=0;Qr<Zr;Qr++)$r=Jr.value[Qr],Jr.array[Wr]=$r.r,Jr.array[Wr+1]=$r.g,Jr.array[Wr+2]=$r.b,Wr+=3;else for(Qr=0;Qr<Zr;Qr++)$r=Jr.value[Qr],Jr.array[Wr]=$r.x,Jr.array[Wr+1]=$r.y,Jr.array[Wr+2]=$r.z,Wr+=3;}else if(4===Jr.size)for(Qr=0;Qr<Zr;Qr++)$r=Jr.value[Qr],Jr.array[Wr]=$r.x,Jr.array[Wr+1]=$r.y,Jr.array[Wr+2]=$r.z,Jr.array[Wr+3]=$r.w,Wr+=4;rr.bindBuffer(rr.ARRAY_BUFFER,Jr.buffer),rr.bufferData(rr.ARRAY_BUFFER,Jr.array,Br)}}function W(Or,Br,kr,Gr,Hr){if(Or.__inittedArrays){var jr=F(Hr),Wr=V(Hr),Xr=I(Hr),Yr=jr===THREE.SmoothShading,no=0,so=0,lo=0,co=0,po=0,mo=0,uo=0,fo=0,ho=0,go=0,yo=0,xo=0,_o=0,bo=Or.__vertexArray,So=Or.__uvArray,Mo=Or.__uv2Array,To=Or.__normalArray,Ao=Or.__tangentArray,wo=Or.__colorArray,Co=Or.__skinIndexArray,Eo=Or.__skinWeightArray,Do=Or.__morphTargetsArrays,Po=Or.__morphNormalsArrays,Ro=Or.__webglCustomAttributesList,No=Or.__faceArray,Uo=Or.__lineArray,Fo=Br.geometry,zo=Fo.verticesNeedUpdate,Vo=Fo.elementsNeedUpdate,Io=Fo.uvsNeedUpdate,Oo=Fo.normalsNeedUpdate,Bo=Fo.tangentsNeedUpdate,ko=Fo.colorsNeedUpdate,Go=Fo.morphTargetsNeedUpdate,Ho=Fo.vertices,jo=Or.faces3,Wo=Or.faces4,Xo=Fo.faces,Yo=Fo.faceVertexUvs[0],qo=Fo.faceVertexUvs[1],Ko=Fo.colors,Qo=Fo.skinIndices,Zo=Fo.skinWeights,Jo=Fo.morphTargets,$o=Fo.morphNormals,qr,Kr,Qr,Zr,Jr,$r,ra,aa,oa,ia,sa,la,da,ma,fa,ha,ga,ya,xa,_a,ba,Sa,Ma,Ta,Aa,wa,Ca,Ea,Da,Pa,Ra,La,Na,Ua,Fa,Xa,Ya,Ka,Qa,Za,Ja,$a,eo,ro,ao,oo,vo,Lo;if(zo){for(qr=0,Kr=jo.length;qr<Kr;qr++)Zr=Xo[jo[qr]],la=Ho[Zr.a],da=Ho[Zr.b],ma=Ho[Zr.c],bo[so]=la.x,bo[so+1]=la.y,bo[so+2]=la.z,bo[so+3]=da.x,bo[so+4]=da.y,bo[so+5]=da.z,bo[so+6]=ma.x,bo[so+7]=ma.y,bo[so+8]=ma.z,so+=9;for(qr=0,Kr=Wo.length;qr<Kr;qr++)Zr=Xo[Wo[qr]],la=Ho[Zr.a],da=Ho[Zr.b],ma=Ho[Zr.c],fa=Ho[Zr.d],bo[so]=la.x,bo[so+1]=la.y,bo[so+2]=la.z,bo[so+3]=da.x,bo[so+4]=da.y,bo[so+5]=da.z,bo[so+6]=ma.x,bo[so+7]=ma.y,bo[so+8]=ma.z,bo[so+9]=fa.x,bo[so+10]=fa.y,bo[so+11]=fa.z,so+=12;rr.bindBuffer(rr.ARRAY_BUFFER,Or.__webglVertexBuffer),rr.bufferData(rr.ARRAY_BUFFER,bo,kr)}if(Go)for(Ja=0,$a=Jo.length;Ja<$a;Ja++){for(yo=0,qr=0,Kr=jo.length;qr<Kr;qr++)(ao=jo[qr],Zr=Xo[ao],la=Jo[Ja].vertices[Zr.a],da=Jo[Ja].vertices[Zr.b],ma=Jo[Ja].vertices[Zr.c],eo=Do[Ja],!!eo)&&(eo[yo]=la.x,eo[yo+1]=la.y,eo[yo+2]=la.z,eo[yo+3]=da.x,eo[yo+4]=da.y,eo[yo+5]=da.z,eo[yo+6]=ma.x,eo[yo+7]=ma.y,eo[yo+8]=ma.z,Hr.morphNormals&&(Yr?(oo=$o[Ja].vertexNormals[ao],_a=oo.a,ba=oo.b,Sa=oo.c):(_a=$o[Ja].faceNormals[ao],ba=_a,Sa=_a),ro=Po[Ja],ro[yo]=_a.x,ro[yo+1]=_a.y,ro[yo+2]=_a.z,ro[yo+3]=ba.x,ro[yo+4]=ba.y,ro[yo+5]=ba.z,ro[yo+6]=Sa.x,ro[yo+7]=Sa.y,ro[yo+8]=Sa.z),yo+=9);for(qr=0,Kr=Wo.length;qr<Kr;qr++)ao=Wo[qr],Zr=Xo[ao],la=Jo[Ja].vertices[Zr.a],da=Jo[Ja].vertices[Zr.b],ma=Jo[Ja].vertices[Zr.c],fa=Jo[Ja].vertices[Zr.d],eo=Do[Ja],eo[yo]=la.x,eo[yo+1]=la.y,eo[yo+2]=la.z,eo[yo+3]=da.x,eo[yo+4]=da.y,eo[yo+5]=da.z,eo[yo+6]=ma.x,eo[yo+7]=ma.y,eo[yo+8]=ma.z,eo[yo+9]=fa.x,eo[yo+10]=fa.y,eo[yo+11]=fa.z,Hr.morphNormals&&(Yr?(oo=$o[Ja].vertexNormals[ao],_a=oo.a,ba=oo.b,Sa=oo.c,Ma=oo.d):(_a=$o[Ja].faceNormals[ao],ba=_a,Sa=_a,Ma=_a),ro=Po[Ja],ro[yo]=_a.x,ro[yo+1]=_a.y,ro[yo+2]=_a.z,ro[yo+3]=ba.x,ro[yo+4]=ba.y,ro[yo+5]=ba.z,ro[yo+6]=Sa.x,ro[yo+7]=Sa.y,ro[yo+8]=Sa.z,ro[yo+9]=Ma.x,ro[yo+10]=Ma.y,ro[yo+11]=Ma.z),yo+=12;rr.bindBuffer(rr.ARRAY_BUFFER,Or.__webglMorphTargetsBuffers[Ja]),rr.bufferData(rr.ARRAY_BUFFER,Do[Ja],kr),Hr.morphNormals&&(rr.bindBuffer(rr.ARRAY_BUFFER,Or.__webglMorphNormalsBuffers[Ja]),rr.bufferData(rr.ARRAY_BUFFER,Po[Ja],kr))}if(Zo.length){for(qr=0,Kr=jo.length;qr<Kr;qr++)Zr=Xo[jo[qr]],Ea=Zo[Zr.a],Da=Zo[Zr.b],Pa=Zo[Zr.c],Eo[go]=Ea.x,Eo[go+1]=Ea.y,Eo[go+2]=Ea.z,Eo[go+3]=Ea.w,Eo[go+4]=Da.x,Eo[go+5]=Da.y,Eo[go+6]=Da.z,Eo[go+7]=Da.w,Eo[go+8]=Pa.x,Eo[go+9]=Pa.y,Eo[go+10]=Pa.z,Eo[go+11]=Pa.w,La=Qo[Zr.a],Na=Qo[Zr.b],Ua=Qo[Zr.c],Co[go]=La.x,Co[go+1]=La.y,Co[go+2]=La.z,Co[go+3]=La.w,Co[go+4]=Na.x,Co[go+5]=Na.y,Co[go+6]=Na.z,Co[go+7]=Na.w,Co[go+8]=Ua.x,Co[go+9]=Ua.y,Co[go+10]=Ua.z,Co[go+11]=Ua.w,go+=12;for(qr=0,Kr=Wo.length;qr<Kr;qr++)Zr=Xo[Wo[qr]],Ea=Zo[Zr.a],Da=Zo[Zr.b],Pa=Zo[Zr.c],Ra=Zo[Zr.d],Eo[go]=Ea.x,Eo[go+1]=Ea.y,Eo[go+2]=Ea.z,Eo[go+3]=Ea.w,Eo[go+4]=Da.x,Eo[go+5]=Da.y,Eo[go+6]=Da.z,Eo[go+7]=Da.w,Eo[go+8]=Pa.x,Eo[go+9]=Pa.y,Eo[go+10]=Pa.z,Eo[go+11]=Pa.w,Eo[go+12]=Ra.x,Eo[go+13]=Ra.y,Eo[go+14]=Ra.z,Eo[go+15]=Ra.w,La=Qo[Zr.a],Na=Qo[Zr.b],Ua=Qo[Zr.c],Fa=Qo[Zr.d],Co[go]=La.x,Co[go+1]=La.y,Co[go+2]=La.z,Co[go+3]=La.w,Co[go+4]=Na.x,Co[go+5]=Na.y,Co[go+6]=Na.z,Co[go+7]=Na.w,Co[go+8]=Ua.x,Co[go+9]=Ua.y,Co[go+10]=Ua.z,Co[go+11]=Ua.w,Co[go+12]=Fa.x,Co[go+13]=Fa.y,Co[go+14]=Fa.z,Co[go+15]=Fa.w,go+=16;0<go&&(rr.bindBuffer(rr.ARRAY_BUFFER,Or.__webglSkinIndicesBuffer),rr.bufferData(rr.ARRAY_BUFFER,Co,kr),rr.bindBuffer(rr.ARRAY_BUFFER,Or.__webglSkinWeightsBuffer),rr.bufferData(rr.ARRAY_BUFFER,Eo,kr))}if(ko&&Wr){for(qr=0,Kr=jo.length;qr<Kr;qr++)Zr=Xo[jo[qr]],ra=Zr.vertexColors,aa=Zr.color,3===ra.length&&Wr===THREE.VertexColors?(Ta=ra[0],Aa=ra[1],wa=ra[2]):(Ta=aa,Aa=aa,wa=aa),wo[ho]=Ta.r,wo[ho+1]=Ta.g,wo[ho+2]=Ta.b,wo[ho+3]=Aa.r,wo[ho+4]=Aa.g,wo[ho+5]=Aa.b,wo[ho+6]=wa.r,wo[ho+7]=wa.g,wo[ho+8]=wa.b,ho+=9;for(qr=0,Kr=Wo.length;qr<Kr;qr++)Zr=Xo[Wo[qr]],ra=Zr.vertexColors,aa=Zr.color,4===ra.length&&Wr===THREE.VertexColors?(Ta=ra[0],Aa=ra[1],wa=ra[2],Ca=ra[3]):(Ta=aa,Aa=aa,wa=aa,Ca=aa),wo[ho]=Ta.r,wo[ho+1]=Ta.g,wo[ho+2]=Ta.b,wo[ho+3]=Aa.r,wo[ho+4]=Aa.g,wo[ho+5]=Aa.b,wo[ho+6]=wa.r,wo[ho+7]=wa.g,wo[ho+8]=wa.b,wo[ho+9]=Ca.r,wo[ho+10]=Ca.g,wo[ho+11]=Ca.b,ho+=12;0<ho&&(rr.bindBuffer(rr.ARRAY_BUFFER,Or.__webglColorBuffer),rr.bufferData(rr.ARRAY_BUFFER,wo,kr))}if(Bo&&Fo.hasTangents){for(qr=0,Kr=jo.length;qr<Kr;qr++)Zr=Xo[jo[qr]],oa=Zr.vertexTangents,ha=oa[0],ga=oa[1],ya=oa[2],Ao[uo]=ha.x,Ao[uo+1]=ha.y,Ao[uo+2]=ha.z,Ao[uo+3]=ha.w,Ao[uo+4]=ga.x,Ao[uo+5]=ga.y,Ao[uo+6]=ga.z,Ao[uo+7]=ga.w,Ao[uo+8]=ya.x,Ao[uo+9]=ya.y,Ao[uo+10]=ya.z,Ao[uo+11]=ya.w,uo+=12;for(qr=0,Kr=Wo.length;qr<Kr;qr++)Zr=Xo[Wo[qr]],oa=Zr.vertexTangents,ha=oa[0],ga=oa[1],ya=oa[2],xa=oa[3],Ao[uo]=ha.x,Ao[uo+1]=ha.y,Ao[uo+2]=ha.z,Ao[uo+3]=ha.w,Ao[uo+4]=ga.x,Ao[uo+5]=ga.y,Ao[uo+6]=ga.z,Ao[uo+7]=ga.w,Ao[uo+8]=ya.x,Ao[uo+9]=ya.y,Ao[uo+10]=ya.z,Ao[uo+11]=ya.w,Ao[uo+12]=xa.x,Ao[uo+13]=xa.y,Ao[uo+14]=xa.z,Ao[uo+15]=xa.w,uo+=16;rr.bindBuffer(rr.ARRAY_BUFFER,Or.__webglTangentBuffer),rr.bufferData(rr.ARRAY_BUFFER,Ao,kr)}if(Oo&&jr){for(qr=0,Kr=jo.length;qr<Kr;qr++)if(Zr=Xo[jo[qr]],Jr=Zr.vertexNormals,$r=Zr.normal,3===Jr.length&&Yr)for(Xa=0;3>Xa;Xa++)Ka=Jr[Xa],To[mo]=Ka.x,To[mo+1]=Ka.y,To[mo+2]=Ka.z,mo+=3;else for(Xa=0;3>Xa;Xa++)To[mo]=$r.x,To[mo+1]=$r.y,To[mo+2]=$r.z,mo+=3;for(qr=0,Kr=Wo.length;qr<Kr;qr++)if(Zr=Xo[Wo[qr]],Jr=Zr.vertexNormals,$r=Zr.normal,4===Jr.length&&Yr)for(Xa=0;4>Xa;Xa++)Ka=Jr[Xa],To[mo]=Ka.x,To[mo+1]=Ka.y,To[mo+2]=Ka.z,mo+=3;else for(Xa=0;4>Xa;Xa++)To[mo]=$r.x,To[mo+1]=$r.y,To[mo+2]=$r.z,mo+=3;rr.bindBuffer(rr.ARRAY_BUFFER,Or.__webglNormalBuffer),rr.bufferData(rr.ARRAY_BUFFER,To,kr)}if(Io&&Yo&&Xr){for(qr=0,Kr=jo.length;qr<Kr;qr++)if(Qr=jo[qr],ia=Yo[Qr],void 0!=ia)for(Xa=0;3>Xa;Xa++)Qa=ia[Xa],So[lo]=Qa.x,So[lo+1]=Qa.y,lo+=2;for(qr=0,Kr=Wo.length;qr<Kr;qr++)if(Qr=Wo[qr],ia=Yo[Qr],void 0!==ia)for(Xa=0;4>Xa;Xa++)Qa=ia[Xa],So[lo]=Qa.x,So[lo+1]=Qa.y,lo+=2;0<lo&&(rr.bindBuffer(rr.ARRAY_BUFFER,Or.__webglUVBuffer),rr.bufferData(rr.ARRAY_BUFFER,So,kr))}if(Io&&qo&&Xr){for(qr=0,Kr=jo.length;qr<Kr;qr++)if(Qr=jo[qr],sa=qo[Qr],void 0!=sa)for(Xa=0;3>Xa;Xa++)Za=sa[Xa],Mo[co]=Za.x,Mo[co+1]=Za.y,co+=2;for(qr=0,Kr=Wo.length;qr<Kr;qr++)if(Qr=Wo[qr],sa=qo[Qr],void 0!==sa)for(Xa=0;4>Xa;Xa++)Za=sa[Xa],Mo[co]=Za.x,Mo[co+1]=Za.y,co+=2;0<co&&(rr.bindBuffer(rr.ARRAY_BUFFER,Or.__webglUV2Buffer),rr.bufferData(rr.ARRAY_BUFFER,Mo,kr))}if(Vo){for(qr=0,Kr=jo.length;qr<Kr;qr++)No[po]=no,No[po+1]=no+1,No[po+2]=no+2,po+=3,Uo[fo]=no,Uo[fo+1]=no+1,Uo[fo+2]=no,Uo[fo+3]=no+2,Uo[fo+4]=no+1,Uo[fo+5]=no+2,fo+=6,no+=3;for(qr=0,Kr=Wo.length;qr<Kr;qr++)No[po]=no,No[po+1]=no+1,No[po+2]=no+3,No[po+3]=no+1,No[po+4]=no+2,No[po+5]=no+3,po+=6,Uo[fo]=no,Uo[fo+1]=no+1,Uo[fo+2]=no,Uo[fo+3]=no+3,Uo[fo+4]=no+1,Uo[fo+5]=no+2,Uo[fo+6]=no+2,Uo[fo+7]=no+3,fo+=8,no+=4;rr.bindBuffer(rr.ELEMENT_ARRAY_BUFFER,Or.__webglFaceBuffer),rr.bufferData(rr.ELEMENT_ARRAY_BUFFER,No,kr),rr.bindBuffer(rr.ELEMENT_ARRAY_BUFFER,Or.__webglLineBuffer),rr.bufferData(rr.ELEMENT_ARRAY_BUFFER,Uo,kr)}if(Ro)for(Xa=0,Ya=Ro.length;Xa<Ya;Xa++)if(Lo=Ro[Xa],Lo.__original.needsUpdate){if(xo=0,_o=0,1===Lo.size){if(void 0===Lo.boundTo||'vertices'===Lo.boundTo){for(qr=0,Kr=jo.length;qr<Kr;qr++)Zr=Xo[jo[qr]],Lo.array[xo]=Lo.value[Zr.a],Lo.array[xo+1]=Lo.value[Zr.b],Lo.array[xo+2]=Lo.value[Zr.c],xo+=3;for(qr=0,Kr=Wo.length;qr<Kr;qr++)Zr=Xo[Wo[qr]],Lo.array[xo]=Lo.value[Zr.a],Lo.array[xo+1]=Lo.value[Zr.b],Lo.array[xo+2]=Lo.value[Zr.c],Lo.array[xo+3]=Lo.value[Zr.d],xo+=4}else if('faces'===Lo.boundTo){for(qr=0,Kr=jo.length;qr<Kr;qr++)vo=Lo.value[jo[qr]],Lo.array[xo]=vo,Lo.array[xo+1]=vo,Lo.array[xo+2]=vo,xo+=3;for(qr=0,Kr=Wo.length;qr<Kr;qr++)vo=Lo.value[Wo[qr]],Lo.array[xo]=vo,Lo.array[xo+1]=vo,Lo.array[xo+2]=vo,Lo.array[xo+3]=vo,xo+=4}}else if(2===Lo.size){if(void 0===Lo.boundTo||'vertices'===Lo.boundTo){for(qr=0,Kr=jo.length;qr<Kr;qr++)Zr=Xo[jo[qr]],la=Lo.value[Zr.a],da=Lo.value[Zr.b],ma=Lo.value[Zr.c],Lo.array[xo]=la.x,Lo.array[xo+1]=la.y,Lo.array[xo+2]=da.x,Lo.array[xo+3]=da.y,Lo.array[xo+4]=ma.x,Lo.array[xo+5]=ma.y,xo+=6;for(qr=0,Kr=Wo.length;qr<Kr;qr++)Zr=Xo[Wo[qr]],la=Lo.value[Zr.a],da=Lo.value[Zr.b],ma=Lo.value[Zr.c],fa=Lo.value[Zr.d],Lo.array[xo]=la.x,Lo.array[xo+1]=la.y,Lo.array[xo+2]=da.x,Lo.array[xo+3]=da.y,Lo.array[xo+4]=ma.x,Lo.array[xo+5]=ma.y,Lo.array[xo+6]=fa.x,Lo.array[xo+7]=fa.y,xo+=8}else if('faces'===Lo.boundTo){for(qr=0,Kr=jo.length;qr<Kr;qr++)vo=Lo.value[jo[qr]],la=vo,da=vo,ma=vo,Lo.array[xo]=la.x,Lo.array[xo+1]=la.y,Lo.array[xo+2]=da.x,Lo.array[xo+3]=da.y,Lo.array[xo+4]=ma.x,Lo.array[xo+5]=ma.y,xo+=6;for(qr=0,Kr=Wo.length;qr<Kr;qr++)vo=Lo.value[Wo[qr]],la=vo,da=vo,ma=vo,fa=vo,Lo.array[xo]=la.x,Lo.array[xo+1]=la.y,Lo.array[xo+2]=da.x,Lo.array[xo+3]=da.y,Lo.array[xo+4]=ma.x,Lo.array[xo+5]=ma.y,Lo.array[xo+6]=fa.x,Lo.array[xo+7]=fa.y,xo+=8}}else if(3===Lo.size){var ei;if(ei='c'===Lo.type?['r','g','b']:['x','y','z'],void 0===Lo.boundTo||'vertices'===Lo.boundTo){for(qr=0,Kr=jo.length;qr<Kr;qr++)Zr=Xo[jo[qr]],la=Lo.value[Zr.a],da=Lo.value[Zr.b],ma=Lo.value[Zr.c],Lo.array[xo]=la[ei[0]],Lo.array[xo+1]=la[ei[1]],Lo.array[xo+2]=la[ei[2]],Lo.array[xo+3]=da[ei[0]],Lo.array[xo+4]=da[ei[1]],Lo.array[xo+5]=da[ei[2]],Lo.array[xo+6]=ma[ei[0]],Lo.array[xo+7]=ma[ei[1]],Lo.array[xo+8]=ma[ei[2]],xo+=9;for(qr=0,Kr=Wo.length;qr<Kr;qr++)Zr=Xo[Wo[qr]],la=Lo.value[Zr.a],da=Lo.value[Zr.b],ma=Lo.value[Zr.c],fa=Lo.value[Zr.d],Lo.array[xo]=la[ei[0]],Lo.array[xo+1]=la[ei[1]],Lo.array[xo+2]=la[ei[2]],Lo.array[xo+3]=da[ei[0]],Lo.array[xo+4]=da[ei[1]],Lo.array[xo+5]=da[ei[2]],Lo.array[xo+6]=ma[ei[0]],Lo.array[xo+7]=ma[ei[1]],Lo.array[xo+8]=ma[ei[2]],Lo.array[xo+9]=fa[ei[0]],Lo.array[xo+10]=fa[ei[1]],Lo.array[xo+11]=fa[ei[2]],xo+=12}else if('faces'===Lo.boundTo){for(qr=0,Kr=jo.length;qr<Kr;qr++)vo=Lo.value[jo[qr]],la=vo,da=vo,ma=vo,Lo.array[xo]=la[ei[0]],Lo.array[xo+1]=la[ei[1]],Lo.array[xo+2]=la[ei[2]],Lo.array[xo+3]=da[ei[0]],Lo.array[xo+4]=da[ei[1]],Lo.array[xo+5]=da[ei[2]],Lo.array[xo+6]=ma[ei[0]],Lo.array[xo+7]=ma[ei[1]],Lo.array[xo+8]=ma[ei[2]],xo+=9;for(qr=0,Kr=Wo.length;qr<Kr;qr++)vo=Lo.value[Wo[qr]],la=vo,da=vo,ma=vo,fa=vo,Lo.array[xo]=la[ei[0]],Lo.array[xo+1]=la[ei[1]],Lo.array[xo+2]=la[ei[2]],Lo.array[xo+3]=da[ei[0]],Lo.array[xo+4]=da[ei[1]],Lo.array[xo+5]=da[ei[2]],Lo.array[xo+6]=ma[ei[0]],Lo.array[xo+7]=ma[ei[1]],Lo.array[xo+8]=ma[ei[2]],Lo.array[xo+9]=fa[ei[0]],Lo.array[xo+10]=fa[ei[1]],Lo.array[xo+11]=fa[ei[2]],xo+=12}else if('faceVertices'===Lo.boundTo){for(qr=0,Kr=jo.length;qr<Kr;qr++)vo=Lo.value[jo[qr]],la=vo[0],da=vo[1],ma=vo[2],Lo.array[xo]=la[ei[0]],Lo.array[xo+1]=la[ei[1]],Lo.array[xo+2]=la[ei[2]],Lo.array[xo+3]=da[ei[0]],Lo.array[xo+4]=da[ei[1]],Lo.array[xo+5]=da[ei[2]],Lo.array[xo+6]=ma[ei[0]],Lo.array[xo+7]=ma[ei[1]],Lo.array[xo+8]=ma[ei[2]],xo+=9;for(qr=0,Kr=Wo.length;qr<Kr;qr++)vo=Lo.value[Wo[qr]],la=vo[0],da=vo[1],ma=vo[2],fa=vo[3],Lo.array[xo]=la[ei[0]],Lo.array[xo+1]=la[ei[1]],Lo.array[xo+2]=la[ei[2]],Lo.array[xo+3]=da[ei[0]],Lo.array[xo+4]=da[ei[1]],Lo.array[xo+5]=da[ei[2]],Lo.array[xo+6]=ma[ei[0]],Lo.array[xo+7]=ma[ei[1]],Lo.array[xo+8]=ma[ei[2]],Lo.array[xo+9]=fa[ei[0]],Lo.array[xo+10]=fa[ei[1]],Lo.array[xo+11]=fa[ei[2]],xo+=12}}else if(4===Lo.size)if(void 0===Lo.boundTo||'vertices'===Lo.boundTo){for(qr=0,Kr=jo.length;qr<Kr;qr++)Zr=Xo[jo[qr]],la=Lo.value[Zr.a],da=Lo.value[Zr.b],ma=Lo.value[Zr.c],Lo.array[xo]=la.x,Lo.array[xo+1]=la.y,Lo.array[xo+2]=la.z,Lo.array[xo+3]=la.w,Lo.array[xo+4]=da.x,Lo.array[xo+5]=da.y,Lo.array[xo+6]=da.z,Lo.array[xo+7]=da.w,Lo.array[xo+8]=ma.x,Lo.array[xo+9]=ma.y,Lo.array[xo+10]=ma.z,Lo.array[xo+11]=ma.w,xo+=12;for(qr=0,Kr=Wo.length;qr<Kr;qr++)Zr=Xo[Wo[qr]],la=Lo.value[Zr.a],da=Lo.value[Zr.b],ma=Lo.value[Zr.c],fa=Lo.value[Zr.d],Lo.array[xo]=la.x,Lo.array[xo+1]=la.y,Lo.array[xo+2]=la.z,Lo.array[xo+3]=la.w,Lo.array[xo+4]=da.x,Lo.array[xo+5]=da.y,Lo.array[xo+6]=da.z,Lo.array[xo+7]=da.w,Lo.array[xo+8]=ma.x,Lo.array[xo+9]=ma.y,Lo.array[xo+10]=ma.z,Lo.array[xo+11]=ma.w,Lo.array[xo+12]=fa.x,Lo.array[xo+13]=fa.y,Lo.array[xo+14]=fa.z,Lo.array[xo+15]=fa.w,xo+=16}else if('faces'===Lo.boundTo){for(qr=0,Kr=jo.length;qr<Kr;qr++)vo=Lo.value[jo[qr]],la=vo,da=vo,ma=vo,Lo.array[xo]=la.x,Lo.array[xo+1]=la.y,Lo.array[xo+2]=la.z,Lo.array[xo+3]=la.w,Lo.array[xo+4]=da.x,Lo.array[xo+5]=da.y,Lo.array[xo+6]=da.z,Lo.array[xo+7]=da.w,Lo.array[xo+8]=ma.x,Lo.array[xo+9]=ma.y,Lo.array[xo+10]=ma.z,Lo.array[xo+11]=ma.w,xo+=12;for(qr=0,Kr=Wo.length;qr<Kr;qr++)vo=Lo.value[Wo[qr]],la=vo,da=vo,ma=vo,fa=vo,Lo.array[xo]=la.x,Lo.array[xo+1]=la.y,Lo.array[xo+2]=la.z,Lo.array[xo+3]=la.w,Lo.array[xo+4]=da.x,Lo.array[xo+5]=da.y,Lo.array[xo+6]=da.z,Lo.array[xo+7]=da.w,Lo.array[xo+8]=ma.x,Lo.array[xo+9]=ma.y,Lo.array[xo+10]=ma.z,Lo.array[xo+11]=ma.w,Lo.array[xo+12]=fa.x,Lo.array[xo+13]=fa.y,Lo.array[xo+14]=fa.z,Lo.array[xo+15]=fa.w,xo+=16}else if('faceVertices'===Lo.boundTo){for(qr=0,Kr=jo.length;qr<Kr;qr++)vo=Lo.value[jo[qr]],la=vo[0],da=vo[1],ma=vo[2],Lo.array[xo]=la.x,Lo.array[xo+1]=la.y,Lo.array[xo+2]=la.z,Lo.array[xo+3]=la.w,Lo.array[xo+4]=da.x,Lo.array[xo+5]=da.y,Lo.array[xo+6]=da.z,Lo.array[xo+7]=da.w,Lo.array[xo+8]=ma.x,Lo.array[xo+9]=ma.y,Lo.array[xo+10]=ma.z,Lo.array[xo+11]=ma.w,xo+=12;for(qr=0,Kr=Wo.length;qr<Kr;qr++)vo=Lo.value[Wo[qr]],la=vo[0],da=vo[1],ma=vo[2],fa=vo[3],Lo.array[xo]=la.x,Lo.array[xo+1]=la.y,Lo.array[xo+2]=la.z,Lo.array[xo+3]=la.w,Lo.array[xo+4]=da.x,Lo.array[xo+5]=da.y,Lo.array[xo+6]=da.z,Lo.array[xo+7]=da.w,Lo.array[xo+8]=ma.x,Lo.array[xo+9]=ma.y,Lo.array[xo+10]=ma.z,Lo.array[xo+11]=ma.w,Lo.array[xo+12]=fa.x,Lo.array[xo+13]=fa.y,Lo.array[xo+14]=fa.z,Lo.array[xo+15]=fa.w,xo+=16}rr.bindBuffer(rr.ARRAY_BUFFER,Lo.buffer),rr.bufferData(rr.ARRAY_BUFFER,Lo.array,kr)}Gr&&(delete Or.__inittedArrays,delete Or.__colorArray,delete Or.__normalArray,delete Or.__tangentArray,delete Or.__uvArray,delete Or.__uv2Array,delete Or.__faceArray,delete Or.__vertexArray,delete Or.__lineArray,delete Or.__skinIndexArray,delete Or.__skinWeightArray)}}function X(Or,Br,kr){var Gr=Or.attributes,Hr,jr;for(Hr in Gr)jr=Gr[Hr],jr.needsUpdate&&('index'===Hr?(rr.bindBuffer(rr.ELEMENT_ARRAY_BUFFER,jr.buffer),rr.bufferData(rr.ELEMENT_ARRAY_BUFFER,jr.array,Br)):(rr.bindBuffer(rr.ARRAY_BUFFER,jr.buffer),rr.bufferData(rr.ARRAY_BUFFER,jr.array,Br)),jr.needsUpdate=!1),kr&&!jr.dynamic&&delete jr.array}function Y(Or){Xt[Or]||(rr.enableVertexAttribArray(Or),Xt[Or]=!0)}function K(){for(var Or in Xt)Xt[Or]&&(rr.disableVertexAttribArray(Or),Xt[Or]=!1)}function Q(Or,Br,kr){var Gr=Or.program.attributes;if(-1!==kr.morphTargetBase&&0<=Gr.position?(rr.bindBuffer(rr.ARRAY_BUFFER,Br.__webglMorphTargetsBuffers[kr.morphTargetBase]),Y(Gr.position),rr.vertexAttribPointer(Gr.position,3,rr.FLOAT,!1,0,0)):0<=Gr.position&&(rr.bindBuffer(rr.ARRAY_BUFFER,Br.__webglVertexBuffer),Y(Gr.position),rr.vertexAttribPointer(Gr.position,3,rr.FLOAT,!1,0,0)),kr.morphTargetForcedOrder.length)for(var Hr=0,jr=kr.morphTargetForcedOrder,Wr=kr.morphTargetInfluences;Hr<Or.numSupportedMorphTargets&&Hr<jr.length;)0<=Gr['morphTarget'+Hr]&&(rr.bindBuffer(rr.ARRAY_BUFFER,Br.__webglMorphTargetsBuffers[jr[Hr]]),Y(Gr['morphTarget'+Hr]),rr.vertexAttribPointer(Gr['morphTarget'+Hr],3,rr.FLOAT,!1,0,0)),0<=Gr['morphNormal'+Hr]&&Or.morphNormals&&(rr.bindBuffer(rr.ARRAY_BUFFER,Br.__webglMorphNormalsBuffers[jr[Hr]]),Y(Gr['morphNormal'+Hr]),rr.vertexAttribPointer(Gr['morphNormal'+Hr],3,rr.FLOAT,!1,0,0)),kr.__webglMorphTargetInfluences[Hr]=Wr[jr[Hr]],Hr++;else{var Yr=[],Wr=kr.morphTargetInfluences,Kr=Wr.length,Xr,qr;for(qr=0;qr<Kr;qr++)Xr=Wr[qr],0<Xr&&Yr.push([Xr,qr]);Yr.length>Or.numSupportedMorphTargets?(Yr.sort(J),Yr.length=Or.numSupportedMorphTargets):Yr.length>Or.numSupportedMorphNormals?Yr.sort(J):0===Yr.length&&Yr.push([0,0]);for(var Hr=0,Qr;Hr<Or.numSupportedMorphTargets;)Yr[Hr]?(Qr=Yr[Hr][1],0<=Gr['morphTarget'+Hr]&&(rr.bindBuffer(rr.ARRAY_BUFFER,Br.__webglMorphTargetsBuffers[Qr]),Y(Gr['morphTarget'+Hr]),rr.vertexAttribPointer(Gr['morphTarget'+Hr],3,rr.FLOAT,!1,0,0)),0<=Gr['morphNormal'+Hr]&&Or.morphNormals&&(rr.bindBuffer(rr.ARRAY_BUFFER,Br.__webglMorphNormalsBuffers[Qr]),Y(Gr['morphNormal'+Hr]),rr.vertexAttribPointer(Gr['morphNormal'+Hr],3,rr.FLOAT,!1,0,0)),kr.__webglMorphTargetInfluences[Hr]=Wr[Qr]):kr.__webglMorphTargetInfluences[Hr]=0,Hr++}null!==Or.program.uniforms.morphTargetInfluences&&rr.uniform1fv(Or.program.uniforms.morphTargetInfluences,kr.__webglMorphTargetInfluences)}function Z(Or,Br){return Or.z===Br.z?Or.id-Br.id:Br.z-Or.z}function J(Or,Br){return Br[0]-Or[0]}function ee(Or,Br,kr){if(Or.length)for(var Gr=0,Hr=Or.length;Gr<Hr;Gr++)bt=null,At=null,Pt=-1,Ut=-1,Ft=-1,Et=-1,Dt=-1,Tt=-1,Mt=-1,$t=!0,Or[Gr].render(Br,kr,jt,Wt),bt=null,At=null,Pt=-1,Ut=-1,Ft=-1,Et=-1,Dt=-1,Tt=-1,Mt=-1,$t=!0}function re(Or,Br,kr,Gr,Hr,jr,Wr,Xr){var Yr,qr,Kr,Qr,Zr,Jr,$r;Br?(Zr=Or.length-1,Jr=-1,$r=-1):(Zr=0,Jr=Or.length,$r=1);for(var ta=Zr;ta!==Jr;ta+=$r)if(Yr=Or[ta],Yr.render){if(qr=Yr.object,Kr=Yr.buffer,Xr)Qr=Xr;else{if(Qr=Yr[kr],!Qr)continue;Wr&&xt.setBlending(Qr.blending,Qr.blendEquation,Qr.blendSrc,Qr.blendDst),xt.setDepthTest(Qr.depthTest),xt.setDepthWrite(Qr.depthWrite),Be(Qr.polygonOffset,Qr.polygonOffsetFactor,Qr.polygonOffsetUnits)}xt.setMaterialFaces(Qr),Kr instanceof THREE.BufferGeometry?xt.renderBufferDirect(Gr,Hr,jr,Qr,Kr,qr):xt.renderBuffer(Gr,Hr,jr,Qr,Kr,qr)}}function oe(Or,Br,kr,Gr,Hr,jr,Wr){for(var Qr=0,Zr=Or.length,Xr,Yr,qr;Qr<Zr;Qr++)if(Xr=Or[Qr],Yr=Xr.object,Yr.visible){if(Wr)qr=Wr;else{if(qr=Xr[Br],!qr)continue;jr&&xt.setBlending(qr.blending,qr.blendEquation,qr.blendSrc,qr.blendDst),xt.setDepthTest(qr.depthTest),xt.setDepthWrite(qr.depthWrite),Be(qr.polygonOffset,qr.polygonOffsetFactor,qr.polygonOffsetUnits)}xt.renderImmediateObject(kr,Gr,Hr,qr,Yr)}}function ie(Or){var Br=Or.object,kr=Br.material;kr.transparent?(Or.transparent=kr,Or.opaque=null):(Or.opaque=kr,Or.transparent=null)}function ne(Or){var Br=Or.object,kr=Or.buffer,Gr,Hr,jr;jr=Br.material,jr instanceof THREE.MeshFaceMaterial?(Hr=kr.materialIndex,Gr=jr.materials[Hr],Gr.transparent?(Or.transparent=Gr,Or.opaque=null):(Or.opaque=Gr,Or.transparent=null)):(Gr=jr,Gr&&(Gr.transparent?(Or.transparent=Gr,Or.opaque=null):(Or.opaque=Gr,Or.transparent=null)))}function se(Or,Br,kr){var qr={},Kr=Or.morphTargets.length,Qr=Or.morphNormals.length,Gr,Hr,jr,Wr,Xr,Yr;if(self.MMD_SA&&null!=kr){var Zr=MMD_SA_options.model_para_obj_all[kr].morphTargets_length_fixed;null==Zr&&(Zr=MMD_SA_options.morphTargets_length_fixed),Zr?Kr=Zr:Kr&&MMD_SA.morphTargets_length_extra&&(Kr+=MMD_SA.morphTargets_length_extra)}var Jr=Br instanceof THREE.MeshFaceMaterial;for(Or.geometryGroups={},Gr=0,Hr=Or.faces.length;Gr<Hr;Gr++)jr=Or.faces[Gr],Wr=Jr?jr.materialIndex:0,void 0===qr[Wr]&&(qr[Wr]={hash:Wr,counter:0}),Yr=qr[Wr].hash+'_'+qr[Wr].counter,void 0===Or.geometryGroups[Yr]&&(Or.geometryGroups[Yr]={faces3:[],faces4:[],materialIndex:Wr,vertices:0,numMorphTargets:Kr,numMorphNormals:Qr}),Xr=jr instanceof THREE.Face3?3:4,65535<Or.geometryGroups[Yr].vertices+Xr&&(qr[Wr].counter+=1,Yr=qr[Wr].hash+'_'+qr[Wr].counter,void 0===Or.geometryGroups[Yr]&&(Or.geometryGroups[Yr]={faces3:[],faces4:[],materialIndex:Wr,vertices:0,numMorphTargets:Kr,numMorphNormals:Qr})),jr instanceof THREE.Face3?Or.geometryGroups[Yr].faces3.push(Gr):Or.geometryGroups[Yr].faces4.push(Gr),Or.geometryGroups[Yr].vertices+=Xr;for(var $r in Or.geometryGroupsList=[],Or.geometryGroups)Or.geometryGroups[$r].id=wt++,Or.geometryGroupsList.push(Or.geometryGroups[$r])}function le(Or,Br){var kr,Gr,Hr,jr;if(void 0===Or.__webglInit)if(Or.__webglInit=!0,Or._modelViewMatrix=new THREE.Matrix4,Or._normalMatrix=new THREE.Matrix3,void 0!==Or.geometry&&void 0===Or.geometry.__webglInit&&(Or.geometry.__webglInit=!0,Or.geometry.addEventListener('dispose',Pr)),Gr=Or.geometry,void 0==Gr);else if(Gr instanceof THREE.BufferGeometry)O(Gr);else if(Or instanceof THREE.Mesh)for(kr in Hr=Or.material,void 0===Gr.geometryGroups&&se(Gr,Hr,Or._model_index),Gr.geometryGroups)jr=Gr.geometryGroups[kr],jr.__webglVertexBuffer||(A(jr),L(jr,Or),Gr.verticesNeedUpdate=!0,Gr.morphTargetsNeedUpdate=!0,Gr.elementsNeedUpdate=!0,Gr.uvsNeedUpdate=!0,Gr.normalsNeedUpdate=!0,Gr.tangentsNeedUpdate=!0,Gr.colorsNeedUpdate=!0);else Or instanceof THREE.Ribbon?Gr.__webglVertexBuffer||(T(Gr),R(Gr,Or),Gr.verticesNeedUpdate=!0,Gr.colorsNeedUpdate=!0,Gr.normalsNeedUpdate=!0):Or instanceof THREE.Line?Gr.__webglVertexBuffer||(M(Gr),P(Gr,Or),Gr.verticesNeedUpdate=!0,Gr.colorsNeedUpdate=!0,Gr.lineDistancesNeedUpdate=!0):Or instanceof THREE.ParticleSystem&&(Gr.__webglVertexBuffer||(S(Gr),D(Gr,Or),Gr.verticesNeedUpdate=!0,Gr.colorsNeedUpdate=!0));if(void 0===Or.__webglActive){if(!(Or instanceof THREE.Mesh))Or instanceof THREE.Ribbon||Or instanceof THREE.Line||Or instanceof THREE.ParticleSystem?(Gr=Or.geometry,pe(Br.__webglObjects,Gr,Or)):Or instanceof THREE.ImmediateRenderObject||Or.immediateRenderCallback?ue(Br.__webglObjectsImmediate,Or):Or instanceof THREE.Sprite?Br.__webglSprites.push(Or):THREE.LensFlare&&Or instanceof THREE.LensFlare&&Br.__webglFlares.push(Or);else if(Gr=Or.geometry,Gr instanceof THREE.BufferGeometry)pe(Br.__webglObjects,Gr,Or);else if(Gr instanceof THREE.Geometry)for(kr in Gr.geometryGroups)jr=Gr.geometryGroups[kr],pe(Br.__webglObjects,jr,Or),null!=Or._model_index&&/^(\d+)/.test(kr)&&(Br.__webglObjects[Br.__webglObjects.length-1]._material_index=parseInt(RegExp.$1));Or.__webglActive=!0}}function pe(Or,Br,kr){Or.push({id:null,buffer:Br,object:kr,opaque:null,transparent:null,z:0})}function ue(Or,Br){Or.push({id:null,object:Br,opaque:null,transparent:null,z:0})}function fe(Or){var Br=Or.geometry,kr,Gr,Hr;if(Br instanceof THREE.BufferGeometry)X(Br,rr.DYNAMIC_DRAW,!Br.dynamic);else if(Or instanceof THREE.Mesh){for(var jr=0,Wr=Br.geometryGroupsList.length;jr<Wr;jr++)kr=Br.geometryGroupsList[jr],Hr=N(Or,kr),Br.buffersNeedUpdate&&L(kr,Or),Gr=Hr.attributes&&he(Hr),(Br.verticesNeedUpdate||Br.morphTargetsNeedUpdate||Br.elementsNeedUpdate||Br.uvsNeedUpdate||Br.normalsNeedUpdate||Br.colorsNeedUpdate||Br.tangentsNeedUpdate||Gr)&&W(kr,Or,rr.DYNAMIC_DRAW,!Br.dynamic,Hr);Br.verticesNeedUpdate=!1,Br.morphTargetsNeedUpdate=!1,Br.elementsNeedUpdate=!1,Br.uvsNeedUpdate=!1,Br.normalsNeedUpdate=!1,Br.colorsNeedUpdate=!1,Br.tangentsNeedUpdate=!1,Br.buffersNeedUpdate=!1,Hr.attributes&&ge(Hr)}else Or instanceof THREE.Ribbon?(Hr=N(Or,Br),Gr=Hr.attributes&&he(Hr),(Br.verticesNeedUpdate||Br.colorsNeedUpdate||Br.normalsNeedUpdate||Gr)&&H(Br,rr.DYNAMIC_DRAW),Br.verticesNeedUpdate=!1,Br.colorsNeedUpdate=!1,Br.normalsNeedUpdate=!1,Hr.attributes&&ge(Hr)):Or instanceof THREE.Line?(Hr=N(Or,Br),Gr=Hr.attributes&&he(Hr),(Br.verticesNeedUpdate||Br.colorsNeedUpdate||Br.lineDistancesNeedUpdate||Gr)&&G(Br,rr.DYNAMIC_DRAW),Br.verticesNeedUpdate=!1,Br.colorsNeedUpdate=!1,Br.lineDistancesNeedUpdate=!1,Hr.attributes&&ge(Hr)):Or instanceof THREE.ParticleSystem&&(Hr=N(Or,Br),Gr=Hr.attributes&&he(Hr),(Br.verticesNeedUpdate||Br.colorsNeedUpdate||Or.sortParticles||Gr)&&B(Br,rr.DYNAMIC_DRAW,Or),Br.verticesNeedUpdate=!1,Br.colorsNeedUpdate=!1,Hr.attributes&&ge(Hr))}function he(Or){for(var Br in Or.attributes)if(Or.attributes[Br].needsUpdate)return!0;return!1}function ge(Or){for(var Br in Or.attributes)Or.attributes[Br].needsUpdate=!1}function ye(Or,Br){Or instanceof THREE.Mesh||Or instanceof THREE.ParticleSystem||Or instanceof THREE.Ribbon||Or instanceof THREE.Line?xe(Br.__webglObjects,Or):Or instanceof THREE.Sprite?_e(Br.__webglSprites,Or):THREE.LensFlare&&Or instanceof THREE.LensFlare?_e(Br.__webglFlares,Or):(Or instanceof THREE.ImmediateRenderObject||Or.immediateRenderCallback)&&xe(Br.__webglObjectsImmediate,Or),delete Or.__webglActive}function xe(Or,Br){for(var kr=Or.length-1;0<=kr;kr--)Or[kr].object===Br&&Or.splice(kr,1)}function _e(Or,Br){for(var kr=Or.length-1;0<=kr;kr--)Or[kr]===Br&&Or.splice(kr,1)}function ve(Or,Br){Or.uniforms=THREE.UniformsUtils.clone(Br.uniforms),Or.vertexShader=Br.vertexShader,Or.fragmentShader=Br.fragmentShader}function Se(Or,Br,kr,Gr,Hr){Ct=0,Gr.needsUpdate&&(Gr.program&&Vr(Gr),xt.initMaterial(Gr,Br,kr,Hr),Gr.needsUpdate=!1),Gr.morphTargets&&!Hr.__webglMorphTargetInfluences&&(Hr.__webglMorphTargetInfluences=new Float32Array(xt.maxMorphTargets));var jr=!1,Wr=Gr.program,Xr=Wr.uniforms,Yr=Gr.uniforms;if(Wr!==bt&&(rr.useProgram(Wr),bt=Wr,jr=!0),Gr.id!==Mt&&(Mt=Gr.id,jr=!0),(jr||Or!==At)&&(rr.uniformMatrix4fv(Xr.projectionMatrix,!1,Or.projectionMatrix.elements),Or!==At&&(At=Or)),Gr.skinning)if(!(ur&&Hr.useVertexTexture))null!==Xr.boneGlobalMatrices&&rr.uniformMatrix4fv(Xr.boneGlobalMatrices,!1,Hr.boneMatrices);else if(null!==Xr.boneTexture){var qr=Ne();rr.uniform1i(Xr.boneTexture,qr),xt.setTexture(Hr.boneTexture,qr)}return jr&&(kr&&Gr.fog&&Ce(Yr,kr),(Gr instanceof THREE.MeshPhongMaterial||Gr instanceof THREE.MeshLambertMaterial||Gr.lights)&&($t&&(Ie(Wr,Br),$t=!1),Pe(Yr,er)),(Gr instanceof THREE.MeshBasicMaterial||Gr instanceof THREE.MeshLambertMaterial||Gr instanceof THREE.MeshPhongMaterial)&&Me(Yr,Gr),Gr instanceof THREE.LineBasicMaterial?Te(Yr,Gr):Gr instanceof THREE.LineDashedMaterial?(Te(Yr,Gr),Ae(Yr,Gr)):Gr instanceof THREE.ParticleBasicMaterial?we(Yr,Gr):Gr instanceof THREE.MeshPhongMaterial?Ee(Yr,Gr):Gr instanceof THREE.MeshLambertMaterial?De(Yr,Gr):Gr instanceof THREE.MeshDepthMaterial?(Yr.mNear.value=Or.near,Yr.mFar.value=Or.far,Yr.opacity.value=Gr.opacity):Gr instanceof THREE.MeshNormalMaterial&&(Yr.opacity.value=Gr.opacity),Hr.receiveShadow&&!Gr._shadowPass&&Re(Yr,Br),Gr.refreshUniforms&&Gr.refreshUniforms(xt),Ue(Wr,Gr.uniformsList),(Gr instanceof THREE.ShaderMaterial||Gr instanceof THREE.MeshPhongMaterial||Gr.envMap)&&null!==Xr.cameraPosition&&(Zt.getPositionFromMatrix(Or.matrixWorld),rr.uniform3f(Xr.cameraPosition,Zt.x,Zt.y,Zt.z)),(Gr instanceof THREE.MeshPhongMaterial||Gr instanceof THREE.MeshLambertMaterial||Gr instanceof THREE.ShaderMaterial||Gr.skinning)&&null!==Xr.viewMatrix&&rr.uniformMatrix4fv(Xr.viewMatrix,!1,Or.matrixWorldInverse.elements)),Le(Xr,Hr),null!==Xr.modelMatrix&&rr.uniformMatrix4fv(Xr.modelMatrix,!1,Hr.matrixWorld.elements),Wr}function Me(Or,Br){if(Or.opacity.value=Br.opacity,xt.gammaInput?Or.diffuse.value.copyGammaToLinear(Br.color):Or.diffuse.value=Br.color,Or.map.value=Br.map,Or.lightMap.value=Br.lightMap,Or.specularMap.value=Br.specularMap,Br.bumpMap&&(Or.bumpMap.value=Br.bumpMap,Or.bumpScale.value=Br.bumpScale),Br.displacementMap&&(Or.tDisplacement.value=Br.displacementMap,Or.uDisplacementBias.value=Br.uDisplacementBias,Or.uDisplacementScale.value=Br.uDisplacementScale,Or.uDisplacementCustomUVScale.value=Br.uDisplacementCustomUVScale,Or.uDisplacementCustomUVOffset.value.copy(Br.uDisplacementCustomUVOffset),Or.edgeRotateDisplacementL.value=Br.edgeRotateDisplacementL,Or.edgeRotateDisplacementR.value=Br.edgeRotateDisplacementR,Or.edgeScaleDisplacementU.value=Br.edgeScaleDisplacementU),null!=Br.waveBaseSpeed&&(Or.waveBaseSpeed.value=Br.waveBaseSpeed,Or.waveNoiseTexture.value=Br.waveNoiseTexture,Or.waveNoiseScale.value=Br.waveNoiseScale,Or.waveBumpScale.value=Br.waveBumpScale,Or.time.value=RAF_timestamp/1e3,Or.waveDrops.value=self.MMD_SA&&MMD_SA.ripple_process()||[]),null!=Br.mirrorTextureIndex){var kr=MMD_SA._THREE_mirror[Br.mirrorTextureIndex];kr&&(Or.mirrorSampler.value=kr.texture,Or.mirrorTextureMatrix.value=kr.textureMatrix),Or.reflection_alpha.value=!kr||MMD_SA._mirror_rendering_?0:kr.material.uniforms.reflection_alpha.value}Br.normalMap&&(Or.normalMap.value=Br.normalMap,Or.normalScale.value.copy(Br.normalScale));var Gr;if(Br.repeat?Gr=Br:Br.map?Gr=Br.map:Br.specularMap?Gr=Br.specularMap:Br.normalMap?Gr=Br.normalMap:Br.bumpMap?Gr=Br.bumpMap:Br.displacementMap?Gr=Br.displacementMap:Br.waveNoiseTexture&&(Gr=Br.waveNoiseTexture),void 0!=Gr){var Hr=Gr.offset,jr=Gr.repeat;Or.offsetRepeat.value.set(Hr.x,Hr.y,jr.x,jr.y)}Or.envMap.value=Br.envMap,Or.flipEnvMap.value=Br.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,Or.reflectivity.value=xt.gammaInput?Br.reflectivity:Br.reflectivity,Or.refractionRatio.value=Br.refractionRatio,Or.combine.value=Br.combine,Or.useRefract.value=Br.envMap&&Br.envMap.mapping instanceof THREE.CubeRefractionMapping}function Te(Or,Br){Or.diffuse.value=Br.color,Or.opacity.value=Br.opacity}function Ae(Or,Br){Or.dashSize.value=Br.dashSize,Or.totalSize.value=Br.dashSize+Br.gapSize,Or.scale.value=Br.scale}function we(Or,Br){Or.psColor.value=Br.color,Or.opacity.value=Br.opacity,Or.size.value=Br.size,Or.scale.value=lt.height/2,Or.map.value=Br.map}function Ce(Or,Br){Or.fogColor.value=Br.color,Br instanceof THREE.Fog?(Or.fogNear.value=Br.near,Or.fogFar.value=Br.far):Br instanceof THREE.FogExp2&&(Or.fogDensity.value=Br.density)}function Ee(Or,Br){Or.shininess.value=Br.shininess,xt.gammaInput?(Or.ambient.value.copyGammaToLinear(Br.ambient),Or.emissive.value.copyGammaToLinear(Br.emissive),Or.specular.value.copyGammaToLinear(Br.specular)):(Or.ambient.value=Br.ambient,Or.emissive.value=Br.emissive,Or.specular.value=Br.specular),Br.wrapAround&&Or.wrapRGB.value.copy(Br.wrapRGB)}function De(Or,Br){xt.gammaInput?(Or.ambient.value.copyGammaToLinear(Br.ambient),Or.emissive.value.copyGammaToLinear(Br.emissive)):(Or.ambient.value=Br.ambient,Or.emissive.value=Br.emissive),Br.wrapAround&&Or.wrapRGB.value.copy(Br.wrapRGB)}function Pe(Or,Br){Or.ambientLightColor.value=Br.ambient,Or.directionalLightColor.value=Br.directional.colors,Or.directionalLightDirection.value=Br.directional.positions,Or.pointLightColor.value=Br.point.colors,Or.pointLightPosition.value=Br.point.positions,Or.pointLightDistance.value=Br.point.distances,Or.spotLightColor.value=Br.spot.colors,Or.spotLightPosition.value=Br.spot.positions,Or.spotLightDistance.value=Br.spot.distances,Or.spotLightDirection.value=Br.spot.directions,Or.spotLightAngleCos.value=Br.spot.anglesCos,Or.spotLightExponent.value=Br.spot.exponents,Or.hemisphereLightSkyColor.value=Br.hemi.skyColors,Or.hemisphereLightGroundColor.value=Br.hemi.groundColors,Or.hemisphereLightDirection.value=Br.hemi.positions}function Re(Or,Br){if(Or.shadowMatrix)for(var kr=0,Gr=0,Hr=Br.length,jr;Gr<Hr;Gr++)jr=Br[Gr],jr.castShadow&&(jr instanceof THREE.SpotLight||jr instanceof THREE.DirectionalLight&&!jr.shadowCascade?(Or.shadowMap.value[kr]=jr.shadowMap,Or.shadowMapSize.value[kr]=jr.shadowMapSize,Or.shadowMatrix.value[kr]=jr.shadowMatrix,Or.shadowDarkness.value[kr]=jr.shadowDarkness,Or.shadowBias.value[kr]=jr._shadowBias_range,Or.shadowPara.value[kr]=jr._shadowPara,kr++):jr instanceof THREE.DirectionalLight&&jr.shadowCascadeArray&&jr.shadowCascadeArray.forEach(function(Yr){Or.shadowMap.value[kr]=Yr.shadowMap,Or.shadowMapSize.value[kr]=Yr.shadowMapSize,Or.shadowMatrix.value[kr]=Yr.shadowMatrix,Or.shadowDarkness.value[kr]=Yr.shadowDarkness,Or.shadowBias.value[kr]=Yr._shadowBias_range,Or.shadowPara.value[kr]=Yr._shadowPara,kr++}))}function Le(Or,Br){rr.uniformMatrix4fv(Or.modelViewMatrix,!1,Br._modelViewMatrix.elements),Or.normalMatrix&&rr.uniformMatrix3fv(Or.normalMatrix,!1,Br._normalMatrix.elements)}function Ne(){var Or=Ct;return Or>=sr&&console.warn('WebGLRenderer: trying to use '+Or+' texture units while this GPU supports only '+sr),Ct+=1,Or}function Ue(Or,Br){var kr,Gr,Hr,jr,Wr,Xr,Yr,qr,Kr,Qr,Zr;for(Kr=0,Qr=Br.length;Kr<Qr;Kr++)if(jr=Or.uniforms[Br[Kr][1]],jr)if(kr=Br[Kr][0],Hr=kr.type,Gr=kr.value,'i'===Hr)rr.uniform1i(jr,Gr);else if('f'===Hr)rr.uniform1f(jr,Gr);else if('v2'===Hr)rr.uniform2f(jr,Gr.x,Gr.y);else if('v3'===Hr)rr.uniform3f(jr,Gr.x,Gr.y,Gr.z);else if('v4'===Hr)rr.uniform4f(jr,Gr.x,Gr.y,Gr.z,Gr.w);else if('c'===Hr)rr.uniform3f(jr,Gr.r,Gr.g,Gr.b);else if('iv1'===Hr)rr.uniform1iv(jr,Gr);else if('iv'===Hr)rr.uniform3iv(jr,Gr);else if('fv1'===Hr||'1fv'===Hr)rr.uniform1fv(jr,Gr);else if('fv'===Hr)rr.uniform3fv(jr,Gr);else if('v2v'===Hr){for(void 0===kr._array&&(kr._array=new Float32Array(2*Gr.length)),Yr=0,qr=Gr.length;Yr<qr;Yr++)Zr=2*Yr,kr._array[Zr]=Gr[Yr].x,kr._array[Zr+1]=Gr[Yr].y;rr.uniform2fv(jr,kr._array)}else if('v3v'===Hr){for(void 0===kr._array&&(kr._array=new Float32Array(3*Gr.length)),Yr=0,qr=Gr.length;Yr<qr;Yr++)Zr=3*Yr,kr._array[Zr]=Gr[Yr].x,kr._array[Zr+1]=Gr[Yr].y,kr._array[Zr+2]=Gr[Yr].z;rr.uniform3fv(jr,kr._array)}else if('v4v'===Hr){for(void 0===kr._array&&(kr._array=new Float32Array(4*Gr.length)),Yr=0,qr=Gr.length;Yr<qr;Yr++)Zr=4*Yr,kr._array[Zr]=Gr[Yr].x,kr._array[Zr+1]=Gr[Yr].y,kr._array[Zr+2]=Gr[Yr].z,kr._array[Zr+3]=Gr[Yr].w;rr.uniform4fv(jr,kr._array)}else if('m4'===Hr)void 0===kr._array&&(kr._array=new Float32Array(16)),Gr.flattenToArray(kr._array),rr.uniformMatrix4fv(jr,!1,kr._array);else if('m4v'===Hr){for(void 0===kr._array&&(kr._array=new Float32Array(16*Gr.length)),Yr=0,qr=Gr.length;Yr<qr;Yr++)Gr[Yr].flattenToArrayOffset(kr._array,16*Yr);rr.uniformMatrix4fv(jr,!1,kr._array)}else if('t'===Hr){if(Wr=Gr,Xr=Ne(),rr.uniform1i(jr,Xr),!Wr)continue;Wr.image instanceof Array&&6===Wr.image.length?Qe(Wr,Xr):Wr instanceof THREE.WebGLRenderTargetCube?Ze(Wr,Xr):xt.setTexture(Wr,Xr)}else if('tv'===Hr){for(void 0===kr._array&&(kr._array=[]),Yr=0,qr=kr.value.length;Yr<qr;Yr++)kr._array[Yr]=Ne();for(rr.uniform1iv(jr,kr._array),Yr=0,qr=kr.value.length;Yr<qr;Yr++)Wr=kr.value[Yr],Xr=kr._array[Yr],Wr&&xt.setTexture(Wr,Xr)}}function Fe(Or,Br){Or._modelViewMatrix.multiplyMatrices(Br.matrixWorldInverse,Or.matrixWorld),Or._normalMatrix.getNormalMatrix(Or._modelViewMatrix)}function ze(Or,Br,kr,Gr){Or[Br]=kr.r*kr.r*Gr,Or[Br+1]=kr.g*kr.g*Gr,Or[Br+2]=kr.b*kr.b*Gr}function Ve(Or,Br,kr,Gr){Or[Br]=kr.r*Gr,Or[Br+1]=kr.g*Gr,Or[Br+2]=kr.b*Gr}function Ie(Or,Br){var Wr=0,Xr=0,Yr=0,ra=er,aa=ra.directional.colors,oa=ra.directional.positions,ia=ra.point.colors,sa=ra.point.positions,la=ra.point.distances,da=ra.spot.colors,ma=ra.spot.positions,fa=ra.spot.distances,ha=ra.spot.directions,ga=ra.spot.anglesCos,ya=ra.spot.exponents,xa=ra.hemi.skyColors,_a=ra.hemi.groundColors,ba=ra.hemi.positions,Sa=0,Ma=0,Ta=0,Aa=0,wa=0,Ca=0,Ea=0,Da=0,Pa=0,Ra=0,La=0,Na=0,kr,Gr,Hr,qr,Kr,Qr,Zr,Jr,ta;for(kr=0,Gr=Br.length;kr<Gr;kr++)if(Hr=Br[kr],!Hr.onlyShadow)if(qr=Hr.color,Zr=Hr.intensity,ta=Hr.distance,Hr instanceof THREE.AmbientLight){if(!Hr.visible)continue;xt.gammaInput?(Wr+=qr.r*qr.r,Xr+=qr.g*qr.g,Yr+=qr.b*qr.b):(Wr+=qr.r,Xr+=qr.g,Yr+=qr.b)}else if(Hr instanceof THREE.DirectionalLight){if(wa+=1,!Hr.visible)continue;if(Jt.getPositionFromMatrix(Hr.matrixWorld),Zt.getPositionFromMatrix(Hr.target.matrixWorld),Jt.sub(Zt),Jt.normalize(),0===Jt.x&&0===Jt.y&&0===Jt.z)continue;Pa=3*Sa,oa[Pa]=Jt.x,oa[Pa+1]=Jt.y,oa[Pa+2]=Jt.z,xt.gammaInput?ze(aa,Pa,qr,Zr*Zr):Ve(aa,Pa,qr,Zr),Sa+=1}else if(Hr instanceof THREE.PointLight){if(Ca+=1,!Hr.visible)continue;Ra=3*Ma,xt.gammaInput?ze(ia,Ra,qr,Zr*Zr):Ve(ia,Ra,qr,Zr),Zt.getPositionFromMatrix(Hr.matrixWorld),sa[Ra]=Zt.x,sa[Ra+1]=Zt.y,sa[Ra+2]=Zt.z,la[Ma]=ta,Ma+=1}else if(Hr instanceof THREE.SpotLight){if(Ea+=1,!Hr.visible)continue;La=3*Ta,xt.gammaInput?ze(da,La,qr,Zr*Zr):Ve(da,La,qr,Zr),Zt.getPositionFromMatrix(Hr.matrixWorld),ma[La]=Zt.x,ma[La+1]=Zt.y,ma[La+2]=Zt.z,fa[Ta]=ta,Jt.copy(Zt),Zt.getPositionFromMatrix(Hr.target.matrixWorld),Jt.sub(Zt),Jt.normalize(),ha[La]=Jt.x,ha[La+1]=Jt.y,ha[La+2]=Jt.z,ga[Ta]=Math.cos(Hr.angle),ya[Ta]=Hr.exponent,Ta+=1}else if(Hr instanceof THREE.HemisphereLight){if(Da+=1,!Hr.visible)continue;if(Jt.getPositionFromMatrix(Hr.matrixWorld),Jt.normalize(),0===Jt.x&&0===Jt.y&&0===Jt.z)continue;Na=3*Aa,ba[Na]=Jt.x,ba[Na+1]=Jt.y,ba[Na+2]=Jt.z,Kr=Hr.color,Qr=Hr.groundColor,xt.gammaInput?(Jr=Zr*Zr,ze(xa,Na,Kr,Jr),ze(_a,Na,Qr,Jr)):(Ve(xa,Na,Kr,Zr),Ve(_a,Na,Qr,Zr)),Aa+=1}for(kr=3*Sa,Gr=Math.max(aa.length,3*wa);kr<Gr;kr++)aa[kr]=0;for(kr=3*Ma,Gr=Math.max(ia.length,3*Ca);kr<Gr;kr++)ia[kr]=0;for(kr=3*Ta,Gr=Math.max(da.length,3*Ea);kr<Gr;kr++)da[kr]=0;for(kr=3*Aa,Gr=Math.max(xa.length,3*Da);kr<Gr;kr++)xa[kr]=0;for(kr=3*Aa,Gr=Math.max(_a.length,3*Da);kr<Gr;kr++)_a[kr]=0;ra.directional.length=Sa,ra.point.length=Ma,ra.spot.length=Ta,ra.hemi.length=Aa,ra.ambient[0]=Wr,ra.ambient[1]=Xr,ra.ambient[2]=Yr}function Oe(Or){Or!==Ot&&(rr.lineWidth(Or),Ot=Or)}function Be(Or,Br,kr){zt!==Or&&(Or?rr.enable(rr.POLYGON_OFFSET_FILL):rr.disable(rr.POLYGON_OFFSET_FILL),zt=Or),Or&&(Vt!==Br||It!==kr)&&(rr.polygonOffset(Br,kr),Vt=Br,It=kr)}function ke(Or){var Gr=[],Br,kr;for(var Hr in Or)Br=Or[Hr],!1===Br||(kr='#define '+Hr+' '+Br,Gr.push(kr));return Gr.join('\n')}function Ge(Or,Br,kr,Gr,Hr,jr,Wr){var Zr=[],Xr,Yr,qr,Kr,Qr;for(qr in Or?Zr.push(Or):(Zr.push(Br),Zr.push(kr)),jr)Zr.push(qr),Zr.push(jr[qr]);for(Xr in Wr)Zr.push(Xr),Zr.push(Wr[Xr]);for(Qr=Zr.join(),Xr=0,Yr=_t.length;Xr<Yr;Xr++){var Jr=_t[Xr];if(Jr.code===Qr)return Jr.usedTimes++,Jr.program}var $r='SHADOWMAP_TYPE_BASIC';Wr.shadowMapType===THREE.PCFShadowMap?$r='SHADOWMAP_TYPE_PCF':Wr.shadowMapType===THREE.PCFSoftShadowMap&&($r='SHADOWMAP_TYPE_PCF_SOFT');var ta=ke(jr);Kr=rr.createProgram();var ra=['precision '+dt+' float;',ta,mr?'#define VERTEX_TEXTURES':'',xt.gammaInput?'#define GAMMA_INPUT':'',xt.gammaOutput?'#define GAMMA_OUTPUT':'',xt.physicallyBasedShading?'#define PHYSICALLY_BASED_SHADING':'','#define MAX_DIR_LIGHTS '+Wr.maxDirLights,'#define MAX_POINT_LIGHTS '+Wr.maxPointLights,'#define MAX_SPOT_LIGHTS '+Wr.maxSpotLights,'#define MAX_HEMI_LIGHTS '+Wr.maxHemiLights,'#define MAX_SHADOWS '+Wr.maxShadows,'#define MAX_BONES '+Wr.maxBones,Wr.map?'#define USE_MAP':'',Wr.envMap?'#define USE_ENVMAP':'',Wr.lightMap?'#define USE_LIGHTMAP':'',Wr.bumpMap?'#define USE_BUMPMAP':'',Wr.displacementMap?'#define USE_DISPLACEMENTMAP':'',Wr.waveTexture?'#define USE_WAVE_TEXTURE':'',Wr.waveTexture?'#define RIPPLE_MAX '+(self.MMD_SA&&MMD_SA_options.ripple_max||20):'',Wr.waveTexture?'#define RIPPLE_RANGE '+(self.MMD_SA&&MMD_SA_options.ripple_range||128)+'.0':'',Wr.mirrorTexture?'#define USE_MIRROR_TEXTURE':'',Wr.normalMap?'#define USE_NORMALMAP':'',Wr.specularMap?'#define USE_SPECULARMAP':'',Wr.vertexColors?'#define USE_COLOR':'',Wr.skinning?'#define USE_SKINNING':'',Wr.useVertexTexture?'#define BONE_TEXTURE':'',Wr.boneTextureWidth?'#define N_BONE_PIXEL_X '+Wr.boneTextureWidth.toFixed(1):'',Wr.boneTextureHeight?'#define N_BONE_PIXEL_Y '+Wr.boneTextureHeight.toFixed(1):'',Wr.morphTargets?'#define USE_MORPHTARGETS':'',Wr.morphNormals?'#define USE_MORPHNORMALS':'',Wr.perPixel?'#define PHONG_PER_PIXEL':'',Wr.wrapAround?'#define WRAP_AROUND':'',Wr.doubleSided?'#define DOUBLE_SIDED':'',Wr.flipSided?'#define FLIP_SIDED':'',Wr.shadowMapEnabled?'#define USE_SHADOWMAP':'',Wr.shadowMapEnabled?'#define '+$r:'',Wr.shadowMapDebug?'#define SHADOWMAP_DEBUG':'',Wr.shadowMapCascade?'#define SHADOWMAP_CASCADE':'',Wr.sizeAttenuation?'#define USE_SIZEATTENUATION':'','uniform mat4 modelMatrix;','uniform mat4 modelViewMatrix;','uniform mat4 projectionMatrix;','uniform mat4 viewMatrix;','uniform mat3 normalMatrix;','uniform vec3 cameraPosition;','attribute vec3 position;','attribute vec3 normal;','attribute vec2 uv;','attribute vec2 uv2;','#ifdef USE_COLOR','attribute vec3 color;','#endif','#ifdef USE_MORPHTARGETS','attribute vec3 morphTarget0;','attribute vec3 morphTarget1;','attribute vec3 morphTarget2;','attribute vec3 morphTarget3;','#ifdef USE_MORPHNORMALS','attribute vec3 morphNormal0;','attribute vec3 morphNormal1;','attribute vec3 morphNormal2;','attribute vec3 morphNormal3;','#else','attribute vec3 morphTarget4;','attribute vec3 morphTarget5;','attribute vec3 morphTarget6;','attribute vec3 morphTarget7;','#endif','#endif','#ifdef USE_SKINNING','attribute vec4 skinIndex;','attribute vec4 skinWeight;','#endif',''].join('\n'),aa=['precision '+dt+' float;',Wr.bumpMap||Wr.normalMap?'#extension GL_OES_standard_derivatives : enable':'',ta,'#define MAX_DIR_LIGHTS '+Wr.maxDirLights,'#define MAX_POINT_LIGHTS '+Wr.maxPointLights,'#define MAX_SPOT_LIGHTS '+Wr.maxSpotLights,'#define MAX_HEMI_LIGHTS '+Wr.maxHemiLights,'#define MAX_SHADOWS '+Wr.maxShadows,Wr.alphaTest?'#define ALPHATEST '+Wr.alphaTest:'',xt.gammaInput?'#define GAMMA_INPUT':'',xt.gammaOutput?'#define GAMMA_OUTPUT':'',xt.physicallyBasedShading?'#define PHYSICALLY_BASED_SHADING':'',Wr.useFog&&Wr.fog?'#define USE_FOG':'',Wr.useFog&&Wr.fogExp?'#define FOG_EXP2':'',Wr.map?'#define USE_MAP':'',Wr.envMap?'#define USE_ENVMAP':'',Wr.lightMap?'#define USE_LIGHTMAP':'',Wr.bumpMap?'#define USE_BUMPMAP':'','#define BASE_COLOR '+(Wr.base_color&&'vec3('+Wr.base_color+')'||'vec3(1.0)'),Wr.displacementMap?'#define USE_DISPLACEMENTMAP':'',Wr.computerNormalFromDisplacement?'#define COMPUTE_NORMAL_FROM_DISPLACEMENT':'',Wr.waveTexture?'#define USE_WAVE_TEXTURE':'',Wr.mirrorTexture?'#define USE_MIRROR_TEXTURE':'',Wr.normalMap?'#define USE_NORMALMAP':'',Wr.specularMap?'#define USE_SPECULARMAP':'',Wr.vertexColors?'#define USE_COLOR':'',Wr.metal?'#define METAL':'',Wr.perPixel?'#define PHONG_PER_PIXEL':'',Wr.wrapAround?'#define WRAP_AROUND':'',Wr.doubleSided?'#define DOUBLE_SIDED':'',Wr.flipSided?'#define FLIP_SIDED':'',Wr.shadowMapEnabled?'#define USE_SHADOWMAP':'',Wr.shadowMapEnabled?'#define '+$r:'',Wr.shadowMapDebug?'#define SHADOWMAP_DEBUG':'',Wr.shadowMapCascade?'#define SHADOWMAP_CASCADE':'','uniform mat4 viewMatrix;','uniform vec3 cameraPosition;',''].join('\n');self.MMD_SA&&MMD_SA.use_webgl2&&(ra=MMD_SA.webgl2_vshader_prefix_convert(ra),aa=MMD_SA.webgl2_vshader_prefix_convert(aa),kr=MMD_SA.webgl2_vshader_main_convert(kr),Br=MMD_SA.webgl2_fshader_main_convert(Br));var oa=Xe('vertex',ra+kr),ia=Xe('fragment',aa+Br);rr.attachShader(Kr,oa),rr.attachShader(Kr,ia),rr.linkProgram(Kr),rr.getProgramParameter(Kr,rr.LINK_STATUS)||(console.error('Could not initialise shader\nVALIDATE_STATUS: '+rr.getProgramParameter(Kr,rr.VALIDATE_STATUS)+', gl error ['+rr.getError()+']'),console.error(rr.getProgramInfoLog(Kr))),rr.deleteShader(ia),rr.deleteShader(oa),Kr.uniforms={},Kr.attributes={};var sa,la,da,ma;for(la in sa=['viewMatrix','modelViewMatrix','projectionMatrix','normalMatrix','modelMatrix','cameraPosition','morphTargetInfluences'],Wr.useVertexTexture?sa.push('boneTexture'):sa.push('boneGlobalMatrices'),Gr)sa.push(la);for(He(Kr,sa),sa=['position','normal','uv','uv2','tangent','color','skinIndex','skinWeight','lineDistance'],ma=0;ma<Wr.maxMorphTargets;ma++)sa.push('morphTarget'+ma);for(ma=0;ma<Wr.maxMorphNormals;ma++)sa.push('morphNormal'+ma);for(da in Hr)sa.push(da);return je(Kr,sa),Kr.id=vt++,_t.push({program:Kr,code:Qr,usedTimes:1}),xt.info.memory.programs=_t.length,Kr}function He(Or,Br){var kr,Gr,Hr;for(kr=0,Gr=Br.length;kr<Gr;kr++)Hr=Br[kr],Or.uniforms[Hr]=rr.getUniformLocation(Or,Hr)}function je(Or,Br){var kr,Gr,Hr;for(kr=0,Gr=Br.length;kr<Gr;kr++)Hr=Br[kr],Or.attributes[Hr]=rr.getAttribLocation(Or,Hr)}function We(Or){for(var Br=Or.split('\n'),kr=0,Gr=Br.length;kr<Gr;kr++)Br[kr]=kr+1+': '+Br[kr];return Br.join('\n')}function Xe(Or,Br){var kr;return'fragment'===Or?kr=rr.createShader(rr.FRAGMENT_SHADER):'vertex'==Or&&(kr=rr.createShader(rr.VERTEX_SHADER)),rr.shaderSource(kr,Br),rr.compileShader(kr),rr.getShaderParameter(kr,rr.COMPILE_STATUS)?kr:(console.error(rr.getShaderInfoLog(kr)),console.error(We(Br)),null)}function Ye(Or){return self.MMD_SA&&MMD_SA.use_webgl2||0==(Or&Or-1)}function qe(Or,Br,kr){kr?(rr.texParameteri(Or,rr.TEXTURE_WRAP_S,rt(Br.wrapS)),rr.texParameteri(Or,rr.TEXTURE_WRAP_T,rt(Br.wrapT)),rr.texParameteri(Or,rr.TEXTURE_MAG_FILTER,rt(Br.magFilter)),rr.texParameteri(Or,rr.TEXTURE_MIN_FILTER,rt(Br.minFilter))):(rr.texParameteri(Or,rr.TEXTURE_WRAP_S,rr.CLAMP_TO_EDGE),rr.texParameteri(Or,rr.TEXTURE_WRAP_T,rr.CLAMP_TO_EDGE),rr.texParameteri(Or,rr.TEXTURE_MAG_FILTER,tt(Br.magFilter)),rr.texParameteri(Or,rr.TEXTURE_MIN_FILTER,tt(Br.minFilter))),ir&&Br.type!==THREE.FloatType&&(1<Br.anisotropy||Br.__oldAnisotropy)&&(rr.texParameterf(Or,ir.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Br.anisotropy,pr)),Br.__oldAnisotropy=Br.anisotropy)}function Ke(Or,Br){if(Or.width<=Br&&Or.height<=Br)return Or;var kr=Math.max(Or.width,Or.height),Gr=Math.floor(Or.width*Br/kr),Hr=Math.floor(Or.height*Br/kr),jr=document.createElement('canvas');jr.width=Gr,jr.height=Hr;var Wr=jr.getContext('2d');return Wr.drawImage(Or,0,0,Or.width,Or.height,0,0,Gr,Hr),jr}function Qe(Or,Br){if(6===Or.image.length)if(Or.needsUpdate){Or.image.__webglTextureCube||(Or.image.__webglTextureCube=rr.createTexture(),xt.info.memory.textures++),rr.activeTexture(rr.TEXTURE0+Br),rr.bindTexture(rr.TEXTURE_CUBE_MAP,Or.image.__webglTextureCube),rr.pixelStorei(rr.UNPACK_FLIP_Y_WEBGL,Or.flipY);for(var kr=Or instanceof THREE.CompressedTexture,Gr=[],Hr=0;6>Hr;Hr++)Gr[Hr]=xt.autoScaleCubemaps&&!kr?Ke(Or.image[Hr],cr):Or.image[Hr];var jr=Gr[0],Wr=Ye(jr.width)&&Ye(jr.height),Xr=rt(Or.format),Yr=rt(Or.type),qr=MMD_SA.webgl2_RGBA_internal(rr,Xr,Yr);qe(rr.TEXTURE_CUBE_MAP,Or,Wr);for(var Hr=0;6>Hr;Hr++)if(kr)for(var Qr=Gr[Hr].mipmaps,Zr=0,Jr=Qr.length,Kr;Zr<Jr;Zr++)Kr=Qr[Zr],rr.compressedTexImage2D(rr.TEXTURE_CUBE_MAP_POSITIVE_X+Hr,Zr,Xr,Kr.width,Kr.height,0,Kr.data);else rr.texImage2D(rr.TEXTURE_CUBE_MAP_POSITIVE_X+Hr,0,qr,Xr,Yr,Gr[Hr]);Or.generateMipmaps&&Wr&&rr.generateMipmap(rr.TEXTURE_CUBE_MAP),Or.needsUpdate=!1,Or.onUpdate&&Or.onUpdate()}else rr.activeTexture(rr.TEXTURE0+Br),rr.bindTexture(rr.TEXTURE_CUBE_MAP,Or.image.__webglTextureCube)}function Ze(Or,Br){rr.activeTexture(rr.TEXTURE0+Br),rr.bindTexture(rr.TEXTURE_CUBE_MAP,Or.__webglTexture)}function Je(Or,Br,kr){rr.bindFramebuffer(rr.FRAMEBUFFER,Or),rr.framebufferTexture2D(rr.FRAMEBUFFER,rr.COLOR_ATTACHMENT0,kr,Br.__webglTexture,0)}function $e(Or,Br){rr.bindRenderbuffer(rr.RENDERBUFFER,Or),Br.depthBuffer?console.log('renderTarget.depthBuffer'):console.log('!renderTarget.depthBuffer'),Br.depthBuffer&&!Br.stencilBuffer?(Br._use_multisample?rr.renderbufferStorageMultisample(rr.RENDERBUFFER,Br._use_multisample,rr.DEPTH_COMPONENT16,Br.width,Br.height):rr.renderbufferStorage(rr.RENDERBUFFER,rr.DEPTH_COMPONENT16,Br.width,Br.height),rr.framebufferRenderbuffer(rr.FRAMEBUFFER,rr.DEPTH_ATTACHMENT,rr.RENDERBUFFER,Or)):Br.depthBuffer&&Br.stencilBuffer?(Br._use_multisample?rr.renderbufferStorageMultisample(rr.RENDERBUFFER,Br._use_multisample,rr.DEPTH_STENCIL,Br.width,Br.height):rr.renderbufferStorage(rr.RENDERBUFFER,rr.DEPTH_STENCIL,Br.width,Br.height),rr.framebufferRenderbuffer(rr.FRAMEBUFFER,rr.DEPTH_STENCIL_ATTACHMENT,rr.RENDERBUFFER,Or)):Br._use_multisample&&MMD_SA.use_webgl2?(console.log('FIXME: We don\'t support !depth !stencil'),rr.renderbufferStorageMultisample(rr.RENDERBUFFER,Br._use_multisample,rr.RGBA8,Br.width,Br.height)):rr.renderbufferStorage(rr.RENDERBUFFER,rr.RGBA4,Br.width,Br.height)}function et(Or){Or instanceof THREE.WebGLRenderTargetCube?(rr.bindTexture(rr.TEXTURE_CUBE_MAP,Or.__webglTexture),rr.generateMipmap(rr.TEXTURE_CUBE_MAP),rr.bindTexture(rr.TEXTURE_CUBE_MAP,null)):(rr.bindTexture(rr.TEXTURE_2D,Or.__webglTexture),rr.generateMipmap(rr.TEXTURE_2D),rr.bindTexture(rr.TEXTURE_2D,null))}function tt(Or){return Or===THREE.NearestFilter||Or===THREE.NearestMipMapNearestFilter||Or===THREE.NearestMipMapLinearFilter?rr.NEAREST:rr.LINEAR}function rt(Or){if(Or===THREE.RepeatWrapping)return rr.REPEAT;if(Or===THREE.ClampToEdgeWrapping)return rr.CLAMP_TO_EDGE;if(Or===THREE.MirroredRepeatWrapping)return rr.MIRRORED_REPEAT;if(Or===THREE.NearestFilter)return rr.NEAREST;if(Or===THREE.NearestMipMapNearestFilter)return rr.NEAREST_MIPMAP_NEAREST;if(Or===THREE.NearestMipMapLinearFilter)return rr.NEAREST_MIPMAP_LINEAR;if(Or===THREE.LinearFilter)return rr.LINEAR;if(Or===THREE.LinearMipMapNearestFilter)return rr.LINEAR_MIPMAP_NEAREST;if(Or===THREE.LinearMipMapLinearFilter)return rr.LINEAR_MIPMAP_LINEAR;if(Or===THREE.UnsignedByteType)return rr.UNSIGNED_BYTE;if(Or===THREE.UnsignedShort4444Type)return rr.UNSIGNED_SHORT_4_4_4_4;if(Or===THREE.UnsignedShort5551Type)return rr.UNSIGNED_SHORT_5_5_5_1;if(Or===THREE.UnsignedShort565Type)return rr.UNSIGNED_SHORT_5_6_5;if(Or===THREE.ByteType)return rr.BYTE;if(Or===THREE.ShortType)return rr.SHORT;if(Or===THREE.UnsignedShortType)return rr.UNSIGNED_SHORT;if(Or===THREE.IntType)return rr.INT;if(Or===THREE.UnsignedIntType)return rr.UNSIGNED_INT;if(Or===THREE.FloatType)return rr.FLOAT;if(Or===THREE.AlphaFormat)return rr.ALPHA;if(Or===THREE.RGBFormat)return rr.RGB;if(Or===THREE.RGBAFormat)return rr.RGBA;if(Or===THREE.LuminanceFormat)return rr.LUMINANCE;if(Or===THREE.LuminanceAlphaFormat)return rr.LUMINANCE_ALPHA;if(Or===THREE.AddEquation)return rr.FUNC_ADD;if(Or===THREE.SubtractEquation)return rr.FUNC_SUBTRACT;if(Or===THREE.ReverseSubtractEquation)return rr.FUNC_REVERSE_SUBTRACT;if(Or===THREE.ZeroFactor)return rr.ZERO;if(Or===THREE.OneFactor)return rr.ONE;if(Or===THREE.SrcColorFactor)return rr.SRC_COLOR;if(Or===THREE.OneMinusSrcColorFactor)return rr.ONE_MINUS_SRC_COLOR;if(Or===THREE.SrcAlphaFactor)return rr.SRC_ALPHA;if(Or===THREE.OneMinusSrcAlphaFactor)return rr.ONE_MINUS_SRC_ALPHA;if(Or===THREE.DstAlphaFactor)return rr.DST_ALPHA;if(Or===THREE.OneMinusDstAlphaFactor)return rr.ONE_MINUS_DST_ALPHA;if(Or===THREE.DstColorFactor)return rr.DST_COLOR;if(Or===THREE.OneMinusDstColorFactor)return rr.ONE_MINUS_DST_COLOR;if(Or===THREE.SrcAlphaSaturateFactor)return rr.SRC_ALPHA_SATURATE;if(void 0!==nr){if(Or===THREE.RGB_S3TC_DXT1_Format)return nr.COMPRESSED_RGB_S3TC_DXT1_EXT;if(Or===THREE.RGBA_S3TC_DXT1_Format)return nr.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(Or===THREE.RGBA_S3TC_DXT3_Format)return nr.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(Or===THREE.RGBA_S3TC_DXT5_Format)return nr.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}function at(Or){if(ur&&Or&&Or.useVertexTexture)return 1024;var Br=rr.getParameter(rr.MAX_VERTEX_UNIFORM_VECTORS),kr=Math.floor((Br-20)/4),Gr=kr;return void 0!==Or&&Or instanceof THREE.SkinnedMesh&&(Gr=Math.min(Or.bones.length,Gr),Gr<Or.bones.length&&console.warn('WebGLRenderer: too many bones - '+Or.bones.length+', this GPU supports just '+Gr+' (try OpenGL instead of ANGLE)')),Gr}function ot(Or){var Br,kr,Gr,Hr,jr,Wr,Xr;for(Hr=jr=Wr=Xr=0,Br=0,kr=Or.length;Br<kr;Br++)Gr=Or[Br],Gr.onlyShadow||(Gr instanceof THREE.DirectionalLight&&Hr++,Gr instanceof THREE.PointLight&&jr++,Gr instanceof THREE.SpotLight&&Wr++,Gr instanceof THREE.HemisphereLight&&Xr++);return{directional:Hr,point:jr,spot:Wr,hemi:Xr}}function it(Or){var Hr=0,Br,kr,Gr;for(Br=0,kr=Or.length;Br<kr;Br++)Gr=Or[Br],Gr.castShadow&&(Gr instanceof THREE.SpotLight&&Hr++,Gr instanceof THREE.DirectionalLight&&!Gr.shadowCascade&&Hr++);return Hr}_=_||{},_.canvas&&(_.canvas=document.getElementById(_.canvas));var lt=_.canvas===void 0?document.createElement('canvas'):_.canvas,dt=_.precision===void 0?'highp':_.precision,ct=!(_.alpha!==void 0)||_.alpha,mt=!(_.premultipliedAlpha!==void 0)||_.premultipliedAlpha,ut=_.antialias!==void 0&&_.antialias,ft=!(_.stencil!==void 0)||_.stencil,ht=_.preserveDrawingBuffer!==void 0&&_.preserveDrawingBuffer,gt=new THREE.Color(_.clearColor||0),yt=_.clearAlpha||0;this.domElement=lt,this.context=null,this.devicePixelRatio=_.devicePixelRatio===void 0?window.devicePixelRatio===void 0?1:window.devicePixelRatio:_.devicePixelRatio,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.autoUpdateObjects=!0,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyBasedShading=!1,this.shadowMapEnabled=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=THREE.PCFShadowMap,this.shadowMapCullFace=THREE.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var xt=this,_t=[],vt=0,bt=null,St=null,Mt=-1,Tt=null,At=null,wt=0,Ct=0,Et=-1,Dt=-1,Pt=-1,Rt=-1,Lt=-1,Nt=-1,Ut=-1,Ft=-1,zt=null,Vt=null,It=null,Ot=null,Bt=0,kt=0,Gt=0,Ht=0,jt=0,Wt=0,Xt={},Yt=new THREE.Frustum,Kt=new THREE.Matrix4,Qt=new THREE.Matrix4,Zt=new THREE.Vector3,Jt=new THREE.Vector3,$t=!0,er={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},rr,ar,or,ir,nr;(function(){try{var Or={alpha:ct,premultipliedAlpha:mt,antialias:ut,stencil:ft,preserveDrawingBuffer:ht};if(self.MMD_SA&&(rr=lt.getContext('webgl2',Or)),rr?(console.log('Use WebGL2'),MMD_SA.use_webgl2=!0):rr=lt.getContext('webgl',Or)||lt.getContext('experimental-webgl',Or),null===rr)throw'Error creating WebGL context.'}catch(Br){console.error(Br)}self.MMD_SA&&MMD_SA.use_webgl2?(ar=!0,or=!0):(ar=rr.getExtension('OES_texture_float'),or=rr.getExtension('OES_standard_derivatives')),ir=rr.getExtension('EXT_texture_filter_anisotropic')||rr.getExtension('MOZ_EXT_texture_filter_anisotropic')||rr.getExtension('WEBKIT_EXT_texture_filter_anisotropic'),nr=rr.getExtension('WEBGL_compressed_texture_s3tc')||rr.getExtension('MOZ_WEBGL_compressed_texture_s3tc')||rr.getExtension('WEBKIT_WEBGL_compressed_texture_s3tc'),ar||console.log('THREE.WebGLRenderer: Float textures not supported.'),or||console.log('THREE.WebGLRenderer: Standard derivatives not supported.'),ir||console.log('THREE.WebGLRenderer: Anisotropic texture filtering not supported.'),nr||console.log('THREE.WebGLRenderer: S3TC compressed textures not supported.'),rr.getShaderPrecisionFormat===void 0&&(rr.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})})(),function(){rr.clearColor(0,0,0,1),rr.clearDepth(1),rr.clearStencil(0),rr.enable(rr.DEPTH_TEST),rr.depthFunc(rr.LEQUAL),rr.frontFace(rr.CCW),rr.cullFace(rr.BACK),rr.enable(rr.CULL_FACE),rr.enable(rr.BLEND),rr.blendEquation(rr.FUNC_ADD),rr.blendFunc(rr.SRC_ALPHA,rr.ONE_MINUS_SRC_ALPHA),rr.clearColor(gt.r,gt.g,gt.b,yt)}(),this.context=rr;var sr=rr.getParameter(rr.MAX_TEXTURE_IMAGE_UNITS),lr=rr.getParameter(rr.MAX_VERTEX_TEXTURE_IMAGE_UNITS),dr=rr.getParameter(rr.MAX_TEXTURE_SIZE),cr=rr.getParameter(rr.MAX_CUBE_MAP_TEXTURE_SIZE),pr=ir?rr.getParameter(ir.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,mr=0<lr,ur=mr&&ar,fr=nr?rr.getParameter(rr.COMPRESSED_TEXTURE_FORMATS):[],hr=rr.getShaderPrecisionFormat(rr.VERTEX_SHADER,rr.HIGH_FLOAT),gr=rr.getShaderPrecisionFormat(rr.VERTEX_SHADER,rr.MEDIUM_FLOAT),yr=rr.getShaderPrecisionFormat(rr.VERTEX_SHADER,rr.LOW_FLOAT),xr=rr.getShaderPrecisionFormat(rr.FRAGMENT_SHADER,rr.HIGH_FLOAT),_r=rr.getShaderPrecisionFormat(rr.FRAGMENT_SHADER,rr.MEDIUM_FLOAT),vr=rr.getShaderPrecisionFormat(rr.FRAGMENT_SHADER,rr.LOW_FLOAT),Sr=rr.getShaderPrecisionFormat(rr.VERTEX_SHADER,rr.HIGH_INT),Mr=rr.getShaderPrecisionFormat(rr.VERTEX_SHADER,rr.MEDIUM_INT),Tr=rr.getShaderPrecisionFormat(rr.VERTEX_SHADER,rr.LOW_INT),Ar=rr.getShaderPrecisionFormat(rr.FRAGMENT_SHADER,rr.HIGH_INT),wr=rr.getShaderPrecisionFormat(rr.FRAGMENT_SHADER,rr.MEDIUM_INT),Cr=rr.getShaderPrecisionFormat(rr.FRAGMENT_SHADER,rr.LOW_INT),Er=0<hr.precision&&0<xr.precision,Dr=0<gr.precision&&0<_r.precision;'highp'!==dt||Er||(Dr?dt='mediump':dt='lowp'),'mediump'!==dt||Dr||(dt='lowp'),this.getContext=function(){return rr},this.supportsVertexTextures=function(){return mr},this.supportsFloatTextures=function(){return ar},this.supportsStandardDerivatives=function(){return or},this.supportsCompressedTextureS3TC=function(){return nr},this.getMaxAnisotropy=function(){return pr},this.getPrecision=function(){return dt},this.setSize=function(Or,Br,kr){lt.width=Or*this.devicePixelRatio,lt.height=Br*this.devicePixelRatio,1!==this.devicePixelRatio&&!1!==kr&&(lt.style.width=Or+'px',lt.style.height=Br+'px'),this.setViewport(0,0,lt.width,lt.height)},this.setViewport=function(Or,Br,kr,Gr){Bt=Or===void 0?0:Or,kt=Br===void 0?0:Br,Gt=kr===void 0?lt.width:kr,Ht=Gr===void 0?lt.height:Gr,rr.viewport(Bt,kt,Gt,Ht)},this.getViewportX=function(){return Bt},this.getViewportY=function(){return kt},this.getViewportWidth=function(){return Gt},this.getViewportHeight=function(){return Ht},this.setScissor=function(Or,Br,kr,Gr){rr.scissor(Or,Br,kr,Gr)},this.enableScissorTest=function(Or){Or?rr.enable(rr.SCISSOR_TEST):rr.disable(rr.SCISSOR_TEST)},this.setClearColor=function(Or,Br){gt.set(Or),yt=Br===void 0?1:Br,rr.clearColor(gt.r,gt.g,gt.b,yt)},this.getClearColor=function(){return gt},this.getClearAlpha=function(){return yt},this.clear=function(Or,Br,kr){var Gr=0;(Or===void 0||Or)&&(Gr|=rr.COLOR_BUFFER_BIT),(Br===void 0||Br)&&(Gr|=rr.DEPTH_BUFFER_BIT),(kr===void 0||kr)&&(Gr|=rr.STENCIL_BUFFER_BIT),rr.clear(Gr)},this.clearColor=function(){rr.clear(rr.COLOR_BUFFER_BIT)},this.clearTarget=function(Or,Br,kr,Gr){this.setRenderTarget(Or),this.clear(Br,kr,Gr)},this.addPostPlugin=function(Or){Or.init(this),this.renderPluginsPost.push(Or)},this.addPrePlugin=function(Or){Or.init(this),this.renderPluginsPre.push(Or)},this.updateShadowMap=function(Or,Br){bt=null,Pt=-1,Ut=-1,Ft=-1,Tt=-1,Mt=-1,$t=!0,Et=-1,Dt=-1,this.shadowMapPlugin.update(Or,Br)};var Pr=function(Or){var Br=Or.target;Br.removeEventListener('dispose',Pr),Ur(Br),xt.info.memory.geometries--},Rr=function(Or){var Br=Or.target;Br.removeEventListener('dispose',Rr),Fr(Br),xt.info.memory.textures--},Lr=function(Or){var Br=Or.target;Br.removeEventListener('dispose',Lr),zr(Br),xt.info.memory.textures--},Nr=function(Or){var Br=Or.target;Br.removeEventListener('dispose',Nr),Vr(Br)},Ur=function(Or){if(Or.__webglInit=void 0,void 0!==Or.__webglVertexBuffer&&rr.deleteBuffer(Or.__webglVertexBuffer),void 0!==Or.__webglNormalBuffer&&rr.deleteBuffer(Or.__webglNormalBuffer),void 0!==Or.__webglTangentBuffer&&rr.deleteBuffer(Or.__webglTangentBuffer),void 0!==Or.__webglColorBuffer&&rr.deleteBuffer(Or.__webglColorBuffer),void 0!==Or.__webglUVBuffer&&rr.deleteBuffer(Or.__webglUVBuffer),void 0!==Or.__webglUV2Buffer&&rr.deleteBuffer(Or.__webglUV2Buffer),void 0!==Or.__webglSkinIndicesBuffer&&rr.deleteBuffer(Or.__webglSkinIndicesBuffer),void 0!==Or.__webglSkinWeightsBuffer&&rr.deleteBuffer(Or.__webglSkinWeightsBuffer),void 0!==Or.__webglFaceBuffer&&rr.deleteBuffer(Or.__webglFaceBuffer),void 0!==Or.__webglLineBuffer&&rr.deleteBuffer(Or.__webglLineBuffer),void 0!==Or.__webglLineDistanceBuffer&&rr.deleteBuffer(Or.__webglLineDistanceBuffer),void 0!==Or.geometryGroups)for(var Br in Or.geometryGroups){var kr=Or.geometryGroups[Br];if(void 0!==kr.numMorphTargets)for(var Gr=0,Hr=kr.numMorphTargets;Gr<Hr;Gr++)rr.deleteBuffer(kr.__webglMorphTargetsBuffers[Gr]);if(void 0!==kr.numMorphNormals)for(var Gr=0,Hr=kr.numMorphNormals;Gr<Hr;Gr++)rr.deleteBuffer(kr.__webglMorphNormalsBuffers[Gr]);C(kr)}C(Or)},Fr=function(Or){if(Or.image&&Or.image.__webglTextureCube)rr.deleteTexture(Or.image.__webglTextureCube);else{if(!Or.__webglInit)return;Or.__webglInit=!1,rr.deleteTexture(Or.__webglTexture)}},zr=function(Or){if(Or&&Or.__webglTexture)if(rr.deleteTexture(Or.__webglTexture),Or instanceof THREE.WebGLRenderTargetCube)for(var Br=0;6>Br;Br++)rr.deleteFramebuffer(Or.__webglFramebuffer[Br]),rr.deleteRenderbuffer(Or.__webglRenderbuffer[Br]);else rr.deleteFramebuffer(Or.__webglFramebuffer),Or.__webglRenderbuffer&&rr.deleteRenderbuffer(Or.__webglRenderbuffer),Or.__webglMSAAFramebuffer&&rr.deleteFramebuffer(Or.__webglMSAAFramebuffer),Or.__webglMSAAColorbuffer&&rr.deleteRenderbuffer(Or.__webglMSAAColorbuffer),Or.__webglMSAADepthbuffer&&rr.deleteRenderbuffer(Or.__webglMSAADepthbuffer)},Vr=function(Or){var Br=Or.program;if(void 0!==Br){Or.program=void 0;var jr=!1,kr,Gr,Hr;for(kr=0,Gr=_t.length;kr<Gr;kr++)if(Hr=_t[kr],Hr.program===Br){Hr.usedTimes--,0===Hr.usedTimes&&(jr=!0);break}if(!0==jr){var Wr=[];for(kr=0,Gr=_t.length;kr<Gr;kr++)Hr=_t[kr],Hr.program!==Br&&Wr.push(Hr);_t=Wr,rr.deleteProgram(Br),xt.info.memory.programs--}}};this.renderBufferImmediate=function(Or,Br,kr){if(Or.hasPositions&&!Or.__webglVertexBuffer&&(Or.__webglVertexBuffer=rr.createBuffer()),Or.hasNormals&&!Or.__webglNormalBuffer&&(Or.__webglNormalBuffer=rr.createBuffer()),Or.hasUvs&&!Or.__webglUvBuffer&&(Or.__webglUvBuffer=rr.createBuffer()),Or.hasColors&&!Or.__webglColorBuffer&&(Or.__webglColorBuffer=rr.createBuffer()),Or.hasPositions&&(rr.bindBuffer(rr.ARRAY_BUFFER,Or.__webglVertexBuffer),rr.bufferData(rr.ARRAY_BUFFER,Or.positionArray,rr.DYNAMIC_DRAW),rr.enableVertexAttribArray(Br.attributes.position),rr.vertexAttribPointer(Br.attributes.position,3,rr.FLOAT,!1,0,0)),Or.hasNormals){if(rr.bindBuffer(rr.ARRAY_BUFFER,Or.__webglNormalBuffer),kr.shading===THREE.FlatShading){var aa=3*Or.count,Gr,Hr,jr,Wr,Xr,Yr,qr,Kr,Qr,Zr,Jr,$r,ta,ra;for(ra=0;ra<aa;ra+=9)ta=Or.normalArray,Wr=ta[ra],qr=ta[ra+1],Zr=ta[ra+2],Xr=ta[ra+3],Kr=ta[ra+4],Jr=ta[ra+5],Yr=ta[ra+6],Qr=ta[ra+7],$r=ta[ra+8],Gr=(Wr+Xr+Yr)/3,Hr=(qr+Kr+Qr)/3,jr=(Zr+Jr+$r)/3,ta[ra]=Gr,ta[ra+1]=Hr,ta[ra+2]=jr,ta[ra+3]=Gr,ta[ra+4]=Hr,ta[ra+5]=jr,ta[ra+6]=Gr,ta[ra+7]=Hr,ta[ra+8]=jr}rr.bufferData(rr.ARRAY_BUFFER,Or.normalArray,rr.DYNAMIC_DRAW),rr.enableVertexAttribArray(Br.attributes.normal),rr.vertexAttribPointer(Br.attributes.normal,3,rr.FLOAT,!1,0,0)}Or.hasUvs&&kr.map&&(rr.bindBuffer(rr.ARRAY_BUFFER,Or.__webglUvBuffer),rr.bufferData(rr.ARRAY_BUFFER,Or.uvArray,rr.DYNAMIC_DRAW),rr.enableVertexAttribArray(Br.attributes.uv),rr.vertexAttribPointer(Br.attributes.uv,2,rr.FLOAT,!1,0,0)),Or.hasColors&&kr.vertexColors!==THREE.NoColors&&(rr.bindBuffer(rr.ARRAY_BUFFER,Or.__webglColorBuffer),rr.bufferData(rr.ARRAY_BUFFER,Or.colorArray,rr.DYNAMIC_DRAW),rr.enableVertexAttribArray(Br.attributes.color),rr.vertexAttribPointer(Br.attributes.color,3,rr.FLOAT,!1,0,0)),rr.drawArrays(rr.TRIANGLES,0,Or.count),Or.count=0},this.renderBufferDirect=function(Or,Br,kr,Gr,Hr,jr){if(!1!==Gr.visible){var Wr,Xr,Zr,Jr,$r,ta,ra;Wr=Se(Or,Br,kr,Gr,jr),Xr=Wr.attributes,Zr=Hr.attributes;var aa=!1,oa=Gr.wireframe?1:0,ia=16777215*Hr.id+2*Wr.id+oa;if(ia!==Tt&&(Tt=ia,aa=!0),aa&&K(),jr instanceof THREE.Mesh){var sa=Zr.index;if(sa){var la=Hr.offsets;1<la.length&&(aa=!0);for(var da=0,ma=la.length,fa;da<ma;da++){if(fa=la[da].index,aa){for($r in Zr)'index'!==$r&&(ta=Xr[$r],Jr=Zr[$r],ra=Jr.itemSize,0<=ta&&(rr.bindBuffer(rr.ARRAY_BUFFER,Jr.buffer),Y(ta),rr.vertexAttribPointer(ta,ra,rr.FLOAT,!1,0,4*(fa*ra))));rr.bindBuffer(rr.ELEMENT_ARRAY_BUFFER,sa.buffer)}rr.drawElements(rr.TRIANGLES,la[da].count,rr.UNSIGNED_SHORT,2*la[da].start),xt.info.render.calls++,xt.info.render.vertices+=la[da].count,xt.info.render.faces+=la[da].count/3}}else{if(aa)for($r in Zr)'index'!==$r&&(ta=Xr[$r],Jr=Zr[$r],ra=Jr.itemSize,0<=ta&&(rr.bindBuffer(rr.ARRAY_BUFFER,Jr.buffer),Y(ta),rr.vertexAttribPointer(ta,ra,rr.FLOAT,!1,0,0)));var ha=Hr.attributes.position;rr.drawArrays(rr.TRIANGLES,0,ha.numItems/3),xt.info.render.calls++,xt.info.render.vertices+=ha.numItems/3,xt.info.render.faces+=ha.numItems/3/3}}else if(jr instanceof THREE.ParticleSystem){if(aa){for($r in Zr)ta=Xr[$r],Jr=Zr[$r],ra=Jr.itemSize,0<=ta&&(rr.bindBuffer(rr.ARRAY_BUFFER,Jr.buffer),Y(ta),rr.vertexAttribPointer(ta,ra,rr.FLOAT,!1,0,0));var ha=Zr.position;rr.drawArrays(rr.POINTS,0,ha.numItems/3),xt.info.render.calls++,xt.info.render.points+=ha.numItems/3}}else if(jr instanceof THREE.Line&&aa){for($r in Zr)ta=Xr[$r],Jr=Zr[$r],ra=Jr.itemSize,0<=ta&&(rr.bindBuffer(rr.ARRAY_BUFFER,Jr.buffer),Y(ta),rr.vertexAttribPointer(ta,ra,rr.FLOAT,!1,0,0));Oe(Gr.linewidth);var ha=Zr.position;rr.drawArrays(rr.LINE_STRIP,0,ha.numItems/3),xt.info.render.calls++,xt.info.render.points+=ha.numItems}}},this.renderBuffer=function(Or,Br,kr,Gr,Hr,jr){function Wr(){jr instanceof THREE.Mesh?(Gr.wireframe?(Oe(Gr.wireframeLinewidth),ta&&rr.bindBuffer(rr.ELEMENT_ARRAY_BUFFER,Hr.__webglLineBuffer),rr.drawElements(rr.LINES,Hr.__webglLineCount,rr.UNSIGNED_SHORT,0)):(ta&&rr.bindBuffer(rr.ELEMENT_ARRAY_BUFFER,Hr.__webglFaceBuffer),rr.drawElements(rr.TRIANGLES,Hr.__webglFaceCount,rr.UNSIGNED_SHORT,0)),xt.info.render.calls++,xt.info.render.vertices+=Hr.__webglFaceCount,xt.info.render.faces+=Hr.__webglFaceCount/3):jr instanceof THREE.Line?(Kr=jr.type===THREE.LineStrip?rr.LINE_STRIP:rr.LINES,Oe(Gr.linewidth),rr.drawArrays(Kr,0,Hr.__webglLineCount),xt.info.render.calls++):jr instanceof THREE.ParticleSystem?(rr.drawArrays(rr.POINTS,0,Hr.__webglParticleCount),xt.info.render.calls++,xt.info.render.points+=Hr.__webglParticleCount):jr instanceof THREE.Ribbon&&(rr.drawArrays(rr.TRIANGLE_STRIP,0,Hr.__webglVertexCount),xt.info.render.calls++)}if(!1!==Gr.visible){var Xr,Yr,Kr,Zr,Jr,$r;Xr=Se(Or,Br,kr,Gr,jr),Yr=Xr.attributes;var ta=!1,ra=Gr.wireframe?1:0,aa=16777215*Hr.id+2*Xr.id+ra;if(aa!==Tt&&(Tt=aa,ta=!0),ta&&K(),!Gr.morphTargets&&0<=Yr.position?ta&&(rr.bindBuffer(rr.ARRAY_BUFFER,Hr.__webglVertexBuffer),Y(Yr.position),rr.vertexAttribPointer(Yr.position,3,rr.FLOAT,!1,0,0)):jr.morphTargetBase&&Q(Gr,Hr,jr),ta){if(Hr.__webglCustomAttributesList)for(Jr=0,$r=Hr.__webglCustomAttributesList.length;Jr<$r;Jr++)Zr=Hr.__webglCustomAttributesList[Jr],0<=Yr[Zr.buffer.belongsToAttribute]&&(rr.bindBuffer(rr.ARRAY_BUFFER,Zr.buffer),Y(Yr[Zr.buffer.belongsToAttribute]),rr.vertexAttribPointer(Yr[Zr.buffer.belongsToAttribute],Zr.size,rr.FLOAT,!1,0,0));0<=Yr.color&&(rr.bindBuffer(rr.ARRAY_BUFFER,Hr.__webglColorBuffer),Y(Yr.color),rr.vertexAttribPointer(Yr.color,3,rr.FLOAT,!1,0,0)),0<=Yr.normal&&(rr.bindBuffer(rr.ARRAY_BUFFER,Hr.__webglNormalBuffer),Y(Yr.normal),rr.vertexAttribPointer(Yr.normal,3,rr.FLOAT,!1,0,0)),0<=Yr.tangent&&(rr.bindBuffer(rr.ARRAY_BUFFER,Hr.__webglTangentBuffer),Y(Yr.tangent),rr.vertexAttribPointer(Yr.tangent,4,rr.FLOAT,!1,0,0)),0<=Yr.uv&&(rr.bindBuffer(rr.ARRAY_BUFFER,Hr.__webglUVBuffer),Y(Yr.uv),rr.vertexAttribPointer(Yr.uv,2,rr.FLOAT,!1,0,0)),0<=Yr.uv2&&(rr.bindBuffer(rr.ARRAY_BUFFER,Hr.__webglUV2Buffer),Y(Yr.uv2),rr.vertexAttribPointer(Yr.uv2,2,rr.FLOAT,!1,0,0)),Gr.skinning&&0<=Yr.skinIndex&&0<=Yr.skinWeight&&(rr.bindBuffer(rr.ARRAY_BUFFER,Hr.__webglSkinIndicesBuffer),Y(Yr.skinIndex),rr.vertexAttribPointer(Yr.skinIndex,4,rr.FLOAT,!1,0,0),rr.bindBuffer(rr.ARRAY_BUFFER,Hr.__webglSkinWeightsBuffer),Y(Yr.skinWeight),rr.vertexAttribPointer(Yr.skinWeight,4,rr.FLOAT,!1,0,0)),0<=Yr.lineDistance&&(rr.bindBuffer(rr.ARRAY_BUFFER,Hr.__webglLineDistanceBuffer),Y(Yr.lineDistance),rr.vertexAttribPointer(Yr.lineDistance,1,rr.FLOAT,!1,0,0))}var oa;for($r=Gr.passes||1,Jr=0;Jr<$r;Jr++)oa=!1,Gr.preRenderPass&&(oa=Gr.preRenderPass(xt,Jr)),oa||Wr(),Gr.postRenderPass&&Gr.postRenderPass(xt,Jr)}};this.render=function(Or,Br,kr,Gr){var qr=Or.__lights,Kr=Or.fog,Hr,jr,Wr,Xr,Yr;Mt=-1,$t=!0,Or._RAF_timestamp_&&Or._RAF_timestamp_==RAF_timestamp||(Or._RAF_timestamp_&&(Or._RAF_timestamp_=RAF_timestamp),!0===Or.autoUpdate&&Or.updateMatrixWorld()),void 0===Br.parent&&Br.updateMatrixWorld(),Br.matrixWorldInverse.getInverse(Br.matrixWorld),Kt.multiplyMatrices(Br.projectionMatrix,Br.matrixWorldInverse),Yt.setFromMatrix(Kt),this.autoUpdateObjects&&this.initWebGLObjects(Or),ee(this.renderPluginsPre,Or,Br),xt.info.render.calls=0,xt.info.render.vertices=0,xt.info.render.faces=0,xt.info.render.points=0,this.setRenderTarget(kr),(this.autoClear||Gr)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),Yr=Or.__webglObjects;var Qr={};for(Hr=0,jr=Yr.length;Hr<jr;Hr++)if(Wr=Yr[Hr],Xr=Wr.object,Wr.id=Hr,Wr.render=!1,Xr.visible){let aa=Qr;if(null!=Xr._model_index){let oa=Wr.transparent||Wr.opaque;if(oa)if(oa._render_once)oa._render_once=null;else if(0>=oa.opacity)continue;aa=MMD_SA_options.model_para_obj_all[Xr._model_index].material_para,aa=aa&&aa[Xr.material.materials[Wr._material_index].name]||{}}(Xr instanceof THREE.Mesh||Xr instanceof THREE.ParticleSystem)&&Xr.frustumCulled&&!Yt.intersectsObject(Xr)||(Fe(Xr,Br),ne(Wr),Wr.render=!0,!0===this.sortObjects&&(null!=aa.renderDepth||null!==Xr.renderDepth?Wr.z=aa.renderDepth||Xr.renderDepth:(Zt.getPositionFromMatrix(Xr.matrixWorld),Zt.applyProjection(Kt),Wr.z=Zt.z)))}for(this.sortObjects&&Yr.sort(Z),Yr=Or.__webglObjectsImmediate,(Hr=0,jr=Yr.length);Hr<jr;Hr++)Wr=Yr[Hr],Xr=Wr.object,Xr.visible&&(Fe(Xr,Br),ie(Wr));if(Or.overrideMaterial){var Zr=Or.overrideMaterial;this.setBlending(Zr.blending,Zr.blendEquation,Zr.blendSrc,Zr.blendDst),this.setDepthTest(Zr.depthTest),this.setDepthWrite(Zr.depthWrite),Be(Zr.polygonOffset,Zr.polygonOffsetFactor,Zr.polygonOffsetUnits),re(Or.__webglObjects,!1,'',Br,qr,Kr,!0,Zr),oe(Or.__webglObjectsImmediate,'',Br,qr,Kr,!1,Zr)}else{var Zr=null;this.setBlending(THREE.NoBlending),re(Or.__webglObjects,!0,'opaque',Br,qr,Kr,!1,Zr),oe(Or.__webglObjectsImmediate,'opaque',Br,qr,Kr,!1,Zr);var Jr=!(self.MMD_SA&&MMD_SA._depth_render_mode_);re(Or.__webglObjects,!1,'transparent',Br,qr,Kr,Jr,Zr),oe(Or.__webglObjectsImmediate,'transparent',Br,qr,Kr,Jr,Zr)}if(ee(this.renderPluginsPost,Or,Br),kr&&kr._use_multisample){rr.bindFramebuffer(rr.READ_FRAMEBUFFER,kr.__webglMSAAFramebuffer),rr.bindFramebuffer(rr.DRAW_FRAMEBUFFER,kr.__webglFramebuffer);var $r=kr.width,ta=kr.height,ra=rr.COLOR_BUFFER_BIT;rr.blitFramebuffer(0,0,$r,ta,0,0,$r,ta,ra,rr.NEAREST)}kr&&kr.generateMipmaps&&kr.minFilter!==THREE.NearestFilter&&kr.minFilter!==THREE.LinearFilter&&et(kr),this.setDepthTest(!0),this.setDepthWrite(!0)};this.renderImmediateObject=function(Or,Br,kr,Gr,Hr){var jr=Se(Or,Br,kr,Gr,Hr);Tt=-1,xt.setMaterialFaces(Gr),Hr.immediateRenderCallback?Hr.immediateRenderCallback(jr,rr,Yt):Hr.render(function(Wr){xt.renderBufferImmediate(Wr,jr,Gr)})};this.initWebGLObjects=function(Or){for(Or.__webglObjects||(Or.__webglObjects=[],Or.__webglObjectsImmediate=[],Or.__webglSprites=[],Or.__webglFlares=[]);Or.__objectsAdded.length;)le(Or.__objectsAdded[0],Or),Or.__objectsAdded.splice(0,1);for(;Or.__objectsRemoved.length;)ye(Or.__objectsRemoved[0],Or),Or.__objectsRemoved.splice(0,1);for(var Br=0,kr=Or.__webglObjects.length,Gr;Br<kr;Br++)Gr=Or.__webglObjects[Br].object,void 0===Gr.__webglInit&&(void 0!==Gr.__webglActive&&ye(Gr,Or),le(Gr,Or)),fe(Gr)};this.initMaterial=function(Or,Br,kr,Gr){Or.addEventListener('dispose',Nr);var Hr,Xr,Yr,qr,Kr,Qr,Zr;Or instanceof THREE.MeshDepthMaterial?Zr='depth':Or instanceof THREE.MeshNormalMaterial?Zr='normal':Or instanceof THREE.MeshBasicMaterial?Zr='basic':Or instanceof THREE.MeshLambertMaterial?Zr='lambert':Or instanceof THREE.MeshPhongMaterial?Zr='phong':Or instanceof THREE.LineBasicMaterial?Zr='basic':Or instanceof THREE.LineDashedMaterial?Zr='dashed':Or instanceof THREE.ParticleBasicMaterial&&(Zr='particle_basic'),Zr&&ve(Or,THREE.ShaderLib[Zr]),qr=ot(Br),Qr=it(Br),Kr=at(Gr),Yr={map:!!Or.map,envMap:!!Or.envMap,lightMap:!!Or.lightMap,bumpMap:!!Or.bumpMap,base_color:Or.base_color,displacementMap:!!Or.displacementMap,computerNormalFromDisplacement:!!Or.uDisplacementCustomUVScale,waveTexture:null!=Or.waveBaseSpeed,mirrorTexture:null!=Or.mirrorTextureIndex,normalMap:!!Or.normalMap,specularMap:!!Or.specularMap,vertexColors:Or.vertexColors,fog:kr,useFog:Or.fog,fogExp:kr instanceof THREE.FogExp2,sizeAttenuation:Or.sizeAttenuation,skinning:Or.skinning,maxBones:Kr,useVertexTexture:ur&&Gr&&Gr.useVertexTexture,boneTextureWidth:Gr&&Gr.boneTextureWidth,boneTextureHeight:Gr&&Gr.boneTextureHeight,morphTargets:Or.morphTargets,morphNormals:Or.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:qr.directional,maxPointLights:qr.point,maxSpotLights:qr.spot,maxHemiLights:qr.hemi,maxShadows:Qr,shadowMapEnabled:this.shadowMapEnabled&&Gr.receiveShadow,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:Or.alphaTest,metal:Or.metal,perPixel:Or.perPixel,wrapAround:Or.wrapAround,doubleSided:Or.side===THREE.DoubleSide,flipSided:Or.side===THREE.BackSide},Or.program=Ge(Zr,Or.fragmentShader,Or.vertexShader,Or.uniforms,Or.attributes,Or.defines,Yr);var Jr=Or.program.attributes;if(Or.morphTargets){Or.numSupportedMorphTargets=0;var ta='morphTarget',$r;for(Xr=0;Xr<this.maxMorphTargets;Xr++)$r=ta+Xr,0<=Jr[$r]&&Or.numSupportedMorphTargets++}if(Or.morphNormals){Or.numSupportedMorphNormals=0;var ta='morphNormal',$r;for(Xr=0;Xr<this.maxMorphNormals;Xr++)$r=ta+Xr,0<=Jr[$r]&&Or.numSupportedMorphNormals++}for(Hr in Or.uniformsList=[],Or.uniforms)self.MMD_SA&&'depth_render_mode'==Hr&&MMD_SA._depth_render_uniform_list.push({name:Or.name||'',uniform:Or.uniforms.depth_render_mode}),Or.uniformsList.push([Or.uniforms[Hr],Hr])};this.setFaceCulling=function(Or,Br){Or===THREE.CullFaceNone?rr.disable(rr.CULL_FACE):(Br===THREE.FrontFaceDirectionCW?rr.frontFace(rr.CW):rr.frontFace(rr.CCW),Or===THREE.CullFaceBack?rr.cullFace(rr.BACK):Or===THREE.CullFaceFront?rr.cullFace(rr.FRONT):rr.cullFace(rr.FRONT_AND_BACK),rr.enable(rr.CULL_FACE))},this.setMaterialFaces=function(Or){var Br=Or.side===THREE.DoubleSide,kr=Or.side===THREE.BackSide;Et!==Br&&(Br?rr.disable(rr.CULL_FACE):rr.enable(rr.CULL_FACE),Et=Br),Dt!==kr&&(kr?rr.frontFace(rr.CW):rr.frontFace(rr.CCW),Dt=kr)},this.setDepthTest=function(Or){Ut!==Or&&(Or?rr.enable(rr.DEPTH_TEST):rr.disable(rr.DEPTH_TEST),Ut=Or)},this.setDepthWrite=function(Or){Ft!==Or&&(rr.depthMask(Or),Ft=Or)};this.setBlending=function(Or,Br,kr,Gr){Or!==Pt&&(Or===THREE.NoBlending?rr.disable(rr.BLEND):Or===THREE.AdditiveBlending?(rr.enable(rr.BLEND),rr.blendEquation(rr.FUNC_ADD),rr.blendFunc(rr.SRC_ALPHA,rr.ONE)):Or===THREE.SubtractiveBlending?(rr.enable(rr.BLEND),rr.blendEquation(rr.FUNC_ADD),rr.blendFunc(rr.ZERO,rr.ONE_MINUS_SRC_COLOR)):Or===THREE.MultiplyBlending?(rr.enable(rr.BLEND),rr.blendEquation(rr.FUNC_ADD),rr.blendFunc(rr.ZERO,rr.SRC_COLOR)):Or===THREE.CustomBlending?rr.enable(rr.BLEND):(rr.enable(rr.BLEND),rr.blendEquationSeparate(rr.FUNC_ADD,rr.FUNC_ADD),rr.blendFuncSeparate(rr.SRC_ALPHA,rr.ONE_MINUS_SRC_ALPHA,rr.ONE,rr.ONE_MINUS_SRC_ALPHA)),Pt=Or),Or===THREE.CustomBlending?(Br!==Rt&&(rr.blendEquation(rt(Br)),Rt=Br),(kr!==Lt||Gr!==Nt)&&(rr.blendFunc(rt(kr),rt(Gr)),Lt=kr,Nt=Gr)):(Rt=null,Lt=null,Nt=null)};var Ir=document.createElement('canvas');Ir.width=Ir.height=1,this.setTexture=function(Or,Br){if(Or.needsUpdate){Or.__webglInit||(Or.__webglInit=!0,Or.addEventListener('dispose',Rr),Or.__webglTexture=rr.createTexture(),xt.info.memory.textures++),rr.activeTexture(rr.TEXTURE0+Br),rr.bindTexture(rr.TEXTURE_2D,Or.__webglTexture),rr.pixelStorei(rr.UNPACK_FLIP_Y_WEBGL,Or.flipY),rr.pixelStorei(rr.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Or.premultiplyAlpha),rr.pixelStorei(rr.UNPACK_ALIGNMENT,Or.unpackAlignment);var kr=Or.image,Gr=Ye(kr.width)&&Ye(kr.height),Hr=rt(Or.format),jr=rt(Or.type),Wr=MMD_SA.webgl2_RGBA_internal(rr,Hr,jr);qe(rr.TEXTURE_2D,Or,Gr);var Yr=Or.mipmaps,Xr;if(Or instanceof THREE.DataTexture){if(0<Yr.length&&Gr){for(var qr=0,Kr=Yr.length;qr<Kr;qr++)Xr=Yr[qr],rr.texImage2D(rr.TEXTURE_2D,qr,Wr,Xr.width,Xr.height,0,Hr,jr,Xr.data);Or.generateMipmaps=!1}else rr.texImage2D(rr.TEXTURE_2D,0,Wr,kr.width,kr.height,0,Hr,jr,kr.data);}else if(Or instanceof THREE.CompressedTexture)for(var qr=0,Kr=Yr.length;qr<Kr;qr++)Xr=Yr[qr],rr.compressedTexImage2D(rr.TEXTURE_2D,qr,Hr,Xr.width,Xr.height,0,Xr.data);else if(0<Yr.length&&Gr){for(var qr=0,Kr=Yr.length;qr<Kr;qr++)Xr=Yr[qr],rr.texImage2D(rr.TEXTURE_2D,qr,Wr,Hr,jr,Xr);Or.generateMipmaps=!1}else{var Qr='IMG'!=kr.tagName||kr.src&&kr.complete?kr:Ir;rr.texImage2D(rr.TEXTURE_2D,0,Wr,Hr,jr,Qr)}Or.generateMipmaps&&Gr&&rr.generateMipmap(rr.TEXTURE_2D),Or.needsUpdate=!1,Or.onUpdate&&Or.onUpdate()}else rr.activeTexture(rr.TEXTURE0+Br),rr.bindTexture(rr.TEXTURE_2D,Or.__webglTexture)};this.setRenderTarget=function(Or){var Br=Or instanceof THREE.WebGLRenderTargetCube;if(Or&&!Or.__webglFramebuffer){Or.depthBuffer===void 0&&(Or.depthBuffer=!0),Or.stencilBuffer===void 0&&(Or.stencilBuffer=!0),Or.addEventListener('dispose',Lr),Or.__webglTexture=rr.createTexture(),xt.info.memory.textures++;var kr=Ye(Or.width)&&Ye(Or.height),Gr=rt(Or.format),Hr=rt(Or.type),jr=MMD_SA.webgl2_RGBA_internal(rr,Gr,Hr);if(Br){Or.__webglFramebuffer=[],Or.__webglRenderbuffer=[],rr.bindTexture(rr.TEXTURE_CUBE_MAP,Or.__webglTexture),qe(rr.TEXTURE_CUBE_MAP,Or,kr);for(var Wr=0;6>Wr;Wr++)Or.__webglFramebuffer[Wr]=rr.createFramebuffer(),Or.__webglRenderbuffer[Wr]=rr.createRenderbuffer(),rr.texImage2D(rr.TEXTURE_CUBE_MAP_POSITIVE_X+Wr,0,jr,Or.width,Or.height,0,Gr,Hr,null),Je(Or.__webglFramebuffer[Wr],Or,rr.TEXTURE_CUBE_MAP_POSITIVE_X+Wr),$e(Or.__webglRenderbuffer[Wr],Or)}else{if(Or.__webglFramebuffer=rr.createFramebuffer(),Or._use_multisample){Or.__webglMSAAFramebuffer=rr.createFramebuffer(),Or.__webglMSAAColorbuffer=rr.createRenderbuffer(),rr.bindFramebuffer(rr.FRAMEBUFFER,Or.__webglMSAAFramebuffer);var Xr=rr.RGBA8;rr.bindRenderbuffer(rr.RENDERBUFFER,Or.__webglMSAAColorbuffer),rr.renderbufferStorageMultisample(rr.RENDERBUFFER,Or._use_multisample,Xr,Or.width,Or.height),rr.framebufferRenderbuffer(rr.FRAMEBUFFER,rr.COLOR_ATTACHMENT0,rr.RENDERBUFFER,Or.__webglMSAAColorbuffer),Or.depthBuffer&&(Or.__webglMSAADepthbuffer=rr.createRenderbuffer(),$e(Or.__webglMSAADepthbuffer,Or)),rr.bindFramebuffer(rr.FRAMEBUFFER,null)}if(rr.bindTexture(rr.TEXTURE_2D,Or.__webglTexture),qe(rr.TEXTURE_2D,Or,kr),rr.texImage2D(rr.TEXTURE_2D,0,jr,Or.width,Or.height,0,Gr,Hr,null),Je(Or.__webglFramebuffer,Or,rr.TEXTURE_2D),!Or._use_multisample)if(Or.__webglRenderbuffer=Or.shareDepthFrom?Or.shareDepthFrom.__webglRenderbuffer:rr.createRenderbuffer(),Or.shareDepthFrom)Or.depthBuffer&&!Or.stencilBuffer?rr.framebufferRenderbuffer(rr.FRAMEBUFFER,rr.DEPTH_ATTACHMENT,rr.RENDERBUFFER,Or.__webglRenderbuffer):Or.depthBuffer&&Or.stencilBuffer&&rr.framebufferRenderbuffer(rr.FRAMEBUFFER,rr.DEPTH_STENCIL_ATTACHMENT,rr.RENDERBUFFER,Or.__webglRenderbuffer);else{var Yr=Or._use_multisample;Or._use_multisample=null,$e(Or.__webglRenderbuffer,Or),Or._use_multisample=Yr}}Br?rr.bindTexture(rr.TEXTURE_CUBE_MAP,null):rr.bindTexture(rr.TEXTURE_2D,null),rr.bindRenderbuffer(rr.RENDERBUFFER,null),rr.bindFramebuffer(rr.FRAMEBUFFER,null)}var qr,Kr,Qr,Zr,Jr;Or?(qr=Br?Or.__webglFramebuffer[Or.activeCubeFace]:Or._use_multisample?Or.__webglMSAAFramebuffer:Or.__webglFramebuffer,Kr=Or.width,Qr=Or.height,Zr=0,Jr=0):(qr=null,Kr=Gt,Qr=Ht,Zr=Bt,Jr=kt),qr!==St&&(rr.bindFramebuffer(rr.FRAMEBUFFER,qr),rr.viewport(Zr,Jr,Kr,Qr),St=qr),jt=Kr,Wt=Qr};THREE.ShadowMapPlugin&&(this.shadowMapPlugin=new THREE.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin)),this.addPostPlugin(new THREE.SpritePlugin),THREE.LensFlarePlugin&&this.addPostPlugin(new THREE.LensFlarePlugin)},THREE.WebGLRenderTarget=function(_,S,M){this.width=_,this.height=S,M=M||{},this.wrapS=M.wrapS===void 0?THREE.ClampToEdgeWrapping:M.wrapS,this.wrapT=M.wrapT===void 0?THREE.ClampToEdgeWrapping:M.wrapT,this.magFilter=M.magFilter===void 0?THREE.LinearFilter:M.magFilter,this.minFilter=M.minFilter===void 0?THREE.LinearMipMapLinearFilter:M.minFilter,this.anisotropy=M.anisotropy===void 0?1:M.anisotropy,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.format=M.format===void 0?THREE.RGBAFormat:M.format,this.type=M.type===void 0?THREE.UnsignedByteType:M.type,this.depthBuffer=!(M.depthBuffer!==void 0)||M.depthBuffer,this.stencilBuffer=!(M.stencilBuffer!==void 0)||M.stencilBuffer,this.generateMipmaps=!0,this.shareDepthFrom=null},THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,clone:function(){var _=new THREE.WebGLRenderTarget(this.width,this.height);return _.wrapS=this.wrapS,_.wrapT=this.wrapT,_.magFilter=this.magFilter,_.minFilter=this.minFilter,_.anisotropy=this.anisotropy,_.offset.copy(this.offset),_.repeat.copy(this.repeat),_.format=this.format,_.type=this.type,_.depthBuffer=this.depthBuffer,_.stencilBuffer=this.stencilBuffer,_.generateMipmaps=this.generateMipmaps,_.shareDepthFrom=this.shareDepthFrom,_},dispose:function(){this.dispatchEvent({type:'dispose'})}},THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype),THREE.WebGLRenderTargetCube=function(_,S,M){THREE.WebGLRenderTarget.call(this,_,S,M),this.activeCubeFace=0},THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype),THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(_){this.positionWorld.copy(_.positionWorld),this.positionScreen.copy(_.positionScreen)},THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.centroidModel=new THREE.Vector3,this.normalModel=new THREE.Vector3,this.normalModelView=new THREE.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsModelView=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.color=null,this.material=null,this.uvs=[[]],this.z=null},THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.v4=new THREE.RenderableVertex,this.centroidModel=new THREE.Vector3,this.normalModel=new THREE.Vector3,this.normalModelView=new THREE.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsModelView=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.color=null,this.material=null,this.uvs=[[]],this.z=null},THREE.RenderableObject=function(){this.object=null,this.z=null},THREE.RenderableParticle=function(){this.object=null,this.x=null,this.y=null,this.z=null,this.rotation=null,this.scale=new THREE.Vector2,this.material=null},THREE.RenderableLine=function(){this.z=null,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null},THREE.GeometryUtils={merge:function(_,S,M){var C=_.vertices.length,E=_.faceVertexUvs[0].length,D=S instanceof THREE.Mesh?S.geometry:S,P=_.vertices,R=D.vertices,L=_.faces,N=D.faces,U=_.faceVertexUvs[0],F=D.faceVertexUvs[0],T,A;M===void 0&&(M=0),S instanceof THREE.Mesh&&(S.matrixAutoUpdate&&S.updateMatrix(),T=S.matrix,A=new THREE.Matrix3().getNormalMatrix(T));for(var V=0,I=R.length;V<I;V++){var O=R[V],B=O.clone();T&&B.applyMatrix4(T),P.push(B)}for(V=0,I=N.length;V<I;V++){var G=N[V],Y=G.vertexNormals,K=G.vertexColors,H,W,X;G instanceof THREE.Face3?H=new THREE.Face3(G.a+C,G.b+C,G.c+C):G instanceof THREE.Face4&&(H=new THREE.Face4(G.a+C,G.b+C,G.c+C,G.d+C)),H.normal.copy(G.normal),A&&H.normal.applyMatrix3(A).normalize();for(var Q=0,Z=Y.length;Q<Z;Q++)W=Y[Q].clone(),A&&W.applyMatrix3(A).normalize(),H.vertexNormals.push(W);H.color.copy(G.color);for(var Q=0,Z=K.length;Q<Z;Q++)X=K[Q],H.vertexColors.push(X.clone());H.materialIndex=G.materialIndex+M,H.centroid.copy(G.centroid),T&&H.centroid.applyMatrix4(T),L.push(H)}for(V=0,I=F.length;V<I;V++){for(var J=F[V],ee=[],Q=0,Z=J.length;Q<Z;Q++)ee.push(new THREE.Vector2(J[Q].x,J[Q].y));U.push(ee)}},removeMaterials:function(_,S){for(var M={},T=0,A=S.length;T<A;T++)M[S[T]]=!0;for(var E=[],T=0,A=_.faces.length,C;T<A;T++)C=_.faces[T],C.materialIndex in M||E.push(C);_.faces=E},randomPointInTriangle:function(_,S,M){var E=new THREE.Vector3,D=THREE.GeometryUtils.__v1,T,A,C;return T=THREE.GeometryUtils.random(),A=THREE.GeometryUtils.random(),1<T+A&&(T=1-T,A=1-A),C=1-T-A,E.copy(_),E.multiplyScalar(T),D.copy(S),D.multiplyScalar(A),E.add(D),D.copy(M),D.multiplyScalar(C),E.add(D),E},randomPointInFace:function(_,S,M){var T,A,C,E;if(_ instanceof THREE.Face3)return T=S.vertices[_.a],A=S.vertices[_.b],C=S.vertices[_.c],THREE.GeometryUtils.randomPointInTriangle(T,A,C);if(_ instanceof THREE.Face4){T=S.vertices[_.a],A=S.vertices[_.b],C=S.vertices[_.c],E=S.vertices[_.d];var D,P;M?_._area1&&_._area2?(D=_._area1,P=_._area2):(D=THREE.GeometryUtils.triangleArea(T,A,E),P=THREE.GeometryUtils.triangleArea(A,C,E),_._area1=D,_._area2=P):(D=THREE.GeometryUtils.triangleArea(T,A,E),P=THREE.GeometryUtils.triangleArea(A,C,E));var R=THREE.GeometryUtils.random()*(D+P);return R<D?THREE.GeometryUtils.randomPointInTriangle(T,A,E):THREE.GeometryUtils.randomPointInTriangle(A,C,E)}},randomPointsInGeometry:function(_,S){function M(G){function H(W,X){if(X<W)return W;var Y=W+Math.floor((X-W)/2);return R[Y]>G?H(W,Y-1):R[Y]<G?H(Y+1,X):Y}return H(0,R.length-1)}var C=_.faces,E=_.vertices,D=C.length,P=0,R=[],T,A,L,N,U,F;for(A=0;A<D;A++)T=C[A],T instanceof THREE.Face3?(L=E[T.a],N=E[T.b],U=E[T.c],T._area=THREE.GeometryUtils.triangleArea(L,N,U)):T instanceof THREE.Face4&&(L=E[T.a],N=E[T.b],U=E[T.c],F=E[T.d],T._area1=THREE.GeometryUtils.triangleArea(L,N,F),T._area2=THREE.GeometryUtils.triangleArea(N,U,F),T._area=T._area1+T._area2),P+=T._area,R[A]=P;var O=[],V,I,B={};for(A=0;A<S;A++)V=THREE.GeometryUtils.random()*P,I=M(V),O[A]=THREE.GeometryUtils.randomPointInFace(C[I],_,!0),B[I]?B[I]+=1:B[I]=1;return O},triangleArea:function(_,S,M){var T=THREE.GeometryUtils.__v1,A=THREE.GeometryUtils.__v2;return T.subVectors(S,_),A.subVectors(M,_),T.cross(A),0.5*T.length()},center:function(_){_.computeBoundingBox();var S=_.boundingBox,M=new THREE.Vector3;return M.addVectors(S.min,S.max),M.multiplyScalar(-0.5),_.applyMatrix(new THREE.Matrix4().makeTranslation(M.x,M.y,M.z)),_.computeBoundingBox(),M},normalizeUVs:function(_){for(var S=_.faceVertexUvs[0],M=0,T=S.length,A;M<T;M++){A=S[M];for(var C=0,E=A.length;C<E;C++)1!==A[C].x&&(A[C].x-=Math.floor(A[C].x)),1!==A[C].y&&(A[C].y-=Math.floor(A[C].y))}},triangulateQuads:function(_){var S,M,T,A,C=[],E=[],D=[];for(S=0,M=_.faceUvs.length;S<M;S++)E[S]=[];for(S=0,M=_.faceVertexUvs.length;S<M;S++)D[S]=[];for(S=0,M=_.faces.length;S<M;S++){var P=_.faces[S];if(P instanceof THREE.Face4){var R=P.a,L=P.b,N=P.c,U=P.d,F=new THREE.Face3,V=new THREE.Face3;for(F.color.copy(P.color),V.color.copy(P.color),F.materialIndex=P.materialIndex,V.materialIndex=P.materialIndex,F.a=R,F.b=L,F.c=U,V.a=L,V.b=N,V.c=U,4===P.vertexColors.length&&(F.vertexColors[0]=P.vertexColors[0].clone(),F.vertexColors[1]=P.vertexColors[1].clone(),F.vertexColors[2]=P.vertexColors[3].clone(),V.vertexColors[0]=P.vertexColors[1].clone(),V.vertexColors[1]=P.vertexColors[2].clone(),V.vertexColors[2]=P.vertexColors[3].clone()),C.push(F,V),(T=0,A=_.faceVertexUvs.length);T<A;T++)if(_.faceVertexUvs[T].length){var I=_.faceVertexUvs[T][S],O=I[0],B=I[1],G=I[2],H=I[3],W=[O.clone(),B.clone(),H.clone()],X=[B.clone(),G.clone(),H.clone()];D[T].push(W,X)}for(T=0,A=_.faceUvs.length;T<A;T++)if(_.faceUvs[T].length){var Y=_.faceUvs[T][S];E[T].push(Y,Y)}}else{for(C.push(P),T=0,A=_.faceUvs.length;T<A;T++)E[T].push(_.faceUvs[T][S]);for(T=0,A=_.faceVertexUvs.length;T<A;T++)D[T].push(_.faceVertexUvs[T][S])}}_.faces=C,_.faceUvs=E,_.faceVertexUvs=D,_.computeCentroids(),_.computeFaceNormals(),_.computeVertexNormals(),_.hasTangents&&_.computeTangents()},setMaterialIndex:function(_,S,M,T){for(var A=_.faces,E=T||A.length-1,D=M||0;D<=E;D++)A[D].materialIndex=S}},THREE.GeometryUtils.random=THREE.Math.random16,THREE.GeometryUtils.__v1=new THREE.Vector3,THREE.GeometryUtils.__v2=new THREE.Vector3,THREE.ImageUtils={loadTexture:function(_,S,M,T){var A=new Image,C=new THREE.Texture(A,S),E=new THREE.ImageLoader;return E.addEventListener('load',function(D){C.image=D.content,C.needsUpdate=!0,M&&M(C)}),E.addEventListener('error',function(D){T&&T(D.message)}),E.load(_,A),C.sourceFile=_,C},loadCompressedTexture:function(_,S,M,T){var A=new THREE.CompressedTexture;A.mapping=S;var C=new XMLHttpRequestZIP;return C.onload=function(){var E=C.response,D=THREE.ImageUtils.parseDDS(E,!0);A.format=D.format,A.mipmaps=D.mipmaps,A.image.width=D.width,A.image.height=D.height,A.generateMipmaps=!1,A.needsUpdate=!0,M&&M(A)},C.onerror=T,C.open('GET',_,!0),C.responseType='arraybuffer',C.send(null),A},loadTextureCube:function(_,S,M,T){var A=[];A.loadCount=0;var C=new THREE.Texture;C.image=A,S!==void 0&&(C.mapping=S),C.flipY=!1;for(var E=0,D=_.length,P;E<D;++E)P=new Image,A[E]=P,P.onload=function(){A.loadCount+=1,6===A.loadCount&&(C.needsUpdate=!0,M&&M(C))},P.onerror=T,/^data:image/.test(_[E])||/^(tga|TGA)/.test(_[E].split('.').pop())||(P.crossOrigin='anonymous'),P.src=_[E];return C},loadCompressedTextureCube:function(_,S,M,T){var A=[];A.loadCount=0;var C=new THREE.CompressedTexture;C.image=A,S!==void 0&&(C.mapping=S),C.flipY=!1,C.generateMipmaps=!1;var E=function(U,F){return function(){var V=U.response,I=THREE.ImageUtils.parseDDS(V,!0);F.format=I.format,F.mipmaps=I.mipmaps,F.width=I.width,F.height=I.height,A.loadCount+=1,6===A.loadCount&&(C.format=I.format,C.needsUpdate=!0,M&&M(C))}};if(_ instanceof Array)for(var D=0,P=_.length,R;D<P;++D){R={},A[D]=R;var L=new XMLHttpRequestZIP;L.onload=E(L,R),L.onerror=T;var N=_[D];L.open('GET',N,!0),L.responseType='arraybuffer',L.send(null)}else{var N=_,L=new XMLHttpRequestZIP;L.onload=function(){var U=L.response,F=THREE.ImageUtils.parseDDS(U,!0);if(F.isCubemap){for(var V=F.mipmaps.length/F.mipmapCount,I=0;I<V;I++){A[I]={mipmaps:[]};for(var O=0;O<F.mipmapCount;O++)A[I].mipmaps.push(F.mipmaps[I*F.mipmapCount+O]),A[I].format=F.format,A[I].width=F.width,A[I].height=F.height}C.format=F.format,C.needsUpdate=!0,M&&M(C)}},L.onerror=T,L.open('GET',N,!0),L.responseType='arraybuffer',L.send(null)}return C},parseDDS:function(_,S){function M(Ie){return Ie.charCodeAt(0)+(Ie.charCodeAt(1)<<8)+(Ie.charCodeAt(2)<<16)+(Ie.charCodeAt(3)<<24)}function T(Ie){return String.fromCharCode(255&Ie,255&Ie>>8,255&Ie>>16,255&Ie>>24)}var A={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},ne=M('DXT1'),se=M('DXT3'),le=M('DXT5'),we=new Int32Array(_,0,31);if(we[0]!==542327876)return console.error('ImageUtils.parseDDS(): Invalid magic number in DDS header'),A;if(!we[20]&4)return console.error('ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code'),A;var Ce,Ee=we[21];switch(Ee){case ne:Ce=8,A.format=THREE.RGB_S3TC_DXT1_Format;break;case se:Ce=16,A.format=THREE.RGBA_S3TC_DXT3_Format;break;case le:Ce=16,A.format=THREE.RGBA_S3TC_DXT5_Format;break;default:return console.error('ImageUtils.parseDDS(): Unsupported FourCC code: ',T(Ee)),A;}A.mipmapCount=1,we[2]&131072&&!1!==S&&(A.mipmapCount=Math.max(1,we[7])),A.isCubemap=!!(we[28]&512),A.width=we[4],A.height=we[3];for(var De=we[1]+4,Pe=A.width,Re=A.height,Le=A.isCubemap?6:1,Ne=0;Ne<Le;Ne++){for(var Ue=0;Ue<A.mipmapCount;Ue++){var Fe=Math.max(4,Pe)/4*Math.max(4,Re)/4*Ce,ze=new Uint8Array(_,De,Fe),Ve={data:ze,width:Pe,height:Re};A.mipmaps.push(Ve),De+=Fe,Pe=Math.max(0.5*Pe,1),Re=Math.max(0.5*Re,1)}Pe=A.width,Re=A.height}return A},getNormalMap:function(_,S){var M=function(ee,re){return[ee[1]*re[2]-ee[2]*re[1],ee[2]*re[0]-ee[0]*re[2],ee[0]*re[1]-ee[1]*re[0]]},T=function(ee,re){return[ee[0]-re[0],ee[1]-re[1],ee[2]-re[2]]},A=function(ee){var re=Math.sqrt(ee[0]*ee[0]+ee[1]*ee[1]+ee[2]*ee[2]);return[ee[0]/re,ee[1]/re,ee[2]/re]};S|=1;var C=_.width,E=_.height,D=document.createElement('canvas');D.width=C,D.height=E;var P=D.getContext('2d');P.drawImage(_,0,0);for(var R=P.getImageData(0,0,C,E).data,L=P.createImageData(C,E),N=L.data,U=0;U<C;U++)for(var F=0;F<E;F++){var V=0>F-1?0:F-1,I=F+1>E-1?E-1:F+1,O=0>U-1?0:U-1,B=U+1>C-1?C-1:U+1,G=[],H=[0,0,R[4*(F*C+U)]/255*S];G.push([-1,0,R[4*(F*C+O)]/255*S]),G.push([-1,-1,R[4*(V*C+O)]/255*S]),G.push([0,-1,R[4*(V*C+U)]/255*S]),G.push([1,-1,R[4*(V*C+B)]/255*S]),G.push([1,0,R[4*(F*C+B)]/255*S]),G.push([1,1,R[4*(I*C+B)]/255*S]),G.push([0,1,R[4*(I*C+U)]/255*S]),G.push([-1,1,R[4*(I*C+O)]/255*S]);for(var W=[],X=G.length,Y=0;Y<X;Y++){var K=G[Y],Q=G[(Y+1)%X];K=T(K,H),Q=T(Q,H),W.push(A(M(K,Q)))}for(var Z=[0,0,0],Y=0;Y<W.length;Y++)Z[0]+=W[Y][0],Z[1]+=W[Y][1],Z[2]+=W[Y][2];Z[0]/=W.length,Z[1]/=W.length,Z[2]/=W.length;var J=4*(F*C+U);N[J]=0|255*((Z[0]+1)/2),N[J+1]=0|255*((Z[1]+1)/2),N[J+2]=0|255*Z[2],N[J+3]=255}return P.putImageData(L,0,0),D},generateDataTexture:function(_,S,M){for(var T=_*S,A=new Uint8Array(3*T),C=Math.floor(255*M.r),E=Math.floor(255*M.g),D=Math.floor(255*M.b),P=0;P<T;P++)A[3*P]=C,A[3*P+1]=E,A[3*P+2]=D;var R=new THREE.DataTexture(A,_,S,THREE.RGBFormat);return R.needsUpdate=!0,R}},THREE.SceneUtils={createMultiMaterialObject:function(_,S){for(var M=new THREE.Object3D,T=0,A=S.length;T<A;T++)M.add(new THREE.Mesh(_,S[T]));return M},detach:function(_,S,M){_.applyMatrix(S.matrixWorld),S.remove(_),M.add(_)},attach:function(_,S,M){var T=new THREE.Matrix4;T.getInverse(M.matrixWorld),_.applyMatrix(T),S.remove(_),M.add(_)}},THREE.FontUtils={faces:{},face:'helvetiker',weight:'normal',style:'normal',size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(_){var S=_.familyName.toLowerCase(),M=this;M.faces[S]=M.faces[S]||{},M.faces[S][_.cssFontWeight]=M.faces[S][_.cssFontWeight]||{},M.faces[S][_.cssFontWeight][_.cssFontStyle]=_;M.faces[S][_.cssFontWeight][_.cssFontStyle]=_;return _},drawText:function(_){var T,C=this.getFace(),E=this.size/C.resolution,D=0,P=(_+'').split(''),R=P.length,L=[];for(T=0;T<R;T++){var N=new THREE.Path,U=this.extractGlyphPoints(P[T],C,E,D,N);D+=U.offset,L.push(U.path)}var F=D/2;return{paths:L,offset:F}},extractGlyphPoints:function(_,S,M,T,A){var C=[],E,D,P,R,L,N,U,F,V,I,O,B,G,H,W,X,Y,K,Q,Z=S.glyphs[_]||S.glyphs['?'];if(Z){if(Z.o)for(R=Z._cachedOutline||(Z._cachedOutline=Z.o.split(' ')),N=R.length,U=M,F=M,E=0;E<N;)switch(L=R[E++],L){case'm':V=R[E++]*U+T,I=R[E++]*F,A.moveTo(V,I);break;case'l':V=R[E++]*U+T,I=R[E++]*F,A.lineTo(V,I);break;case'q':if(O=R[E++]*U+T,B=R[E++]*F,W=R[E++]*U+T,X=R[E++]*F,A.quadraticCurveTo(W,X,O,B),Q=C[C.length-1],Q)for(G=Q.x,H=Q.y,(D=1,P=this.divisions);D<=P;D++)var J=D/P,ee=THREE.Shape.Utils.b2(J,G,W,O),re=THREE.Shape.Utils.b2(J,H,X,B);break;case'b':if(O=R[E++]*U+T,B=R[E++]*F,W=R[E++]*U+T,X=R[E++]*-F,Y=R[E++]*U+T,K=R[E++]*-F,A.bezierCurveTo(O,B,W,X,Y,K),Q=C[C.length-1],Q)for(G=Q.x,H=Q.y,(D=1,P=this.divisions);D<=P;D++)var J=D/P,ee=THREE.Shape.Utils.b3(J,G,W,Y,O),re=THREE.Shape.Utils.b3(J,H,X,K,B);}return{offset:Z.ha*M,path:A}}}},THREE.FontUtils.generateShapes=function(_,S){S=S||{};var M=S.size===void 0?100:S.size,T=S.curveSegments===void 0?4:S.curveSegments,A=S.font===void 0?'helvetiker':S.font,C=S.weight===void 0?'normal':S.weight,E=S.style===void 0?'normal':S.style;THREE.FontUtils.size=M,THREE.FontUtils.divisions=T,THREE.FontUtils.face=A,THREE.FontUtils.weight=C,THREE.FontUtils.style=E;for(var D=THREE.FontUtils.drawText(_),P=D.paths,R=[],L=0,N=P.length;L<N;L++)Array.prototype.push.apply(R,P[L].toShapes());return R},function(_){var T=function(C){for(var E=C.length,D=0,P=E-1,R=0;R<E;P=R++)D+=C[P].x*C[R].y-C[R].x*C[P].y;return 0.5*D},A=function(C,E,D,P,R,L){var N,U,F,V,I,O,B,G,H;if(U=C[L[E]].x,F=C[L[E]].y,V=C[L[D]].x,I=C[L[D]].y,O=C[L[P]].x,B=C[L[P]].y,1e-10>(V-U)*(B-F)-(I-F)*(O-U))return!1;var W,X,Y,K,Q,Z,J,ee,re,oe,ie,ne,se,le,pe;for(W=O-V,X=B-I,Y=U-O,K=F-B,Q=V-U,Z=I-F,N=0;N<R;N++)if(N!==E&&N!==D&&N!==P&&(G=C[L[N]].x,H=C[L[N]].y,J=G-U,ee=H-F,re=G-V,oe=H-I,ie=G-O,ne=H-B,pe=W*oe-X*re,se=Q*ee-Z*J,le=Y*ne-K*ie,0<=pe&&0<=le&&0<=se))return!1;return!0};return _.Triangulate=function(C,E){var D=C.length;if(3>D)return null;var P=[],R=[],L=[],N,U,F;if(0<T(C))for(U=0;U<D;U++)R[U]=U;else for(U=0;U<D;U++)R[U]=D-1-U;var V=D,I=2*V;for(U=V-1;2<V;){if(0>=I--)return console.log('Warning, unable to triangulate polygon!'),E?L:P;if(N=U,V<=N&&(N=0),U=N+1,V<=U&&(U=0),F=U+1,V<=F&&(F=0),A(C,N,U,F,V,R)){var O,B,G,H,W;for(O=R[N],B=R[U],G=R[F],P.push([C[O],C[B],C[G]]),L.push([R[N],R[U],R[F]]),(H=U,W=U+1);W<V;H++,W++)R[H]=R[W];V--,I=2*V}}return E?L:P},_.Triangulate.area=T,_}(THREE.FontUtils),self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace},THREE.typeface_js=self._typeface_js,THREE.Curve=function(){},THREE.Curve.prototype.getPointAt=function(_){var S=this.getUtoTmapping(_);return this.getPoint(S)},THREE.Curve.prototype.getPoints=function(_){_||(_=5);var M=[],S;for(S=0;S<=_;S++)M.push(this.getPoint(S/_));return M},THREE.Curve.prototype.getSpacedPoints=function(_){_||(_=5);var M=[],S;for(S=0;S<=_;S++)M.push(this.getPointAt(S/_));return M},THREE.Curve.prototype.getLength=function(){var _=this.getLengths();return _[_.length-1]},THREE.Curve.prototype.getLengths=function(_){if(_||(_=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==_+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var S=[],T=this.getPoint(0),C=0,M,A;for(S.push(0),A=1;A<=_;A++)M=this.getPoint(A/_),C+=M.distanceTo(T),S.push(C),T=M;return this.cacheArcLengths=S,S},THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},THREE.Curve.prototype.getUtoTmapping=function(_,S){var M=this.getLengths(),T=0,A=M.length,C;C=S?S:_*M[A-1];for(var E=0,D=A-1,P;E<=D;)if(T=Math.floor(E+(D-E)/2),P=M[T]-C,0>P){E=T+1;continue}else if(0<P){D=T-1;continue}else{D=T;break}if(T=D,M[T]==C){var R=T/(A-1);return R}var L=M[T],N=M[T+1],F=(C-L)/(N-L),R=(T+F)/(A-1);return R},THREE.Curve.prototype.getTangent=function(_){var S=1e-4,M=_-S,T=_+S;0>M&&(M=0),1<T&&(T=1);var A=this.getPoint(M),C=this.getPoint(T),E=C.clone().sub(A);return E.normalize()},THREE.Curve.prototype.getTangentAt=function(_){var S=this.getUtoTmapping(_);return this.getTangent(S)},THREE.LineCurve=function(_,S){this.v1=_,this.v2=S},THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.LineCurve.prototype.getPoint=function(_){var S=this.v2.clone().sub(this.v1);return S.multiplyScalar(_).add(this.v1),S},THREE.LineCurve.prototype.getPointAt=function(_){return this.getPoint(_)},THREE.LineCurve.prototype.getTangent=function(){var S=this.v2.clone().sub(this.v1);return S.normalize()},THREE.QuadraticBezierCurve=function(_,S,M){this.v0=_,this.v1=S,this.v2=M},THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.QuadraticBezierCurve.prototype.getPoint=function(_){var S,M;return S=THREE.Shape.Utils.b2(_,this.v0.x,this.v1.x,this.v2.x),M=THREE.Shape.Utils.b2(_,this.v0.y,this.v1.y,this.v2.y),new THREE.Vector2(S,M)},THREE.QuadraticBezierCurve.prototype.getTangent=function(_){var S,M;S=THREE.Curve.Utils.tangentQuadraticBezier(_,this.v0.x,this.v1.x,this.v2.x),M=THREE.Curve.Utils.tangentQuadraticBezier(_,this.v0.y,this.v1.y,this.v2.y);var T=new THREE.Vector2(S,M);return T.normalize(),T},THREE.CubicBezierCurve=function(_,S,M,T){this.v0=_,this.v1=S,this.v2=M,this.v3=T},THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.CubicBezierCurve.prototype.getPoint=function(_){var S,M;return S=THREE.Shape.Utils.b3(_,this.v0.x,this.v1.x,this.v2.x,this.v3.x),M=THREE.Shape.Utils.b3(_,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new THREE.Vector2(S,M)},THREE.CubicBezierCurve.prototype.getTangent=function(_){var S,M;S=THREE.Curve.Utils.tangentCubicBezier(_,this.v0.x,this.v1.x,this.v2.x,this.v3.x),M=THREE.Curve.Utils.tangentCubicBezier(_,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var T=new THREE.Vector2(S,M);return T.normalize(),T},THREE.SplineCurve=function(_){this.points=_==void 0?[]:_},THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.SplineCurve.prototype.getPoint=function(_){var S=new THREE.Vector2,M=[],T=this.points,A,C,E;return A=(T.length-1)*_,C=Math.floor(A),E=A-C,M[0]=0==C?C:C-1,M[1]=C,M[2]=C>T.length-2?T.length-1:C+1,M[3]=C>T.length-3?T.length-1:C+2,S.x=THREE.Curve.Utils.interpolate(T[M[0]].x,T[M[1]].x,T[M[2]].x,T[M[3]].x,E),S.y=THREE.Curve.Utils.interpolate(T[M[0]].y,T[M[1]].y,T[M[2]].y,T[M[3]].y,E),S},THREE.EllipseCurve=function(_,S,M,T,A,C,E){this.aX=_,this.aY=S,this.xRadius=M,this.yRadius=T,this.aStartAngle=A,this.aEndAngle=C,this.aClockwise=E},THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype),THREE.EllipseCurve.prototype.getPoint=function(_){var S=this.aEndAngle-this.aStartAngle;this.aClockwise||(_=1-_);var M=this.aStartAngle+_*S,T=this.aX+this.xRadius*Math.cos(M),A=this.aY+this.yRadius*Math.sin(M);return new THREE.Vector2(T,A)},THREE.ArcCurve=function(_,S,M,T,A,C){THREE.EllipseCurve.call(this,_,S,M,M,T,A,C)},THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype),THREE.Curve.Utils={tangentQuadraticBezier:function(_,S,M,T){return 2*(1-_)*(M-S)+2*_*(T-M)},tangentCubicBezier:function(_,S,M,T,A){return-3*S*(1-_)*(1-_)+3*M*(1-_)*(1-_)-6*_*M*(1-_)+6*_*T*(1-_)-3*_*_*T+3*_*_*A},tangentSpline:function(_){return 6*_*_-6*_+(3*_*_-4*_+1)+(-6*_*_+6*_)+(3*_*_-2*_)},interpolate:function(_,S,M,T,A){var C=0.5*(M-_),E=0.5*(T-S),D=A*A;return(2*S-2*M+C+E)*(A*D)+(-3*S+3*M-2*C-E)*D+C*A+S}},THREE.Curve.create=function(_,S){return _.prototype=Object.create(THREE.Curve.prototype),_.prototype.getPoint=S,_},THREE.LineCurve3=THREE.Curve.create(function(_,S){this.v1=_,this.v2=S},function(_){var S=new THREE.Vector3;return S.subVectors(this.v2,this.v1),S.multiplyScalar(_),S.add(this.v1),S}),THREE.QuadraticBezierCurve3=THREE.Curve.create(function(_,S,M){this.v0=_,this.v1=S,this.v2=M},function(_){var S,M,T;return S=THREE.Shape.Utils.b2(_,this.v0.x,this.v1.x,this.v2.x),M=THREE.Shape.Utils.b2(_,this.v0.y,this.v1.y,this.v2.y),T=THREE.Shape.Utils.b2(_,this.v0.z,this.v1.z,this.v2.z),new THREE.Vector3(S,M,T)}),THREE.CubicBezierCurve3=THREE.Curve.create(function(_,S,M,T){this.v0=_,this.v1=S,this.v2=M,this.v3=T},function(_){var S,M,T;return S=THREE.Shape.Utils.b3(_,this.v0.x,this.v1.x,this.v2.x,this.v3.x),M=THREE.Shape.Utils.b3(_,this.v0.y,this.v1.y,this.v2.y,this.v3.y),T=THREE.Shape.Utils.b3(_,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new THREE.Vector3(S,M,T)}),THREE.SplineCurve3=THREE.Curve.create(function(_){this.points=_==void 0?[]:_},function(_){var S=new THREE.Vector3,M=[],T=this.points,A,C,E;A=(T.length-1)*_,C=Math.floor(A),E=A-C,M[0]=0==C?C:C-1,M[1]=C,M[2]=C>T.length-2?T.length-1:C+1,M[3]=C>T.length-3?T.length-1:C+2;var D=T[M[0]],P=T[M[1]],R=T[M[2]],L=T[M[3]];return S.x=THREE.Curve.Utils.interpolate(D.x,P.x,R.x,L.x,E),S.y=THREE.Curve.Utils.interpolate(D.y,P.y,R.y,L.y,E),S.z=THREE.Curve.Utils.interpolate(D.z,P.z,R.z,L.z,E),S}),THREE.ClosedSplineCurve3=THREE.Curve.create(function(_){this.points=_==void 0?[]:_},function(_){var S=new THREE.Vector3,M=[],T=this.points,A,C,E;return A=(T.length-0)*_,C=Math.floor(A),E=A-C,C+=0<C?0:(Math.floor(Math.abs(C)/T.length)+1)*T.length,M[0]=(C-1)%T.length,M[1]=C%T.length,M[2]=(C+1)%T.length,M[3]=(C+2)%T.length,S.x=THREE.Curve.Utils.interpolate(T[M[0]].x,T[M[1]].x,T[M[2]].x,T[M[3]].x,E),S.y=THREE.Curve.Utils.interpolate(T[M[0]].y,T[M[1]].y,T[M[2]].y,T[M[3]].y,E),S.z=THREE.Curve.Utils.interpolate(T[M[0]].z,T[M[1]].z,T[M[2]].z,T[M[3]].z,E),S}),THREE.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype),THREE.CurvePath.prototype.add=function(_){this.curves.push(_)},THREE.CurvePath.prototype.closePath=function(){var _=this.curves[0].getPoint(0),S=this.curves[this.curves.length-1].getPoint(1);_.equals(S)||this.curves.push(new THREE.LineCurve(S,_))},THREE.CurvePath.prototype.getPoint=function(_){for(var S=_*this.getLength(),M=this.getCurveLengths(),T=0,A,C;T<M.length;){if(M[T]>=S){A=M[T]-S,C=this.curves[T];var E=1-A/C.getLength();return C.getPointAt(E)}T++}return null},THREE.CurvePath.prototype.getLength=function(){var _=this.getCurveLengths();return _[_.length-1]},THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var _=[],S=0,T=this.curves.length,M;for(M=0;M<T;M++)S+=this.curves[M].getLength(),_.push(S);return this.cacheLengths=_,_},THREE.CurvePath.prototype.getBoundingBox=function(){var _=this.getPoints(),S,M,T,A,C,E;S=M=Number.NEGATIVE_INFINITY,A=C=Number.POSITIVE_INFINITY;var N=_[0]instanceof THREE.Vector3,D,P,R,L;for(L=N?new THREE.Vector3:new THREE.Vector2,P=0,R=_.length;P<R;P++)D=_[P],D.x>S?S=D.x:D.x<A&&(A=D.x),D.y>M?M=D.y:D.y<C&&(C=D.y),N&&(D.z>T?T=D.z:D.z<E&&(E=D.z)),L.add(D);var U={minX:A,minY:C,maxX:S,maxY:M,centroid:L.divideScalar(R)};return N&&(U.maxZ=T,U.minZ=E),U},THREE.CurvePath.prototype.createPointsGeometry=function(_){var S=this.getPoints(_,!0);return this.createGeometry(S)},THREE.CurvePath.prototype.createSpacedPointsGeometry=function(_){var S=this.getSpacedPoints(_,!0);return this.createGeometry(S)},THREE.CurvePath.prototype.createGeometry=function(_){for(var S=new THREE.Geometry,M=0;M<_.length;M++)S.vertices.push(new THREE.Vector3(_[M].x,_[M].y,_[M].z||0));return S},THREE.CurvePath.prototype.addWrapPath=function(_){this.bends.push(_)},THREE.CurvePath.prototype.getTransformedPoints=function(_,S){var M=this.getPoints(_),T,A;for(S||(S=this.bends),T=0,A=S.length;T<A;T++)M=this.getWrapPoints(M,S[T]);return M},THREE.CurvePath.prototype.getTransformedSpacedPoints=function(_,S){var M=this.getSpacedPoints(_),T,A;for(S||(S=this.bends),T=0,A=S.length;T<A;T++)M=this.getWrapPoints(M,S[T]);return M},THREE.CurvePath.prototype.getWrapPoints=function(_,S){var M=this.getBoundingBox(),T,A,C,E,D,P;for(T=0,A=_.length;T<A;T++){C=_[T],E=C.x,D=C.y,P=E/M.maxX,P=S.getUtoTmapping(P,E);var R=S.getPoint(P),L=S.getNormalVector(P).multiplyScalar(D);C.x=R.x+L.x,C.y=R.y+L.y}return _},THREE.Gyroscope=function(){THREE.Object3D.call(this)},THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype),THREE.Gyroscope.prototype.updateMatrixWorld=function(_){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||_)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject),this.matrixWorld.makeFromPositionQuaternionScale(this.translationWorld,this.rotationObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,_=!0);for(var S=0,M=this.children.length;S<M;S++)this.children[S].updateMatrixWorld(_)},THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3,THREE.Gyroscope.prototype.translationObject=new THREE.Vector3,THREE.Gyroscope.prototype.rotationWorld=new THREE.Quaternion,THREE.Gyroscope.prototype.rotationObject=new THREE.Quaternion,THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3,THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3,THREE.Path=function(_){THREE.CurvePath.call(this),this.actions=[],_&&this.fromPoints(_)},THREE.Path.prototype=Object.create(THREE.CurvePath.prototype),THREE.PathActions={MOVE_TO:'moveTo',LINE_TO:'lineTo',QUADRATIC_CURVE_TO:'quadraticCurveTo',BEZIER_CURVE_TO:'bezierCurveTo',CSPLINE_THRU:'splineThru',ARC:'arc',ELLIPSE:'ellipse'},THREE.Path.prototype.fromPoints=function(_){this.moveTo(_[0].x,_[0].y);for(var S=1,M=_.length;S<M;S++)this.lineTo(_[S].x,_[S].y)},THREE.Path.prototype.moveTo=function(){var M=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:M})},THREE.Path.prototype.lineTo=function(_,S){var M=Array.prototype.slice.call(arguments),T=this.actions[this.actions.length-1].args,A=T[T.length-2],C=T[T.length-1],E=new THREE.LineCurve(new THREE.Vector2(A,C),new THREE.Vector2(_,S));this.curves.push(E),this.actions.push({action:THREE.PathActions.LINE_TO,args:M})},THREE.Path.prototype.quadraticCurveTo=function(_,S,M,T){var A=Array.prototype.slice.call(arguments),C=this.actions[this.actions.length-1].args,E=C[C.length-2],D=C[C.length-1],P=new THREE.QuadraticBezierCurve(new THREE.Vector2(E,D),new THREE.Vector2(_,S),new THREE.Vector2(M,T));this.curves.push(P),this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:A})},THREE.Path.prototype.bezierCurveTo=function(_,S,M,T,A,C){var E=Array.prototype.slice.call(arguments),D=this.actions[this.actions.length-1].args,P=D[D.length-2],R=D[D.length-1],L=new THREE.CubicBezierCurve(new THREE.Vector2(P,R),new THREE.Vector2(_,S),new THREE.Vector2(M,T),new THREE.Vector2(A,C));this.curves.push(L),this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:E})},THREE.Path.prototype.splineThru=function(_){var S=Array.prototype.slice.call(arguments),M=this.actions[this.actions.length-1].args,T=M[M.length-2],A=M[M.length-1],C=[new THREE.Vector2(T,A)];Array.prototype.push.apply(C,_);var E=new THREE.SplineCurve(C);this.curves.push(E),this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:S})},THREE.Path.prototype.arc=function(_,S,M,T,A,C){var E=this.actions[this.actions.length-1].args,D=E[E.length-2],P=E[E.length-1];this.absarc(_+D,S+P,M,T,A,C)},THREE.Path.prototype.absarc=function(_,S,M,T,A,C){this.absellipse(_,S,M,M,T,A,C)},THREE.Path.prototype.ellipse=function(_,S,M,T,A,C,E){var D=this.actions[this.actions.length-1].args,P=D[D.length-2],R=D[D.length-1];this.absellipse(_+P,S+R,M,T,A,C,E)},THREE.Path.prototype.absellipse=function(_,S,M,T,A,C,E){var D=Array.prototype.slice.call(arguments),P=new THREE.EllipseCurve(_,S,M,T,A,C,E);this.curves.push(P);var R=P.getPoint(E?1:0);D.push(R.x),D.push(R.y),this.actions.push({action:THREE.PathActions.ELLIPSE,args:D})},THREE.Path.prototype.getSpacedPoints=function(_){_||(_=40);for(var M=[],T=0;T<_;T++)M.push(this.getPoint(T/_));return M},THREE.Path.prototype.getPoints=function(_,S){if(this.useSpacedPoints)return console.log('tata'),this.getSpacedPoints(_,S);_=_||12;var M=[],T,A,C,E,D,P,R,L,N,U,F,V,I,O,B,G,H,W;for(T=0,A=this.actions.length;T<A;T++)switch(C=this.actions[T],E=C.action,D=C.args,E){case THREE.PathActions.MOVE_TO:M.push(new THREE.Vector2(D[0],D[1]));break;case THREE.PathActions.LINE_TO:M.push(new THREE.Vector2(D[0],D[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:for(P=D[2],R=D[3],U=D[0],F=D[1],0<M.length?(O=M[M.length-1],V=O.x,I=O.y):(O=this.actions[T-1].args,V=O[O.length-2],I=O[O.length-1]),B=1;B<=_;B++)G=B/_,H=THREE.Shape.Utils.b2(G,V,U,P),W=THREE.Shape.Utils.b2(G,I,F,R),M.push(new THREE.Vector2(H,W));break;case THREE.PathActions.BEZIER_CURVE_TO:for(P=D[4],R=D[5],U=D[0],F=D[1],L=D[2],N=D[3],0<M.length?(O=M[M.length-1],V=O.x,I=O.y):(O=this.actions[T-1].args,V=O[O.length-2],I=O[O.length-1]),B=1;B<=_;B++)G=B/_,H=THREE.Shape.Utils.b3(G,V,U,L,P),W=THREE.Shape.Utils.b3(G,I,F,N,R),M.push(new THREE.Vector2(H,W));break;case THREE.PathActions.CSPLINE_THRU:O=this.actions[T-1].args;var X=new THREE.Vector2(O[O.length-2],O[O.length-1]),Y=[X],K=_*D[0].length;Y=Y.concat(D[0]);var Q=new THREE.SplineCurve(Y);for(B=1;B<=K;B++)M.push(Q.getPointAt(B/K));break;case THREE.PathActions.ARC:var Z=D[0],J=D[1],ee=D[2],re=D[3],oe=D[4],ie=!!D[5],ne=oe-re,le=2*_,se;for(B=1;B<=le;B++)G=B/le,ie||(G=1-G),se=re+G*ne,H=Z+ee*Math.cos(se),W=J+ee*Math.sin(se),M.push(new THREE.Vector2(H,W));break;case THREE.PathActions.ELLIPSE:var Z=D[0],J=D[1],pe=D[2],ue=D[3],re=D[4],oe=D[5],ie=!!D[6],ne=oe-re,le=2*_,se;for(B=1;B<=le;B++)G=B/le,ie||(G=1-G),se=re+G*ne,H=Z+pe*Math.cos(se),W=J+ue*Math.sin(se),M.push(new THREE.Vector2(H,W));}var fe=M[M.length-1],he=1e-10;return Math.abs(fe.x-M[0].x)<he&&Math.abs(fe.y-M[0].y)<he&&M.splice(M.length-1,1),S&&M.push(M[0]),M},THREE.Path.prototype.toShapes=function(){var C=[],E=new THREE.Path,_,S,M,T,A;for(_=0,S=this.actions.length;_<S;_++)M=this.actions[_],A=M.args,T=M.action,T==THREE.PathActions.MOVE_TO&&0!=E.actions.length&&(C.push(E),E=new THREE.Path),E[T].apply(E,A);if(0!=E.actions.length&&C.push(E),0==C.length)return[];var R=[],L=!THREE.Shape.Utils.isClockWise(C[0].getPoints()),D,P;if(1==C.length)return D=C[0],P=new THREE.Shape,P.actions=D.actions,P.curves=D.curves,R.push(P),R;if(L)for(P=new THREE.Shape,_=0,S=C.length;_<S;_++)D=C[_],THREE.Shape.Utils.isClockWise(D.getPoints())?(P.actions=D.actions,P.curves=D.curves,R.push(P),P=new THREE.Shape):P.holes.push(D);else{for(_=0,S=C.length;_<S;_++)D=C[_],THREE.Shape.Utils.isClockWise(D.getPoints())?(P&&R.push(P),P=new THREE.Shape,P.actions=D.actions,P.curves=D.curves):P.holes.push(D);R.push(P)}return R},THREE.Shape=function(){THREE.Path.apply(this,arguments),this.holes=[]},THREE.Shape.prototype=Object.create(THREE.Path.prototype),THREE.Shape.prototype.extrude=function(_){var S=new THREE.ExtrudeGeometry(this,_);return S},THREE.Shape.prototype.makeGeometry=function(_){var S=new THREE.ShapeGeometry(this,_);return S},THREE.Shape.prototype.getPointsHoles=function(_){var M=this.holes.length,T=[],S;for(S=0;S<M;S++)T[S]=this.holes[S].getTransformedPoints(_,this.bends);return T},THREE.Shape.prototype.getSpacedPointsHoles=function(_){var M=this.holes.length,T=[],S;for(S=0;S<M;S++)T[S]=this.holes[S].getTransformedSpacedPoints(_,this.bends);return T},THREE.Shape.prototype.extractAllPoints=function(_){return{shape:this.getTransformedPoints(_),holes:this.getPointsHoles(_)}},THREE.Shape.prototype.extractPoints=function(_){return this.useSpacedPoints?this.extractAllSpacedPoints(_):this.extractAllPoints(_)},THREE.Shape.prototype.extractAllSpacedPoints=function(_){return{shape:this.getTransformedSpacedPoints(_),holes:this.getSpacedPointsHoles(_)}},THREE.Shape.Utils={removeHoles:function(_,S){var M=_.concat(),T=M.concat(),A,E,P,R,U,F,V,I,O,B,G,H,W,X,Y,K,Q=[];for(U=0;U<S.length;U++){for(V=S[U],Array.prototype.push.apply(T,V),I=Number.POSITIVE_INFINITY,F=0;F<V.length;F++){G=V[F];var Z=[];for(B=0;B<M.length;B++)H=M[B],O=G.distanceToSquared(H),Z.push(O),O<I&&(I=O,P=F,R=B)}A=0<=R-1?R-1:M.length-1,E=0<=P-1?P-1:V.length-1;var J=[V[P],M[R],M[A]],ee=THREE.FontUtils.Triangulate.area(J),re=[V[P],V[E],M[R]],oe=THREE.FontUtils.Triangulate.area(re),se=R,le=P;R+=1,P+=-1,0>R&&(R+=M.length),R%=M.length,0>P&&(P+=V.length),P%=V.length,A=0<=R-1?R-1:M.length-1,E=0<=P-1?P-1:V.length-1,J=[V[P],M[R],M[A]];var pe=THREE.FontUtils.Triangulate.area(J);re=[V[P],V[E],M[R]];var ue=THREE.FontUtils.Triangulate.area(re);ee+oe>pe+ue&&(R=se,P=le,0>R&&(R+=M.length),R%=M.length,0>P&&(P+=V.length),P%=V.length,A=0<=R-1?R-1:M.length-1,E=0<=P-1?P-1:V.length-1),W=M.slice(0,R),X=M.slice(R),Y=V.slice(P),K=V.slice(0,P);var fe=[V[P],M[R],M[A]],he=[V[P],V[E],M[R]];Q.push(fe),Q.push(he),M=W.concat(Y).concat(K).concat(X)}return{shape:M,isolatedPts:Q,allpoints:T}},triangulateShape:function(_,S){var M=THREE.Shape.Utils.removeHoles(_,S),T=M.shape,A=M.allpoints,C=M.isolatedPts,E=THREE.FontUtils.Triangulate(T,!1),D,P,R,L,N,U,F={};for(D=0,P=A.length;D<P;D++)N=A[D].x+':'+A[D].y,void 0!==F[N]&&console.log('Duplicate point',N),F[N]=D;for(D=0,P=E.length;D<P;D++)for(L=E[D],R=0;3>R;R++)N=L[R].x+':'+L[R].y,U=F[N],void 0!=U&&(L[R]=U);for(D=0,P=C.length;D<P;D++)for(L=C[D],R=0;3>R;R++)N=L[R].x+':'+L[R].y,U=F[N],void 0!==U&&(L[R]=U);return E.concat(C)},isClockWise:function(_){return 0>THREE.FontUtils.Triangulate.area(_)},b2p0:function(_,S){var M=1-_;return M*M*S},b2p1:function(_,S){return 2*(1-_)*_*S},b2p2:function(_,S){return _*_*S},b2:function(_,S,M,T){return this.b2p0(_,S)+this.b2p1(_,M)+this.b2p2(_,T)},b3p0:function(_,S){var M=1-_;return M*M*M*S},b3p1:function(_,S){var M=1-_;return 3*M*M*_*S},b3p2:function(_,S){return 3*(1-_)*_*_*S},b3p3:function(_,S){return _*_*_*S},b3:function(_,S,M,T,A){return this.b3p0(_,S)+this.b3p1(_,M)+this.b3p2(_,T)+this.b3p3(_,A)}},THREE.AnimationHandler=function(){var _=[],S={},M={};M.update=function(C){for(var E=0;E<_.length;E++)_[E].update(C)},M.addToUpdate=function(C){-1===_.indexOf(C)&&_.push(C)},M.removeFromUpdate=function(C){var E=_.indexOf(C);-1!==E&&_.splice(E,1)},M.add=function(C){void 0!==S[C.name]&&console.log('THREE.AnimationHandler.add: Warning! '+C.name+' already exists in library. Overwriting.'),S[C.name]=C,A(C)},M.get=function(C){if('string'==typeof C)return S[C]?S[C]:(console.log('THREE.AnimationHandler.get: Couldn\'t find animation '+C),null)},M.parse=function(C){var E=[];if(C instanceof THREE.SkinnedMesh)for(var D=0;D<C.bones.length;D++)E.push(C.bones[D]);else T(C,E);return E};var T=function(C,E){E.push(C);for(var D=0;D<C.children.length;D++)T(C.children[D],E)},A=function(C){if(!0!==C.initialized){for(var E=0;E<C.hierarchy.length;E++){for(var D=0;D<C.hierarchy[E].keys.length;D++)if(0>C.hierarchy[E].keys[D].time&&(C.hierarchy[E].keys[D].time=0),void 0!==C.hierarchy[E].keys[D].rot&&!(C.hierarchy[E].keys[D].rot instanceof THREE.Quaternion)){var P=C.hierarchy[E].keys[D].rot;C.hierarchy[E].keys[D].rot=new THREE.Quaternion(P[0],P[1],P[2],P[3])}if(C.hierarchy[E].keys.length&&void 0!==C.hierarchy[E].keys[0].morphTargets){for(var R={},D=0;D<C.hierarchy[E].keys.length;D++)for(var L=0,N;L<C.hierarchy[E].keys[D].morphTargets.length;L++)N=C.hierarchy[E].keys[D].morphTargets[L],R[N]=-1;C.hierarchy[E].usedMorphTargets=R;for(var D=0,U;D<C.hierarchy[E].keys.length;D++){for(var N in U={},R){for(var L=0;L<C.hierarchy[E].keys[D].morphTargets.length;L++)if(C.hierarchy[E].keys[D].morphTargets[L]===N){U[N]=C.hierarchy[E].keys[D].morphTargetsInfluences[L];break}L===C.hierarchy[E].keys[D].morphTargets.length&&(U[N]=0)}C.hierarchy[E].keys[D].morphTargetsInfluences=U}}for(var D=1;D<C.hierarchy[E].keys.length;D++)C.hierarchy[E].keys[D].time===C.hierarchy[E].keys[D-1].time&&(C.hierarchy[E].keys.splice(D,1),D--);for(var D=0;D<C.hierarchy[E].keys.length;D++)C.hierarchy[E].keys[D].index=D}var F=parseInt(C.length*C.fps,10);C.JIT={},C.JIT.hierarchy=[];for(var E=0;E<C.hierarchy.length;E++)C.JIT.hierarchy.push(Array(F));C.initialized=!0}};return M.LINEAR=0,M.CATMULLROM=1,M.CATMULLROM_FORWARD=2,M}(),THREE.Animation=function(_,S,M){this.root=_,this.data=THREE.AnimationHandler.get(S),this.hierarchy=THREE.AnimationHandler.parse(_),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.isPaused=!0,this.loop=!0,this.interpolationType=M===void 0?THREE.AnimationHandler.LINEAR:M,this.points=[],this.target=new THREE.Vector3},THREE.Animation.prototype.play=function(_,S){if(!1===this.isPlaying){this.isPlaying=!0,this.loop=!(_!==void 0)||_,this.currentTime=S===void 0?0:S;var T=this.hierarchy.length,M,A;for(M=0;M<T;M++){A=this.hierarchy[M],this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD&&(A.useQuaternion=!0),A.matrixAutoUpdate=!0,A.animationCache===void 0&&(A.animationCache={},A.animationCache.prevKey={pos:0,rot:0,scl:0},A.animationCache.nextKey={pos:0,rot:0,scl:0},A.animationCache.originalMatrix=A instanceof THREE.Bone?A.skinMatrix:A.matrix);var C=A.animationCache.prevKey,E=A.animationCache.nextKey;C.pos=this.data.hierarchy[M].keys[0],C.rot=this.data.hierarchy[M].keys[0],C.scl=this.data.hierarchy[M].keys[0],E.pos=this.getNextKeyWith('pos',M,1),E.rot=this.getNextKeyWith('rot',M,1),E.scl=this.getNextKeyWith('scl',M,1)}this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.Animation.prototype.pause=function(){!0===this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.Animation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,THREE.AnimationHandler.removeFromUpdate(this)},THREE.Animation.prototype.update=function(_){if(!1!==this.isPlaying){var S=['pos','rot','scl'],U=this.data.JIT.hierarchy,M,T,A,C,E,D,P,R,L,N,F,V,I,O,B;this.currentTime+=_*this.timeScale,V=this.currentTime,F=this.currentTime%=this.data.length,N=parseInt(Math.min(F*this.data.fps,this.data.length*this.data.fps),10);for(var G=0,H=this.hierarchy.length;G<H;G++){R=this.hierarchy[G],L=R.animationCache;for(var W=0;3>W;W++){if(M=S[W],D=L.prevKey[M],P=L.nextKey[M],P.time<=V){if(!(F<V))do D=P,P=this.getNextKeyWith(M,G,P.index+1);while(P.time<F);else if(this.loop)for(D=this.data.hierarchy[G].keys[0],P=this.getNextKeyWith(M,G,1);P.time<F;)D=P,P=this.getNextKeyWith(M,G,P.index+1);else return void this.stop();L.prevKey[M]=D,L.nextKey[M]=P}R.matrixAutoUpdate=!0,R.matrixWorldNeedsUpdate=!0,T=(F-D.time)/(P.time-D.time),C=D[M],E=P[M],(0>T||1<T)&&(console.log('THREE.Animation.update: Warning! Scale out of bounds:'+T+' on bone '+G),T=0>T?0:1),'pos'===M?(A=R.position,this.interpolationType===THREE.AnimationHandler.LINEAR?(A.x=C[0]+(E[0]-C[0])*T,A.y=C[1]+(E[1]-C[1])*T,A.z=C[2]+(E[2]-C[2])*T):(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)&&(this.points[0]=this.getPrevKeyWith('pos',G,D.index-1).pos,this.points[1]=C,this.points[2]=E,this.points[3]=this.getNextKeyWith('pos',G,P.index+1).pos,T=0.33*T+0.33,I=this.interpolateCatmullRom(this.points,T),A.x=I[0],A.y=I[1],A.z=I[2],this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD&&(O=this.interpolateCatmullRom(this.points,1.01*T),this.target.set(O[0],O[1],O[2]),this.target.sub(A),this.target.y=0,this.target.normalize(),B=Math.atan2(this.target.x,this.target.z),R.rotation.set(0,B,0)))):'rot'===M?THREE.Quaternion.slerp(C,E,R.quaternion,T):'scl'==M&&(A=R.scale,A.x=C[0]+(E[0]-C[0])*T,A.y=C[1]+(E[1]-C[1])*T,A.z=C[2]+(E[2]-C[2])*T)}}}},THREE.Animation.prototype.interpolateCatmullRom=function(_,S){var M=[],T=[],A,C,E,D,P,R,L,N,U;return A=(_.length-1)*S,C=Math.floor(A),E=A-C,M[0]=0===C?C:C-1,M[1]=C,M[2]=C>_.length-2?C:C+1,M[3]=C>_.length-3?C:C+2,R=_[M[0]],L=_[M[1]],N=_[M[2]],U=_[M[3]],D=E*E,P=E*D,T[0]=this.interpolate(R[0],L[0],N[0],U[0],E,D,P),T[1]=this.interpolate(R[1],L[1],N[1],U[1],E,D,P),T[2]=this.interpolate(R[2],L[2],N[2],U[2],E,D,P),T},THREE.Animation.prototype.interpolate=function(_,S,M,T,A,C,E){var D=0.5*(M-_),P=0.5*(T-S);return(2*(S-M)+D+P)*E+(-3*(S-M)-2*D-P)*C+D*A+S},THREE.Animation.prototype.getNextKeyWith=function(_,S,M){var T=this.data.hierarchy[S].keys;for(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?M=M<T.length-1?M:T.length-1:M%=T.length;M<T.length;M++)if(T[M][_]!==void 0)return T[M];return this.data.hierarchy[S].keys[0]},THREE.Animation.prototype.getPrevKeyWith=function(_,S,M){var T=this.data.hierarchy[S].keys;for(M=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?0<M?M:0:0<=M?M:M+T.length;0<=M;M--)if(T[M][_]!==void 0)return T[M];return this.data.hierarchy[S].keys[T.length-1]},THREE.KeyFrameAnimation=function(_,S,M){this.root=_,this.data=THREE.AnimationHandler.get(S),this.hierarchy=THREE.AnimationHandler.parse(_),this.currentTime=0,this.timeScale=1e-3,this.isPlaying=!1,this.isPaused=!0,this.loop=!0,this.JITCompile=!(M!==void 0)||M;for(var T=0,A=this.hierarchy.length;T<A;T++){var C=this.data.hierarchy[T].keys,E=this.data.hierarchy[T].sids,D=this.hierarchy[T];if(C.length&&E){for(var P=0;P<E.length;P++){var R=E[P],L=this.getNextKeyWith(R,T,0);L&&L.apply(R)}D.matrixAutoUpdate=!1,this.data.hierarchy[T].node.updateMatrix(),D.matrixWorldNeedsUpdate=!0}}},THREE.KeyFrameAnimation.prototype.play=function(_,S){if(!this.isPlaying){this.isPlaying=!0,this.loop=!(_!==void 0)||_,this.currentTime=S===void 0?0:S,this.startTimeMs=S,this.startTime=1e7,this.endTime=-this.startTime;var T=this.hierarchy.length,M,A,C;for(M=0;M<T;M++){A=this.hierarchy[M],C=this.data.hierarchy[M],A.useQuaternion=!0,C.animationCache===void 0&&(C.animationCache={},C.animationCache.prevKey=null,C.animationCache.nextKey=null,C.animationCache.originalMatrix=A instanceof THREE.Bone?A.skinMatrix:A.matrix);var E=this.data.hierarchy[M].keys;E.length&&(C.animationCache.prevKey=E[0],C.animationCache.nextKey=E[1],this.startTime=Math.min(E[0].time,this.startTime),this.endTime=Math.max(E[E.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.KeyFrameAnimation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,THREE.AnimationHandler.removeFromUpdate(this);for(var _=0;_<this.data.hierarchy.length;_++){var S=this.hierarchy[_],M=this.data.hierarchy[_];if(M.animationCache!==void 0){var T=M.animationCache.originalMatrix;S instanceof THREE.Bone?(T.copy(S.skinMatrix),S.skinMatrix=T):(T.copy(S.matrix),S.matrix=T),delete M.animationCache}}},THREE.KeyFrameAnimation.prototype.update=function(_){if(this.isPlaying){var E=this.data.JIT.hierarchy,S,M,T,A,C,D,P,R;if(this.currentTime+=_*this.timeScale,P=this.currentTime,D=this.currentTime%=this.data.length,D<this.startTimeMs&&(D=this.currentTime=this.startTimeMs+D),C=parseInt(Math.min(D*this.data.fps,this.data.length*this.data.fps),10),R=D<P,R&&!this.loop){for(var L=0,N=this.hierarchy.length;L<N;L++){var U=this.data.hierarchy[L].keys,F=this.data.hierarchy[L].sids,V=U.length-1,I=this.hierarchy[L];if(U.length){for(var O=0;O<F.length;O++){var B=F[O],G=this.getPrevKeyWith(B,L,V);G&&G.apply(B)}this.data.hierarchy[L].node.updateMatrix(),I.matrixWorldNeedsUpdate=!0}}return void this.stop()}if(!(D<this.startTime)){for(var L=0,N=this.hierarchy.length;L<N;L++){T=this.hierarchy[L],A=this.data.hierarchy[L];var U=A.keys,H=A.animationCache;if(this.JITCompile&&void 0!==E[L][C])T instanceof THREE.Bone?(T.skinMatrix=E[L][C],T.matrixWorldNeedsUpdate=!1):(T.matrix=E[L][C],T.matrixWorldNeedsUpdate=!0);else if(U.length){if(this.JITCompile&&H&&(T instanceof THREE.Bone?T.skinMatrix=H.originalMatrix:T.matrix=H.originalMatrix),S=H.prevKey,M=H.nextKey,S&&M){if(M.time<=P){if(R&&this.loop)for(S=U[0],M=U[1];M.time<D;)S=M,M=U[S.index+1];else if(!R)for(var W=U.length-1;M.time<D&&M.index!==W;)S=M,M=U[S.index+1];H.prevKey=S,H.nextKey=M}M.time>=D?S.interpolate(M,D):S.interpolate(M,M.time)}this.data.hierarchy[L].node.updateMatrix(),T.matrixWorldNeedsUpdate=!0}}if(this.JITCompile&&void 0===E[0][C]){this.hierarchy[0].updateMatrixWorld(!0);for(var L=0;L<this.hierarchy.length;L++)E[L][C]=this.hierarchy[L]instanceof THREE.Bone?this.hierarchy[L].skinMatrix.clone():this.hierarchy[L].matrix.clone()}}}},THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(_,S,M){var T=this.data.hierarchy[S].keys;for(M%=T.length;M<T.length;M++)if(T[M].hasTarget(_))return T[M];return T[0]},THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(_,S,M){var T=this.data.hierarchy[S].keys;for(M=0<=M?M:M+T.length;0<=M;M--)if(T[M].hasTarget(_))return T[M];return T[T.length-1]},THREE.CubeCamera=function(_,S,M){THREE.Object3D.call(this);var T=90,A=1,C=new THREE.PerspectiveCamera(T,A,_,S);C.up.set(0,-1,0),C.lookAt(new THREE.Vector3(1,0,0)),this.add(C);var E=new THREE.PerspectiveCamera(T,A,_,S);E.up.set(0,-1,0),E.lookAt(new THREE.Vector3(-1,0,0)),this.add(E);var D=new THREE.PerspectiveCamera(T,A,_,S);D.up.set(0,0,1),D.lookAt(new THREE.Vector3(0,1,0)),this.add(D);var P=new THREE.PerspectiveCamera(T,A,_,S);P.up.set(0,0,-1),P.lookAt(new THREE.Vector3(0,-1,0)),this.add(P);var R=new THREE.PerspectiveCamera(T,A,_,S);R.up.set(0,-1,0),R.lookAt(new THREE.Vector3(0,0,1)),this.add(R);var L=new THREE.PerspectiveCamera(T,A,_,S);L.up.set(0,-1,0),L.lookAt(new THREE.Vector3(0,0,-1)),this.add(L),this.renderTarget=new THREE.WebGLRenderTargetCube(M,M,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter}),this.updateCubeMap=function(N,U){var F=this.renderTarget,V=F.generateMipmaps;F.generateMipmaps=!1,F.activeCubeFace=0,N.render(U,C,F),F.activeCubeFace=1,N.render(U,E,F),F.activeCubeFace=2,N.render(U,D,F),F.activeCubeFace=3,N.render(U,P,F),F.activeCubeFace=4,N.render(U,R,F),F.generateMipmaps=V,F.activeCubeFace=5,N.render(U,L,F)}},THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype),THREE.CombinedCamera=function(_,S,M,T,A,C,E){THREE.Camera.call(this),this.fov=M,this.left=-_/2,this.right=_/2,this.top=S/2,this.bottom=-S/2,this.cameraO=new THREE.OrthographicCamera(_/-2,_/2,S/2,S/-2,C,E),this.cameraP=new THREE.PerspectiveCamera(M,_/S,T,A),this.zoom=1,this.toPerspective()},THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype),THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},THREE.CombinedCamera.prototype.toOrthographic=function(){var _=this.fov,S=this.cameraP.aspect,M=this.cameraP.near,T=this.cameraP.far,C=Math.tan(_/2)*((M+T)/2),E=2*C,P=E*S/2;C/=this.zoom,P/=this.zoom,this.cameraO.left=-P,this.cameraO.right=P,this.cameraO.top=C,this.cameraO.bottom=-C,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},THREE.CombinedCamera.prototype.setSize=function(_,S){this.cameraP.aspect=_/S,this.left=-_/2,this.right=_/2,this.top=S/2,this.bottom=-S/2},THREE.CombinedCamera.prototype.setFov=function(_){this.fov=_,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},THREE.CombinedCamera.prototype.setLens=function(_,S){void 0===S&&(S=24);var M=2*THREE.Math.radToDeg(Math.atan(S/(2*_)));return this.setFov(M),M},THREE.CombinedCamera.prototype.setZoom=function(_){this.zoom=_,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CircleGeometry=function(_,S,M,T){THREE.Geometry.call(this),_=_||50,M=M===void 0?0:M,T=T===void 0?2*Math.PI:T,S=S===void 0?8:Math.max(3,S);var C=[],E=new THREE.Vector3,D=new THREE.Vector2(0.5,0.5),A;for(this.vertices.push(E),C.push(D),A=0;A<=S;A++){var P=new THREE.Vector3,R=M+A/S*T;P.x=_*Math.cos(R),P.y=_*Math.sin(R),this.vertices.push(P),C.push(new THREE.Vector2((P.x/_+1)/2,(P.y/_+1)/2))}var L=new THREE.Vector3(0,0,1);for(A=1;A<=S;A++){var N=A,U=A+1;this.faces.push(new THREE.Face3(N,U,0,[L,L,L])),this.faceVertexUvs[0].push([C[A],C[A+1],D])}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3(),_)},THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CubeGeometry=function(_,S,M,T,A,C){function E(N,U,F,V,I,O,B,G){var Y=D.widthSegments,K=D.heightSegments,J=D.vertices.length,H,W,X;'x'===N&&'y'===U||'y'===N&&'x'===U?H='z':'x'===N&&'z'===U||'z'===N&&'x'===U?(H='y',K=D.depthSegments):('z'==N&&'y'==U||'y'==N&&'z'==U)&&(H='x',Y=D.depthSegments);var ee=Y+1,re=K+1,oe=I/Y,ie=O/K,ne=new THREE.Vector3;for(ne[H]=0<B?1:-1,X=0;X<re;X++)for(W=0;W<ee;W++){var se=new THREE.Vector3;se[N]=(W*oe-I/2)*F,se[U]=(X*ie-O/2)*V,se[H]=B,D.vertices.push(se)}for(X=0;X<K;X++)for(W=0;W<Y;W++){var le=W+ee*X,pe=W+ee*(X+1),ue=W+1+ee*(X+1),fe=W+1+ee*X,he=new THREE.Face4(le+J,pe+J,ue+J,fe+J);he.normal.copy(ne),he.vertexNormals.push(ne.clone(),ne.clone(),ne.clone(),ne.clone()),he.materialIndex=G,D.faces.push(he),D.faceVertexUvs[0].push([new THREE.Vector2(W/Y,1-X/K),new THREE.Vector2(W/Y,1-(X+1)/K),new THREE.Vector2((W+1)/Y,1-(X+1)/K),new THREE.Vector2((W+1)/Y,1-X/K)])}}THREE.Geometry.call(this);var D=this;this.width=_,this.height=S,this.depth=M,this.widthSegments=T||1,this.heightSegments=A||1,this.depthSegments=C||1;var P=this.width/2,R=this.height/2,L=this.depth/2;E('z','y',-1,-1,this.depth,this.height,P,0),E('z','y',1,-1,this.depth,this.height,-P,1),E('x','z',1,1,this.width,this.depth,R,2),E('x','z',1,-1,this.width,this.depth,-R,3),E('x','y',1,-1,this.width,this.height,L,4),E('x','y',-1,-1,this.width,this.height,-L,5),this.computeCentroids(),this.mergeVertices()},THREE.CubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CylinderGeometry=function(_,S,M,T,A,C){THREE.Geometry.call(this),this.radiusTop=_=_===void 0?20:_,this.radiusBottom=S=S===void 0?20:S,this.height=M=M===void 0?100:M,this.radiusSegments=T=T||8,this.heightSegments=A=A||1,this.openEnded=C=C!==void 0&&C;var E=M/2,D,P,R=[],L=[];for(P=0;P<=A;P++){var N=[],U=[],F=P/A,V=F*(S-_)+_;for(D=0;D<=T;D++){var I=D/T,O=new THREE.Vector3;O.x=V*Math.sin(2*(I*Math.PI)),O.y=-F*M+E,O.z=V*Math.cos(2*(I*Math.PI)),this.vertices.push(O),N.push(this.vertices.length-1),U.push(new THREE.Vector2(I,1-F))}R.push(N),L.push(U)}var B=(S-_)/M,G,H;for(D=0;D<T;D++)for(0===_?(G=this.vertices[R[1][D]].clone(),H=this.vertices[R[1][D+1]].clone()):(G=this.vertices[R[0][D]].clone(),H=this.vertices[R[0][D+1]].clone()),G.setY(Math.sqrt(G.x*G.x+G.z*G.z)*B).normalize(),H.setY(Math.sqrt(H.x*H.x+H.z*H.z)*B).normalize(),P=0;P<A;P++){var W=R[P][D],X=R[P+1][D],Y=R[P+1][D+1],K=R[P][D+1],Q=G.clone(),Z=G.clone(),J=H.clone(),ee=H.clone(),re=L[P][D].clone(),oe=L[P+1][D].clone(),ie=L[P+1][D+1].clone(),ne=L[P][D+1].clone();this.faces.push(new THREE.Face4(W,X,Y,K,[Q,Z,J,ee])),this.faceVertexUvs[0].push([re,oe,ie,ne])}if(!1===C&&0<_)for(this.vertices.push(new THREE.Vector3(0,E,0)),D=0;D<T;D++){var W=R[0][D],X=R[0][D+1],Y=this.vertices.length-1,Q=new THREE.Vector3(0,1,0),Z=new THREE.Vector3(0,1,0),J=new THREE.Vector3(0,1,0),re=L[0][D].clone(),oe=L[0][D+1].clone(),ie=new THREE.Vector2(oe.u,0);this.faces.push(new THREE.Face3(W,X,Y,[Q,Z,J])),this.faceVertexUvs[0].push([re,oe,ie])}if(!1===C&&0<S)for(this.vertices.push(new THREE.Vector3(0,-E,0)),D=0;D<T;D++){var W=R[P][D+1],X=R[P][D],Y=this.vertices.length-1,Q=new THREE.Vector3(0,-1,0),Z=new THREE.Vector3(0,-1,0),J=new THREE.Vector3(0,-1,0),re=L[P][D+1].clone(),oe=L[P][D].clone(),ie=new THREE.Vector2(oe.u,1);this.faces.push(new THREE.Face3(W,X,Y,[Q,Z,J])),this.faceVertexUvs[0].push([re,oe,ie])}this.computeCentroids(),this.computeFaceNormals()},THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry=function(_,S){return'undefined'==typeof _?void(_=[]):void(THREE.Geometry.call(this),_=_ instanceof Array?_:[_],this.shapebb=_[_.length-1].getBoundingBox(),this.addShapeList(_,S),this.computeCentroids(),this.computeFaceNormals())},THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry.prototype.addShapeList=function(_,S){for(var M=_.length,T=0,A;T<M;T++)A=_[T],this.addShape(A,S)},THREE.ExtrudeGeometry.prototype.addShape=function(_,S){function M(je,We,Xe){return We.clone().multiplyScalar(Xe).add(je)}function T(je,We,Xe){return C(je,We,Xe)}function A(je,We,Xe){var Ye=Math.atan2(We.y-je.y,We.x-je.x),qe=Math.atan2(Xe.y-je.y,Xe.x-je.x);Ye>qe&&(qe+=2*Math.PI);var Ke=(Ye+qe)/2,Qe=-Math.cos(Ke),Ze=-Math.sin(Ke),Je=new THREE.Vector2(Qe,Ze);return Je}function C(je,We,Xe){var Ye=THREE.ExtrudeGeometry.__v1,qe=THREE.ExtrudeGeometry.__v2,Ke=THREE.ExtrudeGeometry.__v3,Qe=THREE.ExtrudeGeometry.__v4,Ze=THREE.ExtrudeGeometry.__v5,Je=THREE.ExtrudeGeometry.__v6,$e,et,tt,rt,at,ot;return(Ye.set(je.x-We.x,je.y-We.y),qe.set(je.x-Xe.x,je.y-Xe.y),$e=Ye.normalize(),et=qe.normalize(),Ke.set(-$e.y,$e.x),Qe.set(et.y,-et.x),Ze.copy(je).add(Ke),Je.copy(je).add(Qe),Ze.equals(Je))?Qe.clone():(Ze.copy(We).add(Ke),Je.copy(Xe).add(Qe),tt=$e.dot(Qe),rt=Je.sub(Ze).dot(Qe),at=rt/tt,0>at)?A(je,We,Xe):(ot=$e.multiplyScalar(at).add(Ze),ot.sub(je).clone())}function P(je,We){var Xe,Ye;for(Ne=je.length;0<=--Ne;){Xe=Ne,Ye=Ne-1,0>Ye&&(Ye=je.length-1);var qe=0,Ke=G+2*I;for(qe=0;qe<Ke;qe++){var Qe=we*qe,Ze=we*(qe+1),Je=We+Xe+Qe,$e=We+Ye+Qe,et=We+Ye+Ze,tt=We+Xe+Ze;N(Je,$e,et,tt,je,qe,Ke,Xe,Ye)}}}function R(je,We,Xe){le.vertices.push(new THREE.Vector3(je,We,Xe))}function L(je,We,Xe,Ye){je+=ue,We+=ue,Xe+=ue,le.faces.push(new THREE.Face3(je,We,Xe,null,null,Y));var qe=Ye?Q.generateBottomUV(le,_,S,je,We,Xe):Q.generateTopUV(le,_,S,je,We,Xe);le.faceVertexUvs[0].push(qe)}function N(je,We,Xe,Ye,qe,Ke,Qe,Ze,Je){je+=ue,We+=ue,Xe+=ue,Ye+=ue,le.faces.push(new THREE.Face4(je,We,Xe,Ye,null,null,K));var $e=Q.generateSideWallUV(le,_,qe,S,je,We,Xe,Ye,Ke,Qe,Ze,Je);le.faceVertexUvs[0].push($e)}var U=S.amount===void 0?100:S.amount,F=S.bevelThickness===void 0?6:S.bevelThickness,V=S.bevelSize===void 0?F-2:S.bevelSize,I=S.bevelSegments===void 0?3:S.bevelSegments,O=!(S.bevelEnabled!==void 0)||S.bevelEnabled,B=S.curveSegments===void 0?12:S.curveSegments,G=S.steps===void 0?1:S.steps,H=S.extrudePath,W,X=!1,Y=S.material,K=S.extrudeMaterial,Q=S.UVGenerator===void 0?THREE.ExtrudeGeometry.WorldUVGenerator:S.UVGenerator,Z=this.shapebb,J,ee,re,oe;H&&(W=H.getSpacedPoints(G),X=!0,O=!1,J=S.frames===void 0?new THREE.TubeGeometry.FrenetFrames(H,G,!1):S.frames,ee=new THREE.Vector3,re=new THREE.Vector3,oe=new THREE.Vector3),O||(I=0,F=0,V=0);var ie,ne,se,le=this,ue=this.vertices.length,fe=_.extractPoints(B),he=fe.shape,ge=fe.holes,ye=!THREE.Shape.Utils.isClockWise(he);if(ye){for(he=he.reverse(),ne=0,se=ge.length;ne<se;ne++)ie=ge[ne],THREE.Shape.Utils.isClockWise(ie)&&(ge[ne]=ie.reverse());ye=!1}var xe=THREE.Shape.Utils.triangulateShape(he,ge),_e=he;for(ne=0,se=ge.length;ne<se;ne++)ie=ge[ne],he=he.concat(ie);for(var we=he.length,Ee=xe.length,Pe=_e.length,Re=180/Math.PI,Le=[],Ne=0,Ue=_e.length,Fe=Ue-1,ze=Ne+1,ve,Se,Me,Te,Ae,Ce;Ne<Ue;Ne++,Fe++,ze++){Fe===Ue&&(Fe=0),ze===Ue&&(ze=0);var Ve=_e[Ne],Ie=_e[Fe],Oe=_e[ze];Le[Ne]=T(_e[Ne],_e[Fe],_e[ze])}var Be=[],Ge=Le.concat(),ke;for(ne=0,se=ge.length;ne<se;ne++){for(ie=ge[ne],ke=[],(Ne=0,Ue=ie.length,Fe=Ue-1,ze=Ne+1);Ne<Ue;Ne++,Fe++,ze++)Fe===Ue&&(Fe=0),ze===Ue&&(ze=0),ke[Ne]=T(ie[Ne],ie[Fe],ie[ze]);Be.push(ke),Ge=Ge.concat(ke)}for(ve=0;ve<I;ve++){for(Me=ve/I,Te=F*(1-Me),Se=V*Math.sin(Me*Math.PI/2),(Ne=0,Ue=_e.length);Ne<Ue;Ne++)Ae=M(_e[Ne],Le[Ne],Se),R(Ae.x,Ae.y,-Te);for(ne=0,se=ge.length;ne<se;ne++)for(ie=ge[ne],ke=Be[ne],(Ne=0,Ue=ie.length);Ne<Ue;Ne++)Ae=M(ie[Ne],ke[Ne],Se),R(Ae.x,Ae.y,-Te)}for(Se=V,Ne=0;Ne<we;Ne++)Ae=O?M(he[Ne],Ge[Ne],Se):he[Ne],X?(re.copy(J.normals[0]).multiplyScalar(Ae.x),ee.copy(J.binormals[0]).multiplyScalar(Ae.y),oe.copy(W[0]).add(re).add(ee),R(oe.x,oe.y,oe.z)):R(Ae.x,Ae.y,0);var He;for(He=1;He<=G;He++)for(Ne=0;Ne<we;Ne++)Ae=O?M(he[Ne],Ge[Ne],Se):he[Ne],X?(re.copy(J.normals[He]).multiplyScalar(Ae.x),ee.copy(J.binormals[He]).multiplyScalar(Ae.y),oe.copy(W[He]).add(re).add(ee),R(oe.x,oe.y,oe.z)):R(Ae.x,Ae.y,U/G*He);for(ve=I-1;0<=ve;ve--){for(Me=ve/I,Te=F*(1-Me),Se=V*Math.sin(Me*Math.PI/2),(Ne=0,Ue=_e.length);Ne<Ue;Ne++)Ae=M(_e[Ne],Le[Ne],Se),R(Ae.x,Ae.y,U+Te);for(ne=0,se=ge.length;ne<se;ne++)for(ie=ge[ne],ke=Be[ne],(Ne=0,Ue=ie.length);Ne<Ue;Ne++)Ae=M(ie[Ne],ke[Ne],Se),X?R(Ae.x,Ae.y+W[G-1].y,W[G-1].x+Te):R(Ae.x,Ae.y,U+Te)}(function(){if(O){var je=0,We=we*je;for(Ne=0;Ne<Ee;Ne++)Ce=xe[Ne],L(Ce[2]+We,Ce[1]+We,Ce[0]+We,!0);for(je=G+2*I,We=we*je,Ne=0;Ne<Ee;Ne++)Ce=xe[Ne],L(Ce[0]+We,Ce[1]+We,Ce[2]+We,!1)}else{for(Ne=0;Ne<Ee;Ne++)Ce=xe[Ne],L(Ce[2],Ce[1],Ce[0],!0);for(Ne=0;Ne<Ee;Ne++)Ce=xe[Ne],L(Ce[0]+we*G,Ce[1]+we*G,Ce[2]+we*G,!1)}})(),function(){var je=0;for(P(_e,je),je+=_e.length,(ne=0,se=ge.length);ne<se;ne++)ie=ge[ne],P(ie,je),je+=ie.length}()},THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(_,S,M,T,A,C){var E=_.vertices[T].x,D=_.vertices[T].y,P=_.vertices[A].x,R=_.vertices[A].y,L=_.vertices[C].x,N=_.vertices[C].y;return[new THREE.Vector2(E,D),new THREE.Vector2(P,R),new THREE.Vector2(L,N)]},generateBottomUV:function(_,S,M,T,A,C){return this.generateTopUV(_,S,M,T,A,C)},generateSideWallUV:function(_,S,M,T,A,C,E,D){var U=_.vertices[A].x,F=_.vertices[A].y,V=_.vertices[A].z,I=_.vertices[C].x,O=_.vertices[C].y,B=_.vertices[C].z,G=_.vertices[E].x,H=_.vertices[E].y,W=_.vertices[E].z,X=_.vertices[D].x,Y=_.vertices[D].y,K=_.vertices[D].z;return 0.01>Math.abs(F-O)?[new THREE.Vector2(U,1-V),new THREE.Vector2(I,1-B),new THREE.Vector2(G,1-W),new THREE.Vector2(X,1-K)]:[new THREE.Vector2(F,1-V),new THREE.Vector2(O,1-B),new THREE.Vector2(H,1-W),new THREE.Vector2(Y,1-K)]}},THREE.ExtrudeGeometry.__v1=new THREE.Vector2,THREE.ExtrudeGeometry.__v2=new THREE.Vector2,THREE.ExtrudeGeometry.__v3=new THREE.Vector2,THREE.ExtrudeGeometry.__v4=new THREE.Vector2,THREE.ExtrudeGeometry.__v5=new THREE.Vector2,THREE.ExtrudeGeometry.__v6=new THREE.Vector2,THREE.ShapeGeometry=function(_,S){THREE.Geometry.call(this),!1==_ instanceof Array&&(_=[_]),this.shapebb=_[_.length-1].getBoundingBox(),this.addShapeList(_,S),this.computeCentroids(),this.computeFaceNormals()},THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ShapeGeometry.prototype.addShapeList=function(_,S){for(var M=0,T=_.length;M<T;M++)this.addShape(_[M],S);return this},THREE.ShapeGeometry.prototype.addShape=function(_,S){S===void 0&&(S={});var M=S.curveSegments===void 0?12:S.curveSegments,T=S.material,A=S.UVGenerator===void 0?THREE.ExtrudeGeometry.WorldUVGenerator:S.UVGenerator,C=this.shapebb,E,D,P,L=this.vertices.length,N=_.extractPoints(M),U=N.shape,F=N.holes,V=!THREE.Shape.Utils.isClockWise(U);if(V){for(U=U.reverse(),E=0,D=F.length;E<D;E++)P=F[E],THREE.Shape.Utils.isClockWise(P)&&(F[E]=P.reverse());V=!1}var I=THREE.Shape.Utils.triangulateShape(U,F),O=U;for(E=0,D=F.length;E<D;E++)P=F[E],U=U.concat(P);var G=U.length,B,H,W=I.length,Y=O.length;for(E=0;E<G;E++)B=U[E],this.vertices.push(new THREE.Vector3(B.x,B.y,0));for(E=0;E<W;E++){H=I[E];var K=H[0]+L,Q=H[1]+L,Z=H[2]+L;this.faces.push(new THREE.Face3(K,Q,Z,null,null,T)),this.faceVertexUvs[0].push(A.generateBottomUV(this,_,S,K,Q,Z))}},THREE.LatheGeometry=function(_,S,M,T){THREE.Geometry.call(this),S=S||12,M=M||0,T=T||2*Math.PI;for(var A=1/(_.length-1),C=1/S,E=0,D=S;E<=D;E++)for(var P=M+E*C*T,R=Math.cos(P),L=Math.sin(P),N=0,U=_.length;N<U;N++){var F=_[N],V=new THREE.Vector3;V.x=R*F.x-L*F.y,V.y=L*F.x+R*F.y,V.z=F.z,this.vertices.push(V)}for(var I=_.length,E=0,D=S;E<D;E++)for(var N=0,U=_.length-1;N<U;N++){var O=N+I*E,R=O+1+I;this.faces.push(new THREE.Face4(O,O+I,R,O+1));var W=E*C,X=N*A,Y=W+C,K=X+A;this.faceVertexUvs[0].push([new THREE.Vector2(W,X),new THREE.Vector2(Y,X),new THREE.Vector2(Y,K),new THREE.Vector2(W,K)])}this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.PlaneGeometry=function(_,S,M,T){THREE.Geometry.call(this),this.width=_,this.height=S,this.widthSegments=M||1,this.heightSegments=T||1;var A,C,P=this.widthSegments,R=this.heightSegments,L=P+1,U=this.width/P,F=this.height/R,V=new THREE.Vector3(0,0,1);for(C=0;C<R+1;C++)for(A=0;A<L;A++){var I=A*U-_/2,O=C*F-S/2;this.vertices.push(new THREE.Vector3(I,-O,0))}for(C=0;C<R;C++)for(A=0;A<P;A++){var B=A+L*C,G=A+L*(C+1),H=A+1+L*(C+1),W=A+1+L*C,X=new THREE.Face4(B,G,H,W);X.normal.copy(V),X.vertexNormals.push(V.clone(),V.clone(),V.clone(),V.clone()),this.faces.push(X),this.faceVertexUvs[0].push([new THREE.Vector2(A/P,1-C/R),new THREE.Vector2(A/P,1-(C+1)/R),new THREE.Vector2((A+1)/P,1-(C+1)/R),new THREE.Vector2((A+1)/P,1-C/R)])}this.computeCentroids()},THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.RingGeometry=function(_,S,M,T,A,C){THREE.Geometry.call(this),_=_||0,S=S||50,A=A===void 0?0:A,C=C===void 0?2*Math.PI:C,M=M===void 0?8:Math.max(3,M),T=T===void 0?8:Math.max(3,T);var P=[],R=_,L=(S-_)/T,E,D;for(E=0;E<=T;E++){for(D=0;D<=M;D++){var N=new THREE.Vector3,U=A+D/M*C;N.x=R*Math.cos(U),N.y=R*Math.sin(U),this.vertices.push(N),P.push(new THREE.Vector2((N.x/R+1)/2,-(N.y/R+1)/2+1))}R+=L}var F=new THREE.Vector3(0,0,1);for(E=0;E<T;E++){var V=E*M;for(D=0;D<=M;D++){var U=D+V,I=U+E,O=U+M+E,B=U+M+1+E;this.faces.push(new THREE.Face3(I,O,B,[F,F,F])),this.faceVertexUvs[0].push([P[I],P[O],P[B]]),I=U+E,O=U+M+1+E,B=U+1+E,this.faces.push(new THREE.Face3(I,O,B,[F,F,F])),this.faceVertexUvs[0].push([P[I],P[O],P[B]])}}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3(),R)},THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.SphereGeometry=function(_,S,M,T,A,C,E){THREE.Geometry.call(this),this.radius=_=_||50,this.widthSegments=S=Math.max(3,Math.floor(S)||8),this.heightSegments=M=Math.max(2,Math.floor(M)||6),this.phiStart=T=T===void 0?0:T,this.phiLength=A=A===void 0?2*Math.PI:A,this.thetaStart=C=C===void 0?0:C,this.thetaLength=E=E===void 0?Math.PI:E;var R=[],L=[],D,P;for(P=0;P<=M;P++){var N=[],U=[];for(D=0;D<=S;D++){var F=D/S,V=P/M,I=new THREE.Vector3;I.x=-_*Math.cos(T+F*A)*Math.sin(C+V*E),I.y=_*Math.cos(C+V*E),I.z=_*Math.sin(T+F*A)*Math.sin(C+V*E),this.vertices.push(I),N.push(this.vertices.length-1),U.push(new THREE.Vector2(F,1-V))}R.push(N),L.push(U)}for(P=0;P<this.heightSegments;P++)for(D=0;D<this.widthSegments;D++){var O=R[P][D+1],B=R[P][D],G=R[P+1][D],H=R[P+1][D+1],W=this.vertices[O].clone().normalize(),X=this.vertices[B].clone().normalize(),Y=this.vertices[G].clone().normalize(),K=this.vertices[H].clone().normalize(),Q=L[P][D+1].clone(),Z=L[P][D].clone(),J=L[P+1][D].clone(),ee=L[P+1][D+1].clone();Math.abs(this.vertices[O].y)===this.radius?(this.faces.push(new THREE.Face3(O,G,H,[W,Y,K])),this.faceVertexUvs[0].push([Q,J,ee])):Math.abs(this.vertices[G].y)===this.radius?(this.faces.push(new THREE.Face3(O,B,G,[W,X,Y])),this.faceVertexUvs[0].push([Q,Z,J])):(this.faces.push(new THREE.Face4(O,B,G,H,[W,X,Y,K])),this.faceVertexUvs[0].push([Q,Z,J,ee]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3(),_)},THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TextGeometry=function(_,S){S=S||{};var M=THREE.FontUtils.generateShapes(_,S);S.amount=S.height===void 0?50:S.height,S.bevelThickness===void 0&&(S.bevelThickness=10),S.bevelSize===void 0&&(S.bevelSize=8),S.bevelEnabled===void 0&&(S.bevelEnabled=!1),THREE.ExtrudeGeometry.call(this,M,S)},THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype),THREE.TorusGeometry=function(_,S,M,T,A){THREE.Geometry.call(this);this;this.radius=_||100,this.tube=S||40,this.radialSegments=M||8,this.tubularSegments=T||6,this.arc=A||2*Math.PI;for(var E=new THREE.Vector3,D=[],P=[],R=0;R<=this.radialSegments;R++)for(var L=0;L<=this.tubularSegments;L++){var N=L/this.tubularSegments*this.arc,U=2*(R/this.radialSegments*Math.PI);E.x=this.radius*Math.cos(N),E.y=this.radius*Math.sin(N);var F=new THREE.Vector3;F.x=(this.radius+this.tube*Math.cos(U))*Math.cos(N),F.y=(this.radius+this.tube*Math.cos(U))*Math.sin(N),F.z=this.tube*Math.sin(U),this.vertices.push(F),D.push(new THREE.Vector2(L/this.tubularSegments,R/this.radialSegments)),P.push(F.clone().sub(E).normalize())}for(var R=1;R<=this.radialSegments;R++)for(var L=1;L<=this.tubularSegments;L++){var V=(this.tubularSegments+1)*R+L-1,I=(this.tubularSegments+1)*(R-1)+L-1,O=(this.tubularSegments+1)*(R-1)+L,B=(this.tubularSegments+1)*R+L,G=new THREE.Face4(V,I,O,B,[P[V],P[I],P[O],P[B]]);G.normal.add(P[V]),G.normal.add(P[I]),G.normal.add(P[O]),G.normal.add(P[B]),G.normal.normalize(),this.faces.push(G),this.faceVertexUvs[0].push([D[V].clone(),D[I].clone(),D[O].clone(),D[B].clone()])}this.computeCentroids()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TorusKnotGeometry=function(_,S,M,T,A,C,E){function D(ne,se,le){return R.vertices.push(new THREE.Vector3(ne,se,le))-1}function P(ne,se,le,pe,ue,fe){var he=Math.cos(ne),ge=Math.cos(se),ye=Math.sin(ne),xe=le/pe*ne,_e=Math.cos(xe),Me=0.5*(fe*ue*Math.sin(xe));return new THREE.Vector3(0.5*(ue*(2+_e))*he,0.5*(ue*(2+_e)*ye),Me)}THREE.Geometry.call(this);var R=this;this.radius=_||100,this.tube=S||40,this.radialSegments=M||64,this.tubularSegments=T||8,this.p=A||2,this.q=C||3,this.heightScale=E||1,this.grid=Array(this.radialSegments);for(var L=new THREE.Vector3,N=new THREE.Vector3,U=new THREE.Vector3,F=0;F<this.radialSegments;++F){this.grid[F]=Array(this.tubularSegments);for(var V=0;V<this.tubularSegments;++V){var I=2*(F/this.radialSegments)*this.p*Math.PI,O=2*(V/this.tubularSegments)*Math.PI,B=P(I,O,this.q,this.p,this.radius,this.heightScale),G=P(I+0.01,O,this.q,this.p,this.radius,this.heightScale),H,W;L.subVectors(G,B),N.addVectors(G,B),U.crossVectors(L,N),N.crossVectors(U,L),U.normalize(),N.normalize(),H=-this.tube*Math.cos(O),W=this.tube*Math.sin(O),B.x+=H*N.x+W*U.x,B.y+=H*N.y+W*U.y,B.z+=H*N.z+W*U.z,this.grid[F][V]=D(B.x,B.y,B.z)}}for(var F=0;F<this.radialSegments;++F)for(var V=0;V<this.tubularSegments;++V){var X=(F+1)%this.radialSegments,Y=(V+1)%this.tubularSegments,K=this.grid[F][V],Q=this.grid[X][V],Z=this.grid[X][Y],J=this.grid[F][Y],ee=new THREE.Vector2(F/this.radialSegments,V/this.tubularSegments),re=new THREE.Vector2((F+1)/this.radialSegments,V/this.tubularSegments),oe=new THREE.Vector2((F+1)/this.radialSegments,(V+1)/this.tubularSegments),ie=new THREE.Vector2(F/this.radialSegments,(V+1)/this.tubularSegments);this.faces.push(new THREE.Face4(K,Q,Z,J)),this.faceVertexUvs[0].push([ee,re,oe,ie])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry=function(_,S,M,T,A,C){function E(xe,_e,ve){return D.vertices.push(new THREE.Vector3(xe,_e,ve))-1}THREE.Geometry.call(this),this.path=_,this.segments=S||64,this.radius=M||1,this.radiusSegments=T||8,this.closed=A||!1,C&&(this.debug=new THREE.Object3D),this.grid=[];var D=this,N=this.segments+1,K=new THREE.Vector3,P,R,L,G,H,W,X,Y,Q,Z,J,ee,re,oe,ie,ne,se,le,pe,ue,fe=new THREE.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed),he=fe.tangents,ge=fe.normals,ye=fe.binormals;for(this.tangents=he,this.normals=ge,this.binormals=ye,Q=0;Q<N;Q++)for(this.grid[Q]=[],G=Q/(N-1),Y=_.getPointAt(G),P=he[Q],R=ge[Q],L=ye[Q],this.debug&&(this.debug.add(new THREE.ArrowHelper(P,Y,M,255)),this.debug.add(new THREE.ArrowHelper(R,Y,M,16711680)),this.debug.add(new THREE.ArrowHelper(L,Y,M,65280))),Z=0;Z<this.radiusSegments;Z++)H=2*(Z/this.radiusSegments)*Math.PI,W=-this.radius*Math.cos(H),X=this.radius*Math.sin(H),K.copy(Y),K.x+=W*R.x+X*L.x,K.y+=W*R.y+X*L.y,K.z+=W*R.z+X*L.z,this.grid[Q][Z]=E(K.x,K.y,K.z);for(Q=0;Q<this.segments;Q++)for(Z=0;Z<this.radiusSegments;Z++)J=this.closed?(Q+1)%this.segments:Q+1,ee=(Z+1)%this.radiusSegments,re=this.grid[Q][Z],oe=this.grid[J][Z],ie=this.grid[J][ee],ne=this.grid[Q][ee],se=new THREE.Vector2(Q/this.segments,Z/this.radiusSegments),le=new THREE.Vector2((Q+1)/this.segments,Z/this.radiusSegments),pe=new THREE.Vector2((Q+1)/this.segments,(Z+1)/this.radiusSegments),ue=new THREE.Vector2(Q/this.segments,(Z+1)/this.radiusSegments),this.faces.push(new THREE.Face4(re,oe,ie,ne)),this.faceVertexUvs[0].push([se,le,pe,ue]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry.FrenetFrames=function(_,S,M){function C(){L[0]=new THREE.Vector3,N[0]=new THREE.Vector3,B=Number.MAX_VALUE,G=Math.abs(R[0].x),H=Math.abs(R[0].y),W=Math.abs(R[0].z),G<=B&&(B=G,D.set(1,0,0)),H<=B&&(B=H,D.set(0,1,0)),W<=B&&D.set(0,0,1),U.crossVectors(R[0],D).normalize(),L[0].crossVectors(R[0],U),N[0].crossVectors(R[0],L[0])}var E=new THREE.Vector3,D=new THREE.Vector3,P=new THREE.Vector3,R=[],L=[],N=[],U=new THREE.Vector3,F=new THREE.Matrix4,V=S+1,O=1e-4,I,B,G,H,W,X,Y;for(this.tangents=R,this.normals=L,this.binormals=N,X=0;X<V;X++)Y=X/(V-1),R[X]=_.getTangentAt(Y),R[X].normalize();for(C(),X=1;X<V;X++)L[X]=L[X-1].clone(),N[X]=N[X-1].clone(),U.crossVectors(R[X-1],R[X]),U.length()>O&&(U.normalize(),I=Math.acos(R[X-1].dot(R[X])),L[X].applyMatrix4(F.makeRotationAxis(U,I))),N[X].crossVectors(R[X],L[X]);if(M)for(I=Math.acos(L[0].dot(L[V-1])),I/=V-1,0<R[0].dot(U.crossVectors(L[0],L[V-1]))&&(I=-I),X=1;X<V;X++)L[X].applyMatrix4(F.makeRotationAxis(R[X],I*X)),N[X].crossVectors(R[X],L[X])},THREE.PolyhedronGeometry=function(_,S,M,T){function A(Z){var J=Z.normalize().clone();J.index=L.vertices.push(J)-1;var ee=D(Z)/2/Math.PI+0.5,re=P(Z)/Math.PI+0.5;return J.uv=new THREE.Vector2(ee,1-re),J}function C(Z,J,ee){var re=new THREE.Face3(Z.index,J.index,ee.index,[Z.clone(),J.clone(),ee.clone()]);re.centroid.add(Z).add(J).add(ee).divideScalar(3),re.normal.copy(re.centroid).normalize(),L.faces.push(re);var oe=D(re.centroid);L.faceVertexUvs[0].push([R(Z.uv,Z,oe),R(J.uv,J,oe),R(ee.uv,ee,oe)])}function E(Z,J){for(var ee=Math.pow(2,J),re=Math.pow(4,J),oe=A(L.vertices[Z.a]),ie=A(L.vertices[Z.b]),ne=A(L.vertices[Z.c]),se=[],le=0;le<=ee;le++){se[le]=[];for(var pe=A(oe.clone().lerp(ne,le/ee)),ue=A(ie.clone().lerp(ne,le/ee)),fe=ee-le,he=0;he<=fe;he++)se[le][he]=0==he&&le==ee?pe:A(pe.clone().lerp(ue,he/fe))}for(var le=0;le<ee;le++)for(var he=0,ge;he<2*(ee-le)-1;he++)ge=Math.floor(he/2),0==he%2?C(se[le][ge+1],se[le+1][ge],se[le][ge]):C(se[le][ge+1],se[le+1][ge+1],se[le+1][ge])}function D(Z){return Math.atan2(Z.z,-Z.x)}function P(Z){return Math.atan2(-Z.y,Math.sqrt(Z.x*Z.x+Z.z*Z.z))}function R(Z,J,ee){return 0>ee&&1===Z.x&&(Z=new THREE.Vector2(Z.x-1,Z.y)),0===J.x&&0===J.z&&(Z=new THREE.Vector2(ee/2/Math.PI+0.5,Z.y)),Z.clone()}THREE.Geometry.call(this),M=M||1,T=T||0;for(var L=this,N=0,U=_.length;N<U;N++)A(new THREE.Vector3(_[N][0],_[N][1],_[N][2]));for(var V=this.vertices,I=[],N=0,U=S.length;N<U;N++){var O=V[S[N][0]],B=V[S[N][1]],G=V[S[N][2]];I[N]=new THREE.Face3(O.index,B.index,G.index,[O.clone(),B.clone(),G.clone()])}for(var N=0,U=I.length;N<U;N++)E(I[N],T);for(var N=0,U=this.faceVertexUvs[0].length;N<U;N++){var H=this.faceVertexUvs[0][N],W=H[0].x,X=H[1].x,Y=H[2].x,K=Math.max(W,Math.max(X,Y)),Q=Math.min(W,Math.min(X,Y));0.9<K&&0.1>Q&&(0.2>W&&(H[0].x+=1),0.2>X&&(H[1].x+=1),0.2>Y&&(H[2].x+=1))}this.mergeVertices();for(var N=0,U=this.vertices.length;N<U;N++)this.vertices[N].multiplyScalar(M);this.computeCentroids(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3(),M)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.IcosahedronGeometry=function(_,S){this.radius=_,this.detail=S;var M=(1+Math.sqrt(5))/2;THREE.PolyhedronGeometry.call(this,[[-1,M,0],[1,M,0],[-1,-M,0],[1,-M,0],[0,-1,M],[0,1,M],[0,-1,-M],[0,1,-M],[M,0,-1],[M,0,1],[-M,0,-1],[-M,0,1]],[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],_,S)},THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.OctahedronGeometry=function(_,S){THREE.PolyhedronGeometry.call(this,[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]],_,S)},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TetrahedronGeometry=function(_,S){THREE.PolyhedronGeometry.call(this,[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],[[2,1,0],[0,3,2],[1,3,0],[2,3,1]],_,S)},THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ParametricGeometry=function(_,S,M,T){THREE.Geometry.call(this);var A=this.vertices,C=this.faces,E=this.faceVertexUvs[0];T=T!==void 0&&T;var D,R,L,N,U,V=S+1;for(D=0;D<=M;D++)for(U=D/M,R=0;R<=S;R++)N=R/S,L=_(N,U),A.push(L);var I,O,B,G,H,W,X,Y;for(D=0;D<M;D++)for(R=0;R<S;R++)I=D*V+R,O=D*V+R+1,B=(D+1)*V+R,G=(D+1)*V+R+1,H=new THREE.Vector2(R/S,D/M),W=new THREE.Vector2((R+1)/S,D/M),X=new THREE.Vector2(R/S,(D+1)/M),Y=new THREE.Vector2((R+1)/S,(D+1)/M),T?(C.push(new THREE.Face3(I,O,B)),C.push(new THREE.Face3(O,G,B)),E.push([H,W,X]),E.push([W,Y,X])):(C.push(new THREE.Face4(I,O,G,B)),E.push([H,W,Y,X]));this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ConvexGeometry=function(_){function S(F){var V=_[F].clone(),I=V.length();V.x+=I*C(),V.y+=I*C(),V.z+=I*C();for(var O=[],B=0,G;B<D.length;)if(G=D[B],M(G,V)){for(var H=0;3>H;H++){for(var W=[G[H],G[(H+1)%3]],X=!0,Y=0;Y<O.length;Y++)if(A(O[Y],W)){O[Y]=O[O.length-1],O.pop(),X=!1;break}X&&O.push(W)}D[B]=D[D.length-1],D.pop()}else B++;for(var Y=0;Y<O.length;Y++)D.push([O[Y][0],O[Y][1],F])}function M(F,V){var I=_[F[0]],O=_[F[1]],B=_[F[2]],G=T(I,O,B),H=G.dot(I);return G.dot(V)>=H}function T(F,V,I){var O=new THREE.Vector3,B=new THREE.Vector3;return O.subVectors(I,V),B.subVectors(F,V),O.cross(B),O.normalize(),O}function A(F,V){return F[0]===V[1]&&F[1]===V[0]}function C(){return 1e-6*(2*(Math.random()-0.5))}function E(F){var V=F.length();return new THREE.Vector2(F.x/V,F.y/V)}THREE.Geometry.call(this);for(var D=[[0,1,2],[0,2,1]],P=3;P<_.length;P++)S(P);for(var R=0,L=Array(_.length),P=0,N;P<D.length;P++){N=D[P];for(var U=0;3>U;U++)void 0===L[N[U]]&&(L[N[U]]=R++,this.vertices.push(_[N[U]])),N[U]=L[N[U]]}for(var P=0;P<D.length;P++)this.faces.push(new THREE.Face3(D[P][0],D[P][1],D[P][2]));for(var P=0,N;P<this.faces.length;P++)N=this.faces[P],this.faceVertexUvs[0].push([E(this.vertices[N.a]),E(this.vertices[N.b]),E(this.vertices[N.c])]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.ConvexGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this),this.render=function(){}},THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype),THREE.MorphBlendMesh=function(_,S){THREE.Mesh.call(this,_,S),this.animationsMap={},this.animationsList=[];var M=this.geometry.morphTargets.length,T='__default';this.createAnimation(T,0,M-1,M/1),this.setAnimationWeight(T,1)},THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphBlendMesh.prototype.createAnimation=function(_,S,M,T){var A={startFrame:S,endFrame:M,length:M-S+1,fps:T,duration:(M-S)/T,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[_]=A,this.animationsList.push(A)},THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(_){for(var S=/([a-z]+)(\d+)/,T={},A=this.geometry,C=0,E=A.morphTargets.length,M;C<E;C++){var D=A.morphTargets[C],P=D.name.match(S);if(P&&1<P.length){var R=P[1],L=P[2];T[R]||(T[R]={start:Infinity,end:-Infinity});var N=T[R];C<N.start&&(N.start=C),C>N.end&&(N.end=C),M||(M=R)}}for(var R in T){var N=T[R];this.createAnimation(R,N.start,N.end,_)}this.firstAnimation=M},THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(_){var S=this.animationsMap[_];S&&(S.direction=1,S.directionBackwards=!1)},THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(_){var S=this.animationsMap[_];S&&(S.direction=-1,S.directionBackwards=!0)},THREE.MorphBlendMesh.prototype.setAnimationFPS=function(_,S){var M=this.animationsMap[_];M&&(M.fps=S,M.duration=(M.end-M.start)/M.fps)},THREE.MorphBlendMesh.prototype.setAnimationDuration=function(_,S){var M=this.animationsMap[_];M&&(M.duration=S,M.fps=(M.end-M.start)/M.duration)},THREE.MorphBlendMesh.prototype.setAnimationWeight=function(_,S){var M=this.animationsMap[_];M&&(M.weight=S)},THREE.MorphBlendMesh.prototype.setAnimationTime=function(_,S){var M=this.animationsMap[_];M&&(M.time=S)},THREE.MorphBlendMesh.prototype.getAnimationTime=function(_){var S=0,M=this.animationsMap[_];return M&&(S=M.time),S},THREE.MorphBlendMesh.prototype.getAnimationDuration=function(_){var S=-1,M=this.animationsMap[_];return M&&(S=M.duration),S},THREE.MorphBlendMesh.prototype.playAnimation=function(_){var S=this.animationsMap[_];S&&(S.time=0,S.active=!0)},THREE.MorphBlendMesh.prototype.stopAnimation=function(_){var S=this.animationsMap[_];S&&(S.active=!1)},THREE.MorphBlendMesh.prototype.update=function(_){for(var S=0,M=this.animationsList.length,T;S<M;S++)if(T=this.animationsList[S],T.active){var A=T.duration/T.length;T.time+=T.direction*_,T.mirroredLoop?(T.time>T.duration||0>T.time)&&(T.direction*=-1,T.time>T.duration&&(T.time=T.duration,T.directionBackwards=!0),0>T.time&&(T.time=0,T.directionBackwards=!1)):(T.time%=T.duration,0>T.time&&(T.time+=T.duration));var C=T.startFrame+THREE.Math.clamp(Math.floor(T.time/A),0,T.length-1),E=T.weight;C!==T.currentFrame&&(this.morphTargetInfluences[T.lastFrame]=0,this.morphTargetInfluences[T.currentFrame]=1*E,this.morphTargetInfluences[C]=0,T.lastFrame=T.currentFrame,T.currentFrame=C);var D=T.time%A/A;T.directionBackwards&&(D=1-D),this.morphTargetInfluences[T.currentFrame]=D*E,this.morphTargetInfluences[T.lastFrame]=(1-D)*E}},THREE.SpritePlugin=function(){function _(E,D){var P=M.createProgram(),R=M.createShader(M.FRAGMENT_SHADER),L=M.createShader(M.VERTEX_SHADER),N='precision '+D+' float;\n';return self.MMD_SA&&MMD_SA.use_webgl2?(M.shaderSource(R,MMD_SA.webgl2_fshader_prefix_convert(N)+MMD_SA.webgl2_fshader_main_convert(E.fragmentShader)),M.shaderSource(L,MMD_SA.webgl2_vshader_prefix_convert(N)+MMD_SA.webgl2_vshader_main_convert(E.vertexShader))):(M.shaderSource(R,N+E.fragmentShader),M.shaderSource(L,N+E.vertexShader)),M.compileShader(R),M.compileShader(L),M.getShaderParameter(R,M.COMPILE_STATUS)||console.error(M.getShaderInfoLog(R)),M.getShaderParameter(L,M.COMPILE_STATUS)||console.error(M.getShaderInfoLog(R)),M.attachShader(P,R),M.attachShader(P,L),M.linkProgram(P),P}function S(E,D){return E.z===D.z?D.id-E.id:D.z-E.z}var C={},M,T,A;this.init=function(E){M=E.context,T=E,A=E.getPrecision(),C.vertices=new Float32Array(16),C.faces=new Uint16Array(6);var D=0;C.vertices[D++]=-1,C.vertices[D++]=-1,C.vertices[D++]=0,C.vertices[D++]=0,C.vertices[D++]=1,C.vertices[D++]=-1,C.vertices[D++]=1,C.vertices[D++]=0,C.vertices[D++]=1,C.vertices[D++]=1,C.vertices[D++]=1,C.vertices[D++]=1,C.vertices[D++]=-1,C.vertices[D++]=1,C.vertices[D++]=0,C.vertices[D++]=1,D=0,C.faces[D++]=0,C.faces[D++]=1,C.faces[D++]=2,C.faces[D++]=0,C.faces[D++]=2,C.faces[D++]=3,C.vertexBuffer=M.createBuffer(),C.elementBuffer=M.createBuffer(),M.bindBuffer(M.ARRAY_BUFFER,C.vertexBuffer),M.bufferData(M.ARRAY_BUFFER,C.vertices,M.STATIC_DRAW),M.bindBuffer(M.ELEMENT_ARRAY_BUFFER,C.elementBuffer),M.bufferData(M.ELEMENT_ARRAY_BUFFER,C.faces,M.STATIC_DRAW),C.program=_(THREE.ShaderSprite.sprite,A),C.attributes={},C.uniforms={},C.attributes.position=M.getAttribLocation(C.program,'position'),C.attributes.uv=M.getAttribLocation(C.program,'uv'),C.uniforms.uvOffset=M.getUniformLocation(C.program,'uvOffset'),C.uniforms.uvScale=M.getUniformLocation(C.program,'uvScale'),C.uniforms.rotation=M.getUniformLocation(C.program,'rotation'),C.uniforms.scale=M.getUniformLocation(C.program,'scale'),C.uniforms.alignment=M.getUniformLocation(C.program,'alignment'),C.uniforms.color=M.getUniformLocation(C.program,'color'),C.uniforms.map=M.getUniformLocation(C.program,'map'),C.uniforms.opacity=M.getUniformLocation(C.program,'opacity'),C.uniforms.useScreenCoordinates=M.getUniformLocation(C.program,'useScreenCoordinates'),C.uniforms.sizeAttenuation=M.getUniformLocation(C.program,'sizeAttenuation'),C.uniforms.screenPosition=M.getUniformLocation(C.program,'screenPosition'),C.uniforms.modelViewMatrix=M.getUniformLocation(C.program,'modelViewMatrix'),C.uniforms.projectionMatrix=M.getUniformLocation(C.program,'projectionMatrix'),C.uniforms.fogType=M.getUniformLocation(C.program,'fogType'),C.uniforms.fogDensity=M.getUniformLocation(C.program,'fogDensity'),C.uniforms.fogNear=M.getUniformLocation(C.program,'fogNear'),C.uniforms.fogFar=M.getUniformLocation(C.program,'fogFar'),C.uniforms.fogColor=M.getUniformLocation(C.program,'fogColor'),C.uniforms.alphaTest=M.getUniformLocation(C.program,'alphaTest'),C.uniforms.depth_render_mode=M.getUniformLocation(C.program,'depth_render_mode')},this.render=function(E,D,P,R){var L=E.__webglSprites,N=L.length;if(N){var U=C.attributes,F=C.uniforms,I=0.5*P,O=0.5*R;M.useProgram(C.program),M.enableVertexAttribArray(U.position),M.enableVertexAttribArray(U.uv),M.disable(M.CULL_FACE),M.enable(M.BLEND),M.bindBuffer(M.ARRAY_BUFFER,C.vertexBuffer),M.vertexAttribPointer(U.position,2,M.FLOAT,!1,16,0),M.vertexAttribPointer(U.uv,2,M.FLOAT,!1,16,8),M.bindBuffer(M.ELEMENT_ARRAY_BUFFER,C.elementBuffer),M.uniformMatrix4fv(F.projectionMatrix,!1,D.projectionMatrix.elements),M.activeTexture(M.TEXTURE0),M.uniform1i(F.map,0),self.MMD_SA&&M.uniform1i(F.depth_render_mode,MMD_SA._depth_render_mode_);var B=0,G=0,H=E.fog;H?(M.uniform3f(F.fogColor,H.color.r,H.color.g,H.color.b),H instanceof THREE.Fog?(M.uniform1f(F.fogNear,H.near),M.uniform1f(F.fogFar,H.far),M.uniform1i(F.fogType,1),B=1,G=1):H instanceof THREE.FogExp2&&(M.uniform1f(F.fogDensity,H.density),M.uniform1i(F.fogType,2),B=2,G=2)):(M.uniform1i(F.fogType,0),B=0,G=0);var J=[],W,X,Y,Q,Z;for(W=0;W<N;W++)X=L[W],Y=X.material,!X.visible||0===Y.opacity||(Y.useScreenCoordinates?X.z=-X.position.z:(X._modelViewMatrix.multiplyMatrices(D.matrixWorldInverse,X.matrixWorld),X.z=-X._modelViewMatrix.elements[14]));for(L.sort(S),W=0;W<N;W++)X=L[W],Y=X.material,X.visible&&0!==Y.opacity&&Y.map&&Y.map.image&&Y.map.image.width&&(M.uniform1f(F.alphaTest,Y.alphaTest),!0===Y.useScreenCoordinates?(M.uniform1i(F.useScreenCoordinates,1),M.uniform3f(F.screenPosition,(X.position.x*T.devicePixelRatio-I)/I,(O-X.position.y*T.devicePixelRatio)/O,Math.max(0,Math.min(1,X.position.z))),J[0]=T.devicePixelRatio,J[1]=T.devicePixelRatio):(M.uniform1i(F.useScreenCoordinates,0),M.uniform1i(F.sizeAttenuation,Y.sizeAttenuation?1:0),M.uniformMatrix4fv(F.modelViewMatrix,!1,X._modelViewMatrix.elements),J[0]=1,J[1]=1),Z=E.fog&&Y.fog?G:0,B!==Z&&(M.uniform1i(F.fogType,Z),B=Z),Q=1/(Y.scaleByViewport?R:1),J[0]*=Q*(R/P)*X.scale.x,J[1]*=Q*X.scale.y,M.uniform2f(F.uvScale,Y.uvScale.x,Y.uvScale.y),M.uniform2f(F.uvOffset,Y.uvOffset.x,Y.uvOffset.y),M.uniform2f(F.alignment,Y.alignment.x,Y.alignment.y),M.uniform1f(F.opacity,Y.opacity),M.uniform3f(F.color,Y.color.r,Y.color.g,Y.color.b),M.uniform1f(F.rotation,X.rotation),M.uniform2fv(F.scale,J),T.setBlending(Y.blending,Y.blendEquation,Y.blendSrc,Y.blendDst),T.setDepthTest(Y.depthTest),T.setDepthWrite(Y.depthWrite),T.setTexture(Y.map,0),M.drawElements(M.TRIANGLES,6,M.UNSIGNED_SHORT,0));M.enable(M.CULL_FACE)}}},THREE.ShaderSprite={sprite:{vertexShader:['uniform int useScreenCoordinates;','uniform int sizeAttenuation;','uniform vec3 screenPosition;','uniform mat4 modelViewMatrix;','uniform mat4 projectionMatrix;','uniform float rotation;','uniform vec2 scale;','uniform vec2 alignment;','uniform vec2 uvOffset;','uniform vec2 uvScale;','attribute vec2 position;','attribute vec2 uv;','varying vec2 vUV;','void main() {','vUV = uvOffset + uv * uvScale;','vec2 alignedPosition = position + alignment;','vec2 rotatedPosition;','rotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;','rotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;','vec4 finalPosition;','if( useScreenCoordinates != 0 ) {','finalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );','} else {','finalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );','finalPosition.xy += rotatedPosition * ( sizeAttenuation == 1 ? 1.0 : finalPosition.z );','}','gl_Position = finalPosition;','}'].join('\n'),fragmentShader:['uniform vec3 color;','uniform sampler2D map;','uniform float opacity;','uniform int fogType;','uniform vec3 fogColor;','uniform float fogDensity;','uniform float fogNear;','uniform float fogFar;','uniform float alphaTest;','varying vec2 vUV;','#define SKIP_SAO_DEPTH',THREE.ShaderChunk.AT_depth_render_mode_pars_fragment,'void main() {',THREE.ShaderChunk.AT_depth_render_mode_fragment,'vec4 texture = texture2D( map, vUV );','if ( texture.a < alphaTest ) discard;','gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );','if ( fogType > 0 ) {','float depth = gl_FragCoord.z / gl_FragCoord.w;','float fogFactor = 0.0;','if ( fogType == 1 ) {','fogFactor = smoothstep( fogNear, fogFar, depth );','} else {','const float LOG2 = 1.442695;','float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );','fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );','}','gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );','}','}'].join('\n')}},THREE.AxisHelper=function(_){_=_||1;var S=new THREE.Geometry;S.vertices.push(new THREE.Vector3,new THREE.Vector3(_,0,0),new THREE.Vector3,new THREE.Vector3(0,_,0),new THREE.Vector3,new THREE.Vector3(0,0,_)),S.colors.push(new THREE.Color(16711680),new THREE.Color(16755200),new THREE.Color(65280),new THREE.Color(11206400),new THREE.Color(255),new THREE.Color(43775));var M=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.Line.call(this,S,M,THREE.LinePieces)},THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype),function(_){function S(){this.header=null,this.offset=0,this.use_rle=!1,this.use_pal=!1,this.use_rgb=!1,this.use_grey=!1}S.TYPE_NO_DATA=0,S.TYPE_INDEXED=1,S.TYPE_RGB=2,S.TYPE_GREY=3,S.TYPE_RLE_INDEXED=9,S.TYPE_RLE_RGB=10,S.TYPE_RLE_GREY=11,S.ORIGIN_MASK=48,S.ORIGIN_SHIFT=4,S.ORIGIN_BL=0,S.ORIGIN_BR=1,S.ORIGIN_UL=2,S.ORIGIN_UR=3,S.prototype.open=function(T,A,C){var D=this,E;E=new XMLHttpRequestZIP,E.open('GET',T,!0),E.responseType='arraybuffer',E.onload=function(){D.load(new Uint8Array(E.response)),A&&A.call(D)},E.onerror=function(){C&&C.call(D)},E.send(null)},S.prototype.load=function(T){if(19>T.length)throw new Error('Targa::load() - Not enough data to contain header.');if(this.offset=0,this.header={id_length:T[this.offset++],colormap_type:T[this.offset++],image_type:T[this.offset++],colormap_index:T[this.offset++]|T[this.offset++]<<8,colormap_length:T[this.offset++]|T[this.offset++]<<8,colormap_size:T[this.offset++],origin:[T[this.offset++]|T[this.offset++]<<8,T[this.offset++]|T[this.offset++]<<8],width:T[this.offset++]|T[this.offset++]<<8,height:T[this.offset++]|T[this.offset++]<<8,pixel_size:T[this.offset++],flags:T[this.offset++]},this.checkHeader(),this.header.id_length+this.offset>T.length)throw new Error('Targa::load() - No data ?');switch(this.offset+=this.header.id_length,this.header.image_type){case S.TYPE_RLE_INDEXED:this.use_rle=!0;case S.TYPE_INDEXED:this.use_pal=!0;break;case S.TYPE_RLE_RGB:this.use_rle=!0;case S.TYPE_RGB:this.use_rgb=!0;break;case S.TYPE_RLE_GREY:this.use_rle=!0;case S.TYPE_GREY:this.use_grey=!0;}this.parse(T)},S.prototype.checkHeader=function(){switch(this.header.image_type){case S.TYPE_INDEXED:case S.TYPE_RLE_INDEXED:if(256<this.header.colormap_length||24!==this.header.colormap_size||1!==this.header.colormap_type)throw new Error('Targa::checkHeader() - Invalid type colormap data for indexed type');break;case S.TYPE_RGB:case S.TYPE_GREY:case S.TYPE_RLE_RGB:case S.TYPE_RLE_GREY:if(this.header.colormap_type)throw new Error('Targa::checkHeader() - Invalid type colormap data for colormap type');break;case S.TYPE_NO_DATA:throw new Error('Targa::checkHeader() - No data on this TGA file');default:throw new Error('Targa::checkHeader() - Invalid type \''+this.header.image_type+'\'');}if(0>=this.header.width||0>=this.header.height)throw new Error('Targa::checkHeader() - Invalid image size');if(8!==this.header.pixel_size&&16!==this.header.pixel_size&&24!==this.header.pixel_size&&32!==this.header.pixel_size)throw new Error('Targa::checkHeader() - Invalid pixel size \''+this.header.pixel_size+'\'')},S.prototype.parse=function(T){var A,C,E,D,P;if(A=this.header,C=15&A.flags,D=A.pixel_size>>3,P=A.width*A.height*D,this.use_pal&&(this.palettes=T.subarray(this.offset,this.offset+=A.colormap_length*D)),this.use_rle){E=new Uint8Array(P);for(var U=0,F=new Uint8Array(D),R,L,N;U<P;)if(R=T[this.offset++],L=(127&R)+1,128&R){for(N=0;N<D;++N)F[N]=T[this.offset++];for(N=0;N<L;++N)E.set(F,U+N*D);U+=D*L}else{for(L*=D,N=0;N<L;++N)E[U+N]=T[this.offset++];U+=L}}else E=T.subarray(this.offset,this.offset+=this.use_pal?A.width*A.height:P);this.image=E},S.prototype.getImageData=function(T){var A=this.header.width,C=this.header.height,E,D,P,R,L,N,U,F;switch(F=T||document&&document.createElement('canvas').getContext('2d').createImageData(A,C)||{width:A,height:C,data:new Uint8Array(4*(A*C))},(this.header.flags&S.ORIGIN_MASK)>>S.ORIGIN_SHIFT){default:case S.ORIGIN_UL:E=0,P=1,N=A,D=0,R=1,L=C;break;case S.ORIGIN_BL:E=0,P=1,N=A,D=C-1,R=-1,L=-1;break;case S.ORIGIN_UR:E=A-1,P=-1,N=-1,D=0,R=1,L=C;break;case S.ORIGIN_BR:E=A-1,P=-1,N=-1,D=C-1,R=-1,L=-1;}return U='getImageData'+(this.use_grey?'Grey':'')+this.header.pixel_size+'bits',this[U](F.data,D,R,L,E,P,N),F},S.prototype.getCanvas=function(){var T=document.createElement('canvas'),A=T.getContext('2d'),C=A.createImageData(this.header.width,this.header.height);return T.width=this.header.width,T.height=this.header.height,A.putImageData(this.getImageData(C),0,0),T},S.prototype.getDataURL=function(T){return this.getCanvas().toDataURL(T||'image/png')},S.prototype.getImageData8bits=function(T,A,C,E,D,P,R){var L=this.image,N=this.palettes,U=this.header.width,F=this.header.height,V,I=0,O,B;for(B=A;B!==E;B+=C)for(O=D;O!==R;O+=P,I++)V=L[I],T[4*(O+U*B)+3]=255,T[4*(O+U*B)+2]=N[3*V+0],T[4*(O+U*B)+1]=N[3*V+1],T[4*(O+U*B)+0]=N[3*V+2];return T},S.prototype.getImageData16bits=function(T,A,C,E,D,P,R){var L=this.image,N=this.header.width,U=this.header.height,F,V=0,I,O;for(O=A;O!==E;O+=C)for(I=D;I!==R;I+=P,V+=2)F=L[V+0]+(L[V+1]<<8),T[4*(I+N*O)+0]=(31744&F)>>7,T[4*(I+N*O)+1]=(992&F)>>2,T[4*(I+N*O)+2]=(31&F)>>3,T[4*(I+N*O)+3]=32768&F?0:255;return T},S.prototype.getImageData24bits=function(T,A,C,E,D,P,R){var L=this.image,N=this.header.width,U=this.header.height,F=0,V,I;for(I=A;I!==E;I+=C)for(V=D;V!==R;V+=P,F+=3)T[4*(V+N*I)+3]=255,T[4*(V+N*I)+2]=L[F+0],T[4*(V+N*I)+1]=L[F+1],T[4*(V+N*I)+0]=L[F+2];return T},S.prototype.getImageData32bits=function(T,A,C,E,D,P,R){var L=this.image,N=this.header.width,U=this.header.height,F=0,V,I;for(I=A;I!==E;I+=C)for(V=D;V!==R;V+=P,F+=4)T[4*(V+N*I)+2]=L[F+0],T[4*(V+N*I)+1]=L[F+1],T[4*(V+N*I)+0]=L[F+2],T[4*(V+N*I)+3]=L[F+3];return T},S.prototype.getImageDataGrey8bits=function(T,A,C,E,D,P,R){var L=this.image,N=this.header.width,U=this.header.height,F,V=0,I,O;for(O=A;O!==E;O+=C)for(I=D;I!==R;I+=P,V++)F=L[V],T[4*(I+N*O)+0]=F,T[4*(I+N*O)+1]=F,T[4*(I+N*O)+2]=F,T[4*(I+N*O)+3]=255;return T},S.prototype.getImageDataGrey16bits=function(T,A,C,E,D,P,R){var L=this.image,N=this.header.width,U=this.header.height,F=0,V,I;for(I=A;I!==E;I+=C)for(V=D;V!==R;V+=P,F+=2)T[4*(V+N*I)+0]=L[F+0],T[4*(V+N*I)+1]=L[F+0],T[4*(V+N*I)+2]=L[F+0],T[4*(V+N*I)+3]=L[F+1];return T},'undefined'!=typeof _&&(_.TGA=S)}(THREE),function(_,S,M){'use strict';function T(F,V,I){var O=F.runtimeStyle&&F.runtimeStyle[V],G=F.style,B;return!/^-?[0-9]+\.?[0-9]*(?:px)?$/i.test(I)&&/^-?\d/.test(I)&&(B=G.left,O&&(F.runtimeStyle.left=F.currentStyle.left),G.left='fontSize'===V?'1em':I||0,I=G.pixelLeft+'px',G.left=B,O&&(F.runtimeStyle.left=O)),/^(thin|medium|thick)$/i.test(I)?I:Math.round(parseFloat(I))+'px'}function A(F){return parseInt(F,10)}function C(F,V,I,O){if(F=(F||'').split(','),F=F[O||0]||F[0]||'auto',F=R.Util.trimText(F).split(' '),'backgroundSize'===I&&(!F[0]||F[0].match(/cover|contain|auto/)));else{if(F[0]=-1===F[0].indexOf('%')?T(V,I+'X',F[0]):F[0],F[1]===M){if('backgroundSize'===I)return F[1]='auto',F;F[1]=F[0]}F[1]=-1===F[1].indexOf('%')?T(V,I+'Y',F[1]):F[1]}return F}function E(F,V,I,O,B,G){var H=R.Util.getCSS(V,F,B),W,X,Y,K;if(1===H.length&&(K=H[0],H=[],H[0]=K,H[1]=K),-1!==H[0].toString().indexOf('%'))Y=parseFloat(H[0])/100,X=I.width*Y,'backgroundSize'!==F&&(X-=(G||O).width*Y);else if('backgroundSize'!==F)X=parseInt(H[0],10);else if('auto'===H[0])X=O.width;else if(/contain|cover/.test(H[0])){var Q=R.Util.resizeBounds(O.width,O.height,I.width,I.height,H[0]);X=Q.width,W=Q.height}else X=parseInt(H[0],10);return'auto'===H[1]?W=X/O.width*O.height:-1===H[1].toString().indexOf('%')?W=parseInt(H[1],10):(Y=parseFloat(H[1])/100,W=I.height*Y,'backgroundSize'!==F&&(W-=(G||O).height*Y)),[X,W]}function D(F,V){var I=[];return{storage:I,width:F,height:V,clip:function(){I.push({type:'function',name:'clip',arguments:arguments})},translate:function(){I.push({type:'function',name:'translate',arguments:arguments})},fill:function(){I.push({type:'function',name:'fill',arguments:arguments})},save:function(){I.push({type:'function',name:'save',arguments:arguments})},restore:function(){I.push({type:'function',name:'restore',arguments:arguments})},fillRect:function(){I.push({type:'function',name:'fillRect',arguments:arguments})},createPattern:function(){I.push({type:'function',name:'createPattern',arguments:arguments})},drawShape:function(){var O=[];return I.push({type:'function',name:'drawShape',arguments:O}),{moveTo:function(){O.push({name:'moveTo',arguments:arguments})},lineTo:function(){O.push({name:'lineTo',arguments:arguments})},arcTo:function(){O.push({name:'arcTo',arguments:arguments})},bezierCurveTo:function(){O.push({name:'bezierCurveTo',arguments:arguments})},quadraticCurveTo:function(){O.push({name:'quadraticCurveTo',arguments:arguments})}}},drawImage:function(){I.push({type:'function',name:'drawImage',arguments:arguments})},fillText:function(){I.push({type:'function',name:'fillText',arguments:arguments})},setVariable:function(O,B){return I.push({type:'variable',name:O,arguments:B}),B}}}function P(F){return{zindex:F,children:[]}}var R={},L,N;R.Util={},R.Util.log=function(F){R.logging&&_.console&&_.console.log&&_.console.log(F)},R.Util.trimText=function(F){return function(V){return F?F.apply(V):((V||'')+'').replace(/^\s+|\s+$/g,'')}}(String.prototype.trim),R.Util.asFloat=function(F){return parseFloat(F)},function(){var F=/((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g,V=/(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g;R.Util.parseTextShadows=function(I){if(!I||'none'===I)return[];for(var O=I.match(F),B=[],G=0,H;O&&G<O.length;G++)H=O[G].match(V),B.push({color:H[0],offsetX:H[1]?H[1].replace('px',''):0,offsetY:H[2]?H[2].replace('px',''):0,blur:H[3]?H[3].replace('px',''):0});return B}}(),R.Util.parseBackgroundImage=function(F){var W=[],Y=0,K=0,J=function(){I&&('"'===O.substr(0,1)&&(O=O.substr(1,O.length-2)),O&&Z.push(O),'-'===I.substr(0,1)&&0<(G=I.indexOf('-',1)+1)&&(B=I.substr(0,G),I=I.substr(G)),W.push({prefix:B,method:I.toLowerCase(),value:H,args:Z})),Z=[],I=B=O=H=''},I,O,B,G,H,X,Q,Z;J();for(var ee=0,re=F.length;ee<re;ee++)if(X=F[ee],!(0==Y&&-1<' \r\n\t'.indexOf(X))){switch(X){case'"':Q?Q==X&&(Q=null):Q=X;break;case'(':if(Q)break;else if(0==Y){Y=1,H+=X;continue}else K++;break;case')':if(Q)break;else if(1==Y)if(0==K){Y=0,H+=X,J();continue}else K--;break;case',':if(Q)break;else if(0==Y){J();continue}else if(1==Y&&0==K&&!I.match(/^url$/i)){Z.push(O),O='',H+=X;continue}}H+=X,0==Y?I+=X:O+=X}return J(),W},R.Util.Bounds=function(F){var I={},V;return F.getBoundingClientRect&&(V=F.getBoundingClientRect(),I.top=V.top,I.bottom=V.bottom||V.top+V.height,I.left=V.left,I.width=F.offsetWidth,I.height=F.offsetHeight),I},R.Util.OffsetBounds=function(F){var V=F.offsetParent?R.Util.OffsetBounds(F.offsetParent):{top:0,left:0};return{top:F.offsetTop+V.top,bottom:F.offsetTop+F.offsetHeight+V.top,left:F.offsetLeft+V.left,width:F.offsetWidth,height:F.offsetHeight}},R.Util.getCSS=function(F,V,I){L!==F&&(N=S.defaultView.getComputedStyle(F,null));var O=N[V];if(/^background(Size|Position)$/.test(V))return C(O,F,V,I);if(/border(Top|Bottom)(Left|Right)Radius/.test(V)){var B=O.split(' ');return 1>=B.length&&(B[1]=B[0]),B.map(A)}return O},R.Util.resizeBounds=function(F,V,I,O,B){var H=F/V,W,X;return B&&'auto'!==B?I/O<H^'contain'===B?(X=O,W=O*H):(W=I,X=I/H):(W=I,X=O),{width:W,height:X}},R.Util.BackgroundPosition=function(F,V,I,O,B){var G=E('backgroundPosition',F,V,I,O,B);return{left:G[0],top:G[1]}},R.Util.BackgroundSize=function(F,V,I,O){var B=E('backgroundSize',F,V,I,O);return{width:B[0],height:B[1]}},R.Util.Extend=function(F,V){for(var I in F)F.hasOwnProperty(I)&&(V[I]=F[I]);return V},R.Util.Children=function(F){var V;try{V=F.nodeName&&'IFRAME'===F.nodeName.toUpperCase()?F.contentDocument||F.contentWindow.document:function(I){var O=[];return null!==I&&function(B,G){var H=B.length,W=0;if('number'==typeof G.length)for(var X=G.length;W<X;W++)B[H++]=G[W];else for(;G[W]!==M;)B[H++]=G[W++];return B.length=H,B}(O,I),O}(F.childNodes)}catch(I){R.Util.log('html2canvas.Util.Children failed with exception: '+I.message),V=[]}return V},R.Util.isTransparent=function(F){return'transparent'===F||'rgba(0, 0, 0, 0)'===F},R.Util.Font=function(){var F={};return function(V,I,O){if(F[V+'-'+I]!==M)return F[V+'-'+I];var B=O.createElement('div'),G=O.createElement('img'),H=O.createElement('span'),W='Hidden Text',X,Y,K;return B.style.visibility='hidden',B.style.fontFamily=V,B.style.fontSize=I,B.style.margin=0,B.style.padding=0,O.body.appendChild(B),G.src='data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACwAAAAAAQABAAACAkQBADs=',G.width=1,G.height=1,G.style.margin=0,G.style.padding=0,G.style.verticalAlign='baseline',H.style.fontFamily=V,H.style.fontSize=I,H.style.margin=0,H.style.padding=0,H.appendChild(O.createTextNode(W)),B.appendChild(H),B.appendChild(G),X=G.offsetTop-H.offsetTop+1,B.removeChild(H),B.appendChild(O.createTextNode(W)),B.style.lineHeight='normal',G.style.verticalAlign='super',Y=G.offsetTop-B.offsetTop+1,K={baseline:X,lineWidth:1,middle:Y},F[V+'-'+I]=K,O.body.removeChild(B),K}}(),function(){function F(B){return function(G){try{B.addColorStop(G.stop,G.color)}catch(H){V.log(['failed to add color stop: ',H,'; tried to add: ',G])}}}var V=R.Util,I={};R.Generate=I;var O=[/^(-webkit-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-gradient)\((linear|radial),\s((?:\d{1,3}%?)\s(?:\d{1,3}%?),\s(?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)\-]+)\)$/,/^(-moz-linear-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-moz-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s?([a-z\-]*)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/];I.parseGradient=function(B,G){var X=O.length,H,W,Y,K,Q,Z,J,ee,re,oe,ie,ne;for(W=0;W<X&&(Y=B.match(O[W]),!Y);W+=1);if(Y)switch(Y[1]){case'-webkit-linear-gradient':case'-o-linear-gradient':if(H={type:'linear',x0:null,y0:null,x1:null,y1:null,colorStops:[]},Q=Y[2].match(/\w+/g),Q)for(Z=Q.length,W=0;W<Z;W+=1)switch(Q[W]){case'top':H.y0=0,H.y1=G.height;break;case'right':H.x0=G.width,H.x1=0;break;case'bottom':H.y0=G.height,H.y1=0;break;case'left':H.x0=0,H.x1=G.width;}if(null===H.x0&&null===H.x1&&(H.x0=H.x1=G.width/2),null===H.y0&&null===H.y1&&(H.y0=H.y1=G.height/2),Q=Y[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g),Q)for(Z=Q.length,J=1/Math.max(Z-1,1),W=0;W<Z;W+=1)ee=Q[W].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/),ee[2]?(K=parseFloat(ee[2]),K/='%'===ee[3]?100:G.width):K=W*J,H.colorStops.push({color:ee[1],stop:K});break;case'-webkit-gradient':if(H={type:'radial'===Y[2]?'circle':Y[2],x0:0,y0:0,x1:0,y1:0,colorStops:[]},Q=Y[3].match(/(\d{1,3})%?\s(\d{1,3})%?,\s(\d{1,3})%?\s(\d{1,3})%?/),Q&&(H.x0=Q[1]*G.width/100,H.y0=Q[2]*G.height/100,H.x1=Q[3]*G.width/100,H.y1=Q[4]*G.height/100),Q=Y[4].match(/((?:from|to|color-stop)\((?:[0-9\.]+,\s)?(?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)\))+/g),Q)for(Z=Q.length,W=0;W<Z;W+=1)ee=Q[W].match(/(from|to|color-stop)\(([0-9\.]+)?(?:,\s)?((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\)/),K=parseFloat(ee[2]),'from'===ee[1]&&(K=0),'to'===ee[1]&&(K=1),H.colorStops.push({color:ee[3],stop:K});break;case'-moz-linear-gradient':if(H={type:'linear',x0:0,y0:0,x1:0,y1:0,colorStops:[]},Q=Y[2].match(/(\d{1,3})%?\s(\d{1,3})%?/),Q&&(H.x0=Q[1]*G.width/100,H.y0=Q[2]*G.height/100,H.x1=G.width-H.x0,H.y1=G.height-H.y0),Q=Y[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}%)?)+/g),Q)for(Z=Q.length,J=1/Math.max(Z-1,1),W=0;W<Z;W+=1)ee=Q[W].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%)?/),ee[2]?(K=parseFloat(ee[2]),ee[3]&&(K/=100)):K=W*J,H.colorStops.push({color:ee[1],stop:K});break;case'-webkit-radial-gradient':case'-moz-radial-gradient':case'-o-radial-gradient':if(H={type:'circle',x0:0,y0:0,x1:G.width,y1:G.height,cx:0,cy:0,rx:0,ry:0,colorStops:[]},Q=Y[2].match(/(\d{1,3})%?\s(\d{1,3})%?/),Q&&(H.cx=Q[1]*G.width/100,H.cy=Q[2]*G.height/100),Q=Y[3].match(/\w+/),ee=Y[4].match(/[a-z\-]*/),Q&&ee)switch(ee[0]){case'farthest-corner':case'cover':case'':re=Math.sqrt(Math.pow(H.cx,2)+Math.pow(H.cy,2)),oe=Math.sqrt(Math.pow(H.cx,2)+Math.pow(H.y1-H.cy,2)),ie=Math.sqrt(Math.pow(H.x1-H.cx,2)+Math.pow(H.y1-H.cy,2)),ne=Math.sqrt(Math.pow(H.x1-H.cx,2)+Math.pow(H.cy,2)),H.rx=H.ry=Math.max(re,oe,ie,ne);break;case'closest-corner':re=Math.sqrt(Math.pow(H.cx,2)+Math.pow(H.cy,2)),oe=Math.sqrt(Math.pow(H.cx,2)+Math.pow(H.y1-H.cy,2)),ie=Math.sqrt(Math.pow(H.x1-H.cx,2)+Math.pow(H.y1-H.cy,2)),ne=Math.sqrt(Math.pow(H.x1-H.cx,2)+Math.pow(H.cy,2)),H.rx=H.ry=Math.min(re,oe,ie,ne);break;case'farthest-side':'circle'===Q[0]?H.rx=H.ry=Math.max(H.cx,H.cy,H.x1-H.cx,H.y1-H.cy):(H.type=Q[0],H.rx=Math.max(H.cx,H.x1-H.cx),H.ry=Math.max(H.cy,H.y1-H.cy));break;case'closest-side':case'contain':'circle'===Q[0]?H.rx=H.ry=Math.min(H.cx,H.cy,H.x1-H.cx,H.y1-H.cy):(H.type=Q[0],H.rx=Math.min(H.cx,H.x1-H.cx),H.ry=Math.min(H.cy,H.y1-H.cy));}if(Q=Y[5].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g),Q)for(Z=Q.length,J=1/Math.max(Z-1,1),W=0;W<Z;W+=1)ee=Q[W].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/),ee[2]?(K=parseFloat(ee[2]),K/='%'===ee[3]?100:G.width):K=W*J,H.colorStops.push({color:ee[1],stop:K});}return H},I.Gradient=function(B,G){if(0!==G.width&&0!==G.height){var H=S.createElement('canvas'),W=H.getContext('2d'),X,Y;if(H.width=G.width,H.height=G.height,X=R.Generate.parseGradient(B,G),X)switch(X.type){case'linear':Y=W.createLinearGradient(X.x0,X.y0,X.x1,X.y1),X.colorStops.forEach(F(Y)),W.fillStyle=Y,W.fillRect(0,0,G.width,G.height);break;case'circle':Y=W.createRadialGradient(X.cx,X.cy,0,X.cx,X.cy,X.rx),X.colorStops.forEach(F(Y)),W.fillStyle=Y,W.fillRect(0,0,G.width,G.height);break;case'ellipse':var K=S.createElement('canvas'),Q=K.getContext('2d'),Z=Math.max(X.rx,X.ry),J=2*Z;K.width=K.height=J,Y=Q.createRadialGradient(X.rx,X.ry,0,X.rx,X.ry,Z),X.colorStops.forEach(F(Y)),Q.fillStyle=Y,Q.fillRect(0,0,J,J),W.fillStyle=X.colorStops[X.colorStops.length-1].color,W.fillRect(0,0,H.width,H.height),W.drawImage(K,X.cx-X.rx,X.cy-X.ry,2*X.rx,2*X.ry);}return H}},I.ListAlpha=function(B){var G='',H;do H=B%26,G=String.fromCharCode(H+64)+G,B/=26;while(26<26*B);return G},I.ListRoman=function(B){var G=['M','CM','D','CD','C','XC','L','XL','X','IX','V','IV','I'],H=[1000,900,500,400,100,90,50,40,10,9,5,4,1],W='',Y=G.length,X;if(0>=B||4e3<=B)return B;for(X=0;X<Y;X+=1)for(;B>=H[X];)B-=H[X],W+=G[X];return W}}(),R.Parse=function(F,V){function I(){return Math.max(Math.max(Qe.body.scrollWidth,Qe.documentElement.scrollWidth),Math.max(Qe.body.offsetWidth,Qe.documentElement.offsetWidth),Math.max(Qe.body.clientWidth,Qe.documentElement.clientWidth))}function O(){return Math.max(Math.max(Qe.body.scrollHeight,Qe.documentElement.scrollHeight),Math.max(Qe.body.offsetHeight,Qe.documentElement.offsetHeight),Math.max(Qe.body.clientHeight,Qe.documentElement.clientHeight))}function B(nt,st){var lt=parseInt(tt(nt,st),10);return isNaN(lt)?0:lt}function G(nt,st,lt,dt,ct,mt){'transparent'!==mt&&(nt.setVariable('fillStyle',mt),nt.fillRect(st,lt,dt,ct),Ke+=1)}function H(nt,st,lt){if(0<nt.length)return st+lt.toUpperCase()}function W(nt,st){return'lowercase'===st?nt.toLowerCase():'capitalize'===st?nt.replace(/(^|\s|:|-|\(|\))([a-z])/g,H):'uppercase'===st?nt.toUpperCase():nt}function X(nt){return /^(normal|none|0px)$/.test(nt)}function Y(nt,st,lt,dt){null!==nt&&0<Ze.trimText(nt).length&&(dt.fillText(nt,st,lt),Ke+=1)}function K(nt,st,lt,dt){var mt=tt(st,'fontWeight'),ut=tt(st,'fontFamily'),ft=tt(st,'fontSize'),ht=Ze.parseTextShadows(tt(st,'textShadow'));switch(parseInt(mt,10)){case 401:mt='bold';break;case 400:mt='normal';}if(nt.setVariable('fillStyle',dt),nt.setVariable('font',[tt(st,'fontStyle'),tt(st,'fontVariant'),mt,ft,ut].join(' ')),nt.setVariable('textAlign','left'),ht.length&&(nt.setVariable('shadowColor',ht[0].color),nt.setVariable('shadowOffsetX',ht[0].offsetX),nt.setVariable('shadowOffsetY',ht[0].offsetY),nt.setVariable('shadowBlur',ht[0].blur)),'none'!==lt)return Ze.Font(ut,ft,Qe)}function Q(nt,st,lt,dt,ct){'underline'===st?G(nt,lt.left,Math.round(lt.top+dt.baseline+dt.lineWidth),lt.width,1,ct):'overline'===st?G(nt,lt.left,Math.round(lt.top),lt.width,1,ct):'line-through'===st?G(nt,lt.left,Math.ceil(lt.top+dt.middle+dt.lineWidth),lt.width,1,ct):void 0}function Z(nt,st,lt,dt,ct){var mt;if(Je.rangeBounds&&!ct)('none'!==lt||0!==Ze.trimText(st).length)&&(mt=J(st,nt.node,nt.textOffset)),nt.textOffset+=st.length;else if(nt.node&&'string'==typeof nt.node.nodeValue){var ut=dt?nt.node.splitText(st.length):null;mt=ee(nt.node,ct),nt.node=ut}return mt}function J(nt,st,lt){var dt=Qe.createRange();return dt.setStart(st,lt),dt.setEnd(st,lt+nt.length),dt.getBoundingClientRect()}function ee(nt,st){var lt=nt.parentNode,dt=Qe.createElement('wrapper'),ct=nt.cloneNode(!0);dt.appendChild(nt.cloneNode(!0)),lt.replaceChild(dt,nt);var mt=st?Ze.OffsetBounds(dt):Ze.Bounds(dt);return lt.replaceChild(ct,dt),mt}function re(nt,st,lt){var dt=lt.ctx,ct=tt(nt,'color'),mt=tt(nt,'textDecoration'),ut=tt(nt,'textAlign'),gt={node:st,textOffset:0},ft,ht;0<Ze.trimText(st.nodeValue).length&&(st.nodeValue=W(st.nodeValue,tt(nt,'textTransform')),ut=ut.replace(['-webkit-auto'],['auto']),ht=!V.letterRendering&&/^(left|right|justify|auto)$/.test(ut)&&X(tt(nt,'letterSpacing'))?st.nodeValue.split(/(\b| )/):st.nodeValue.split(''),ft=K(dt,nt,mt,ct),V.chinese&&ht.forEach(function(yt,xt){/.*[\u4E00-\u9FA5].*$/.test(yt)&&(yt=yt.split(''),yt.unshift(xt,1),ht.splice.apply(ht,yt))}),ht.forEach(function(yt,xt){var _t=Z(gt,yt,mt,xt<ht.length-1,lt.transform.matrix);_t&&(Y(yt,_t.left,_t.bottom,dt),Q(dt,mt,_t,ft,ct))}))}function oe(nt,st){var lt=Qe.createElement('boundelement'),dt,ct;return lt.style.display='inline',dt=nt.style.listStyleType,nt.style.listStyleType='none',lt.appendChild(Qe.createTextNode(st)),nt.insertBefore(lt,nt.firstChild),ct=Ze.Bounds(lt),nt.removeChild(lt),nt.style.listStyleType=dt,ct}function ie(nt){var st=-1,lt=1,dt=nt.parentNode.childNodes;if(nt.parentNode){for(;dt[++st]!==nt;)1===dt[st].nodeType&&lt++;return lt}return-1}function ne(nt,st){var lt=ie(nt),dt;return'decimal'===st?dt=lt:'decimal-leading-zero'===st?dt=1===lt.toString().length?lt='0'+lt.toString():lt.toString():'upper-roman'===st?dt=R.Generate.ListRoman(lt):'lower-roman'===st?dt=R.Generate.ListRoman(lt).toLowerCase():'lower-alpha'===st?dt=R.Generate.ListAlpha(lt).toLowerCase():'upper-alpha'===st?dt=R.Generate.ListAlpha(lt):void 0,dt+'. '}function se(nt,st,lt){var mt=st.ctx,ut=tt(nt,'listStyleType'),dt,ct,ft;if(/^(decimal|decimal-leading-zero|upper-alpha|upper-latin|upper-roman|lower-alpha|lower-greek|lower-latin|lower-roman)$/i.test(ut)){if(ct=ne(nt,ut),ft=oe(nt,ct),K(mt,nt,'none',tt(nt,'color')),'inside'===tt(nt,'listStylePosition'))mt.setVariable('textAlign','left'),dt=lt.left;else return;Y(ct,dt,ft.bottom,mt)}}function le(nt){var st=F[nt];return st&&!0===st.succeeded&&st.img}function pe(nt,st){var lt=Math.max(nt.left,st.left),dt=Math.max(nt.top,st.top),ct=Math.min(nt.left+nt.width,st.left+st.width),mt=Math.min(nt.top+nt.height,st.top+st.height);return{left:lt,top:dt,width:ct-lt,height:mt-dt}}function ue(nt,st,lt){var ct='static'!==st.cssPosition,mt=ct?tt(nt,'zIndex'):'auto',ut=tt(nt,'opacity'),ft='none'!==tt(nt,'cssFloat'),dt;st.zIndex=dt=P(mt),dt.isPositioned=ct,dt.isFloated=ft,dt.opacity=ut,dt.ownStacking='auto'!==mt||1>ut,lt&&lt.zIndex.children.push(st)}function fe(nt,st,lt,dt,ct){var mt=B(st,'paddingLeft'),ut=B(st,'paddingTop'),ft=B(st,'paddingRight'),ht=B(st,'paddingBottom');Ce(nt,lt,0,0,lt.width,lt.height,dt.left+mt+ct[3].width,dt.top+ut+ct[0].width,dt.width-(ct[1].width+ct[3].width+mt+ft),dt.height-(ct[0].width+ct[2].width+ut+ht))}function he(nt){return['Top','Right','Bottom','Left'].map(function(st){return{width:B(nt,'border'+st+'Width'),color:tt(nt,'border'+st+'Color')}})}function ge(nt){return['TopLeft','TopRight','BottomRight','BottomLeft'].map(function(st){return tt(nt,'border'+st+'Radius')})}function ye(nt,st,lt,dt){var ct=function(mt,ut,ft){return{x:mt.x+(ut.x-mt.x)*ft,y:mt.y+(ut.y-mt.y)*ft}};return{start:nt,startControl:st,endControl:lt,end:dt,subdivide:function(mt){var ut=ct(nt,st,mt),ft=ct(st,lt,mt),ht=ct(lt,dt,mt),gt=ct(ut,ft,mt),yt=ct(ft,ht,mt),xt=ct(gt,yt,mt);return[ye(nt,ut,gt,xt),ye(xt,yt,ht,dt)]},curveTo:function(mt){mt.push(['bezierCurve',st.x,st.y,lt.x,lt.y,dt.x,dt.y])},curveToReversed:function(mt){mt.push(['bezierCurve',lt.x,lt.y,st.x,st.y,nt.x,nt.y])}}}function xe(nt,st,lt,dt,ct,mt,ut){0<st[0]||0<st[1]?(nt.push(['line',dt[0].start.x,dt[0].start.y]),dt[0].curveTo(nt),dt[1].curveTo(nt)):nt.push(['line',mt,ut]),(0<lt[0]||0<lt[1])&&nt.push(['line',ct[0].start.x,ct[0].start.y])}function _e(nt,st,lt,dt,ct,mt,ut){var ft=[];return 0<st[0]||0<st[1]?(ft.push(['line',dt[1].start.x,dt[1].start.y]),dt[1].curveTo(ft)):ft.push(['line',nt.c1[0],nt.c1[1]]),0<lt[0]||0<lt[1]?(ft.push(['line',mt[0].start.x,mt[0].start.y]),mt[0].curveTo(ft),ft.push(['line',ut[0].end.x,ut[0].end.y]),ut[0].curveToReversed(ft)):(ft.push(['line',nt.c2[0],nt.c2[1]]),ft.push(['line',nt.c3[0],nt.c3[1]])),0<st[0]||0<st[1]?(ft.push(['line',ct[1].end.x,ct[1].end.y]),ct[1].curveToReversed(ft)):ft.push(['line',nt.c4[0],nt.c4[1]]),ft}function ve(nt,st,lt){var dt=nt.left,ct=nt.top,mt=nt.width,ut=nt.height,ft=st[0][0],ht=st[0][1],gt=st[1][0],yt=st[1][1],xt=st[2][0],_t=st[2][1],vt=st[3][0],bt=st[3][1],St=mt-gt,Mt=ut-_t,Tt=mt-xt,At=ut-bt;return{topLeftOuter:ot(dt,ct,ft,ht).topLeft.subdivide(0.5),topLeftInner:ot(dt+lt[3].width,ct+lt[0].width,Math.max(0,ft-lt[3].width),Math.max(0,ht-lt[0].width)).topLeft.subdivide(0.5),topRightOuter:ot(dt+St,ct,gt,yt).topRight.subdivide(0.5),topRightInner:ot(dt+Math.min(St,mt+lt[3].width),ct+lt[0].width,St>mt+lt[3].width?0:gt-lt[3].width,yt-lt[0].width).topRight.subdivide(0.5),bottomRightOuter:ot(dt+Tt,ct+Mt,xt,_t).bottomRight.subdivide(0.5),bottomRightInner:ot(dt+Math.min(Tt,mt+lt[3].width),ct+Math.min(Mt,ut+lt[0].width),Math.max(0,xt-lt[1].width),Math.max(0,_t-lt[2].width)).bottomRight.subdivide(0.5),bottomLeftOuter:ot(dt,ct+At,vt,bt).bottomLeft.subdivide(0.5),bottomLeftInner:ot(dt+lt[3].width,ct+At,Math.max(0,vt-lt[3].width),Math.max(0,bt-lt[2].width)).bottomLeft.subdivide(0.5)}}function Se(nt,st,lt,dt,ct){var mt=tt(nt,'backgroundClip'),ut=[];switch(mt){case'content-box':case'padding-box':xe(ut,dt[0],dt[1],st.topLeftInner,st.topRightInner,ct.left+lt[3].width,ct.top+lt[0].width),xe(ut,dt[1],dt[2],st.topRightInner,st.bottomRightInner,ct.left+ct.width-lt[1].width,ct.top+lt[0].width),xe(ut,dt[2],dt[3],st.bottomRightInner,st.bottomLeftInner,ct.left+ct.width-lt[1].width,ct.top+ct.height-lt[2].width),xe(ut,dt[3],dt[0],st.bottomLeftInner,st.topLeftInner,ct.left+lt[3].width,ct.top+ct.height-lt[2].width);break;default:xe(ut,dt[0],dt[1],st.topLeftOuter,st.topRightOuter,ct.left,ct.top),xe(ut,dt[1],dt[2],st.topRightOuter,st.bottomRightOuter,ct.left+ct.width,ct.top),xe(ut,dt[2],dt[3],st.bottomRightOuter,st.bottomLeftOuter,ct.left+ct.width,ct.top+ct.height),xe(ut,dt[3],dt[0],st.bottomLeftOuter,st.topLeftOuter,ct.left,ct.top+ct.height);}return ut}function Me(nt,st,lt){var dt=st.left,ct=st.top,mt=st.width,ut=st.height,vt=ge(nt),bt=ve(st,vt,lt),St={clip:Se(nt,bt,lt,vt,st),borders:[]},ft,ht,gt,yt,xt,_t;for(ft=0;4>ft;ft++)0<lt[ft].width&&(ht=dt,gt=ct,yt=mt,xt=ut-lt[2].width,0===ft?(xt=lt[0].width,_t=_e({c1:[ht,gt],c2:[ht+yt,gt],c3:[ht+yt-lt[1].width,gt+xt],c4:[ht+lt[3].width,gt+xt]},vt[0],vt[1],bt.topLeftOuter,bt.topLeftInner,bt.topRightOuter,bt.topRightInner)):1===ft?(ht=dt+mt-lt[1].width,yt=lt[1].width,_t=_e({c1:[ht+yt,gt],c2:[ht+yt,gt+xt+lt[2].width],c3:[ht,gt+xt],c4:[ht,gt+lt[0].width]},vt[1],vt[2],bt.topRightOuter,bt.topRightInner,bt.bottomRightOuter,bt.bottomRightInner)):2===ft?(gt=gt+ut-lt[2].width,xt=lt[2].width,_t=_e({c1:[ht+yt,gt+xt],c2:[ht,gt+xt],c3:[ht+lt[3].width,gt],c4:[ht+yt-lt[3].width,gt]},vt[2],vt[3],bt.bottomRightOuter,bt.bottomRightInner,bt.bottomLeftOuter,bt.bottomLeftInner)):3===ft?(yt=lt[3].width,_t=_e({c1:[ht,gt+xt+lt[2].width],c2:[ht,gt],c3:[ht+yt,gt+lt[0].width],c4:[ht+yt,gt+xt]},vt[3],vt[0],bt.bottomLeftOuter,bt.bottomLeftInner,bt.topLeftOuter,bt.topLeftInner)):void 0,St.borders.push({args:_t,color:lt[ft].color}));return St}function Te(nt,st){var lt=nt.drawShape();return st.forEach(function(dt,ct){lt[0===ct?'moveTo':dt[0]+'To'].apply(null,dt.slice(1))}),lt}function Ae(nt,st,lt){'transparent'!==lt&&(nt.setVariable('fillStyle',lt),Te(nt,st),nt.fill(),Ke+=1)}function we(nt,st,lt){var dt=Qe.createElement('valuewrap'),mt,ut;['lineHeight','textAlign','fontFamily','color','fontSize','paddingLeft','paddingTop','width','height','border','borderLeftWidth','borderTopWidth'].forEach(function(ft){try{dt.style[ft]=tt(nt,ft)}catch(ht){Ze.log('html2canvas: Parse: Exception caught in renderFormValue: '+ht.message)}}),dt.style.borderColor='black',dt.style.borderStyle='solid',dt.style.display='block',dt.style.position='absolute',(/^(submit|reset|button|text|password)$/.test(nt.type)||'SELECT'===nt.nodeName)&&(dt.style.lineHeight=tt(nt,'height')),dt.style.top=st.top+'px',dt.style.left=st.left+'px',mt='SELECT'===nt.nodeName?(nt.options[nt.selectedIndex]||0).text:nt.value,mt||(mt=nt.placeholder),ut=Qe.createTextNode(mt),dt.appendChild(ut),et.appendChild(dt),re(nt,ut,lt),et.removeChild(dt)}function Ce(nt){nt.drawImage.apply(nt,Array.prototype.slice.call(arguments,1)),Ke+=1}function Ee(nt,st){var lt=_.getComputedStyle(nt,st);if(lt&&lt.content&&'none'!==lt.content&&'-moz-alt-content'!==lt.content&&'none'!==lt.display){var dt=lt.content+'',ct=dt.substr(0,1);ct===dt.substr(dt.length-1)&&ct.match(/'|"/)&&(dt=dt.substr(1,dt.length-2));var mt='url'===dt.substr(0,3),ut=S.createElement(mt?'img':'span');return ut.className=rt+'-before '+rt+'-after',Object.keys(lt).filter(De).forEach(function(ft){try{ut.style[ft]=lt[ft]}catch(ht){Ze.log(['Tried to assign readonly property ',ft,'Error:',ht])}}),mt?ut.src=Ze.parseBackgroundImage(dt)[0].args[0]:ut.innerHTML=dt,ut}}function De(nt){return isNaN(_.parseInt(nt,10))}function Pe(nt,st){var lt=Ee(nt,':before'),dt=Ee(nt,':after');(lt||dt)&&(lt&&(nt.className+=' '+rt+'-before',nt.parentNode.insertBefore(lt,nt),We(lt,st,!0),nt.parentNode.removeChild(lt),nt.className=nt.className.replace(rt+'-before','').trim()),dt&&(nt.className+=' '+rt+'-after',nt.appendChild(dt),We(dt,st,!0),nt.removeChild(dt),nt.className=nt.className.replace(rt+'-after','').trim()))}function Re(nt,st,lt,dt){var ct=Math.round(dt.left+lt.left),mt=Math.round(dt.top+lt.top);nt.createPattern(st),nt.translate(ct,mt),nt.fill(),nt.translate(-ct,-mt)}function Le(nt,st,lt,dt,ct,mt,ut,ft){var ht=[];ht.push(['line',Math.round(ct),Math.round(mt)]),ht.push(['line',Math.round(ct+ut),Math.round(mt)]),ht.push(['line',Math.round(ct+ut),Math.round(ft+mt)]),ht.push(['line',Math.round(ct),Math.round(ft+mt)]),Te(nt,ht),nt.save(),nt.clip(),Re(nt,st,lt,dt),nt.restore()}function Ne(nt,st,lt){G(nt,st.left,st.top,st.width,st.height,lt)}function Ue(nt,st,lt,dt,ct){var mt=Ze.BackgroundSize(nt,st,dt,ct),ut=Ze.BackgroundPosition(nt,st,dt,ct,mt),ft=tt(nt,'backgroundRepeat').split(',').map(Ze.trimText);switch(dt=ze(dt,mt),ft=ft[ct]||ft[0],ft){case'repeat-x':Le(lt,dt,ut,st,st.left,st.top+ut.top,99999,dt.height);break;case'repeat-y':Le(lt,dt,ut,st,st.left+ut.left,st.top,dt.width,99999);break;case'no-repeat':Le(lt,dt,ut,st,st.left+ut.left,st.top+ut.top,dt.width,dt.height);break;default:Re(lt,dt,ut,{top:st.top,left:st.left,width:dt.width,height:dt.height});}}function Fe(nt,st,lt){for(var dt=tt(nt,'backgroundImage'),ct=Ze.parseBackgroundImage(dt),ut=ct.length,mt;ut--;)if(dt=ct[ut],dt.args&&0!==dt.args.length){var ft='url'===dt.method?dt.args[0]:dt.value;mt=le(ft),mt?Ue(nt,st,lt,mt,ut):Ze.log('html2canvas: Error loading background:',dt)}}function ze(nt,st){if(nt.width===st.width&&nt.height===st.height)return nt;var dt=Qe.createElement('canvas'),lt;return dt.width=st.width,dt.height=st.height,lt=dt.getContext('2d'),Ce(lt,nt,0,0,nt.width,nt.height,0,0,st.width,st.height),dt}function Ve(nt,st,lt){return nt.setVariable('globalAlpha',tt(st,'opacity')*(lt?lt.opacity:1))}function Ie(nt){return nt.replace('px','')}function Oe(nt){var lt=tt(nt,'transform')||tt(nt,'-webkit-transform')||tt(nt,'-moz-transform')||tt(nt,'-ms-transform')||tt(nt,'-o-transform'),dt=tt(nt,'transform-origin')||tt(nt,'-webkit-transform-origin')||tt(nt,'-moz-transform-origin')||tt(nt,'-ms-transform-origin')||tt(nt,'-o-transform-origin')||'0px 0px';dt=dt.split(' ').map(Ie).map(Ze.asFloat);var ct;if(lt&&'none'!==lt){var mt=lt.match(it);if(mt)switch(mt[1]){case'matrix':ct=mt[2].split(',').map(Ze.trimText).map(Ze.asFloat);}}return{origin:dt,matrix:ct}}function Be(nt,st,lt,dt){var ct=D(st?lt.width:I(),st?lt.height:O()),mt={ctx:ct,opacity:Ve(ct,nt,st),cssPosition:tt(nt,'position'),borders:he(nt),transform:dt,clip:st&&st.clip?Ze.Extend({},st.clip):null};return ue(nt,mt,st),!0===V.useOverflow&&!0===/(hidden|scroll|auto)/.test(tt(nt,'overflow'))&&!1===/(BODY)/i.test(nt.nodeName)&&(mt.clip=mt.clip?pe(mt.clip,lt):lt),mt}function ke(nt,st,lt){var dt={left:st.left+nt[3].width,top:st.top+nt[0].width,width:st.width-(nt[1].width+nt[3].width),height:st.height-(nt[0].width+nt[2].width)};return lt&&(dt=pe(dt,lt)),dt}function Ge(nt,st){var lt=st.matrix?Ze.OffsetBounds(nt):Ze.Bounds(nt);return st.origin[0]+=lt.left,st.origin[1]+=lt.top,lt}function He(nt,st,lt,dt){var ct=Oe(nt,st),mt=Ge(nt,ct),ft=Be(nt,st,mt,ct),ht=ft.borders,gt=ft.ctx,yt=ke(ht,mt,ft.clip),xt=Me(nt,mt,ht),_t=$e.test(nt.nodeName)?'#efefef':tt(nt,'backgroundColor'),ut;switch(Te(gt,xt.clip),gt.save(),gt.clip(),0<yt.height&&0<yt.width&&!dt?(Ne(gt,mt,_t),Fe(nt,yt,gt)):dt&&(ft.backgroundColor=_t),gt.restore(),xt.borders.forEach(function(vt){Ae(gt,vt.args,vt.color)}),lt||Pe(nt,ft),nt.nodeName){case'IMG':(ut=le(nt.getAttribute('src')))?fe(gt,nt,ut,mt,ht):Ze.log('html2canvas: Error loading <img>:'+nt.getAttribute('src'));break;case'INPUT':/^(text|url|email|submit|button|reset)$/.test(nt.type)&&0<(nt.value||nt.placeholder||'').length&&we(nt,mt,ft);break;case'TEXTAREA':0<(nt.value||nt.placeholder||'').length&&we(nt,mt,ft);break;case'SELECT':0<(nt.options||nt.placeholder||'').length&&we(nt,mt,ft);break;case'LI':se(nt,ft,yt);break;case'CANVAS':fe(gt,nt,nt,mt,ht);}return ft}function je(nt){return'none'!==tt(nt,'display')&&'hidden'!==tt(nt,'visibility')&&!nt.hasAttribute('data-html2canvas-ignore')}function We(nt,st,lt){je(nt)&&(st=He(nt,st,lt,!1)||st,!$e.test(nt.nodeName)&&Xe(nt,st,lt))}function Xe(nt,st,lt){Ze.Children(nt).forEach(function(dt){dt.nodeType===dt.ELEMENT_NODE?We(dt,st,lt):dt.nodeType===dt.TEXT_NODE&&re(nt,dt,st)})}_.scroll(0,0);var qe=V.elements===M?S.body:V.elements[0],Ke=0,Qe=qe.ownerDocument,Ze=R.Util,Je=Ze.Support(V,Qe),$e=new RegExp('('+V.ignoreElements+')'),et=Qe.body,tt=Ze.getCSS,rt='___html2canvas___pseudoelement',at=Qe.createElement('style');at.innerHTML='.'+rt+'-before:before { content: "" !important; display: none !important; }.'+rt+'-after:after { content: "" !important; display: none !important; }',et.appendChild(at),F=F||{};var ot=function(nt){return function(st,lt,dt,ct){var mt=dt*nt,ut=ct*nt,ft=st+dt,ht=lt+ct;return{topLeft:ye({x:st,y:ht},{x:st,y:ht-ut},{x:ft-mt,y:lt},{x:ft,y:lt}),topRight:ye({x:st,y:lt},{x:st+mt,y:lt},{x:ft,y:ht-ut},{x:ft,y:ht}),bottomRight:ye({x:ft,y:lt},{x:ft,y:lt+ut},{x:st+mt,y:ht},{x:st,y:ht}),bottomLeft:ye({x:ft,y:ht},{x:ft-mt,y:ht},{x:st,y:lt+ut},{x:st,y:lt})}}}(4*((Math.sqrt(2)-1)/3)),it=/(matrix)\((.+)\)/;return function(){var nt=tt(S.documentElement,'backgroundColor'),st=Ze.isTransparent(nt)&&qe===S.body,lt=He(qe,null,!1,st);return Xe(qe,lt),st&&(nt=lt.backgroundColor),et.removeChild(at),{backgroundColor:nt,stack:lt}}()},R.Preload=function(F){function V(he){pe.href=he,pe.href=pe.href;var ge=pe.protocol+pe.host;return ge===Z}function I(){J.log('html2canvas: start: images: '+Q.numLoaded+' / '+Q.numTotal+' (failed: '+Q.numFailed+')'),!Q.firstRun&&Q.numLoaded>=Q.numTotal&&(J.log('Finished loading images: # '+Q.numTotal+' (failed: '+Q.numFailed+')'),'function'==typeof F.complete&&F.complete(Q))}function O(he,ge,ye){var _e=F.proxy,xe,ve;pe.href=he,he=pe.href,xe='html2canvas_'+oe++,ye.callbackname=xe,_e+=-1<_e.indexOf('?')?'&':'?',_e+='url='+encodeURIComponent(he)+'&callback='+xe,ve=ne.createElement('script'),_[xe]=function(Se){'error:'===Se.substring(0,6)?(ye.succeeded=!1,Q.numLoaded++,Q.numFailed++,I()):(K(ge,ye),ge.src=Se),_[xe]=M;try{delete _[xe]}catch(Me){}ve.parentNode.removeChild(ve),ve=null,delete ye.script,delete ye.callbackname},ve.setAttribute('type','text/javascript'),ve.setAttribute('src',_e),ye.script=ve,_.document.body.appendChild(ve)}function B(he,ge){var ye=_.getComputedStyle(he,ge),xe=ye.content;'url'===xe.substr(0,3)&&ee.loadImage(R.Util.parseBackgroundImage(xe)[0].args[0]),X(ye.backgroundImage,he)}function G(he){B(he,':before'),B(he,':after')}function H(he,ge){var ye=R.Generate.Gradient(he,ge);ye!==M&&(Q[he]={img:ye,succeeded:!0},Q.numTotal++,Q.numLoaded++,I())}function W(he){return he&&he.method&&he.args&&0<he.args.length}function X(he,ge){var ye;R.Util.parseBackgroundImage(he).filter(W).forEach(function(xe){'url'===xe.method?ee.loadImage(xe.args[0]):xe.method.match(/\-?gradient$/)&&(ye===M&&(ye=R.Util.Bounds(ge)),H(xe.value,ye))})}function Y(he){var ge=!1;try{J.Children(he).forEach(Y)}catch(ye){}try{ge=he.nodeType}catch(ye){ge=!1,J.log('html2canvas: failed to access some element\'s nodeType - Exception: '+ye.message)}if(1===ge||ge===M){G(he);try{X(J.getCSS(he,'backgroundImage'),he)}catch(ye){J.log('html2canvas: failed to get background-image - Exception: '+ye.message)}X(he)}}function K(he,ge){he.onload=function(){ge.timer!==M&&_.clearTimeout(ge.timer),Q.numLoaded++,ge.succeeded=!0,he.onerror=he.onload=null,I()},he.onerror=function(){if('anonymous'===he.crossOrigin&&(_.clearTimeout(ge.timer),F.proxy)){var ye=he.src;return he=new Image,ge.img=he,he.src=ye,void O(he.src,he,ge)}Q.numLoaded++,Q.numFailed++,ge.succeeded=!1,he.onerror=he.onload=null,I()}}var Q={numLoaded:0,numFailed:0,numTotal:0,cleanupDone:!1},J=R.Util,oe=0,ie=F.elements[0]||S.body,ne=ie.ownerDocument,se=ie.getElementsByTagName('img'),le=se.length,pe=ne.createElement('a'),ue=function(he){return he.crossOrigin!==M}(new Image),Z,ee,re,fe;for(pe.href=_.location.href,Z=pe.protocol+pe.host,ee={loadImage:function(he){var ge,ye;he&&Q[he]===M&&(ge=new Image,he.match(/data:image\/.*;base64,/i)?(ge.src=he.replace(/url\(['"]{0,}|['"]{0,}\)$/ig,''),ye=Q[he]={img:ge},Q.numTotal++,K(ge,ye)):V(he)||!0===F.allowTaint?(ye=Q[he]={img:ge},Q.numTotal++,K(ge,ye),ge.src=he):ue&&!F.allowTaint&&F.useCORS?(ge.crossOrigin='anonymous',ye=Q[he]={img:ge},Q.numTotal++,K(ge,ye),ge.src=he):F.proxy&&(ye=Q[he]={img:ge},Q.numTotal++,O(he,ge,ye)))},cleanupDOM:function(he){var ge,ye;if(!Q.cleanupDone){for(ye in he&&'string'==typeof he?J.log('html2canvas: Cleanup because: '+he):J.log('html2canvas: Cleanup after timeout: '+F.timeout+' ms.'),Q)if(Q.hasOwnProperty(ye)&&(ge=Q[ye],'object'==typeof ge&&ge.callbackname&&ge.succeeded===M)){_[ge.callbackname]=M;try{delete _[ge.callbackname]}catch(xe){}ge.script&&ge.script.parentNode&&(ge.script.setAttribute('src','about:blank'),ge.script.parentNode.removeChild(ge.script)),Q.numLoaded++,Q.numFailed++,J.log('html2canvas: Cleaned up failed img: \''+ye+'\' Steps: '+Q.numLoaded+' / '+Q.numTotal)}_.stop===M?S.execCommand!==M&&S.execCommand('Stop',!1):_.stop(),S.close!==M&&S.close(),Q.cleanupDone=!0,he&&'string'==typeof he||I()}},renderingDone:function(){fe&&_.clearTimeout(fe)}},0<F.timeout&&(fe=_.setTimeout(ee.cleanupDOM,F.timeout)),J.log('html2canvas: Preload starts: finding background-images'),Q.firstRun=!0,Y(ie),J.log('html2canvas: Preload: Finding images'),re=0;re<le;re+=1)ee.loadImage(se[re].getAttribute('src'));return Q.firstRun=!1,J.log('html2canvas: Preload: Done.'),Q.numTotal===Q.numLoaded&&I(),ee},R.Renderer=function(F,V){return function(B){var G;if('string'==typeof V.renderer&&R.Renderer[B]!==M)G=R.Renderer[B](V);else if('function'==typeof B)G=B(V);else throw new Error('Unknown renderer');if('function'!=typeof G)throw new Error('Invalid renderer defined');return G}(V.renderer)(F,V,S,function(B){function G(X){Object.keys(X).sort().forEach(function(Y){var K=[],Q=[],Z=[],J=[];X[Y].forEach(function(ee){ee.node.zIndex.isPositioned||1>ee.node.zIndex.opacity?Z.push(ee):ee.node.zIndex.isFloated?Q.push(ee):K.push(ee)}),function ee(re){re.forEach(function(oe){J.push(oe),oe.children&&ee(oe.children)})}(K.concat(Q,Z)),J.forEach(function(ee){ee.context?G(ee.context):H.push(ee.node)})})}var H=[],W;return W=function(Y){function K(Z,J,ee){var re='auto'===J.zIndex.zindex?0:+J.zIndex.zindex,oe=Z,ie=J.zIndex.isPositioned,ne=J.zIndex.isFloated,se={node:J},le=ee;J.zIndex.ownStacking?(oe=se.context={'!':[{node:J,children:[]}]},le=M):(ie||ne)&&(le=se.children=[]),0==re&&ee?ee.push(se):(!Z[re]&&(Z[re]=[]),Z[re].push(se)),J.zIndex.children.forEach(function(pe){K(oe,pe,le)})}var Q={};return K(Q,Y),Q}(B),G(W),H}(F.stack),R)},R.Util.Support=function(F,V){return{rangeBounds:function(){var X=!1,B,G,H,W;return V.createRange&&(B=V.createRange(),B.getBoundingClientRect&&(G=V.createElement('boundtest'),G.style.height='123px',G.style.display='block',V.body.appendChild(G),B.selectNode(G),H=B.getBoundingClientRect(),W=H.height,123===W&&(X=!0),V.body.removeChild(G))),X}(),svgRendering:F.svgRendering&&function(){var B=new Image,G=V.createElement('canvas'),H=G.getContext!==M&&G.getContext('2d');if(!1===H)return!1;G.width=G.height=10,B.src=['data:image/svg+xml,','<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'10\' height=\'10\'>','<foreignObject width=\'10\' height=\'10\'>','<div xmlns=\'http://www.w3.org/1999/xhtml\' style=\'width:10;height:10;\'>','sup','</div>','</foreignObject>','</svg>'].join('');try{H.drawImage(B,0,0),G.toDataURL()}catch(W){return!1}return R.Util.log('html2canvas: Parse: SVG powered rendering available'),!0}()}},THREE.html2canvas=function(F,V){F=F.length?F:[F];var B={logging:!1,elements:F,background:'#fff',proxy:null,timeout:0,useCORS:!1,allowTaint:!1,svgRendering:!1,ignoreElements:'IFRAME|OBJECT|PARAM',useOverflow:!0,letterRendering:!1,chinese:!1,width:null,height:null,taintTest:!0,renderer:'Canvas'},I,O;return B=R.Util.Extend(V,B),R.logging=B.logging,B.complete=function(G){('function'!=typeof B.onpreloaded||!1!==B.onpreloaded(G))&&(I=R.Parse(G,B),'function'==typeof B.onparsed&&!1===B.onparsed(I)||(O=R.Renderer(I,B),'function'==typeof B.onrendered&&B.onrendered(O)))},_.setTimeout(function(){R.Preload(B)},0),{render:function(G,H){return R.Renderer(G,R.Util.Extend(H,B))},parse:function(G,H){return R.Parse(G,R.Util.Extend(H,B))},preload:function(G){return R.Preload(R.Util.Extend(G,B))},log:R.Util.log}},THREE.html2canvas.log=R.Util.log,THREE.html2canvas.Renderer={Canvas:M},R.Renderer.Canvas=function(F){function V(K,Q){K.beginPath(),Q.forEach(function(Z){K[Z.name].apply(K,Z.arguments)}),K.closePath()}function I(K){if(-1===G.indexOf(K.arguments[0].src)){W.drawImage(K.arguments[0],0,0);try{W.getImageData(0,0,1,1)}catch(Q){return H=B.createElement('canvas'),W=H.getContext('2d'),!1}G.push(K.arguments[0].src)}return!0}function O(K,Q){switch(Q.type){case'variable':K[Q.name]=Q.arguments;break;case'function':switch(Q.name){case'createPattern':if(0<Q.arguments[0].width&&0<Q.arguments[0].height)try{K.fillStyle=K.createPattern(Q.arguments[0],'repeat')}catch(Z){X.log('html2canvas: Renderer: Error creating pattern',Z.message)}break;case'drawShape':V(K,Q.arguments);break;case'drawImage':0<Q.arguments[8]&&0<Q.arguments[7]&&(!F.taintTest||F.taintTest&&I(Q))&&K.drawImage.apply(K,Q.arguments);break;default:K[Q.name].apply(K,Q.arguments);}}}F=F||{};var B=S,G=[],H=S.createElement('canvas'),W=H.getContext('2d'),X=R.Util,Y=F.canvas||B.createElement('canvas');return function(K,Q,Z,J,ee){var re=Y.getContext('2d'),se=K.stack,oe,ie,ne;return Y.width=Y.style.width=Q.width||se.ctx.width,Y.height=Y.style.height=Q.height||se.ctx.height,ne=re.fillStyle,re.fillStyle=X.isTransparent(se.backgroundColor)&&Q.background!==M?Q.background:K.backgroundColor,re.fillRect(0,0,Y.width,Y.height),re.fillStyle=ne,J.forEach(function(le){re.textBaseline='bottom',re.save(),le.transform.matrix&&(re.translate(le.transform.origin[0],le.transform.origin[1]),re.transform.apply(re,le.transform.matrix),re.translate(-le.transform.origin[0],-le.transform.origin[1])),le.clip&&(re.beginPath(),re.rect(le.clip.left,le.clip.top,le.clip.width,le.clip.height),re.clip()),le.ctx.storage&&le.ctx.storage.forEach(function(pe){O(re,pe)}),re.restore()}),X.log('html2canvas: Renderer: Canvas renderer done - returning canvas obj'),1===Q.elements.length&&'object'==typeof Q.elements[0]&&'BODY'!==Q.elements[0].nodeName?(ie=ee.Util.Bounds(Q.elements[0]),oe=Z.createElement('canvas'),oe.width=Math.ceil(ie.width),oe.height=Math.ceil(ie.height),re=oe.getContext('2d'),re.drawImage(Y,ie.left,ie.top,ie.width,ie.height,0,0,ie.width,ie.height),Y=null,oe):Y}}}(window,document),function(){var _={VERSION:'0.9_20141123',IS_BETA:!0,ALIAS:'WIP_MinorSnow'};_.AudioUnit=function(S){this._status=this.createStatus(),this._status.id=S,Object.defineProperties(this,{isAudioUnit:{enumerable:!0,get:function(){return this._status.isAudioUnit}},id:{enumerable:!0,get:function(){return this._status.id}},connection:{enumerable:!0,get:function(){var M=Object.create(this._status.connection);return M}}})},_.AudioUnit.prototype.createStatus=function(){return new _.AudioUnit.Status},_.AudioUnit.prototype.connect=function(S,M,T,A){if(null!=S.id||null!=A){var C=null;null==S.id?null!=A&&(C=A):C=S.id,C+='['+(null==M?'0':M)+':'+(null==T?'0':T)+']',this._status.connection.push(C)}},_.AudioUnit.prototype.disconnect=function(S,M,T){if(null!=S.id||null!=T){var A=-1,C='';null==S.id?null!=T&&(C=T):C=S.id,C+='['+(null==M?'0':M);for(var E=0;E<this._status.connection.length;E++)if(this._status.connection[E].substring(0,C.length)===C){A=E;break}0<=A&&this._status.connection.splice(A,1)}},_.AudioUnit.Status=function(){this.className='snd.AudioUnit',this.isAudioUnit=!0,this.id='',this.connection=[],this.channelCount=2,this.channelCountMode='max',this.channelInterpretation='discrete'},_.Source=function(){_.AudioUnit.apply(this,arguments),this._gain=_.AUDIO_CONTEXT.createGain(),Object.defineProperties(this,{isSource:{get:function(){return this._status.isSource}},volumeParam:{get:function(){var M=this.gain.gain;return null==M.id&&(M.id=this.id+'.gain'),M}},volume:{get:function(){return this._gain.gain.value},set:function(M){this._gain.gain.value=M,this._status.volume=M}},status:{get:function(){return this._status.status}}})},_.Source.prototype=Object.create(_.AudioUnit.prototype),_.Source.prototype.constructor=_.Source,_.Source.CLASS_NAME='snd.Source',_.Source.prototype.connect=function(S,M,T){_.AudioUnit.prototype.connect.apply(this,arguments),S.isAudioUnit||null!=S.getConnector?this._gain.connect(S.getConnector(),M,T):this._gain.connect(S,M,T)},_.Source.prototype.disconnect=function(S){_.AudioUnit.prototype.disconnect.apply(this,arguments),S.isAudioUnit||null!=S.getConnector?this._gain.disconnect(S.getConnector()):this._gain.disconnect(S)},_.Source.prototype.getConnector=function(){return this._gain},_.Source.prototype.createStatus=function(){return new _.Source.Status},_.Source.Status=function(){_.AudioUnit.Status.apply(this,arguments),this.status=_.status.NONE,this.volume=1,this.isSource=!0,this.className=_.Source.CLASS_NAME},_.MediaElementAudioSource=function(S,M){_.Source.apply(this,arguments),this.id=S,Object.defineProperties(this,{element:{get:function(){return this._element},set:function(T){var A=this;this._source=_.AUDIO_CONTEXT.createMediaElementSource(T),this._source.connect(this._gain),this._element=T,null!=this._element.id&&(this._status.element=this._element.id),this._element.onplay=function(){A._status.status=_.status.STARTED},this._element.onpause=function(){A._status.status=_.status.PAUSED},this._element.onended=function(){A._status.status=_.status.PAUSED},this._element.oncanplay=function(){A.status==_.status.NONE&&(A._status.status=_.status.READY)}}},src:{get:function(){return this._element.src},set:function(T){this._element.src=T}}}),null!=M&&(this.element=M)},_.MediaElementAudioSource.prototype=Object.create(_.Source.prototype),_.MediaElementAudioSource.prototype.constructor=_.MediaElementAudioSource,_.MediaElementAudioSource.CLASS_NAME='snd.MediaElementAudioSource',_.MediaElementAudioSource.prototype.createStatus=function(){return new _.MediaElementAudioSource.Status},_.MediaElementAudioSource.Status=function(){_.Source.Status.apply(this,arguments),this.className=_.MediaElementAudioSource.CLASS_NAME,this.status=_.status.NONE,this.element=''},_.MediaElementAudioSource.Status.prototype=Object.create(_.Source.Status.prototype),_.MediaElementAudioSource.Status.prototype.constructor=_.MediaElementAudioSource.Status,_.AudioMaster=function(){this.unitList={},this._gain=_.AUDIO_CONTEXT.createGain(),this._gain.channelCount=_.MAX_CHANNEL_COUNT,this._gain.connect(_.AUDIO_CONTEXT.destination),this.id=_.AudioMaster.ID},_.AudioMaster.ID='snd.MASTER',_.AudioMaster.prototype.connectAudioUnit=function(S,M){if(null==S&&null==M.id)throw'key == null && audioUnit.id == null';null==S?null==this.unitList[M.id]&&(this.unitList[M.id]=M,M.connect(this._gain,_.AudioMaster.ID)):(this.unitList[S]=M,M.connect(this._gain,_.AudioMaster.ID))},_.AudioMaster.prototype.disconnectAudioUnit=function(S){var M=this.unitList[S];M.getConnector().disconnect(this._gain),delete this.unitList[S]},_.AudioMaster.prototype.getConnector=function(){return this._gain},_._AUDIO_CONTEXT=null,_._MASTER=null,_.init=function(){null==_._AUDIO_CONTEXT&&('AudioContext'in window?_._AUDIO_CONTEXT=new AudioContext:'webkitAudioContext'in window&&(_._AUDIO_CONTEXT=new webkitAudioContext),_._AUDIO_CONTEXT.destination.channelCount=_._AUDIO_CONTEXT.destination.maxChannelCount),Object.defineProperties(_,{MAX_CHANNEL_COUNT:{writable:!1,value:_._AUDIO_CONTEXT.destination.maxChannelCount},status:{value:function(){var S={};return Object.defineProperties(S,{NONE:{value:'none',writable:!1},READY:{value:'ready',writable:!1},STARTED:{value:'started',writable:!1},PAUSED:{value:'paused',writable:!1},STOPPED:{value:'ended',writable:!1}}),S}(),writable:!1},AUDIO_CONTEXT:{get:function(){return _._AUDIO_CONTEXT}},MASTER:{get:function(){return _._MASTER}}}),_._MASTER=new _.AudioMaster,_.SOUND_ENVIRONMENT=new _.SoundEnvironment},_.three={version:0.1,beta:!0},_.PosDir=function(){this._pos={x:0,y:0,z:0},this._dir={x:0,y:0,z:0},this._up={x:0,y:0,z:0},Object.defineProperties(this,{pos:{get:function(){var S=this,M={};return Object.defineProperties(M,{x:{get:function(){return S._pos.x},set:function(T){S._pos.x=T}},y:{get:function(){return S._pos.y},set:function(T){S._pos.y=T}},z:{get:function(){return S._pos.z},set:function(T){S._pos.z=T}}}),M}},dir:{get:function(){var S=this,M={};return Object.defineProperties(M,{x:{get:function(){return S._dir.x},set:function(T){S._dir.x=T}},y:{get:function(){return S._dir.y},set:function(T){S._dir.y=T}},z:{get:function(){return S._dir.z},set:function(T){S._dir.z=T}}}),M}},up:{get:function(){var S=this,M={};return Object.defineProperties(M,{x:{get:function(){return S._up.x},set:function(T){S._up.x=T}},y:{get:function(){return S._up.y},set:function(T){S._up.y=T}},z:{get:function(){return S._up.z},set:function(T){S._up.z=T}}}),M}}})},_.PosDir.prototype.setPosition=function(S,M,T){this.pos.x=S,this.pos.y=M,this.pos.z=T},_.PosDir.prototype.setOrientation=function(S,M,T,A,C,E){this.dir.x=S,this.dir.y=M,this.dir.z=T,this.up.x=A,this.up.y=C,this.up.z=E},_.Listener=function(S){_.PosDir.apply(this,arguments),this.listener=S,null!=S&&this.listener.setOrientation(this.dir.x,this.dir.y,this.dir.z,this.up.x,this.up.y,this.up.z)},_.Listener.prototype=Object.create(_.PosDir.prototype),_.Listener.prototype.constructor=_.Listener,_.Listener.prototype.setListener=function(S){this.listener=S,this.setPosition(this.pos.x,this.pos.y,this.pos.z),this.setOrientation(this.dir.x,this.dir.y,this.dir.z,this.up.x,this.up.y,this.up.z)},_.Listener.prototype.resetListener=function(){this.setListener(null)},_.Listener.prototype.setPosition=function(S,M,T){_.PosDir.prototype.setPosition.call(this,S,M,T),null!=this.listener&&this.listener.setPosition(_.SOUND_ENVIRONMENT.unit*this.pos.x,_.SOUND_ENVIRONMENT.unit*this.pos.y,_.SOUND_ENVIRONMENT.unit*this.pos.z)},_.Listener.prototype.setOrientation=function(S,M,T,A,C,E){_.PosDir.prototype.setOrientation.call(this,S,M,T,A,C,E),null!=this.listener&&this.listener.setOrientation(this.dir.x,this.dir.y,this.dir.z,this.up.x,this.up.y,this.up.z)},_.SoundEnvironment=function(){this.now=0,this.listener=_.AUDIO_CONTEXT.listener,this.listeners={},this.soundNodes={},this.unit=0.1,this.cameras={},this.attaches={},this.linkMap={}},_.SoundEnvironment.DEFAULT_BUFFER_MAX=1800,_.SoundEnvironment.prototype.addListener=function(S,M){this.listeners[S]=new _.PosDirTime(M,1)},_.SoundEnvironment.prototype.removeListener=function(S){null!=this.soundNodes[S]&&delete this.soundNodes[S]},_.SoundEnvironment.prototype.addSoundNode=function(S,M){this.soundNodes[S]=new _.PosDirTime(M)},_.SoundEnvironment.prototype.removeSoundNode=function(S){null!=this.soundNodes[S]&&delete this.soundNodes[S]},_.SoundEnvironment.prototype.update=function(S){if(this.now>S)throw new _.SoundEnvironment.UpdateError(this,'time < this.now (time: '+S+', this.now: '+this.now);for(var M in this.listeners)this.listeners[M].update(S);for(var M in this.soundNodes)this.soundNodes[M].update(S)},_.SoundEnvironment.UpdateError=function(S,M){this._this=S,this.message=M},_.PosDirTime=function(S,M){this.data=S,this.history=[],this.bufferMax=M},_.PosDirTime.prototype.update=function(S){0==this.history.length&&this.history.push({time:0,posture:Object.create(this.data)}),this.history.length>this.bufferMax&&this.history.splice(0,1),this.history.push({time:S,posture:Object.create(this.data)})},_.PosDirTime.prototype.getPosture=function(S){var M=this.search(S);if(null==M)return null;if(M.left==M.right)return this.history[M.left];var T=this.history[T],A=this.history[A],C=(S-T.time)/(A.time-T.time);return _.PosDir.interpolation(T,A,C)},_.PosDirTime.prototype.search=function(S){if(0>=this.history.length)return null;if(1==this.history.length)return{left:0,right:0};if(this.history[this.history.length-1].time<S)return{left:this.history.length-1,right:this.history.legnth-1};if(this.history[0].time>S)return{left:0,right:0};for(var M=0,T=this.history.length-1,A=Math.floor(T/2);;)if(A=Math.floor((S-this.history[M].time)*(T-M)/(this.history[T].time-this.history[M].time))+M,this.history[A].time<S){if(this.history[A+1]>S)return{left:A,right:A+1};M=A+1}else if(this.history[A].time>S){if(this.history[A-1].time<S)return{left:A-1,right:A};T=A-1}else return{left:A,right:A}},_.SoundNode=function(){_.AudioUnit.apply(this,arguments),_.PosDir.apply(this,arguments),this.gain=_.AUDIO_CONTEXT.createGain(),this.pannerNode=_.AUDIO_CONTEXT.createPanner(),this.gain.connect(this.pannerNode)},_.SoundNode.prototype=Object.create(_.AudioUnit.prototype),_.SoundNode.prototype.constructor=_.SoundNode,_.SoundNode.prototype.connect=function(S){_.AudioUnit.prototype.connect.apply(this,arguments),S.isAudioUnit?this.pannerNode.connect(S.getConnector()):this.pannerNode.connect(S)},_.SoundNode.prototype.disconnect=function(S){_.AudioUnit.prototype.disconnect.apply(this,arguments),S.isAudioUnit?this.pannerNode.disconnect(S.getConnector()):this.pannerNode.disconnect(S)},_.SoundNode.prototype.getConnector=function(){return this.gain},_.SoundNode.prototype.setPosition=function(S,M,T){_.PosDir.prototype.setPosition.call(this,S,M,T),this.pannerNode.setPosition(_.SOUND_ENVIRONMENT.unit*this.pos.x,_.SOUND_ENVIRONMENT.unit*this.pos.y,_.SOUND_ENVIRONMENT.unit*this.pos.z)},_.SoundNode.prototype.setDir=function(S,M,T){_.PosDir.prototype.setDir.call(this,S,M,T),this.pannerNode.setOrientation(this.dir.x,this.dir.y,this.dir.z)},_.SoundNode.prototype.setUp=function(S,M,T){_.PosDir.prototype.setUp.call(this,S,M,T)},_.SoundNode.prototype.setOrientation=function(S,M,T,A,C,E){_.PosDir.prototype.setOrientation.call(this,S,M,T,A,C,E),this.pannerNode.setOrientation(this.dir.x,this.dir.y,this.dir.z)},_.BufferSoundNode=function(S,M){_.SoundNode.apply(this,arguments),this.source=null==M?new _.BufferSource(S+'_src'):M,this.source.connect(this)},_.BufferSoundNode.prototype=Object.create(_.SoundNode.prototype),_.BufferSoundNode.prototype.constructor=_.BufferSoundNode,_.BufferSoundNode.prototype.setAudioBuffer=function(S){this.source.setAudioBuffer(S)},_.three.update=function(S){if(null==_.SOUND_ENVIRONMENT.cameras[S.id])return void console.log('mainCamera('+S.toString()+') is not added.');if(null==_.SOUND_ENVIRONMENT.cameras[S.id].listener.listener){for(var T in _.SOUND_ENVIRONMENT.cameras)_.SOUND_ENVIRONMENT.cameras[T].listener.resetListener();_.SOUND_ENVIRONMENT.cameras[S.id].listener.setListener(_.AUDIO_CONTEXT.listener)}for(var T in _.SOUND_ENVIRONMENT.cameras){var A=_.SOUND_ENVIRONMENT.cameras[T].camera,C=_.SOUND_ENVIRONMENT.cameras[T].listener;_.three.link(A,C)}for(var T in _.SOUND_ENVIRONMENT.attaches)for(var E=_.SOUND_ENVIRONMENT.attaches[T].object,D=0,P;D<_.SOUND_ENVIRONMENT.attaches[T].sources.length;D++)P=_.SOUND_ENVIRONMENT.attaches[T].sources[D],_.three.link(E,P)},_.three.addCamera=function(S){var M=S.id;if(null!=_.SOUND_ENVIRONMENT.cameras[M])return void console.warn('snd.SOUND_ENVIRONMENT already has camera('+S.toString()+').');var T=new _.Listener(null);_.SOUND_ENVIRONMENT.cameras[M]={camera:S,listener:T},_.SOUND_ENVIRONMENT.addListener(T)},_.three.removeCamera=function(S){null!=_.SOUND_ENVIRONMENT.cameras[S.id]&&(_.SOUND_ENVIRONMENT.removeListener(_.SOUND_ENVIRONMENT.cameras[S.id].listener),delete _.SOUND_ENVIRONMENT.cameras[S.id])},_.three.attach=function(S,M){var T=S.id;null==_.SOUND_ENVIRONMENT.attaches[T]&&(_.SOUND_ENVIRONMENT.attaches[T]={object:S,sources:[]}),_.SOUND_ENVIRONMENT.attaches[T].sources.push(M),_.SOUND_ENVIRONMENT.linkMap[M.id]=T},_.three.detach=function(S){var M=S.id;if(null!=_.SOUND_ENVIRONMENT.linkMap[M]){var T=_.SOUND_ENVIRONMENT.linkMap[M],A=_.SOUND_ENVIRONMENT.attaches[T].sources.indexOf(S);0<=A&&_.SOUND_ENVIRONMENT.attaches[T].sources.splice(A,1),delete _.SOUND_ENVIRONMENT.linkMap[M]}},_.three.link=function(S,M){if(!isNaN(S.position.x)&&!isNaN(S.position.y)&&!isNaN(S.position.z)&&!isNaN(S.quaternion.x)&&!isNaN(S.quaternion.y)&&!isNaN(S.quaternion.z)&&!isNaN(S.quaternion.w)){var T=new THREE.Matrix4;T.copy(S.matrixWorld);var A=new THREE.Matrix4;A.copy(T),A.elements[12]=0,A.elements[13]=0,A.elements[14]=0;var C=new THREE.Vector3(T.elements[12],T.elements[13],T.elements[14]),E=new THREE.Vector3(-T.elements[8],-T.elements[9],-T.elements[10]),D=new THREE.Vector3;D.copy(S.up),D.applyMatrix4(A),M.setPosition(C.x,C.y,C.z),M.setOrientation(E.x,E.y,E.z,D.x,D.y,D.z)}},THREE.snd=_}(),!function(window,$){function checkRenderingContext(){var _=document.createElement('canvas');return window.WebGLRenderingContext&&(_.getContext('webgl')||_.getContext('experimental-webgl'))}function getReferent(_){var S=tmp_root.find(_);if($.makeArray(rootObj.find(_),S),S.length){if(1<S.length){var M=[];return $.each(S,function(){M.push(getObj(this))}),M}return getObj(S[0])}}function getObj(_){return _&&_.nodeType&&(_=THREE_obj[_.getAttribute('three')]),_}function replaceObj(_,S){_.userData.clone&&(_.userData.clone.length=0,_.userData.original=null),S.userData=$.extend(_.userData,S.userData),THREE_obj[THREE_obj.indexOf(_)]=S}function removeObj(_,S){$.each($.merge([_],_.getElementsByTagName('*')),function(M){var T=getObj(this);0==M&&T instanceof THREE.Object3D&&!(T instanceof THREE.Scene)&&T.parent.remove(T),T&&T.userData&&!S&&(THREE_obj[this.getAttribute('three')]=T.userData.dom=null)})}function getHash(_){return _?JSON.parse('{'+$.trim(_).replace(/([^\s;]+)?\s*:/g,'"$1":').replace(/:\s*([^;]+);+/g,':"$1",').replace(/\s+/g,' ').replace(/:"(true|false)",/g,':$1,').replace(/:"(-?(\d+\.\d+|\d+))",/g,':$1,').slice(0,-1)+'}'):{}}function getArr(_){if(_){var S=$.trim(_).split(' ');return $.each(S,function(M,T){/^-?(\d*\.\d+|\d+)$/.test(T)&&(S[M]=parseFloat(T))})}return 0===_?[0]:[]}function urlToExtension(_){return!/^\.[^\/^\.]/.test(_)&&_.split('.').pop().split('?')[0].toLowerCase()}function getHtmlObj(_){return /^html /.test(_)?$(_):importFrame.contents().find(_)}function hasRenderObj(_){return _.__renderable=_.__camera&&_.__camera.userData.scene}function cssMethod(_,S){return function(M){return M&&(M instanceof jThree||M.nodeType)?this.css(_,M):this.css(_,Array.isArray(M)||M===void 0||S?M:1<arguments.length?arguments:/^qua/.test(_)?[M,M,M,M]:[M,M,M])}}function objToLocal(_,S,M){if(M&&(M instanceof jThree||M.nodeType)){var T=getObj(M instanceof jThree?M[0]:M);if(/(position|lookAt)/.test(S)){var A=new THREE.Vector3;if(M=styleAdmin(T,'position'),/(X|Y|Z)/.test(S)){var C=S.slice(-1).toLowerCase();A[C]=M[C];var E=_.parent.worldToLocal(T.parent.localToWorld(A));M=E[C]}else{A.set(M[0],M[1],M[2]);var E=_.parent.worldToLocal(T.parent.localToWorld(A));M=[E.x,E.y,E.z]}}else M=styleAdmin(T,S)}return M}function styleAdmin(_,S,M){if(M=objToLocal(_,S,M),!jThree.styleHooks[S]&&/^mtl/.test(S)){var T=S.charAt(3).toLowerCase()+S.slice(4),A=_.material[T];'number'==typeof A||'boolean'==typeof A||'string'==typeof A?function(){var C=T;jThree.styleHooks[S]={get:function(E){return E.material[C]},set:function(E,D){E.material[C]=D}}}():A instanceof THREE.Color?function(){var C=T;jThree.styleHooks[S]={get:function(E){var D=E.material[C],P=[255*D.r,255*D.g,255*D.b];return P.color=!0,P},set:function(E,D){E.material[C].set(D)}}}():/(map|Map)$/.test(S)||A instanceof THREE.Texture?function(){var C=T;jThree.styleHooks[S]={get:function(E){return E.material[C]&&E.material[C][C+'Selector']},set:function(E,D){var P=getReferent(D);E.material[C]=P,E.material[C][C+'Selector']=D,P.needsUpdate=!0}}}():(A instanceof THREE.Vector3||A instanceof THREE.Vector2)&&function(){var C=T;jThree.styleHooks[S]={get:function(E){var D=E.material[C];return 2===arguments.length?[D.x,D.y]:[D.x,D.y,D.z]},set:function(E,D){E.material[C].set(D[0],D[1],D[2])}}}()}return void 0===M?jThree.styleHooks[S].get(_):void jThree.styleHooks[S].set(_,M)}function checkText(_){return _ instanceof jThree||_.nodeType?_:'string'==typeof _?$(parseGOML(_)):($.each(_,function(S,M){'string'==typeof M&&(_[S]=$(parseGOML(M)))}),_)}function addToScene(_,S){if(_=getObj(_),'#document-fragment'===S.nodeName)$(S).children().each(function(){var T=getObj(this);T instanceof THREE.Object3D&&!(T instanceof THREE.Scene)&&_.add(T)});else{var M=getObj(S);M instanceof THREE.Object3D&&!(M instanceof THREE.Scene)&&_.add(M)}return S}function animate(_,S,M){if(_){var A=function(C){return!1===M.start(_,S,M)?void C():void(T=new AnimateObj(_,S,M,C,M.queue),_.userData.__animate.unshift(T),animationFrame(T.update),S=_=T=M=null)},T;_.userData.__animate=_.userData.__animate||[],!1===M.queue?A(function(){}):$(_.userData.dom).queue(A,M.queue)}}function optionNormalize(_){if(void 0===_.queue&&(_.queue='fx'),void 0===_.start&&(_.start=function(){}),'string'==typeof _.duration)switch(_.duration){case'slow':_.duration=600;break;case'fast':_.duration=200;break;default:_.duration=400;}return _}function genFx(_,S,M,T,A){'function'==typeof T&&(A=T,T=void 0);var C={duration:M||400,easing:T,complete:A},E={};return'slideDown'===S?C.start=function(D,P,R){return!D.visible&&void(P.scale=jThree.styleHooks.scale.get(D),D.scale.set(0,0,0),jThree.styleHooks.display.set(D,!0),D.traverse(function(L){if(L!==D){var N=jThree.styleHooks.position.get(L);L.position.set(0,0,0),animate(L,{position:N},optionNormalize({queue:!1,duration:R.duration,easing:R.easing}))}}))}:'slideUp'===S?C.start=function(D,P,R){if(!D.visible)return!1;var L=R.complete,N=jThree.styleHooks.scale.get(D);E.scale=[0,0,0],R.complete=function(){jThree.styleHooks.display.set(D,!1),jThree.styleHooks.scale.set(D,N),L&&L.call(this)},D.traverse(function(U){if(U!==D){var F=jThree.styleHooks.position.get(U);animate(U,{position:[0,0,0]},optionNormalize({queue:!1,duration:R.duration,easing:R.easing,complete:function(){jThree.styleHooks.position.set(U,F)}}))}})}:'fadeOut'===S?C.start=function(D,P,R){if(!D.visible)return!1;var L=R.complete,N=jThree.styleHooks.opacity.get(D);E.opacity=0,R.complete=function(){jThree.styleHooks.display.set(D,!1),jThree.styleHooks.opacity.set(D,N),L&&L.call(this)}}:'fadeIn'===S?C.start=function(D,P){return!D.visible&&void(P.opacity=jThree.styleHooks.opacity.get(D),jThree.styleHooks.opacity.set(D,0),jThree.styleHooks.display.set(D,!0))}:'hide'===S?C.start=function(D,P,R){if(!D.visible)return!1;var L=R.complete,N=jThree.styleHooks.opacity.get(D),U=jThree.styleHooks.scale.get(D);E.opacity=0,E.scale=[0,0,0],R.complete=function(){jThree.styleHooks.display.set(D,!1),jThree.styleHooks.scale.set(D,U),jThree.styleHooks.opacity.set(D,N),L&&L.call(this)},D.traverse(function(F){if(F!==D){var V=jThree.styleHooks.position.get(F);animate(F,{position:[0,0,0]},optionNormalize({queue:!1,duration:R.duration,easing:R.easing,complete:function(){jThree.styleHooks.position.set(F,V)}}))}})}:'show'===S?C.start=function(D,P,R){return!D.visible&&void(P.opacity=jThree.styleHooks.opacity.get(D),jThree.styleHooks.opacity.set(D,0),P.scale=jThree.styleHooks.scale.get(D),D.scale.set(0,0,0),jThree.styleHooks.display.set(D,!0),D.traverse(function(L){if(L!==D){var N=jThree.styleHooks.position.get(L);L.position.set(0,0,0),animate(L,{position:N},optionNormalize({queue:!1,duration:R.duration,easing:R.easing}))}}))}:void 0,_ instanceof jThree?_.animate(E,C):animate(getObj(_),E,optionNormalize(C))}function canvasEvent(_){var S=_.data.renderer;S.__renderable&&(S=projector.pickingRay(pickingVector.set(2*(_.offsetX===void 0?_.originalEvent.layerX:_.offsetX)/S.domElement.clientWidth-1,-2*(_.offsetY===void 0?_.originalEvent.layerY:_.offsetY)/S.domElement.clientHeight+1),S.__camera).intersectObjects(pickingObj(S),!1)[0],S&&($.each(_,function(M,T){eventReg.test(M)||(S[M]=T)}),$(S.object.userData.dom||S.object.parent.userData.dom).trigger($.Event('DOMMouseScroll'===_.type?'mousewheel':_.type,S))))}function pickingObj(_){var S=[];return $.each(_.__camera.userData.scene.__webglObjects,function(){this.render&&S.push(this.object)}),S}var jThree=function(_,S){return new jThree.fn.init(_,S)},dom_state=!1,dom_wait=[],goml_state=!1,goml_wait=[],src_state=!1,src_wait=[],rootObj;(function(){function _(S){function M(){if(! --T&&(goml_state=!0,goml_wait.forEach(function(C){C(jThree)}),T=M=goml_wait=null,MMD_SA_options.MMD_disabled)){var A=jThree;MMD_SA.fn.x_object_init(),MMD_SA._tray_updatable=!0,System._browser.update_tray(),jThree.Trackball&&(jThree.trackball=jThree.Trackball),A.trackball(),returnBoolean('MMDTrackballCamera')||MMD_SA._trackball_camera.stop(),MMD_SA.MMD_started=!0,A.MMD.play(!0),DEBUG_show('(MMD started)',2),MMD_SA.use_webgl2&&DEBUG_show('Use WebGL2',2)}}if(!dom_state&&(dom_state=!0,!!checkRenderingContext())){rootObj=$('<iframe style=\'display:none;\'/>').appendTo('body').contents();var T=$('[type=\'text/goml\']').length;$('[type=\'text/goml\']').each(function(){var A=this.getAttribute('src'),C;if(self.MMD_SA&&!A){if(C='<goml>\n\t<head>\n'+(MMD_SA.GOML_import?'<import>\n'+MMD_SA.GOML_import+'</import>\n':'')+MMD_SA.GOML_head,!MMD_SA_options.MMD_disabled){C+='<model id="mikuPmx0" src="'+(/^(\w+\:|\/)/.test(MMD_SA_options.model_path)?toFileProtocol(MMD_SA_options.model_path):MMD_SA_options.model_path)+'" onLoad="(self.MMD_SA||parent.MMD_SA).fn.setupUI()" />\n',MMD_SA_options.model_path_extra.forEach(function(L,N){C+='<model id="mikuPmx'+(N+1)+'" src="'+toFileProtocol(L)+'" onLoad="(self.MMD_SA||parent.MMD_SA).fn.setupUI()" />\n'});for(var E=0,D=MMD_SA_options.motion.length,P;E<D;E++)P=MMD_SA_options.motion[E],P.path&&(C+='<motion id="vmd'+E+'" src="'+toFileProtocol(/^(\w+\:|\/)/.test(P.path)?P.path:System.Gadget.path+'/'+P.path)+'" onLoad="(self.MMD_SA||parent.MMD_SA).fn.setupUI()" />\n')}C+='\t\t<rdr id="MMD_renderer" param="canvas:SL;antialias:true;clearAlpha:0;preserveDrawingBuffer:true;" frame="MMD_SA" />\n\t</head>\n\t<body>\n\t\t<scene id="MMD_scene">\n',C+='\t\t\t<light id="MMD_AmbLight" type="Amb"'+(MMD_SA_options.ambient_light_color?' param="'+MMD_SA_options.ambient_light_color+'"':'')+' />\n\t\t\t<light id="MMD_DirLight" type="Dir" param="'+MMD_SA_options.light_color+'" style="position:'+MMD_SA_options.light_position.join(' ')+';" />\n',C+=MMD_SA.GOML_scene,MMD_SA_options.MMD_disabled||(C+='<mmd model="#mikuPmx0" onLoad="(self.MMD_SA||parent.MMD_SA).fn.setupUI()" />\n',MMD_SA_options.model_path_extra.forEach(function(L,N){C+='<mmd model="#mikuPmx'+(N+1)+'" onLoad="(self.MMD_SA||parent.MMD_SA).fn.setupUI()" />\n'}));for(var E=0,D=MMD_SA_options.x_object.length,R;E<D;E++)R=MMD_SA_options.x_object[E],R.path&&(C+='\t\t\t<obj id="x_object'+E+'" model="'+(/^(\w+\:|\/)/.test(R.path)?toFileProtocol(R.path):R.path)+'" style="'+(R.style||'')+'" onLoad="(self.MMD_SA||parent.MMD_SA).fn.setupUI()" />\n');C+='\t\t\t<camera id="MMD_camera" '+(MMD_SA_options.camera_param?'param="'+('string'==typeof MMD_SA_options.camera_param?MMD_SA_options.camera_param:MMD_SA_options.camera_param.join(' '))+'" ':'')+'style="position:'+MMD_SA_options.camera_position.join(' ')+'; lookAt:'+(MMD_SA_options.camera_position[0]+' '+MMD_SA_options.camera_position[1])+' 0;" />\n\t\t</scene>\n\t</body>\n</goml>'}jThree.goml(A?A:C||this.innerHTML,M)}),$.each(dom_wait,function(A,C){jThree.goml(C[0],C[1],C[2])}),self.MMD_SA&&(S&&document.removeEventListener('DOMContentLoaded',_,!1),S&&window.removeEventListener('load',_,!1),MMD_SA.jThree_ready=null),_=dom_wait=null}}self.MMD_SA?MMD_SA.jThree_ready=function(){window.dispatchEvent(new CustomEvent('jThree_ready')),_()}:'complete'===document.readyState?_():(document.addEventListener('DOMContentLoaded',_,!1),window.addEventListener('load',_,!1))})(),jThree.goml=function(){var _=[];return function(S,M,T,A){if(!checkRenderingContext())return void(T&&T(jThree));if(!1===T&&(A=!1),!dom_state)dom_wait.push([S,M,A]);else if(/<.+?>/.test(S))_.length?_.push([S,M,A]):(parseGOML(S,A),src_state?M&&M(jThree):M&&src_wait.push(M));else{function E(){for(var D=0,P=_.length,R;D<P;D++)if(R=_[D],/<.+?>/.test(R[0]))parseGOML(R[0],R[2]),src_state?R[1]&&R[1](jThree):R[1]&&src_wait.push(R[1]);else{_=_.slice(D);break}E=C=null}var C=[S,M,A];_.push(C),$.ajax({url:S,async:!0,dataType:'text',success:function(D){C[0]=D,_[0]!==C||E()},error:function(){_[0]===C?(_.shift(),E()):_.splice(_.indexOf(C),1)}})}}}(),$.extend(jThree,$),jThree.fn=jThree.prototype=new $,jThree.fn.extend({jThree:'2.1.2',constructor:jThree,init:function(_,S,M){if(!_)return this;if('string'==typeof _)_=/<.+?>/.test(_)?parseGOML(_):S?rootObj.find(S).find(_):rootObj.find(_);else if(_.userData)_=_.userData.dom;else if(_===document)_=rootObj;else if('function'==typeof _)return checkRenderingContext()?(!1===S&&(M=!1),void(!1===M?goml_state?_(jThree):goml_wait.push(_):src_state?_(jThree):src_wait.push(_))):void(S&&S(jThree));$.makeArray(_,this)}}),jThree.fn.init.prototype=jThree.fn,$.support.webgl=checkRenderingContext(),jThree.modelHooks={},jThree.motionHooks={},jThree.geoHooks={},jThree.mtlHooks={};var THREE_obj=[],tmp_root=$(),importFrame,importStates='none';jThree.fn.contents=function(){return'IMPORT'===this[0].tagName?importFrame.contents():this};var parseGOML=function(){function getDom(){return this.userData.dom}function setObj(_,S){_.setAttribute('three',THREE_obj.length),THREE_obj.push(S),S instanceof THREE.Object3D?S.userData.dom=_:(S.userData={},S.userData.dom=_,S instanceof THREE.Material?S.userData.clone=[]:!(S instanceof THREE.Geometry)&&(S.dom=getDom)),$.each(Object.assign({},_.attributes),function(M,T){_.getAttribute(T.name);prop[T.name]&&T.value&&prop[T.name].call(_,T.value)}),S instanceof THREE.Object3D&&_.getAttribute('jstyle')&&$.each(getHash(_.getAttribute('jstyle')),function(M,T){var A=styleAdmin(S,M);'number'==typeof A?T=isNaN(+T)?T:+T:Array.isArray(A)&&(A.color?/ /.test(T)&&(T=getArr(T)):(T=getArr(T),1===T.length&&(T[1]=T[2]=T[0]))),styleAdmin(S,M,T)}),_=S=null}function addCamera(){$.each(this.userData.renderer,function(){animationFrame(this),this.__resize()})}function removeCamera(){$.each(this.userData.renderer,function(){animationFrame(this,!1)})}function newCloneNode(_){var S=this.cloneNode(void 0===_||_);return parseGOML(S),S}function srcLoaded(){--loadLength||(setTimeout(function(){src_state=!0,src_wait.forEach(function(_){_(jThree)}),src_wait.length=0},0),$.event.remove(this,'load',srcLoaded),$.event.remove(this,'error',srcErrored))}function srcErrored(){srcLoaded.call(this)}var tag_name='IMPORT MMD MODEL MOTION SCENE CAMERA TXR MTL GEO LIGHT OBJ PTS SPRITE MESH RDR'.split(' '),loadLength=0;return THREE.Object3D.prototype.dom=THREE.Material.prototype.dom=THREE.Geometry.prototype.dom=getDom,jThree.extend({getCamera:function(_){var S=getObj(_).__camera;return S&&S.userData.dom},getScene:function(_){var S=getObj(_).__camera;return S&&S.userData.scene&&S.userData.scene.userData.dom},getCanvas:function(_){return getObj(_).domElement}}),function(goml,srcWaiting){var waitRdr={},obj3D=[],html='string'==typeof goml&&/<\/import>/.test(goml)?goml.match(/<import(.|\n|\r)*?import>/)[0].replace(/^(.+)?>/,'').replace(/<\/import>$/,''):'',jq=$('string'==typeof goml?goml.replace(html,'').replace(/^<\?(.+)?\?>/,'').replace(/^[\n\r\s\t]*/,'').replace(/(head|body)>/g,'j$1>').replace(/ style=/g,' jstyle='):goml),isRoot='GOML'===jq[0].tagName,tmp_list={},tmp,that,obj;$.each(tag_name,function(_,S){tmp_list[S]=[]}),jq.add(jq.find('*')).each(function(){this.cloneNode=newCloneNode,-1===tag_name.indexOf(this.tagName)||(tmp_list[this.tagName].push(this),(!1!==srcWaiting&&isRoot&&this.hasAttribute('src')||this.hasAttribute('model')||this.hasAttribute('motion')||this.hasAttribute('html')||this.hasAttribute('video')||this.hasAttribute('canvas')||'IMPORT'===this.tagName)&&(loadLength++,$.event.add(this,'load',srcLoaded),$.event.add(this,'error',srcErrored)))}),isRoot&&(rootObj.find('head').append(jq.find('jhead').children()),rootObj.find('body').append(jq.find('jbody').children())),tmp_root=tmp_root.add(jq),$.each(tmp_list.IMPORT,function(){importFrame||(tmp=getHash(this.getAttribute('param')),importFrame=$('<iframe frameborder="0" style="border: none;position: fixed; top: 110%;" />').appendTo('body').width(tmp.width||1e3).height(tmp.height||1e3)),importStates='loading';var _=this,S=importFrame.one('load',function(){importStates='success',$.event.trigger('load',void 0,_),_=null}).contents()[0];this.hasAttribute('href')?importFrame[0].src=this.getAttribute('href'):(this.innerText=html,S.open(),S.write(html),S.close())}),$.each(tmp_list.MODEL.concat(tmp_list.MOTION),function(){setObj(this,{})}),$.each(tmp_list.MMD,function(){setObj(this,new THREE.Object3D)}),Array.prototype.push.apply(obj3D,tmp_list.MMD),$.each(tmp_list.SCENE,function(){setObj(this,new THREE.Scene)}),self.MMD_SA&&!MMD_SA.scene&&(MMD_SA.scene=THREE_obj[THREE_obj.length-1],MMD_SA.scene._RAF_timestamp_=-1,MMD_SA_options.fog&&(MMD_SA_options.fog.linear?MMD_SA.scene.fog=new THREE.Fog(MMD_SA_options.fog.color||0,MMD_SA_options.fog.near||void 0,MMD_SA_options.fog.far||void 0):MMD_SA.scene.fog=new THREE.FogExp2(MMD_SA_options.fog.color||0,null==MMD_SA_options.fog.density?5e-3:MMD_SA_options.fog.density))),$.each(tmp_list.CAMERA,function(){that=this,tmp=that.getAttribute('param'),tmp=/:/.test(tmp)?getHash(tmp):getArr(tmp),self.MMD_SA&&MMD_SA_options.use_JSARToolKit?(obj=new THREE.PerspectiveCamera(49,MMD_SA_options.width/MMD_SA_options.height,0.1,1e4),obj.matrixAutoUpdate=!1,obj.setJsArMatrix(MMD_SA.AR_obj.param),MMD_SA.AR_obj.camera_position=new THREE.Vector3(MMD_SA_options.camera_position[0],MMD_SA_options.camera_position[1],MMD_SA_options.camera_position[2]),obj.matrix.identity(),obj.matrix.setPosition(MMD_SA.AR_obj.camera_position)):'Ort'===that.getAttribute('type')?0<tmp.length?obj=new THREE.OrthographicCamera(tmp[0],tmp[1],tmp[2],tmp[3],tmp[4],tmp[5]):(tmp.width&&(tmp.right=tmp.width/2,tmp.left=-tmp.width/2),tmp.height&&(tmp.top=tmp.height/2,tmp.bottom=-tmp.height/2),obj=new THREE.OrthographicCamera(tmp.left,tmp.right,tmp.top,tmp.bottom,tmp.near,tmp.far),obj.userData.__width=tmp.right,obj.userData.__height=tmp.top):0<tmp.length?obj=new THREE.PerspectiveCamera(tmp[0],tmp[1],tmp[2],tmp[3]):obj=new THREE.PerspectiveCamera(tmp.fov,tmp.aspect,tmp.near,tmp.far),setObj(that,obj),obj.userData.renderer=[],obj.addEventListener('added',addCamera),obj.addEventListener('removed',removeCamera),self.MMD_SA&&MMD_SA.camera_list.push(obj)}),Array.prototype.push.apply(obj3D,tmp_list.CAMERA),$.each(tmp_list.TXR,function(){tmp=getHash(this.getAttribute('param')),this.hasAttribute('src')?(obj=THREE.ImageUtils.loadTexture(this.getAttribute('src')),this.removeAttribute('src')):this.hasAttribute('video')?(obj=new THREE.Texture(document.createElement('video')),obj.generateMipmaps=!1):this.hasAttribute('html')||this.hasAttribute('canvas')?(obj=new THREE.Texture(document.createElement('canvas')),obj.image.width=1,obj.image.height=1,obj.generateMipmaps=!1,obj.minFilter=obj.magFilter):this.hasAttribute('camera')&&(obj=new THREE.WebGLRenderTarget(tmp.width||1024,tmp.height||1024),tmp.rdr=tmp.rdr||'rdr',waitRdr[tmp.rdr]=waitRdr[tmp.rdr]||[],waitRdr[tmp.rdr].push(obj),delete tmp.camera,delete tmp.rdr),tmp.repeat&&(tmp.repeat='number'==typeof tmp.repeat?[tmp.repeat,tmp.repeat]:eval('['+tmp.repeat.split(/\s+/)+']'),obj.repeat.set(tmp.repeat[0],tmp.repeat[1])),tmp.offset&&('number'==typeof tmp.offset&&(tmp.offset=[tmp.offset,tmp.offset]),obj.offset.set(tmp.offset[0],tmp.offset[1])),void 0===tmp.wrap?tmp.repeat&&(obj.wrapS=obj.wrapT=1e3):('number'==typeof tmp.wrap&&(tmp.wrap=[tmp.wrap,tmp.wrap]),obj.wrapS=tmp.wrap[0]+1e3,obj.wrapT=tmp.wrap[1]+1e3),delete tmp.repeat,delete tmp.offset,delete tmp.wrap,delete tmp.height,delete tmp.width,$.extend(obj,tmp),setObj(this,obj)});var _mirror=[];return $.each(tmp_list.MTL,function(){that=this,tmp=getHash(that.getAttribute('param')),tmp.map&&(tmp.map=getReferent(tmp.map)),tmp.lightMap&&(tmp.lightMap=getReferent(tmp.lightMap)),tmp.specularMap&&(tmp.specularMap=getReferent(tmp.specularMap)),tmp.displacementMap&&(tmp.displacementMap=getReferent(tmp.displacementMap)),tmp.normalMap&&(tmp.normalMap=getReferent(tmp.normalMap)),null!=tmp.waveBaseSpeed&&(tmp.waveNoiseTexture=getReferent('#waveNoiseTexture')),tmp.bumpMap?tmp.bumpMap=getReferent(tmp.bumpMap):tmp.bumpScale&&tmp.map&&(tmp.bumpMap=tmp.map),tmp.AT_process&&(MMD_SA_options[tmp.AT_process](this,tmp),delete tmp.AT_process),$.each(tmp,function(_,S){'string'==typeof S&&/ /.test(S)&&(tmp[_]=getArr(S))}),that.getAttribute('type')&&'Mirror'==that.getAttribute('type')?(setObj(that,new THREE.MirrorMaterial(tmp)),_mirror.push(MMD_SA._THREE_mirror[MMD_SA._THREE_mirror.length-1])):setObj(that,new THREE[(that.getAttribute('type')||'')+'Material'](tmp))}),$.each(tmp_list.GEO,function(){if(this.getAttribute('type'))tmp=getArr(this.getAttribute('param')),obj=new THREE[this.getAttribute('type')+'Geometry'](tmp[0],tmp[1],tmp[2],tmp[3],tmp[4],tmp[5],tmp[6]);else if(this.getAttribute('src'))obj=new THREE.Geometry;else{obj=new THREE.Geometry;for(var _=+this.getAttribute('param');_;_--)obj.vertices.push(new THREE.Vector3)}setObj(this,obj)}),$.each(tmp_list.LIGHT,function(){if(tmp=getArr(this.getAttribute('param')),setObj(this,new THREE[light_type[this.getAttribute('type')]](tmp[0],tmp[1],tmp[2],tmp[3],tmp[4])),self.MMD_SA){var _=THREE_obj[THREE_obj.length-1];MMD_SA.light_list.push({obj:_}),2==MMD_SA.light_list.length&&Object.defineProperty(MMD_SA.light_list[1],'pos',{get:function(){var S=new THREE.Vector3;return function(){return S.fromArray(MMD_SA_options.light_position)}}(),set:function(){}})}}),Array.prototype.push.apply(obj3D,tmp_list.LIGHT),$.each(tmp_list.OBJ,function(){setObj(this,new THREE.Object3D)}),Array.prototype.push.apply(obj3D,tmp_list.OBJ),$.each(tmp_list.SPRITE,function(){setObj(this,new THREE.Sprite(new THREE.Material()))}),Array.prototype.push.apply(obj3D,tmp_list.SPRITE),$.each(tmp_list.MESH,function(){setObj(this,new THREE.Mesh(new THREE.Geometry(),new THREE.Material()))}),Array.prototype.push.apply(obj3D,tmp_list.MESH),$.each(obj3D,function(){this.parentNode.tagName&&'GOML'!==this.parentNode.tagName&&getObj(this.parentNode).add(getObj(this))}),$.each(tmp_list.RDR,function(){tmp=getHash(this.getAttribute('param')),void 0===tmp.clearAlpha&&(tmp.clearAlpha=1),obj=new THREE.WebGLRenderer(tmp),obj.__renderTarget=[],this.getAttribute('camera')||this.setAttribute('camera','camera:first'),this.getAttribute('frame')||this.setAttribute('frame','body'),jThree.MMD&&obj.renderPluginsPre.unshift(jThree.MMD._simulate),setObj(this,obj),obj.__updateFn=[]}),self.MMD_SA&&!MMD_SA.renderer&&(MMD_SA.renderer=jThree('#MMD_renderer').three(0),MMD_SA.renderer&&(MMD_SA.renderer.shadowMapEnabled=!0,MMD_SA.renderer.shadowMapType=THREE.PCFSoftShadowMap,_mirror.forEach(function(_){_.renderer=jThree(_._renderer_id).three(0),jThree(_._mesh_id).three(0).add(_)}))),$.each(waitRdr,function(_){obj=getReferent(_),obj.__renderTarget=obj.__renderTarget.concat(this),$.each(this,function(){prop.invisible.call(this,this.userData.dom.getAttribute('invisible'))}),obj.__resize()}),tmp=that=obj=waitRdr=srcWaiting=null,tmp_root=tmp_root.not(jq),$.each(tmp_list,function(_){tmp_list[_].length=0}),isRoot?(loadLength?src_state=!1:(src_state=!0,src_wait.forEach(function(_){_(jThree)}),src_wait.length=0),rootObj):jq}}();THREE.PerspectiveCamera.prototype.resize=function(_,S){this.aspect=_/S,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype.resize=function(_,S){var M=this.userData;M.__width&&M.__height||(M.__width?(M=M.__width*S/_,this.top=M,this.bottom=-M):M.__height?(M=M.__height*_/S,this.right=M,this.left=-M):(M=50*S/_,this.top=M,this.bottom=-M,M=M*_/S,this.right=M,this.left=-M),this.updateProjectionMatrix())};var prop={src:function(_){var S=getObj(this);if(!(S instanceof THREE.Texture)){var T=urlToExtension(_),A=this.tagName.toLowerCase();if(jThree[A+'Hooks'][T]){this.setAttribute('type',T);var C=this;jThree[A+'Hooks'][T].call(this,_,function(E){E instanceof THREE.Geometry||E instanceof THREE.Material?replaceObj(getObj(C),E):(getObj(C)._srcObj=E,self.MMD_SA&&C.id&&(MMD_SA._j3_obj_by_id[C.id]=E)),C.setAttribute('loadStates','success'),$.event.trigger('load',void 0,C),C=null},function(){C.setAttribute('loadStates','error'),$.event.trigger('error',void 0,C),C=null}),this.setAttribute('loadStates','loading')}else this.setAttribute('loadStates','error'),$.event.trigger('error',void 0,this)}else if(S.sourceFile=_,delete S.image.crossOrigin,/^(tga|TGA)/.test(_.split('.').pop())){var M=new THREE.TGA;M.open(_,function(){S.image.src=M.getDataURL(),S.needsUpdate=!0,M=null})}else /^data:image/.test(_)||(S.image.crossOrigin='anonymous'),S.image.src=_},html:function(_){if(!/^html /.test(_)&&'success'!=importStates){var S=this;return void importFrame.one('load',function(){prop.html.call(S,_),S=_=null})}var M=getHtmlObj(_)[0],T=getObj(this);T._htmlReset&&T._htmlReset(),T._htmlReset=function(){jThree.update(T._htmlUpdate,!1),M=T=null},T._htmlUpdate=function(){THREE.html2canvas(M,{onrendered:function(A){T&&(T.image=A,T.needsUpdate=!0)}})},THREE.html2canvas(M,{onrendered:function(A){T.image=A,T.needsUpdate=!0,$.event.trigger('load',void 0,T.dom())}}),jThree.update(T._htmlUpdate,'true'===this.getAttribute('animation'))},video:function(_){function S(){D.needsUpdate=!0}function M(){D.image.width=E.videoWidth,D.image.height=E.videoHeight,jThree.update(S)}function T(){jThree.update(S,!1)}if(!/^html /.test(_)&&'success'!=importStates){var A=this;return void importFrame.one('load',function(){prop.video.call(A,_),A=_=null})}var C=getHtmlObj(_),E=C[0];E.crossOrigin='anonymous';var D=getObj(this);D.image=E,D._videoReset&&D._videoReset(),C.on('play',M).on('ended pause error',T),E.paused||E.ended||M(),D._videoReset=function(){C.off('play',M).off('ended pause error',T),jThree.update(S,!1),C=E=D=S=null},$.event.trigger('load',void 0,this)},canvas:function(_){if(!/^html /.test(_)&&'success'!=importStates){var S=this;return void importFrame.one('load',function(){prop.canvas.call(S,_),S=_=null})}var M=getObj(this);M._canvasReset&&M._canvasReset(),M._canvasReset=function(){jThree.update(M._canvasUpdate,!1),M=null},M._canvasUpdate=function(){M.needsUpdate=!0},M.image=getHtmlObj(_)[0],M.needsUpdate=!0,jThree.update(M._canvasUpdate,'true'===this.getAttribute('animation')),$.event.trigger('load',void 0,this)},audio:function(){var _=0;return function(S){if(window.AudioContext||window.webkitAudioContext){if(!/^html /.test(S)&&'success'!=importStates){var M=this;return void importFrame.one('load',function(){prop.audio.call(M,S),M=S=null})}var T=getHtmlObj(S),A=getObj(this),C=getReferent(jThree('rdr').attr('camera')||'camera');THREE.snd._AUDIO_CONTEXT||THREE.snd.init(),A._sndReset&&A._sndReset();var E=[];A._sndReset=function(){E.forEach(function(D){THREE.snd.MASTER.disconnectAudioUnit(D.id),THREE.snd.three.detach(D)}),E=null},THREE.snd.SOUND_ENVIRONMENT.cameras[C.id]||function(){var D=C;THREE.snd.three.addCamera(D),jThree.update(function(){THREE.snd.three.update(D)})}(),T.each(function(){this.crossOrigin='anonymous';var D=_++,P=new THREE.snd.BufferSoundNode(D,new THREE.snd.MediaElementAudioSource(D+.5,this));E.push(P),THREE.snd.MASTER.connectAudioUnit(P.id,P),THREE.snd.three.attach(A,P)})}}}(),animation:function(_){var S=getObj(this),M=S._htmlUpdate?S._htmlUpdate:!!S._canvasUpdate&&S._canvasUpdate;M&&jThree.update(M,'true'===_||!0===_)},invisible:function(_){_=getReferent(_),getObj(this).__invisible=!_||Array.isArray(_)?_:[_]},geo:function(){var _={};return function(S){var M=this,T=urlToExtension(S);if(jThree.geoHooks[T])var A=_[S]=_[S]||parseGOML('<geo src="'+S+'" />');else{var A=tmp_root.find(S);A.length||(A=rootObj.find(S))}if(A.attr('src')){function L(){var U=getObj(M),F=U.parent;if(U.geometry.dom()||U.geometry.dispose(),U.geometry=getObj(this),F){var V=U.userData.scene;if(V)for(var I=V.__webglObjects,O=I.length-1;0<=O;O--)I[O].object===U&&I.splice(O,1);F.remove(U),delete U.__webglActive,delete U.__webglInit,F.add(U)}$.event.trigger('load',void 0,M),N()}function N(U){$.event.remove(A,'load',L),$.event.remove(A,'error',N),U&&$.event.trigger('error',void 0,M),L=N=A=M=null}switch(A.attr('loadStates')){case'loading':A.load(L),A.error(N);break;case'success':L.call(A[0]);break;default:$.event.trigger('error',void 0,this);}}else{var C=getObj(this),E=C.parent;if(C.geometry.dom()||C.geometry.dispose(),C.geometry=getObj(A[0]),E){var D=C.userData.scene;if(D)for(var P=D.__webglObjects,R=P.length-1;0<=R;R--)P[R].object===C&&P.splice(R,1);E.remove(C),delete C.__webglActive,delete C.__webglInit,E.add(C)}}}}(),mtl:function(){var _={};return function(S){var M=this,T=urlToExtension(S);if(jThree.mtlHooks[T])var A=_[S]=_[S]||parseGOML('<mtl src="'+S+'" />');else{var A=tmp_root.find(S);A.length||(A=rootObj.find(S))}if(A.attr('src')){function E(){var P=getObj(M);P.material.dispose(),P.material=getObj(this).clone(),P instanceof THREE.Sprite&&(P.material.useScreenCoordinates=!1,P.material.scaleByViewport=!1),$.each(P.material,function(){this instanceof THREE.Texture&&(this.needsUpdate=!0)}),$.event.trigger('load',void 0,M),D()}function D(P){$.event.remove(A,'load',E),$.event.remove(A,'error',D),P&&$.event.trigger('error',void 0,M),E=D=A=M=null}switch(A.attr('loadStates')){case'loading':A.load(E),A.error(D);break;case'success':E.call(A[0]);break;default:$.event.trigger('error',void 0,this);}}else{var C=getObj(this);C.material.dispose(),C.material=getObj(A[0]).clone(),C instanceof THREE.Sprite&&(C.material.useScreenCoordinates=!1,C.material.scaleByViewport=!1),$.each(C.material,function(){this instanceof THREE.Texture&&(this.needsUpdate=!0)})}}}(),model:function(){var _={},S={};return function(M){function T(P){var R=getObj(C),L=getObj(this)._srcObj;if('MMD'!==C.tagName)L=L.clone(),R._modelObj&&R.remove(R._modelObj),R._modelObj=L,getObj(C).add(L),$.event.trigger('load',void 0,C),C=R=null;else{var N=C.getAttribute('motion'),U;if(N){var F=urlToExtension(N);jThree.motionHooks[F]?U=S[N]=S[N]||parseGOML('<motion src="'+N+'" />'):(U=tmp_root.find(N),!U.length&&(U=rootObj.find(N))),self.MMD_SA&&/^\#/.test(N)&&(U._id=N.replace(/^\#/,''))}jThree.mmdHook.call(C,L,U,function(V){R._modelObj&&R.remove(R._modelObj),R._modelObj=V,getObj(C).add(V),$.event.trigger('load',void 0,C),C=R=null})}P&&($.event.remove(this,'load',T),$.event.remove(this,'error',A))}function A(){$.event.remove(this,'load',T),$.event.remove(this,'error',A),$.event.trigger('error',void 0,C),C=null}var C=this,E=urlToExtension(M);if(jThree.modelHooks[E])var D=_[M]=_[M]||parseGOML('<model src="'+M+'" />');else{var D=tmp_root.find(M);D.length||(D=rootObj.find(M))}switch(D.attr('loadStates')){case'loading':D.load(T),D.error(A);break;case'success':T.call(D[0]);break;default:$.event.trigger('error',void 0,this);}}}(),motion:function(){var _={};return function(S){if('MMD'!==this.tagName){var M=urlToExtension(S);if(jThree.motionHooks[M])var T=_[S]=_[S]||parseGOML('<motion src="'+S+'" />');else{var T=tmp_root.find(S);T.length||(T=rootObj.find(S))}jThree.otherMmdHook.call(this,T)}}}(),frame:function(_){if('MMD_SA'==_){var S=getObj(this);return animationFrame(S),void function(){var C=S,E=jThree(S),T,A,D;MMD_SA._renderer=S,D=function(P,R){T=P||MMD_SA_options.width,A=R||MMD_SA_options.height,C.setSize(T,A),C.__camera&&C.__camera.resize(T,A),C.__renderTarget.forEach(function(L){L.__camera&&L.__camera.resize(T,A)})},E.resize(D).resize(),C.__resize=D}()}var S=getObj(this),M=$(_)[0];S.frameElement?M.insertBefore(S.frameElement[0],M.firstChild):(S.frameElement=$('<div style="position:relative;margin:0;padding:0;height:100%;"><iframe name="jthreeIframe" frameborder="0" scrolling="no" style="position:absolute;top:0;left:0;width: 100%; height: 100%; margin: 0; padding: 0; vertical-align: bottom;" /></div>'),M.insertBefore(S.frameElement[0],M.firstChild),S.domElement.style.position='relative',S.frameElement.append(S.domElement),S.frameWindow=jthreeIframe,S.frameElement.find('iframe').attr('name',''),animationFrame(S),function(){function T(){A=E.domElement.parentNode.clientWidth,C=E.domElement.parentNode.clientHeight,E.setSize(A,C),E.__camera&&E.__camera.resize(A,C),E.__renderTarget.forEach(function(P){P.__camera&&P.__camera.resize(A,C)})}var E=S,D=jThree(S),A,C;D.resize(T).resize(),$(S.frameWindow).resize(function(){D.resize()}),E.__resize=T}())},camera:function(_){var S=getReferent(_),M=getObj(this),T=M.__camera;if(M.__camera=S,!(M instanceof THREE.WebGLRenderTarget)){var A=$(M.domElement);if(T){var C=T.userData.renderer;C.splice(C.indexOf(M),1),animationFrame(M,!1);var E=T.userData.scene;if(E){var D=E.userData._events;D&&$.each(D,function(P){A.off('mousewheel'===P?'DOMMouseScroll mousewheel':P,canvasEvent)})}}if(S){animationFrame(M),S.userData.renderer.push(M),M.__resize&&M.__resize();var E=S.userData.scene;if(E){var D=E.userData._events;D&&$.each(D,function(P){A.on('mousewheel'===P?'DOMMouseScroll mousewheel':P,canvasEvent)})}}A=null}},rendering:function(_){animationFrame(getObj(this),'true'===_||!0===_)},fog:function(_){_=getArr(_),getObj(this).fog=new THREE[2===_.length?'FogExp2':'Fog'](_[0],_[1],_[2])}},light_type={};$.each(THREE,function(_){/.+?Light$/.test(_)&&(light_type[_.slice(0,3)]=_)}),jThree.three=function(_){return getObj(_)},jThree.fn.three=function(_){return _===void 0?$.map(this,function(S){return getObj(S)}):getObj(this.get(_))};var animationFrame=function(){var _=[],S=[],C=0,E=[],M,T,A,D,P;return self.animationFrame_RAF=function(R){for(D=R-C,C=R,M=S.length;M;)S[--M](D,R);for(M=_.length;M;){for(P=_[--M],(T=P.__updateFn.length)&&(A=P.userData.dom);T;)P.__updateFn[--T].call(A,D,R);for(T=P.__renderTarget.length;T;)A=P.__renderTarget[--T],A.__invisible&&A.__invisible.forEach(function(L){jThree.styleHooks.display.get(L)&&(E.push(L),jThree.styleHooks.display.set(L,!1))}),P.render(A.__camera.userData.scene,A.__camera,A),E.forEach(function(L){jThree.styleHooks.display.set(L,!0)}),E.length=0;self.MMD_SA&&MMD_SA.render(P)||P.render(P.__camera.userData.scene,P.__camera)}},self.Animate_RAF?(self.EV_animate_full=animationFrame_RAF,animationFrame_RAF(0)):function(R){requestAnimationFrame(arguments.callee),animationFrame_RAF(R)}(0),function(R,L){if('function'==typeof R){var N=S.indexOf(R);!1===L?-1!==N&&S.splice(N,1):-1===N&&S.unshift(R)}else{var N=_.indexOf(R);!1===L?(hasRenderObj(R),-1!==N&&_.splice(N,1)):-1===N&&hasRenderObj(R)&&_.unshift(R)}}}();jThree.fn.update=function(_,S){return this.each(function(){jThree.update(this,_,S)})},jThree.update=function(_,S,M){if(!S||!0===S)animationFrame(_,S);else if(!1===M){var T;_=getObj(_),_.__updateFn&&-1!==(T=_.__updateFn.indexOf(S))&&_.__updateFn.splice(T,1)}else _=getObj(_),_.__updateFn&&-1===_.__updateFn.indexOf(S)&&_.__updateFn.unshift(S)},jThree.fn.attr=jThree.fn.prop=function(_,S){if('string'==typeof _){if(S===void 0)return this[0].getAttribute(_);this.each(function(T){var A=this.getAttribute(_),C='function'==typeof S?S.call(this,T):S;/^data-/.test(_)?jThree.dataHooks[_.slice(5)]&&jThree.dataHooks[_.slice(5)].call(this,C):prop[_]&&prop[_].call(this,C),this.setAttribute(_,C),jThree.event.trigger($.Event('attrChange',{attrName:_,oldValue:A,newValue:C}),void 0,this)})}else if('object'==typeof _){var M=this;$.each(_,function(T,A){M.attr(T,A)})}return this},jThree.fn.add=function(_,S){var M='string'==typeof _?jThree(_,S):$.makeArray(_&&_.nodeType?[_]:_),T=$.merge(this.get(),M);return this.pushStack($.unique(T))};var axis_symbol=['x','y','z'],style_menu=['position','scale','up'];jThree.styleHooks={},$.each(axis_symbol,function(_,S){var M='lookAt'+S.toUpperCase();jThree.styleHooks[M]={get:function(T){return T._lookAt[S]},set:function(T,A){var C=T._lookAt;C[S]=A,T.lookAt(C)}},jThree.fn[M]=cssMethod(M,!0),M='translate'+S.toUpperCase(),jThree.styleHooks[M]={get:function(){return 0},set:function(T,A){T['translate'+S.toUpperCase()](A)}},jThree.fn[M]=cssMethod(M,!0),M='rotate'+S.toUpperCase(),jThree.styleHooks[M]={get:function(T){return T.rotate[S]},set:function(T,A){T.useQuaternion&&(T.useQuaternion=!1),T.rotate[S]=A}},jThree.fn[M]=cssMethod(M,!0),$.each(style_menu,function(T,A){M=A+S.toUpperCase(),jThree.styleHooks[M]={get:function(C){return C[A][S]},set:function(C,E){C[A][S]=E}},jThree.fn[M]=cssMethod(M,!0)})}),axis_symbol.push('w'),$.each(axis_symbol,function(_,S){var M='quaternion'+S.toUpperCase();jThree.styleHooks[M]={get:function(T){return T.quaternion[S]},set:function(T,A){T.useQuaternion||(T.useQuaternion=!0),T.quaternion[S]=A}},jThree.fn[M]=cssMethod(M,!0),M='qtAxisAngle'+S.toUpperCase(),jThree.styleHooks[M]={get:function(T){return T.qtAxisAngle[S]},set:function(){var T=new THREE.Vector3;return function(A,C){A.useQuaternion||(A.useQuaternion=!0),A.qtAxisAngle[S]=C,A.quaternion.setFromAxisAngle(T.copy(A.qtAxisAngle).normalize(),A.qtAxisAngle.w)}}()},jThree.fn[M]=cssMethod(M,!0)}),jThree.styleHooks.lookAt={get:function(_){var S=_._lookAt;return[S.x,S.y,S.z]},set:function(_,S){var M=_._lookAt;M.set(S[0],S[1],S[2]),_.lookAt(M)}},jThree.fn.lookAt=cssMethod('lookAt'),jThree.styleHooks.translate={get:function(){return[0,0,0]},set:function(){var _=new THREE.Vector3;return function(S,M){S.position.add(_.set(M[0],M[1],M[2]).applyEuler(S.rotation,S.eulerOrder))}}()},jThree.fn.translate=cssMethod('translate'),jThree.styleHooks.rotate={get:function(_){var S=_.rotate;return[S.x,S.y,S.z]},set:function(_,S){_.useQuaternion&&(_.useQuaternion=!1),_.rotate.set(S[0],S[1],S[2])}},jThree.fn.rotate=cssMethod('rotate'),jThree.styleHooks.quaternion={get:function(_){var S=_.quaternion;return[S.x,S.y,S.z,S.w]},set:function(_,S){_.useQuaternion||(_.useQuaternion=!0),_.quaternion.set(S[0],S[1],S[2],S[3])}},jThree.fn.quaternion=cssMethod('quaternion'),jThree.styleHooks.qtAxisAngle={get:function(_){var S=_.qtAxisAngle;return[S.x,S.y,S.z,S.w]},set:function(){var _=new THREE.Vector3;return function(S,M){S.useQuaternion||(S.useQuaternion=!0),S.qtAxisAngle.set(M[0],M[1],M[2],M[3]),S.quaternion.setFromAxisAngle(_.copy(S.qtAxisAngle).normalize(),S.qtAxisAngle.w)}}()},jThree.fn.qtAxisAngle=cssMethod('qtAxisAngle'),$.each(style_menu,function(_,S){jThree.styleHooks[S]={get:function(M){var T=M[S];return[T.x,T.y,T.z]},set:function(M,T){M[S].set(T[0],T[1],T[2])}},jThree.fn[S]=cssMethod(S)}),$.extend(jThree.styleHooks,{axis:{get:function(_){return _.userData.__axis?_.userData.__axis.geometry.vertices[1].x:0},set:function(_,S){var M=_.userData.__axis;M&&_.remove(M),S&&(M=new THREE.AxisHelper(S),_.userData.__axis=M,_.add(M))}},display:{get:function(_){return!1!==_.userData.__display},set:function(_,S){S===void 0?S=!1===_.userData.__display||!1===_.parent.visible?!1:!0:_.userData.__display=S=!!S,S?_.traverse(function(M){return!(M instanceof THREE.Bone)&&void(M.visible=!1===M.userData.__display||M.parent&&!1===M.parent.visible?!1:!0)}):_.traverse(function(M){return!(M instanceof THREE.Bone)&&void(M.visible=!1)})}},opacity:{get:function(_){return _.userData.__opacity===void 0?1:_.userData.__opacity},set:function(_,S){S!==void 0&&(_.userData.__opacity=S),_.traverse(function(M){return M.material?!(M instanceof THREE.Bone)&&void(M.material.opacity=(M.parent&&M.parent.material?M.parent.material.opacity:1)*(M.userData.__opacity===void 0?1:M.userData.__opacity)):void 0})}}}),jThree.fn.extend({css:function(_,S){if('string'==typeof S&&(S=getArr(S),1===S.length&&(S=S[0])),'string'==typeof _){if(void 0===S)return styleAdmin(getObj(this[0]),_);this.each(function(){styleAdmin(getObj(this),_,S)})}else{var M;this.each(function(){M=getObj(this),$.each(_,function(T,A){styleAdmin(M,T,A)})}),M=null}return this}}),axis_symbol=style_menu=null,['intensity','distance','angle','exponent'].forEach(function(_){jThree.styleHooks['light'+_.charAt(0).toUpperCase()+_.slice(1)]={get:function(S){return S[_]},set:function(S,M){S[_]=M}}}),['color','ground','sky'].forEach(function(_){jThree.styleHooks['light'+_.charAt(0).toUpperCase()+_.slice(1)]={get:function(S){var M=S[_],T=[255*M.r,255*M.g,255*M.b];return T.color=!0,T},set:function(S,M){S[_].set(M)}}}),['width','height'].forEach(function(_){jThree.styleHooks['camera'+_.charAt(0).toUpperCase()+_.slice(1)]={get:function(S){return S instanceof THREE.OrthographicCamera?2*S.userData['__'+_]||('width'==_?S.right-S.left:S.top-S.bottom):void 0},set:function(S,M){var T='width'===_?{right:M/2,left:-M/2}:{top:M/2,bottom:-M/2},A=S.right-S.left,C=S.top-S.bottom;S.userData['__'+_]=isNaN(T.right)?T.top:T.right,$.extend(S,T),S.resize(A,C)}}}),['left','right','top','bottom','near','far','fov','aspect'].forEach(function(_){jThree.styleHooks['camera'+_.charAt(0).toUpperCase()+_.slice(1)]={get:function(S){return S instanceof THREE.Camera?S[_]:void 0},set:function(S,M){S[_]=M,S.updateProjectionMatrix()}}}),jThree.fn.extend({append:function(){return this.domManip(checkText(arguments),function(_){this.appendChild(addToScene(this,_))})},prepend:function(){return this.domManip(checkText(arguments),function(_){this.insertBefore(addToScene(this,_),this.firstChild)})},before:function(){return this.domManip(checkText(arguments),function(_){this.parentNode.insertBefore(addToScene(this.parentNode,_),this)})},after:function(){return this.domManip(checkText(arguments),function(_){this.parentNode.insertBefore(addToScene(this.parentNode,_),this.nextSibling)})},empty:function(){for(var S=0,_;null!=(_=this[S]);S++)1===_.nodeType&&($.cleanData($.merge([_],_.getElementsByTagName('*'))),$.each(_.children,function(){removeObj(this,!1)}),_.textContent='');return this},remove:function(_,S){for(var T=_?$.filter(_,this):this,A=0,M;null!=(M=T[A]);A++)S||1!==M.nodeType||$.cleanData($.merge([M],M.getElementsByTagName('*'))),M.parentNode&&(M.parentNode.removeChild(M),removeObj(M,S));return this},replaceWith:function(){var _=$.map(this,function(M){return[M.nextElementSibling||M,M.parentNode]}),S=0;return this.domManip(checkText(arguments),function(M){var T=_[S++],A=_[S++];A&&(A.insertBefore(addToScene(A,M),T),jThree(this).remove())},!0),S?this:this.remove()}}),$.each({appendTo:'append',prependTo:'prepend',insertBefore:'before',insertAfter:'after',replaceAll:'replaceWith'},function(_,S){jThree.fn[_]=function(M){for(var A=[],C=jThree(M),E=C.length-1,D=0,T;D<=E;D++)T=D===E?this:this.clone(!0),jThree(C[D])[S](T),Array.prototype.push.apply(A,T.get());return this.pushStack(A)}}),jThree.fn.extend({wrapAll:function(_){var S;return'function'==typeof _?this.each(function(M){jThree(this).wrapAll(_.call(this,M))}):(this[0]&&(S=jThree(_).eq(0).clone(!0),this[0].parentNode&&S.insertBefore(this[0]),S.map(function(){for(var M=this;M.firstElementChild;)M=M.firstElementChild;return M}).append(this)),this)},wrapInner:function(_){return'function'==typeof _?this.each(function(S){jThree(this).wrapInner(_.call(this,S))}):this.each(function(){var S=jThree(this),M=S.contents().not('text');M.length?M.wrapAll(_):S.append(_)})},wrap:function(_){return this.each(function(S){jThree(this).wrapAll('function'==typeof _?_.call(this,S):_)})},unwrap:function(){return this.parent().each(function(){'body'!==this.nodeName&&jThree(this).replaceWith(jThree(this).children())}).end()}}),jThree._animate=[];var animate_id=0,AnimateObj=function(_,S,M,T,A){var C=!!(0<M.duration)&&M.duration,E=M.easing&&'linear'!==M.easing&&jThree.easing[M.easing],D='return function(delta,elapsed){',P=animate_id++,R=jThree._animate[P]={},L={},U=this,N;S&&(D='var storage=jThree._animate['+P+'],jthree=storage.jthree,data=storage.data,easing=storage.easing;'+D,$.each(S,function(F,V){if(N=styleAdmin(_,F),V=objToLocal(_,F,V),N.color&&(/^#/.test(V)?(4===V.length&&(V=V.replace(/^#(.)(.)(.)/,'#$1$1$2$2$3$3')),V=+('0x'+V.slice(1))):'string'==typeof V&&/ /.test(V)&&(V=getArr(V)),'number'==typeof V&&(V=[255&V>>16,255&V>>8,255&V])),D+='jThree.styleHooks.'+F+'.set(jthree,','number'==typeof N)'string'==typeof V&&(V='+'===V.charAt(0)?N+ +V.slice(2):N-+V.slice(2)),D+=C?/^translate/.test(F)?'delta*'+V/C:(E?'easing(elapsed/'+C+',elapsed,0,1,'+C+')*'+(V-N):'elapsed*'+(V-N)/C)+(0===N?'':'+'+N):V;else{D+='[','string'==typeof V&&(V=getArr(V)),$.each(V,function(O,B){'string'==typeof B&&(B='+'===B.charAt(0)?N[O]+ +B.slice(2):N[O]-+B.slice(2)),C?'translate'===F?D+='delta*'+B/C:(D+=(E?'easing(elapsed/'+C+',elapsed,0,1,'+C+')*'+(B-N[O]):'elapsed*'+(B-N[O])/C)+(0===N[O]?'':'+'+N[O]),E&&(N.easing=E)):D+=B,D+=','}),D=D.replace(/,$/,'')+']',N=[]}L[F]=N,D+=');'})),D+='return '+(M.tween&&C&&E?'easing(elapsed/'+C+',elapsed,0,1,'+C+')':C?'elapsed/'+C:'elapsed')+';};',R.jthree=_,R.data=L,R.easing=E,U.update=function(){var V=U,I=0,O=new Function(D)(),B=M.step,G=B?function(X,Y){B.call(_,O(X,Y))}:function(X,Y){O(X,Y)},H=C,W=H?function(X){0>H-X?(I=H,V.update(0)):H===X&&V.stop()}:function(){};return V.gotoEnd=function(){G(H-I,H),V.stop()},function(X){G(X,I+=X),W(I)}}(),U.dequeue=T,U.queue=A,U.obj=_,U.id=P,U.storage=R,U.complete=M.complete||function(){}};AnimateObj.prototype.stop=function(){this.complete.call(this.storage.jthree.userData.dom),delete jThree._animate[this.id],animationFrame(this.update,!1),this.obj.userData.__animate.splice(this.obj.userData.__animate.indexOf(this),1),this.dequeue()},jThree.fn.extend({animate:function(_,S,M,T){var A={};return'object'==typeof arguments[1]&&(A=arguments[1]),$.each(arguments,function(C,E){return 1===C?('function'==typeof E?A.step=E:'object'!=typeof E&&(A.duration=E,'function'==typeof M?A.complete=M:(A.easing=M,A.complete=T)),!1):void('object'!=typeof E&&(_=!1,'function'==typeof E&&(A.step=E)))}),optionNormalize(A),this.each(function(){animate(getObj(this),_,A)}),this},stop:function(_,S){return this.each(function(){var M=this;$.each(getObj(M).userData.__animate,function(){_&&this.queue&&$.queue(M,this.queue,[]),S?this.gotoEnd():this.stop()})}),this},slideDown:function(_,S,M){return genFx(this,'slideDown',_,S,M)},slideUp:function(_,S,M){return genFx(this,'slideUp',_,S,M)},slideToggle:function(_,S,M){return this.each(function(){genFx(this,getObj(this).visible?'slideUp':'slideDown',_,S,M)}),this},fadeOut:function(_,S,M){return genFx(this,'fadeOut',_,S,M)},fadeIn:function(_,S,M){return genFx(this,'fadeIn',_,S,M)},fadeToggle:function(_,S,M){return this.each(function(){genFx(this,getObj(this).visible?'fadeOut':'fadeIn',_,S,M)}),this},fadeTo:function(_,S,M,T){return'function'==typeof M&&(T=M,M=void 0),this.animate({opacity:S},{easing:M,complete:T,duration:_,start:function(A){A.visible||(A.userData.__opacity=0),A.traverse(function(D){!D.material||D.visible||(D.material.opacity=0)}),jThree.styleHooks.display.set(A,!0)}})},show:function(_,S,M){return _===void 0?this.css('display',!0):genFx(this,'show',_,S,M)},hide:function(_,S,M){return _===void 0?this.css('display',!1):genFx(this,'hide',_,S,M)},toggle:function(_,S,M){return this.each(function(){void 0===_?jThree.styleHooks.display.set(getObj(this),!getObj(this).visible):'boolean'==typeof _?jThree.styleHooks.display.set(getObj(this),_):genFx(this,getObj(this).visible?'hide':'show',_,S,M)}),this}}),jThree.easing=Object.create($.easing);var projector=new THREE.Projector,pickingVector=new THREE.Vector3,eventReg=/^(currentTarget|data|delegateTarget|handleObj|jQuery\d+|target|timeStamp|type)$/;THREE.Scene.prototype.eventChange=function(_,S){var M=this.userData._events=this.userData._events||{},T=this,A=[],C=[];_?($.each(_,function(E){M[E]||(M[E]=[],A.push(E));-1!==M[E].indexOf(S)||M[E].push(S)}),$.each(M,function(E){var D=M[E].indexOf(S);_[E]||-1===D||(1===M[E].length?(delete M[E],C.push(E)):M[E].splice(D,1))})):$.each(M,function(E){var D=M[E].indexOf(S);-1===D||(1===M[E].length?(delete M[E],C.push(E)):M[E].splice(D,1))}),jThree('rdr').three().forEach(function(E){if(E.__camera&&E.__camera.userData.scene===T){var D=$(E.domElement);A.forEach(function(P){D.on('mousewheel'===P?'DOMMouseScroll mousewheel':P,{renderer:E},canvasEvent)}),C.forEach(function(P){D.off('mousewheel'===P?'DOMMouseScroll mousewheel':P,canvasEvent)}),E=D=null}}),M=S=T=_=A=C=null},function(){function _(){var S=$._data(this,'events'),M=jThree.three(this);if('BODY'===this.tagName){var T=jThree('scene').three();$.each(T,function(){this.eventChange(S,M)})}else if(M instanceof THREE.Object3D){var T='SCENE'===this.tagName?M:M.userData.scene;T.eventChange(S,M)}S=M=null}jThree.fn.on=function(){return $.fn.on.apply(this,arguments),this.each(_),this},jThree.fn.off=function(){return $.fn.off.apply(this,arguments),this.each(_),this}}(),jThree.fn.mousewheel=function(_,S){return 0<arguments.length?this.on('mousewheel',null,_,S):this.trigger('mousewheel')},jThree.fn.load=function(_,S,M){if('string'!=typeof _)return $.fn.load.apply(this,arguments);var E=this,D=_.indexOf(' '),T,A,C;return 0<=D&&(T=_.slice(D),_=_.slice(0,D)),'function'==typeof S?(M=S,S=void 0):S&&'object'==typeof S&&(A='POST'),0<E.length&&$.ajax({url:_,type:A,dataType:'text',data:S}).done(function(P){C=arguments,E.empty().append(T?jThree(/<goml/.test(P)?P:'<obj>'+P+'</obj>').find(T):P)}).complete(M&&function(P,R){E.each(M,C||[P.responseText,R,P])}),this},window.jThree=jThree}(window,jQuery);
jThree.MMD=jThree.mmd={_onLoop:!1,_delta:0,_animate:function(delta){if(jThree.MMD._delta=delta*=1e-3,self.MMD_SA){if(MMD_SA._rendered_once&&!MMD_SA._x_object_displayed_once&&(MMD_SA._x_object_displayed_once=!0,MMD_SA_options.mesh_obj_all.forEach(function(d){var _=d._obj;if(d.use_child_animation_texture||(_.scale.x=_.scale.y=_.scale.z=d.scale),MMD_SA_options.Dungeon)return void(d.visible=_.visible);if(d.visible=d.hidden_on_start&&!_.visible?!1:0<_.scale.x,/^\#mikuPmx(\d+)$/.test(d.id)){var u=MMD_SA_options.model_para_obj_all[RegExp.$1];d.visible=!(u.hidden_on_start||MMD_SA_options.hidden_on_start)}d.visible?d.show(!0):d.hide(!0)}),MMD_SA_options.use_speech_bubble&&!MMD_SA_options.MMD_disabled)){var SB=MMD_SA.SpeechBubble;SB._mesh.scale.x=SB._mesh.scale.y=SB._mesh.scale.z=1,SB.visible||jThree("#SpeechBubbleMESH").hide()}MMD_SA_options.model_para_obj_all.forEach(function(d,_){d.scale&&THREE.MMD.getModels()[_].mesh.scale.set(d.scale,d.scale,d.scale)});var obj=MMD_SA_options.mesh_obj_by_id.CircularSpectrumMESH;if(obj)if(!(MMD_SA.music_mode||WallpaperEngine_CEF_mode&&MMD_SA.AudioFFT&&MMD_SA.AudioFFT._has_audio))obj.hide(),MMD_SA_options.Dungeon&&(obj._pos_updated_=void 0);else if(MMD_SA.AudioFFT&&MMD_SA.AudioFFT._fft128){if(!MMD_SA_options.CircularSpectrum_position){var cv=MMD_SA.center_view;obj._obj.position.set(cv[0],cv[1]+10,cv[2])}MMD_SA_options.Dungeon&&(!obj.pos_base&&(obj.pos_base=obj._obj.position.clone()),!obj.rot_base&&(obj.rot_base={x:0,y:0,z:0}),!obj._pos_updated_&&(MMD_SA_options.Dungeon.character.pos_update(),obj._pos_updated_=!0));var scale=obj._obj.scale;scale.x=scale.y=scale.z=1,obj.show();for(var _fft=MMD_SA.AudioFFT._fft128,_fft_last=MMD_SA.AudioFFT._fft_last128,i=0,i_max=_fft.length;i<i_max;i++){var v=_fft[i],v_last=_fft_last[i]||0;100<v&&(v=100),v<v_last-10&&(v=v_last-10),_fft_last[i]=v;var obj=jThree("#CircularSpectrum"+i+"MESH").three(0);obj.material.opacity=MMD_SA_options.CircularSpectrum_opacity||0.8,obj.scale.y=0.5+19.5*(v/100)}}MMD_SA._rendered_once=!0}if(self.MMD_SA&&!MMD_SA_options.MMD_disabled){if(MMD_SA._gravity_){var gravity;if(0>=MMD_SA._gravity_factor)MMD_SA._gravity_factor=null,MMD_SA._gravity_=null,gravity=MMD_SA.gravity;else{gravity=[];for(var gravity_default=MMD_SA.MMD.motionManager.para_SA.gravity||[0,-1,0],i=0;3>i;i++)gravity[i]=MMD_SA._gravity_[i]*MMD_SA._gravity_factor+gravity_default[i]*(1-MMD_SA._gravity_factor);MMD_SA._gravity_factor-=1/60}THREE.MMD.setGravity(10*(9.8*gravity[0]),10*(9.8*gravity[1]),10*(9.8*gravity[2]))}if(MMD_SA_options.use_JSARToolKit){var AR_obj=MMD_SA.AR_obj;if(0<AR_obj.startup_countdown)AR_obj.startup_countdown-=delta,AR_obj.canvas.getContext("2d").fillRect(0,0,AR_obj.canvas.width,AR_obj.canvas.height);else if(MMD_SA.AR_video){var AR_para=MMD_SA_options.AR_para,base_id=AR_para.marker_base_id,debug_msg=[];if(!AR_obj._skip_AR_frame){var context;context=SL_webcam.getContext("2d"),context.globalCompositeOperation="copy",context.drawImage(MMD_SA.AR_video,0,0,SL_webcam.width,SL_webcam.height),MMD_SA.matrix_rain&&MMD_SA.matrix_rain._SA_draw(),SL_webcam._WebGL_2D&&SL_webcam._WebGL_2D.draw();var canvas=AR_obj.canvas;context=canvas.getContext("2d"),context.globalCompositeOperation="copy",context.drawImage(MMD_SA.AR_video,0,0,AR_obj.canvas.width,AR_obj.canvas.height),canvas.changed=!0;for(var markerCount=AR_obj.markerCount=AR_obj.detector.detectMarkerLite(AR_obj.raster,128),idx=0;idx<markerCount;idx++){var id=AR_obj.detector.getIdMarkerData(idx),currId=-1,len=id.packetLength;if(4>=len){currId=0;for(var i=0;i<len;i++)currId=currId<<8|id.getPacketData(i)}var marker=AR_obj.markers[currId];marker||(marker=AR_obj.markers[currId]={m4:new THREE.Matrix4},marker.transform=new NyARTransMatResult),AR_obj.resultMat=marker.transform,AR_obj.detector.getTransformMatrix(idx,AR_obj.resultMat),marker.m4.setJsArMatrix(AR_obj.resultMat),currId==base_id?(marker.active_counter=40,AR_obj._m4=marker.m4,AR_para._marker_base_transform&&marker.m4.multiply(AR_para._marker_base_transform)):marker.active_counter=20}}AR_para.skip_alternate_AR_frame&&(AR_obj._skip_AR_frame=!AR_obj._skip_AR_frame),Object.keys(AR_obj.markers).forEach(function(d){var _=AR_obj.markers[d];_.active_counter--});var base_marker_projected;if(AR_obj._m4&&0>=AR_obj.markers[base_id].active_counter){AR_obj._m4=null;for(var marker_base_id_spare_list=AR_para.marker_base_id_spare_list,i=0,i_max=marker_base_id_spare_list.length,marker;i<i_max;i++)if(marker=AR_obj.markers[marker_base_id_spare_list[i]],marker&&0<marker.active_counter&&marker.m4_to_base){AR_obj._m4=marker.m4.clone().multiply(marker.m4_to_base),base_marker_projected=!0;break}}if(AR_obj._m4&&!base_marker_projected)for(var marker_base_id_spare_list=AR_para.marker_base_id_spare_list,i=0,i_max=marker_base_id_spare_list.length,marker;i<i_max;i++)marker=AR_obj.markers[marker_base_id_spare_list[i]],marker&&0<marker.active_counter&&(marker.m4_to_base=AR_obj._m4a.getInverse(AR_obj._m4b.getInverse(AR_obj.TEMP_m4.getInverse(marker.m4).multiply(AR_obj._m4))));if(AR_obj._m4){var camera=MMD_SA._trackball_camera.object,_m4=AR_obj._m4,r,cp,cr;r=_m4.decompose(),cp=r[0],cr=AR_obj.TEMP_v3.setEulerFromQuaternion(r[1].normalize());var _x=cr.x,_y=cr.y,_z=cr.z;cp.x=-cp.x,cp.y=-cp.y;var qq=AR_obj._q1.setFromEuler(AR_obj.TEMP_v3.set(_x-Math.PI/2,-_z,-_y),"YZX");r[1]=qq.normalize(),r[0].applyQuaternion(r[1]),camera.matrix.identity(),camera.matrix.makeRotationFromQuaternion(r[1]),AR_obj.camera_position=r[0],camera.matrix.setPosition(r[0]),camera.matrixWorldNeedsUpdate=!0;var marker_base=AR_obj.markers[base_id];marker_base.position=new THREE.Vector3(0,0,0),marker_base.rotation=new THREE.Quaternion().setFromEuler(AR_obj.TEMP_v3.set(-_x+90/180*Math.PI,_y,_z)),marker_base._camera_position=cp.clone(),r&&debug_msg.push("camera("+AR_obj.markerCount+")"+(base_marker_projected?"(P)":"")+":"+parseInt(cp.x)+","+parseInt(cp.y)+","+parseInt(cp.z)+"/"+parseInt(180*-_x/Math.PI+90)+","+parseInt(180*_y/Math.PI)+","+parseInt(180*_z/Math.PI)),Object.keys(AR_obj.markers).forEach(function(d){if(d!=base_id){var _=AR_obj.markers[d];if(!(0>=_.active_counter)){var u=AR_obj.TEMP_m4.getInverse(AR_obj._m4).multiply(_.m4).decompose(),M=u[0];_.position=new THREE.Vector3(M.x,-M.z,-M.y),_.rotation=u[1].normalize(),debug_msg.push(d+":"+parseInt(_.position.x)+","+parseInt(_.position.y)+","+parseInt(_.position.z)+"/"+parseInt(180*AR_obj.TEMP_v3.setEulerFromQuaternion(_.rotation).z/Math.PI))}}})}else debug_msg.push("(base marker not found)");debug_msg=debug_msg.concat(MMD_SA._debug_msg),debug_msg.length&&(DEBUG_show(debug_msg.join("\n")),MMD_SA._debug_msg=[])}else DEBUG_show("(video not available)")}var _delta=delta,mmd=MMD_SA.MMD,vo=Audio_BPM.vo,ignore_para=vo.motion_by_song_name_mode,mm,para,BPM,playbackRate,_playbackRate;mm=mmd.motionManager,para=!ignore_para&&mm.para_SA.BPM||{},BPM=para.BPM||120,playbackRate=vo.BPM_mode?vo._sender.playbackRate:120/BPM,_playbackRate=playbackRate*(para._playbackRate||1)*MMD_SA.playbackRate,jThree.MMD._delta=delta=_delta*_playbackRate;var model=THREE.MMD.getModels()[0],skin=model.skin;MMD_SA._motion_time_=skin.time+delta;var onended_done;if(!MMD_SA._force_motion_shuffle&&MMD_SA.motion_shuffle_started&&skin.time+delta>mm.lastFrame_/30){let d={return_value:null};window.dispatchEvent(new CustomEvent("SA_MMD_model0_onmotionended",{detail:{result:d}})),!d.return_value&&mm.para_SA.onended&&mm.para_SA.onended(!0),MMD_SA._freeze_onended?(skin.time=mm.lastFrame_/30-delta-1/59/1e3,MMD_SA._freeze_onended=null):onended_done=!0}MMD_SA_options.custom_motion_shuffle&&MMD_SA_options.custom_motion_shuffle();for(var multi_model_motion_reset_check=[],multi_model_motion_reset=[],i=0,i_max=MMD_SA_options.model_para_obj_all.length;i<i_max;i++)multi_model_motion_reset_check[i]=!0,multi_model_motion_reset[i]=!MMD_SA.motion_shuffle_started||MMD_SA_options.model_para_obj_all[i]._motion_name_next;var _delta0_from_last_loop=0;if(MMD_SA._force_motion_shuffle||multi_model_motion_reset[0]||skin.time+delta>mm.lastFrame_/30){var adjust_center_view=!MMD_SA.motion_shuffle_started;if(mmd.frame_time_ref=0,!onended_done){let d={return_value:null};window.dispatchEvent(new CustomEvent("SA_MMD_model0_onmotionended",{detail:{result:d}})),!d.return_value&&mm.para_SA.onended&&mm.para_SA.onended()}var motion_changed=!MMD_SA.motion_shuffle_started;MMD_SA.motion_shuffle()&&(motion_changed=!0),MMD_SA_options.onmotionended&&MMD_SA_options.onmotionended(motion_changed);var motion_index=MMD_SA_options.motion_shuffle||MMD_SA_options._motion_shuffle_list_default?MMD_SA_options.motion_shuffle_list[MMD_SA.motion_shuffle_index]:0,motion=MMD_SA_options.motion[motion_index];if(MMD_SA._force_motion_shuffle&&(adjust_center_view=!0),MMD_SA._force_motion_shuffle=null,_delta=1/59/1e3,motion_changed){adjust_center_view=!0,mm=mmd.motionManager,para=!ignore_para&&mm.para_SA.BPM||{},BPM=para.BPM||120,playbackRate=vo.BPM_mode?vo._sender.playbackRate:120/BPM,_playbackRate=playbackRate*(para._playbackRate||1)*MMD_SA.playbackRate;var obj=model._MMD_SA_cache_current=model._MMD_SA_cache[motion.path];model.skin=obj.skin,model.morph=obj.morph,model.resetMotion(MMD_SA._ignore_physics_reset),MMD_SA.reset_skin(0),MMD_SA.reset_morph(0),THREE.MMD.adjustMotionDuration(),MMD_SA_options.model_para_obj.onMotionChange&&MMD_SA_options.model_para_obj.onMotionChange()}else{_delta0_from_last_loop=Math.max(Math.min(skin.time+delta-mm.lastFrame_/30,0.1),0);var ignore_physics_reset=!1==mm.para_SA.loopback_physics_reset||mm.lastFrame_==mm.lastFrame&&!mm.firstFrame_&&!mm.para_SA.loopback_fading;model.resetMotion(ignore_physics_reset||MMD_SA._ignore_physics_reset)}for(var i=1,i_max=MMD_SA_options.model_para_obj_all.length;i<i_max;i++)MMD_SA_options.model_para_obj_all[i].mirror_motion_from_first_model&&(multi_model_motion_reset[i]=!0);if(mm.para_SA.onstart){var code_onstart=mm.para_SA.onstart(motion_changed);code_onstart&&eval(code_onstart)}adjust_center_view&&!mm.para_SA.adjust_center_view_disabled&&MMD_SA.reset_camera(),jThree.MMD._delta=delta=_delta*_playbackRate,model.playMotion(),(_delta0_from_last_loop||mm.firstFrame_)&&model.seekMotion(_delta0_from_last_loop+(mm.firstFrame_&&mm.firstFrame_/30||0))}for(var i=1,i_max=MMD_SA_options.model_para_obj_all.length;i<i_max;i++)if(multi_model_motion_reset_check[i]){var _model=THREE.MMD.getModels()[i];if(_model.skin){var mm,mm0;mm=mm0=MMD_SA.motion[_model.skin._motion_index];var model_para=MMD_SA_options.model_para_obj_all[i],lastFrame=model_para.is_OPC&&mm.para_SA.BPM?mm.lastFrame:mm.lastFrame_,_delta_from_last_loop=0;if(!multi_model_motion_reset[i]){if(_model.skin.time+delta<=lastFrame/30)continue;_delta_from_last_loop=Math.min(_model.skin.time+delta-lastFrame/30,0.1),!mm.para_SA.is_OPC&&mm.para_SA.onended_NPC&&mm.para_SA.onended_NPC(i)}var motion_changed=!1,obj;if(model_para._motion_name_next||multi_model_motion_reset[i]&&model_para.mirror_motion_from_first_model){mm0=mmd.motionManager,_delta_from_last_loop=_delta0_from_last_loop;var motion_name_by_model=model_para._motion_name_next||mm0.para_SA.multi_model_motion_list&&mm0.para_SA.multi_model_motion_list[i-1];model_para._motion_name_next=null;var _path=(motion_name_by_model&&MMD_SA_options.motion_para[motion_name_by_model]||mm0.para_SA)._path,obj=_model._MMD_SA_cache[_path];motion_changed=obj&&obj.skin._motion_index!=_model.skin._motion_index}if(!motion_changed){var ignore_physics_reset=_model.skin.time&&(!1==mm.para_SA.loopback_physics_reset||lastFrame==mm.lastFrame&&!(model_para._firstFrame_||mm.firstFrame_)&&!mm.para_SA.loopback_fading);_model.resetMotion(ignore_physics_reset||MMD_SA._ignore_physics_reset)}else if(_model._MMD_SA_cache_current=obj,_model.skin=obj.skin,_model.morph=obj.morph,_model.resetMotion(MMD_SA._ignore_physics_reset),MMD_SA.reset_skin(i),MMD_SA.reset_morph(i),THREE.MMD.adjustMotionDuration(),mm=MMD_SA.motion[_model.skin._motion_index],model_para.mirror_motion_from_first_model||(mm0=mm),model_para.onMotionChange&&model_para.onMotionChange(),mm.para_SA.NPC_turns_to_you){var npc=_model.mesh,c=THREE.MMD.getModels()[0].mesh;MMD_SA.TEMP_v3.set(0,Math.PI/2-Math.atan2(c.position.z-npc.position.z,c.position.x-npc.position.x),0),npc.quaternion.setFromEuler(MMD_SA.TEMP_v3)}if(mm.para_SA.onstart){var code_onstart=mm.para_SA.onstart(motion_changed);code_onstart&&eval(code_onstart)}_model.playMotion(),(_delta_from_last_loop||model_para._firstFrame_||mm0.firstFrame_)&&_model.seekMotion(_delta_from_last_loop+((model_para._firstFrame_||mm0.firstFrame_)&&(model_para._firstFrame_||mm0.firstFrame_)/30||0)),model_para._firstFrame_=null}}MMD_SA._ignore_physics_reset=null;var t=window.performance?performance.now():Date.now();if(mmd.frame_time_ref){if(para._playbackRate){var time_diff=t-mmd.frame_time_ref;if(time_diff>=para._playbackRate_countdown){var p_ratio=para._playbackRate_countdown/time_diff;_playbackRate=playbackRate*(para._playbackRate*p_ratio+(1-p_ratio)),jThree.MMD._delta=delta=_delta*_playbackRate,para._playbackRate=null}else para._playbackRate_countdown-=time_diff}}else if(use_SVG_Clock||vo.BPM_mode){var beat_frame=para.beat_frame;if(null!=beat_frame){var current_frame=30*(model.skin.time+delta),beat_interval=60/BPM,time_from_beat_to_beat=(current_frame-beat_frame)/30;if(vo.BPM_mode){var ao=vo.audio_obj;time_from_beat_to_beat-=(ao.currentTime-ao.beat_reference)*playbackRate}var beat,beats;beat=beats=time_from_beat_to_beat/beat_interval,beat-=~~beat,0>beat&&beat++,beat=0.5>beat?-beat:1-beat,beats=Math.round(beats+beat),beats%2&&(!vo.BPM_mode||para.match_even_beats_only)&&(0>beat?(beat++,beats++):(beat--,beats--));var beats_info="/"+(beats%2?"odd":"even"),sec=beat*beat_interval;if(!vo.BPM_mode){sec/=playbackRate;var msec=new Date().getMilliseconds()/1e3;sec+=msec,0.5<sec?sec-=1:-0.5>sec&&(sec+=1),sec*=playbackRate,beat=sec/beat_interval}if(sec/=playbackRate,0.05<Math.abs(sec)){var mod=0.5<Math.abs(beat)?2:1;para._playbackRate=1+sec/mod,para._playbackRate_countdown=1e3*mod;var info=Math.abs(~~(100*beat)/100)+"beat"+beats_info;DEBUG_show("BPM sync("+(0<sec?"+":"-")+info+")",2)}else;}}if(mmd.frame_time_ref=t,null!=MMD_SA.fadeout_opacity){MMD_SA.fadeout_opacity-=delta;var context=SL_2D_front.getContext("2d");if(0<MMD_SA.fadeout_opacity)SL_2D_front.width=SL.width,SL_2D_front.height=SL.height,context.globalCompositeOperation="copy",context.globalAlpha=MMD_SA.fadeout_opacity,context.drawImage(MMD_SA.fadeout_canvas,0,0),use_WebGL_2D?("inline"!=SL_2D_front._WebGL_2D.canvas.style.display&&(SL_2D_front._WebGL_2D.canvas.style.display="inline"),SL_2D_front._WebGL_2D.draw()):"inline"!=SL_2D_front.style.display&&(SL_2D_front.style.display="inline");else if(MMD_SA.fadeout_opacity=null,context.globalCompositeOperation="copy",context.globalAlpha=1,context.clearRect(0,0,SL_2D_front.width,SL_2D_front.height),SL_2D_front.style.display="none",use_WebGL_2D){var w2d=SL_2D_front._WebGL_2D;w2d.gl.clear(w2d.gl.COLOR_BUFFER_BIT),w2d.canvas.style.display="none"}}MMD_SA._playbackRate=_playbackRate}if(!is_SA_child_animation&&MMD_SA_options.child_animation_as_texture){for(var c_id=0,i=0,redraw,ani;i<SA_child_animation_max;i++)if(ani=SA_child_animation[i],ani){var child=document.getElementById("Ichild_animation"+i),cw,cwSL;if(!child)continue;else if(cw=child.contentWindow,cwSL=cw.SL,!cwSL)continue;if(cwSL._drawn_id&&ani._SL_drawn_id==cwSL._drawn_id||(ani._SL_drawn_id=cwSL._drawn_id,redraw=!0),++c_id>=MMD_SA_options.child_animation_as_texture)break}if(redraw){c_id=0;for(var i=0,ani;i<SA_child_animation_max;i++)if(ani=SA_child_animation[i],ani){var child=document.getElementById("Ichild_animation"+i),cw,cwSL;if(!child)continue;else if(cw=child.contentWindow,cwSL=cw.SL,!cwSL)continue;var _SL=jThree("import").contents().find("#j3_childAnimationCanvas"+c_id)[0];_SL._canvas_ready=!0,_SL.width=MMD_SA_options.child_animation_width,_SL.height=MMD_SA_options.child_animation_height;var context=_SL.getContext("2d");context.globalCompositeOperation="copy",context.globalAlpha=MMD_SA_options.child_animation_opacity;try{context.drawImage(cwSL._canvas_for_copy||cwSL,0,0,_SL.width,_SL.height),jThree("#ChildAnimation"+c_id+"TXR").three(0).needsUpdate=!0}catch(M){DEBUG_show(M.description)}if(++c_id>=MMD_SA_options.child_animation_as_texture)break}}}THREE.MMD.updateMotion(delta),jThree.MMD._onLoop&&(THREE.MMD.motionLoop?jThree.MMD.onLoop&&jThree.MMD.onLoop():(THREE.MMD.pauseMotion(),jThree.update(arguments.callee,!1),jThree.MMD.complete&&jThree.MMD.complete()),jThree.MMD._onLoop=!1)},play:function(d){d!==void 0&&(this.loop=d),THREE.MMD.playMotion(d),jThree.update(jThree.MMD._animate)},pause:function(){THREE.MMD.pauseMotion(),jThree.update(jThree.MMD._animate,!1)},reset:function(){THREE.MMD.resetMotion(),jThree.update(jThree.MMD._animate,!1)},setup:function(d){return jThree.extend(jThree.MMD,d),this},sync:function(d,_){jThree.MMD._delay=_||0,jQuery(d).on("play",jThree.MMD.play).on("pause ended",jThree.MMD.pause).on("timeupdate",function(){jThree.MMD.seek(this.currentTime+jThree.MMD._delay)})},_edgeScale:1,onLoop:null,onStop:null,_camera:!0,get cameraMotion(){return this._camera},set cameraMotion(d){this._camera=d,THREE.MMD.getCameraMotion().forEach(function(_){_[d?"play":"pause"]()})},get edgeScale(){return this._edgeScale},set edgeScale(d){this._edgeScale=d,THREE.MMD.getModels().forEach(function(_){_.mesh.material.materials.forEach(function(u,M){var g=_.pmx.materials[M];0!=(16&g.drawFlags)&&(u.mmdEdgeThick=g.edgeSize*d)})})},_shadowDark:0.7,get shadowDark(){return this._shadowDark},set shadowDark(d){this._shadowDark=d,THREE.MMD.getModels().forEach(function(_){_.mesh.material.materials.forEach(function(u,M){var g=_.pmx.materials[M];0!=(8&g.drawFlags)&&(u.mmdShadowDark=d)})})},_duration:0,get duration(){return this._duration},set duration(d){this._duration=d,THREE.MMD.adjustMotionDuration()},get groundLevel(){return jThree.MMD._ground.getY()},set groundLevel(d){jThree.MMD._ground.setY(d)},toon:["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAABlBMVEX////Nzc1XNMFjAAAAD0lEQVQI12OgNvgPBFQkAPcnP8G6A9XkAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAABlBMVEX////14eF2pXIGAAAAD0lEQVQI12OgNvgPBFQkAPcnP8G6A9XkAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAABlBMVEX///+ampo+MvaSAAAAD0lEQVQI12OgNvgPBFQkAPcnP8G6A9XkAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAABlBMVEX////47+sAKyXFAAAAD0lEQVQI12OgNvgPBFQkAPcnP8G6A9XkAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEX/////5t3/6N7/7eX/+fb/9PD//Pv/8Op5dFmOAAAAQklEQVQoz2MYBRQDtjQYgAq4gEAIiEiBCIYiAEjYjaEcBIrLoSA0lMEYDTAooQEGRQgtqAgTEEQD5AgoYQggAFgOAHEkIrrgwCawAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAflBMVEX/7WHDrAPErQT/7mT/7mn66Fj86VvizTLJswz/8of/8Hf/73L+7F7NtxLLtQ7/7mb///z//ez//OL/+9vs2ELk0Db//vX/+L7/723o1DzRvBjFrgX/+sz/+Lr/9qzw3Uj/+tL/97b/9Jf/85D/9Z//8X//6DHFrgb/+MD/5AUNrqVlAAAAwklEQVQ4y+XO226DMAwAUG/OutmhgyQQkgYYl162///BmaoV7UPFc9XzYlu2bMNrQrhS16hyRMxVCLlSgWrNmpkPvP8lDogKutb4Qbvajc5b6xpr92071qbvTMNMPfjCdzgVoulJkx2oNW4wtulqYl8YoIkVaq1lOcB8Sy4hjk4SDHTQd+8tcLokR1jxByuO8CKybDP7uLE5y84AyrKMsaqqz4VUMUZp/AjYbcW3+FrM5VbsBJxSen8kpXSCtxVPMfAPmVcPlflaGvEAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAC0lEQVQI12MY5AAAAKAAAfgHMzoAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAC0lEQVQI12MY5AAAAKAAAfgHMzoAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAC0lEQVQI12MY5AAAAKAAAfgHMzoAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAC0lEQVQI12MY5AAAAKAAAfgHMzoAAAAASUVORK5CYII="]},jThree.fn.MMD=jThree.fn.mmd=function(d,_){if("string"==typeof d){if("seek"===d){var u=this.three();u.forEach(function(A){if(A.__mmd)A.__mmd.seekMotion(_);else if(A instanceof THREE.Light){var S=THREE.MMD.getLightMotion();S&&S.seek(_)}}),THREE.MMD.getCameraMotion().forEach(function(A){-1!==u.indexOf(A.persepectiveCamera)&&A.seek(_)})}else if("motion"===d){var M=this.three();THREE.MMD.getCameraMotion().forEach(function(A){-1!==M.indexOf(A.persepectiveCamera)&&A[_?"play":"pause"]()})}}else if("object"==typeof d){var g=this;$.each(d,function(A,S){g.MMD(A,S)})}return this},function(){function d(){oe.splice(this.__mmd,1)[0].dispose()}var Z=1/60,_,u,M,g,A,S,D,E,P,T,C,I,U,F,V,O,B,H,N,G,W,K,X,Q,Y,J,ee;_=function(ie,ne){var se=new XMLHttpRequestZIP;se.onload=function(){ne(se),se=null},se.open("GET",ie,!0),se.responseType="arraybuffer",se.send()},u=function(){this.count=0,this.callback=null},u.prototype.add=function(ie){ie&&(this.callback=ie,this.count=0),this.count++},u.prototype.del=function(){this.count--,0===this.count&&this.callback&&(this.callback(),this.callback=null)},M=function(ie,ne){this.dv=new DataView(ie),this.offset=0,this.littleEndian=ne},M.prototype.readInt8=function(){var ie=this.offset;return this.offset+=1,this.dv.getInt8(ie)},M.prototype.readUint8=function(){var ie=this.offset;return this.offset+=1,this.dv.getUint8(ie)},M.prototype.readInt16=function(){var ie=this.offset;return this.offset+=2,this.dv.getInt16(ie,this.littleEndian)},M.prototype.readUint16=function(){var ie=this.offset;return this.offset+=2,this.dv.getUint16(ie,this.littleEndian)},M.prototype.readInt32=function(){var ie=this.offset;return this.offset+=4,this.dv.getInt32(ie,this.littleEndian)},M.prototype.readUint32=function(){var ie=this.offset;return this.offset+=4,this.dv.getUint32(ie,this.littleEndian)},M.prototype.readFloat32=function(){var ie=this.offset;return this.offset+=4,this.dv.getFloat32(ie,this.littleEndian)},M.prototype.readBytes=function(ie){var ne=this.offset;return this.offset+=ie,new Uint8Array(this.dv.buffer).subarray(ne,this.offset)},A=function(ie){return ie[2]*=-1,ie},S=function(ie,ne){var se;A(ie),A(ne),se=ie[2],ie[2]=ne[2],ne[2]=se},D=function(ie){return ie[0]*=-1,ie[1]*=-1,ie},E=function(ie,ne){var se;D(ie),D(ne),se=ie[0],ie[0]=ne[0],ne[0]=se,se=ie[1],ie[1]=ne[1],ne[1]=se},g={MAGIC:"IllegalMagicException",DATA:"IllegalDataException"},function(){var ie,ne,se,de,_e,le,me,pe,ce,fe,ue,he,Me,ge,ye,xe,Ae,ve,be,Se,De,ke,Ee;ie=function(we){if(M.call(this,we,!0),542657872!==this.readUint32())throw g.MAGIC;if(this.version=this.readFloat32(),2!==this.version)throw g.DATA;if(8!==this.readUint8())throw g.DATA;this.encode=this.readUint8(),this.additionalUvCount=this.readUint8(),this.vertexIndexSize=this.readUint8(),this.textureIndexSize=this.readUint8(),this.materialIndexSize=this.readUint8(),this.boneIndexSize=this.readUint8(),this.morphIndexSize=this.readUint8(),this.rigidIndexSize=this.readUint8()},ie.prototype=Object.create(M.prototype),ie.prototype.constructor=ie,ie.prototype.readText=function(){var we=this.readInt32(),Pe,Te;if(0===we)return"";if(Pe=[],0===this.encode)for(we/=2;0<we--;)Pe.push(this.readUint16());else for(;0<we;)Te=this.readUint8(),224==(240&Te)?(Te&=15,Te=Te<<6|63&this.readUint8(),Te=Te<<6|63&this.readUint8(),we-=3):192==(224&Te)?(Te&=31,Te=Te<<6|63&this.readUint8(),we-=2):we--,Pe.push(Te);return String.fromCharCode.apply(void 0,Pe)},ie.prototype.readIndex=function(we,Pe){var Te;if(1===we)Te=Pe?this.readUint8():this.readInt8();else if(2===we)Te=Pe?this.readUint16():this.readInt16();else if(4===we)Te=this.readInt32();else throw g.DATA;return Te},ie.prototype.readVertexIndex=function(){return this.readIndex(this.vertexIndexSize,!0)},ie.prototype.readTextureIndex=function(){return this.readIndex(this.textureIndexSize)},ie.prototype.readMaterialIndex=function(){return this.readIndex(this.materialIndexSize)},ie.prototype.readBoneIndex=function(){return this.readIndex(this.boneIndexSize)},ie.prototype.readMorphIndex=function(){return this.readIndex(this.morphIndexSize)},ie.prototype.readRigidIndex=function(){return this.readIndex(this.rigidIndexSize)},ie.prototype.readVector=function(we){for(var Pe=[];0<we--;)Pe.push(this.readFloat32());return Pe},ne=function(we){this.name=we.readText(),this.nameEn=we.readText(),this.comment=we.readText(),this.commentEn=we.readText()},se=function(we){function Pe(){var Ce=we.readBoneIndex();return 0>Ce&&(Ce=0),Ce}var Te;switch(this.type=we.readUint8(),this.type){case 0:this.bones=[Pe()],this.weights=[1],Se++;break;case 1:this.bones=[Pe(),Pe()],Te=we.readFloat32(),this.weights=[Te,1-Te],De++;break;case 2:this.bones=[Pe(),Pe(),Pe(),Pe()],this.weights=[we.readFloat32(),we.readFloat32(),we.readFloat32(),we.readFloat32()],ke++;break;case 3:this.bones=[Pe(),Pe()],Te=we.readFloat32(),this.weights=[Te,1-Te],this.sdefC=we.readVector(3),this.sdefR0=we.readVector(3),this.sdefR1=we.readVector(3),Ee++;break;default:throw g.DATA;}},de=function(we){var Pe;for(this.pos=A(we.readVector(3)),this.normal=A(we.readVector(3)),this.uv=we.readVector(2),this.additionalUvs=[],Pe=we.additionalUvCount;0<Pe--;)this.additionalUvs.push(we.readVector(4));this.skin=new se(we),this.edgeScale=we.readFloat32()},_e=function(we){this.path=we.readText(/\\/g,"/")},le=function(we){this.name=we.readText(),this.nameEn=we.readText(),this.diffuse=we.readVector(3),this.alpha=we.readFloat32(),this.specular=we.readVector(3),this.power=we.readFloat32(),this.ambient=we.readVector(3),this.drawFlags=we.readUint8(),this.edgeColor=we.readVector(4),this.edgeSize=we.readFloat32(),this.texture=we.readTextureIndex(),this.sphereTexture=we.readTextureIndex(),this.sphereMode=we.readUint8(),this.sharedToon=we.readUint8(),this.toonTexture=0===this.sharedToon?we.readTextureIndex():we.readUint8(),this.memo=we.readText(),this.indexCount=we.readInt32()},me=function(we){this.bone=we.readBoneIndex(),1===we.readUint8()&&(this.limits=[we.readVector(3),we.readVector(3)],E(this.limits[0],this.limits[1]))},pe=function(we){var Pe;for(this.effector=we.readBoneIndex(),this.iteration=we.readInt32(),this.control=we.readFloat32(),this.links=[],Pe=we.readInt32();0<Pe--;)this.links.push(new me(we))},ce=function(we){this.name=we.readText(),this.nameEn=we.readText(),this.origin=A(we.readVector(3)),this.parent=we.readBoneIndex(),this.deformHierachy=we.readInt32(),this.flags=we.readUint16(),0==(1&this.flags)?we.readVector(3):we.readBoneIndex(),0!=(768&this.flags)&&(this.additionalTransform=[we.readBoneIndex(),we.readFloat32()]),0!=(1024&this.flags)&&we.readVector(3),0!=(2048&this.flags)&&(we.readVector(3),we.readVector(3)),0!=(4096&this.flags)&&(self.MMD_SA&&!1!==MMD_SA.use_afterPhysics&&(MMD_SA.use_afterPhysics=!0),this.afterPhysics=!0),0!=(8192&this.flags)&&(this.externalDeform=we.readInt32()),0!=(32&this.flags)&&(this.IK=new pe(we))},fe=function(we){this.target=we.readVertexIndex(),this.offset=A(we.readVector(3))},ue=function(we){this.target=we.readVertexIndex(),this.uv=we.readVector(4)},he=function(we){this.target=we.readBoneIndex(),this.pos=we.readVector(3),this.rot=we.readVector(4),(this.pos[0]||this.pos[1]||this.pos[2])&&(this.pos_v3=new THREE.Vector3(this.pos[0],this.pos[1],-this.pos[2])),(this.rot[0]||this.rot[1]||this.rot[2])&&(this.rot_q=new THREE.Quaternion(this.rot[0],this.rot[1],this.rot[2],this.rot[3]),this.rot_q=this.rot_q.setFromEuler(MMD_SA.TEMP_v3.setEulerFromQuaternion(this.rot_q).multiply(MMD_SA._v3a.set(-1,-1,1)),"YXZ"))},Me=function(we){this.target=we.readMaterialIndex(),this.operator=we.readUint8(),this.diffuse=we.readVector(3),this.alpha=we.readFloat32(),this.specular=we.readVector(3),this.power=we.readFloat32(),this.ambient=we.readVector(3),this.edgeColor=we.readVector(4),this.edgeSize=we.readFloat32(),this.texture=we.readVector(4),this.sphereTexture=we.readVector(4),this.toonTexture=we.readVector(4)},ge=function(we){this.target=we.readMorphIndex(),this.weight=we.readFloat32()},ye=function(we,Pe){var Te;if(this.name=we.readText(),self.MMD_SA){var Ce=Pe.morph_translate;Ce&&Ce[this.name]&&(this.name=Ce[this.name])}for(this.nameEn=we.readText(),this.panel=we.readUint8(),this.type=we.readUint8(),this.items=[],Te=we.readInt32();0<Te--;)if(0===this.type)this.items.push(new ge(we));else if(1===this.type)this.items.push(new fe(we));else if(2===this.type)this.items.push(new he(we));else if(3<=this.type&&7>=this.type)this.items.push(new ue(we));else if(8===this.type)this.items.push(new Me(we));else throw g.DATA},xe=function(we){if(this.type=we.readUint8(),0===this.type)this.index=we.readBoneIndex();else if(1===this.type)this.index=we.readMorphIndex();else throw g.DATA},Ae=function(we){var Pe;for(this.name=we.readText(),this.nameEn=we.readText(),this.special=we.readUint8(),this.items=[],Pe=we.readInt32();0<Pe--;)this.items.push(new xe(we))},ve=function(we){this.name=we.readText(),this.nameEn=we.readText(),this.bone=we.readBoneIndex(),this.group=we.readUint8(),this.mask=we.readUint16(),this.shape=we.readUint8(),this.size=we.readVector(3),this.pos=A(we.readVector(3)),this.rot=D(we.readVector(3)),this.mass=we.readFloat32(),this.posDamping=we.readFloat32(),this.rotDamping=we.readFloat32(),this.restitution=we.readFloat32(),this.friction=we.readFloat32(),this.type=we.readUint8()},be=function(we){this.name=we.readText(),this.nameEn=we.readText(),this.type=we.readUint8(),this.rigidA=we.readRigidIndex(),this.rigidB=we.readRigidIndex(),this.pos=A(we.readVector(3)),this.rot=D(we.readVector(3)),this.posLower=we.readVector(3),this.posUpper=we.readVector(3),S(this.posLower,this.posUpper),this.rotLower=we.readVector(3),this.rotUpper=we.readVector(3),E(this.rotLower,this.rotUpper),this.posSpring=we.readVector(3),this.rotSpring=we.readVector(3)},P=function(){},P.prototype.parse=function(we){var Pe,Te,Ce,Ie=this,Ue,Le;if(self.MMD_SA){var ze=decodeURIComponent(this.url_raw.replace(/^.+[\/\\]/,""));if(Ue=MMD_SA_options.model_para_obj_by_filename[ze],this._model_index=Ue._model_index,/\#clone(\d+)\.pmx$/.test(ze)){Le=!0;var Fe=ze.replace(/\#clone(\d+)\.pmx$/,".pmx"),Re=MMD_SA_options.model_para_obj_by_filename[Fe],Ve=Re._clone_parent.pmx,Oe=Object.assign({},this);Object.assign(this,Ve,Oe),this.rigids=this.rigids.map(function(Ke){return Object.assign({},Ke)}),this.rigid_index_by_bone=Ve.rigid_index_by_bone}else Pe=new ie(we),Ue._clone_parent={pmx:this}}if(!Le){for(this.vertices=[],this.indices=[],this.textures=[],this.materials=[],this.bones=[],this.morphs=[],this.frames=[],this.rigids=[],this.joints=[],Se=De=ke=Ee=0,this.info=new ne(Pe),Te=Pe.readInt32();0<Te--;)this.vertices.push(new de(Pe));for(Te=Pe.readInt32();0<Te--;)this.indices.push(Pe.readVertexIndex());for(Te=Pe.readInt32();0<Te--;)this.textures.push(new _e(Pe));for(Te=Pe.readInt32();0<Te--;)this.materials.push(new le(Pe));for(Te=Pe.readInt32();0<Te--;)this.bones.push(new ce(Pe));for(Te=Pe.readInt32();0<Te--;)this.morphs.push(new ye(Pe,Ue));for(Te=Pe.readInt32();0<Te--;)this.frames.push(new Ae(Pe));for(Te=Pe.readInt32();0<Te--;)this.rigids.push(new ve(Pe));for(Te=Pe.readInt32();0<Te--;)this.joints.push(new be(Pe));Ue&&Ue.physics_disabled&&(this.rigids=[],this.joints=[],console.log("Physics OFF: model-"+this._model_index)),Ce=this.bones,this.rigids.forEach(function(Ke){var Xe;0<=Ke.bone&&(Xe=Ce[Ke.bone].origin,Ke.ofs=[Ke.pos[0]-Xe[0],Ke.pos[1]-Xe[1],Ke.pos[2]-Xe[2]])}),this.rigids.forEach(function(Ke,Xe){Ke._index=Xe}),this.rigid_index_by_bone={},this.rigids.forEach(function(Ke,Xe){Ie.rigid_index_by_bone[Ke.bone]=Xe})}if(self.MMD_SA&&Ue.morph_default&&!Ue.morph_default._is_empty)for(var Be in Ue.morph_default)for(var je=0,He=this.morphs.length,Ne;je<He;je++)if(Ne=this.morphs[je],Be==Ne.name){var Ge={};if(0==Ne.type){if(Ne.items.forEach(function(Ke){2==Ie.morphs[Ke.target].type&&Ie.morphs[Ke.target].items.forEach(function(Xe){Ge[Ie.bones[Xe.target].name]=!0})}),!Ge.length)continue;}else if(2==Ne.type)Ne.items.forEach(function(Ke){Ge[Ie.bones[Ke.target].name]=!0});else continue;for(var We in Ge)Ue.skin_default||(Ue.skin_default={}),Ue.skin_default._is_empty=null,Ue.skin_default[We]||(Ue.skin_default[We]={pos:{x:0,y:0,z:0}});break}},P.prototype.createMesh=function(we,Pe){var Te,Ce,Ie,Ue,Le,ze,Fe,Re,Ve,Oe;if(!this.vertices)return void console.error("not parsed");Te=this,void 0===we.shadowDark&&(we.shadowDark=0.3),void 0===we.edgeScale&&(we.edgeScale=1),void 0===we.textureAlias&&(we.textureAlias={});var Be,je;if(self.MMD_SA){Be=MMD_SA_options.model_para_obj_all[this._model_index];var He=decodeURIComponent(this.url_raw.replace(/^.+[\/\\]/,""));if(/\#clone(\d+)\.pmx$/.test(He)){je=!0;var Ne=He.replace(/\#clone(\d+)\.pmx$/,".pmx"),Ge=MMD_SA_options.model_para_obj_by_filename[Ne];return Ce=Ge._clone_parent.geo,Ie=Ge._clone_parent.materials,this.morphs_index_by_name=Ce.morphs_index_by_name,void Pe(new THREE.SkinnedMesh(Ce,new THREE.MeshFaceMaterial(Ie)))}}Ce=new THREE.Geometry,Ie=[],je||(Be._clone_parent.geo=Ce,Be._clone_parent.materials=Ie),Ue=new u,Ue.add(function(){Pe(new THREE.SkinnedMesh(Ce,new THREE.MeshFaceMaterial(Ie)))}),ze=function(Ye){return new THREE.Vector3(Ye[0],Ye[1],Ye[2])},Fe=function(Ye){return new THREE.Vector2(Ye[0],Ye[1])},Re=function(Ye){var Je=new THREE.Color;return Je.r=Ye[0],Je.g=Ye[1],Je.b=Ye[2],Je},Oe={};var We=function(Ye,Je){if(!MMD_SA.use_webgl2&&Je){var Ze=Je._uv_bbox,$e=Ze.max.x-Ze.min.x,et=Ze.max.y-Ze.min.y;if(!(1>=$e&&1>=et)){var tt=Ye.image,ot,rt;if(tt.width>tt.height?(ot=1,rt=tt.width/tt.height):(ot=tt.height/tt.width,rt=1),!($e<1.1*ot&&et<1.1*rt)){var tt=Ye.image,it=tt.width,nt=tt.height;if(0!=(it&it-1)||0!=(nt&nt-1)){var st=Math.min(Math.pow(2,Math.round(Math.log2(tt.width))),2048),lt=Math.min(Math.pow(2,Math.round(Math.log2(tt.height))),2048),pt=Ye.image=document.createElement("canvas");pt.width=st,pt.height=lt,pt.getContext("2d").drawImage(tt,0,0,st,lt),console.log(Je.name),console.log([st,lt])}}}}};Ve=function(Ye,Je,Ze){var $e,et,tt,ot;for(et in $e=Ye.split(".").pop().toLowerCase(),we.textureAlias)if(et==$e){$e=we.textureAlias[et],Ye=Ye.slice(0,-et.length)+$e;break}if(Oe.hasOwnProperty(Ye))return Oe[Ye];if(ot=function(){Ue.del(),Je&&Je()},Ue.add(),"dds"===$e){var rt=self.MMD_SA&&MMD_SA_options.flip_DDS&&!/^data:image/.test(Ye)?Ye.replace(/[^\/\\]+$/,"flipV/$&"):Ye;tt=THREE.ImageUtils.loadCompressedTexture(/^data:image/.test(Ye)?rt:toFileProtocol(Te.texturePath+rt),void 0,function(nt){nt.hasTransparency=nt.format!==THREE.RGB_S3TC_DXT1_Format,nt.minFilter=nt.magFilter=THREE.LinearFilter,Ue.del()},ot)}else{var it=/^toon\d\d\.bmp$/.test(Ye)?System.Gadget.path+"\\MMD.js\\data\\":Te.texturePath;tt=THREE.ImageUtils.loadTexture(/^data:image/.test(Ye)?Ye:toFileProtocol(it+Ye),void 0,function(){return function(st){We(st,Ze),Ue.del()}}(),ot)}return tt.flipY=!1,tt.wrapS=tt.wrapT=THREE.RepeatWrapping,Oe[Ye]=tt,tt},this.vertices.forEach(function(Ye){var Je;switch(Ce.vertices.push(ze(Ye.pos)),Je=Ye.skin,Je.type){case 0:Ce.skinWeights.push(new THREE.Vector4(Je.weights[0],0,0,0)),Ce.skinIndices.push(new THREE.Vector4(Je.bones[0],0,0,0));break;case 1:case 3:Ce.skinWeights.push(new THREE.Vector4(Je.weights[0],Je.weights[1],0,0)),Ce.skinIndices.push(new THREE.Vector4(Je.bones[0],Je.bones[1],0,0));break;case 2:Ce.skinWeights.push(new THREE.Vector4(Je.weights[0],Je.weights[1],Je.weights[2],Je.weights[3])),Ce.skinIndices.push(new THREE.Vector4(Je.bones[0],Je.bones[1],Je.bones[2],Je.bones[3]));}}),Ce.MMDmorphs=this.morphs;var Ke=Ce.morphs_index_by_name=this.morphs_index_by_name={},Xe=Ce.morphs_weight_by_name=this.morphs_weight_by_name={};if(this.morphs.forEach(function(Ye,Je){Ke[Ye.name]=Je,Xe[Ye.name]=0}),Le=0,Ce.faceVertexUvs[0]=[],this.materials.forEach(function(Ye,Je){var Ze,$e,et,tt,ot,rt,it,nt,st;Ze=new V,Ze.name=Ye.name,Ze._xray_pass=self.MMD_SA&&MMD_SA_options._use_xray&&Be.material_xray_pass&&Be.material_xray_pass.test(Ze.name);var lt=[];Ze._xray_pass&&lt.push({name:"xray_center",value:{type:"v3",value:new THREE.Vector3(999,999,999)}},{name:"xray_radius",value:{type:"f",value:Math.sqrt(3*(MMD_SA_options._xray_radius*MMD_SA_options._xray_radius))}},{name:"xray_opacity",value:{type:"f",value:MMD_SA_options._xray_opacity}});var pt;if(pt=MMD_SA_options.MME.self_overlay,lt.push({name:"self_overlay_opacity",value:{type:"f",value:1}},{name:"self_overlay_brightness",value:{type:"f",value:1}},{name:"self_overlay_color_adjust",value:{type:"v3",value:new THREE.Vector3(1.5,1,1)}}),pt=MMD_SA_options.MME.HDR,lt.push({name:"HDR_opacity",value:{type:"f",value:1}}),pt=MMD_SA_options.MME.serious_shader,lt.push({name:"serious_shader_shadow_opacity",value:{type:"f",value:1}},{name:"OverBright",value:{type:"f",value:1}},{name:"ShadowDarkness",value:{type:"f",value:1}},{name:"ToonPower",value:{type:"f",value:1}},{name:"EyeLightPower",value:{type:"f",value:1}},{name:"serious_shader_mode",value:{type:"i",value:1}}),MMD_SA.MME_shader_inline_switch_mode&&["self_overlay","HDR","serious_shader"].forEach(function(ht){pt=MMD_SA_options.MME[ht],lt.push({name:ht.toUpperCase(),value:{type:"i",value:1}})}),lt.length){var ct={};lt.forEach(function(ht){ct[ht.name]=ht.value}),Ze.uniforms=THREE.UniformsUtils.merge([Ze.uniforms,ct])}var ft=MMD_SA_options.model_para_obj_all[Te._model_index].material_para||{};ft=ft[Ze.name]||ft._default_||{},Ze.lights=!0,Ze.skinning=!0,Ze.ambient=Re(ft.ambient||Ye.ambient),Ze.color=Re(ft.diffuse||Ye.diffuse),Ze.specular=Re(ft.specular||Ye.specular),Ze.shininess=Ye.power,Ze.opacity=Ye.alpha,Ze.transparent=null==ft.transparent||ft.transparent,0!=(1&Ye.drawFlags)&&(Ze.side=THREE.DoubleSide),0!=(2&Ye.drawFlags)&&!1!=ft.castShadow?(Ze.castShadow=!0,Ze.shadowMapCullFace=THREE.CullFaceNone):Ze.castShadow=!1,0!=(8&Ye.drawFlags)&&(Ze.mmdShadowDark=we.shadowDark),0!=(16&Ye.drawFlags)&&(Ze.mmdEdgeThick=Ye.edgeSize*we.edgeScale*(null==Be.edgeScale?1:Be.edgeScale),Ze.mmdEdgeColor=new THREE.Vector4(Ye.edgeColor[0],Ye.edgeColor[1],Ye.edgeColor[2],Ye.edgeColor[3])),0<=Ye.texture&&(Ze.map=Ve(Te.textures[Ye.texture].path,function(){var ht=Ze;return function(){var Mt=ht.map.image=document.createElement("canvas");Mt.width=Mt.height=2;var gt=Mt.getContext("2d");gt.fillStyle="white",gt.fillRect(0,0,2,2),ht.map.needsUpdate=!0}}(),Ze)),tt=null,0===Ye.sharedToon?0<=Ye.toonTexture&&(tt=Te.textures[Ye.toonTexture].path):tt=jThree.MMD.toon[Ye.toonTexture],tt&&(Ze.mmdToonMap=Ve(tt,function(){var ht=Ze;return function(){var Mt=ht.mmdToonMap.image=document.createElement("canvas");Mt.width=Mt.height=2;var gt=Mt.getContext("2d");gt.fillStyle="white",gt.fillRect(0,0,2,2),ht.mmdToonMap.needsUpdate=!0}}())),0<Ye.sphereMode&&0<=Ye.sphereTexture&&(Ze.mmdSphereMode=Ye.sphereMode,Ze.mmdSphereMap=Ve(Te.textures[Ye.sphereTexture].path,function(){var ht=Ze;return function(){var Mt=ht.mmdSphereMap.image=document.createElement("canvas");Mt.width=Mt.height=2;var gt=Mt.getContext("2d");gt.fillStyle="black",gt.fillRect(0,0,2,2),ht.mmdSphereMap.needsUpdate=!0}}())),Ze.setup(),Ie.push(Ze);var ut=Ze._uv_bbox={min:{x:0,y:0},max:{x:1,y:1},face_ini:Le/3,face_end:(Le+Ye.indexCount)/3};for(et=Ye.indexCount/3,Ce._face_index_by_vertex||(Ce._face_index_by_vertex=[]);et--;)tt=Te.indices[Le+2],ot=Te.indices[Le+1],rt=Te.indices[Le],$e=new THREE.Face3(tt,ot,rt),$e.materialIndex=Je,it=Te.vertices[tt],nt=Te.vertices[ot],st=Te.vertices[rt],[tt,ot,rt].forEach(function(ht,Mt){Ce._face_index_by_vertex[ht]||(Ce._face_index_by_vertex[ht]=[]),Ce._face_index_by_vertex[ht].push([Ce.faces.length,Mt])}),Ce.faceVertexUvs[0].push(0<=Ye.texture?[Fe(it.uv),Fe(nt.uv),Fe(st.uv)]:void 0),0<=Ye.texture&&!MMD_SA.use_webgl2&&Ce.faceVertexUvs[0][Le/3].forEach(function(ht){ht.x<ut.min.x?ut.min.x=ht.x:ht.x>ut.max.x&&(ut.max.x=ht.x),ht.y<ut.min.y?ut.min.y=ht.y:ht.y>ut.max.y&&(ut.max.y=ht.y)}),$e.vertexNormals=[ze(it.normal),ze(nt.normal),ze(st.normal)],Ce.faces.push($e),Le+=3}),Ce.MMDIKs=[],Ce.bones=[],this.bones.forEach(function(Ye,Je){var Ze,$e;Ye.IK&&(Ye.IK.target=Je,Ce.MMDIKs.push(Ye.IK)),0<=Ye.parent?(Ze=Te.bones[Ye.parent].origin,Ze=[Ye.origin[0]-Ze[0],Ye.origin[1]-Ze[1],Ye.origin[2]-Ze[2]]):Ze=Ye.origin,$e={},$e.parent=Ye.parent,$e.name=Ye.name,$e.pos=Ze,$e.rotq=[0,0,0,1],Ce.bones.push($e)}),Ce.MMDjoints=this.joints,Ce.computeBoundingBox(),Ce.boundingSphere=Ce.boundingBox.getBoundingSphere(),self.MMD_SA&&MMD_SA_options.Dungeon&&!Be.is_object&&!Be.use_default_boundingBox){var qe=Ce.boundingBox.size(),Qe=0.5*(0.5*(qe.x+(qe.z>qe.x?qe.x:qe.z)));Ce.boundingBox.min.x=Ce.boundingBox.min.z=-Qe,Ce.boundingBox.max.x=Ce.boundingBox.max.z=Qe,Ce.boundingSphere=Ce.boundingBox.getBoundingSphere(),Ce.boundingSphere.radius*=0.5}console.log("boundingBox/Sphere-"+Te._model_index,Ce.boundingBox,Ce.boundingSphere),Ue.del()},P.prototype.load=function(we,Pe){var Te=this;this.url_raw=we,this._clone_index=-1,/\#clone(\d+)\.pmx$/.test(we)&&(we=we.replace(/\#clone(\d+)\.pmx$/,".pmx"),this._clone_index=parseInt(RegExp.$1)),_(we,function(Ce){Te.url=we,Te.texturePath=/\//.test(we)?we.slice(0,we.lastIndexOf("/")+1):"",Te.parse(Ce.response),Pe(Te)})}}(),U=function(ie){var ne,se;for(se in ne={},ie)ie.hasOwnProperty(se)&&(ne[se]=ie[se]);return ne},function(){var ie,ne,se,de,_e,le,me,pe;ie=function(ce){return ce/30},ne=function(ce){ce.sort(function(fe,ue){return fe.time-ue.time})},se=[86,111,99,97,108,111,105,100,32,77,111,116,105,111,110,32,68,97,116,97,32,48,48,48,50],de=function(ce){var fe,ue;for(M.call(this,ce,!0),this.stringMap={},fe=this.readBytes(30),ue=0;ue<se.length;ue++)if(se[ue]!==fe[ue])throw g.MAGIC;this.name=this.readCString(20)},de.prototype=Object.create(M.prototype),de.prototype.constructor=de,de.prototype.readCString=function(ce){var fe,ue,he;for(fe=this.readBytes(ce),ue=0;ue<ce&&0!==fe[ue];ue++);return he=String.fromCharCode.apply(void 0,THREE.MMD.Encoding.SJISToUNICODE(fe.subarray(0,ue))),this.stringMap.hasOwnProperty(he)?he=this.stringMap[he]:this.stringMap[he]=he,he},de.prototype.readVector=function(ce){for(var fe=[];0<ce--;)fe.push(this.readFloat32());return fe},_e=function(ce){this.name=ce.readCString(15),this.time=ie(ce.readUint32()),this.pos=A(ce.readVector(3)),this.rot=D(ce.readVector(4)),this.interp=ce.readBytes(64).subarray(0,16)},le=function(ce){this.name=ce.readCString(15),this.time=ie(ce.readUint32()),this.weight=ce.readFloat32()},me=function(ce){this.time=ie(ce.readUint32()),this.distance=-ce.readFloat32(),this.target=A(ce.readVector(3)),this.rot=D(ce.readVector(3)),this.rot[0]*=-1,this.rot[1]*=-1,this.rot[2]*=-1,this.interp=ce.readBytes(24),this.fov=ce.readUint32(),this.ortho=ce.readInt8()},pe=function(ce){this.time=ie(ce.readUint32()),this.color=ce.readVector(3),this.dir=A(ce.readVector(3))},T=function(){},T.prototype.parse=function(ce){var fe,ue;for(fe=new de(ce),this.timeMax=0,this.boneKeys=[],this.morphKeys=[],this.cameraKeys=[],this.lightKeys=[],ue=fe.readUint32();0<ue--;)this.boneKeys.push(new _e(fe));for(ne(this.boneKeys),ue=this.boneKeys.length,0<ue&&(this.timeMax=Math.max(this.timeMax,this.boneKeys[ue-1].time)),ue=fe.readUint32();0<ue--;)this.morphKeys.push(new le(fe));if(ne(this.morphKeys),ue=this.morphKeys.length,0<ue&&(this.timeMax=Math.max(this.timeMax,this.morphKeys[ue-1].time)),this.boneKeys.length||this.morphKeys.length)return void delete fe.stringMap;for(ue=fe.readUint32();0<ue--;)this.cameraKeys.push(new me(fe));for(ne(this.cameraKeys),ue=this.cameraKeys.length,0<ue&&(this.timeMax=Math.max(this.timeMax,this.cameraKeys[ue-1].time)),ue=fe.readUint32();0<ue--;)this.lightKeys.push(new pe(fe));ne(this.lightKeys),ue=this.lightKeys.length,0<ue&&(this.timeMax=Math.max(this.timeMax,this.lightKeys[ue-1].time)),delete fe.stringMap},T.prototype.load=function(ce,fe){self.MMD_SA&&(MMD_SA.vmd_by_filename[decodeURIComponent(ce.replace(/^.+[\/\\]/,"").replace(/\.vmd$/i,""))]=this);var ue=this;_(ce,function(he){ue.url=ce,ue.parse(he.response),fe(ue)})},T.prototype.generateSkinAnimation=function(ce,fe){var ue=self.MMD_SA&&MMD_SA_options.model_para_obj_all[ce._model_index],he=self.MMD_SA&&MMD_SA_options.motion_para[decodeURIComponent(this.url.replace(/^.+[\/\\]/,"").replace(/\.vmd$/i,""))],Me=he&&he.adjustment_per_model&&(he.adjustment_per_model[ue._filename]||he.adjustment_per_model[ue._filename_cleaned]||he.adjustment_per_model._default_);Me=Me&&Me.skin_default||{};var ge=1<MMD_SA_options.model_para_obj_all.length&&he&&(he.model_index_list||he.model_name_RegExp),ye=this,xe,Ae,ve;return(xe=this.boneKeys,0===xe.length)?null:(Ae=he&&he.duration||this.timeMax,ve=[],ce.bones.forEach(function(be){if(fe&&!fe.test(be.name))return void ve.push({keys:[]});var Se=ue.skin_default[be.name],De=self.MMD_SA&&(Me[be.name]||Se);if(De&&(De.motion_filter&&!De.motion_filter.test(decodeURIComponent(ye.url))||De.model_filter&&!De.model_filter.test(ue._filename))&&(De=null),De){var ke;ge&&"\u5168\u3066\u306E\u89AA"==be.name&&(!Se||De!=Se)&&De.pos_add?(ke=De.pos_add_absolute=De.pos_add,delete De.pos_add):ke=De.pos_add_absolute||Se&&Se.pos_add_absolute,ke&&(De=Object.assign({},De),De.pos_add=De.pos_add?{x:De.pos_add.x+ke.x,y:De.pos_add.y+ke.y,z:De.pos_add.z+ke.z}:ke),De.rot_scale&&"number"==typeof De.rot_scale&&(De.rot_scale={x:De.rot_scale,y:De.rot_scale,z:De.rot_scale})}var Ee,we;Ee=[];var Pe=1<MMD_SA_options.model_para_obj_all.length;if(xe.forEach(function(Ce){if(be.name===Ce.name&&(Pe&&De&&(Ce=Object.assign({},Ce),Ce.rot=Ce.rot.slice(),Ce.pos=Ce.pos.slice()),we=Ce,Ee.push(Ce),De)){if(De.rot_slerp){De.rot_slerp._frame_=Math.round(30*Ce.time);var Ie=MMD_SA.TEMP_q.set(Ce.rot[0],Ce.rot[1],Ce.rot[2],Ce.rot[3]).toAxisAngle();Ce.rot=MMD_SA.TEMP_q.setFromAxisAngle(Ie[0],Ie[1]*De.rot_slerp).toArray()}if(De.rot_axis){De.rot_axis._frame_=Math.round(30*Ce.time);var Ue=new THREE.Vector3,Le;De.rot_axis.x&&(Ue.set(1,0,0),Le=De.rot_axis.x),MMD_SA._q1.set(Ce.rot[0],Ce.rot[1],Ce.rot[2],Ce.rot[3]),Ue.applyQuaternion(MMD_SA._q1),Ce.rot=MMD_SA.TEMP_q.setFromAxisAngle(Ue,Le*Math.PI/180).multiply(MMD_SA._q1).toArray()}if(De.rot_scale&&(De.rot_scale._frame_=Math.round(30*Ce.time),Ce.rot=MMD_SA.TEMP_q.setFromEuler(MMD_SA.TEMP_v3.setEulerFromQuaternion(MMD_SA._q1.set(Ce.rot[0],Ce.rot[1],Ce.rot[2],Ce.rot[3]),"YXZ").multiply(De.rot_scale),"YXZ").toArray()),De.rot_add){De.rot_add._frame_=Math.round(30*Ce.time);var ze=De.rot_add;Ce.rot=MMD_SA.TEMP_q.set(Ce.rot[0],Ce.rot[1],Ce.rot[2],Ce.rot[3]).multiply(MMD_SA._q1.setFromEuler(MMD_SA.TEMP_v3.set(-ze.x,ze.y,-ze.z).multiplyScalar(Math.PI/180),"YXZ")).toArray()}if(De.pos_scale){De.pos_scale._frame_=Math.round(30*Ce.time);var Fe=De.pos_scale;if(Fe.auto_adjust){var Re=THREE.MMD.getModels()[ce._model_index].mesh.bones_by_name;if(Re.){var Ve=ue._ref_length=ue._ref_length||{},Oe=Ve[Ce.name];Oe||(Oe=Ve[Ce.name]=ce.bones[Re.._index].origin[1]-(-1!=Ce.name.indexOf("\u8DB3\uFF29\uFF2B")&&Re.?ce.bones[Re.._index].origin[1]:0)),Ce.pos[1]*=(Oe/Fe.auto_adjust.ref_length-1)*(Fe.auto_adjust.scale||1)+1}}else Ce.pos[0]*=Fe.x,Ce.pos[1]*=Fe.y,Ce.pos[2]*=Fe.z}if(De.pos_add){De.pos_add._frame_=Math.round(30*Ce.time);var Fe=De.pos_add;Ce.pos[0]+=Fe.x,Ce.pos[1]+=Fe.y,Ce.pos[2]+=-Fe.z}}}),self.MMD_SA){if(De&&(De.keys||!Ee.length&&(De.pos||De.rot||De.pos_add||De.rot_add))){var Te=De.keys?De.keys:[{pos:De.pos||De.pos_add,rot:De.rot||De.rot_add,time:De.time,interp:De.interp}];Ee=[],Te.forEach(function(Ce){var Ie=Ce.pos,Ue=Ce.rot;Ee.push({name:be.name,time:Ce.time||0,pos:Ie?[Ie.x,Ie.y,-Ie.z]:[0,0,0],rot:(Ue?MMD_SA.TEMP_q.setFromEuler(MMD_SA.TEMP_v3.set(-Ue.x,Ue.y,-Ue.z).multiplyScalar(Math.PI/180),"YXZ"):MMD_SA.TEMP_q.set(0,0,0,1)).toArray(),interp:new Uint8Array(Ce.interp||[20,20,20,20,20,20,20,20,107,107,107,107,107,107,107,107])})}),we=Ee[Ee.length-1]}De&&De.keys_mod&&De.keys_mod.forEach(function(Ce){var Ie=Ee.find(function(ze){return Math.round(30*ze.time)==Ce.frame});if(Ie){var Ue=Ce.pos,Le=Ce.rot;Ue&&(Ie.pos=[Ue.x,Ue.y,-Ue.z]),Le&&(Ie.rot=MMD_SA.TEMP_q.setFromEuler(MMD_SA.TEMP_v3.set(-Le.x,Le.y,-Le.z).multiplyScalar(Math.PI/180),"YXZ").toArray()),Ce.interp&&(Ie.interp=new Uint8Array(Ce.interp))}}),we&&(1<Ee.length||we.time<Ae)&&/guitar|g_head|g_bridge|f_board|\u8155\uFF29\uFF2B/.test(be.name)&&(ye.use_armIK=!0)}we&&we.time<Ae&&(we=U(we),we.time=Ae,Ee.push(we)),ve.push({keys:Ee})}),{duration:Ae,targets:ve})},T.prototype.generateMorphAnimation=function(ce,fe){var ue=self.MMD_SA&&MMD_SA_options.model_para_obj_all[ce._model_index],he,Me,ge;if(he=this.morphKeys,0===he.length&&(!self.MMD_SA||ue.morph_default._is_empty))return null;Me=this.timeMax,ge=[];var ye=self.MMD_SA&&ue.morph_filter,xe=this,Ae=[],ve=self.MMD_SA&&MMD_SA_options.motion_para[decodeURIComponent(this.url.replace(/^.+[\/\\]/,"").replace(/\.vmd$/i,""))],be=ve&&ve.adjustment_per_model&&(ve.adjustment_per_model[ue._filename]||ve.adjustment_per_model[ue._filename_cleaned]||ve.adjustment_per_model._default_);be=be&&be.morph_default||{},Me=ve&&ve.duration||Me;var Se=[];return MMD_SA_options.auto_blink&&(Se[ce.morphs_index_by_name.]=!0),ce.morphs.forEach(function(De,ke){if(0==De.type&&(!fe||fe.test(De.name))&&(!ye||ye.test(De.name))){var Ee=self.MMD_SA&&(be[De.name]||ue.morph_default[De.name]);Ee&&Ee.motion_filter&&!Ee.motion_filter.test(decodeURIComponent(xe.url))&&(Ee=null);var we;if(Se[ke]||Ee&&(!Ee.weight_scale||Ee.weight||Ee.keys))we=!0;else for(var Pe=0,Te=he.length,Ce;Pe<Te;Pe++)if(Ce=he[Pe],De.name===Ce.name&&0<Ce.weight){we=!0;break}we&&De.items.forEach(function(Ie){Se[Ie.target]=!0})}}),ce.morphs.forEach(function(De,ke){if((!fe||fe.test(De.name))&&(!ye||ye.test(De.name))){var Pe=0,Te=self.MMD_SA&&(be[De.name]||ue.morph_default[De.name]),Ee,we;Ee=[];var Ce=1<MMD_SA_options.model_para_obj_all.length;if(he.forEach(function(Ie){De.name===Ie.name&&(Ce&&(Ie=Object.assign({},Ie)),we=Ie,Ee.push(Ie),Ie.morph_type=De.type,Ie.morph_index=ke,Te&&Te.weight_scale&&(Ie.weight*=Te.weight_scale),Pe=Math.max(Pe,Ie.weight))}),(!Pe||Te&&Te.keys)&&(Ee=[],we=void 0,Te&&(!Te.weight_scale||Te.weight||Te.keys)?(Te.keys?Te.keys.forEach(function(Ie){Ee.push({name:De.name,weight:Ie.weight,time:Ie.time,morph_type:De.type,morph_index:ke})}):Ee.push({name:De.name,weight:0===Te.weight?0:Te.weight||1,time:Te.time||0,morph_type:De.type,morph_index:ke}),we=Ee[Ee.length-1]):Se[ke]&&(Ee.push({name:De.name,weight:0,time:0,morph_type:De.type,morph_index:ke}),we=Ee[Ee.length-1])),!we)return;we.time<Me&&(we=U(we),we.time=Me,Ee.push(we)),1==De.type?ge.push({keys:Ee}):Ae.push({keys:Ee})}}),ge=ge.concat(Ae),0===ge.length,{duration:Me,targets:ge}},T.prototype.generateCameraAnimation=function(){var ce,fe,ue,he;return(ce=this.cameraKeys,0===ce.length)?null:(fe=this.timeMax,ue=[],ce.forEach(function(Me){he=Me,ue.push(Me)}),he&&he.time<fe&&(he=U(he),he.time=fe,ue.push(he)),{duration:fe,keys:ue})},T.prototype.generateLightAnimation=function(){var ce,fe,ue,he;return(ce=this.lightKeys,0===ce.length)?null:(fe=this.timeMax,ue=[],ce.forEach(function(Me){he=Me,ue.push(Me)}),he&&he.time<fe&&(he=U(he),he.time=fe,ue.push(he)),{duration:fe,keys:ue})}}(),F={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)},MMDShadow:{type:"f",value:0},mmdToonMap:{type:"t",value:null},mmdSphereMap:{type:"t",value:null},mmdEdgeThick:{type:"f",value:0},mmdEdgeColor:{type:"v4",value:new THREE.Vector4(0,0,0,1)},mmdShadowDark:{type:"f",value:0}}]),vertexShader:"#define MMD\n#define PHONG\nvarying vec3 vViewPosition;varying vec3 vNormal;\n#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;uniform vec4 offsetRepeat;\n#endif\n#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif\n#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nvarying vec3 vReflect;uniform float refractionRatio;uniform bool useRefract;\n#endif\n#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];uniform float pointLightDistance[ MAX_POINT_LIGHTS ];varying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined(USE_XRAY_PASS)\nvarying vec3 vWorldPosition;\n#endif\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n#ifdef USE_MORPHTARGETS\n#ifndef USE_MORPHNORMALS\nuniform float morphTargetInfluences[ 8 ];\n#else\nuniform float morphTargetInfluences[ 4 ];\n#endif\n#endif\n#ifdef USE_SKINNING\n#ifdef BONE_TEXTURE\nuniform sampler2D boneTexture;mat4 getBoneMatrix( const in float i ) {float j = i * 4.0;float x = mod( j, N_BONE_PIXEL_X );float y = floor( j / N_BONE_PIXEL_X );const float dx = 1.0 / N_BONE_PIXEL_X;const float dy = 1.0 / N_BONE_PIXEL_Y;y = dy * ( y + 0.5 );vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );mat4 bone = mat4( v1, v2, v3, v4 );return bone;}\n#else\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];mat4 getBoneMatrix( const in float i ) {mat4 bone = boneGlobalMatrices[ int(i) ];return bone;}\n#endif\n#endif\n#ifdef USE_SHADOWMAP\nvarying vec3 normal_untransformed;varying vec4 vShadowCoord[ MAX_SHADOWS ];uniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif\n#ifdef MMD\nuniform float mmdEdgeThick;\n#endif\n#ifdef MMD_SPHEREMAP\nvarying vec2 vUvSphere;\n#endif\nvoid main() {\n#ifdef USE_SKINNING\nmat4 skinMatrix;\n#ifdef MMD\nskinMatrix  = skinWeight.x * getBoneMatrix( skinIndex.x );if ( skinWeight.y > 0.0 ) {skinMatrix += skinWeight.y * getBoneMatrix( skinIndex.y );if ( skinWeight.z > 0.0 ) {skinMatrix += skinWeight.z * getBoneMatrix( skinIndex.z );skinMatrix += skinWeight.w * getBoneMatrix( skinIndex.w );}}\n#else\nskinMatrix =skinWeight.x * getBoneMatrix( skinIndex.x ) +skinWeight.y * getBoneMatrix( skinIndex.y );\n#endif\n#endif\nvec3 objectNormal = normal;\n#ifdef USE_MORPHNORMALS\nobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];objectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];objectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];objectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n#ifdef USE_SKINNING\nobjectNormal.xyz = ( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n#ifdef FLIP_SIDED\nobjectNormal = -objectNormal;\n#endif\n#ifdef USE_SHADOWMAP\n  normal_untransformed = normalize(mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal);\n#endif\nvNormal = normalize( normalMatrix * objectNormal );vec3 objectPosition = position;\n#ifdef USE_MORPHTARGETS\nobjectPosition += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];objectPosition += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];objectPosition += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];objectPosition += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n#ifndef USE_MORPHNORMALS\nobjectPosition += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];objectPosition += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];objectPosition += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];objectPosition += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n#endif\n#endif\n#ifdef USE_SKINNING\nobjectPosition.xyz = ( skinMatrix * vec4( objectPosition, 1.0 ) ).xyz;\n#endif\nvec4 mvPosition = modelViewMatrix * vec4( objectPosition, 1.0 );gl_Position = projectionMatrix * mvPosition;\n#ifdef MMD\nif (mmdEdgeThick > 0.0) {\n#ifdef USE_XRAY_PASS\nvWorldPosition = (modelMatrix * vec4( objectPosition, 1.0 )).xyz;\n#endif\nvec2 offset;offset.x = vNormal.x * projectionMatrix[0][0] / projectionMatrix[1][1];offset.y = vNormal.y;gl_Position.xy += offset * gl_Position.w * mmdEdgeThick;return;}\n#endif\nvViewPosition = -mvPosition.xyz;\n#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\nvec4 worldPosition = modelMatrix * vec4( objectPosition, 1.0 );\n#endif\n#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nvec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;worldNormal = normalize( worldNormal );vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );if ( useRefract ) {vReflect = refract( cameraToVertex, worldNormal, refractionRatio );} else {vReflect = reflect( cameraToVertex, worldNormal );}\n#endif\n#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );vec3 lVector = lPosition.xyz - mvPosition.xyz;float lDistance = 1.0;if ( pointLightDistance[ i ] > 0.0 )lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );vPointLight[ i ] = vec4( lVector, lDistance );}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );vec3 lVector = lPosition.xyz - mvPosition.xyz;float lDistance = 1.0;if ( spotLightDistance[ i ] > 0.0 )lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );vSpotLight[ i ] = vec4( lVector, lDistance );}\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined(USE_XRAY_PASS)\nvWorldPosition = worldPosition.xyz;\n#endif\n#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;}\n#endif\n#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif\n#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif\n#ifdef MMD_SPHEREMAP\nvUvSphere = vNormal.xy * 0.5 + 0.5;vUvSphere.y = 1.0 - vUvSphere.y;\n#endif\n#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif\n}",fragmentShader:"#define MMD\nuniform vec3 diffuse;uniform float opacity;uniform vec3 ambient;uniform vec3 emissive;uniform vec3 specular;uniform float shininess;\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\nuniform sampler2D map;\n#endif\n#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;uniform sampler2D lightMap;\n#endif\n#ifdef USE_ENVMAP\nuniform float reflectivity;uniform samplerCube envMap;uniform float flipEnvMap;uniform int combine;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nuniform bool useRefract;uniform float refractionRatio;\n#else\nvarying vec3 vReflect;\n#endif\n#endif\n#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;uniform float fogFar;\n#endif\n#endif\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#else\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined(USE_XRAY_PASS)\nvarying vec3 vWorldPosition;\n#endif\n#ifdef USE_XRAY_PASS\nuniform vec3 xray_center;\nuniform float xray_radius;\nuniform float xray_opacity;\n#endif\n"+MMD_SA.MME_shader("HDR").fvar+MMD_SA.MME_shader("self_overlay").fvar+MMD_SA.MME_shader("serious_shader").fvar+"#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;varying vec3 vNormal;\n#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];uniform vec2 shadowMapSize[ MAX_SHADOWS ];uniform float shadowDarkness[ MAX_SHADOWS ];uniform vec3 shadowBias[ MAX_SHADOWS ];uniform vec3 shadowPara[ MAX_SHADOWS ];varying vec3 normal_untransformed;varying vec4 vShadowCoord[ MAX_SHADOWS ];float unpackDepth( const in vec4 rgba_depth ) {const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );float depth = dot( rgba_depth, bit_shift );return depth;}\n#endif\n#ifdef USE_BUMPMAP\nuniform sampler2D bumpMap;uniform float bumpScale;vec2 dHdxy_fwd() {vec2 dSTdx = dFdx( vUv );vec2 dSTdy = dFdy( vUv );float Hll = bumpScale * texture2D( bumpMap, vUv ).x;float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;return vec2( dBx, dBy );}vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {vec3 vSigmaX = dFdx( surf_pos );vec3 vSigmaY = dFdy( surf_pos );vec3 vN = surf_norm;vec3 R1 = cross( vSigmaY, vN );vec3 R2 = cross( vN, vSigmaX );float fDet = dot( vSigmaX, R1 );vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );return normalize( abs( fDet ) * surf_norm - vGrad );}\n#endif\n#ifdef USE_NORMALMAP\nuniform sampler2D normalMap;uniform vec2 normalScale;vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {vec3 q0 = dFdx( eye_pos.xyz );vec3 q1 = dFdy( eye_pos.xyz );vec2 st0 = dFdx( vUv.st );vec2 st1 = dFdy( vUv.st );vec3 S = normalize(  q0 * st1.t - q1 * st0.t );vec3 T = normalize( -q0 * st1.s + q1 * st0.s );vec3 N = normalize( surf_norm );vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;mapN.xy = normalScale * mapN.xy;mat3 tsn = mat3( S, T, N );return normalize( tsn * mapN );}\n#endif\n#ifdef USE_SPECULARMAP\nuniform sampler2D specularMap;\n#endif\n#ifdef MMD\nuniform float MMDShadow;uniform float mmdEdgeThick;uniform vec4 mmdEdgeColor;uniform float mmdShadowDark;\n#endif\n#ifdef MMD_TOONMAP\nuniform sampler2D mmdToonMap;\n#endif\n#ifdef MMD_SPHEREMAP\nvarying vec2 vUvSphere;uniform sampler2D mmdSphereMap;\n#endif\n"+THREE.ShaderChunk.AT_depth_render_mode_pars_fragment+"\n"+["vec3 YCbCrtoRGB(float Y, float Cb, float Cr) {","    float R = Y - 0.000982 * Cb + 1.401845 * Cr;","    float G = Y - 0.345117 * Cb - 0.714291 * Cr;","    float B = Y + 1.771019 * Cb - 0.000154 * Cr;","    return vec3( R, G, B );","}"].join("\n")+"\nvoid main() {\n"+THREE.ShaderChunk.AT_depth_render_mode_fragment+"\n#ifdef MMD\nif (mmdEdgeThick > 0.0) {gl_FragColor = mmdEdgeColor;} else {\n#endif\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );vec4 texelColor;\n#ifdef USE_MAP\ntexelColor = texture2D( map, vUv );\n#ifdef GAMMA_INPUT\ntexelColor.xyz *= texelColor.xyz;\n#endif\ngl_FragColor = gl_FragColor * texelColor;\n#endif\n#ifdef MMD_SPHEREMAP\ntexelColor = texture2D( mmdSphereMap, vUvSphere );\n#ifdef GAMMA_INPUT\ntexelColor.xyz *= texelColor.xyz;\n#endif\n#if MMD_SPHEREMAP == 1\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor.xyz = gl_FragColor.xyz + texelColor.xyz;\n#endif\n#endif\nvec4 ShadowColor;\nfloat Y, Cb, Cr;\nvec3 shadowColor = vec3( 1.0 );\n#ifdef MAX_DIR_LIGHTS\nfloat comp_list[MAX_DIR_LIGHTS];\n#endif\n"+MMD_SA.MME_shader_branch("SERIOUS_SHADER",!0)+"ShadowColor = vec4(gl_FragColor.rgb, 1.0);\n"+MMD_SA.MME_shader_branch("SERIOUS_SHADER",!1)+"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif\nfloat specularStrength;\n#ifdef USE_SPECULARMAP\nvec4 texelSpecular = texture2D( specularMap, vUv );specularStrength = texelSpecular.r;\n#else\nspecularStrength = 1.0;\n#endif\nvec3 normal = vNormal;vec3 viewPosition = normalize( vViewPosition );\n#ifdef DOUBLE_SIDED\nnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#ifdef USE_NORMALMAP\nnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\nnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\nvec3 totalDiffuse = vec3( 0.0 );vec3 totalSpecular = vec3( 0.0 );\n#ifdef MMD\nvec3 totalToon = vec3( 0.0 );\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );vec3 lVector = lPosition.xyz + vViewPosition.xyz;float lDistance = 1.0;if ( pointLightDistance[ i ] > 0.0 )lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );lVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );float lDistance = vPointLight[ i ].w;\n#endif\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n#endif\n#ifdef MMD\n#ifdef MMD_TOONMAP\ntotalToon += (1.0 - totalToon) * texture2D( mmdToonMap, vec2( 0.0, 1.0 - ( 0.5 * dotProduct + 0.5 ) ) ).xyz;\n#else\ntotalToon += (1.0 - totalToon) * vec3( 1.0 );\n#endif\ntotalDiffuse += (1.0 - totalDiffuse) * diffuse * pointLightColor[ i ] * lDistance;\n#else\ntotalDiffuse += (1.0 - totalDiffuse) * diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\n#endif\nvec3 pointHalfVector = normalize( lVector + viewPosition );float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );float pointSpecularWeight = specularStrength * pow( pointDotNormalHalf, shininess );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );totalSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n#else\ntotalSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );vec3 lVector = lPosition.xyz + vViewPosition.xyz;float lDistance = 1.0;if ( spotLightDistance[ i ] > 0.0 )lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );lVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vSpotLight[ i ].xyz );float lDistance = vSpotLight[ i ].w;\n#endif\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );if ( spotEffect > spotLightAngleCos[ i ] ) {spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );float dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n#endif\n#ifdef MMD\n#ifdef MMD_TOONMAP\ntotalToon += (1.0 - totalToon) * texture2D( mmdToonMap, vec2( 0.0, 1.0 - ( 0.5 * dotProduct + 0.5 ) ) ).xyz;\n#else\ntotalToon += (1.0 - totalToon) * vec3( 1.0 );\n#endif\ntotalDiffuse += (1.0 - totalDiffuse) * diffuse * spotLightColor[ i ] * lDistance * spotEffect;\n#else\ntotalDiffuse += (1.0 - totalDiffuse) * diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\n#endif\nvec3 spotHalfVector = normalize( lVector + viewPosition );float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );float spotSpecularWeight = specularStrength * pow( spotDotNormalHalf, shininess );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );totalSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n#else\ntotalSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;\n#endif\n}}\n#endif\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );vec3 dirVector = normalize( lDirection.xyz );float dotProduct = dot( normal, dirVector );\n"+MMD_SA.MME_shader_branch("SERIOUS_SHADER",!0)+"comp_list[i] = dotProduct;\n"+MMD_SA.MME_shader_branch("SERIOUS_SHADER",!1)+"#ifdef WRAP_AROUND\nfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n#endif\n#ifdef MMD\n#ifdef MMD_TOONMAP\ntotalToon += (1.0 - totalToon) * texture2D( mmdToonMap, vec2( 0.0, 1.0 - ( 0.5 * dotProduct + 0.5 ) ) ).xyz;\n#else\ntotalToon += (1.0 - totalToon) * vec3( 1.0 );\n#endif\ntotalDiffuse += (1.0 - totalDiffuse) * diffuse * directionalLightColor[ i ];\n#else\ntotalDiffuse += (1.0 - totalDiffuse) * diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n#endif\nvec3 dirHalfVector = normalize( dirVector + viewPosition );float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );float dirSpecularWeight = specularStrength * pow( dirDotNormalHalf, shininess );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );totalSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ntotalSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );vec3 lVector = normalize( lDirection.xyz );float dotProduct = dot( normal, lVector );float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n#ifdef MMD\n#ifdef MMD_TOONMAP\ntotalToon += (1.0 - totalToon) * texture2D( mmdToonMap, vec2( 0.0, 1.0 - hemiDiffuseWeight ) ).xyz;\n#else\ntotalToon += (1.0 - totalToon) * vec3( 1.0 );\n#endif\n#endif\nvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );totalDiffuse += (1.0 - totalDiffuse) * diffuse * hemiColor;vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;float hemiSpecularWeightSky = specularStrength * pow( hemiDotNormalHalfSky, shininess );vec3 lVectorGround = -lVector;vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;float hemiSpecularWeightGround = specularStrength * pow( hemiDotNormalHalfGround, shininess );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat dotProductGround = dot( normal, lVectorGround );float specularNormalization = ( shininess + 2.0001 ) / 8.0;vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );totalSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n#else\ntotalSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;\n#endif\n}\n#endif\n#ifdef MMD\ntotalSpecular = max( totalSpecular, 0.0 );\n#endif\n#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif\n#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif\n#ifdef USE_ENVMAP\nvec3 reflectVec;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );if ( useRefract ) {reflectVec = refract( cameraToVertex, normal, refractionRatio );} else {reflectVec = reflect( cameraToVertex, normal );}\n#else\nreflectVec = vReflect;\n#endif\n#ifdef DOUBLE_SIDED\nfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n#else\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n#endif\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );} else if ( combine == 2 ) {gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;} else {gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );}\n#endif\n#ifdef USE_SHADOWMAP\n#ifdef MMD\nif (mmdShadowDark > 0.0) {\n#endif\n#ifdef SHADOWMAP_DEBUG\nvec3 frustumColors[3];frustumColors[0] = vec3( 1.0, 0.5, 0.0 );frustumColors[1] = vec3( 0.0, 1.0, 0.8 );frustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n#endif\n#ifdef SHADOWMAP_CASCADE\nint inFrustumCount = 0;\n#endif\nfloat fDepth;vec3 SP;for( int i = 0; i < MAX_SHADOWS; i ++ ) {vec3 SP = shadowPara[i];vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );bool inFrustum = all( inFrustumVec );\n#ifdef SHADOWMAP_CASCADE\ninFrustumCount += int( inFrustum );bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n#else\nbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n#endif\nbool frustumTest = all( frustumTestVec );if ( frustumTest ) {shadowCoord.z += shadowBias[ i ].x * clamp(abs(tan(acos(clamp(dot(directionalLightDirection[ int(SP.y) ], normal_untransformed), -1., 1.)))), shadowBias[ i ].y, shadowBias[ i ].z);\n#ifdef MMD\nfloat darkness = mmdShadowDark;\n#else\nfloat darkness = shadowDarkness[ i ];\n#endif\n#if defined( SHADOWMAP_TYPE_PCF )\nfloat shadow = 0.0;const float shadowDelta = 1.0 / 9.0;float xPixelOffset = 1.0 / shadowMapSize[ i ].x;float yPixelOffset = 1.0 / shadowMapSize[ i ].y;float dx0 = -1.25 * xPixelOffset;float dy0 = -1.25 * yPixelOffset;float dx1 = 1.25 * xPixelOffset;float dy1 = 1.25 * yPixelOffset;fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );if ( fDepth < shadowCoord.z ) shadow += shadowDelta;fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );if ( fDepth < shadowCoord.z ) shadow += shadowDelta;fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );if ( fDepth < shadowCoord.z ) shadow += shadowDelta;fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );if ( fDepth < shadowCoord.z ) shadow += shadowDelta;fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );if ( fDepth < shadowCoord.z ) shadow += shadowDelta;fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );if ( fDepth < shadowCoord.z ) shadow += shadowDelta;fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );if ( fDepth < shadowCoord.z ) shadow += shadowDelta;fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );if ( fDepth < shadowCoord.z ) shadow += shadowDelta;fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );if ( fDepth < shadowCoord.z ) shadow += shadowDelta;shadowColor = shadowColor * vec3( ( 1.0 - darkness * shadow ) );\n#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\nfloat shadow = 0.0;float xPixelOffset = 1.0 / shadowMapSize[ i ].x;float yPixelOffset = 1.0 / shadowMapSize[ i ].y;float dx0 = -1.0 * xPixelOffset;float dy0 = -1.0 * yPixelOffset;float dx1 = 1.0 * xPixelOffset;float dy1 = 1.0 * yPixelOffset;mat3 shadowKernel;mat3 depthKernel;depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );vec3 shadowZ = vec3( shadowCoord.z );shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));shadowKernel[0] *= vec3(0.25);shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));shadowKernel[1] *= vec3(0.25);shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));shadowKernel[2] *= vec3(0.25);vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );vec4 shadowValues;shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );shadow = dot( shadowValues, vec4( 1.0 ) );shadowColor = shadowColor * vec3( ( 1.0 - darkness * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );float fDepth = unpackDepth( rgbaDepth );if ( fDepth < shadowCoord.z )shadowColor = shadowColor * vec3( 1.0 - darkness );\n#endif\n}\n#ifdef SHADOWMAP_DEBUG\n#ifdef SHADOWMAP_CASCADE\nif ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n#else\nif ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n#endif\n#endif\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\n"+MMD_SA.MME_shader_branch("SERIOUS_SHADER",!0,!0)+"Y  =  0.298912 * gl_FragColor.r + 0.586611 * gl_FragColor.g + 0.114478 * gl_FragColor.b;\nCb = -0.168736 * gl_FragColor.r - 0.331264 * gl_FragColor.g + 0.5      * gl_FragColor.b;\nCr =  0.5      * gl_FragColor.r - 0.418688 * gl_FragColor.g - 0.081312 * gl_FragColor.b;\nshadowColor.x = mix(1.0-MMDShadow,1.0, shadowColor.x);\ngl_FragColor.rgb = mix(clamp(YCbCrtoRGB(Y*shadowColor.x, Cb, Cr), vec3(0.),vec3(1.)), gl_FragColor.xyz*shadowColor.x, 0.5);\n"+MMD_SA.MME_shader_branch("SERIOUS_SHADER",!1)+"#ifdef MMD\n}\n#endif\n#endif\n"+MMD_SA.MME_shader("serious_shader").fshader+MMD_SA.MME_shader_branch("SERIOUS_SHADER",!0,!0)+"#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif\n#ifdef MMD_TOONMAP\ngl_FragColor.xyz *= totalToon;\n#endif\n"+MMD_SA.MME_shader_branch("SERIOUS_SHADER",!1)+"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif\n#ifdef MMD\n}\n#endif\n#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif\n#ifdef USE_XRAY_PASS\nfloat xray_distance = distance(vWorldPosition, xray_center);\nif (xray_distance < xray_radius) {\n  float xray_ratio = (1.0 - xray_distance/xray_radius) * 5.0;\n  gl_FragColor.a *= mix(1.0, xray_opacity, ((xray_ratio>1.0)?1.0:xray_ratio));\n}\n#endif\n"+MMD_SA.MME_shader("HDR").fshader+MMD_SA.MME_shader("self_overlay").fshader+"}"},V=function(ie){THREE.ShaderMaterial.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.specular=new THREE.Color(1118481),this.shininess=30,this.metal=!1,this.perPixel=!1,this.wrapAround=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new THREE.Vector2(1,1),this.specularMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=0.98,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.castShadow=!0,this.shadowMapCullFace=THREE.CullFaceFront,this.mmdToonMap=null,this.mmdSphereMap=null,this.mmdSphereMode=0,this.mmdEdgeColor=new THREE.Vector4(0,0,0,1),this.mmdEdgeThick=0,this.mmdShadowDark=0,this.passes=1,this.preRenderPass=null,this.postRenderPass=null,this.uniforms=THREE.UniformsUtils.clone(F.uniforms),this.vertexShader=F.vertexShader,this.fragmentShader=F.fragmentShader,this.setValues(ie)},V.prototype=Object.create(THREE.ShaderMaterial.prototype),V.prototype.constructor=V,self.MMD_SA&&(V.prototype._passes=1,Object.defineProperty(V.prototype,"passes",{get:function(){return MMD_SA._mirror_rendering_?1:this._passes},set:function(ie){this._passes=ie}})),V.prototype._castShadow=!0,Object.defineProperty(V.prototype,"castShadow",{get:function(){return!!this.opacity&&this._castShadow},set:function(ie){this._castShadow=ie}}),V.prototype.setup=function(){0>=this.opacity?(this.passes=-1,this.preRenderPass=this.postRenderPass=null):0<this.mmdEdgeThick?(this.passes=2,this.preRenderPass=function(ie,ne){var se,de,_e;return se=ie.context,0===ne?(this.side===THREE.DoubleSide?se.disable(se.CULL_FACE):(se.enable(se.CULL_FACE),se.cullFace(se.BACK)),de=0,_e=!1):(se.enable(se.CULL_FACE),se.cullFace(se.FRONT),de=2*this.mmdEdgeThick/ie.getViewportHeight(),_e=0>=de),se.uniform1f(this.program.uniforms.mmdEdgeThick,de),_e},this.postRenderPass=function(ie){var se;se=ie.context,se.enable(se.CULL_FACE),se.cullFace(se.BACK)}):(this.passes=1,this.preRenderPass=function(ie){var se;se=ie.context,this.side===THREE.DoubleSide?se.disable(se.CULL_FACE):(se.enable(se.CULL_FACE),se.cullFace(se.BACK))},this.postRenderPass=function(ie){var se;se=ie.context,se.enable(se.CULL_FACE),se.cullFace(se.BACK)}),this.mmdToonMap?this.defines.MMD_TOONMAP="":delete this.defines.MMD_TOONMAP,this.mmdSphereMap?this.defines.MMD_SPHEREMAP=this.mmdSphereMode.toString():delete this.defines.MMD_SPHEREMAP,this._xray_pass&&(this.defines.USE_XRAY_PASS=""),this.needsUpdate=!0},V.prototype.refreshUniforms=function(ie){var ne=this,se=this.mesh,de=this._original_value,_e=this.opacity,ue=se._material_morph[this.name],le,me,pe,ce,fe;if(ue){de||(de=this._original_value={},de.opacity=this.opacity,de.mmdEdgeColor=this.mmdEdgeColor,de.diffuse=[this.color.r,this.color.g,this.color.b],de.specular=[this.specular,this.specular,this.specular],de.ambient=[this.ambient.r,this.ambient.g,this.ambient.b]),le=de.opacity,me=de.mmdEdgeColor.w,pe=de.diffuse.slice(0),ce=de.specular.slice(0),fe=de.ambient.slice(0);var he=Object.keys(ue).sort(function(we,Pe){return we-Pe});he.forEach(function(we){var Pe=ue[we],Te=Pe.weight;if(Te){MMD_SA._mirror_rendering_||(Pe.weight=0);var Ce=Pe.morph_obj,Ie;if(0==Ce.operator)Ie=Te*Ce.alpha+(1-Te),le*=Ie,me*=Ie;else{if(Ie=Te*Ce.alpha,le+=Ie,me+=Ie,Ce.diffuse.find(function(Le){return!!Le})){for(var Ue=0;3>Ue;Ue++)pe[Ue]+=Ce.diffuse[Ue]*Te;ne.color.setRGB(pe[0],pe[1],pe[2])}if(Ce.specular.find(function(Le){return!!Le})){for(var Ue=0;3>Ue;Ue++)ce[Ue]+=Ce.specular[Ue]*Te;ne.specular.setRGB(ce[0],ce[1],ce[2])}if(Ce.ambient.find(function(Le){return!!Le})){for(var Ue=0;3>Ue;Ue++)fe[Ue]+=Ce.ambient[Ue]*Te;ne.ambient.setRGB(fe[0],fe[1],fe[2])}}1<le?le=1:0>le&&(le=0),1<me?me=1:0>me&&(me=0)}}),this.opacity=le,this.mmdEdgeColor.w=me}else de?(le=this.opacity=de.opacity,this.mmdEdgeColor.w=de.mmdEdgeColor.w,this.color.setRGB(de.diffuse[0],de.diffuse[1],de.diffuse[2]),this.specular.setRGB(de.specular[0],de.specular[1],de.specular[2]),this.ambient.setRGB(de.ambient[0],de.ambient[1],de.ambient[2])):le=_e;0==_e?0<le&&this.setup():0==le&&this.setup();var Me=this.uniforms;Me.opacity.value=this.opacity,ie.gammaInput?Me.diffuse.value.copyGammaToLinear(this.color):Me.diffuse.value=this.color,Me.map.value=this.map,Me.lightMap.value=this.lightMap,Me.specularMap.value=this.specularMap,this.bumpMap&&(Me.bumpMap.value=this.bumpMap,Me.bumpScale.value=this.bumpScale),this.normalMap&&(Me.normalMap.value=this.normalMap,Me.normalScale.value.copy(this.normalScale));var ge;if(this.map?ge=this.map:this.specularMap?ge=this.specularMap:this.normalMap?ge=this.normalMap:this.bumpMap&&(ge=this.bumpMap),void 0!=ge){var ye=ge.offset,xe=ge.repeat;Me.offsetRepeat.value.set(ye.x,ye.y,xe.x,xe.y)}if(Me.envMap.value=this.envMap,Me.flipEnvMap.value=this.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,Me.reflectivity.value=ie.gammaInput?this.reflectivity:this.reflectivity,Me.refractionRatio.value=this.refractionRatio,Me.combine.value=this.combine,Me.useRefract.value=this.envMap&&this.envMap.mapping instanceof THREE.CubeRefractionMapping,Me.shininess.value=this.shininess,ie.gammaInput?(Me.ambient.value.copyGammaToLinear(this.ambient),Me.emissive.value.copyGammaToLinear(this.emissive),Me.specular.value.copyGammaToLinear(this.specular)):(Me.ambient.value=this.ambient,Me.emissive.value=this.emissive,Me.specular.value=this.specular),this.wrapAround&&Me.wrapRGB.value.copy(this.wrapRGB),this.mmdToonMap&&(Me.mmdToonMap.value=this.mmdToonMap),this.mmdSphereMap&&(Me.mmdSphereMap.value=this.mmdSphereMap),self.MMD_SA){var Ae=se._model_index,ve=THREE.MMD.getModels()[Ae];if(!this._MME_uniforms_updated_||0==Ae&&MMD_SA._MME_uniforms_updated_&&MMD_SA._MME_uniforms_updated_>this._MME_uniforms_updated_){var be=0==Ae?MMD_SA_options.MME:MMD_SA_options.model_para_obj_all[Ae].MME,Se;Se=be.self_overlay,Me.self_overlay_opacity.value=Se.opacity||0.5,Me.self_overlay_brightness.value=null==Se.brightness?0.5:Se.brightness;var De=Se.color_adjust||[1.5,1,1];Me.self_overlay_color_adjust.value.set(De[0],De[1],De[2]),Se=be.HDR,Me.HDR_opacity.value=Se.opacity||0.5,Se=be.serious_shader,Me.serious_shader_shadow_opacity.value=(Se.shadow_opacity||0.5)*Math.min(1,(Se.material&&Se.material[this.name]&&Se.material[this.name].shadow_opacity_scale||1)*(MMD_SA_options.use_shadowMap?1+MMD_SA_options.shadow_darkness:1)),Me.OverBright.value=(Se.OverBright||("AdultShaderS2"==Se.type?1.15:1.2))+MMD_SA_options.SeriousShader_OverBright_adjust,Me.ShadowDarkness.value=Se.ShadowDarkness||("SeriousShader"==Se.type?0.6:1),Me.ToonPower.value=Se.ToonPower||("SeriousShader"==Se.type?1.5:"AdultShaderS2"==Se.type?1.1:1),Me.EyeLightPower.value=Se.EyeLightPower||("AdultShaderS2"==Se.type?0.7:2),Me.serious_shader_mode.value="AdultShaderS"==Se.type?2:"AdultShaderS2"==Se.type?1:0,MMD_SA.MME_shader_inline_switch_mode&&["self_overlay","HDR","serious_shader"].forEach(function(we){Se=be[we],Me[we.toUpperCase()].value=null==Se.enabled||Se.enabled?1:0}),this._MME_uniforms_updated_=Date.now()}else 0==Ae&&MMD_SA._MME_uniforms_updated_&&(DEBUG_show("(MMD shader updated)",2),MMD_SA._MME_uniforms_updated_=0);if(this._xray_pass){var ke=MMD_SA_options.mesh_obj_by_id.XrayMESH;if(ke&&ke.visible){Me.xray_center.value.copy(ke._obj.position);var Ee=(Date.now()-ke._start_time)/1e3;Me.xray_opacity.value=MMD_SA_options._xray_opacity+(1-MMD_SA_options._xray_opacity)*(1-(1<Ee?1:Ee))}else Me.xray_center.value.set(999,999,999)}}Me.MMDShadow.value=MMD_SA_options.shadow_darkness,Me.mmdEdgeColor.value=this.mmdEdgeColor,Me.mmdShadowDark.value=this.mmdShadowDark},function(){var ie,ne,se,de,_e,le,me,pe,ce;ie=new THREE.Vector3,ne=new THREE.Vector3,se=new THREE.Vector3,de=new THREE.Vector3,_e=new THREE.Quaternion,le=new THREE.Matrix4,me=function(fe){var ue=fe.matrix;return fe.visible&&(fe.visible=!1,ue.makeRotationFromQuaternion(fe.quaternion),ue.setPosition(fe.position)),ue},pe=function(fe,ue,he){for(he.copy(ue.position);ue.parent!==fe;)ue=ue.parent,he.applyMatrix4(me(ue))},ce=function(fe,ue,he){for(he.copy(me(ue));ue.parent!==fe;)ue=ue.parent,he.multiplyMatrices(me(ue),he);he.getInverse(he)},O=function(fe){this.mesh=fe},O.prototype.update=function(fe){var ue,he,Me,ge,ye,xe,Ae,ve,be,Se,De,ke,Ee,we,Pe,Te;ue=this.mesh,Me=ue.bones,he=ue.geometry.MMDIKs;var Ce,Ie,Ue,Le,ze=[],Fe=0,Re=he.length;for(self.MMD_SA&&(Ce=THREE.MMD.getModels()[ue._model_index],Ie=MMD_SA_options.model_para_obj_all[ue._model_index],Ue=Ce.skin&&MMD_SA.motion[Ce.skin._motion_index],Le=Ue&&Ue.para_SA,fe&&(Fe=fe.ini,Re=fe.end||Fe)),ge=Fe,ye=Re;ge<=ye;ge++){if(xe=ue._IK_and_AddTrans[ge].pmxBone.IK,ke=Me[xe.target],Ue){if(Le.IK_disabled&&Le.IK_disabled.test(ke.name))continue;if(/\u8155\uFF29\uFF2B/.test(ke.name)){var Ve=MMD_SA.vmd_by_filename[Ue.filename];if(Ve&&!Ve.use_armIK&&!Le.use_armIK)continue}}for(Ee=Me[xe.effector],pe(ue,ke,ie),Se=xe.iteration,De=xe.links.length,be=0;be<De;be++)Ae=xe.links[be],we=Me[Ae.bone],-1!=we.name.indexOf("\u8DB3\u9996")&&we.quaternion.slerp(MMD_SA.TEMP_q.set(0,0,0,1),0.5),ze[be]=Ae.limits&&Ie&&Ie.IK_link_inverted&&Ie.IK_link_inverted.test(we.name)?-1:1;loop:for(ve=0;ve<Se;ve++){var Oe=!1;for(be=0;be<De;be++){if(Ae=xe.links[be],we=Me[Ae.bone],we.omitIK)break loop;(ce(ue,we,le),pe(ue,Ee,se),se.applyProjection(le).normalize(),ne.copy(ie),ne.applyProjection(le).normalize(),Pe=ne.dot(se),1<Pe&&(Pe=1),Pe=Math.acos(Pe),!(1e-5>Pe))&&(Pe>xe.control&&(Pe=xe.control),_e.setFromAxisAngle(de.crossVectors(se,ne).normalize(),Pe),we.quaternion.multiplyQuaternions(we.quaternion,_e),Ae.limits&&(Te=we.quaternion.w,we.quaternion.set(ze[be]*Math.sqrt(1-Te*Te),0,0,Te)),we.visible=!0,Oe=!0)}if(!Oe)break}}Me.forEach(function(Be){Be.visible=!0})}}(),function(){var ie=self.MMD_SA&&MMD_SA.ammo_proxy,ne,se,de,_e,le,me,pe,ce,fe,ue,he,Me,ge,ye,xe,Ae;window.Ammo&&(jThree._ammo_async_init_=[],jThree._ammo_async_init_.push(function(){ne=new Ammo.btDefaultCollisionConfiguration,se=new Ammo.btCollisionDispatcher(ne),de=new Ammo.btSequentialImpulseConstraintSolver,_e=new Ammo.btDbvtBroadphase,Q=new Ammo.btDiscreteDynamicsWorld(se,_e,de,ne),le=new Ammo.btTransform,me=new Ammo.btVector3,pe=new Ammo.btQuaternion,Y=function(ve,be,Se){return me.setValue(ve,be,Se),me},J=function(ve,be,Se,De){return pe.setValue(ve,be,Se,De),pe},self.MMD_SA&&ie&&ie.update_worker("TEST")})),ce=new THREE.Vector3,fe=new THREE.Vector3,ue=new THREE.Vector3,he=new THREE.Quaternion,Me=new THREE.Quaternion,ge=new THREE.Quaternion,ye=new THREE.Matrix4,xe=new THREE.Matrix4,Ae=function(ve,be){return he.copy(be.q),ye.makeRotationFromQuaternion(he),ye.getInverse(ye),ce.set(ve.pos[0]-be.pos[0],ve.pos[1]-be.pos[1],ve.pos[2]-be.pos[2]),ce.applyProjection(ye)},B=function(ve){this.create(ve)},B.prototype.create=function(ve){function be(we,Pe,Te){return"OR"===Te?self.MMD_SA&&ie?(we=we._v_index&&(Ammo_local?"L.":"")+we._v_index||we,Pe=Pe._v_index&&(Ammo_local?"L.":"")+Pe._v_index||Pe,ie.use_text_command?("string"==typeof we?"v['"+we+"']":we)+"|"+("string"==typeof Pe?"v['"+Pe+"']":Pe):{L:we,R:Pe,op:"OR"}):we|Pe:void 0}var Se=ve.MMDrigids,De=ve.geometry.MMDjoints;this.mesh=ve;var ke=MMD_SA_options.model_para_obj_all[ve._model_index],Ee={};De.forEach(function(we){var Pe=Se[we.rigidA],Te=Se[we.rigidB];0==Pe.type&&0<Te.type&&(Ee[we.rigidA]=!0)}),Se.forEach(function(we,Pe){var Te,Ce,Ie,Ue,Le,ze,Fe;we.q=new THREE.Quaternion,we.q.setFromEuler(new THREE.Vector3(we.rot[0],we.rot[1],we.rot[2]),"YXZ");var Re=ke.rigid_default&&(ke.rigid_default[we.name]||ke.rigid_default._all_)||{};null!=Re.type&&(-1==Re.type&&(we.type=0,we.size=[0,0,0]),we.type=Re.type);var Ve=self.MMD_SA&&ke.rigid_filter;switch(Ve&&!Ve.test(we.name)&&(we.type=0),0<=we.bone?(Te=ve.bones[we.bone],0<we.type&&(Te.omitIK=!0)):2===we.type&&(we.type=1),we.shape){case 0:Ce=new Ammo.btSphereShape(we.size[0]);break;case 1:Ce=new Ammo.btBoxShape(Y(we.size[0],we.size[1],we.size[2]));break;case 2:Ce=new Ammo.btCapsuleShape(we.size[0],we.size[1]);break;default:return;}Ie=0===we.type?0:we.mass,Ue=new Ammo.btVector3(0,0,0),Ce.calculateLocalInertia(Ie,Ue),le.setIdentity(),le.setOrigin(Y(we.pos[0]+ve.position.x,we.pos[1]+ve.position.y,we.pos[2]+ve.position.z)),le.setRotation(J(we.q.x,we.q.y,we.q.z,we.q.w)),Le=new Ammo.btDefaultMotionState(le),ze=new Ammo.btRigidBodyConstructionInfo(Ie,Le,Ce,Ue),ze.set_m_friction(we.friction),ze.set_m_restitution(we.restitution),Fe=new Ammo.btRigidBody(ze),0===we.type&&(Fe.setCollisionFlags(be(Fe.getCollisionFlags(),2,"OR")),!Ee[Pe]&&Fe.setActivationState(4)),Fe.setDamping(we.posDamping*(Re.posDamping_scale||1),we.rotDamping*(Re.rotDamping_scale||1)),Fe.setSleepingThresholds(0,0),Q.addRigidBody(Fe,1<<we.group,we.mask),Ammo.destroy(ze),Ammo.destroy(Ue),we.body=Fe}),De.forEach(function(we){var ze=Se[we.rigidA],Fe=Se[we.rigidB],Re=new Ammo.btTransform,Ve=new Ammo.btTransform,Pe,Te,Ce,Ie,Ue,Le;0!==ze.type&&2===Fe.type&&(0<ze.bone&&(Ue=ve.bones[ze.bone]),0<Fe.bone&&(Le=ve.bones[Fe.bone]),Ue&&Le&&Le.parent===Ue&&(Fe.type=1)),Re.setIdentity(),Pe=Ae(we,ze),Re.setOrigin(Y(Pe.x,Pe.y,Pe.z)),Te=J(-ze.q.x,-ze.q.y,-ze.q.z,ze.q.w),Re.setRotation(Te),Ve.setIdentity(),Pe=Ae(we,Fe),Ve.setOrigin(Y(Pe.x,Pe.y,Pe.z)),Te=J(-Fe.q.x,-Fe.q.y,-Fe.q.z,Fe.q.w),Ve.setRotation(Te);var Oe=ke.joint_default&&ke.joint_default[we.name]||{};for(Ce=new Ammo.btGeneric6DofSpringConstraint(ze.body,Fe.body,Re,Ve,!0),Ce.setLinearLowerLimit(Y(we.posLower[0],we.posLower[1],we.posLower[2])),Ce.setLinearUpperLimit(Y(we.posUpper[0],we.posUpper[1],we.posUpper[2])),Ce.setAngularLowerLimit(Y(we.rotLower[0]*(Oe.rotLower_scale&&Oe.rotLower_scale[0]||1),we.rotLower[1]*(Oe.rotLower_scale&&Oe.rotLower_scale[1]||1),we.rotLower[2]*(Oe.rotLower_scale&&Oe.rotLower_scale[2]||1))),Ce.setAngularUpperLimit(Y(we.rotUpper[0]*(Oe.rotUpper_scale&&Oe.rotUpper_scale[0]||1),we.rotUpper[1]*(Oe.rotUpper_scale&&Oe.rotUpper_scale[1]||1),we.rotUpper[2]*(Oe.rotUpper_scale&&Oe.rotUpper_scale[2]||1))),Ie=0;3>Ie;Ie++)0<we.posSpring[Ie]&&(Ce.enableSpring(Ie,!0),Ce.setStiffness(Ie,we.posSpring[Ie]*(Oe.posSpring_scale&&Oe.posSpring_scale[Ie]||1))),0<we.rotSpring[Ie]&&(Ce.enableSpring(Ie+3,!0),Ce.setStiffness(Ie+3,we.rotSpring[Ie]));for(Ie=0;6>Ie;Ie++)(!self.MMD_SA||Ce.setParam)&&Ce.setParam(2,ee.STOP_ERP,Ie);Q.addConstraint(Ce,!0),Ammo.destroy(Re),Ammo.destroy(Ve),we.constraint=Ce}),self.MMD_SA&&ie&&ie.update_worker()},B.prototype.dispose=function(){this.mesh.geometry.MMDjoints.forEach(function(ve){Q.removeConstraint(ve.constraint),Ammo.destroy(ve.constraint),delete ve.constraint}),this.mesh.MMDrigids.forEach(function(ve){Q.removeRigidBody(ve.body),Ammo.destroy(ve.body),delete ve.body}),self.MMD_SA&&ie&&ie.update_worker()},B.prototype.preSimulate=function(){var ve;ve=this.mesh,Me.setFromRotationMatrix(ve.matrixWorld);var be=!1;ie&&(ie.cache_by_model.set_enabled(ve._model_index,!ve._reset_rigid_body_physics_),be=ie.use_optimized_command&&!ie.use_text_command,be&&ie.add_optimized_command({o:2,_btransform_v_index:le._v_index,_bv_v_index:me._v_index,_bq_v_index:pe._v_index})),ve.MMDrigids.forEach(function(Se){var De,ke;(0<ve._reset_rigid_body_physics_||Se._reset_physics_&&(!ie||!ie.data_id_locked.stepSimulation)||0===Se.type)&&0<=Se.bone&&(Se._reset_physics_=null,De=ve.bones[Se.bone].skinMatrix,ce.set(Se.ofs[0],Se.ofs[1],Se.ofs[2]),ce.applyMatrix4(De),ce.applyMatrix4(ve.matrixWorld),he.setFromRotationMatrix(De),he.multiplyQuaternions(he,Se.q),he.multiplyQuaternions(Me,he),ke=Se.body,be?ie.add_optimized_command({o:3,body_v_index:ke._v_index,_v:ce,_q:he}):(le.setOrigin(Y(ce.x,ce.y,ce.z)),le.setRotation(J(he.x,he.y,he.z,he.w)),ke.setCenterOfMassTransform(le),ke.getMotionState().setWorldTransform(le)))})},B.prototype.postSimulate=function(){function ve(Ke){for(var Xe=0,qe=Ke.children.length,Qe;Xe<qe;Xe++)Qe=Ke.children[Xe],Qe instanceof THREE.Bone&&(Qe.pmxBone.afterPhysics?Qe.update(Ke.skinMatrix,!1):ve(Qe))}var be,Se,De;be=this.mesh;var ke=be._model_index,Ee=self.MMD_SA&&ie&&!Ammo_local,Ce=!1,we,Pe,Te;Ee&&(Ce=ie.use_optimized_command&&!ie.use_text_command,we=Ee&&ie.cache_by_model.list[ke],Pe=Ee&&ie.cache_by_model_temp.list[ke],Te=Ee&&ie.cache_by_model.get_enabled(ke),ie.cache_by_model_temp.set_matrixWorld(ke,be.matrixWorld),ie.cache_by_model_temp.set_skin(ke,be.bones,Te)),xe.getInverse(be.matrixWorld),ge.setFromRotationMatrix(xe);var Le={},Ie,Ue,ze,Fe,Re,Ve,Oe,Be;if(self.MMD_SA){if(ze=THREE.MMD.getModels()[ke],Fe=MMD_SA_options.model_para_obj_all[ke],Re=ze.skin&&MMD_SA.motion[ze.skin._motion_index].filename||"",Ve=MMD_SA_options.motion_para[Re]||{},Oe=Ve.adjustment_per_model&&(Ve.adjustment_per_model[Fe._filename]||Ve.adjustment_per_model[Fe._filename_cleaned]||Ve.adjustment_per_model._default_)||Ve,Be=Fe.skin_filter_by_motion&&(Fe.skin_filter_by_motion.find(function(Ke){return Ke.motion.test(Re)})||{}).skin||Oe.skin_filter||Ve.skin_filter,Ie=Fe.bone_constraint,Ie&&Ie.motion_filter&&!Ie.motion_filter.test(Re)&&(Ie=null),Ie&&Ie.group_skip)for(var je in Ie.group_skip)Ie.group_skip[je].motion_match.test(Re)&&(Le[je]=!0);0<be._reset_rigid_body_physics_&&(Ue=!0,be._reset_rigid_body_physics_--)}if(be.MMDrigids.forEach(function(Ke){var Xe,qe,Qe,Ye,Je;if(0!==Ke.type&&0<=Ke.bone&&(Xe=be.bones[Ke.bone].skinMatrix,Ke._skin_parent&&be.bones[Ke.bone].update(Ke._skin_parent.skinMatrix,!1)),-1!=Ke.bone){var Ze=be.bones[Ke.bone].name,$e=!Ue&&Be&&!Be.test(Ze);if(Ee&&Ue&&2>=be._reset_rigid_body_physics_&&($e=!0),Ue||$e)Ee&&$e&&0!==Ke.type&&0<=Ke.bone&&(Ce&&!ie.locked&&(ie._locked=!0),qe=Ke.body.getCenterOfMassTransform(),Ye=qe.getRotation(),Ye.x(),Ye.y(),Ye.z(),Ye.w(),Ce&&!ie.locked&&(ie._locked=!1,ie.add_optimized_command({o:5,body_v_index:Ke.body._v_index})),1===Ke.type?(Ce&&!ie.locked&&(ie._locked=!0),Qe=qe.getOrigin(),Qe.x(),Qe.y(),Qe.z(),Ce&&!ie.locked&&(ie._locked=!1,ie.add_optimized_command({o:6,body_v_index:Ke.body._v_index}))):(ce.set(Ke.ofs[0],Ke.ofs[1],Ke.ofs[2]),ce.applyMatrix4(Xe),ce.applyMatrix4(be.matrixWorld),Ce?ie.add_optimized_command({o:4,body_v_index:Ke.body._v_index,_v:ce}):(Je=Ke.body,Je.getMotionState().getWorldTransform(le),le.setOrigin(Y(ce.x,ce.y,ce.z)),Je.setCenterOfMassTransform(le),Je.getMotionState().setWorldTransform(le))));else if(0!==Ke.type&&0<=Ke.bone){2===Ke.type&&ue.getPositionFromMatrix(Xe),Ce&&!ie.locked&&(ie._locked=!0),qe=Ke.body.getCenterOfMassTransform(),Ye=qe.getRotation(),he.set(Ye.x(),Ye.y(),Ye.z(),Ye.w()),Ce&&!ie.locked&&(ie._locked=!1,ie.add_optimized_command({o:5,body_v_index:Ke.body._v_index})),Me.copy(Ke.q).conjugate();let xt;Ee&&(Te?(he.multiplyQuaternions(we.q_matrixWorld_inv,he),xt=!0):he.multiplyQuaternions(MMD_SA.TEMP_q.setFromRotationMatrix(be.matrixWorld),he.multiplyQuaternions(MMD_SA._q1.setFromRotationMatrix(Xe),Ke.q))),xt||he.multiplyQuaternions(ge,he),he.multiplyQuaternions(he,Me);var et=Ie&&Ie[Ze];if(et){var tt=et.rotation,ot=tt._q;ot||(ot=tt._q=new THREE.Quaternion),Me.setFromRotationMatrix(ye.extractRotation(Xe)),ot.copy(he).multiply(Me.conjugate()),ce.setEulerFromQuaternion(ot.normalize());var rt,it;Le[et.group||"ALL"]&&(it=!0);var nt=tt.x,st=tt.y,lt=tt.z,pt=45;if(!it&&nt){var ct=nt[0][0]- -ce.x,ft=-ce.x-nt[1][0];0<ct?(rt=!0,ct>pt||!0==nt[0][1]?it=!0:ce.x=1==nt[0].length?nt[0][0]:nt[0][1]):0<ft&&(rt=!0,ft>pt||!0==nt[1][1]?it=!0:ce.x=1==nt[1].length?nt[1][0]:nt[1][1]),ce.x=-ce.x}if(!it&&st){var ut=st[0][0]-ce.y,ht=ce.y-st[1][0];0<ut?(rt=!0,ut>pt||!0==st[0][1]?it=!0:ce.y=1==st[0].length?st[0][0]:st[0][1]):0<ht&&(rt=!0,ht>pt||!0==st[1][1]?it=!0:ce.y=1==st[1].length?st[1][0]:st[1][1])}if(!it&&lt){var Mt=lt[0][0]- -ce.z,gt=-ce.z-lt[1][0];0<Mt?(rt=!0,Mt>pt||!0==lt[0][1]?it=!0:ce.z=1==lt[0].length?lt[0][0]:lt[0][1]):0<gt&&(rt=!0,gt>pt||!0==lt[1][1]?it=!0:ce.z=1==lt[1].length?lt[1][0]:lt[1][1]),ce.z=-ce.z}if(it)return void(Ke._reset_physics_=!0);rt&&(Me.conjugate(),Me.multiply(ot.setFromEuler(ce)),he.copy(Me),ot.copy(Me),Me.setFromRotationMatrix(be.matrixWorld),ce.set(Ke.ofs[0],Ke.ofs[1],Ke.ofs[2]),ce.applyMatrix4(Xe),ce.applyMatrix4(be.matrixWorld),he.setFromRotationMatrix(Xe),he.multiplyQuaternions(he,Ke.q),he.multiplyQuaternions(Me,he),Je=Ke.body,Ce?ie.add_optimized_command({o:3,body_v_index:Je._v_index,_v:ce,_q:he}):(le.setOrigin(Y(ce.x,ce.y,ce.z)),le.setRotation(J(he.x,he.y,he.z,he.w)),Je.setCenterOfMassTransform(le),Je.getMotionState().setWorldTransform(le)),he.copy(ot))}var yt=MMD_SA.TEMP_v3.getPositionFromMatrix(Xe);if(Xe.makeRotationFromQuaternion(he),1===Ke.type){Ce&&!ie.locked&&(ie._locked=!0),Qe=qe.getOrigin(),ce.set(Qe.x(),Qe.y(),Qe.z()),Ce&&!ie.locked&&(ie._locked=!1,ie.add_optimized_command({o:6,body_v_index:Ke.body._v_index}));let At;Ee&&(Te?(ce.applyProjection(we.matrixWorld_inv),At=!0):ce.copy(MMD_SA._v3a.set(Ke.ofs[0],Ke.ofs[1],Ke.ofs[2]).applyMatrix4(Xe)).add(yt).applyMatrix4(be.matrixWorld)),At||ce.applyProjection(xe),fe.set(Ke.ofs[0],Ke.ofs[1],Ke.ofs[2]).negate(),fe.applyMatrix4(Xe),ce.add(fe),Xe.setPosition(ce),Te&&Xe.setPosition(ce.sub(new THREE.Vector3().getPositionFromMatrix(we.skin[Ke.bone])).add(new THREE.Vector3().getPositionFromMatrix(Pe._skin[Ke.bone])))}else Xe.setPosition(ue),ce.set(Ke.ofs[0],Ke.ofs[1],Ke.ofs[2]),ce.applyMatrix4(Xe),ce.applyMatrix4(be.matrixWorld),Je=Ke.body,Ce?ie.add_optimized_command({o:4,body_v_index:Je._v_index,_v:ce}):(Je.getMotionState().getWorldTransform(le),le.setOrigin(Y(ce.x,ce.y,ce.z)),Je.setCenterOfMassTransform(le),Je.getMotionState().setWorldTransform(le))}Ee&&ie.register([Ye,Qe])}}),self.MMD_SA&&MMD_SA.use_afterPhysics){for(var He in be._bone_update_afterPhysics){var Ne=be.bones[He];Ne.parent instanceof THREE.Bone?ye.multiplyMatrices(MMD_SA.TEMP_m4.getInverse(Ne.parent.skinMatrix),Ne.skinMatrix):ye.copy(Ne.skinMatrix),Ne.position.getPositionFromMatrix(ye),Ne.quaternion.setFromRotationMatrix(ye)}ze._update_IK_and_AddTrans(!0);for(var Ge=0,We=be.children.length;Ge<We;Ge++)child=be.children[Ge],child instanceof THREE.Bone&&(child.pmxBone.afterPhysics?child.update(be.identityMatrix,!1):ve(child))}for(Se=0,De=be.bones.length;Se<De;Se++)ye.multiplyMatrices(be.bones[Se].skinMatrix,be.boneInverses[Se]),ye.flattenToArrayOffset(be.boneMatrices,16*Se);be.useVertexTexture&&(be.boneTexture.needsUpdate=!0)},B.prototype.reset=function(){var ve;ve=this.mesh,ve.updateMatrixWorld(!0),Me.setFromRotationMatrix(ve.matrixWorld),ve.MMDrigids.forEach(function(be){var Se;ce.set(be.pos[0],be.pos[1],be.pos[2]).applyMatrix4(ve.matrixWorld),he.multiplyQuaternions(Me,be.q),Se=be.body,Se.getMotionState().getWorldTransform(le),le.setOrigin(Y(ce.x,ce.y,ce.z)),le.setRotation(J(he.x,he.y,he.z,he.w)),Se.setWorldTransform(le)}),self.MMD_SA&&ie&&ie.update_worker()}}(),C=function(){var pe=function(Me){return((ie*Me+ne)*Me+se)*Me},ce=function(Me){return((de*Me+_e)*Me+le)*Me},fe=function(Me){return(3*ie*Me+2*ne)*Me+se},ue=function(Me){var ge,ye,xe,Ae,ve,be;for(xe=Me,be=0;8>be;be++){if(Ae=pe(xe)-Me,Math.abs(Ae)<me)return xe;if(ve=fe(xe),1e-6>Math.abs(ve))break;xe-=Ae/ve}if(ge=0,ye=1,xe=Me,xe<ge)return ge;if(xe>ye)return ye;for(;ge<ye;){if(Ae=pe(xe),Math.abs(Ae-Me)<me)return xe;Me>Ae?ge=xe:ye=xe,xe=0.5*(ye-ge)+ge}return xe},ie,ne,se,de,_e,le,me;return function(Me,ge,ye,xe,Ae,ve){return me=ve,se=3*ge,ne=3*(xe-ge)-se,ie=1-se-ne,le=3*ye,_e=3*(Ae-ye)-le,de=1-le-_e,ce(ue(Me))}}(),I=function(ie,ne){ie instanceof Array||(ie=[ie]),this.targets=ie,this.duration=ne,this.duration_default=ne,this.loop=!1,this.playing=!1,this.minKeyDelta=0,this.reset()},I.prototype.reset=function(){this.time=0,this.targets.forEach(function(ie){ie.k=0})},I.prototype.seek=function(ie,ne){var se;se=ie-this.time,0<=se?this.update(se,ne):(this.reset(),this.update(ie,ne))},I.prototype.play=function(ie){ie!==void 0&&(this.loop=ie),this.playing=!0},I.prototype.pause=function(){this.playing=!1},I.prototype.update=function(ie){var se,de,_e;if(this.playing&&(se=this,de=this.time+ie,this.time=de%this.duration,_e=!1,!(0>this.time))){var me={},pe=THREE.MMD.getModels()[this._model_index].pmx.morphs,le;this.targets.forEach(function(ce,fe){var ue,he,Me;if(2>ce.keys.length)return void(1==ce.keys.length&&se._is_MMD_SA_animation&&(ue=ce.keys[0],Me=0,se.onupdate(ue,ue,Me,fe)));if(ue=ce.keys[ce.k],he=ce.keys[ce.k+1],!me[he.name]){if(0==he.morph_type&&pe[he.morph_index].items.forEach(function(ge){me[pe[ge.target].name]=!0}),he.time<=de)if(!(se.time<de))do ce.k++,ue=ce.keys[ce.k],he=ce.keys[ce.k+1];while(he.time<se.time);else if(_e=!0,se.freeze_onended)_e=!1,se._is_MMD_SA_custom_animation&&se._is_skin&&!le&&(le=!0,MMD_SA_options.custom_action[se._motion_index-MMD_SA.custom_action_index].onFinish(se._model_index)),se.time=se.duration-1/59/1e3,Me=1,(!se._MMD_SA_animation_check||se._MMD_SA_animation_check(fe))&&se.onupdate(ue,he,Me,fe);else if(se.loop)for(jThree.MMD._onLoop=!0,ce.k=0,ue=ce.keys[ce.k],he=ce.keys[ce.k+1];he.time<se.time;)ce.k++,ue=ce.keys[ce.k],he=ce.keys[ce.k+1];else se.time=he.time;Me=he.time-ue.time<=se.minKeyDelta?0:se.time<ue.time?0:(se.time-ue.time)/(he.time-ue.time),(!se._MMD_SA_animation_check||se._MMD_SA_animation_check(fe))&&se.onupdate(ue,he,Me,fe)}}),se.freeze_onended&&se._is_MMD_SA_custom_animation&&se._is_skin&&!le&&de>se.duration&&MMD_SA_options.custom_action[se._motion_index-MMD_SA.custom_action_index].onFinish(se._model_index),_e&&(!this.loop&&this.pause(),this.onended&&this.onended(this))}},I.prototype.adjustDuration=function(ie){return this.duration_default>ie?void(ie=this.duration_default):void(this.duration=ie,this.targets.forEach(function(ne){var se,de;se=ne.keys;2>se.length||(de=se[se.length-1],de.time<ie&&(de=U(de),de.time=ie,se.push(de)))}))},H=function(ie,ne){var se,de;this.mesh=ie,I.call(this,ne.targets,ne.duration),de=ne.targets,se=ie.geometry;var _e=this,le=[],me=0,pe=[],ce=[],fe=0,ue=se.morphTargets?se.morphTargets.length:0;if(se._morphTargets_index||(se._morphTargets_index={}),se.MMDmorphs.forEach(function(he){if(1==he.type){var Me,ge,ye;if(ye=fe,ye<de.length&&he.name===de[ye].keys[0].name){if(fe++,null!=se._morphTargets_index[he.name])return me++,void(pe[se._morphTargets_index[he.name]]=de[ye]);se._morphTargets_index[he.name]=ue++,ce.push(de[ye])}else return;ge=[],se.vertices.forEach(function(xe){ge.push(xe.clone())}),he.items.forEach(function(xe){var Ae=ge[xe.target];Ae.x+=xe.offset[0],Ae.y+=xe.offset[1],Ae.z+=xe.offset[2]}),Me={},Me.name=he.name,Me.vertices=ge,le.push(Me)}}),me){for(;fe<de.length;)1!=de[fe].keys[0].morph_type&&ce.push(de[fe]),fe++;se.morphTargets.forEach(function(he,Me){pe[Me]||(pe[Me]={keys:[{name:he.name,weight:0,morph_type:1}]})}),this.targets=pe.concat(ce)}le.length&&(se.morphTargets=se.morphTargets?se.morphTargets.concat(le):le),0<se.morphTargets.length&&(se.morphTargetsNeedUpdate=!0,ie.updateMorphTargets(),ie.material.materials.forEach(function(he){he.morphTargets=!0,he.needsUpdate=!0}))},H.prototype=Object.create(I.prototype),H.prototype.constructor=H,H.prototype.onupdate=function(ie,ne,se,de){var _e=this,le=ie.weight+(ne.weight-ie.weight)*se,me=this.mesh,pe=me.geometry,ce=pe.morphs_weight_by_name[ie.name];if(pe.morphs_weight_by_name[ie.name]=le,0==ie.morph_type){var fe=ie.morph_index,ue=pe.MMDmorphs[fe];ue.items.forEach(function(he){var Me=pe.MMDmorphs[he.target],ge={name:Me.name,weight:le*he.weight,morph_type:Me.type,morph_index:he.target};_e.onupdate(ge,ge,0,pe._morphTargets_index[Me.name]||0)})}else if(2==ie.morph_type){var fe=ie.morph_index,ue=pe.MMDmorphs[fe];ue.items.forEach(function(he){var Me=me.bones[he.target].name,ge=me._bone_morph;ge=ge[Me]=ge[Me]||{},ge=ge[fe]=ge[fe]||{weight:0,pos_v3:new THREE.Vector3,rot_q:new THREE.Quaternion},ge.weight>=Math.abs(le)||(ge.weight=Math.abs(le),he.pos_v3?ge.pos_v3.copy(he.pos_v3).multiplyScalar(le):ge.pos_v3.set(0,0,0),he.rot_q?ge.rot_q.set(0,0,0,1).slerp(he.rot_q,le):ge.rot_q.set(0,0,0,1))})}else if(8==ie.morph_type){var fe=ie.morph_index,ue=pe.MMDmorphs[fe];ue.items.forEach(function(he){if(-1!=he.target){var Me=me.material.materials[he.target];Me._render_once=!0;var ge=Me.name,ye=me._material_morph[ge];ye||(ye=me._material_morph[ge]={}),ye[fe]={weight:le,morph_obj:he}}})}else if(3<=ie.morph_type&&7>=ie.morph_type){if(ce==le)return;var fe=ie.morph_index,ue=pe.MMDmorphs[fe];pe._faceVertexUvs||(pe._faceVertexUvs=[[]]),ue.items.forEach(function(he){var ge=he.target,ye=pe._face_index_by_vertex[ge];ye&&ye.forEach(function(xe){var Ae=xe[0],ve=pe.faceVertexUvs[0][Ae],be=pe._faceVertexUvs[0][Ae];be||(be=pe._faceVertexUvs[0][Ae]=[ve[0].clone(),ve[1].clone(),ve[2].clone()]);var Se=xe[1];ve[Se].x=be[Se].x+he.uv[0]*le,ve[Se].y=be[Se].y+he.uv[1]*le})}),pe.uvsNeedUpdate=!0}else le>me.morphTargetInfluences[de]&&(this.mesh.morphTargetInfluences[de]=le)},function(){var ie,ne,se;ie=function(de,_e,le,me){var pe,ce,fe,ue,he;return(pe=de[0]*_e[0]+de[1]*_e[1]+de[2]*_e[2]+de[3]*_e[3],0>pe?(le[0]=-_e[0],le[1]=-_e[1],le[2]=-_e[2],le[3]=-_e[3],pe=-pe):(le[0]=_e[0],le[1]=_e[1],le[2]=_e[2],le[3]=_e[3]),1<=Math.abs(pe))?(le[0]=de[0],le[1]=de[1],le[2]=de[2],void(le[3]=de[3])):(ce=Math.acos(pe),fe=Math.sqrt(1-pe*pe),1e-3>Math.abs(fe)?(le[0]=0.5*(de[0]+le[0]),le[1]=0.5*(de[1]+le[1]),le[2]=0.5*(de[2]+le[2]),void(le[3]=0.5*(de[3]+le[3]))):void(ue=Math.sin((1-me)*ce)/fe,he=Math.sin(me*ce)/fe,le[0]=de[0]*ue+le[0]*he,le[1]=de[1]*ue+le[1]*he,le[2]=de[2]*ue+le[2]*he,le[3]=de[3]*ue+le[3]*he))},ne=function(de,_e,le){return C(de,_e[le]/127,_e[le+4]/127,_e[le+8]/127,_e[le+12]/127,1/128)},se=[0,0,0,1],N=function(de,_e){this.mesh=de,I.call(this,_e.targets,_e.duration)},N.prototype=Object.create(I.prototype),N.prototype.constructor=N,N.prototype.onupdate=function(de,_e,le,me){var pe=this.mesh.bones[me],ce=this.mesh.geometry.bones[me],fe;if(self.MMD_SA){var ue=MMD_SA_options.model_para_obj_all[this.mesh._model_index];model=THREE.MMD.getModels()[this.mesh._model_index],motion_name=model.skin&&MMD_SA.motion[model.skin._motion_index].filename||"";var he=MMD_SA_options.motion_para[motion_name],Me=he&&he.adjustment_per_model&&(he.adjustment_per_model[ue._filename]||he.adjustment_per_model[ue._filename_cleaned]||he.adjustment_per_model._default_);Me=Me&&Me.skin_default||{};var ge=Me[ce.name]||ue.skin_default[ce.name];if(ge&&ge.gpos_add){var ye=[];ce.pos.forEach(function(xe,Ae){ye[Ae]=xe+ge.gpos_add[Ae]}),ce={name:ce.name,pos:ye}}}fe=_e.interp,pe.position.x=ce.pos[0]+de.pos[0]+(_e.pos[0]-de.pos[0])*ne(le,fe,0),pe.position.y=ce.pos[1]+de.pos[1]+(_e.pos[1]-de.pos[1])*ne(le,fe,1),pe.position.z=ce.pos[2]+de.pos[2]+(_e.pos[2]-de.pos[2])*ne(le,fe,2),ie(de.rot,_e.rot,se,ne(le,fe,3)),pe.quaternion.x=se[0],pe.quaternion.y=se[1],pe.quaternion.z=se[2],pe.quaternion.w=se[3]},MMD_SA._skin_onupdate=N.prototype.onupdate}(),function(){var ie,ne,se,de,_e,le;ie=new THREE.Vector3,ne=new THREE.Quaternion,se=new THREE.Vector3,de=new THREE.Vector3,_e=new THREE.Quaternion,le=new THREE.Quaternion,G=function(me,pe){var ce;this.mesh=pe,ce=[],pe.bones.forEach(function(fe){var he,Me;he=fe.pmxBone.additionalTransform,he&&0<=he[0]&&0!==he[1]&&(Me=pe.bones[he[0]],Me.basePosition=Me.position.clone(),Me.baseQuaternion=Me.quaternion.clone(),Me.baseSkinMatrix=Me.skinMatrix.clone(),ce.push(fe))}),ce.sort(function(fe,ue){return fe.pmxBone.deformHierachy-ue.pmxBone.deformHierachy}),this.hasGlobal=ce.some(function(fe){return 0!=(128&fe.pmxBone.flags)}),this.hasGlobal=!1,this.bones=ce},G.prototype.update=function(me){var pe;pe=this.mesh,this.hasGlobal&&pe.updateMatrixWorld();var ce=0,fe=this.bones.length-1;me&&(ce=me.ini,fe=me.end||ce);for(var ue=ce,he=fe;ue<=he;ue++){var Me=pe._IK_and_AddTrans[ue],ge,ye,xe;ge=Me.pmxBone.additionalTransform,ye=pe.bones[ge[0]],(ie.subVectors(ye.position,ye.basePosition),ne.copy(ye.quaternion)),xe=ge[1],0!=(256&Me.pmxBone.flags)&&(_e.set(0,0,0,1),0<=xe?_e.slerp(ne,xe):_e.slerp(ne.conjugate(),-xe),Me.quaternion.multiplyQuaternions(Me.quaternion,_e)),0!=(512&Me.pmxBone.flags)&&Me.position.addVectors(Me.position,ie.multiplyScalar(xe))}}}(),function(){var ie,ne;ie=function(se,de,_e){return _e*=4,C(se,de[_e]/127,de[_e+2]/127,de[_e+1]/127,de[_e+3]/127,1/128)},ne=new THREE.Vector3,W=function(se,de){return se instanceof THREE.PerspectiveCamera?void(this.persepectiveCamera=se,I.call(this,de,de.duration),this.minKeyDelta=ee.minKeyDelta,this.offset=new THREE.Vector3,this.target=new THREE.Vector3):void console.error("not PerspectiveCamera")},W.prototype=Object.create(I.prototype),W.prototype.constructor=W,W.prototype.play=function(se){I.prototype.play.call(this,se),this.persepectiveCamera.rotationAutoUpdate=!1,this.persepectiveCamera.matrixAutoUpdate=!1},W.prototype.pause=function(){I.prototype.pause.call(this),this.persepectiveCamera.rotationAutoUpdate=!0,this.persepectiveCamera.matrixAutoUpdate=!0},W.prototype.onupdate=function(se,de,_e){var le=this.persepectiveCamera,me=de.interp,pe,ce,fe,ue,he,Me;ce=le.position,ce.x=se.target[0]+(de.target[0]-se.target[0])*ie(_e,me,0),ce.y=se.target[1]+(de.target[1]-se.target[1])*ie(_e,me,1),ce.z=se.target[2]+(de.target[2]-se.target[2])*ie(_e,me,2),ce.addVectors(ce,this.offset),this.target.copy(ce),pe=ie(_e,me,3),fe=le.rotation,fe.x=se.rot[0]+(de.rot[0]-se.rot[0])*pe,fe.y=se.rot[1]+(de.rot[1]-se.rot[1])*pe,fe.z=se.rot[2]+(de.rot[2]-se.rot[2])*pe,ue=se.distance+(de.distance-se.distance)*ie(_e,me,4),he=le.fov,le.fov=se.fov+(de.fov-se.fov)*ie(_e,me,5),le.fov!==he&&le.updateProjectionMatrix(),Me=le.matrix,Me.makeRotationFromEuler(fe),ce.add(ne.getColumnFromMatrix(2,Me).multiplyScalar(ue)),Me.setPosition(ce),le.up.copy(ne.getColumnFromMatrix(1,Me)),le.matrixWorldNeedsUpdate=!0}}(),K=function(ie,ne){return ie instanceof THREE.DirectionalLight?void(this.directionalLight=ie,I.call(this,ne,ne.duration),this.minKeyDelta=ee.minKeyDelta):void console.error("not DirectionalLight")},K.prototype=Object.create(I.prototype),K.prototype.constructor=K,K.prototype.onupdate=function(ie,ne,se){var de=this.directionalLight,_e=de.color,le=de.position,me=de.target.position;_e.r=ie.color[0]+(ne.color[0]-ie.color[0])*se,_e.g=ie.color[1]+(ne.color[1]-ie.color[1])*se,_e.b=ie.color[2]+(ne.color[2]-ie.color[2])*se,le.x=0,le.y=0,le.z=0,me.x=ie.dir[0]+(ne.dir[0]-ie.dir[0])*se,me.y=ie.dir[1]+(ne.dir[1]-ie.dir[1])*se,me.z=ie.dir[2]+(ne.dir[2]-ie.dir[2])*se};var te=function(ie){var ne,se,de;if(this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||ie)&&(this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,ie=!0),this._mesh_parent&&this._mesh_parent._RAF_timestamp_){if(this._mesh_parent._RAF_timestamp_==RAF_timestamp)return;this._mesh_parent._RAF_timestamp_=RAF_timestamp}for(ne=0,se=this.children.length;ne<se;ne++)de=this.children[ne],de instanceof THREE.Bone?(!de.pmxBone||!de.pmxBone.afterPhysics)&&de.update(this.identityMatrix,!1):de.updateMatrixWorld(!0)};(function(){function ie(ne){return ne.bones.some(function(se){return!!se.additionalTransform})}X=function(ne,se){this.init(ne,se)},X.prototype.init=function(ne,se){this.pmx=ne,this.vmd=se,this.ik=null,this.physi=null,this.skin=null,this.morph=null,this.addTrans=null,this.mesh=null,this.simulateCallback=null,this.boundingCenterOffset=null,this._onmotionended=null,this._MMD_SA_cache=[]},X.prototype.load=function(ne,se,de){function _e(me,pe){X.call(le,me,pe),de(le)}var le;le=this,new P().load(ne,function(me){se?new T().load(se,function(pe){_e(me,pe)}):_e(me)})},X.prototype._update_IK_and_AddTrans=function(ne){var se=this,de=this.mesh._IK_and_AddTrans,_e,le,me,pe;ne?(le=this.mesh._IK_and_AddTrans_afterPhysics_index,pe=de.length-1):(le=0,pe=(this.mesh._IK_and_AddTrans_afterPhysics_index||de.length)-1);for(var me=-1,ce=le,fe;ce<=pe;ce++)fe=de[ce],_e?fe.pmxBone.IK&&!fe._additionalTransform_only?me=ce:(se.ik.update({ini:le,end:me}),_e=!1,le=me=ce):fe.pmxBone.additionalTransform&&(!fe.pmxBone.IK||fe._additionalTransform_only)?me=ce:(-1!=me&&se.addTrans.update({ini:le,end:me}),_e=!0,le=me=ce),ce==pe&&(_e?se.ik.update({ini:le,end:me}):se.addTrans.update({ini:le,end:me}))},X.prototype.create=function(ne,se){var de=this;var _e,le,me,pe;self.MMD_SA&&(_e=document.createElement("canvas"),le=_e.getContext("2d"),me=document.createElement("canvas"),pe=me.getContext("2d")),this.pmx&&this.pmx.createMesh(ne,function(ce){function fe(ve){for(var be=ve,Se=-1,De;be!==ce;){if(De=de.pmx.rigid_index_by_bone[be._index],null!=De&&0<ce.MMDrigids[De].type){Se=be._index;break}be=be.parent}return Se}ce.MMDrigids=de.pmx.rigids;var ue;if(self.MMD_SA){ce._model_index=de.pmx._model_index,ce._material_morph={},ue=self.MMD_SA&&MMD_SA_options.model_para_obj_all[ce._model_index],ce.bones_by_name={},ce._IK_and_AddTrans=[];var he={},Me={};ce.geometry.bones.forEach(function(ve,be){var Se=ce.bones[be];ce.bones_by_name[ve.name]=Se,Se._index=be;var De=Se.pmxBone=de.pmx.bones[be];if(De.IK){ce._IK_and_AddTrans.push(Se);var ke=De.IK;he[ke.effector]=!0,ke.links.forEach(function(Ee){he[Ee.bone]=!0})}}),ce.geometry.bones.forEach(function(ve,be){var Se=ce.bones[be],De=Se.pmxBone,ke=De.additionalTransform;if(ke&&0<=ke[0]&&0!==ke[1]){if(De.IK){let Ee=Object.assign({},Se);Ee._additionalTransform_only=!0,ce._IK_and_AddTrans.push(Ee)}else ce._IK_and_AddTrans.push(Se);ke&&he[ke[0]]&&(he[Se._index]=Me[Se._index]=!0)}}),ce._bone_update_afterPhysics={},ce._IK_and_AddTrans.forEach(function(ve){if(ve.pmxBone.afterPhysics){var be;ve.pmxBone.IK?(be=fe(ve),-1!=be&&(ce._bone_update_afterPhysics[be]=!0)):(be=fe(ve),-1!=be&&(ce._bone_update_afterPhysics[be]=!0),be=fe(ce.bones[ve.pmxBone.additionalTransform[0]]),-1!=be&&(ce._bone_update_afterPhysics[be]=!0))}}),ce._IK_and_AddTrans.sort(function(ve,be){var Se=ve.pmxBone,De=be.pmxBone;return(Se.afterPhysics&&8192||0)+(Se.additionalTransform&&(!Se.IK||ve._additionalTransform_only)&&4096||0)+1024*Se.deformHierachy+ve._index-((De.afterPhysics&&8192||0)+(De.additionalTransform&&(!De.IK||be._additionalTransform_only)&&4096||0)+1024*De.deformHierachy+be._index)}),MMD_SA.use_afterPhysics&&ce._IK_and_AddTrans.some(function(ve,be){if(ve.pmxBone.afterPhysics)return ce._IK_and_AddTrans_afterPhysics_index=be,console.log(ce._model_index,"._IK_and_AddTrans_afterPhysics_index",be),!0})}var ge,ye,xe=0;self.MMD_SA&&(ge=self.MMD_SA&&-1==de.pmx._clone_index,ye=ue.material_para=ue.material_para||{}),ce.material.materials.forEach(function(ve){function Se(Pe){return 0<=Pe?Pe%1:Pe%1+1}if(ve.mesh=ce,self.MMD_SA){let Ie=ye[ve.name]||{},Ue=ge&&null==Ie.transparent,Pe,Te,Ce;if(Ue){if(1>ve.opacity)Ie.transparent=!0;else if(!ve.map)Ie.transparent=!1;else if(ve.map instanceof THREE.CompressedTexture)Ie.transparent=!0;else if(ve.map.image.src&&/\.jpg$/i.test(ve.map.image.src)&&!/\.jpga\.jpg$/i.test(ve.map.image.src))Ie.transparent=!1;else{Pe=ve.map.image,Te=_e.width=me.width=Math.ceil(0.5*Pe.width),Ce=_e.height=me.height=Math.ceil(0.5*Pe.height),le.drawImage(Pe,0,0,Te,Ce);let Le=ce.geometry.faceVertexUvs[0];pe=me.getContext("2d"),pe.fillStyle="white";for(var De=ve._uv_bbox.face_ini,ke=ve._uv_bbox.face_end;De<ke;De++){let Ve=Le[De];pe.beginPath(),pe.moveTo(Se(Ve[0].x)*Te,Se(Ve[0].y)*Ce),pe.lineTo(Se(Ve[1].x)*Te,Se(Ve[1].y)*Ce),pe.lineTo(Se(Ve[2].x)*Te,Se(Ve[2].y)*Ce),pe.closePath(),pe.fill()}let ze=le.getImageData(0,0,Te,Ce).data,Fe=pe.getImageData(0,0,Te,Ce).data,Re=!1;for(var Ee=0,we=ze.length;Ee<we;Ee+=4)if(64<Fe[Ee+3]&&192>ze[Ee+3]){Re=!0;break}Ie.transparent=Re,ze=Fe=void 0}null!=Ie.transparent&&(ve.transparent=Ie.transparent)}ve._material_para=ye[ve.name]||ye._default_||null,ve.transparent||xe++}}),console.log("model-"+ce._model_index+":auto_detect_material_para-"+!!ge+",opaque/total material count-"+xe+"/"+ce.material.materials.length),self.MMD_SA&&(_e.width=_e.height=me.width=me.height=0,_e=le=me=pe=void 0);var Ae;de.mesh=ce,ce.identityMatrix=null,ce.useQuaternion=!0,ne.position&&ce.position.copy(ne.position),ne.rotation&&(ce.rotation.copy(ne.rotation),ce.useQuaternion=!1),ne.quaternion&&(ce.quaternion.copy(ne.quaternion),ce.useQuaternion=!0),de.boundingCenterOffset=ce.geometry.boundingSphere.center.clone().sub(ce.bones[0].position),de.ik=ce.geometry.MMDIKs.length?new O(ce):null,de.physi=window.Ammo?new B(ce):null,de.vmd?(Ae=de.vmd.generateSkinAnimation(de.pmx),Ae?(de.skin=new N(ce,Ae),de.skin.onended=function(ve){ve.loop&&de.physi&&de.physi.reset(),de._onmotionended=de.onmotionended},de.physi&&(ce.updateMatrixWorld=te)):de.skin=null,Ae=de.vmd.generateMorphAnimation(de.pmx),de.morph=Ae?new H(ce,Ae):null,self.MMD_SA&&(de._MMD_SA_cache[toLocalPath(de.vmd.url)]={skin:de.skin,morph:de.morph})):self.MMD_SA&&(ce.updateMatrixWorld=te),de.addTrans=ie(de.pmx)?new G(de.pmx,ce):null,se(de),self.MMD_SA&&(ue.hidden_before_start||ue.hidden_on_start||MMD_SA_options.hidden_before_start||MMD_SA_options.hidden_on_start)&&ce.scale.set(0,0,0)})},X.prototype.resetBones=function(){var ne,se;ne=this.mesh,ne&&(se=ne.bones,ne.geometry.bones.forEach(function(de,_e){var le;le=se[_e],le.position.set(de.pos[0],de.pos[1],de.pos[2]),le.quaternion.set(de.rotq[0],de.rotq[1],de.rotq[2],de.rotq[3])}))},X.prototype.setupMotion_MMD_SA=function(ne,se,de){se||(se={skin_jThree:!0,morph_jThree:!0});var _e=se.skin_jThree?ne.generateSkinAnimation(this.pmx,!0===se.skin_jThree?null:se.skin_jThree):null,le=se.morph_jThree?(ne._morph_component||ne).generateMorphAnimation(this.pmx,!0===se.morph_jThree?null:se.morph_jThree):null,me=_e?new N(this.mesh,_e):de?MMD_SA.Animation_dummy:null,pe=le?new H(this.mesh,le):de?MMD_SA.Animation_dummy:null;me&&(me._model_index=this._model_index,me._motion_index=ne._index),pe&&(pe._model_index=this._model_index,pe._motion_index=ne._index);var ce={skin:me,morph:pe};return pe&&!de&&(pe.target_index_by_name={},pe.targets.forEach(function(fe,ue){pe.target_index_by_name[fe.keys[0].name]=ue}),"\u307E\u3070\u305F\u304D"in pe.target_index_by_name&&(ce._blink_target_index=pe.target_index_by_name.)),ce},X.prototype._VMD=function(ne,se){new T().load(ne,se)},X.prototype.resetMotion=function(ne){if(this.resetBones(),this.morph&&(this.morph.reset(),this.morph_MMD_SA_extra&&this.morph_MMD_SA_extra.forEach(function(de){(!de.time||de._MMD_SA_disabled)&&de.reset()})),this.skin&&(this.skin.reset(),this.skin_MMD_SA_extra&&this.skin_MMD_SA_extra.forEach(function(de){(!de.time||de._MMD_SA_disabled)&&de.reset()})),this.physi){if(ne)return;if(self.MMD_SA&&(this.mesh._reset_rigid_body_physics_=MMD_SA_options.reset_rigid_body_physics_step,0==this._model_index)){var se=MMD_SA.MMD.motionManager.para_SA.gravity||[0,-1,0];(se[0]!=MMD_SA.gravity[0]||se[1]!=MMD_SA.gravity[1]||se[2]!=MMD_SA.gravity[2])&&(THREE.MMD.setGravity(10*(9.8*se[0]),10*(9.8*se[1]),10*(9.8*se[2])),MMD_SA.gravity=se)}this.physi.reset()}},self.MMD_SA?Object.defineProperty(X.prototype,"visible",{get:function(){if(this._visible_RAF_timestamp==RAF_timestamp)return this._visible;var ne;return ne=!!this.mesh.visible||!!this._clone_cache&&this._clone_cache.list.some(function(se){return se.visible}),this._visible_RAF_timestamp=RAF_timestamp,this._visible=ne,ne}}):X.prototype.visible=!0,X.prototype.updateMotion=function(ne,se){if(this.visible){this.resetBones();var de=this.mesh,_e=this,le,me,pe,ce,fe;if(self.MMD_SA){le=self.MMD_SA&&MMD_SA.meter_motion_disabled,me=MMD_SA_options.model_para_obj_all[this._model_index],pe=(MMD_SA.motion[(this.skin||this.morph||{})._motion_index]||MMD_SA.MMD.motionManager).para_SA,de._bone_morph={};var ue=(pe.playbackRate_by_model_index&&pe.playbackRate_by_model_index[this._model_index]||1)*(me._playbackRate||1);0==this._model_index?me._playbackRate_OPC_=MMD_SA._playbackRate*ue:me._playbackRate_OPC_&&(ue=me._playbackRate_OPC_/MMD_SA._playbackRate),ne*=ue}if(this.morph){var he=!1;if(self.MMD_SA){var Me=de.morphTargetInfluences;if(Me&&this.morph.playing)for(var ge=0,ye=Me.length;ge<ye;ge++)Me[ge]=0}if(this.morph_MMD_SA_extra&&this.morph_MMD_SA_extra.forEach(function(Lt){if(!Lt._is_dummy&&Lt.targets.length){var Ft=Lt._motion_index-MMD_SA.custom_action_index;if(Ft<MMD_SA_options.custom_action.length){var Rt=MMD_SA_options.custom_action[Ft],Vt=Rt.frame=Rt.para_by_model_index[_e._model_index].frame=Lt._MMD_SA_disabled?0:~~(30*(Lt.time<Lt.duration?Lt.time:Lt.duration));Rt.condition(!1,Lt)?(he=!0,Lt._MMD_SA_disabled&&(Lt._MMD_SA_disabled=!1,Lt.reset(),Lt.play())):!Lt._MMD_SA_disabled&&(Lt.pause(),Lt._MMD_SA_disabled=!0)}Lt._MMD_SA_disabled||Lt.update(ne)}}),he?this.morph.time+=ne:this.morph.update(ne,se),self.MMD_SA&&(!pe.process_morphs||pe.process_morphs(this,this.morph))&&(me.process_morphs&&me.process_morphs(this,this.morph),window.dispatchEvent(new CustomEvent("SA_MMD_model"+this._model_index+"_process_morphs",{detail:{model:this,morph:this.morph}}))),self.MMD_SA){pe.morph_noise&&pe.morph_noise.forEach(function(Lt){Lt._count||(Lt._count=~~(Lt.time_range[0]+Math.random()*(Lt.time_range[1]-Lt.time_range[0]+1)),Lt.morph_list.forEach(function(Ft){Ft._weight=Ft.weight_range[0]+Math.random()*(Ft.weight_range[1]-Ft.weight_range[0])})),Lt._count--;var zt=_e.morph.targets;Lt.morph_list.forEach(function(Ft){var Rt=Ft.name,Vt=_e.morph.target_index_by_name[Rt],Ot=zt[Vt],Bt=Ot.keys[0],jt={name:Rt,weight:_e.pmx.morphs_weight_by_name[Rt]+Ft._weight,morph_type:Bt.morph_type,morph_index:Bt.morph_index};_e.morph.onupdate(jt,jt,0,Vt)})});var xe=me._custom_morph||MMD_SA._custom_morph;xe.forEach(function(Lt){(!Lt.condition||Lt.condition(_e))&&_e.morph.onupdate(Lt.key,Lt.key,0,Lt.idx)}),me._custom_morph=null,MMD_SA._custom_morph=[]}if(self.MMD_SA&&MMD_SA_options.auto_blink&&!he&&null!=this.pmx.morphs_index_by_name.){var Ae=this.morph.targets,ve=this._MMD_SA_cache_current,be=Ae[ve._blink_target_index];if(null==this._blink_countdown&&(this._blink_countdown=-9999),pe.auto_blink||null==pe.auto_blink&&2>=be.keys.length&&!be.keys[0].weight&&!be.keys[be.keys.length-1].weight){var Me=pe.auto_blink?this.pmx.morphs_weight_by_name.:0,Se=this._blink_countdown,De=-1;if(-4>=Se?(this._blink_countdown=~~(20*(4*Math.random()+4)),De=Me||0):-1==Se||-3==Se?De=Me+0.5*(1-Me):-2==Se&&(De=1),0<=De){var ke=be.keys[0],Ee={name:"\u307E\u3070\u305F\u304D",weight:De,morph_type:ke.morph_type,morph_index:ke.morph_index};this.morph.onupdate(Ee,Ee,0,ve._blink_target_index)}this._blink_countdown--}}}if(this.skin&&(self.MMD_SA&&MMD_SA_options.Dungeon&&MMD_SA_options.Dungeon.SFX_check(this,pe,this.skin,ne),this.skin.update(ne,se)),self.MMD_SA&&((!pe.process_bones||pe.process_bones(this,this.skin))&&(me.process_bones&&me.process_bones(this,this.skin),window.dispatchEvent(new CustomEvent("SA_MMD_model"+this._model_index+"_process_bones",{detail:{model:this,skin:this.skin}}))),0<this._model_index)){var we=MMD_SA.bone_to_position.call(this,pe);we&&de.position.add(de._bone_to_position_last.pos_delta_rotated)}if(this.skin){if(this.skin_MMD_SA_extra&&this.skin_MMD_SA_extra.forEach(function(Lt){if(!Lt._is_dummy){var Ft=Lt._motion_index-MMD_SA.custom_action_index;if(Ft<MMD_SA_options.custom_action.length){var Rt=MMD_SA_options.custom_action[Ft],Vt=Rt.frame=Rt.para_by_model_index[_e._model_index].frame=Lt._MMD_SA_disabled?0:~~(30*(Lt.time<Lt.duration?Lt.time:Lt.duration));if(Rt.condition(!0,Lt)){!1!=Rt.meter_motion_disabled&&(le=!0);var Ot=Rt.look_at_screen_ratio;null!=Ot&&(ce=Ot),fe=fe||Rt.look_at_mouse_disabled,Lt._MMD_SA_disabled&&(Lt._MMD_SA_disabled=!1,Lt.reset(),Lt.play())}else Lt._MMD_SA_disabled||(Lt.pause(),Lt._MMD_SA_disabled=!0)}Lt._MMD_SA_disabled||Lt.update(ne)}}),self.MMD_SA)for(var Pe in de._bone_morph){var Te=de._bone_morph[Pe],Ce=de.bones_by_name[Pe];for(var Ie in Te)Ce.position.add(Te[Ie].pos_v3),Ce.quaternion.multiply(Te[Ie].rot_q)}var Ue="\u9996",Le=null;if(self.MMD_SA&&(me.is_object||(Le=MMD_SA.get_bone_position(de,Ue)),0==this._model_index&&(MMD_SA._head_pos=Le,MMD_SA.SpeechBubble.update_placement(),MMD_SA_options.Dungeon))){var ze=MMD_SA_options.Dungeon.character.bb_translate;ze&&ze.update&&ze.update()}var Fe;if(self.MMD_SA&&Le&&de.bones_by_name[Ue]&&0!=ce&&MMD_SA_options.look_at_screen_by_model(this)&&!1!=me.look_at_screen){var Re=MMD_SA.camera_position;if(pe&&pe.center_view_lookAt||MMD_SA_options.center_view_lookAt||MMD_SA_options.use_JSARToolKit&&MMD_SA.AR_obj._m4)Fe=!0;else{for(var Ve=MMD_SA_options.camera_position.slice(0),Oe=MMD_SA.center_view,Be=de.position.toArray(),ge=0;3>ge;ge++)Be[ge]+=Ve[ge]+Oe[ge];for(var je=[Re.x,Re.y,Re.z],ge=0;3>ge;ge++)if(0.01<Math.abs(Be[ge]-je[ge])){Fe=!0;break}}var He=!fe&&MMD_SA_options.look_at_mouse||null!=me.look_at_character||me.look_at_target;if(Fe||He){var Ne=(MMD_SA_options.look_at_screen_parent_rotation||MMD_SA.get_bone_rotation_parent(de,Ue)).inverse(),Ge=MMD_SA.face_camera(Le,Ne),We=pe.look_at_screen_angle_x_limit||[0.5*Math.PI,0.5*-Math.PI],Ke=pe.look_at_screen_angle_y_limit||[0.5*Math.PI,0.5*-Math.PI],Xe=null==ce?MMD_SA_options.look_at_screen_ratio:ce;Ge.x=Math.min(Math.max(MMD_SA.normalize_angle(Ge.x*Xe),We[1]),We[0]),Ge.y=Math.min(Math.max(MMD_SA.normalize_angle(Ge.y*Xe),Ke[1]),Ke[0]);var qe=MMD_SA.TEMP_v3.copy(Re).sub(Le);if(0==this._model_index&&(MMD_SA._rx=Math.atan2(-qe.y,Math.sqrt(Math.pow(qe.x,2)+Math.pow(qe.z,2))),MMD_SA._ry=Ge.y,MMD_SA._rx_last=Ge.x,MMD_SA._ry_last=Ge.y),He){var Qe;if(null!=me.look_at_character)Qe=THREE.MMD.getModels()[me.look_at_character].mesh.position.clone(),Qe.y+=15;else if(me.look_at_target)Qe=me.look_at_target();else{var Ye=webkit_electron_mode?System._browser._electron_cursor_pos:{x:System._browser._WE_mouse_x,y:System._browser._WE_mouse_y},Je=webkit_electron_mode?System._browser._electron_window_pos.slice(0):[Lbody_host.style.posLeft,Lbody_host.style.posTop];if(is_SA_child_animation){var Ze=parent.SA_child_animation[SA_child_animation_id];Je[0]+=Ze.x,Je[1]+=Ze.y}Qe=new THREE.Vector3(640*((Ye.x-Je[0])/B_content_width-0.5),480*-((Ye.y-Je[1])/B_content_height-0.5),pe.look_at_mouse_z||0).unproject(MMD_SA._trackball_camera.object);var $e=MMD_SA._trackball_camera.position0,Oe=MMD_SA.center_view_lookAt;Qe.x+=$e.x-de.position.x+Oe[0],Qe.z-=Oe[2]}MMD_SA._mouse_pos_3D[this._model_index]?["x","y","z"].forEach(function(Lt){var zt=Qe[Lt]-MMD_SA._mouse_pos_3D[_e._model_index][Lt];5<Math.abs(zt)&&(zt=5*(0<zt?1:-1)),MMD_SA._mouse_pos_3D[_e._model_index][Lt]+=zt}):MMD_SA._mouse_pos_3D[this._model_index]=Qe,MMD_SA._camera_position_=MMD_SA._mouse_pos_3D[this._model_index],Ge=MMD_SA.face_camera(Le,Ne),MMD_SA._camera_position_=null,Ge.x=Math.min(Math.max(MMD_SA.normalize_angle(Ge.x*Xe),We[1]),We[0]),Ge.y=Math.min(Math.max(MMD_SA.normalize_angle(Ge.y*Xe),Ke[1]),Ke[0])}var et,tt,ot,rt;ot=We[0>Ge.x?1:0],rt=Ke[0>Ge.y?1:0],et=Math.abs(Ge.x/ot),tt=Math.abs(Ge.y/rt);for(var it=MMD_SA_options.look_at_screen_bone_list,ge=0,nt=it.length;ge<nt;ge++){var Ce=it[ge],st=de.bones_by_name[Ce.name];if(st){var lt=Ce.weight_screen,pt=MMD_SA_options.model_para_obj.skin_default[Ce.name]&&MMD_SA_options.model_para_obj.skin_default[Ce.name].pos_scale;pt&&(lt*=Math.min(pt.x,pt.y,pt.z));var ct,ft;null==Ce.weight_screen_pow?(ct=Ge.x,ft=Ge.y):(ct=ot*Math.pow(et,Ce.weight_screen_pow),ft=rt*Math.pow(tt,Ce.weight_screen_pow));var ut=Ce.weight_motion+(1-Xe)*(1-Ce.weight_motion);MMD_SA.process_bone(st,MMD_SA.TEMP_v3.set(ct*lt,ft*lt,0),[ut,ut,1])}}if(MMD_SA._update_with_look_at_screen_){for(var ht=MMD_SA._update_with_look_at_screen_.bone_list,Mt=MMD_SA._update_with_look_at_screen_.parent_list,gt=MMD_SA.TEMP_q.set(0,0,0,1),yt=0,xt=Mt.length,st;yt<xt;yt++)st=de.bones_by_name[Mt[yt]],st&&gt.multiply(st.quaternion,gt);gt.inverse().slerp(MMD_SA._q1.set(0,0,0,1),2/3);for(var yt=0,xt=ht.length,st;yt<xt;yt++)st=de.bones_by_name[ht[yt]],st&&st.quaternion.multiply(gt);MMD_SA._update_with_look_at_screen_=null}}}if(Fe||0!=this._model_index||(MMD_SA._rx=MMD_SA._rx_last=0,MMD_SA._ry=MMD_SA._ry_last=0),self.MMD_SA&&0==this._model_index){var At=this,vt=MMD_SA_options.custom_action.length;if(!le&&9<self.EV_usage){var bt=[];60>EV_usage?bt.push(~~(EV_usage/10)-1):bt.push(4,~~(EV_usage/10-1));for(var ge=0,St=At.skin_MMD_SA_extra.length-vt;ge<St;ge++){for(var Dt=At.skin_MMD_SA_extra[ge+vt],kt=!1,Et=0,wt=bt.length;Et<wt;Et++)if(ge==bt[Et]){kt=!0;break}kt?Dt._MMD_SA_disabled&&(Dt._MMD_SA_disabled=!1,Dt.reset(),Dt.play()):!Dt._MMD_SA_disabled&&(Dt.pause(),Dt._MMD_SA_disabled=!0)}}else for(var ge=0,St=At.skin_MMD_SA_extra.length-vt,Dt;ge<St;ge++)Dt=At.skin_MMD_SA_extra[ge+vt],Dt._MMD_SA_disabled||(Dt.pause(),Dt._MMD_SA_disabled=!0)}}if(self.MMD_SA){var Pt=me._custom_skin||MMD_SA._custom_skin;Pt.forEach(function(Lt){(!Lt.condition||Lt.condition(_e))&&MMD_SA._skin_onupdate.call({mesh:de},Lt.key,Lt.key,0,Lt.idx)}),me._custom_skin=null,MMD_SA._custom_skin=[];var Tt=pe.adjustment_per_model&&(pe.adjustment_per_model[me._filename]||pe.adjustment_per_model[me._filename_cleaned]||pe.adjustment_per_model._default_);if(Tt&&Tt.skin_default)for(var Pe in Tt.skin_default){var Ce=Tt.skin_default[Pe];if(Ce.pos_scale&&Ce.pos_scale.auto_adjust&&-1!=Pe.indexOf("\u8DB3\uFF29\uFF2B")&&me._ref_length&&me._ref_length[Pe]){var Ct=MMD_SA.get_bone_position(de,Pe),It=MMD_SA.get_bone_position(de,Pe.substring(0,2)),Ut=It.sub(Ct).setY(0).multiplyScalar(1-((me._ref_length[Pe]/Ce.pos_scale.auto_adjust.ref_length-1)*(Ce.pos_scale.auto_adjust.scale||1)+1));de.bones_by_name[Pe].position.sub(Ut)}}}this._update_IK_and_AddTrans(),self.MMD_SA&&MMD_SA_options.model_para_obj_all.forEach(function(Lt,zt){if(zt!=_e._model_index){var Ft=Lt.bone_connection;if(Ft&&Ft.target_model_index==_e._model_index){var Rt=MMD_SA.get_bone_position(de,Ft.target_bone_name),Vt=MMD_SA.get_bone_rotation(de,Ft.target_bone_name);Ft.position&&Rt.add(MMD_SA.TEMP_v3.set(-Ft.position.x,Ft.position.y,-Ft.position.z).applyQuaternion(Vt)),Ft.rotation&&(!Ft.rotation._quaternion&&(Ft.rotation._quaternion=new THREE.Quaternion().setFromEuler(MMD_SA.TEMP_v3.set(Ft.rotation.x*Math.PI/180,-Ft.rotation.y*Math.PI/180,Ft.rotation.z*Math.PI/180))),Vt.multiply(Ft.rotation._quaternion)),Lt._custom_skin=[{key:{name:Ft.self_bone_name,pos:Rt.toArray(),rot:Vt.toArray(),interp:MMD_SA._skin_interp_default},idx:THREE.MMD.getModels()[zt].mesh.bones_by_name[Ft.self_bone_name]._index}]}}}),this.checkCallback()}},X.prototype.seekMotion=function(ne,se){this.resetBones(),this.morph&&this.morph.seek(ne,se),this.skin&&this.skin.seek(ne,se),this._update_IK_and_AddTrans(),this.checkCallback()},X.prototype.playMotion=function(ne){this.morph&&(this.morph.play(ne),this.morph_MMD_SA_extra&&this.morph_MMD_SA_extra.forEach(function(se){se._MMD_SA_disabled||se.play(ne)})),this.skin&&(this.skin.play(ne),this.skin_MMD_SA_extra&&this.skin_MMD_SA_extra.forEach(function(se){se._MMD_SA_disabled||se.play(ne)}))},X.prototype.pauseMotion=function(){this.morph&&(this.morph.pause(),this.morph_MMD_SA_extra&&this.morph_MMD_SA_extra.forEach(function(ne){ne._MMD_SA_disabled||ne.pause()})),this.skin&&(this.skin.pause(),this.skin_MMD_SA_extra&&this.skin_MMD_SA_extra.forEach(function(ne){ne._MMD_SA_disabled||ne.pause()}))},X.prototype.preSimulate=function(){this.physi&&this.physi.preSimulate()},X.prototype.postSimulate=function(){this.physi&&this.physi.postSimulate()},X.prototype.dispose=function(){this.physi&&this.physi.dispose(),this.mesh&&this.mesh.dispose(),this.init()},X.prototype.checkCallback=function(){this._onmotionended&&(this._onmotionended(this),this._onmotionended=null)}})();var ae=[],oe,re;(function(){var ie,ne,se,de,_e,le,me,pe,ce,fe;oe=[],ie=!1,ne=!1,se=0,de=0,_e=!1,le=!0,pe={render:function(ue){var he;ee.targetScene&&ee.targetScene!==ue||(ee.motionPlaying||_e||le?(_e=!1,he=se):he=0,ee.simulate(he))}},fe=function(){ce&&(ce(),ce=void 0)},ee={addModel:function(ue){ue._model_index=ue.pmx._model_index,oe.push(ue)},removeModel:function(ue){var he;he=oe.indexOf(ue),0<=he&&oe.splice(he,1)},getModels:function(){return oe},swapModels:function(ue,he,Me){[ue,he].forEach(function(be){var Se=oe[be],De=be==ue?he:ue;for(var ke in Se._model_index=Se.mesh._model_index=Se.pmx._model_index=De,Se.morph_MMD_SA_extra&&Se.morph_MMD_SA_extra.forEach(function(we){we._model_index=De}),Se.skin_MMD_SA_extra&&Se.skin_MMD_SA_extra.forEach(function(we){we._model_index=De}),Se._MMD_SA_cache){var Ee=Se._MMD_SA_cache[ke];Ee.morph&&(Ee.morph._model_index=De),Ee.skin&&(Ee.skin._model_index=De)}});var ge,ye;ge=oe[ue],ye=oe[he],oe[ue]=ye,oe[he]=ge,ge=MMD_SA_options.model_para_obj_all[ue],ye=MMD_SA_options.model_para_obj_all[he],MMD_SA_options.model_para_obj_all[ue]=ye,MMD_SA_options.model_para_obj_all[he]=ge,MMD_SA_options.model_para_obj_all[ue]._model_index=ue,MMD_SA_options.model_para_obj_all[he]._model_index=he,ge=MMD_SA_options.mesh_obj_by_id["mikuPmx"+ue],ye=MMD_SA_options.mesh_obj_by_id["mikuPmx"+he],MMD_SA_options.mesh_obj_by_id["mikuPmx"+ue]=ye,MMD_SA_options.mesh_obj_by_id["mikuPmx"+he]=ge,MMD_SA.ammo_proxy&&["cache_by_model","cache_by_model_next","cache_by_model_temp"].forEach(function(be){ge=MMD_SA.ammo_proxy[be].list[ue],ye=MMD_SA.ammo_proxy[be].list[he],MMD_SA.ammo_proxy[be].list[ue]=ye,MMD_SA.ammo_proxy[be].list[he]=ge});var xe={},Ae={},ve=["position","rotation","quaternion"];ve.forEach(function(be){xe[be]=oe[ue].mesh[be].clone(),Ae[be]=oe[he].mesh[be].clone()}),Me&&Me(ue,he),ve.forEach(function(be){oe[ue].mesh[be].copy(Ae[be]),oe[he].mesh[be].copy(xe[be])}),0==ue&&(MMD_SA_options.model_para_obj=MMD_SA_options.model_para_obj_all[0],oe[0].mesh.visible=!0,oe[0].mesh.children.forEach(function(be){be.visible=!0}))},setupCameraMotion:function(ue,he){var Me=ue.generateCameraAnimation(),ge,ye;ae.forEach(function(xe,Ae){xe.persepectiveCamera===he&&(ye=Ae)}),isFinite(ye)&&ae.splice(ye,1),Me&&(ge=new W(he,Me),ae.push(ge),ge.vmd=ue)},getCameraMotion:function(){return ae},setupLightMotion:function(ue,he){var Me;Me=ue.generateLightAnimation(),Me?(re=new K(he,Me),re.vmd=ue):re=void 0},getLightMotion:function(){return re},adjustMotionDuration:function(){var ue=jThree.MMD._duration;ae.forEach(function(he){ue=Math.max(ue,he.duration)}),re&&(ue=Math.max(ue,re.duration)),oe.forEach(function(he){0<he._model_index||(he.skin&&(ue=Math.max(ue,he.skin.duration_default)),he.morph&&(ue=Math.max(ue,he.morph.duration_default)))}),ae.forEach(function(he){he.adjustDuration(ue)}),re&&re.adjustDuration(ue),oe.forEach(function(he){0<he._model_index||(he.skin&&he.skin.adjustDuration(ue),he.morph&&he.morph.adjustDuration(ue))})},resetMotion:function(){ae.forEach(function(ue){ue.reset()}),re&&re.reset(),oe.forEach(function(ue){ue.resetMotion()}),de=0},updateMotion:function(ue,he){se=ue;(he||ie)&&(ae.forEach(function(Me){Me.update(ue,he)}),re&&re.update(ue,he),oe.forEach(function(Me){Me.updateMotion(ue,he)}),window.dispatchEvent(new CustomEvent("SA_MMD_model_all_process_bones")),fe(),de+=ue)},seekMotion:function(ue,he){(he||ie)&&(ae.forEach(function(Me){Me.seek(ue,he)}),re&&re.seek(ue,he),oe.forEach(function(Me){Me.seekMotion(ue,he)}),fe(),_e=!0,de=ue)},playMotion:function(ue){var he;he=this,ue!==void 0&&(ne=ue),ae.forEach(function(Me){Me.play(ne)}),re&&re.play(ne),oe.forEach(function(Me){Me.playMotion(ne)}),0<oe.length&&(oe[0].onmotionended=function(){ne?de=0:he.pauseMotion(),ce=ee.onmotionended}),ie=!0},pauseMotion:function(ue){le=ue,ae.forEach(function(he){he.pause()}),re&&re.pause(),oe.forEach(function(he){he.pauseMotion()}),ie=!1},adjustCameraOffset:function(ue){var he,Me,ge;ue?(he=ue.model,Me=ue.offset):0<oe.length&&(he=oe[0]),he&&(ge=he.mesh.geometry.boundingBox.size()),ae.offset.set(0,0,0),ge&&(ae.offset.y=ge.y-20),Me&&ae.offset.addVectors(ae.offset,Me)},getWorld:function(){return Q},setGravity:function(ue,he,Me){Q.setGravity(Y(ue,he,Me))},simulate:function(ue,he){var Me=ue;self.MMD_SA&&MMD_SA.ammo_proxy&&MMD_SA.ammo_proxy.lock("stepSimulation");performance.now();if(0!==oe.length){if(0>=ue);else{if(self.MMD_SA){if(MMD_SA._motionTime_last==THREE.MMD.motionTime)return;MMD_SA._motionTime_last=THREE.MMD.motionTime,ue+=MMD_SA.ammo_proxy&&MMD_SA.ammo_proxy._timeStep||0}ue<Z&&(ue=Z),he=he||Math.ceil(ue/Z),self.MMD_SA&&(he=Math.min(Math.ceil(ue/Z),MMD_SA_options.model_para_obj.physics_maxSubSteps||MMD_SA_options.physics_maxSubSteps||9)),oe.forEach(function(ye){ye.visible&&ye.preSimulate()}),Q&&Q.stepSimulation(ue,he,Z),oe.forEach(function(ye){ye.visible&&ye.postSimulate()}),self.MMD_SA&&(MMD_SA.ammo_proxy&&(MMD_SA.ammo_proxy.update_worker("stepSimulation")?(MMD_SA.ammo_proxy.cache_by_model_temp.transfer_to("cache_by_model_next"),MMD_SA.ammo_proxy._timeStep=0):(MMD_SA.ammo_proxy._timeStep+=Me,MMD_SA.ammo_proxy.reset())),MMD_SA.physicsHelper&&MMD_SA.physicsHelper.update())}oe.forEach(function(ye){ye.simulateCallback&&ye.simulateCallback()})}},init:function(ue,he){ee.targetScene=he,ee.targetRenderer=ue},targetScene:null,get targetRenderer(){return me},set targetRenderer(ue){me!==ue&&(me=ue,-1===ue.renderPluginsPre.indexOf(pe)&&ue.renderPluginsPre.unshift(pe))},get motionPlaying(){return ie},get motionLoop(){return ne},get motionDelta(){return se},get motionTime(){return de},onmotionended:null,minKeyDelta:1/30+1/60,STOP_ERP:0.475,PMX:P,VMD:T,Model:X}})(),THREE.MMD=ee,THREE.Mesh.prototype.dispose=function(){function ie(ne){var se,de;for(de in ne)se=ne[de],se instanceof THREE.Texture&&se.dispose()}this.material.materials?this.material.materials.forEach(function(ne){ie(ne),ne.dispose()}):(ie(this.material),this.material.dispose()),this.geometry.dispose()},jThree._ammo_async_init_.push(function(){if(window.Ammo&&ee.setGravity(0,-98,0),window.Ammo){var ie=new Ammo.btVector3,ne=new Ammo.btTransform,se,de,_e,le;ie.setValue(0,1,0),se=new Ammo.btStaticPlaneShape(ie,0),de=new Ammo.btVector3(0,0,0),se.calculateLocalInertia(0,de),ne.setIdentity(),_e=new Ammo.btRigidBodyConstructionInfo(0,new Ammo.btDefaultMotionState(ne),se,de),self.MMD_SA&&!MMD_SA_options.ground_physics_disabled&&(le=new Ammo.btRigidBody(_e),Q.addRigidBody(le),jThree.MMD._ground=le.getWorldTransform().getOrigin(),MMD_SA_options.ground_y&&jThree.MMD._ground.setY(MMD_SA_options.ground_y)),Ammo.destroy(_e),Ammo.destroy(de),Ammo.destroy(ne),Ammo.destroy(ie)}self.MMD_SA&&MMD_SA.ammo_proxy&&MMD_SA.ammo_proxy.update_worker()}),self.MMD_SA&&MMD_SA_options.ammo_version&&!MMD_SA._ammo_async_loaded_||(jThree._ammo_async_init_.forEach(function(ie){ie()}),jThree._ammo_async_init_=[]),jThree.modelHooks.pmx=function(ie,ne){new P().load(ie,function(se){ne(se),ne=null})},jThree.motionHooks.vmd=function(ie,ne){new T().load(ie,function(se){ne(se),ne=null})},jThree.mmdHook=function(ie,ne,se){var de=jThree.three(this),_e;if(/(\d+)$/.test(this.getAttribute("model"))&&(_e=parseInt(RegExp.$1)),!ne)(function(){var me=_e;MMD_SA.fn._model_creation_timerID[me]=setInterval(function(){MMD_SA.fn._ready_for_model_creation[me]&&(new THREE.MMD.Model(ie).create(jThree.MMD,function(pe){var ce=pe.mesh;de.__mmd=pe,ce.material.materials.forEach(function(Me){Me.fog=!0,Me.lights=!0}),de.addEventListener("removed",d),THREE.MMD.addModel(pe),se(ce),de=se=null;var fe=MMD_SA_options.model_para_obj_all[ie._model_index],ue=fe.position_loading;if(!ue){var he=fe.skin_default.;ue=he&&(he.pos||he.pos_add||he.pos_add_absolute),ue&&(ue==he.pos||ue==he.pos_add)&&he.pos_add_absolute&&(ue={x:ue.x+he.pos_add_absolute.x,y:ue.y+he.pos_add_absolute.y,z:ue.z+he.pos_add_absolute.z})}ue&&ce.position.set(ue.x,ue.y,ue.z)}),clearInterval(MMD_SA.fn._model_creation_timerID[me]),MMD_SA.fn._model_creation_timerID[me]=null,setTimeout("MMD_SA.fn.setupUI()",0))},500)})();else{function me(ce){var fe=jThree.three(this)._srcObj||(self.MMD_SA&&this._id?MMD_SA._j3_obj_by_id[this._id]:null);(function(){var ue=_e;MMD_SA.fn._model_creation_timerID[ue]=setInterval(function(){MMD_SA.fn._ready_for_model_creation[ue]&&(new THREE.MMD.Model(ie,fe).create(jThree.MMD,function(he){var Me=he.mesh;de.__mmd=he,Me.material.materials.forEach(function(Ae){Ae.fog=!0,Ae.lights=!0}),de.addEventListener("removed",d),THREE.MMD.addModel(he),THREE.MMD.adjustMotionDuration(),se(Me),de=se=null;var ge=MMD_SA_options.model_para_obj_all[ie._model_index],ye=ge.skin_default.,xe=ge.position_loading||ye&&(ye.pos||ye.pos_add);xe&&Me.position.set(xe.x,xe.y,xe.z)}),clearInterval(MMD_SA.fn._model_creation_timerID[ue]),MMD_SA.fn._model_creation_timerID[ue]=null,setTimeout("MMD_SA.fn.setupUI()",0))},500)})(),ce&&($.event.remove(this,"load",me),$.event.remove(this,"error",pe)),le=null}function pe(){$.event.remove(this,"load",me),$.event.remove(this,"error",pe),$.event.trigger("error",void 0,le),le=de=se=null}var le=this;switch(ne.attr("loadStates")){case"loading":ne.load(me),ne.error(pe);break;case"success":me.call(ne);break;default:$.event.trigger("error",void 0,this);}}},jThree.otherMmdHook=function(ie){function ne(le){var me=THREE.MMD["setup"+("CAMERA"===de.tagName?"Camera":"Light")+"Motion"],pe=jThree.three(de),ce=jThree.three(this)._srcObj;me(ce,pe),THREE.MMD.adjustMotionDuration(),$.event.trigger("load",void 0,de),le&&($.event.remove(this,"load",ne),$.event.remove(this,"error",se)),de=null}function se(){$.event.remove(this,"load",ne),$.event.remove(this,"error",se),$.event.trigger("error",void 0,de),de=null}var de=this;switch(ie.attr("loadStates")){case"loading":ie.load(ne),ie.error(se);break;case"success":ne.call(ie[0]);break;default:if("CAMERA"===this.tagName){var _e=jThree.three(this);ae.forEach(function(le,me){le.persepectiveCamera===_e&&ae.splice(me,1)}),_e=null}else re=null;$.event.trigger("load",void 0,this);}},jThree.MMD._simulate={render:function(){motionSeek=!1,self.MMD_SA?ee.simulate(ee.motionPlaying||motionSeek?ee.motionDelta/(MMD_SA._playbackRate*MMD_SA.playbackRate):0):ee.simulate(ee.motionPlaying||motionSeek?ee.motionDelta:0)}},jThree.MMD.seek=THREE.MMD.seekMotion}(),THREE.MMDPhysicsHelper=function(d){THREE.Object3D.call(this),this.root=d,this.matrix=d.matrixWorld,this.matrixAutoUpdate=!1,this.materials=[],this.materials.push(new THREE.MeshBasicMaterial({color:new THREE.Color(16746632),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:0.25,transparent:!0})),this.materials.push(new THREE.MeshBasicMaterial({color:new THREE.Color(8978312),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:0.25,transparent:!0})),this.materials.push(new THREE.MeshBasicMaterial({color:new THREE.Color(8947967),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:0.25,transparent:!0})),this._init(),this.update()},THREE.MMDPhysicsHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.MMDPhysicsHelper.prototype.constructor=THREE.MMDPhysicsHelper,THREE.MMDPhysicsHelper.prototype._init=function(){function d(D){switch(D.shape){case 0:return new THREE.SphereGeometry(D.size[0],16,8);case 1:return new THREE.CubeGeometry(2*D.size[0],2*D.size[1],2*D.size[2],8,8,8);case 2:return _(D.size[0],D.size[1],16,8);default:return null;}}function _(D,E,P,T){var C=new THREE.CylinderGeometry(D,D,E,P,T,!0);return C}for(var u=this.root,M=u.MMDrigids,g=0,A=M.length,S;g<A;g++){S=M[g];let D=new THREE.Mesh(d(S),this.materials[S.type]);D.useQuaternion=!0,this.add(D)}},THREE.MMDPhysicsHelper.prototype.update=function(){function d(I){return A.set(I.x(),I.y(),I.z()),A.applyMatrix4(g),A}function _(I){return S.set(I.x(),I.y(),I.z(),I.w()),D.setFromRotationMatrix(g),D.multiply(S),D}for(var u=this.root,M=u.MMDrigids,g=new THREE.Matrix4().getInverse(u.matrixWorld),A=new THREE.Vector3,S=new THREE.Quaternion,D=new THREE.Quaternion,E=0,P=M.length;E<P;E++){var T=M[E].body,u=this.children[E],C=T.getCenterOfMassTransform();u.position.copy(d(C.getOrigin())),u.quaternion.copy(_(C.getRotation()))}this.updateMatrix()},function(){"use strict";var d="?".charCodeAt(0),_={SJISToUTF8:function(M){for(var g=[],A=M.length,S=0,D,E,P,T,C,I;S<A;S++)161<=M[S]&&223>=M[S]?(E=M[S]-64,P=188|3&E>>6,T=128|63&E,g[g.length]=239,g[g.length]=P,g[g.length]=T):128<=M[S]?(D=M[S]<<1,E=M[++S],159>E?(D-=319>D?225:97,E-=126<E?32:31):(D-=319>D?224:96,E-=126),D&=255,C=(D<<8)+E,void 0===u[C]?g[g.length]=d:(I=u[C],65535>I?(g[g.length]=255&I>>8,g[g.length]=255&I):(g[g.length]=255&I>>16,g[g.length]=255&I>>8,g[g.length]=255&I))):g[g.length]=M[S];return g},UTF8ToUNICODE:function(M){for(var g=[],A=0,S=M.length,D,E,P,T,C;A<S;)E=M[A++],D=E>>4,0<=D&&7>=D?g[g.length]=E:12<=D&&13>=D?(P=M[A++],g[g.length]=(31&E)<<6|63&P):14===D?(P=M[A++],T=M[A++],g[g.length]=(15&E)<<12|(63&P)<<6|(63&T)<<0):A+2<S&&(P=M[A++],T=M[A++],C=M[A++],g[g.length]=(7&E)<<18|(63&P)<<12|(63&T)<<6|(63&C)<<0);return g},SJISToUNICODE:function(M){return _.UTF8ToUNICODE(_.SJISToUTF8(M))}},u={8481:14909568,8482:14909569,8483:14909570,8484:15711372,8485:15711374,8486:14910395,8487:15711386,8488:15711387,8489:15711391,8490:15711361,8491:14910107,8492:14910108,8493:49844,8494:15711616,8495:49832,8496:15711422,8497:15712163,8498:15711423,8499:14910397,8500:14910398,8501:14910109,8502:14910110,8503:14909571,8504:14990237,8505:14909573,8506:14909574,8507:14909575,8508:14910396,8509:14844053,8510:14844048,8511:15711375,8512:15711420,8513:15711646,8514:14844054,8515:15711644,8516:14844070,8517:14844069,8518:14844056,8519:14844057,8520:14844060,8521:14844061,8522:15711368,8523:15711369,8524:14909588,8525:14909589,8526:15711419,8527:15711421,8528:15711643,8529:15711645,8530:14909576,8531:14909577,8532:14909578,8533:14909579,8534:14909580,8535:14909581,8536:14909582,8537:14909583,8538:14909584,8539:14909585,8540:15711371,8541:15711373,8542:49841,8543:50071,8544:50103,8545:15711389,8546:14846368,8547:15711388,8548:15711390,8549:14846374,8550:14846375,8551:14846110,8552:14846132,8553:14850434,8554:14850432,8555:49840,8556:14844082,8557:14844083,8558:14845059,8559:15712165,8560:15711364,8561:15712160,8562:15712161,8563:15711365,8564:15711363,8565:15711366,8566:15711370,8567:15711392,8568:49831,8569:14850182,8570:14850181,8571:14849931,8572:14849935,8573:14849934,8574:14849927,8737:14849926,8738:14849697,8739:14849696,8740:14849715,8741:14849714,8742:14849725,8743:14849724,8744:14844091,8745:14909586,8746:14845586,8747:14845584,8748:14845585,8749:14845587,8750:14909587,8762:14846088,8763:14846091,8764:14846598,8765:14846599,8766:14846594,8767:14846595,8768:14846122,8769:14846121,8778:14846119,8779:14846120,8780:49836,8781:14845842,8782:14845844,8783:14846080,8784:14846083,8796:14846112,8797:14846629,8798:14847122,8799:14846082,8800:14846087,8801:14846369,8802:14846354,8803:14846378,8804:14846379,8805:14846106,8806:14846141,8807:14846109,8808:14846133,8809:14846123,8810:14846124,8818:14845099,8819:14844080,8820:14850479,8821:14850477,8822:14850474,8823:14844064,8824:14844065,8825:49846,8830:14849967,9008:15711376,9009:15711377,9010:15711378,9011:15711379,9012:15711380,9013:15711381,9014:15711382,9015:15711383,9016:15711384,9017:15711385,9025:15711393,9026:15711394,9027:15711395,9028:15711396,9029:15711397,9030:15711398,9031:15711399,9032:15711400,9033:15711401,9034:15711402,9035:15711403,9036:15711404,9037:15711405,9038:15711406,9039:15711407,9040:15711408,9041:15711409,9042:15711410,9043:15711411,9044:15711412,9045:15711413,9046:15711414,9047:15711415,9048:15711416,9049:15711417,9050:15711418,9057:15711617,9058:15711618,9059:15711619,9060:15711620,9061:15711621,9062:15711622,9063:15711623,9064:15711624,9065:15711625,9066:15711626,9067:15711627,9068:15711628,9069:15711629,9070:15711630,9071:15711631,9072:15711632,9073:15711633,9074:15711634,9075:15711635,9076:15711636,9077:15711637,9078:15711638,9079:15711639,9080:15711640,9081:15711641,9082:15711642,9249:14909825,9250:14909826,9251:14909827,9252:14909828,9253:14909829,9254:14909830,9255:14909831,9256:14909832,9257:14909833,9258:14909834,9259:14909835,9260:14909836,9261:14909837,9262:14909838,9263:14909839,9264:14909840,9265:14909841,9266:14909842,9267:14909843,9268:14909844,9269:14909845,9270:14909846,9271:14909847,9272:14909848,9273:14909849,9274:14909850,9275:14909851,9276:14909852,9277:14909853,9278:14909854,9279:14909855,9280:14909856,9281:14909857,9282:14909858,9283:14909859,9284:14909860,9285:14909861,9286:14909862,9287:14909863,9288:14909864,9289:14909865,9290:14909866,9291:14909867,9292:14909868,9293:14909869,9294:14909870,9295:14909871,9296:14909872,9297:14909873,9298:14909874,9299:14909875,9300:14909876,9301:14909877,9302:14909878,9303:14909879,9304:14909880,9305:14909881,9306:14909882,9307:14909883,9308:14909884,9309:14909885,9310:14909886,9311:14909887,9312:14910080,9313:14910081,9314:14910082,9315:14910083,9316:14910084,9317:14910085,9318:14910086,9319:14910087,9320:14910088,9321:14910089,9322:14910090,9323:14910091,9324:14910092,9325:14910093,9326:14910094,9327:14910095,9328:14910096,9329:14910097,9330:14910098,9331:14910099,9505:14910113,9506:14910114,9507:14910115,9508:14910116,9509:14910117,9510:14910118,9511:14910119,9512:14910120,9513:14910121,9514:14910122,9515:14910123,9516:14910124,9517:14910125,9518:14910126,9519:14910127,9520:14910128,9521:14910129,9522:14910130,9523:14910131,9524:14910132,9525:14910133,9526:14910134,9527:14910135,9528:14910136,9529:14910137,9530:14910138,9531:14910139,9532:14910140,9533:14910141,9534:14910142,9535:14910143,9536:14910336,9537:14910337,9538:14910338,9539:14910339,9540:14910340,9541:14910341,9542:14910342,9543:14910343,9544:14910344,9545:14910345,9546:14910346,9547:14910347,9548:14910348,9549:14910349,9550:14910350,9551:14910351,9552:14910352,9553:14910353,9554:14910354,9555:14910355,9556:14910356,9557:14910357,9558:14910358,9559:14910359,9560:14910360,9561:14910361,9562:14910362,9563:14910363,9564:14910364,9565:14910365,9566:14910366,9567:14910367,9568:14910368,9569:14910369,9570:14910370,9571:14910371,9572:14910372,9573:14910373,9574:14910374,9575:14910375,9576:14910376,9577:14910377,9578:14910378,9579:14910379,9580:14910380,9581:14910381,9582:14910382,9583:14910383,9584:14910384,9585:14910385,9586:14910386,9587:14910387,9588:14910388,9589:14910389,9590:14910390,9761:52881,9762:52882,9763:52883,9764:52884,9765:52885,9766:52886,9767:52887,9768:52888,9769:52889,9770:52890,9771:52891,9772:52892,9773:52893,9774:52894,9775:52895,9776:52896,9777:52897,9778:52899,9779:52900,9780:52901,9781:52902,9782:52903,9783:52904,9784:52905,9793:52913,9794:52914,9795:52915,9796:52916,9797:52917,9798:52918,9799:52919,9800:52920,9801:52921,9802:52922,9803:52923,9804:52924,9805:52925,9806:52926,9807:52927,9808:53120,9809:53121,9810:53123,9811:53124,9812:53125,9813:53126,9814:53127,9815:53128,9816:53129,10017:53392,10018:53393,10019:53394,10020:53395,10021:53396,10022:53397,10023:53377,10024:53398,10025:53399,10026:53400,10027:53401,10028:53402,10029:53403,10030:53404,10031:53405,10032:53406,10033:53407,10034:53408,10035:53409,10036:53410,10037:53411,10038:53412,10039:53413,10040:53414,10041:53415,10042:53416,10043:53417,10044:53418,10045:53419,10046:53420,10047:53421,10048:53422,10049:53423,10065:53424,10066:53425,10067:53426,10068:53427,10069:53428,10070:53429,10071:53649,10072:53430,10073:53431,10074:53432,10075:53433,10076:53434,10077:53435,10078:53436,10079:53437,10080:53438,10081:53439,10082:53632,10083:53633,10084:53634,10085:53635,10086:53636,10087:53637,10088:53638,10089:53639,10090:53640,10091:53641,10092:53642,10093:53643,10094:53644,10095:53645,10096:53646,10097:53647,10273:14849152,10274:14849154,10275:14849164,10276:14849168,10277:14849176,10278:14849172,10279:14849180,10280:14849196,10281:14849188,10282:14849204,10283:14849212,10284:14849153,10285:14849155,10286:14849167,10287:14849171,10288:14849179,10289:14849175,10290:14849187,10291:14849203,10292:14849195,10293:14849211,10294:14849419,10295:14849184,10296:14849199,10297:14849192,10298:14849207,10299:14849215,10300:14849181,10301:14849200,10302:14849189,10303:14849208,10304:14849410,11553:14848416,11554:14848417,11555:14848418,11556:14848419,11557:14848420,11558:14848421,11559:14848422,11560:14848423,11561:14848424,11562:14848425,11563:14848426,11564:14848427,11565:14848428,11566:14848429,11567:14848430,11568:14848431,11569:14848432,11570:14848433,11571:14848434,11572:14848435,11573:14845344,11574:14845345,11575:14845346,11576:14845347,11577:14845348,11578:14845349,11579:14845350,11580:14845351,11581:14845352,11582:14845353,11584:14912905,11585:14912660,11586:14912674,11587:14912909,11588:14912664,11589:14912679,11590:14912643,11591:14912694,11592:14912913,11593:14912919,11594:14912653,11595:14912678,11596:14912675,11597:14912683,11598:14912906,11599:14912699,11600:14913180,11601:14913181,11602:14913182,11603:14913166,11604:14913167,11605:14913412,11606:14913185,11615:14912955,11616:14909597,11617:14909599,11618:14845078,11619:14913421,11620:14845089,11621:14912164,11622:14912165,11623:14912166,11624:14912167,11625:14912168,11626:14911665,11627:14911666,11628:14911673,11629:14912958,11630:14912957,11631:14912956,11635:14846126,11636:14846097,11640:14846111,11641:14846655,12321:14989980,12322:15045782,12323:15050883,12324:15308991,12325:15045504,12326:15107227,12327:15109288,12328:15050678,12329:15302818,12330:15241653,12331:15240348,12332:15182224,12333:15106730,12334:15110049,12335:15120549,12336:15112109,12337:15241638,12338:15239846,12339:15314869,12340:15114899,12341:15047847,12342:15111841,12343:15108529,12344:15052443,12345:15050640,12346:15243707,12347:15311796,12348:15185314,12349:15185598,12350:15314574,12351:15108246,12352:15184543,12353:15246007,12354:15052425,12355:15055541,12356:15109257,12357:15112855,12358:15114632,12359:15308679,12360:15310477,12361:15113615,12362:14990245,12363:14990474,12364:14990733,12365:14991005,12366:15040905,12367:15047602,12368:15049911,12369:15050644,12370:15050881,12371:15052937,12372:15106975,12373:15107215,12374:15107504,12375:15112339,12376:15115397,12377:15172282,12378:15177103,12379:15177136,12380:15181755,12381:15185581,12382:15185839,12383:15238019,12384:15241358,12385:15245731,12386:15248514,12387:15303061,12388:15303098,12389:15043771,12390:14989973,12391:14989989,12392:15048607,12393:15237810,12394:15303553,12395:15180719,12396:14989440,12397:15049649,12398:15121058,12399:15302840,12400:15182002,12401:15240360,12402:15239819,12403:15315119,12404:15041921,12405:15044016,12406:15045309,12407:15045537,12408:15047584,12409:15050683,12410:15056021,12411:15311794,12412:15120299,12413:15238052,12414:15242413,12577:15309218,12578:15309232,12579:15309472,12580:15310779,12581:15044747,12582:15044531,12583:15052423,12584:15172495,12585:15187645,12586:15253378,12587:15309736,12588:15044015,12589:15316380,12590:15182522,12591:14989457,12592:15180435,12593:15239100,12594:15120550,12595:15046808,12596:15045764,12597:15117469,12598:15242394,12599:15315131,12600:15050661,12601:15044265,12602:15119782,12603:15176604,12604:15308431,12605:15047042,12606:14989969,12607:15303051,12608:15309746,12609:15240591,12610:15312012,12611:15044513,12612:15046326,12613:15051952,12614:15056305,12615:15112352,12616:15113139,12617:15114372,12618:15118520,12619:15119283,12620:15119529,12621:15176091,12622:15178632,12623:15182222,12624:15311028,12625:15240113,12626:15245723,12627:15247776,12628:15305645,12629:15120050,12630:15177387,12631:15178634,12632:15312773,12633:15106726,12634:15248513,12635:15251082,12636:15308466,12637:15115918,12638:15044269,12639:15042182,12640:15047826,12641:15048880,12642:15050116,12643:15052468,12644:15055798,12645:15106216,12646:15109801,12647:15110068,12648:15119039,12649:15121556,12650:15172238,12651:15172756,12652:15173017,12653:15173525,12654:15174847,12655:15186049,12656:15239606,12657:15240081,12658:15242903,12659:15303072,12660:15305115,12661:15316123,12662:15049129,12663:15111868,12664:15118746,12665:15176869,12666:15042489,12667:15049902,12668:15050149,12669:15056512,12670:15056796,12833:15108796,12834:15112122,12835:15116458,12836:15117479,12837:15118004,12838:15175307,12839:15187841,12840:15246742,12841:15316140,12842:15316110,12843:15317892,12844:15053473,12845:15118998,12846:15240635,12847:15041668,12848:15053195,12849:15107766,12850:15239046,12851:15114678,12852:15174049,12853:14989721,12854:14991290,12855:15044024,12856:15106473,12857:15120553,12858:15182223,12859:15310771,12860:14989451,12861:15043734,12862:14990254,12863:14990741,12864:14990525,12865:14991009,12866:14990771,12867:15043232,12868:15044527,12869:15046793,12870:15049871,12871:15051649,12872:15052470,12873:15052705,12874:15181713,12875:15112839,12876:15113884,12877:15113910,12878:15117708,12879:15119027,12880:15172011,12881:15175554,12882:15181453,12883:15181502,12884:15182012,12885:15183495,12886:15239857,12887:15240091,12888:15240324,12889:15240631,12890:15241135,12891:15241107,12892:15244710,12893:15248050,12894:15046825,12895:15250088,12896:15253414,12897:15303054,12898:15309982,12899:15243914,12900:14991236,12901:15053736,12902:15108241,12903:15174041,12904:15176891,12905:15239077,12906:15239869,12907:15244222,12908:15250304,12909:15309701,12910:15312019,12911:15312789,12912:14990219,12913:14990490,12914:15247267,12915:15047582,12916:15049098,12917:15049610,12918:15055803,12919:15056811,12920:15106218,12921:15106708,12922:15106466,12923:15107984,12924:15108242,12925:15109008,12926:15111353,13089:15314305,13090:15112614,13091:15114928,13092:15119799,13093:15172016,13094:15177100,13095:15178374,13096:15185333,13097:15239845,13098:15245241,13099:15308427,13100:15309454,13101:15250077,13102:15042481,13103:15043262,13104:15049878,13105:15045299,13106:15052467,13107:15053974,13108:15107496,13109:15115906,13110:15120047,13111:15180429,13112:15242123,13113:15245719,13114:15247794,13115:15306407,13116:15313592,13117:15119788,13118:15312552,13119:15244185,13120:15048355,13121:15114175,13122:15244174,13123:15304846,13124:15043203,13125:15047303,13126:15044740,13127:15055763,13128:15109025,13129:15110841,13130:15114428,13131:15114424,13132:15118011,13133:15175090,13134:15180474,13135:15182251,13136:15247002,13137:15247250,13138:15250859,13139:15252611,13140:15303597,13141:15308451,13142:15309460,13143:15310249,13144:15052198,13145:15053491,13146:15115709,13147:15311245,13148:15311246,13149:15109787,13150:15183008,13151:15116459,13152:15116735,13153:15114934,13154:15315085,13155:15121823,13156:15042994,13157:15046301,13158:15106480,13159:15109036,13160:15119547,13161:15120519,13162:15121297,13163:15241627,13164:15246480,13165:15252868,13166:14989460,13167:15315129,13168:15044534,13169:15115419,13170:15116474,13171:15310468,13172:15114410,13173:15041948,13174:15182723,13175:15241906,13176:15304604,13177:15306380,13178:15047067,13179:15316136,13180:15114402,13181:15240325,13182:15241393,13345:15184549,13346:15042696,13347:15240069,13348:15176614,13349:14989758,13350:14990979,13351:15042208,13352:15052690,13353:15042698,13354:15043480,13355:15043495,13356:15054779,13357:15046298,13358:15048874,13359:15050662,13360:15052428,13361:15052440,13362:15052699,13363:15055282,13364:15055289,13365:15106723,13366:15107231,13367:15107491,13368:15107774,13369:15110043,13370:15111586,13371:15114129,13372:15114643,13373:15115194,13374:15117502,13375:15117715,13376:15118743,13377:15121570,13378:15122071,13379:15121797,13380:15176368,13381:15176856,13382:15178659,13383:15178891,13384:15182783,13385:15183521,13386:15184033,13387:15185833,13388:15187126,13389:15187888,13390:15237789,13391:15239590,13392:15240862,13393:15247027,13394:15248268,13395:15250091,13396:15303300,13397:15307153,13398:15308435,13399:15308433,13400:15308450,13401:15309221,13402:15310739,13403:15312040,13404:15239320,13405:14989496,13406:15044779,13407:15053496,13408:15054732,13409:15175337,13410:15178124,13411:15178940,13412:15053481,13413:15187883,13414:15250571,13415:15309697,13416:15310993,13417:15311252,13418:15311256,13419:14990465,13420:14990478,13421:15044017,13422:15046300,13423:15047080,13424:15048634,13425:15050119,13426:15051913,13427:15052676,13428:15053456,13429:15054988,13430:15055294,13431:15056780,13432:15110062,13433:15113402,13434:15112087,13435:15112098,13436:15113375,13437:15115147,13438:15115140,13601:15116703,13602:15055024,13603:15118213,13604:15118487,13605:15118781,13606:15177151,13607:15181192,13608:15052195,13609:15181952,13610:15185024,13611:15056573,13612:15246991,13613:15247512,13614:15250100,13615:15250871,13616:15252364,13617:15252637,13618:15311778,13619:15313038,13620:15314108,13621:14989952,13622:15040957,13623:15041664,13624:15050387,13625:15052444,13626:15108271,13627:15108736,13628:15111084,13629:15117498,13630:15174304,13631:15177361,13632:15181191,13633:15187625,13634:15245243,13635:15248060,13636:15248816,13637:15109804,13638:15241098,13639:15310496,13640:15044745,13641:15044739,13642:15046315,13643:15114644,13644:15116696,13645:15247792,13646:15179943,13647:15113653,13648:15317901,13649:15044020,13650:15052450,13651:15238298,13652:15243664,13653:15302790,13654:14989464,13655:14989701,13656:14990215,13657:14990481,13658:15044490,13659:15044792,13660:15052462,13661:15056019,13662:15106213,13663:15111569,13664:15113405,13665:15118722,13666:15118770,13667:15119267,13668:15172024,13669:15175811,13670:15182262,13671:15182510,13672:15182984,13673:15185050,13674:15184830,13675:15185318,13676:15112103,13677:15174043,13678:15044283,13679:15053189,13680:15054760,13681:15109010,13682:15109024,13683:15109273,13684:15120544,13685:15243674,13686:15247537,13687:15251357,13688:15305656,13689:15121537,13690:15181478,13691:15314330,13692:14989992,13693:14989995,13694:14989996,13857:14991003,13858:14991008,13859:15041425,13860:15041927,13861:15182774,13862:15041969,13863:15042486,13864:15043988,13865:15043745,13866:15044031,13867:15044523,13868:15046316,13869:15049347,13870:15053729,13871:15056055,13872:15056266,13873:15106223,13874:15106448,13875:15106477,13876:15109279,13877:15111577,13878:15116683,13879:15119233,13880:15174530,13881:15174573,13882:15179695,13883:15238072,13884:15238277,13885:15239304,13886:15242638,13887:15303607,13888:15306657,13889:15310783,13890:15312279,13891:15313306,13892:14990256,13893:15042461,13894:15052973,13895:15112833,13896:15115693,13897:15053184,13898:15113138,13899:15115701,13900:15175305,13901:15114640,13902:15184513,13903:15041413,13904:15043492,13905:15048071,13906:15054782,13907:15305894,13908:15111844,13909:15117475,13910:15117501,13911:15175860,13912:15181441,13913:15181501,13914:15183243,13915:15185802,13916:15239865,13917:15241100,13918:15245759,13919:15246751,13920:15248569,13921:15253393,13922:15304593,13923:15044767,13924:15305344,13925:14989725,13926:15040694,13927:15044517,13928:15043770,13929:15174551,13930:15175318,13931:15179689,13932:15240102,13933:15252143,13934:15312774,13935:15312776,13936:15312786,13937:15041975,13938:15107226,13939:15243678,13940:15046320,13941:15182266,13942:15040950,13943:15052691,13944:15303047,13945:15309445,13946:14989490,13947:15117211,13948:15304615,13949:15053201,13950:15053192,14113:15109784,14114:15182495,14115:15118995,14116:15310260,14117:15252897,14118:15182506,14119:15173258,14120:15309448,14121:15184514,14122:15114391,14123:15186352,14124:15114641,14125:15306156,14126:15043506,14127:15044763,14128:15242923,14129:15247507,14130:15187620,14131:15252365,14132:15303585,14133:15044006,14134:15245960,14135:15181185,14136:14991234,14137:15041214,14138:15042705,14139:15041924,14140:15046035,14141:15047853,14142:15175594,14143:15048331,14144:15050129,14145:15056290,14146:15056516,14147:15106485,14148:15107510,14149:15107495,14150:15107753,14151:15109810,14152:15110330,14153:15111596,14154:15112623,14155:15114626,14156:15120531,14157:15177126,14158:15182013,14159:15184827,14160:15185292,14161:15185561,14162:15186315,14163:15187371,14164:15240334,14165:15240586,14166:15244173,14167:15247496,14168:15247779,14169:15248806,14170:15252413,14171:15311002,14172:15316623,14173:15239864,14174:15253390,14175:15314856,14176:15043207,14177:15108255,14178:15110787,14179:15122304,14180:15309465,14181:15114625,14182:15041169,14183:15117472,14184:15118778,14185:15121812,14186:15182260,14187:15185296,14188:15245696,14189:15247523,14190:15113352,14191:14990262,14192:15040697,14193:15040678,14194:15040933,14195:15041980,14196:15042744,14197:15042979,14198:15046311,14199:15047823,14200:15048837,14201:15051660,14202:15055802,14203:15107762,14204:15108024,14205:15109043,14206:15109554,14369:15115420,14370:15116457,14371:15174077,14372:15174316,14373:15174830,14374:15179924,14375:15180207,14376:15185337,14377:15178892,14378:15237801,14379:15246987,14380:15248537,14381:15250338,14382:15252370,14383:15303075,14384:15306165,14385:15309242,14386:15311253,14387:15313043,14388:15317432,14389:15041923,14390:15044255,14391:15044275,14392:15055291,14393:15056038,14394:15120539,14395:15121040,14396:15175300,14397:15175614,14398:15185283,14399:15239351,14400:15247488,14401:15248314,14402:15309200,14403:14989710,14404:15040651,14405:15044516,14406:15045052,14407:15047610,14408:15050641,14409:15052196,14410:15054769,14411:15055531,14412:15056039,14413:15108280,14414:15111557,14415:15113903,14416:15120790,14417:15174544,14418:15184778,14419:15246004,14420:15237793,14421:15238049,14422:15241136,14423:15243662,14424:15248007,14425:15251368,14426:15304887,14427:15309703,14428:15311271,14429:15318163,14430:14989972,14431:14989970,14432:14990477,14433:15043976,14434:15045001,14435:15044798,14436:15050927,14437:15056524,14438:15056545,14439:15106719,14440:15114919,14441:15116942,14442:15176090,14443:15180417,14444:15248030,14445:15248036,14446:15248823,14447:15304336,14448:14989726,14449:15314825,14450:14989988,14451:14990780,14452:14991023,14453:15040665,14454:15040662,14455:15041929,14456:15041964,14457:15043231,14458:15043257,14459:15043518,14460:15044250,14461:15044515,14462:15044753,14625:15044750,14626:15046281,14627:15048081,14628:15048354,14629:15050173,14630:15052180,14631:15052189,14632:15052431,14633:15054757,14634:15054759,14635:15054775,14636:15055288,14637:15055491,14638:15055514,14639:15055543,14640:15056024,14641:15106450,14642:15107468,14643:15108759,14644:15109016,14645:15109799,14646:15111355,14647:15112322,14648:15112579,14649:15113140,14650:15113645,14651:15114401,14652:15114903,14653:15116171,14654:15118751,14655:15119530,14656:15119785,14657:15120559,14658:15121053,14659:15176882,14660:15178375,14661:15180204,14662:15182015,14663:15184800,14664:15185029,14665:15185048,14666:15185310,14667:15185585,14668:15237269,14669:15237251,14670:15237807,14671:15237809,14672:15238548,14673:15238799,14674:15239338,14675:15240594,14676:15245708,14677:15245729,14678:15248539,14679:15250082,14680:15250364,14681:15303562,14682:15304117,14683:15305137,14684:15179967,14685:15305660,14686:15308452,14687:15309197,14688:15310981,14689:15312537,14690:15313816,14691:15316155,14692:15042971,14693:15043243,14694:15044535,14695:15044744,14696:15049621,14697:15109047,14698:15122336,14699:15249834,14700:15252895,14701:15317689,14702:15041931,14703:15042747,14704:15045002,14705:15047613,14706:15182208,14707:15304119,14708:15316384,14709:15317906,14710:15175044,14711:15121545,14712:15238576,14713:15176849,14714:15056829,14715:15106970,14716:15313576,14717:15174555,14718:15253180,14881:15117732,14882:15310979,14883:14990218,14884:15047600,14885:15048100,14886:15049406,14887:15051162,14888:15106472,14889:15107975,14890:15112335,14891:15112326,14892:15114425,14893:15114929,14894:15120311,14895:15177621,14896:15185082,14897:15239598,14898:15314306,14899:14989979,14900:14990736,14901:15044489,14902:15045766,14903:15054255,14904:15054758,14905:15054766,14906:15114171,14907:15119001,14908:15176115,14909:15179906,14910:15247760,14911:15306390,14912:15246239,14913:15048080,14914:15055527,14915:15109291,14916:15041205,14917:15041196,14918:15042189,14919:15113344,14920:15045513,14921:15049118,14922:15050427,14923:15052464,14924:15056297,14925:15108493,14926:15109793,14927:15114429,14928:15117747,14929:15120520,14930:15172029,14931:15304583,14932:15174272,14933:15179925,14934:15179942,14935:15181229,14936:15111822,14937:15185072,14938:15241116,14939:15246209,14940:15252617,14941:15309467,14942:15042980,14943:15047848,14944:15113616,14945:15187370,14946:15250081,14947:15042228,14948:15048066,14949:15308970,14950:15048890,14951:15115914,14952:15237812,14953:15045298,14954:15053966,14955:15048636,14956:15180437,14957:15316922,14958:14990748,14959:15042954,14960:15045259,14961:15110334,14962:15112360,14963:15113364,14964:15114165,14965:15182468,14966:15183254,14967:15185058,14968:15305903,14969:15114652,14970:15314605,14971:15183033,14972:15043737,14973:15042186,14974:15042743,15137:15052703,15138:15109046,15139:15110830,15140:15111078,15141:15113389,15142:15118010,15143:15242921,15144:15309713,15145:15178384,15146:15314838,15147:15109516,15148:15305862,15149:15314603,15150:15178431,15151:15112594,15152:14989449,15153:15041176,15154:15044482,15155:15053233,15156:15106984,15157:15110802,15158:15111587,15159:15114655,15160:15173542,15161:15175562,15162:15176867,15163:15183511,15164:15186562,15165:15243925,15166:15249027,15167:15250331,15168:15304120,15169:15312016,15170:15111852,15171:15112875,15172:15117963,15173:14990229,15174:14990228,15175:14990522,15176:14990783,15177:15042746,15178:15044536,15179:15044530,15180:15046563,15181:15047579,15182:15049643,15183:15050635,15184:15050633,15185:15050687,15186:15052176,15187:15053197,15188:15054978,15189:15055019,15190:15056791,15191:15106205,15192:15109255,15193:15111343,15194:15052188,15195:15111855,15196:15111869,15197:15112104,15198:15113885,15199:15117730,15200:15117755,15201:15118479,15202:15175045,15203:15181193,15204:15181697,15205:15184824,15206:15185049,15207:15185067,15208:15237794,15209:15238274,15210:15239091,15211:15246998,15212:15247774,15213:15247785,15214:15247782,15215:15248012,15216:15248302,15217:15250311,15218:15250332,15219:15309708,15220:15311804,15221:15117743,15222:14989963,15223:14990524,15224:14990989,15225:15041936,15226:15052183,15227:15052730,15228:15107464,15229:15109249,15230:15112578,15393:15117473,15394:15121291,15395:15119035,15396:15173822,15397:15176381,15398:15177620,15399:15180673,15400:15180986,15401:15237260,15402:15237299,15403:15239082,15404:15241876,15405:15253150,15406:15118736,15407:15317439,15408:15056015,15409:15248792,15410:15316139,15411:15182778,15412:15252408,15413:15052429,15414:15309739,15415:14989443,15416:15044529,15417:15048631,15418:15049905,15419:15051657,15420:15052452,15421:15106697,15422:15120831,15423:15121542,15424:15177406,15425:15250346,15426:15052447,15427:15242368,15428:15183776,15429:15040946,15430:15114164,15431:15239837,15432:15053217,15433:15242634,15434:15186078,15435:15239310,15436:15042201,15437:15052932,15438:15109544,15439:15250854,15440:15111836,15441:15173038,15442:15180990,15443:15185047,15444:15237253,15445:15248541,15446:15252362,15447:15303086,15448:15244167,15449:15303338,15450:15040671,15451:15043514,15452:15052986,15453:15113619,15454:15172028,15455:15173813,15456:15304076,15457:15304584,15458:15305899,15459:15240101,15460:15052674,15461:15056049,15462:15107001,15463:14989499,15464:15044502,15465:15052424,15466:15108491,15467:15113393,15468:15117962,15469:15174569,15470:15175584,15471:15181998,15472:15238571,15473:15251107,15474:15304082,15475:15312534,15476:15041682,15477:15044503,15478:15045034,15479:15052735,15480:15109768,15481:15116473,15482:15185580,15483:15309952,15484:15047578,15485:15044494,15486:15045032,15649:15052439,15650:15052977,15651:15054750,15652:14991278,15653:15107201,15654:15109054,15655:15119538,15656:15181696,15657:15181707,15658:15185282,15659:15186317,15660:15187858,15661:15239085,15662:15239327,15663:15241872,15664:15245702,15665:15246770,15666:15249040,15667:15251892,15668:15252655,15669:15302833,15670:15304075,15671:15304108,15672:15309702,15673:15304348,15674:14990208,15675:14990735,15676:15041925,15677:15043969,15678:15056531,15679:15108238,15680:15114132,15681:15118721,15682:15120523,15683:15175075,15684:15186086,15685:15304589,15686:15305347,15687:15044500,15688:15049881,15689:15052479,15690:15120273,15691:15181213,15692:15186094,15693:15184539,15694:15049150,15695:15173279,15696:15042490,15697:15245715,15698:15253424,15699:14991242,15700:15053755,15701:15112357,15702:15179436,15703:15182755,15704:15239324,15705:15312831,15706:15042438,15707:15056554,15708:15112108,15709:15115695,15710:15117961,15711:15120307,15712:15121046,15713:15121828,15714:15178686,15715:15185044,15716:15054753,15717:15303093,15718:15304327,15719:15310982,15720:15042470,15721:15042717,15722:15108480,15723:15112849,15724:15113113,15725:15120538,15726:15055542,15727:15185810,15728:15187378,15729:15113144,15730:15242927,15731:15243191,15732:15248312,15733:15043241,15734:15044505,15735:15050163,15736:15055503,15737:15056528,15738:15106453,15739:15305636,15740:15309220,15741:15041207,15742:15041695,15905:15043485,15906:15043744,15907:15043975,15908:15044524,15909:15045544,15910:15046022,15911:15045809,15912:15046807,15913:15050152,15914:15050430,15915:15050940,15916:15052469,15917:15052934,15918:15052943,15919:15052945,15920:15052954,15921:15055492,15922:15055498,15923:15055776,15924:15056304,15925:15108543,15926:15108740,15927:15109019,15928:15109772,15929:15109559,15930:15112327,15931:15112332,15932:15112365,15933:15112630,15934:15113662,15935:15114914,15936:15116447,15937:15116469,15938:15119036,15939:15120008,15940:15120521,15941:15120792,15942:15172796,15943:15172774,15944:15173031,15945:15177607,15946:15178881,15947:15180189,15948:15180929,15949:15181221,15950:15181744,15951:15182752,15952:15182993,15953:15184551,15954:15185081,15955:15237782,15956:15241110,15957:15241867,15958:15242633,15959:15245725,15960:15246259,15961:15247519,15962:15247548,15963:15247764,15964:15247795,15965:15249825,15966:15250334,15967:15304356,15968:15305126,15969:15306174,15970:15306904,15971:15309468,15972:15310488,15973:14989450,15974:14989448,15975:14989470,15976:14989719,15977:15042199,15978:15042992,15979:15048590,15980:15048884,15981:15049612,15982:15051938,15983:15055032,15984:15106949,15985:15111102,15986:15113633,15987:15113622,15988:15119748,15989:15174326,15990:15177139,15991:15182243,15992:15241912,15993:15248818,15994:15304376,15995:15305888,15996:15046833,15997:15048628,15998:15311806,16161:15109037,16162:15115405,16163:15117974,16164:15173549,16165:15186324,16166:15237559,16167:15239602,16168:15247270,16169:15311775,16170:15244693,16171:15253169,16172:15052987,16173:14990520,16174:14991265,16175:14991029,16176:15045767,16177:15050912,16178:15052701,16179:15052713,16180:15056771,16181:15107470,16182:15109295,16183:15111856,16184:15112587,16185:15115182,16186:15115931,16187:15119800,16188:15120305,16189:15176883,16190:15177401,16191:15178911,16192:15181214,16193:15181734,16194:15185075,16195:15239075,16196:15239855,16197:15242922,16198:15247018,16199:15247546,16200:15252139,16201:15253147,16202:15302834,16203:15304605,16204:15309959,16205:14990010,16206:14990209,16207:15042691,16208:15049141,16209:15049644,16210:15052939,16211:15176858,16212:15052989,16213:15238542,16214:15247498,16215:15253381,16216:15309219,16217:15310253,16218:15183013,16219:15248271,16220:15310984,16221:15304098,16222:15047603,16223:15044264,16224:15302807,16225:15044793,16226:15048322,16227:15055013,16228:15109800,16229:15118516,16230:15172234,16231:15179169,16232:15184523,16233:15187872,16234:15245744,16235:15303042,16236:15304084,16237:15305872,16238:15305880,16239:15309455,16240:15176094,16241:15313796,16242:15053959,16243:15054249,16244:15111600,16245:15113890,16246:15251112,16247:15309723,16248:15109550,16249:15113609,16250:15115417,16251:15241093,16252:15310999,16253:15309696,16254:15246270,16417:15122052,16418:15110586,16419:15052728,16420:14989462,16421:15171756,16422:15177117,16423:15112367,16424:15042436,16425:15042742,16426:15043490,16427:15050643,16428:15056513,16429:15106215,16430:15108240,16431:15111359,16432:15111604,16433:15112351,16434:15112628,16435:15115186,16436:15114390,16437:15117731,16438:15120517,16439:15174066,16440:15176863,16441:15178651,16442:15184574,16443:15237526,16444:15049648,16445:15246269,16446:15246783,16447:15248032,16448:15248019,16449:15248267,16450:15302813,16451:15304338,16452:15310226,16453:15310233,16454:15111817,16455:15181966,16456:15238278,16457:15309499,16458:15055021,16459:15106972,16460:15108250,16461:15111845,16462:15112340,16463:15113872,16464:15179699,16465:15182221,16466:15184269,16467:15186110,16468:15238282,16469:15250092,16470:15250852,16471:15251361,16472:15251871,16473:15180457,16474:15042695,16475:15109017,16476:15109797,16477:15110530,16478:15108760,16479:15247533,16480:15182467,16481:15183744,16482:15248044,16483:15309738,16484:15185334,16485:15239308,16486:15244681,16487:14990233,16488:15041928,16489:15043971,16490:15044000,16491:15052451,16492:15052930,16493:15052950,16494:15054749,16495:15108262,16496:15108487,16497:15110832,16498:15114387,16499:15114420,16500:15119241,16501:15119749,16502:15119511,16503:15114131,16504:15121820,16505:15173006,16506:15173053,16507:15112075,16508:15182271,16509:15183533,16510:15185818,16673:15186314,16674:15187624,16675:15238586,16676:15239323,16677:15239353,16678:15242918,16679:15247790,16680:15250318,16681:15251381,16682:15303096,16683:15303095,16684:15305389,16685:15305361,16686:15308419,16687:15314606,16688:15042957,16689:15046276,16690:15121592,16691:15172790,16692:15041960,16693:15181445,16694:15186325,16695:15238835,16696:15184782,16697:15047052,16698:15049105,16699:15053480,16700:15109802,16701:15113150,16702:15113149,16703:15115674,16704:15174553,16705:15177359,16706:15177358,16707:15180942,16708:15181206,16709:15181727,16710:15184535,16711:15185056,16712:15185284,16713:15243399,16714:15247540,16715:15308987,16716:15303073,16717:15318176,16718:15041447,16719:15042997,16720:15044492,16721:15044514,16722:15040649,16723:15046314,16724:15049646,16725:15050127,16726:15173821,16727:15052427,16728:15053220,16729:15043741,16730:15106979,16731:15106995,16732:15109532,16733:15109763,16734:15109311,16735:15109819,16736:15111053,16737:15112105,16738:15113145,16739:15054755,16740:15116173,16741:15116221,16742:15121557,16743:15173541,16744:14989961,16745:15177641,16746:15178680,16747:15182483,16748:15184799,16749:15185807,16750:15185564,16751:15237537,16752:15240585,16753:15240600,16754:15241644,16755:15241916,16756:15243195,16757:15246213,16758:15250864,16759:15302785,16760:15303085,16761:15306391,16762:15309980,16763:15313042,16764:15041423,16765:15049367,16766:15107726,16929:15239059,16930:15242421,16931:15250568,16932:15302816,16933:14991235,16934:15040948,16935:15042951,16936:15044019,16937:15106479,16938:15109513,16939:15113631,16940:15120556,16941:15251123,16942:15302815,16943:14991255,16944:15053214,16945:15250314,16946:15112079,16947:15185562,16948:15043986,16949:15245974,16950:15041974,16951:15110019,16952:15052184,16953:15052203,16954:15052938,16955:15110285,16956:15113617,16957:15303068,16958:14990230,16959:15049882,16960:15049898,16961:15118768,16962:15247761,16963:15045822,16964:15048853,16965:15050405,16966:15106992,16967:15108499,16968:15114113,16969:15239349,16970:15115669,16971:15309184,16972:15312772,16973:15313064,16974:14990739,16975:15048838,16976:15052734,16977:15237264,16978:15053489,16979:15055023,16980:15056517,16981:15106208,16982:15107467,16983:15108276,16984:15113151,16985:15119280,16986:15121310,16987:15238030,16988:15238591,16989:15240084,16990:15245963,16991:15250104,16992:15302784,16993:15302830,16994:15309450,16995:15317915,16996:15314843,16997:14990243,16998:15044528,16999:15049895,17000:15183020,17001:15304333,17002:15311244,17003:15316921,17004:15121309,17005:15171751,17006:15043987,17007:15046020,17008:15052421,17009:15108504,17010:15108766,17011:15109011,17012:15119010,17013:15122351,17014:15175842,17015:15247511,17016:15306936,17017:15122305,17018:15248318,17019:15240376,17020:15042471,17021:15244216,17022:15044522,17185:15044521,17186:14990726,17187:15303060,17188:15253168,17189:15050154,17190:15238321,17191:15054781,17192:15182762,17193:15253183,17194:15115162,17195:15249591,17196:15174584,17197:15315336,17198:15116477,17199:15248048,17200:14989497,17201:15043992,17202:15046790,17203:15048102,17204:15108997,17205:15109794,17206:15112102,17207:15117710,17208:15120289,17209:15120795,17210:15172269,17211:15179693,17212:15182767,17213:15183530,17214:15185595,17215:15237309,17216:15238022,17217:15244171,17218:15248021,17219:15306139,17220:15047587,17221:15049607,17222:15056062,17223:15111853,17224:15112854,17225:15116928,17226:15118005,17227:15176887,17228:15248263,17229:15040676,17230:15179685,17231:15047856,17232:15056027,17233:15106469,17234:15112634,17235:15118752,17236:15177652,17237:15181978,17238:15187374,17239:15239092,17240:15244440,17241:15303045,17242:15312563,17243:15183753,17244:15177116,17245:15182777,17246:15183249,17247:15242116,17248:15302800,17249:15181737,17250:15182482,17251:15240374,17252:15051681,17253:15179136,17254:14989485,17255:14990258,17256:15052441,17257:15056800,17258:15108797,17259:15112380,17260:15114161,17261:15119272,17262:15243691,17263:15245751,17264:15247547,17265:15304078,17266:15305651,17267:15312784,17268:15116439,17269:15171750,17270:15174826,17271:15240103,17272:15241623,17273:15250095,17274:14989441,17275:15041926,17276:15042443,17277:15046283,17278:15052725,17441:15054998,17442:15055027,17443:15055489,17444:15056020,17445:15056053,17446:15056299,17447:15056564,17448:15108018,17449:15109265,17450:15112866,17451:15113373,17452:15121838,17453:15174034,17454:15176890,17455:15178938,17456:15237556,17457:15238329,17458:15238584,17459:15244726,17460:15248063,17461:15248284,17462:15251077,17463:15251379,17464:15305370,17465:15308215,17466:15310978,17467:15315877,17468:15043461,17469:15109527,17470:15178676,17471:15113365,17472:15118984,17473:15175565,17474:15250307,17475:15306414,17476:15309235,17477:15119525,17478:15049372,17479:15115406,17480:15116172,17481:15253437,17482:15306394,17483:15177627,17484:15302810,17485:15049114,17486:15114370,17487:15109812,17488:15116219,17489:14990723,17490:15121580,17491:15114136,17492:15253179,17493:15242406,17494:15185588,17495:15306132,17496:15115455,17497:15121840,17498:15048106,17499:15049655,17500:15051948,17501:15185068,17502:15173802,17503:15044746,17504:15304611,17505:15316660,17506:14989997,17507:14990734,17508:15040924,17509:15040949,17510:15042947,17511:15250078,17512:15045000,17513:15048868,17514:15052442,17515:15055005,17516:15055509,17517:15055533,17518:15055799,17519:15056031,17520:15106700,17521:15108789,17522:15109306,17523:15110032,17524:15114927,17525:15118720,17526:15180423,17527:15181454,17528:15181963,17529:15185824,17530:15239559,17531:15247490,17532:15248294,17533:15251844,17534:15302803,17697:15303352,17698:15303853,17699:15304600,17700:15318158,17701:15119269,17702:15110552,17703:15111074,17704:15111605,17705:15121332,17706:15178372,17707:15183003,17708:15303081,17709:15306641,17710:15121082,17711:15045554,17712:15056569,17713:15110820,17714:15252877,17715:15253421,17716:15305092,17717:15041976,17718:15049131,17719:15049897,17720:15053205,17721:15055511,17722:15120315,17723:15186575,17724:15176860,17725:15250108,17726:15252386,17727:15311259,17728:15172281,17729:14990493,17730:15118015,17731:15122097,17732:15176880,17733:15309755,17734:15041934,17735:15044752,17736:15048885,17737:15049111,17738:15050412,17739:15053216,17740:15056530,17741:15111831,17742:15113628,17743:15120545,17744:15178171,17745:15241119,17746:15250349,17747:15302804,17748:15303613,17749:15306125,17750:15179941,17751:15179962,17752:15043242,17753:15055526,17754:15047839,17755:15050164,17756:15106194,17757:15040658,17758:15041946,17759:15042220,17760:15042445,17761:15042688,17762:15045776,17763:15049108,17764:15049112,17765:15050135,17766:15052437,17767:15053750,17768:15054475,17769:15106748,17770:15108757,17771:15110317,17772:15113649,17773:15114627,17774:15114940,17775:15115167,17776:15178647,17777:15120280,17778:15120815,17779:15120027,17780:15172015,17781:15173512,17782:15056275,17783:15177624,17784:15181239,17785:15183241,17786:15183252,17787:15183250,17788:15184790,17789:15185329,17790:15042736,17953:15241635,17954:15242665,17955:15243172,17956:15247502,17957:15248516,17958:15249798,17959:15251599,17960:15302787,17961:15302799,17962:15306905,17963:15309238,17964:15311021,17965:15313072,17966:15308696,17967:15041421,17968:15043477,17969:15044748,17970:15048834,17971:15052942,17972:15107751,17973:15110814,17974:15119518,17975:15179443,17976:15182757,17977:15238068,17978:15241348,17979:15303059,17980:15305349,17981:15053728,17982:15316103,17983:15043775,17984:15056535,17985:15056563,17986:15120028,17987:15174073,17988:15179171,17989:15181503,17990:15183780,17991:15118226,17992:15174572,17993:15248045,17994:15114371,17995:15116705,17996:15042488,17997:15182465,17998:15115444,17999:15053194,18000:15315894,18001:15240107,18002:15052677,18003:15304073,18004:15171742,18005:15047096,18006:15053231,18007:15106951,18008:15111590,18009:15118988,18010:15249818,18011:15303041,18012:15310995,18013:15045009,18014:15113095,18015:15304845,18016:15050120,18017:15303331,18018:15042181,18019:14989709,18020:15042474,18021:15242905,18022:15248526,18023:15171992,18024:15109562,18025:15306123,18026:15115682,18027:15312564,18028:15186052,18029:15177143,18030:15043991,18031:15115680,18032:15252383,18033:15309731,18034:15118749,18035:14989964,18036:15052988,18037:15056016,18038:15253417,18039:15043714,18040:15250321,18041:15237769,18042:15243705,18043:15055807,18044:15112101,18045:14989747,18046:15041957,18209:15050370,18210:15052991,18211:15310766,18212:14990267,18213:15050378,18214:15056781,18215:15248013,18216:15122337,18217:15181488,18218:15181218,18219:15052711,18220:15241649,18221:15174827,18222:15173297,18223:15055284,18224:15056821,18225:15109563,18226:15110810,18227:15173507,18228:15184536,18229:14989699,18230:15055804,18231:14989707,18232:15048604,18233:15047330,18234:15106729,18235:15122307,18236:15185037,18237:15238077,18238:15238323,18239:15238847,18240:15253170,18241:15246999,18242:15243940,18243:15054772,18244:15108746,18245:15110829,18246:15246983,18247:15113655,18248:15119266,18249:15119550,18250:15175862,18251:15179956,18252:15051142,18253:15187381,18254:15239853,18255:15312556,18256:14991283,18257:15055747,18258:15109021,18259:15109778,18260:15111575,18261:15113647,18262:15178627,18263:15174028,18264:15238028,18265:15237818,18266:15252649,18267:15304077,18268:15040653,18269:15048633,18270:15051410,18271:15114885,18272:15115699,18273:15173028,18274:15174589,18275:15250103,18276:15049650,18277:15250336,18278:15309226,18279:15302809,18280:15244735,18281:15181732,18282:15179687,18283:15241385,18284:14990511,18285:15042981,18286:15043994,18287:15109005,18288:15114127,18289:15119242,18290:15178173,18291:15183508,18292:15184533,18293:15239350,18294:15242884,18295:15253419,18296:15113117,18297:15121568,18298:15173766,18299:15186075,18300:15240875,18301:15312769,18302:15317670,18465:15042493,18466:15183537,18467:15180210,18468:15183544,18469:15237767,18470:15183240,18471:15117224,18472:15055265,18473:15237772,18474:15177105,18475:15177120,18476:15041963,18477:15305122,18478:15121036,18479:15178170,18480:15304343,18481:15313834,18482:14990480,18483:15187376,18484:15108764,18485:15183247,18486:15308453,18487:15315881,18488:15047098,18489:15049113,18490:15244196,18491:15309500,18492:14990516,18493:15042724,18494:15043978,18495:15044493,18496:15044507,18497:15054982,18498:15110316,18499:15111825,18500:15113663,18501:15118526,18502:15118734,18503:15174024,18504:15174319,18505:15175597,18506:15177108,18507:15186305,18508:15239340,18509:15243177,18510:15250089,18511:15183748,18512:15304582,18513:15173033,18514:15310994,18515:15311791,18516:15109309,18517:15112617,18518:15177130,18519:15178660,18520:15180688,18521:15242627,18522:15244206,18523:15043754,18524:15043985,18525:15044774,18526:15050371,18527:15055495,18528:15056316,18529:15106738,18530:15108489,18531:15108537,18532:15108779,18533:15111824,18534:15118228,18535:15119244,18536:15177394,18537:15178414,18538:15180433,18539:15181720,18540:15185803,18541:15187383,18542:15237797,18543:15245995,18544:15248057,18545:15250107,18546:15303103,18547:15310238,18548:15311771,18549:15116427,18550:15184056,18551:15041177,18552:15052990,18553:15056558,18554:15113863,18555:15118232,18556:15175861,18557:15178889,18558:15187598,18721:15318203,18722:15114122,18723:15181975,18724:15043769,18725:15177355,18726:15313837,18727:15056294,18728:15238813,18729:15241137,18730:15237784,18731:15056060,18732:15056773,18733:15177122,18734:15183238,18735:15302844,18736:15114663,18737:15050667,18738:15051419,18739:15185040,18740:15178174,18741:15248556,18742:14991285,18743:15056298,18744:15116441,18745:15118519,18746:15121538,18747:15176610,18748:15181224,18749:15245736,18750:15247765,18751:15249849,18752:15055775,18753:15110031,18754:15177605,18755:15181714,18756:15240087,18757:15305896,18758:15305650,18759:15241884,18760:15244205,18761:15315117,18762:15045505,18763:15056300,18764:15111820,18765:15119772,18766:15171733,18767:15250087,18768:15250323,18769:15311035,18770:15111567,18771:15176630,18772:14989453,18773:14990232,18774:15048608,18775:15049899,18776:15051174,18777:15052684,18778:15042216,18779:15054979,18780:15055516,18781:15106198,18782:15108534,18783:15111607,18784:15111847,18785:15112622,18786:15119790,18787:15173814,18788:15183014,18789:15238544,18790:15238810,18791:15239833,18792:15248796,18793:15250080,18794:15250342,18795:15250868,18796:15308956,18797:15309188,18798:14991022,18799:15110827,18800:15117734,18801:15239326,18802:15241633,18803:15242666,18804:15303592,18805:15052929,18806:15115667,18807:15311528,18808:15241658,18809:15242647,18810:14990479,18811:15042991,18812:15056553,18813:15055237,18814:15113357,18977:15181455,18978:15238585,18979:15246471,18980:15246982,18981:15120309,18982:15056023,18983:15108501,18984:15119032,18985:14990223,18986:15174057,18987:15314578,18988:15042694,18989:15044795,18990:15047092,18991:15049395,18992:15107748,18993:15108526,18994:15172762,18995:15050158,18996:15184521,18997:15184798,18998:15185051,18999:15309744,19000:15111815,19001:15237534,19002:14989465,19003:14990773,19004:15041973,19005:15049088,19006:15055267,19007:15055283,19008:15056010,19009:15114116,19010:14989478,19011:15242429,19012:15308425,19013:15309211,19014:15184307,19015:15310977,19016:15041467,19017:15049601,19018:15178134,19019:15180455,19020:15042725,19021:15179429,19022:15242385,19023:15183494,19024:15040911,19025:15049865,19026:15174023,19027:15183751,19028:15185832,19029:15253178,19030:15253396,19031:15303053,19032:14991039,19033:15043465,19034:15050921,19035:15056001,19036:15310509,19037:14991261,19038:15239319,19039:15305642,19040:15047811,19041:15109525,19042:15117737,19043:15176875,19044:15246236,19045:15252628,19046:15182210,19047:15043487,19048:15049363,19049:15107477,19050:15108234,19051:15112878,19052:15118221,19053:15184063,19054:15241129,19055:15040675,19056:14991288,19057:15043717,19058:15044998,19059:15048881,19060:15050121,19061:15052445,19062:15053744,19063:15053743,19064:15053993,19065:15055510,19066:15108785,19067:15109543,19068:15111358,19069:15111865,19070:15113355,19233:15119253,19234:15119265,19235:15172537,19236:15179954,19237:15186091,19238:15238046,19239:15239859,19240:15241356,19241:15242156,19242:15244418,19243:15246482,19244:15247530,19245:15249802,19246:15303334,19247:15305618,19248:15311805,19249:15315891,19250:15316396,19251:14989711,19252:14989985,19253:15041165,19254:15042966,19255:15048074,19256:15050408,19257:15055037,19258:15056792,19259:15056793,19260:15108287,19261:15112884,19262:15113371,19263:15114128,19264:15115154,19265:15042194,19266:15185057,19267:15237802,19268:15238824,19269:15248512,19270:15250060,19271:15250111,19272:15305150,19273:15308978,19274:15044768,19275:15311020,19276:15043735,19277:15041429,19278:15043996,19279:15049384,19280:15110834,19281:15113396,19282:15174055,19283:15179174,19284:15182214,19285:15304614,19286:15043459,19287:15119009,19288:15117958,19289:15048832,19290:15055244,19291:15050132,19292:15113388,19293:15187899,19294:15042465,19295:15178630,19296:15110569,19297:15180712,19298:15314324,19299:15317691,19300:15048587,19301:15050425,19302:15112359,19303:15113882,19304:15118222,19305:15045545,19306:15116185,19307:15055253,19308:15238812,19309:15113877,19310:15314602,19311:15114174,19312:15315346,19313:15114653,19314:14989990,19315:14991267,19316:15044488,19317:15108793,19318:15113387,19319:15119019,19320:15253380,19321:14991021,19322:15186349,19323:15317695,19324:14989447,19325:15107490,19326:15121024,19489:15121579,19490:15242387,19491:15045043,19492:15113386,19493:15314309,19494:15054771,19495:15183509,19496:15053484,19497:15052678,19498:15244444,19499:15120778,19500:15242129,19501:15181972,19502:15238280,19503:15050393,19504:15184525,19505:15118481,19506:15178912,19507:15043481,19508:15049890,19509:15172769,19510:15174047,19511:15179675,19512:15309991,19513:15316385,19514:15115403,19515:15051199,19516:15050904,19517:15042213,19518:15044749,19519:15045053,19520:15112334,19521:15178655,19522:15253431,19523:15305368,19524:15315892,19525:15050666,19526:15174045,19527:15121285,19528:15041933,19529:15115145,19530:15185599,19531:15185836,19532:15310242,19533:15317690,19534:15110584,19535:15116449,19536:15240322,19537:15050372,19538:15052191,19539:15118235,19540:15174811,19541:15178674,19542:15185586,19543:15237271,19544:15241881,19545:15041714,19546:15113384,19547:15317913,19548:15178670,19549:15113634,19550:15043519,19551:15312005,19552:15052964,19553:15108283,19554:15184318,19555:15250096,19556:15046031,19557:15106742,19558:15185035,19559:15308416,19560:15043713,19561:14989727,19562:15042230,19563:15049884,19564:15173818,19565:15237302,19566:15304590,19567:15056037,19568:15179682,19569:15044228,19570:15056313,19571:15185028,19572:15242924,19573:15247539,19574:15252109,19575:15310230,19576:15114163,19577:15242926,19578:15307155,19579:15107209,19580:15107208,19581:15119033,19582:15178130,19745:15248301,19746:15252664,19747:15045807,19748:14990737,19749:15041706,19750:15043463,19751:15044491,19752:15052453,19753:15055293,19754:15106720,19755:15107714,19756:15110038,19757:15113353,19758:15114138,19759:15120807,19760:15120012,19761:15174838,19762:15174839,19763:15176881,19764:15181200,19765:15246229,19766:15248024,19767:15303050,19768:15303313,19769:15303605,19770:15309700,19771:15244941,19772:15049877,19773:14989960,19774:14990745,19775:14989454,19776:15248009,19777:15252671,19778:15310992,19779:15041197,19780:15055292,19781:15050390,19782:15052473,19783:15055544,19784:15110042,19785:15110074,19786:15111041,19787:15113116,19788:15115658,19789:15116184,19790:15119499,19791:15121078,19792:15173268,19793:15176872,19794:15182511,19795:15187594,19796:15237248,19797:15241609,19798:15242121,19799:15246977,19800:15248545,19801:15251594,19802:15303077,19803:15309245,19804:15312010,19805:15107518,19806:15108753,19807:15117490,19808:15118979,19809:15119796,19810:15187852,19811:15187900,19812:15120256,19813:15187589,19814:15244986,19815:15246264,19816:15113637,19817:15240881,19818:15311036,19819:15309751,19820:15119515,19821:15185313,19822:15241405,19823:15304106,19824:14989745,19825:15044021,19826:15054224,19827:15117444,19828:15122347,19829:15243149,19830:15243437,19831:15247015,19832:15042729,19833:15044751,19834:15053221,19835:15113614,19836:15114920,19837:15175814,19838:15176323,20001:15177634,20002:15246223,20003:15246241,20004:15304588,20005:15309730,20006:15309240,20007:15056523,20008:15175303,20009:15182731,20010:15241614,20011:15109792,20012:15177125,20013:15043209,20014:15119745,20015:15121052,20016:15175817,20017:15177113,20018:15180203,20019:15184530,20020:15309446,20021:15182748,20022:15318669,20023:14991030,20024:15107502,20025:15112069,20026:15243676,20027:14989958,20028:14989998,20029:15041434,20030:14989473,20031:15042444,20032:15052718,20033:15111833,20034:15114881,20035:15120060,20036:15174815,20037:15178114,20038:15179437,20039:15181980,20040:15184807,20041:15239599,20042:15248274,20043:15303100,20044:15304591,20045:15309237,20046:15311000,20047:15043227,20048:15185809,20049:15040683,20050:15044248,20051:15113879,20052:15120267,20053:15173520,20054:15175859,20055:15239080,20056:15252650,20057:15309475,20058:15315351,20059:15317663,20060:15176096,20061:15049089,20062:15120025,20063:15185071,20064:15311262,20065:14990244,20066:14990518,20067:14990987,20068:15042231,20069:15043249,20070:15054522,20071:15106204,20072:15175346,20073:15180988,20074:15240083,20075:15304884,20076:15309495,20077:15309750,20078:15309962,20079:15317655,20080:15318434,20081:15112870,20082:15117748,20083:15042711,20084:15043235,20085:15172488,20086:15246210,20087:15055753,20088:15106443,20089:15107728,20090:15121571,20091:15173001,20092:15184062,20093:15185844,20094:15237551,20257:15242158,20258:15302819,20259:15305900,20260:15044994,20261:15314351,20262:15117203,20263:15172233,20264:15250306,20265:15251375,20266:15310002,20267:15043252,20268:15051137,20269:15055754,20270:15056004,20271:15113367,20272:15115708,20273:15115924,20274:15119786,20275:15121551,20276:15174050,20277:15174588,20278:15183789,20279:15237249,20280:15237566,20281:15244683,20282:15303566,20283:15041965,20284:15317651,20285:15181444,20286:15237771,20287:15305906,20288:15248278,20289:15040685,20290:15045260,20291:15247793,20292:15117738,20293:15250308,20294:15238279,20295:15106961,20296:15113888,20297:15316914,20298:14989977,20299:14989976,20300:15315088,20301:15247787,20302:15243137,20303:15242664,20304:15115392,20305:15120830,20306:15180439,20307:15238549,20513:15056012,20514:14989456,20515:14989461,20516:14989482,20517:14989489,20518:14989494,20519:14989500,20520:14989503,20521:14989698,20522:14989718,20523:14989720,20524:14989954,20525:14989957,20526:15249835,20527:14989962,20528:15239314,20529:15056013,20530:14989966,20531:14989982,20532:14989983,20533:14989984,20534:14989986,20535:14990000,20536:14990003,20537:14990006,20538:14990222,20539:14990221,20540:14990212,20541:14990214,20542:14990210,20543:14990231,20544:14990238,20545:14990253,20546:14990239,20547:14990263,20548:14990473,20549:14990746,20550:14990512,20551:14990747,20552:14990749,20553:14990743,20554:14990727,20555:14990774,20556:14990984,20557:14990991,20558:14991000,20559:14990779,20560:14990761,20561:14990768,20562:14990993,20563:14990767,20564:14990982,20565:14990998,20566:15041688,20567:14991252,20568:14991263,20569:14991246,20570:14991256,20571:14991259,20572:14991249,20573:14991258,20574:14991248,20575:14991268,20576:14991269,20577:15040666,20578:15040680,20579:15040660,20580:15040682,20581:15040677,20582:15040645,20583:14990492,20584:14991286,20585:15040673,20586:15040681,20587:15040684,20588:14991294,20589:14991279,20590:15040657,20591:15040646,20592:15040899,20593:15040903,20594:15113347,20595:15040917,20596:15040912,20597:15040904,20598:15040922,20599:15040918,20600:15040940,20601:15040952,20602:15041152,20603:15041178,20604:15041157,20605:15041204,20606:15041202,20769:15041417,20770:15041418,20771:15041203,20772:15041410,20773:15041430,20774:15041438,20775:15041445,20776:15041453,20777:15041443,20778:15041454,20779:15041465,20780:15041461,20781:15041673,20782:15041665,20783:15041666,20784:15041686,20785:15041685,20786:15041684,20787:15041690,20788:15041697,20789:15041722,20790:15041719,20791:15041724,20792:15041723,20793:15041727,20794:15041920,20795:15041938,20796:15041932,20797:15041940,20798:15041954,20799:15182776,20800:15041961,20801:15041962,20802:15041966,20803:15042176,20804:15042178,20805:15047576,20806:15042188,20807:15042185,20808:15042191,20809:15042193,20810:15042195,20811:15042197,20812:15042198,20813:15042212,20814:15042214,20815:15042210,20816:15042217,20817:15042218,20818:15042219,20819:15042227,20820:15042225,20821:15042226,20822:15042224,20823:15042229,20824:15042237,20825:15042437,20826:15042441,20827:15042459,20828:15042464,20829:15243669,20830:15042473,20831:15042477,20832:15042480,20833:15042485,20834:15042494,20835:15042692,20836:15042699,20837:15042708,20838:15042702,20839:15042727,20840:15042730,20841:15042734,20842:15042739,20843:15042745,20844:15042959,20845:15042948,20846:15042955,20847:15042956,20848:15042974,20849:15042964,20850:15042986,20851:15042996,20852:15042985,20853:15042995,20854:15043007,20855:15043005,20856:15043213,20857:15043220,20858:15043218,20859:15042993,20860:15043208,20861:15043217,20862:15253160,21025:15253159,21026:15043244,21027:15043245,21028:15043260,21029:15043253,21030:15043457,21031:15043469,21032:15043479,21033:15043486,21034:15043491,21035:15043494,21036:15311789,21037:15043488,21038:15043507,21039:15043509,21040:15043512,21041:15043513,21042:15043718,21043:15043720,21044:15176888,21045:15043725,21046:15043728,21047:15043727,21048:15043733,21049:15043738,21050:15043747,21051:15043759,21052:15043761,21053:15043763,21054:15043768,21055:15043968,21056:15043974,21057:15043973,21058:14989463,21059:15043977,21060:15043981,21061:15042454,21062:15043998,21063:15044009,21064:15044014,21065:15049880,21066:15044027,21067:15044023,21068:15044226,21069:15044246,21070:15044256,21071:15044262,21072:15044261,21073:15044270,21074:15044272,21075:15044278,21076:15044483,21077:15184018,21078:15309721,21079:15044511,21080:15113148,21081:15173550,21082:15044526,21083:15044520,21084:15044525,21085:15044538,21086:15044737,21087:15044797,21088:15044992,21089:15044780,21090:15044781,21091:15044796,21092:15044782,21093:15044790,21094:15044777,21095:15044765,21096:15045006,21097:15045263,21098:15045045,21099:15045262,21100:15045023,21101:15045041,21102:15045047,21103:15045040,21104:15045266,21105:15045051,21106:15045248,21107:15045046,21108:15045252,21109:15045264,21110:15045254,21111:15045511,21112:15045282,21113:15045304,21114:15045285,21115:15045292,21116:15045508,21117:15045512,21118:15045288,21281:15045291,21282:15045506,21283:15045284,21284:15045310,21285:15045308,21286:15045528,21287:15045541,21288:15045542,21289:15045775,21290:15045780,21291:15045565,21292:15045550,21293:15045549,21294:15045562,21295:15045538,21296:15045817,21297:15046016,21298:15046051,21299:15046028,21300:15045806,21301:15046044,21302:15046021,21303:15046038,21304:15046039,21305:15045816,21306:15045811,21307:15046045,21308:15046297,21309:15046272,21310:15045295,21311:15046282,21312:15046303,21313:15046075,21314:15046078,21315:15046296,21316:15046302,21317:15046318,21318:15046076,21319:15046275,21320:15046313,21321:15046279,21322:15046312,21323:15046554,21324:15046533,21325:15046559,21326:15046532,21327:15046556,21328:15046564,21329:15046548,21330:15046804,21331:15046583,21332:15046806,21333:15046590,21334:15046589,21335:15046811,21336:15046585,21337:15047054,21338:15047056,21339:15173535,21340:15046836,21341:15046838,21342:15046834,21343:15046840,21344:15047083,21345:15047076,21346:15046831,21347:15047084,21348:15047082,21349:15047302,21350:15047296,21351:15047306,21352:15047328,21353:15047316,21354:15047311,21355:15047333,21356:15047342,21357:15047350,21358:15047348,21359:15047554,21360:15047356,21361:15047553,21362:15047555,21363:15047552,21364:15047560,21365:15047566,21366:15047569,21367:15047571,21368:15047575,21369:15047598,21370:15047609,21371:15047808,21372:15047615,21373:15047812,21374:15047817,21537:15047816,21538:15047819,21539:15047821,21540:15047827,21541:15047832,21542:15047830,21543:15046535,21544:15047836,21545:15047846,21546:15047863,21547:15047864,21548:15048078,21549:15047867,21550:15048064,21551:15048079,21552:15048105,21553:15048576,21554:15048328,21555:15048097,21556:15048127,21557:15048329,21558:15048339,21559:15048352,21560:15048371,21561:15048356,21562:15048362,21563:15048368,21564:15048579,21565:15048582,21566:15048596,21567:15048594,21568:15048595,21569:15048842,21570:15048598,21571:15048611,21572:15048843,21573:15048857,21574:15048861,21575:15049138,21576:15048865,21577:15049122,21578:15049099,21579:15049136,21580:15118208,21581:15049106,21582:15048893,21583:15049145,21584:15049349,21585:15049401,21586:15049375,21587:15049387,21588:15049402,21589:15049630,21590:15049403,21591:15049400,21592:15049390,21593:15049605,21594:15049619,21595:15049617,21596:15049623,21597:15049625,21598:15049624,21599:15049637,21600:15049628,21601:15049636,21602:15049631,21603:15049647,21604:15049658,21605:15049657,21606:15049659,21607:15049660,21608:15049661,21609:15049858,21610:15049866,21611:15049872,21612:15049883,21613:15114918,21614:15049893,21615:15049900,21616:15049901,21617:15049906,21618:15049912,21619:15049918,21620:15182738,21621:15050133,21622:15050128,21623:15050126,21624:15050138,21625:15050136,21626:15050146,21627:15050144,21628:15050151,21629:15050156,21630:15050153,21793:15050168,21794:15050369,21795:15050397,21796:14990750,21797:14991019,21798:15050403,21799:15050418,21800:15050630,21801:15050664,21802:15050652,21803:15050381,21804:15050649,21805:15050650,21806:15050917,21807:15050911,21808:15050897,21809:15050908,21810:15050889,21811:15050906,21812:15051136,21813:15051180,21814:15051145,21815:15050933,21816:15050934,21817:15051170,21818:15051178,21819:15051418,21820:15051452,21821:15051454,21822:15051659,21823:15051650,21824:15051453,21825:15051683,21826:15051671,21827:15051686,21828:15051689,21829:15051670,21830:15051706,21831:15051707,21832:15051916,21833:15051915,21834:15051926,21835:15051954,21836:15051664,21837:15051946,21838:15051958,21839:15051966,21840:15052163,21841:15052165,21842:15052160,21843:15052177,21844:15052181,21845:15052186,21846:15052187,21847:15052197,21848:15052201,21849:15052208,21850:15052211,21851:15052213,21852:15052216,21853:15111816,21854:15052218,21855:15052416,21856:15052419,21857:15052454,21858:15052472,21859:15052675,21860:15052679,21861:15052681,21862:15052692,21863:15052688,21864:15052708,21865:15052710,21866:15052706,21867:15052702,21868:15052709,21869:15052715,21870:15052720,21871:15052726,21872:15052723,21873:15052933,21874:15052935,21875:15052936,21876:15052941,21877:15052947,21878:15052960,21879:15052962,21880:15052968,21881:15052984,21882:15052985,21883:15053185,21884:15053190,21885:15053198,21886:15053203,22049:15053200,22050:15053199,22051:15052209,22052:15053228,22053:15053230,22054:14989730,22055:15053238,22056:15053241,22057:15053452,22058:15053457,22059:15053460,22060:15050395,22061:15053483,22062:15053499,22063:15053494,22064:15053500,22065:15053495,22066:15053701,22067:15053502,22068:15053703,22069:15053721,22070:15053737,22071:15053757,22072:15053754,22073:15053741,22074:15054476,22075:15053738,22076:15053963,22077:15053973,22078:15053975,22079:15054236,22080:15053983,22081:15053979,22082:15053969,22083:15053972,22084:15053986,22085:15053978,22086:15053977,22087:15053976,22088:15054220,22089:15054226,22090:15054222,22091:15054219,22092:15054252,22093:15054259,22094:15054262,22095:15054471,22096:15054468,22097:15054466,22098:15054498,22099:15054493,22100:15054508,22101:15054510,22102:15054525,22103:15054480,22104:15054519,22105:15054524,22106:15054729,22107:15054733,22108:15054739,22109:15054738,22110:15054742,22111:15054747,22112:15054763,22113:15054770,22114:15054773,22115:15054987,22116:15055002,22117:15055001,22118:15054993,22119:15055003,22120:15055030,22121:15055031,22122:15055236,22123:15055235,22124:15055232,22125:15055246,22126:15055255,22127:15055252,22128:15055263,22129:15055266,22130:15055268,22131:15055239,22132:15055285,22133:15055286,22134:15055290,22135:15317692,22136:15055295,22137:15055520,22138:15055745,22139:15055746,22140:15055752,22141:15055760,22142:15055759,22305:15055766,22306:15055779,22307:15055773,22308:15055770,22309:15055771,22310:15055778,22311:15055777,22312:15055784,22313:15055785,22314:15055788,22315:15055793,22316:15055795,22317:15055792,22318:15055796,22319:15055800,22320:15055806,22321:15056003,22322:15056009,22323:15056285,22324:15056284,22325:15056011,22326:15056017,22327:15056022,22328:15056041,22329:15056045,22330:15056056,22331:15056257,22332:15056264,22333:15056268,22334:15056270,22335:15056047,22336:15056273,22337:15056278,22338:15056279,22339:15056281,22340:15056289,22341:15056301,22342:15056307,22343:15056311,22344:15056515,22345:15056514,22346:15056319,22347:15056522,22348:15056520,22349:15056529,22350:15056519,22351:15056542,22352:15056537,22353:15056536,22354:15056544,22355:15056552,22356:15056557,22357:15056572,22358:15056790,22359:15056827,22360:15056804,22361:15056824,22362:15056817,22363:15056797,22364:15106739,22365:15056831,22366:15106209,22367:15106464,22368:15106201,22369:15106192,22370:15106217,22371:15106190,22372:15106225,22373:15106203,22374:15106197,22375:15106219,22376:15106214,22377:15106191,22378:15106234,22379:15106458,22380:15106433,22381:15106474,22382:15106487,22383:15106463,22384:15106442,22385:15106438,22386:15106445,22387:15106467,22388:15106435,22389:15106468,22390:15106434,22391:15106476,22392:15106475,22393:15106457,22394:15106689,22395:15106701,22396:15106983,22397:15106691,22398:15106714,22561:15106692,22562:15106715,22563:15106710,22564:15106711,22565:15106706,22566:15106727,22567:15106699,22568:15106977,22569:15106744,22570:15106976,22571:15106963,22572:15106740,22573:15056816,22574:15106749,22575:15106950,22576:15106741,22577:15106968,22578:15107469,22579:15107221,22580:15107206,22581:15106998,22582:15106999,22583:15107200,22584:15106996,22585:15107002,22586:15107203,22587:15107233,22588:15107003,22589:15106993,22590:15107213,22591:15107214,22592:15107463,22593:15107262,22594:15107240,22595:15107239,22596:15107466,22597:15107263,22598:15107260,22599:15107244,22600:15107252,22601:15107261,22602:15107458,22603:15107460,22604:15107507,22605:15107511,22606:15107480,22607:15107481,22608:15107482,22609:15107499,22610:15107508,22611:15107503,22612:15107493,22613:15107505,22614:15107487,22615:15107485,22616:15107475,22617:15107509,22618:15107737,22619:15107734,22620:15107719,22621:15107756,22622:15107732,22623:15107738,22624:15107722,22625:15107729,22626:15107755,22627:15107758,22628:15107980,22629:15107978,22630:15107977,22631:15108023,22632:15107976,22633:15107971,22634:15107974,22635:15107770,22636:15107979,22637:15187385,22638:15107981,22639:15108006,22640:15108003,22641:15108022,22642:15108026,22643:15108020,22644:15108031,22645:15108029,22646:15108028,22647:15108030,22648:15108224,22649:15108232,22650:15108233,22651:15108237,22652:15108236,22653:15108244,22654:15108251,22817:15108254,22818:15108257,22819:15108266,22820:15108270,22821:15108272,22822:15108274,22823:15108275,22824:15108481,22825:15108494,22826:15108510,22827:15108515,22828:15108507,22829:15108512,22830:15108520,22831:15108540,22832:15108738,22833:15108745,22834:15108542,22835:15108754,22836:15108755,22837:15108758,22838:15109012,22839:15108739,22840:15108756,22841:15109015,22842:15109009,22843:15108795,22844:15109007,22845:15109055,22846:15108998,22847:15111060,22848:15109000,22849:15109020,22850:15109004,22851:15109002,22852:15108994,22853:15108999,22854:15108763,22855:15109001,22856:15109260,22857:15109038,22858:15109041,22859:15109287,22860:15109250,22861:15109256,22862:15109039,22863:15109045,22864:15109520,22865:15109310,22866:15109517,22867:15110300,22868:15109519,22869:15109782,22870:15109774,22871:15109760,22872:15109803,22873:15109558,22874:15109795,22875:15109775,22876:15109769,22877:15109791,22878:15109813,22879:15109547,22880:15109545,22881:15109822,22882:15110057,22883:15110016,22884:15110022,22885:15110051,22886:15110025,22887:15110034,22888:15110070,22889:15110020,22890:15110294,22891:15110324,22892:15110278,22893:15110291,22894:15110310,22895:15110326,22896:15111325,22897:15110295,22898:15110312,22899:15110287,22900:15110567,22901:15110575,22902:15110582,22903:15110542,22904:15111338,22905:15110805,22906:15110803,22907:15110821,22908:15110825,22909:15110792,22910:15110844,23073:15111066,23074:15111058,23075:15111045,23076:15111047,23077:15110843,23078:15111064,23079:15111042,23080:15111089,23081:15111079,23082:15239305,23083:15111072,23084:15111073,23085:15108780,23086:15111075,23087:15111087,23088:15111340,23089:15111094,23090:15111092,23091:15111090,23092:15111098,23093:15111296,23094:15111101,23095:15111320,23096:15111324,23097:15111301,23098:15111332,23099:15111331,23100:15111339,23101:15111348,23102:15111349,23103:15111351,23104:15111350,23105:15111352,23106:15177099,23107:15111560,23108:15111574,23109:15111573,23110:15111565,23111:15111576,23112:15111582,23113:15111581,23114:15111602,23115:15111608,23116:15111810,23117:15111811,23118:15249034,23119:15111835,23120:15111839,23121:15111851,23122:15111863,23123:15112067,23124:15112070,23125:15112065,23126:15112068,23127:15112076,23128:15112082,23129:15112091,23130:15112089,23131:15112096,23132:15112097,23133:15112113,23134:15113650,23135:15112330,23136:15112323,23137:15112123,23138:15113651,23139:15112373,23140:15112374,23141:15112372,23142:15112348,23143:15112591,23144:15112580,23145:15112585,23146:15112577,23147:15112606,23148:15112605,23149:15112612,23150:15112615,23151:15112616,23152:15112607,23153:15112610,23154:15112624,23155:15112835,23156:15112840,23157:15112846,23158:15112841,23159:15112836,23160:15112856,23161:15112861,23162:15113089,23163:15112889,23164:15113097,23165:15112894,23166:15112892,23329:15113092,23330:15112888,23331:15113110,23332:15113114,23333:15113120,23334:15112383,23335:15113126,23336:15113129,23337:15113136,23338:15113141,23339:15113143,23340:15113359,23341:15113366,23342:15113374,23343:15113382,23344:15113383,23345:15310008,23346:15113390,23347:15113407,23348:15113398,23349:15113601,23350:15113400,23351:15113399,23352:15113606,23353:15113630,23354:15113632,23355:15113625,23356:15113635,23357:15113636,23358:15113865,23359:15113648,23360:15113897,23361:15113660,23362:15113642,23363:15113868,23364:15113867,23365:15113894,23366:15113889,23367:15113861,23368:15113911,23369:15114159,23370:15113908,23371:15114156,23372:15113907,23373:15114153,23374:15113912,23375:15114148,23376:15114142,23377:15114141,23378:15114146,23379:15114158,23380:15113913,23381:15114126,23382:15114118,23383:15114151,23384:15116956,23385:15114398,23386:15114630,23387:15114409,23388:15114624,23389:15114637,23390:15114418,23391:15114638,23392:15114931,23393:15114411,23394:15114649,23395:15114659,23396:15114679,23397:15114687,23398:15114911,23399:15114895,23400:15114925,23401:15114900,23402:15114909,23403:15114907,23404:15114883,23405:15116974,23406:15114937,23407:15114676,23408:15114933,23409:15114912,23410:15114938,23411:15115407,23412:15114893,23413:15114686,23414:15115393,23415:15115146,23416:15115400,23417:15115160,23418:15115426,23419:15115430,23420:15115169,23421:15115404,23422:15115149,23585:15115156,23586:15115175,23587:15115157,23588:15115446,23589:15115410,23590:15115396,23591:15115159,23592:15115171,23593:15115429,23594:15115193,23595:15115168,23596:15115183,23597:15115432,23598:15115434,23599:15115418,23600:15115427,23601:15115425,23602:15115142,23603:15115705,23604:15115703,23605:15115676,23606:15115704,23607:15115691,23608:15115668,23609:15115710,23610:15115694,23611:15115449,23612:15115700,23613:15115453,23614:15115673,23615:15115440,23616:15115681,23617:15115678,23618:15115677,23619:15115905,23620:15115690,23621:15115954,23622:15115950,23623:15116176,23624:15115967,23625:15116161,23626:15116179,23627:15115966,23628:15116174,23629:15052712,23630:15116170,23631:15116189,23632:15115963,23633:15116163,23634:15115943,23635:15116462,23636:15115921,23637:15115936,23638:15115932,23639:15115925,23640:15115956,23641:15116190,23642:15116200,23643:15116418,23644:15116443,23645:15116223,23646:15117450,23647:15116217,23648:15116210,23649:15116199,23650:15116421,23651:15115953,23652:15116446,23653:15116205,23654:15116436,23655:15116203,23656:15116426,23657:15116434,23658:15117185,23659:15116451,23660:15116435,23661:15116676,23662:15116428,23663:15116722,23664:15116470,23665:15116728,23666:15116679,23667:15116706,23668:15116697,23669:15116710,23670:15116680,23671:15116472,23672:15116450,23673:15116944,23674:15116941,23675:15116960,23676:15116932,23677:15116962,23678:15116963,23841:15116951,23842:15243415,23843:15116987,23844:15117187,23845:15117186,23846:15116984,23847:15116979,23848:15116972,23849:15117214,23850:15117201,23851:15117215,23852:15116970,23853:15117210,23854:15117226,23855:15117243,23856:15117445,23857:15243414,23858:15117242,23859:15117458,23860:15117462,23861:15314097,23862:15117471,23863:15117496,23864:15117495,23865:15178652,23866:15117497,23867:15311790,23868:15117703,23869:15117699,23870:15117705,23871:15117712,23872:15117721,23873:15117716,23874:15117723,23875:15117727,23876:15117729,23877:15117752,23878:15117753,23879:15117759,23880:15117952,23881:15117956,23882:15117955,23883:15117965,23884:15117976,23885:15117973,23886:15117982,23887:15117988,23888:15117994,23889:15117995,23890:15117999,23891:15118002,23892:15118001,23893:15118003,23894:15118007,23895:15118012,23896:15118214,23897:15118219,23898:15118227,23899:15118239,23900:15118252,23901:15118251,23902:15118259,23903:15118255,23904:15317694,23905:15118472,23906:15118483,23907:15118484,23908:15118491,23909:15118500,23910:15118499,23911:15118750,23912:15118741,23913:15118754,23914:15118762,23915:15118978,23916:15118989,23917:15119002,23918:15118977,23919:15119003,23920:15118782,23921:15118760,23922:15118771,23923:15118994,23924:15118992,23925:15119236,23926:15119281,23927:15119251,23928:15119037,23929:15119255,23930:15119237,23931:15119261,23932:15119022,23933:15119025,23934:15119038,24097:15119034,24098:15119259,24099:15119279,24100:15119257,24101:15119274,24102:15119519,24103:15245709,24104:15119542,24105:15119531,24106:15119549,24107:15119544,24108:15119513,24109:15119541,24110:15119539,24111:15119506,24112:15119500,24113:15119779,24114:15120019,24115:15119780,24116:15119770,24117:15119801,24118:15119769,24119:15120014,24120:15120021,24121:15122340,24122:15120005,24123:15120313,24124:15120533,24125:15120522,24126:15120053,24127:15120263,24128:15120294,24129:15120056,24130:15120262,24131:15120300,24132:15120286,24133:15120268,24134:15120296,24135:15120274,24136:15120261,24137:15120314,24138:15120281,24139:15120292,24140:15120277,24141:15120298,24142:15120302,24143:15120557,24144:15120814,24145:15120558,24146:15120537,24147:15120818,24148:15120799,24149:15120574,24150:15120547,24151:15120811,24152:15120555,24153:15120822,24154:15120781,24155:15120543,24156:15120771,24157:15120570,24158:15120782,24159:15120548,24160:15121343,24161:15120541,24162:15120568,24163:15121026,24164:15121066,24165:15121048,24166:15121289,24167:15121079,24168:15121299,24169:15121085,24170:15121071,24171:15121284,24172:15121074,24173:15121300,24174:15121301,24175:15121039,24176:15121061,24177:15121282,24178:15121055,24179:15121793,24180:15121553,24181:15171980,24182:15121324,24183:15121336,24184:15121342,24185:15121599,24186:15121330,24187:15121585,24188:15121327,24189:15121586,24190:15121292,24353:15121598,24354:15121555,24355:15121335,24356:15122054,24357:15121850,24358:15121848,24359:15122049,24360:15122048,24361:15121839,24362:15121819,24363:15122355,24364:15121837,24365:15122050,24366:15121852,24367:15121816,24368:15122062,24369:15122065,24370:15122306,24371:15121830,24372:15122099,24373:15122083,24374:15122081,24375:15122084,24376:15122105,24377:15122310,24378:15122090,24379:15122335,24380:15122325,24381:15122348,24382:15122324,24383:15122328,24384:15122353,24385:15122350,24386:15122331,24387:15171721,24388:15171723,24389:15122362,24390:15171729,24391:15171713,24392:15171727,24393:15122366,24394:15171739,24395:15171738,24396:15121844,24397:15171741,24398:15171736,24399:15171743,24400:15171760,24401:15171774,24402:15171762,24403:15171985,24404:15172003,24405:15172249,24406:15172242,24407:15172271,24408:15172529,24409:15172268,24410:15172280,24411:15172275,24412:15172270,24413:15172511,24414:15172491,24415:15172509,24416:15172505,24417:15172745,24418:15172541,24419:15172764,24420:15172761,24421:15173029,24422:15173013,24423:15173256,24424:15173030,24425:15173026,24426:15173004,24427:15173014,24428:15173036,24429:15173263,24430:15173563,24431:15173252,24432:15173269,24433:15173288,24434:15173292,24435:15173527,24436:15173305,24437:15173310,24438:15173522,24439:15173513,24440:15173524,24441:15173518,24442:15173536,24443:15173548,24444:15173543,24445:15173557,24446:15173564,24609:15173561,24610:15173567,24611:15173773,24612:15173776,24613:15173787,24614:15173800,24615:15173805,24616:15173804,24617:15173808,24618:15173810,24619:15173819,24620:15173820,24621:15173823,24622:15174016,24623:15174022,24624:15174027,24625:15174040,24626:15174068,24627:15174078,24628:15174274,24629:15174273,24630:15174279,24631:15174290,24632:15174294,24633:15174306,24634:15174311,24635:15174329,24636:15174322,24637:15174531,24638:15174534,24639:15174532,24640:15174542,24641:15174546,24642:15174562,24643:15174560,24644:15174561,24645:15174585,24646:15174583,24647:15040655,24648:15174807,24649:15174794,24650:15174812,24651:15174806,24652:15174813,24653:15174836,24654:15174831,24655:15174825,24656:15174821,24657:15174846,24658:15175054,24659:15175055,24660:15317912,24661:15175063,24662:15175082,24663:15175080,24664:15175088,24665:15175096,24666:15175093,24667:15175099,24668:15175098,24669:15175560,24670:15175347,24671:15175566,24672:15175355,24673:15175552,24674:15175589,24675:15175598,24676:15175582,24677:15176354,24678:15175813,24679:15176111,24680:15175845,24681:15175608,24682:15175858,24683:15175866,24684:15176085,24685:15175871,24686:15176095,24687:15176089,24688:15176065,24689:15176092,24690:15176105,24691:15176112,24692:15176099,24693:15176106,24694:15176118,24695:15176126,24696:15176331,24697:15176350,24698:15176359,24699:15176586,24700:15176591,24701:15176596,24702:15175601,24865:15176608,24866:15176611,24867:15176615,24868:15176617,24869:15176622,24870:15176626,24871:15176624,24872:15176625,24873:15176632,24874:15176631,24875:15176836,24876:15176835,24877:15176837,24878:15176844,24879:15176846,24880:15176845,24881:15176853,24882:15176851,24883:15176862,24884:15176870,24885:15176876,24886:15176892,24887:15177092,24888:15177101,24889:15177098,24890:15177097,24891:15177115,24892:15177094,24893:15177114,24894:15177129,24895:15177124,24896:15177127,24897:15177131,24898:15177133,24899:15177144,24900:15177142,24901:15177350,24902:15177351,24903:15177140,24904:15177354,24905:15177353,24906:15177346,24907:15177364,24908:15177370,24909:15177373,24910:15177381,24911:15177379,24912:15177602,24913:15177395,24914:15177603,24915:15177397,24916:15177405,24917:15177400,24918:15177404,24919:15177393,24920:15177613,24921:15177610,24922:15177618,24923:15177625,24924:15177635,24925:15177630,24926:15177662,24927:15177663,24928:15177660,24929:15177857,24930:15177648,24931:15177658,24932:15177650,24933:15177651,24934:15177867,24935:15177869,24936:15177865,24937:15177887,24938:15177895,24939:15177888,24940:15177889,24941:15177890,24942:15177892,24943:15177908,24944:15177904,24945:15177915,24946:15178119,24947:15178120,24948:15178118,24949:15178140,24950:15178136,24951:15178145,24952:15178146,24953:15178152,24954:15178153,24955:15178154,24956:15178151,24957:15178156,24958:15178160,25121:15178162,25122:15178166,25123:15178168,25124:15178172,25125:15178368,25126:15178371,25127:15178376,25128:15178379,25129:15178382,25130:15178390,25131:15178387,25132:15178393,25133:15178394,25134:15178416,25135:15178420,25136:15178424,25137:15178425,25138:15178426,25139:15178626,25140:15178637,25141:15178646,25142:15178642,25143:15178654,25144:15178657,25145:15178661,25146:15178663,25147:15178666,25148:15243439,25149:15178683,25150:15178888,25151:15178887,25152:15178884,25153:15178921,25154:15178916,25155:15178910,25156:15178917,25157:15178918,25158:15178907,25159:15178935,25160:15178936,25161:15179143,25162:15179162,25163:15179176,25164:15179179,25165:15179163,25166:15179173,25167:15179199,25168:15179198,25169:15179193,25170:15179406,25171:15179403,25172:15179409,25173:15179424,25174:15179422,25175:15179440,25176:15179446,25177:15179449,25178:15179455,25179:15179452,25180:15179453,25181:15179451,25182:15179655,25183:15179661,25184:15179671,25185:15179674,25186:15179676,25187:15179683,25188:15179694,25189:15179708,25190:15179916,25191:15179922,25192:15180966,25193:15179936,25194:15180970,25195:15180165,25196:15180430,25197:15180212,25198:15180422,25199:15180220,25200:15180442,25201:15180428,25202:15180451,25203:15180469,25204:15180458,25205:15180463,25206:15180689,25207:15180678,25208:15180683,25209:15180692,25210:15180478,25211:15180476,25212:15180677,25213:15180682,25214:15180716,25377:15180711,25378:15180698,25379:15180733,25380:15180724,25381:15180935,25382:15180946,25383:15180945,25384:15180953,25385:15180972,25386:15180971,25387:15181184,25388:15181216,25389:15181207,25390:15181215,25391:15181210,25392:15181205,25393:15181203,25394:15181242,25395:15181247,25396:15181450,25397:15181469,25398:15181479,25399:15318411,25400:15181482,25401:15181486,25402:15181491,25403:15181497,25404:15181498,25405:15181705,25406:15181717,25407:15181735,25408:15181740,25409:15181729,25410:15181731,25411:15181960,25412:15181965,25413:15181976,25414:15181977,25415:15181984,25416:15181983,25417:15181440,25418:15182001,25419:15182011,25420:15182014,25421:15182007,25422:15182211,25423:15182231,25424:15182217,25425:15182241,25426:15182242,25427:15182249,25428:15318685,25429:15182256,25430:15182265,25431:15182269,25432:15182472,25433:15182487,25434:15182485,25435:15182488,25436:15182486,25437:15182505,25438:15182728,25439:15182512,25440:15182518,25441:15182725,25442:15182724,25443:15182527,25444:15303299,25445:15182727,25446:15182730,25447:15182733,25448:15182735,25449:15182741,25450:15182739,25451:15182745,25452:15182746,25453:15182749,25454:15182753,25455:15182754,25456:15182758,25457:15182765,25458:15182768,25459:15182978,25460:15182991,25461:15182986,25462:15182982,25463:15183027,25464:15183000,25465:15183001,25466:15183006,25467:15183029,25468:15183016,25469:15183030,25470:15183248,25633:15183290,25634:15182980,25635:15183245,25636:15182987,25637:15183244,25638:15183237,25639:15183285,25640:15183269,25641:15183284,25642:15183271,25643:15183280,25644:15183281,25645:15183276,25646:15183278,25647:15183517,25648:15183512,25649:15183519,25650:15183501,25651:15183516,25652:15183514,25653:15183499,25654:15183506,25655:15183503,25656:15183261,25657:15183513,25658:15183755,25659:15183745,25660:15183756,25661:15183759,25662:15183540,25663:15183750,25664:15183773,25665:15183785,25666:15184017,25667:15184020,25668:15183782,25669:15183781,25670:15184288,25671:15184000,25672:15184007,25673:15184019,25674:15183795,25675:15183799,25676:15184023,25677:15184013,25678:15183798,25679:15184035,25680:15184039,25681:15184042,25682:15184031,25683:15184055,25684:15184043,25685:15184061,25686:15184268,25687:15184259,25688:15184276,25689:15184271,25690:15184256,25691:15184272,25692:15184280,25693:15184287,25694:15184292,25695:15184278,25696:15184293,25697:15184300,25698:15184309,25699:15184515,25700:15184528,25701:15184548,25702:15184557,25703:15184546,25704:15184555,25705:15184545,25706:15184552,25707:15184563,25708:15184562,25709:15184561,25710:15184558,25711:15184569,25712:15184573,25713:15184768,25714:15184773,25715:15184770,25716:15184792,25717:15184786,25718:15184796,25719:15184802,25720:15314107,25721:15184815,25722:15184818,25723:15184820,25724:15184822,25725:15184826,25726:15185030,25889:15185026,25890:15185052,25891:15185045,25892:15185034,25893:15185285,25894:15185291,25895:15185070,25896:15185074,25897:15185087,25898:15185077,25899:15185286,25900:15185331,25901:15185302,25902:15185294,25903:15185330,25904:15185320,25905:15185326,25906:15185295,25907:15185315,25908:15185555,25909:15185545,25910:15185307,25911:15185551,25912:15185341,25913:15185563,25914:15185594,25915:15185582,25916:15185571,25917:15185589,25918:15185799,25919:15185597,25920:15185579,25921:15186109,25922:15185570,25923:15185583,25924:15185820,25925:15185592,25926:15185567,25927:15185584,25928:15185816,25929:15185821,25930:15185828,25931:15185822,25932:15185851,25933:15185842,25934:15185825,25935:15186053,25936:15186058,25937:15186083,25938:15186081,25939:15186066,25940:15186097,25941:15186079,25942:15186057,25943:15186059,25944:15186082,25945:15186310,25946:15186342,25947:15186107,25948:15186101,25949:15186105,25950:15186307,25951:15186103,25952:15186098,25953:15186106,25954:15186343,25955:15186333,25956:15186326,25957:15186334,25958:15186329,25959:15186330,25960:15186361,25961:15186346,25962:15186345,25963:15186364,25964:15186363,25965:15186563,25966:15185813,25967:15186365,25968:15253166,25969:15186367,25970:15186568,25971:15186569,25972:15186572,25973:15186578,25974:15186576,25975:15186579,25976:15186580,25977:15186582,25978:15186574,25979:15186587,25980:15186588,25981:15187128,25982:15187130,26145:15187333,26146:15187340,26147:15187341,26148:15187342,26149:15187344,26150:15187345,26151:15187349,26152:15187348,26153:15187352,26154:15187359,26155:15187360,26156:15187368,26157:15187369,26158:15187367,26159:15187384,26160:15187586,26161:15187590,26162:15187587,26163:15187592,26164:15187591,26165:15187596,26166:15187604,26167:15187614,26168:15187613,26169:15187610,26170:15187619,26171:15187631,26172:15187634,26173:15187641,26174:15187630,26175:15187638,26176:15187640,26177:15248817,26178:15187845,26179:15187846,26180:15187850,26181:15187861,26182:15187860,26183:15187873,26184:15187878,26185:15187881,26186:15187891,26187:15187897,26188:15311772,26189:15237254,26190:15237252,26191:15237259,26192:15237266,26193:15237272,26194:15237273,26195:15237276,26196:15237281,26197:15237288,26198:15237311,26199:15237307,26200:15237514,26201:15237510,26202:15237522,26203:15237528,26204:15237530,26205:15237535,26206:15237538,26207:15237544,26208:15237555,26209:15237554,26210:15237552,26211:15237558,26212:15237561,26213:15237565,26214:15237567,26215:15237764,26216:15237766,26217:15237765,26218:15237787,26219:15237779,26220:15237786,26221:15237805,26222:15042192,26223:15237804,26224:15238043,26225:15238053,26226:15238041,26227:15238045,26228:15238020,26229:15238042,26230:15238038,26231:15238281,26232:15238063,26233:15238065,26234:15238299,26235:15238313,26236:15238307,26237:15238319,26238:15238539,26401:15309451,26402:15238534,26403:15238334,26404:15238547,26405:15238545,26406:15238076,26407:15238577,26408:15238574,26409:15238565,26410:15238566,26411:15238580,26412:15238787,26413:15238792,26414:15238794,26415:15238784,26416:15238786,26417:15238816,26418:15238805,26419:15238820,26420:15238819,26421:15238559,26422:15238803,26423:15238825,26424:15238832,26425:15238837,26426:15238846,26427:15238840,26428:15238845,26429:15239040,26430:15239042,26431:15238842,26432:15239049,26433:15239053,26434:15239057,26435:15239065,26436:15239064,26437:15239048,26438:15239066,26439:15239071,26440:15239072,26441:15239079,26442:15239098,26443:15239099,26444:15239102,26445:15239297,26446:15239298,26447:15239301,26448:15239303,26449:15239306,26450:15239309,26451:15239312,26452:15239318,26453:15239337,26454:15239339,26455:15239352,26456:15239347,26457:15239552,26458:15239577,26459:15239576,26460:15239581,26461:15239578,26462:15239583,26463:15239588,26464:15239586,26465:15239592,26466:15239594,26467:15239595,26468:15239342,26469:15239601,26470:15239607,26471:15239608,26472:15239614,26473:15239821,26474:15239826,26475:15239851,26476:15239839,26477:15239867,26478:15239852,26479:15240097,26480:15240099,26481:15240095,26482:15240082,26483:15240116,26484:15240115,26485:15240122,26486:15240851,26487:15240323,26488:15240123,26489:15240121,26490:15240094,26491:15240326,26492:15240092,26493:15240329,26494:15240089,26657:15240373,26658:15240372,26659:15240342,26660:15240370,26661:15240369,26662:15240576,26663:15240377,26664:15240592,26665:15240581,26666:15240367,26667:15240363,26668:15240343,26669:15240344,26670:15240837,26671:15240858,26672:15240874,26673:15240863,26674:15240866,26675:15240854,26676:15240355,26677:15240846,26678:15240839,26679:15240842,26680:15240636,26681:15240885,26682:15240627,26683:15240629,26684:15240864,26685:15240841,26686:15240872,26687:15241140,26688:15241363,26689:15241131,26690:15241102,26691:15241149,26692:15241347,26693:15241112,26694:15241355,26695:15241089,26696:15241143,26697:15241351,26698:15241120,26699:15241138,26700:15241357,26701:15241378,26702:15241376,26703:15240893,26704:15241400,26705:15242374,26706:15241147,26707:15241645,26708:15241386,26709:15241404,26710:15242650,26711:15241860,26712:15241655,26713:15241643,26714:15241901,26715:15241646,26716:15241858,26717:15241641,26718:15241606,26719:15241388,26720:15241647,26721:15241657,26722:15241397,26723:15242122,26724:15241634,26725:15241913,26726:15241919,26727:15241887,26728:15242137,26729:15242125,26730:15241915,26731:15242138,26732:15242128,26733:15242113,26734:15242118,26735:15242134,26736:15241889,26737:15242401,26738:15242175,26739:15242164,26740:15242391,26741:15242392,26742:15242412,26743:15242399,26744:15242389,26745:15242388,26746:15242172,26747:15242624,26748:15242659,26749:15242648,26750:15242632,26913:15242625,26914:15243394,26915:15242635,26916:15242645,26917:15242880,26918:15242916,26919:15242888,26920:15242897,26921:15242890,26922:15242920,26923:15242669,26924:15242900,26925:15242907,26926:15243178,26927:15242887,26928:15242908,26929:15242679,26930:15242686,26931:15242896,26932:15243145,26933:15242938,26934:15243151,26935:15242937,26936:15243152,26937:15243157,26938:15243165,26939:15243173,26940:15243164,26941:15243193,26942:15243402,26943:15243411,26944:15243403,26945:15243198,26946:15243194,26947:15243398,26948:15243426,26949:15243418,26950:15243440,26951:15243455,26952:15243661,26953:14989717,26954:15243668,26955:15243679,26956:15243687,26957:15243697,26958:15243923,26959:15243939,26960:15243945,26961:15243946,26962:15243915,26963:15243916,26964:15243958,26965:15243951,26966:15244164,26967:15244166,26968:15243952,26969:15244169,26970:15245475,26971:15243947,26972:15244180,26973:15244190,26974:15244201,26975:15244204,26976:15244191,26977:15244187,26978:15244207,26979:15244434,26980:15244422,26981:15244424,26982:15244416,26983:15244419,26984:15244219,26985:15244433,26986:15244425,26987:15244429,26988:15244217,26989:15244426,26990:15244468,26991:15244479,26992:15244471,26993:15244475,26994:15244453,26995:15244457,26996:15244442,26997:15244704,26998:15244703,26999:15244728,27000:15244684,27001:15244686,27002:15244724,27003:15244695,27004:15244712,27005:15244718,27006:15244697,27169:15244691,27170:15244707,27171:15244714,27172:15245445,27173:15244962,27174:15244959,27175:15244930,27176:15244975,27177:15245195,27178:15244989,27179:15245184,27180:15245200,27181:15309718,27182:15244971,27183:15245188,27184:15244979,27185:15245191,27186:15245190,27187:15244987,27188:15245231,27189:15245234,27190:15245216,27191:15245455,27192:15245453,27193:15245246,27194:15245238,27195:15245239,27196:15245454,27197:15245202,27198:15245457,27199:15245462,27200:15245461,27201:15245474,27202:15245473,27203:15245489,27204:15245494,27205:15245497,27206:15245479,27207:15245499,27208:15245700,27209:15245698,27210:15245714,27211:15245721,27212:15245726,27213:15245730,27214:15245739,27215:15245953,27216:15245758,27217:15245982,27218:15245749,27219:15245757,27220:15246005,27221:15245746,27222:15245954,27223:15245975,27224:15245970,27225:15245998,27226:15245977,27227:15245986,27228:15245965,27229:15245988,27230:15246000,27231:15246015,27232:15246001,27233:15246211,27234:15246212,27235:15246228,27236:15246232,27237:15246233,27238:15246237,27239:15246265,27240:15246466,27241:15246268,27242:15246260,27243:15246248,27244:15246258,27245:15246468,27246:15246476,27247:15246474,27248:15246483,27249:15246723,27250:15246494,27251:15246501,27252:15246506,27253:15246507,27254:15246721,27255:15246724,27256:15246523,27257:15246518,27258:15246520,27259:15246732,27260:15246493,27261:15246752,27262:15246750,27425:15246758,27426:15246756,27427:15246765,27428:15246762,27429:15246767,27430:15246772,27431:15246775,27432:15246782,27433:15246979,27434:15246984,27435:15246986,27436:15246995,27437:15247000,27438:15247009,27439:15247017,27440:15247014,27441:15247020,27442:15247023,27443:15247026,27444:15247034,27445:15247037,27446:15247039,27447:15247232,27448:15247258,27449:15247260,27450:15247261,27451:15247271,27452:15247284,27453:15247288,27454:15247491,27455:15247510,27456:15247504,27457:15247500,27458:15247515,27459:15247517,27460:15247525,27461:15247542,27462:15247745,27463:15247771,27464:15247762,27465:15247750,27466:15247752,27467:15247804,27468:15247789,27469:15247788,27470:15247778,27471:15248005,27472:15248002,27473:15248004,27474:15248040,27475:15248033,27476:15248017,27477:15248037,27478:15248038,27479:15248026,27480:15248035,27481:15248260,27482:15248269,27483:15248258,27484:15248282,27485:15248299,27486:15248307,27487:15248295,27488:15248292,27489:15248305,27490:15248532,27491:15248288,27492:15248290,27493:15248311,27494:15248286,27495:15248283,27496:15248524,27497:15248519,27498:15248538,27499:15248289,27500:15248534,27501:15248528,27502:15248535,27503:15248544,27504:15248563,27505:15310507,27506:15248550,27507:15248555,27508:15248574,27509:15248552,27510:15248769,27511:15248780,27512:15248783,27513:15248782,27514:15248777,27515:15248790,27516:15248795,27517:15248794,27518:15248811,27681:15248799,27682:15248812,27683:15248815,27684:15248820,27685:15248829,27686:15249024,27687:15249036,27688:15249038,27689:15249042,27690:15249043,27691:15249046,27692:15249049,27693:15249050,27694:15249594,27695:15249793,27696:15249599,27697:15249800,27698:15249804,27699:15249806,27700:15249808,27701:15249813,27702:15249826,27703:15249836,27704:15249848,27705:15249850,27706:15250050,27707:15250057,27708:15250053,27709:15250058,27710:15250061,27711:15250062,27712:15250068,27713:15249852,27714:15250072,27715:15108253,27716:15250093,27717:15250090,27718:15250109,27719:15250098,27720:15250099,27721:15250094,27722:15250102,27723:15250312,27724:15250305,27725:15250340,27726:15250339,27727:15250330,27728:15250365,27729:15250362,27730:15250363,27731:15250564,27732:15250565,27733:15250570,27734:15250567,27735:15250575,27736:15250573,27737:15250576,27738:15318414,27739:15250579,27740:15250317,27741:15250580,27742:15250582,27743:15250855,27744:15250861,27745:15250865,27746:15250867,27747:15251073,27748:15251097,27749:15251330,27750:15251134,27751:15251130,27752:15251343,27753:15251354,27754:15251350,27755:15251340,27756:15251355,27757:15251339,27758:15251370,27759:15251371,27760:15251359,27761:15251363,27762:15251388,27763:15251592,27764:15251593,27765:15251391,27766:15251613,27767:15251614,27768:15251600,27769:15251615,27770:15251842,27771:15251637,27772:15251632,27773:15251636,27774:15251850,27937:15251847,27938:15251849,27939:15251852,27940:15251856,27941:15251848,27942:15251865,27943:15251876,27944:15251872,27945:15251626,27946:15251875,27947:15251861,27948:15251894,27949:15251890,27950:15251900,27951:15252097,27952:15252103,27953:15252101,27954:15252100,27955:15252107,27956:15252106,27957:15252115,27958:15252113,27959:15252116,27960:15252121,27961:15252138,27962:15252129,27963:15252140,27964:15252144,27965:15252358,27966:15252145,27967:15252158,27968:15252357,27969:15252360,27970:15252363,27971:15252379,27972:15252387,27973:15252412,27974:15252411,27975:15252395,27976:15252414,27977:15252618,27978:15252613,27979:15252629,27980:15252626,27981:15252633,27982:15252627,27983:15252636,27984:15252639,27985:15252635,27986:15252620,27987:15252646,27988:15252659,27989:15252667,27990:15252665,27991:15252869,27992:15252866,27993:15252670,27994:15252876,27995:15252873,27996:15252870,27997:15252878,27998:15252887,27999:15252892,28000:15252898,28001:15252899,28002:15252900,28003:15253148,28004:15253151,28005:15253155,28006:15253165,28007:15253167,28008:15253175,28009:15253402,28010:15253413,28011:15253410,28012:15253418,28013:15253423,28014:15303303,28015:15253428,28016:15302789,28017:15253433,28018:15253434,28019:15302801,28020:15302805,28021:15302817,28022:15302797,28023:15302814,28024:15302806,28025:15302795,28026:15302823,28027:15302838,28028:15302837,28029:15302841,28030:15253432,28193:15303055,28194:15303056,28195:15303057,28196:15303058,28197:15302798,28198:15303049,28199:15302846,28200:15303062,28201:15303064,28202:15303070,28203:15303080,28204:15303087,28205:15303094,28206:15309480,28207:15303090,28208:15303298,28209:15303101,28210:15303297,28211:15303296,28212:15303306,28213:15303305,28214:15303311,28215:15303336,28216:15303343,28217:15303345,28218:15303349,28219:15303586,28220:15303588,28221:15108488,28222:15303579,28223:15303810,28224:15303826,28225:15303833,28226:15303858,28227:15303856,28228:15304074,28229:15304086,28230:15304088,28231:15304099,28232:15304101,28233:15304105,28234:15304115,28235:15304114,28236:15304331,28237:15304329,28238:15304322,28239:15304354,28240:15304363,28241:15304367,28242:15304362,28243:15304373,28244:15304372,28245:15304378,28246:15304576,28247:15304577,28248:15304585,28249:15304587,28250:15304592,28251:15304598,28252:15304607,28253:15304609,28254:15304603,28255:15304636,28256:15304629,28257:15304630,28258:15304862,28259:15304639,28260:15304852,28261:15304876,28262:15304853,28263:15304849,28264:15305118,28265:15305111,28266:15305093,28267:15305097,28268:15305124,28269:15305096,28270:15305365,28271:15304895,28272:15305099,28273:15305104,28274:15305372,28275:15305366,28276:15305363,28277:15305371,28278:15305114,28279:15305615,28280:15305401,28281:15305399,28282:15305641,28283:15305871,28284:15305658,28285:15306116,28286:15305902,28449:15305881,28450:15305890,28451:15305882,28452:15305891,28453:15305914,28454:15305909,28455:15305915,28456:15306140,28457:15306144,28458:15306172,28459:15306158,28460:15306134,28461:15306416,28462:15306412,28463:15306413,28464:15306388,28465:15306425,28466:15306646,28467:15306647,28468:15306664,28469:15306661,28470:15306648,28471:15306627,28472:15306653,28473:15306640,28474:15306632,28475:15306660,28476:15306906,28477:15306900,28478:15306899,28479:15306883,28480:15306887,28481:15306896,28482:15306934,28483:15306923,28484:15306933,28485:15306913,28486:15306938,28487:15307137,28488:15307154,28489:15307140,28490:15307163,28491:15307168,28492:15307170,28493:15307166,28494:15307178,28495:15304873,28496:15307184,28497:15307189,28498:15307191,28499:15307197,28500:15307162,28501:15307196,28502:15307198,28503:15307393,28504:15307199,28505:15308418,28506:15308423,28507:15308426,28508:15308436,28509:15308438,28510:15308440,28511:15308441,28512:15308448,28513:15308456,28514:15308455,28515:15308461,28516:15308476,28517:15308475,28518:15308473,28519:15308478,28520:15308682,28521:15122358,28522:15308675,28523:15308685,28524:15308684,28525:15308693,28526:15308692,28527:15308694,28528:15308700,28529:15308705,28530:15308709,28531:15308706,28532:15308961,28533:15308968,28534:15308974,28535:15308975,28536:15309186,28537:15309196,28538:15309199,28539:15309195,28540:15309239,28541:15309212,28542:15309214,28705:15309213,28706:15309215,28707:15309222,28708:15309234,28709:15309228,28710:15309453,28711:15309464,28712:15309461,28713:15309463,28714:15309482,28715:15309479,28716:15309489,28717:15309490,28718:15309488,28719:15309492,28720:15309494,28721:15309496,28722:15309497,28723:15309710,28724:15309707,28725:15309705,28726:15309709,28727:15246733,28728:15309724,28729:15309965,28730:15309717,28731:15309753,28732:15309956,28733:15309958,28734:15309960,28735:15309971,28736:15309966,28737:15309969,28738:15309967,28739:15309974,28740:15309977,28741:15309988,28742:15309994,28743:15310000,28744:15310009,28745:15310013,28746:15310014,28747:15310212,28748:15310214,28749:15310216,28750:15310210,28751:15310217,28752:15310236,28753:15310240,28754:15310244,28755:15310246,28756:15310248,28757:15043474,28758:15310251,28759:15310257,28760:15310265,28761:15310469,28762:15310268,28763:15310465,28764:15310266,28765:15310470,28766:15310475,28767:15310479,28768:15310480,28769:15310492,28770:15310504,28771:15310502,28772:15310499,28773:15310515,28774:15310516,28775:15310723,28776:15310726,28777:15310728,28778:15310731,28779:15310748,28780:15310765,28781:15318415,28782:15310770,28783:15182751,28784:15310774,28785:15310773,28786:15310991,28787:15310988,28788:15311032,28789:15311012,28790:15311009,28791:15311031,28792:15311037,28793:15311238,28794:15311247,28795:15311243,28796:15311275,28797:15311279,28798:15311280,28961:15311281,28962:15311284,28963:15311283,28964:15311530,28965:15311535,28966:15311537,28967:15311542,28968:15311748,28969:15311747,28970:15311750,28971:15311785,28972:15311787,28973:15312003,28974:15312009,28975:15312018,28976:15312020,28977:15312024,28978:15312033,28979:15312029,28980:15312030,28981:15312036,28982:15312032,28983:15312044,28984:15312046,28985:15312061,28986:15312062,28987:15312258,28988:15312265,28989:15312261,28990:15312272,28991:15312267,28992:15312273,28993:15312274,28994:15312268,28995:15312277,28996:15312535,28997:15312536,28998:15312549,28999:15312557,29000:15312558,29001:15312572,29002:15312799,29003:15312795,29004:15312797,29005:15312792,29006:15312785,29007:15312813,29008:15312814,29009:15312817,29010:15312818,29011:15312827,29012:15312824,29013:15313025,29014:15313039,29015:15313029,29016:15312802,29017:15313049,29018:15313067,29019:15313079,29020:15313285,29021:15313282,29022:15313280,29023:15313283,29024:15313086,29025:15313301,29026:15313293,29027:15313307,29028:15313303,29029:15313311,29030:15313314,29031:15313317,29032:15313316,29033:15313321,29034:15313323,29035:15313322,29036:15313581,29037:15313584,29038:15313596,29039:15313792,29040:15313807,29041:15313809,29042:15313811,29043:15313812,29044:15313822,29045:15313823,29046:15313826,29047:15313827,29048:15313830,29049:15313839,29050:15313835,29051:15313838,29052:15313844,29053:15313841,29054:15313847,29217:15313851,29218:15314054,29219:15314072,29220:15314074,29221:15314079,29222:15314082,29223:15314083,29224:15314085,29225:15314087,29226:15314088,29227:15314089,29228:15314090,29229:15314094,29230:15314095,29231:15314098,29232:15314308,29233:15314307,29234:15314319,29235:15314317,29236:15314318,29237:15314321,29238:15314328,29239:15314356,29240:15314579,29241:15314563,29242:15314577,29243:15314582,29244:15314583,29245:15314591,29246:15314592,29247:15314600,29248:15314612,29249:15314816,29250:15314826,29251:15314617,29252:15314822,29253:15314831,29254:15314833,29255:15314834,29256:15314851,29257:15314850,29258:15314852,29259:15314836,29260:15314849,29261:15315130,29262:15314866,29263:15314865,29264:15314864,29265:15315093,29266:15315092,29267:15315081,29268:15315091,29269:15315084,29270:15315078,29271:15315080,29272:15315090,29273:15315082,29274:15315076,29275:15315118,29276:15315099,29277:15315109,29278:15315108,29279:15315105,29280:15315120,29281:15315335,29282:15315122,29283:15315334,29284:15315134,29285:15315354,29286:15315360,29287:15315367,29288:15315382,29289:15315384,29290:15315879,29291:15315884,29292:15315888,29293:15316105,29294:15316104,29295:15315883,29296:15316099,29297:15316102,29298:15316138,29299:15316134,29300:15316655,29301:15316131,29302:15316127,29303:15316356,29304:15316117,29305:15316114,29306:15316353,29307:15316159,29308:15316158,29309:15316358,29310:15316360,29473:15316381,29474:15316382,29475:15316388,29476:15316369,29477:15316368,29478:15316377,29479:15316402,29480:15316617,29481:15316615,29482:15316651,29483:15316399,29484:15316410,29485:15316634,29486:15316644,29487:15316649,29488:15316658,29489:15316868,29490:15316865,29491:15316667,29492:15316664,29493:15316666,29494:15316870,29495:15316879,29496:15316866,29497:15316889,29498:15316883,29499:15316920,29500:15316902,29501:15316909,29502:15316911,29503:15316925,29504:15317146,29505:15317147,29506:15317150,29507:15317429,29508:15317433,29509:15317437,29510:15317633,29511:15317640,29512:15317643,29513:15317644,29514:15317650,29515:15317653,29516:15317649,29517:15317661,29518:15317669,29519:15317673,29520:15317688,29521:15317674,29522:15317677,29523:15310241,29524:15317900,29525:15317902,29526:15317903,29527:15317904,29528:15317908,29529:15317916,29530:15317918,29531:15317917,29532:15317920,29533:15317925,29534:15317928,29535:15317935,29536:15317940,29537:15317942,29538:15317943,29539:15317945,29540:15317947,29541:15317948,29542:15317949,29543:15318151,29544:15318152,29545:15178423,29546:15318165,29547:15318177,29548:15318188,29549:15318206,29550:15318410,29551:15318418,29552:15318420,29553:15318435,29554:15318431,29555:15318432,29556:15318433,29557:15318438,29558:15318439,29559:15318444,29560:15318442,29561:15318455,29562:15318450,29563:15318454,29564:15318677,29565:15318684,29566:15318688,29729:15048879,29730:15116167,29731:15303065,29732:15176100,29733:15042460,29734:15173273};THREE.MMD.Encoding=_}();

THREE.LineSegments=function(c,d){THREE.Line.call(this,c,d),this.type="LineSegments"},THREE.LineSegments.prototype=Object.assign(Object.create(THREE.Line.prototype),{constructor:THREE.LineSegments}),THREE.CameraHelper=function(c){function d(p,q,r){e(p,r),e(q,r)}function e(p,q){f.vertices.push(new THREE.Vector3),f.colors.push(new THREE.Color(q)),j[p]===void 0&&(j[p]=[]),j[p].push(f.vertices.length-1)}var f=new THREE.Geometry,g=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),j={},k=16755200,l=16711680,m=43775,o=3355443;d("n1","n2",k),d("n2","n4",k),d("n4","n3",k),d("n3","n1",k),d("f1","f2",k),d("f2","f4",k),d("f4","f3",k),d("f3","f1",k),d("n1","f1",k),d("n2","f2",k),d("n3","f3",k),d("n4","f4",k),d("p","n1",l),d("p","n2",l),d("p","n3",l),d("p","n4",l),d("u1","u2",m),d("u2","u3",m),d("u3","u1",m),d("c","t",16777215),d("p","c",o),d("cn1","cn2",o),d("cn3","cn4",o),d("cf1","cf2",o),d("cf3","cf4",o),THREE.LineSegments.call(this,f,g),this.camera=c,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=c.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=j,this.update()},THREE.CameraHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.CameraHelper.prototype.constructor=THREE.CameraHelper,THREE.CameraHelper.prototype.update=function(){function c(j,k,l,m){f.set(k,l,m).unproject(g);var n=e[j];if(n!==void 0)for(var o=0,p=n.length;o<p;o++)d.vertices[n[o]].copy(f)}var d,e,f=new THREE.Vector3,g=new THREE.Camera;return function(){d=this.geometry,e=this.pointMap;var k=1,l=1;g.projectionMatrix.copy(this.camera.projectionMatrix),c("c",0,0,-1),c("t",0,0,1),c("n1",-k,-l,-1),c("n2",k,-l,-1),c("n3",-k,l,-1),c("n4",k,l,-1),c("f1",-k,-l,1),c("f2",k,-l,1),c("f3",-k,l,1),c("f4",k,l,1),c("u1",0.7*k,1.1*l,-1),c("u2",0.7*-k,1.1*l,-1),c("u3",0,2*l,-1),c("cf1",-k,0,1),c("cf2",k,0,1),c("cf3",0,-l,1),c("cf4",0,l,1),c("cn1",-k,0,-1),c("cn2",k,0,-1),c("cn3",0,-l,-1),c("cn4",0,l,-1),d.verticesNeedUpdate=!0}}();
THREE.XLoader=function(a,d,e){this.txrPath=/\//.test(a)?a.slice(0,a.lastIndexOf("/")+1):"",this.url=a,this.onload=d,this.onerror=e,this.mode=null,this.modeArr=[],this.uvIdx=[],this.txrs={},this.nArr=[],this.uvArr=[],this.vColors=[],this.vId={},this.txrLength=0,this.meshNormalsVector=[],this.gmt=new THREE.Geometry,this.mtrs=new THREE.MeshFaceMaterial;var f=new XMLHttpRequestZIP,j=this;f.onload=function(){j.parse(f.response),j=f=null},f.onerror=function(){j.onerror&&j.onerror(a,f.statusText)},f.open("GET",a,!0),f.responseType="text",f.send()},THREE.XLoader.prototype={constructor:THREE.XLoader,parse:function(a){var d=this;a.replace(/^xof[\s.]+?\r\n/,"").split("\r\n").forEach(function(e){d.decision(e)}),this.uvArr.length&&this.uvIdx.forEach(function(e){d.gmt.faceVertexUvs[0].push([d.uvArr[e[0]],d.uvArr[e[1]],d.uvArr[e[2]],d.uvArr[e[3]]])}),this.vColors.length&&this.gmt.faces.forEach(function(e){e.vertexColors=[d.vColors[e.a],d.vColors[e.b],d.vColors[e.c]],isFinite(e.d)&&(e.vertexColors[3]=d.vColors[e.d])}),this.gmt.computeCentroids(),this.gmt.computeFaceNormals(),this.gmt.computeVertexNormals(),self.MMD_SA&&(this.gmt.computeBoundingBox(),this.gmt.boundingSphere=this.gmt.boundingBox.getBoundingSphere(),console.log(toLocalPath(this.txrPath)+"\n"+JSON.stringify(this.gmt.boundingBox))),this.txrLength||this.onload(new THREE.Mesh(this.gmt,this.mtrs)),this.mode=this.modeArr=this.uvIdx=this.txrs=this.nArr=this.uvArr=this.vColors=this.meshNormalsVector=this.vId=null},decision:function(a){return!a||/^\s+$/.test(a)?void 0:/{.+?}/.test(a)?void(/^\s*TextureFilename/.test(a)&&this.TextureFilename(a.match(/{\s*(.+)?\s*}/)[1])):/{/.test(a)?(this.modeArr.push(this.mode),this.mode=a.match(/^\s*([a-zA-Z]+)/)[1],this.nArr.push(this.n),void(this.n=0)):/}/.test(a)?(this.mode=this.modeArr.pop(),void(this.n=this.nArr.pop())):void(this.mode&&!/^(Header|template)$/.test(this.mode)&&(this.n++,this[this.mode]&&this[this.mode](a)))},toRgb:function(a,d,e){return"rgb("+Math.floor(100*a)+"%,"+Math.floor(100*d)+"%,"+Math.floor(100*e)+"%)"},Mesh:function(a){if(a=a.split(";"),2!==a.length||""!==a[1])if(3===a.length||""===a[2]||2===a.length&&/,/.test(a[1])){var d=a[1].split(",");/3/.test(a[0])?(this.gmt.faces.push(new THREE.Face3(+d[2],+d[1],+d[0])),this.uvIdx.push([+d[2],+d[1],+d[0]])):(this.gmt.faces.push(new THREE.Face4(+d[3],+d[2],+d[1],+d[0])),this.uvIdx.push([+d[3],+d[2],+d[1],+d[0]]))}else{var e=a.join(";"),f=this.vId[e]=this.vId[e]||new THREE.Vector3(+a[0],+a[1],-a[2]);this.gmt.vertices.push(f)}},MeshNormals:function(a){if(a=a.split(";"),2!==a.length)if(3===a.length||""===a[2]){this.faceN||(this.faceN=this.n);var d=a[1].split(",");this.gmt.faces[this.n-this.faceN].normal=/3/.test(a[0])?this.meshNormalsVector[+d[0]]:this.meshNormalsVector[+d[0]]}else this.meshNormalsVector.push(new THREE.Vector3(+a[0],+a[1],-a[2]))},MeshMaterialList:function(a){3>this.n||(this.gmt.faces[this.n-3].materialIndex=+a.match(/[0-9]+/)[0])},Material:function(a){if(a=a.split(";"),1===this.n){this.mtr=new THREE.MeshPhongMaterial({ambient:"#444",color:this.toRgb(a[0],a[1],a[2]),opacity:+a[3]});var d=this.material_para[this.mtrs.materials.length]||this.material_para._default_||{};2==d.side&&(this.mtr.side=THREE.DoubleSide),!1===d.transparent&&(this.mtr.transparent=!1),null!=d.opacity&&(this.mtr.opacity=d.opacity),null!=d.alphaTest&&(this.mtr.alphaTest=d.alphaTest),this.transparency_check(d),this.mtr.base_color=[a[0],a[1],a[2]].join(","),this.mtr.color.setStyle("#FFF"),this.mtr.ambient.setStyle(d.ambient||"#FFF"),this.mtrs.materials.push(this.mtr)}else 2===this.n?this.mtr.shininess=+a[0]||5:3===this.n?this.mtr.specular.setStyle(this.toRgb(a[0],a[1],a[2])):4===this.n&&this.mtr.emissive.setStyle(this.toRgb(a[0],a[1],a[2]))},transparency_check:function(){var a=0,d=0;return window.addEventListener("MMDStarted",function(){a&&console.log("X object opaque/total material count:"+d+"/"+a)}),function(e,f){return f?void(!1===e.transparent||1==this.mtr.opacity&&/\.jpg$/i.test(f)&&!/\.jpga\.jpg$/i.test(f)?this.mtr.transparent=!1:(this.mtr.transparent=!0,d--)):(a++,1==this.mtr.opacity&&(this.mtr.transparent=!1),void(this.mtr.transparent||d++))}}(),TextureFilename:function(a){a=a.split("\"")[1].split("\\").join("/").split("*")[0];var d=this.material_para[this.mtrs.materials.length-1]||this.material_para._default_||{},e=toFileProtocol(d.txrPath||this.txrPath);if(a=d.row||a,this.mtr.base_color&&(this.mtr.color.setArray(this.mtr.base_color.split(",").map(function(p){return 255*parseFloat(p)})),this.mtr.base_color=null,this.mtr.ambient.setStyle(d.ambient||"#444")),this.txrs[a])return this.mtr.map=this.txrs[a],void this.transparency_check(d,a);if(self.MMD_SA&&!FSO_OBJ.FileExists(toLocalPath(e+a)))return void console.error("Texture file not found ("+toLocalPath(e+a)+")");var f=this;if(this.txrLength++,self.MMD_SA&&MMD_SA_options.child_animation_as_texture&&MMD_SA_options.child_animation_as_texture_swap_list){var j=0;if(MMD_SA_options.child_animation_as_texture_swap_list.forEach(function(p,q){-1==a.indexOf(p)||(f.mtr.map=f.txrs[a]=jThree("#ChildAnimation"+q+"TXR").three(0),j++)}),j)return void(0==--f.txrLength&&f.onload(new THREE.Mesh(f.gmt,f.mtrs)))}if(self.MMD_SA){var k=/\.zip\#/i.test(toLocalPath(e)),l=a.replace(/\.(png|jpg|bmp|jpeg|tga)$/i,"_normal."+(d.use_normal_jpg?"jpg":"png"));if(d.use_normal||(browser_native_mode||k?d.use_normal:FSO_OBJ.FileExists(toLocalPath(e+l)))){if(this.txrs[l])return void(this.mtr.normalMap=this.txrs[l]);this.txrLength++,this.mtr.normalMap=this.txrs[l]=THREE.ImageUtils.loadTexture(e+l,void 0,function(){--f.txrLength||(f.onload(new THREE.Mesh(f.gmt,f.mtrs)),f=null)},function(){--f.txrLength||(f.onerror(new THREE.Mesh(f.gmt,f.mtrs)),f=null)}),this.mtr.normalMap.wrapS=this.mtr.normalMap.wrapT=THREE.RepeatWrapping,console.log("Normal map",l)}var n=a.replace(/\.(png|jpg|bmp|jpeg|tga)$/i,"_specular."+(d.use_specular_jpg?"jpg":"png"));if(d.use_specular||(browser_native_mode||k?d.use_specular:FSO_OBJ.FileExists(toLocalPath(e+n)))){if(this.txrs[n])return void(this.mtr.specularMap=this.txrs[n]);this.txrLength++,this.mtr.specularMap=this.txrs[n]=THREE.ImageUtils.loadTexture(e+n,void 0,function(p){var q=a.replace(/\.(png|jpg|bmp|jpeg|tga)$/i,"_metalness."+(d.use_metalness_jpg?"jpg":"png"));if(d.use_metalness||(browser_native_mode||k?d.use_metalness:FSO_OBJ.FileExists(toLocalPath(e+q))))return void THREE.ImageUtils.loadTexture(e+q,void 0,function(x){let y=document.createElement("canvas"),z=y.width=p.image.width,A=y.height=p.image.height,B=y.getContext("2d");B.drawImage(p.image,0,0);let C=B.getImageData(0,0,z,A),D=C.data;B.drawImage(x.image,0,0,x.image.width,x.image.height,0,0,z,A);let E=B.getImageData(0,0,z,A).data;for(var F=0,G=D.length;F<G;F+=4)D[F+1]=E[F+1];B.putImageData(C,0,0),x.image=y,C=D=E=void 0,console.log("Metal map merged with specular map",q),--f.txrLength||(f.onload(new THREE.Mesh(f.gmt,f.mtrs)),f=null)});if(!d.use_specular_as_metalness){let x=document.createElement("canvas"),y=x.width=p.image.width,z=x.height=p.image.height,A=x.getContext("2d");A.drawImage(p.image,0,0);let B=A.getImageData(0,0,y,z),C=B.data;for(var t=0,u=C.length;t<u;t+=4)C[t+1]=C[t+2]=0;A.putImageData(B,0,0),p.image=x,B=C=void 0}--f.txrLength||(f.onload(new THREE.Mesh(f.gmt,f.mtrs)),f=null)},function(){--f.txrLength||(f.onerror(new THREE.Mesh(f.gmt,f.mtrs)),f=null)}),this.mtr.specular.setStyle("rgb(100%,100%,100%)"),this.mtr.specularMap.wrapS=this.mtr.specularMap.wrapT=THREE.RepeatWrapping,console.log("Specular map",n)}}this.mtr.map=this.txrs[a]=THREE.ImageUtils.loadTexture(e+a,void 0,function(){--f.txrLength||(f.onload(new THREE.Mesh(f.gmt,f.mtrs)),f=null)},function(){--f.txrLength||(f.onerror(new THREE.Mesh(f.gmt,f.mtrs)),f=null)}),this.mtr.map.wrapS=this.mtr.map.wrapT=THREE.RepeatWrapping,this.transparency_check(d,a)},MeshTextureCoords:function(a){if(1!==this.n){a=a.split(";");var d;a[1]=1-a[1],d=+a[0],a[0]=d,d=a[1],a[1]=d,this.uvArr.push(new THREE.Vector2(a[0],a[1]))}},MeshVertexColors:function(a){},_material_para:null,get material_para(){if(this._material_para)return this._material_para;if(this._material_para={},self.MMD_SA){var a=toLocalPath(this.url).replace(/^.+[\/\\]/,""),d=a.replace(/[\-\_]copy\d+\.x$/,".x").replace(/[\-\_]v\d+\.x$/,".x"),e=MMD_SA_options.model_para[a]||MMD_SA_options.model_para[d];this._material_para=e&&e.material_para||this._material_para}return this._material_para}},jThree.modelHooks.x=function(a,d,e){new THREE.XLoader(a,function(f){d&&(d(f),d=e=null)},function(){e(),d=e=null})};
THREE.ShadowMapPlugin=function(){function a(x){t!==x&&(x===THREE.CullFaceNone?f.disable(f.CULL_FACE):(f.enable(f.CULL_FACE),x===THREE.CullFaceBack?f.cullFace(f.BACK):x===THREE.CullFaceFront?f.cullFace(f.FRONT):x===THREE.CullFaceFrontBack?f.cullFace(f.FRONT_AND_BACK):void 0),t=x)}function b(x,y){var z=new THREE.DirectionalLight;z.isVirtual=!0,z.onlyShadow=!0,z.castShadow=!0,z.shadowCameraNear=x.shadowCameraNear,z.shadowCameraFar=x.shadowCameraFar,z.shadowCameraLeft=x.shadowCameraLeft,z.shadowCameraRight=x.shadowCameraRight,z.shadowCameraBottom=x.shadowCameraBottom,z.shadowCameraTop=x.shadowCameraTop,z.shadowCameraVisible=x.shadowCameraVisible,z.shadowDarkness=x.shadowDarkness,z.shadowBias=x.shadowCascadeBias[y],z.shadowMapWidth=x.shadowCascadeWidth[y],z.shadowMapHeight=x.shadowCascadeHeight[y],z.shadowBias_range=x.shadowBias_range,z.pointsWorld=[],z.pointsFrustum=[];for(var A=z.pointsWorld,B=z.pointsFrustum,C=0;8>C;C++)A[C]=new THREE.Vector3,B[C]=new THREE.Vector3;var D=x.shadowCascadeNearZ[y],E=x.shadowCascadeFarZ[y];return B[0].set(-1,-1,D),B[1].set(1,-1,D),B[2].set(-1,1,D),B[3].set(1,1,D),B[4].set(-1,-1,E),B[5].set(1,-1,E),B[6].set(-1,1,E),B[7].set(1,1,E),z}function c(x,y){var z=x.shadowCascadeArray[y];z.position.copy(x.position),z.target.position.copy(x.target.position),z.lookAt(z.target.position),z.shadowCameraVisible=x.shadowCameraVisible,z.shadowDarkness=x.shadowDarkness,z.shadowBias=x.shadowCascadeBias[y];var A=x.shadowCascadeNearZ[y],B=x.shadowCascadeFarZ[y],C=z.pointsFrustum;C[0].z=A,C[1].z=A,C[2].z=A,C[3].z=A,C[4].z=B,C[5].z=B,C[6].z=B,C[7].z=B}function d(x,y){var z=y.shadowCamera,A=y.pointsFrustum,B=y.pointsWorld;u.set(Infinity,Infinity,Infinity),v.set(-Infinity,-Infinity,-Infinity);for(var D,C=0;8>C;C++)D=B[C],D.copy(A[C]),D.unproject(x),D.applyMatrix4(z.matrixWorldInverse),D.x<u.x&&(u.x=D.x),D.x>v.x&&(v.x=D.x),D.y<u.y&&(u.y=D.y),D.y>v.y&&(v.y=D.y),D.z<u.z&&(u.z=D.z),D.z>v.z&&(v.z=D.z);z.left=u.x,z.right=v.x,z.top=v.y,z.bottom=u.y,z.updateProjectionMatrix()}function e(x){var y;return y=x.object.material,y instanceof THREE.MeshFaceMaterial&&(y=y.materials[x.buffer.materialIndex]),y}var f,g,h,l,o,q,t,r=new THREE.Frustum,s=new THREE.Matrix4,u=new THREE.Vector3,v=new THREE.Vector3,w=new THREE.Vector3;this.init=function(x){f=x.context,g=x;var y=THREE.ShaderLib.depthRGBA,z=THREE.UniformsUtils.clone(y.uniforms);h=new THREE.ShaderMaterial({fragmentShader:y.fragmentShader,vertexShader:y.vertexShader,uniforms:z}),l=new THREE.ShaderMaterial({fragmentShader:y.fragmentShader,vertexShader:y.vertexShader,uniforms:z,morphTargets:!0}),o=new THREE.ShaderMaterial({fragmentShader:y.fragmentShader,vertexShader:y.vertexShader,uniforms:z,skinning:!0}),q=new THREE.ShaderMaterial({fragmentShader:y.fragmentShader,vertexShader:y.vertexShader,uniforms:z,morphTargets:!0,skinning:!0}),this._switch_material=function(){var A={},B;return function(C,D){B=null==C._model_index?-1:C._model_index;var E=A[B];return E||(E=A[B]={_depthMaterialMorphSkin:q.clone(),_depthMaterialSkin:o.clone()}),D?E._depthMaterialMorphSkin:E._depthMaterialSkin}}(),h._shadowPass=!0,l._shadowPass=!0,o._shadowPass=!0,q._shadowPass=!0},this.render=function(x,y){g.shadowMapEnabled&&g.shadowMapAutoUpdate&&this.update(x,y)},this.update=function(x,y){var z,A,B,C,D,E,F,G,H,I,J,K,L,M,N=[],O=0,P=null;f.clearColor(1,1,1,1),f.disable(f.BLEND),f.frontFace(f.CCW),a(g.shadowMapCullFace),g.setDepthTest(!0);var Q=-1;for(z=0,A=x.__lights.length;z<A;z++)if(L=x.__lights[z],L.isVirtual||(L instanceof THREE.DirectionalLight?(Q++,!L._shadowPara&&(L._shadowPara=new THREE.Vector3(0,Q,0))):!L._shadowPara&&(L._shadowPara=new THREE.Vector3(1,0,0))),!!L.castShadow)if(L instanceof THREE.DirectionalLight&&L.shadowCascade)for(D=0;D<L.shadowCascadeCount;D++){var R;L.shadowCascadeArray[D]?R=L.shadowCascadeArray[D]:(R=b(L,D),R.originalCamera=y,R._shadowPara=L._shadowPara.clone(),x.add(R),L.shadowCascadeArray[D]=R,console.log("Created virtualLight",R)),c(L,D),N[O]=R,O++}else{if(L.isVirtual)continue;N[O]=L,O++}var S={},T=[],U=[];for(let aa=0,ba=N.length;aa<ba;aa++)T[aa]=0,U[aa]=0;for(z=0,A=N.length;z<A;z++){if(L=N[z],!L.shadowMap){var V=THREE.LinearFilter;g.shadowMapType===THREE.PCFSoftShadowMap&&(V=THREE.NearestFilter);var W={minFilter:V,magFilter:V,format:THREE.RGBAFormat};L.shadowMap=new THREE.WebGLRenderTarget(L.shadowMapWidth,L.shadowMapHeight,W),L.shadowMapSize=new THREE.Vector2(L.shadowMapWidth,L.shadowMapHeight),L.shadowMatrix=new THREE.Matrix4}if(!L.shadowCamera){if(L instanceof THREE.SpotLight)L.shadowCamera=new THREE.PerspectiveCamera(L.shadowCameraFov,L.shadowMapWidth/L.shadowMapHeight,L.shadowCameraNear,L.shadowCameraFar);else if(L instanceof THREE.DirectionalLight)L.shadowCamera=new THREE.OrthographicCamera(L.shadowCameraLeft,L.shadowCameraRight,L.shadowCameraTop,L.shadowCameraBottom,L.shadowCameraNear,L.shadowCameraFar);else{console.error("Unsupported light type for shadow");continue}x.add(L.shadowCamera),!0===x.autoUpdate&&x.updateMatrixWorld()}for(L.shadowCameraVisible&&!L.cameraHelper&&(L.cameraHelper=new THREE.CameraHelper(L.shadowCamera),L.shadowCamera.add(L.cameraHelper)),L.isVirtual&&R.originalCamera==y&&d(y,L),E=L.shadowMap,F=L.shadowMatrix,G=L.shadowCamera,G.position.copy(L.position),G.lookAt(L.target.position),G.updateMatrixWorld(),G.matrixWorldInverse.getInverse(G.matrixWorld),L._shadowBias_range||(!L.shadowBias_range&&(L.shadowBias_range=[0.1,100]),L._shadowBias_range=new THREE.Vector3(0,L.shadowBias_range[0],L.shadowBias_range[1])),L._shadowBias_range.x=L.shadowBias,L.cameraHelper&&(L.cameraHelper.visible=L.shadowCameraVisible),L.shadowCameraVisible&&L.cameraHelper.update(),F.set(0.5,0,0,0.5,0,0.5,0,0.5,0,0,0.5,0.5,0,0,0,1),F.multiply(G.projectionMatrix),F.multiply(G.matrixWorldInverse),s.multiplyMatrices(G.projectionMatrix,G.matrixWorldInverse),r.setFromMatrix(s),g.setRenderTarget(E),g.clear(),M=x.__webglObjects,(B=0,C=M.length);B<C;B++)if(J=M[B],X=e(J),K=J.object,J.render=!1,K.visible&&K.castShadow&&(void 0===X.castShadow||X.castShadow)&&(!(K instanceof THREE.Mesh||K instanceof THREE.ParticleSystem)||!K.frustumCulled||r.intersectsOrContainsObject(K))){if(T[z]++,S[B]){U[z]++;continue}r._containing&&(S[B]=!0),K._modelViewMatrix.multiplyMatrices(G.matrixWorldInverse,K.matrixWorld),J.render=!0}var X,Y,Z;for(B=0,C=M.length;B<C;B++)J=M[B],J.render&&(K=J.object,H=J.buffer,X=e(J),void 0===X.shadowMapCullFace?a(g.shadowMapCullFace):a(X.shadowMapCullFace),Y=0<K.geometry.morphTargets.length&&X.morphTargets,Z=K instanceof THREE.SkinnedMesh&&X.skinning,I=K.customDepthMaterial?K.customDepthMaterial:Z?this._switch_material(K,Y):Y?l:h,H instanceof THREE.BufferGeometry?g.renderBufferDirect(G,x.__lights,P,I,H,K):g.renderBuffer(G,x.__lights,P,I,H,K));for(a(g.shadowMapCullFace),M=x.__webglObjectsImmediate,(B=0,C=M.length);B<C;B++)J=M[B],K=J.object,K.visible&&K.castShadow&&(K._modelViewMatrix.multiplyMatrices(G.matrixWorldInverse,K.matrixWorld),g.renderImmediateObject(G,x.__lights,P,h,K))}var $=g.getClearColor(),_=g.getClearAlpha();f.clearColor($.r,$.g,$.b,_),f.enable(f.BLEND),a(THREE.CullFaceBack)}};
THREE.ShaderLib.mirror={uniforms:{mirrorSampler:{type:"t",value:null},mirrorPosition:{type:"v3",value:new THREE.Vector3(0,0,0)},reflection_state:{type:"i",value:0},reflection_alpha:{type:"f",value:1},fade_radius:{type:"f",value:15},fade_min:{type:"f",value:1},fade_max:{type:"f",value:1},depth_render_mode:{type:"i",value:0},baseTexture:{type:"t",value:null},baseSpeed:{type:"f",value:0},noiseTexture:{type:"t",value:null},noiseScale:{type:"f",value:0},bumpScale:{type:"f",value:5},vUv_scale:{type:"v2",value:new THREE.Vector2(1,1)},time:{type:"f",value:0},nIntensity:{type:"f",value:0},sIntensity:{type:"f",value:0.5},sCount:{type:"f",value:512},textureMatrix:{type:"m4",value:new THREE.Matrix4}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 mirrorCoord;","varying vec3 vWorldPosition;","varying vec2 vUv;","uniform sampler2D noiseTexture;","uniform float time;","uniform float baseSpeed;","uniform float bumpScale;","void main() {","vUv = uv;","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","mirrorCoord = textureMatrix * worldPosition;","vec3 bumpedPosition = position;","vec4 mvPosition;","if (baseSpeed > 0.0) {","  vec2 uvTimeShift = vUv + vec2( 1.1, 1.9 ) * time * 0.15;","  vec4 bumpData = texture2D( noiseTexture, uvTimeShift );","  float displacement = (bumpData.g - 0.25) * bumpScale;","  bumpedPosition = bumpedPosition + normal * displacement;","}","mvPosition = modelViewMatrix * vec4( bumpedPosition, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform sampler2D mirrorSampler;","varying vec4 mirrorCoord;","varying vec3 vWorldPosition;","uniform vec3 mirrorPosition;","uniform int reflection_state;","uniform float reflection_alpha;","uniform float fade_radius;","uniform float fade_min;","uniform float fade_max;","uniform vec2 vUv_scale;","varying vec2 vUv;","uniform sampler2D baseTexture;","uniform float baseSpeed;","uniform sampler2D noiseTexture;","uniform float noiseScale;","uniform float time;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","vec4 FilmShader(vec4 cTextureScreen, vec2 vUv) {","float x = vUv.x * vUv.y * time *  1000.0;","x = mod( x, 13.0 ) * mod( x, 123.0 );","float dx = mod( x, 0.01 );","vec3 cResult = cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );","vec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );","cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","cResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );","return vec4( cResult, cTextureScreen.a );","}",THREE.ShaderChunk.AT_depth_render_mode_pars_fragment,"void main() {",THREE.ShaderChunk.AT_depth_render_mode_fragment,"vec4 color;","if (reflection_state == 0) {","  color = texture2DProj(mirrorSampler, mirrorCoord);","} else if (reflection_state == 1) {","  color = texture2D( mirrorSampler, vUv * vUv_scale + (1.0-vUv_scale)/2.0);","} else {","  color = vec4(0,0,0,0);","}","vec4 baseColor;","if (baseSpeed > 0.0) {","  vec2 uvTimeShift = vUv + vec2( -0.7, 1.5 ) * time * baseSpeed;","  vec4 noiseGeneratorTimeShift = texture2D( noiseTexture, uvTimeShift );","  vec2 uvNoiseTimeShift = vUv + noiseScale * vec2( noiseGeneratorTimeShift.r, noiseGeneratorTimeShift.b );","  baseColor = texture2D( baseTexture, uvNoiseTimeShift );","}","else {","  baseColor = texture2D( baseTexture, vUv );","}","color = vec4(mix(color.rgb, baseColor.rgb, baseColor.a * (1.0 - color.a*reflection_alpha)), baseColor.a + ((1.0-baseColor.a) * color.a*reflection_alpha));","if (nIntensity > 0.0) {","  color = FilmShader(color, vUv);","}","if ((fade_max < 1.0) || (fade_min < 1.0)) {","  if (fade_max != fade_min) {","    float fade_distance = distance(vWorldPosition, mirrorPosition);","    float fade_ratio = pow(fade_distance/fade_radius, 2.0);","    color.a *= mix(fade_max, fade_min, fade_ratio);","  } else {","    color.a *= fade_max;","  }","}","gl_FragColor = color;","}"].join("\n")},THREE.FlatMirror=function(a,b,d){function e(r){return 0==(r&r-1)}THREE.Object3D.call(this),this.name="flatMirror_"+this.id,d=d||{},this.matrixNeedsUpdate=!0;var f=void 0===d.textureWidth?512:d.textureWidth,g=void 0===d.textureHeight?512:d.textureHeight;this.clipBias=void 0===d.clipBias?0:d.clipBias,this.renderer=a,this.mirrorPlane=new THREE.Plane,this.normal=new THREE.Vector3(0,0,1),this.mirrorWorldPosition=new THREE.Vector3,this.cameraWorldPosition=new THREE.Vector3,this.rotationMatrix=new THREE.Matrix4,this.lookAtPosition=new THREE.Vector3(0,0,-1),this.clipPlane=new THREE.Vector4;var h=void 0!==d.debugMode&&d.debugMode;if(h){var i=new THREE.ArrowHelper(new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,0),10,16777088),j=new THREE.Geometry;j.vertices.push(new THREE.Vector3(-10,-10,0)),j.vertices.push(new THREE.Vector3(10,-10,0)),j.vertices.push(new THREE.Vector3(10,10,0)),j.vertices.push(new THREE.Vector3(-10,10,0)),j.vertices.push(j.vertices[0]);var k=new THREE.Line(j,new THREE.LineBasicMaterial({color:16777088}));this.add(i),this.add(k)}b instanceof THREE.PerspectiveCamera?this.camera=b:(this.camera=new THREE.PerspectiveCamera,console.log(this.name+": camera is not a Perspective Camera!")),this.textureMatrix=new THREE.Matrix4,this.mirrorCamera=this.camera.clone(),this.texture=new THREE.WebGLRenderTarget(f,g),this.tempTexture=new THREE.WebGLRenderTarget(f,g);var l=THREE.ShaderLib.mirror,m=THREE.UniformsUtils.clone(l.uniforms);if(this.material=new THREE.ShaderMaterial({fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:m}),this.material.uniforms.mirrorSampler.value=this.texture,this.material.uniforms.textureMatrix.value=this.textureMatrix,self.MMD_SA){this.mirrorCamera.matrixAutoUpdate=!0,this.mirror_index=d.mirror_index,this.clip_y=d.clip_y;var n=MMD_SA.mirror_obj[this.mirror_index],o=this.material.uniforms;if(n.reflection_state||(this.mirrorCamera.fov*=1.75),o.baseTexture.value=/^\#/.test(n.baseTexture)?jThree(n.baseTexture).three(0):THREE.ImageUtils.loadTexture(toFileProtocol(n.baseTexture)),o.reflection_state.value=n.reflection_state||0,null!=n.reflection_alpha&&(o.reflection_alpha.value=n.reflection_alpha),null!=n.fade_radius&&(o.fade_radius.value=n.fade_radius),null!=n.fade_min&&(o.fade_min.value=n.fade_min),null!=n.fade_max&&(o.fade_max.value=n.fade_max),this.time_ref=performance.now(),o.time.value=n.time||0,null!=n.baseSpeed){o.baseSpeed.value=n.baseSpeed||0.5;var p=new THREE.ImageUtils.loadTexture(toFileProtocol(n.noiseTexture));p.wrapS=p.wrapT=THREE.RepeatWrapping,o.noiseTexture.value=p,o.noiseScale.value=n.noiseScale||0.5337,n.bumpScale||(n.bumpScale=5),o.bumpScale.value=n.bumpScale}null!=n.nIntensity&&(o.nIntensity.value=n.nIntensity,null!=n.sIntensity&&(o.sIntensity.value=n.sIntensity),null!=n.sCount&&(o.sCount.value=n.sCount))}e(f)&&e(g)||self.MMD_SA&&MMD_SA.use_webgl2||(this.texture.generateMipmaps=!1,this.tempTexture.generateMipmaps=!1),[this.texture,this.tempTexture].forEach(function(r){r.generateMipmaps=!1,r.minFilter=r.magFilter}),this.updateTextureMatrix(),this.render()},THREE.FlatMirror.prototype=Object.create(THREE.Object3D.prototype),THREE.FlatMirror.prototype.renderWithMirror=function(a){this.updateTextureMatrix(),this.matrixNeedsUpdate=!1;var b=a.camera;a.camera=this.mirrorCamera,a.renderTemp(),a.material.uniforms.mirrorSampler.value=a.tempTexture,this.render(),this.matrixNeedsUpdate=!0,a.material.uniforms.mirrorSampler.value=a.texture,a.camera=b,a.updateTextureMatrix()},THREE.FlatMirror.prototype.updateTextureMatrix=function(){var a=new THREE.Vector4,b,d=new THREE.Vector3;return function(){function e(s){return s?0>s?-1:1:0}this.updateMatrixWorld(),this.camera.updateMatrixWorld(),this.mirrorWorldPosition.getPositionFromMatrix(this.matrixWorld),this.cameraWorldPosition.getPositionFromMatrix(this.camera.matrixWorld),this.rotationMatrix.extractRotation(this.matrixWorld),this.normal.set(0,0,1),this.normal.applyMatrix4(this.rotationMatrix);var f=self.MMD_SA&&jThree(this._mesh_id).three(0);if(!f||1!=f.material.uniforms.reflection_state.value){var g=this.mirrorWorldPosition.clone().sub(this.cameraWorldPosition),h=g.reflect(this.normal);h.add(this.mirrorWorldPosition),this.rotationMatrix.extractRotation(this.camera.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition);var i=this.mirrorWorldPosition.clone().sub(this.lookAtPosition),j=i.reflect(this.normal);j.add(this.mirrorWorldPosition),this.up.set(0,-1,0),this.up.applyMatrix4(this.rotationMatrix);var k=this.up.reflect(this.normal);this.mirrorCamera.position.copy(h),this.mirrorCamera.up=k,this.mirrorCamera.lookAt(j)}if(this.mirrorCamera.updateProjectionMatrix(),this.mirrorCamera.updateMatrixWorld(),this.mirrorCamera.matrixWorldInverse.getInverse(this.mirrorCamera.matrixWorld),this.textureMatrix.set(0.5,0,0,0.5,0,0.5,0,0.5,0,0,0.5,0.5,0,0,0,1),this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix),this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse),f){var l=MMD_SA.mirror_obj[this.mirror_index];null!=l.renderDepth&&(f.renderDepth=l.renderDepth,l.renderDepth=null);var m=f.material.uniforms;if(m.textureMatrix.value=this.textureMatrix,m.mirrorPosition.value=this.mirrorWorldPosition,!this._baseTexture_loaded){var n=m.baseTexture.value;n&&n.image&&(n.image.complete&&n.image.src||n.image._canvas_ready)&&(n.image._canvas_ready?n.needsUpdate=jThree(l.baseTexture).three(0).needsUpdate:(this._baseTexture_loaded=!0,n.needsUpdate=!0))}if(!this._noiseTexture_loaded){var n=m.noiseTexture.value;n&&n.image&&n.image.complete&&n.image.src&&(this._noiseTexture_loaded=!0,n.needsUpdate=!0)}if(!l.vUv_scale)if(l.plane){var o=Math.max(l.plane[0],l.plane[1]);l.vUv_scale=new THREE.Vector2(l.plane[0]/o,l.plane[1]/o)}else l.vUv_scale=new THREE.Vector2(1,1);m.vUv_scale.value=l.vUv_scale;var p=performance.now();m.time.value+=(p-this.time_ref)/1e3,this.time_ref=p}if(f&&1!=f.material.uniforms.reflection_state.value){d.copy(this.mirrorWorldPosition),null!=this.clip_y&&(d.y=this.clip_y),this.mirrorPlane.setFromNormalAndCoplanarPoint(this.normal,d),this.mirrorPlane.applyMatrix4(this.mirrorCamera.matrixWorldInverse),this.clipPlane.set(this.mirrorPlane.normal.x,this.mirrorPlane.normal.y,this.mirrorPlane.normal.z,this.mirrorPlane.constant);var r=this.mirrorCamera.projectionMatrix;a.x=(e(this.clipPlane.x)+r.elements[8])/r.elements[0],a.y=(e(this.clipPlane.y)+r.elements[9])/r.elements[5],a.z=-1,a.w=(1+r.elements[10])/r.elements[14],b=this.clipPlane.multiplyScalar(2/this.clipPlane.dot(a)),r.elements[2]=b.x,r.elements[6]=b.y,r.elements[10]=b.z+1-this.clipBias,r.elements[14]=b.w}}}(),THREE.FlatMirror.prototype.render=function(a){var b=self.MMD_SA&&jThree(this._mesh_id).three(0);if(!b||b.visible){this.matrixNeedsUpdate&&this.updateTextureMatrix(),this.matrixNeedsUpdate=!0;for(var d=this;void 0!==d.parent;)d=d.parent;if(b&&b.visible){var e,f,g,h,i={};if(e=b.material.uniforms.reflection_state,f=e.value,e.value=-1,self.MMD_SA&&(g=MMD_SA.mirror_obj[this.mirror_index],h=g.skip_reflection_list,!h&&(h=[this._mesh_id]),h.forEach(function(l){var m=/^\#(.+)$/.test(l)?MMD_SA_options.mesh_obj_by_id[RegExp.$1]:MMD_SA_options.x_object_by_name[l];m&&m.visible&&(i[l]=!0,m.hide())})),void 0!==d&&d instanceof THREE.Scene&&this.renderer.render(d,this.mirrorCamera,a||this.texture,!0),e.value=f,self.MMD_SA)for(var j in i){var k=/^\#(.+)$/.test(j)?MMD_SA_options.mesh_obj_by_id[RegExp.$1]:MMD_SA_options.x_object_by_name[j];k&&k.show()}}}},THREE.FlatMirror.prototype.renderTemp=function(){this.render(this.tempTexture)},THREE.MirrorMaterial=function(a){var b=jThree(a.camera).three(0),d=new THREE.FlatMirror(null,b,a);return MMD_SA._THREE_mirror.push(d),d.material._mirror=d,d._mesh_id=a.mesh,d._renderer_id=a.renderer,d.material},THREE.Math.isPowerOfTwo=function(a){return 0==(a&a-1)},THREE.Vector3.prototype.setFromMatrixPosition=THREE.Vector3.prototype.getPositionFromMatrix,THREE.PerspectiveCamera.prototype.clone=function(){var a=new THREE.PerspectiveCamera;return THREE.Camera.prototype.clone.call(this,a),a.zoom=this.zoom,a.fov=this.fov,a.aspect=this.aspect,a.near=this.near,a.far=this.far,a.projectionMatrix.copy(this.projectionMatrix),a};
THREE.TrackballControls=function(a,b){function c(G){l.enabled&&(G.preventDefault(),G.stopPropagation(),n===m.NONE&&(n=G.button),n!==m.ROTATE||l.noRotate?n!==m.ZOOM||l.noZoom?n===m.PAN&&!l.noPan&&(x=l.getMouseOnScreen(G.pageX,G.pageY,x),y.copy(x)):(t=l.getMouseOnScreen(G.pageX,G.pageY,t),u.copy(t)):(q=l.getMouseProjectionOnBall(G.pageX,G.pageY,q),r.copy(q),l.rotate_with_up_fixed&&B.copy(l.getMouseOnScreen_fixed_up(G.pageX,G.pageY,A))),document.addEventListener("mousemove",f,!1),document.addEventListener("mouseup",g,!1))}function f(G){l.enabled&&(G.preventDefault(),G.stopPropagation(),n!==m.ROTATE||l.noRotate?n!==m.ZOOM||l.noZoom?n===m.PAN&&!l.noPan&&(y=l.getMouseOnScreen(G.pageX,G.pageY,y)):u=l.getMouseOnScreen(G.pageX,G.pageY,u):(r=l.getMouseProjectionOnBall(G.pageX,G.pageY,r),l.rotate_with_up_fixed&&l.getMouseOnScreen_fixed_up(G.pageX,G.pageY,B)))}function g(G){l.enabled&&(G.preventDefault(),G.stopPropagation(),n=m.NONE,document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",g))}function h(G){if(l.enabled){G.preventDefault(),G.stopPropagation();var H=0;G.deltaY?H=G.deltaY/(0==G.deltaMode?40:1):G.wheelDelta?H=G.wheelDelta/40:G.detail&&(H=-G.detail/3),t.y+=0.01*H}}function i(G){if(!1!==l.enabled)switch(G.touches.length){case 1:n=m.TOUCH_ROTATE,r.copy(l.getMouseProjectionOnBall(G.touches[0].pageX,G.touches[0].pageY,q)),l.rotate_with_up_fixed&&l.getMouseOnScreen_fixed_up(G.touches[0].pageX,G.touches[0].pageY,A);break;case 2:n=m.TOUCH_ZOOM;var H=G.touches[0].pageX-G.touches[1].pageX,I=G.touches[0].pageY-G.touches[1].pageY;w=v=Math.sqrt(H*H+I*I);break;case 3:n=m.TOUCH_PAN,y.copy(l.getMouseOnScreen(G.touches[0].pageX,G.touches[0].pageY,x));break;default:n=m.NONE;}}function j(G){if(!1!==l.enabled)switch(G.preventDefault(),G.stopPropagation(),G.touches.length){case 1:r=l.getMouseProjectionOnBall(G.touches[0].pageX,G.touches[0].pageY,r),l.rotate_with_up_fixed&&l.getMouseOnScreen_fixed_up(G.touches[0].pageX,G.touches[0].pageY,B);break;case 2:var H=G.touches[0].pageX-G.touches[1].pageX,I=G.touches[0].pageY-G.touches[1].pageY;w=Math.sqrt(H*H+I*I);break;case 3:y=l.getMouseOnScreen(G.touches[0].pageX,G.touches[0].pageY,y);break;default:n=m.NONE;}}function k(G){if(!1!==l.enabled){switch(G.touches.length){case 1:q.copy(l.getMouseProjectionOnBall(G.touches[0].pageX,G.touches[0].pageY,r)),l.rotate_with_up_fixed&&A.copy(l.getMouseOnScreen_fixed_up(G.touches[0].pageX,G.touches[0].pageY,A));break;case 2:v=w=0;break;case 3:x.copy(l.getMouseOnScreen(G.touches[0].pageX,G.touches[0].pageY,y));}n=m.NONE}}var l=this,m={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5};this.object=a,this.domElement=b===void 0?document:b,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=0.3,this.noRotate=this.noZoom=this.noPan=this.noRoll=!1,this.damping=0.2,this.minDistance=0,this.maxDistance=Infinity,this.target=a._lookAt,this.lastPosition=new THREE.Vector3,this._eye=new THREE.Vector3;var n=m.NONE,o=m.NONE,q=new THREE.Vector3,r=new THREE.Vector3,t=new THREE.Vector2,u=new THREE.Vector2,v=0,w=0,x=new THREE.Vector2,y=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this._fixed=!1,this.objectUp=new THREE.Vector3;var A=new THREE.Vector2,B=new THREE.Vector2,C=new THREE.Vector2;this.rotate_with_up_fixed=!1,this.getMouseOnScreen_fixed_up=function(G,H,I){return this.getMouseOnScreen(G,H,I||new THREE.Vector2)},this.rotateCamera=function(){function G(){if(P=Q=null,!self.MMD_SA||!MMD_SA_options.trackball_camera_limit)return!1;var R=MMD_SA_options.trackball_camera_limit;P=R.max,Q=R.min,K.copy(this._eye).applyQuaternion(J);var S=R.adjust&&R.adjust(K);return S?S:P&&(K.x>P.x||K.y>P.y||K.z>P.z)||Q&&(K.x<Q.x||K.z<Q.z)}function H(){if(!Q||!(this._eye.y<Q.y))return!1;let R=this._eye.lengthSq(),S=this._eye.x*this._eye.x,T=this._eye.z*this._eye.z,U=(R-Q.y*Q.y)/(S+T);return L.x=(0>this._eye.x?-1:1)*Math.sqrt(S*U),L.z=(0>this._eye.z?-1:1)*Math.sqrt(T*U),L.y=Q.y,!0}var I=new THREE.Vector3,J=new THREE.Quaternion,K=new THREE.Vector3,L=new THREE.Vector3,M=new THREE.Vector3,N=new THREE.Vector3,O=new THREE.Quaternion,P,Q;return function(){if(this.rotate_with_up_fixed){if(A.distanceToSquared(B)>this.EPS){K.subVectors(this.position0,this.target),M.set(0,K.y,-Math.sqrt(K.x*K.x+K.z*K.z));let S=Math.atan2(M.y,-M.z),T=1.9-S/(Math.PI/4),U=-1.9-S/(Math.PI/4);N.copy(C).add(B).sub(A),N.y=THREE.Math.clamp(N.y,U,T),J.setFromEuler(MMD_SA.TEMP_v3.set(45*N.y/180*Math.PI,180*-N.x/180*Math.PI,0),"YXZ"),L.copy(this._eye);let V=M.angleTo(K);O.setFromAxisAngle(I.set(0,1,0),V),J.multiplyQuaternions(O,J),this._eye.copy(M);let W=G.call(this);if(W)return this._eye.copy(L),void A.copy(B);this._eye.applyQuaternion(J),H.call(this)&&(this._eye.copy(L),A.y=B.y),C.add(B).sub(A),C.y=THREE.Math.clamp(C.y,U,T),A.add(N.copy(B).sub(A).multiplyScalar(this.damping))}return}var R=q.angleTo(r);if(R){if(I.crossVectors(q,r).normalize(),R*=l.rotateSpeed,J.setFromAxisAngle(I,-R),G.call(this))return void q.copy(r);if(this._eye.applyQuaternion(J),l._fixed||l.object.up.applyQuaternion(J),r.applyQuaternion(J),J.setFromAxisAngle(I,R*(l.damping-1)),q.applyQuaternion(J),H.call(this)){let S=N.crossVectors(K,L).normalize(),T=K.angleTo(L);O.setFromAxisAngle(S,T),this._eye.applyQuaternion(O),l._fixed||l.object.up.applyQuaternion(O),r.applyQuaternion(O),q.applyQuaternion(O)}}}}();var D=function(){var G=new THREE.Vector3;return function(H,I){if(!self.MMD_SA||!MMD_SA_options.trackball_camera_limit)return void H.multiplyScalar(I);var J=MMD_SA_options.trackball_camera_limit,K=J.max,L=J.min,M=G.copy(H).multiplyScalar(I).length();K&&M>K.length||L&&M<L.length||J.adjust&&J.adjust(H)||(H.multiplyScalar(I),K&&(H.x>K.x&&(H.x=K.x),H.y>K.y&&(H.y=K.y),H.z>K.z&&(H.z=K.z)),L&&(H.x<L.x&&(H.x=L.x),H.y<L.y&&(H.y=L.y),H.z<L.z&&(H.z=L.z)))}}();this.zoomCamera=function(){if(n===m.TOUCH_ZOOM){var G=v/w;v=w,D(this._eye,G)}else{var G=1+(u.y-t.y)*this.zoomSpeed;1!=G&&0<G&&(D(this._eye,G),t.y+=(u.y-t.y)*this.damping)}},this.panCamera=function(){var G=new THREE.Vector2,H=new THREE.Vector3,I=new THREE.Vector3;return function(){G.copy(y).sub(x),G.lengthSq()&&(G.multiplyScalar(this._eye.length()*l.panSpeed),I.copy(this._eye).cross(l.object.up).setLength(G.x),I.add(H.copy(l.object.up).setLength(G.y)),l.object.position.add(I),l.target.add(I),x.add(G.subVectors(y,x).multiplyScalar(l.damping)))}}();var E=new THREE.Vector3,F=1;this.reset=function(){return self.MMD_SA&&(System._browser._wallpaper_mousedown=!1),E.set(0,0,0),F=1,A=new THREE.Vector2,B=new THREE.Vector2,C=new THREE.Vector2,q=new THREE.Vector3,r=new THREE.Vector3,n=o=m.NONE,this.object.position.copy(this.position0),this.object.up.copy(this.up0),this.object.lookAt(this.target0),this._eye.subVectors(this.object.position,this.target),this.lastPosition.copy(this.object.position),this},self.MMD_SA&&(this.SA_adjust=function(){var G=new THREE.Vector3,H=new THREE.Vector3,I=new THREE.Vector3,J={filter:function(K){return K.no_camera_collision}};return function(K,L){G.copy(this.object.position);var M,N;K&&(K instanceof Array?(M=K[0],N=K[1]):M=N=K,this.object.position.sub(this.target).multiplyScalar(1/F).add(this.target).add(M),this.target.add(N),F=1),L&&E.add(L);for(var O=10,P=2,Q=1,R=2,S=0,T=10;T>=P;T--){I.copy(H.copy(this.object.position).sub(this.target).multiplyScalar(1/F*(S+T/O))),(E.x||E.y||E.z)&&H.applyEuler(E);var U={return_value:null};if(window.dispatchEvent(new CustomEvent("SA_camera_adjust",{detail:{rot_delta:E,pos_v3:H,result:U}})),!U.return_value){if(Q<R&&10>T&&(1<Q||T>P)){Q++,S+=T/O,O=Math.pow(10,Q),T=10,P=0;continue}(Q==R||1==Q&&(10==T||T==P))&&E.set(0,0,0),this.object.position.copy(H).add(this.target),F=S+T/O;break}1==Q&&T==P&&(this.object.position.copy(I).add(this.target),F=S+T/O)}var V=MMD_SA_options.Dungeon;if(V&&F>2/10){var W=!V.no_camera_collision&&V.check_ray_intersection(this.target,H.copy(this.object.position).sub(this.target),J);if(W){var X=H.length()/F,Y=Math.max(W.nearest.distance/X,2/10);this.object.position.sub(this.target).multiplyScalar(1/F*Y).add(this.target),F=Y}}N&&N.lengthSq()>0.01*0.01&&(MMD_SA._mouse_pos_3D=[]),this.object.updateMatrixWorld(),this.position0.add(this.object.position).sub(G)}}()),self.Animate_RAF?(Lbody_host.addEventListener("mousedown",function(G){0!==G.button||c(G)},!1),Lbody_host.addEventListener("wheel",h,!1),Lbody_host.addEventListener("touchstart",i,!1),Lbody_host.addEventListener("touchend",k,!1),Lbody_host.addEventListener("touchmove",j,!1),window.addEventListener("resize",function(){l.resize()})):(this.domElement.addEventListener("contextmenu",function(G){G.preventDefault()},!1),this.domElement.addEventListener("mousedown",c,!1),this.domElement.addEventListener("mousewheel",h,!1),this.domElement.addEventListener("DOMMouseScroll",h,!1),this.domElement.addEventListener("touchstart",i,!1),this.domElement.addEventListener("touchend",k,!1),this.domElement.addEventListener("touchmove",j,!1)),this.resize()},THREE.TrackballControls.prototype={constructor:THREE.TrackballControls,stop:function(){return this.enabled=!1,this},start:function(){return this.enabled=!0,this},setup:function(a){return jThree.extend(this,a),this},fixUp:function(a){this._fixed=a===void 0?!this._fixed:a},resize:function(){if(this.domElement===document)this.screen.left=this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{jThree.extend(this.screen,this.domElement.getBoundingClientRect());var a=this.domElement.ownerDocument.documentElement;this.screen.left+=window.pageXOffset-a.clientLeft,this.screen.top+=window.pageYOffset-a.clientTop}},getMouseOnScreen:function(a,b,c){return(c||new THREE.Vector2).set((a-this.screen.left)/this.screen.width,(b-this.screen.top)/this.screen.height)},getMouseProjectionOnBall:function(a,b,c){var f=new THREE.Vector3((a-0.5*this.screen.width-this.screen.left)/(.5*this.screen.width),(0.5*this.screen.height+this.screen.top-b)/(.5*this.screen.height),0),g=f.length();return this.noRoll?g<Math.SQRT1_2?f.z=Math.sqrt(1-g*g):f.z=.5/g:1<g?f.normalize():f.z=Math.sqrt(1-g*g),this._eye.copy(this.object.position).sub(this.target),c.copy(this.object.up).setLength(f.y),c.add(this.objectUp.copy(this.object.up).cross(this._eye).setLength(f.x)),c.add(this._eye.setLength(f.z)),c},checkDistances:function(){this.noZoom&&this.noPan||(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._eye.lengthSq()<this.minDistance*this.minDistance&&this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)))},EPS:1e-6,update:function(){if(this.enabled){this._eye.subVectors(this.object.position,this.target),this.noRotate||this.rotateCamera(),this.noZoom||this.zoomCamera(),this.noPan||this.panCamera(),this.object.position.addVectors(this.target,this._eye);var a,b=this.object.position;if(MMD_SA._AR_roty_last&&b.applyQuaternion(new THREE.Quaternion().setFromEuler(new THREE.Vector3(0,-MMD_SA._AR_roty_last,0))),MMD_SA._AR_rotx_last&&b.applyQuaternion(new THREE.Quaternion().setFromEuler(new THREE.Vector3(-MMD_SA._AR_rotx_last,0,0))),MMD_SA._AR_y_last&&(b.y-=MMD_SA._AR_y_last,this.target.y-=0.75*MMD_SA._AR_y_last),MMD_SA._AR_z_last&&(b.z-=MMD_SA._AR_z_last),MMD_SA._AR_y_last=MMD_SA._AR_z_last=MMD_SA._AR_rotx_last=MMD_SA._AR_roty_last=0,self.HeadTrackerAR&&HeadTrackerAR.running){MMD_SA._AR_roty=(HeadTrackerAR._cx-50)*MMD_SA_options.AR_camera_mod/180*Math.PI,MMD_SA._AR_rotx=(HeadTrackerAR._cy-50)*MMD_SA_options.AR_camera_mod/180*Math.PI;var c=1,f=1;1<HeadTrackerAR._cz?(c=MMD_SA_options.camera_position[2],f=HeadTrackerAR._cz*HeadTrackerAR._cz_mod,MMD_SA._AR_z=c/f-c,a=7.5*(f-1)-MMD_SA.center_view[1],0>a&&(a=0),MMD_SA._AR_y=a):MMD_SA._AR_z=MMD_SA._AR_y=0}MMD_SA._AR_z&&(b.z+=MMD_SA._AR_z,MMD_SA._AR_z_last=MMD_SA._AR_z),MMD_SA._AR_y&&(b.y+=MMD_SA._AR_y,this.target.y+=0.75*MMD_SA._AR_y,MMD_SA._AR_y_last=MMD_SA._AR_y),MMD_SA._AR_rotx&&(b.applyQuaternion(new THREE.Quaternion().setFromEuler(new THREE.Vector3(MMD_SA._AR_rotx,0,0))),MMD_SA._AR_rotx_last=MMD_SA._AR_rotx),MMD_SA._AR_roty&&(b.applyQuaternion(new THREE.Quaternion().setFromEuler(new THREE.Vector3(0,MMD_SA._AR_roty,0))),MMD_SA._AR_roty_last=MMD_SA._AR_roty),this.checkDistances(),this.object.lookAt(this.target),this.lastPosition.distanceToSquared(this.object.position)>this.EPS&&this.lastPosition.copy(this.object.position)}}},jThree.Trackball=function(a){var b=[];return jThree(isFinite(a)?"rdr:eq("+a+")":a||"rdr").each(function(){var c=new THREE.TrackballControls(jThree.three(jThree.getCamera(this)),jThree.getCanvas(this));jThree.update(this,function(){c.callback&&c.callback(),c.update()}),jThree(this).resize(function(){c.resize()}).on("attrChange",function(f){"camera"!==f.attrName||(c.object=jThree.three(jThree.getCamera(this)),c.target=c.object._lookAt)}),b.push(c)}),self.MMD_SA&&(MMD_SA._trackball_camera=b[0]),1<b.length?b:b[0]};
(function(){function a(){d.call(this),this.type='AudioListener',this.context=j.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0}function b(k){d.call(this),this.type='Audio',this.listener=k,this.context=k.context,this.gain=this.context.createGain(),this.gain.connect(k.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType='empty',this.filters=[]}function c(k){b.call(this,k),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}var d=THREE.Object3D,e=THREE.Vector3,f=THREE.Quaternion,g=THREE.Clock,h,j={getContext:function(){return void 0===h&&(h=new(window.AudioContext||window.webkitAudioContext)),h},setContext:function(k){h=k}};a.prototype=Object.assign(Object.create(d.prototype),{constructor:a,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(k){return null===this.filter?this.gain.disconnect(this.context.destination):(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)),this.filter=k,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(k){return this.gain.gain.setTargetAtTime(k,this.context.currentTime,0.01),this},updateMatrixWorld:function(){var k=new e,m=new f,n=new e,o=new e,p=new g;return function(r){d.prototype.updateMatrixWorld.call(this,r);var s=this.context.listener,t=this.up;if(this.timeDelta=p.getDelta(),this.matrixWorld.decompose(k,m,n),o.set(0,0,-1).applyQuaternion(m),s.positionX){var u=this.context.currentTime+this.timeDelta;s.positionX.linearRampToValueAtTime(k.x,u),s.positionY.linearRampToValueAtTime(k.y,u),s.positionZ.linearRampToValueAtTime(k.z,u),s.forwardX.linearRampToValueAtTime(o.x,u),s.forwardY.linearRampToValueAtTime(o.y,u),s.forwardZ.linearRampToValueAtTime(o.z,u),s.upX.linearRampToValueAtTime(t.x,u),s.upY.linearRampToValueAtTime(t.y,u),s.upZ.linearRampToValueAtTime(t.z,u)}else s.setPosition(k.x,k.y,k.z),s.setOrientation(o.x,o.y,o.z,t.x,t.y,t.z)}}()}),b.prototype=Object.assign(Object.create(d.prototype),{constructor:b,getOutput:function(){return this.gain},setNodeSource:function(k){return this.hasPlaybackControl=!1,this.sourceType='audioNode',this.source=k,this.connect(),this},setMediaElementSource:function(k){return this.hasPlaybackControl=!1,this.sourceType='mediaNode',this.source=this.context.createMediaElementSource(k),this.connect(),this},setBuffer:function(k){return this.buffer=k,this.sourceType='buffer',this.autoplay&&this.play(),this},play:function(){if(!0===this.isPlaying)return void console.warn('THREE.Audio: Audio is already playing.');if(!1===this.hasPlaybackControl)return void console.warn('THREE.Audio: this Audio has no playback control.');this._player&&this._player._dispatchEvent('playing');var k=this.context.createBufferSource();return k.buffer=this.buffer,k.detune.value=this.detune,k.loop=this.loop,k.onended=this.onEnded.bind(this),k.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,k.start(this.startTime,this.offset),this.isPlaying=!0,this.source=k,this.connect()},pause:function(){return!1===this.hasPlaybackControl?void console.warn('THREE.Audio: this Audio has no playback control.'):(!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this)},stop:function(){return!1===this.hasPlaybackControl?void console.warn('THREE.Audio: this Audio has no playback control.'):(this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this)},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var k=1,m=this.filters.length;k<m;k++)this.filters[k-1].connect(this.filters[k]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var k=1,m=this.filters.length;k<m;k++)this.filters[k-1].disconnect(this.filters[k]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(k){return k||(k=[]),!0===this.isPlaying?(this.disconnect(),this.filters=k,this.connect()):this.filters=k,this},setDetune:function(k){return this.detune=k,!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,0.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(k){return this.setFilters(k?[k]:[])},setPlaybackRate:function(k){return!1===this.hasPlaybackControl?void console.warn('THREE.Audio: this Audio has no playback control.'):(this.playbackRate=k,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,0.01),this)},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this._player&&this._player._dispatchEvent('ended'),this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn('THREE.Audio: this Audio has no playback control.'),!1):this.loop},setLoop:function(k){return!1===this.hasPlaybackControl?void console.warn('THREE.Audio: this Audio has no playback control.'):(this.loop=k,!0===this.isPlaying&&(this.source.loop=this.loop),this)},getVolume:function(){return this.gain.gain.value},setVolume:function(k){return this.gain.gain.setTargetAtTime(k,this.context.currentTime,0.01),this}}),c.prototype=Object.assign(Object.create(b.prototype),{constructor:c,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(k){return this.panner.refDistance=k,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(k){return this.panner.rolloffFactor=k,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(k){return this.panner.distanceModel=k,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(k){return this.panner.maxDistance=k,this},setDirectionalCone:function(k,m,n){return this.panner.coneInnerAngle=k,this.panner.coneOuterAngle=m,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(){var k=new e,m=new f,n=new e,o=new e;return function(q){if(d.prototype.updateMatrixWorld.call(this,q),!1!==this.isPlaying){this.matrixWorld.decompose(k,m,n),o.set(0,0,1).applyQuaternion(m);var r=this.panner;if(r.positionX){var s=this.context.currentTime+this.listener.timeDelta;r.positionX.linearRampToValueAtTime(k.x,s),r.positionY.linearRampToValueAtTime(k.y,s),r.positionZ.linearRampToValueAtTime(k.z,s),r.orientationX.linearRampToValueAtTime(o.x,s),r.orientationY.linearRampToValueAtTime(o.y,s),r.orientationZ.linearRampToValueAtTime(o.z,s)}else r.setPosition(k.x,k.y,k.z),r.setOrientation(o.x,o.y,o.z)}}}()}),THREE.AudioContext=j,THREE.AudioListener=a,THREE.Audio=b,THREE.PositionalAudio=c})();

MMD_SA.fn={length:1,load_length_extra:MMD_SA_options.load_length_extra||0,_ready_for_model_creation:[],_model_creation_timerID:[],setupUI:function(){this.length++;var g=MMD_SA_options.motion.length+MMD_SA_options.x_object.length+1+this.load_length_extra;if(g+=MMD_SA_options.model_path_extra.length,this.length<g)DEBUG_show('('+parseInt(100*(this.length/g))+'% loaded)');else if(this.length==g)this._ready_for_model_creation[0]=!0,DEBUG_show('(100% loaded, processing model...)');else if(this.length==g+1);else if(this.length<g+2+2*MMD_SA_options.model_path_extra.length){var h=parseInt((this.length-(g+2))/2)+1;this._ready_for_model_creation[h]=!0,DEBUG_show('(100% loaded, processing extra model (#'+h+')...)')}else this.length==g+2+2*MMD_SA_options.model_path_extra.length?(setTimeout(function(){MMD_SA.fn.init()},200),DEBUG_show('(MMD starting...)',2)):this.length>g+2&&(DEBUG_show('loading error(?)',0,1),console.log('loading error(?)',this.length+'/'+g))},x_object_init:function(){MMD_SA_options.x_object.forEach(function(e,g){if(MMD_SA_options.x_object_by_name[e.path.replace(/^.+[\/\\]/,'').replace(/\.x$/i,'')]=e,e.id='#x_object'+g,e.show=MMD_SA._x_object_show,e.hide=MMD_SA._x_object_hide,e._obj=jThree(e.id).three(0),null!=e.boundingBox_list){var h=e._obj.children[0].geometry;h.boundingBox_list=[],e.boundingBox_list.forEach(function(j){if(null==j)h.boundingBox_list.push(h.boundingBox);else{var l=new THREE.Box3().set(j.min,j.max);l.oncollide=j.oncollide,l.onaway=j.onaway,h.boundingBox_list.push(l)}}),e.bb_adjust&&h.boundingBox_list.forEach(function(j){e.bb_adjust.min&&j.min.add(e.bb_adjust.min)})}null==e.scale&&(e.scale=0==e._obj.scale.x?0:1),e.visible=!e.hidden_on_start&&0<e._obj.scale.x}),MMD_SA_options.mesh_obj.forEach(function(e){if(MMD_SA_options.mesh_obj_by_id[e.id]=MMD_SA_options.mesh_obj_by_id['#'+e.id]=e,e.id='#'+e.id,e.show=MMD_SA._x_object_show,e.hide=MMD_SA._x_object_hide,/^\#mikuPmx(\d+)$/.test(e.id))e._obj=THREE.MMD.getModels()[parseInt(RegExp.$1)].mesh,Object.defineProperty(e,'visible',{get:function(){return this._obj.visible},set:function(j){this._obj.visible=j}}),null==e.scale&&(e.scale=1),e.visible=!0;else{e._obj=jThree(e.id).three(0);var h=e._obj.children.length?e._obj.children[0]:e._obj;e.castShadow&&(h.castShadow=!0),e.receiveShadow&&(h.receiveShadow=!0),null==e.scale&&(e.scale=0==e._obj.scale.x?0:1),e.visible=!e.hidden_on_start&&0<e._obj.scale.x}}),MMD_SA_options.mesh_obj_all=MMD_SA_options.x_object.concat(MMD_SA_options.mesh_obj)},init:function(){var e=jThree;this.x_object_init();var g=this,h=THREE.MMD.getModels()[0],j=[];h.pmx.materials.forEach(function(C){j.push(C.name)}),MMD_SA._material_list=j;var l=[{path:MMD_SA_options.model_path_default}];for(var n in MMD_SA_options.MME_saved){var o=MMD_SA_options.MME_saved[n];o.path_full&&l.push({path:toLocalPath(o.path_full)})}l.forEach(function(C){var D=C.path;/^(\w+\:|\/)/.test(D)||(D=System.Gadget.path+toLocalPath('\\'+D)),C.in_use=D==MMD_SA_options.model_path||-1!=MMD_SA_options.model_path_extra.indexOf(D)}),MMD_SA._model_list=l,THREE.MMD.getModels().forEach(function(C){C.skin_MMD_SA_extra=[],C.morph_MMD_SA_extra=[]}),MMD_SA.MMD={MotionManager:function(){this._model_index=0},setFrameNumber:function(){},play:function(){jThree.MMD.play()},pause:function(){jThree.MMD.pause()}},Object.defineProperty(MMD_SA.MMD.MotionManager.prototype,'lastFrame',{get:function(){var C=THREE.MMD.getModels()[this._model_index]._MMD_SA_cache[this.para_SA._path];return 30*C.skin.duration}}),Object.defineProperty(MMD_SA.MMD.MotionManager.prototype,'lastFrame_',{get:function(){if(null!=this._lastFrame_)return this._lastFrame_;var C=MMD_SA.MMD.motionManager;return C.para_SA.multi_model_motion_list&&-1!=C.para_SA.multi_model_motion_list.indexOf(this.filename)?C._lastFrame_:this.lastFrame},set:function(C){this._lastFrame_=C}}),Object.defineProperty(MMD_SA.MMD.MotionManager.prototype,'firstFrame_',{get:function(){if(null!=this._firstFrame_)return this._firstFrame_;var C=MMD_SA.MMD.motionManager;return C.para_SA.multi_model_motion_list&&-1!=C.para_SA.multi_model_motion_list.indexOf(this.filename)?C._firstFrame_:0},set:function(C){this._firstFrame_=C}}),MMD_SA.motion=[];for(var x,q=MMD_SA_options.motion_shuffle_list_default&&MMD_SA_options.motion_shuffle_list_default[0]||0,u=0,w=MMD_SA_options.motion.length;u<w;u++){if(x=MMD_SA_options.motion[u],!x.path){MMD_SA.motion.push(new MMD_SA.MMD.MotionManager);continue}var z=decodeURIComponent(x.path.replace(/^.+[\/\\]/,'').replace(/\.vmd$/i,'')),A=MMD_SA_options.motion_para[z]||{},B=jThree.getReferent?jThree.getReferent('#vmd'+u).three(0):MMD_SA.vmd_by_filename[z];if(B._index=u,x.is_vmd_component){MMD_SA.motion.push({});continue}x.morph_component_by_filename&&(B._morph_component=MMD_SA.vmd_by_filename[x.morph_component_by_filename],B._morph_component.url=B.url),THREE.MMD.getModels().forEach(function(C,D){var E,F,G,H,I;if(F=C._MMD_SA_cache[x.path],F)C._MMD_SA_cache_current=F,G=F.skin,H=F.morph,G&&(G._model_index=C._model_index,G._motion_index=u),H&&(H._model_index=C._model_index,H._motion_index=u);else{I=MMD_SA_options.model_para_obj_all[D],E=x.jThree_para;var J=!1;if(A.model_name_RegExp||A.model_index_list?(A.model_name_RegExp&&(J=!A.model_name_RegExp.test(I._filename)),A.model_index_list&&(!A.model_name_RegExp||J)&&(J=-1==A.model_index_list.indexOf(D),J&&-1!=A.model_index_list.indexOf(0)&&I.is_PC_candidate&&(J=!1))):0<D&&!I.is_PC_candidate&&(E||!I.mirror_motion_from_first_model)&&(J=!0),I.motion_name_default==z&&(J=!1),J)return void(D!=MMD_SA_options.model_para_obj_all.length-1||MMD_SA.motion.length&&MMD_SA.motion[MMD_SA.motion.length-1].filename==z||MMD_SA.motion.push({}));F=C.setupMotion_MMD_SA(B,x.match,E),G=F.skin,H=F.morph,E&&(G._is_MMD_SA_custom_animation=H._is_MMD_SA_custom_animation=MMD_SA.custom_action_index&&u>=MMD_SA.custom_action_index&&u<MMD_SA.motion_number_meter_index,G._is_MMD_SA_animation=!0,G._is_skin=!0,G._MMD_SA_disabled=!0,G.freeze_onended=!0,C.skin_MMD_SA_extra&&(G._motion_index_extra=C.skin_MMD_SA_extra.length,C.skin_MMD_SA_extra.push(G)),H._is_MMD_SA_animation=!0,H._is_morph=!0,H._MMD_SA_disabled=!0,H.freeze_onended=!0,C.morph_MMD_SA_extra&&(H._motion_index_extra=C.morph_MMD_SA_extra.length,C.morph_MMD_SA_extra.push(H)),G._MMD_SA_animation_check=H._MMD_SA_animation_check=E.animation_check)}if((!E||G._is_MMD_SA_custom_animation)&&(C._MMD_SA_cache[x.path]=F,!MMD_SA.motion.length||MMD_SA.motion[MMD_SA.motion.length-1].filename!=z)){var K=new MMD_SA.MMD.MotionManager;K.filename=z,K.para_SA=A,K.para_SA._path=x.path,K._index=K.para_SA._index=MMD_SA.motion.length,K._model_index=D,MMD_SA.motion.push(K)}C.skin&&u!=q&&I.motion_name_default!=z||(!I.motion_name_default&&(0==D?u==q&&(I.motion_name_default=z):0<D&&!I.mirror_motion_from_first_model&&(I.motion_name_default=z)),C._MMD_SA_cache_current=F,C.skin=G,C.morph=H,THREE.MMD.adjustMotionDuration())})}MMD_SA.MMD.motionManager=MMD_SA.motion[0],MMD_SA_options.use_speech_bubble&&MMD_SA.SpeechBubble.onload(),MMD_SA._tray_updatable=!0,System._browser.update_tray(),setTimeout(function(){MMD_SA.MMD_started=!0,resize(),e.MMD.cameraMotion=!0,MMD_SA._head_pos=new THREE.Vector3(0,15,0),MMD_SA_options.model_para_obj.onMotionChange&&MMD_SA_options.model_para_obj.onMotionChange();var C=function(){var F=this,G=this.mesh,H=MMD_SA_options.Dungeon&&MMD_SA_options.Dungeon.accessory_list||MMD_SA_options.mesh_obj_all;H.forEach(function(I){var J=I.parent_bone;if(J){var K=J.model_index||0;if(F._model_index==K){if(MMD_SA_options.Dungeon){if(!G.visible||I.parent_bone.disabled)return I._obj_proxy.hidden=!0,void(I._obj_proxy.visible=!1);I._obj_proxy.hidden=!1,I._obj_proxy.visible=!0}if(!J.condition||J.condition(I,K)){var M,L=MMD_SA.motion[F.skin._motion_index].para_SA;M=L.adjustment_per_model&&(L.adjustment_per_model[MMD_SA_options.model_para_obj._filename]||L.adjustment_per_model[MMD_SA_options.model_para_obj._filename_cleaned]),M=M&&M.accessory_default&&M.accessory_default[I.path.replace(/^.+[\/\\]/,'')],M&&(J=M.parent_bone);var N=G.bones_by_name[J.name];if(N){var O=N.skinMatrix.decompose(),P=O[0],Q=O[1],R=I._obj;R.position.copy(P),J.position&&R.position.add(MMD_SA.TEMP_v3.set(J.position.x,J.position.y,-J.position.z).applyQuaternion(Q)),R.useQuaternion=!0,R.quaternion.copy(Q),J.rotation&&(!J.rotation._quaternion&&(J.rotation._quaternion=new THREE.Quaternion().setFromEuler(MMD_SA.TEMP_v3.set(-J.rotation.x,-J.rotation.y,J.rotation.z).multiplyScalar(Math.PI/180),'YXZ')),R.quaternion.multiply(J.rotation._quaternion));var S=MMD_SA.TEMP_m4.makeFromPositionQuaternionScale(R.position,R.quaternion,R.scale).multiplyMatrices(G.matrixWorld,MMD_SA.TEMP_m4).decompose();R.position.copy(S[0]),R.quaternion.copy(S[1]),R.matrixAutoUpdate=!1,R.updateMatrix()}}}}})};THREE.MMD.getModels().forEach(function(F){F.simulateCallback=C});var D=MMD_SA_options.MME.PostProcessingEffects;MMD_SA_options._PPE_enabled=D.enabled,MMD_SA_options.PPE_disabled_on_idle&&MMD_SA_options._PPE_enabled&&(D.enabled=!1),MMD_SA.fadeout_opacity=0.95,MMD_SA.fadeout_canvas.width=SL.width,MMD_SA.fadeout_canvas.height=SL.height;var E=MMD_SA.fadeout_canvas.getContext('2d');E.globalCompositeOperation='copy',E.globalAlpha=0.01,E.fillRect(0,0,SL.width,SL.height),E.globalAlpha=1,MMD_SA_options.model_para_obj_all.forEach(function(F,G){var H=THREE.MMD.getModels()[G].mesh;(F.position_loading||F.bone_connection||H.bones_by_name.)&&H.position.set(0,0,0),F.scale&&H.scale.set(F.scale,F.scale,F.scale)}),MMD_SA_options.onstart&&MMD_SA_options.onstart(),window.dispatchEvent(new CustomEvent('MMDStarted')),MMD_SA.toggle_shadowMap(),e.MMD.play(!0),DEBUG_show('(MMD started)',2),MMD_SA.use_webgl2&&DEBUG_show('Use WebGL2',2),MMD_SA.use_MSAA_FBO&&DEBUG_show('Use MSAA FBO',2)},0),jThree.Trackball&&(jThree.trackball=jThree.Trackball),e.trackball(),returnBoolean('MMDTrackballCamera')||MMD_SA._trackball_camera.stop(),MMD_SA_options.edgeScale=0<=MMD_SA_options.model_para_obj.edgeScale?MMD_SA_options.model_para_obj.edgeScale:0<=MMD_SA_options.edgeScale?MMD_SA_options.edgeScale:1,e.MMD.edgeScale=parseFloat(System.Gadget.Settings.readString('MMDEdgeScale')||Settings_default.MMDEdgeScale)*MMD_SA_options.edgeScale,jQuery('canvas').on('mousedown mousewheel DOMMouseScroll',function(){e.MMD.cameraMotion=!1}).dblclick(function(){e.MMD.cameraMotion=!0})}},function(){if(MMD_SA.TEMP_q=new THREE.Quaternion,MMD_SA._q1=new THREE.Quaternion,MMD_SA._q2=new THREE.Quaternion,MMD_SA.TEMP_v3=new THREE.Vector3,MMD_SA._v3a=new THREE.Vector3,MMD_SA._v3b=new THREE.Vector3,MMD_SA.TEMP_m4=new THREE.Matrix4,MMD_SA._m4a=new THREE.Matrix4,MMD_SA._m4b=new THREE.Matrix4,MMD_SA.TEMP_b3=new THREE.Box3,MMD_SA._v3a_=new THREE.Vector3,MMD_SA._v3b_=new THREE.Vector3,MMD_SA.process_bone=function(j,l,n){var o=MMD_SA._v3a_.setEulerFromQuaternion(j.quaternion);n&&(o.x*=n[0],o.y*=n[1],o.z*=n[2]),l instanceof THREE.Quaternion&&(l=MMD_SA._v3b_.setEulerFromQuaternion(l)),o.add(l),j.quaternion.setFromEuler(o)},MMD_SA.copy_first_bone_frame=function(j,l,n){n||(n=MMD_SA_options.motion[j].match);var o=n&&n.skin_jThree?n.skin_jThree:null;l._is_skin||(l=THREE.MMD.getModels()[0].skin_MMD_SA_extra[l._motion_index_extra]);var q=l.mesh;l.targets.forEach(function(u){var w=u.keys[0];if(w&&(!o||o.test(w.name))&&!w.time){var x=q.bones_by_name[w.name],z=q.geometry.bones[x._index];w.pos[0]=x.position.x-z.pos[0],w.pos[1]=x.position.y-z.pos[1],w.pos[2]=x.position.z-z.pos[2],w.rot=x.quaternion.toArray()}})},MMD_SA.reset_skin=function(j){THREE.MMD.getModels().forEach(function(l,n){if(null==j||n==j){var o=l.skin;if(o&&!o._is_dummy)for(var q=o.mesh,u=q.geometry,w=0,x=q.bones.length;w<x;w++){var z=q.bones[w],A=u.bones[w];z.position.set(A.pos[0],A.pos[1],A.pos[2]),z.quaternion.set(0,0,0,1)}}})},MMD_SA.reset_morph=function(j){THREE.MMD.getModels().forEach(function(l,n){if(null==j||n==j){var o=l.morph;if(!(o&&o._is_dummy)&&(o=l.mesh.morphTargetInfluences,o))for(var q=0,u=o.length;q<u;q++)o[q]=0}})},MMD_SA._camera_y_offset_=0,MMD_SA.reset_camera=function(j){j&&window.dispatchEvent(new CustomEvent('MMDCameraReset',{detail:{}})),this._camera_y_offset_=0;var l=this.center_view,n=this.center_view_lookAt,o=THREE.MMD.getModels()[0].mesh.position,q=MMD_SA_options.camera_position.slice();if(MMD_SA_options.use_random_camera&&returnBoolean('MMDRandomCamera')&&(MMD_SA.MMD.motionManager.para_SA.use_random_camera||Audio_BPM.vo.BPM_mode)){var u=MMD_SA_options.random_camera;q=MMD_SA.TEMP_v3.set(q[0]-o.x,q[1]-o.y,q[2]-o.z).multiplyScalar(u.distance[0]+Math.random()*(u.distance[1]-u.distance[0])).applyQuaternion(MMD_SA.TEMP_q.setFromEuler(MMD_SA._v3a.set((u.rotation.x[0]+Math.random()*(u.rotation.x[1]-u.rotation.x[0]))*Math.PI/180,(u.rotation.y[0]+Math.random()*(u.rotation.y[1]-u.rotation.y[0]))*Math.PI/180,(u.rotation.z[0]+Math.random()*(u.rotation.z[1]-u.rotation.z[0]))*Math.PI/180))).add(o).toArray()}var w=this._trackball_camera;w.position0.set(q[0]+l[0],q[1]+l[1],q[2]+l[2]),w.target0.set(o.x+n[0],o.y+10+n[1],o.z+n[2]),w.reset(),MMD_SA._mouse_pos_3D=[],MMD_SA._trackball_camera.SA_adjust(),MMD_SA._trackball_camera.rotate_with_up_fixed=MMD_SA_options.Dungeon&&MMD_SA_options.Dungeon.character.TPS_mode},MMD_SA.Animation_dummy={_is_dummy:!0,_MMD_SA_disabled:!0},MMD_SA.Animation_dummy.reset=MMD_SA.Animation_dummy.seek=MMD_SA.Animation_dummy.play=MMD_SA.Animation_dummy.pause=MMD_SA.Animation_dummy.update=MMD_SA.Animation_dummy.adjustDuration=MMD_SA.Animation_dummy.onupdate=function(){},THREE.Box3.prototype.intersectObject=function(){function j(ma,na){return ma.normal.y>na}function l(ma,na,oa,pa,qa,ra,sa,ta){var ua,va,wa,xa,ya,za,Aa,Ba,Ca,Da;if(wa=oa-ma,xa=pa-na,ya=sa-qa,za=ta-ra,Ca=wa*za-ya*xa,0==Ca)return 0;var Ea=0<Ca;if(ua=ma-qa,va=na-ra,Aa=wa*va-xa*ua,0>Aa==Ea)return 0;if(Ba=ya*va-za*ua,0>Ba==Ea)return 0;if(Aa>Ca==Ea||Ba>Ca==Ea)return 0;Da=Ba/Ca;var Fa=ma+Da*wa,Ga=na+Da*xa;return[Fa,Ga]}var n={},o=new THREE.Vector3,q=new THREE.Vector3,u=new THREE.Vector3,w=new THREE.Vector3,x=new THREE.Vector3,z=new THREE.Vector3,A=new THREE.Vector3,B=new THREE.Vector3,C=new THREE.Vector3,D=new THREE.Vector3,E=new THREE.Vector3,F=new THREE.Vector3,G=new THREE.Vector3,H=new THREE.Vector3,I=new THREE.Vector3,J=new THREE.Vector3,K=new THREE.Vector3,L=new THREE.Plane;n.isIntersectionAABBPlane=function(ma,na){o.addVectors(ma.max,ma.min).multiplyScalar(0.5),q.subVectors(ma.max,o);var oa=q.x*Math.abs(na.normal.x)+q.y*Math.abs(na.normal.y)+q.z*Math.abs(na.normal.z),pa=na.normal.dot(o)-na.constant;return Math.abs(pa)<=oa},n.isIntersectionTriangleAABB=function(ma,na,oa,pa){var qa,ra,sa,ta;return(o.addVectors(pa.max,pa.min).multiplyScalar(0.5),q.subVectors(pa.max,o),u.subVectors(ma,o),w.subVectors(na,o),x.subVectors(oa,o),z.subVectors(w,u),A.subVectors(x,w),B.subVectors(u,x),C.set(0,-z.z,z.y),D.set(0,-A.z,A.y),E.set(0,-B.z,B.y),F.set(z.z,0,-z.x),G.set(A.z,0,-A.x),H.set(B.z,0,-B.x),I.set(-z.y,z.x,0),J.set(-A.y,A.x,0),K.set(-B.y,B.x,0),qa=u.dot(C),ra=w.dot(C),sa=x.dot(C),ta=q.y*Math.abs(z.z)+q.z*Math.abs(z.y),!(Math.max(-Math.max(qa,ra,sa),Math.min(qa,ra,sa))>ta))&&(qa=u.dot(D),ra=w.dot(D),sa=x.dot(D),ta=q.y*Math.abs(A.z)+q.z*Math.abs(A.y),!(Math.max(-Math.max(qa,ra,sa),Math.min(qa,ra,sa))>ta))&&(qa=u.dot(E),ra=w.dot(E),sa=x.dot(E),ta=q.y*Math.abs(B.z)+q.z*Math.abs(B.y),!(Math.max(-Math.max(qa,ra,sa),Math.min(qa,ra,sa))>ta))&&(qa=u.dot(F),ra=w.dot(F),sa=x.dot(F),ta=q.x*Math.abs(z.z)+q.z*Math.abs(z.x),!(Math.max(-Math.max(qa,ra,sa),Math.min(qa,ra,sa))>ta))&&(qa=u.dot(G),ra=w.dot(G),sa=x.dot(G),ta=q.x*Math.abs(A.z)+q.z*Math.abs(A.x),!(Math.max(-Math.max(qa,ra,sa),Math.min(qa,ra,sa))>ta))&&(qa=u.dot(H),ra=w.dot(H),sa=x.dot(H),ta=q.x*Math.abs(B.z)+q.z*Math.abs(B.x),!(Math.max(-Math.max(qa,ra,sa),Math.min(qa,ra,sa))>ta))&&(qa=u.dot(I),ra=w.dot(I),sa=x.dot(I),ta=q.x*Math.abs(z.y)+q.y*Math.abs(z.x),!(Math.max(-Math.max(qa,ra,sa),Math.min(qa,ra,sa))>ta))&&(qa=u.dot(J),ra=w.dot(J),sa=x.dot(J),ta=q.x*Math.abs(A.y)+q.y*Math.abs(A.x),!(Math.max(-Math.max(qa,ra,sa),Math.min(qa,ra,sa))>ta))&&(qa=u.dot(K),ra=w.dot(K),sa=x.dot(K),ta=q.x*Math.abs(B.y)+q.y*Math.abs(B.x),!(Math.max(-Math.max(qa,ra,sa),Math.min(qa,ra,sa))>ta))&&(Math.max(u.x,w.x,x.x)<-q.x||Math.min(u.x,w.x,x.x)>q.x?!1:Math.max(u.y,w.y,x.y)<-q.y||Math.min(u.y,w.y,x.y)>q.y?!1:Math.max(u.z,w.z,x.z)<-q.z||Math.min(u.z,w.z,x.z)>q.z?!1:(L.normal.copy(A).cross(z).normalize(),L.constant=L.normal.dot(ma),n.isIntersectionAABBPlane(pa,L)))};var la,M={_updated:!1,reset:function(ma){this.x_min={state:0,depth:[0,0],info:['','']},this.x_max={state:0,depth:[0,0],info:['','']},this.z_min={state:0,depth:[0,0],info:['','']},this.z_max={state:0,depth:[0,0],info:['','']},this.y_min={state:0,depth:[0,0],info:['','']},this.y_max={state:0,depth:[0,0],info:['','']},this.blocked={state:0,depth:[0,0],info:['','']},this.depth_min=0.1/ma._obj.scale.length(),this._updated=!1},set_state:function(ma,na,oa){na>M.depth_min&&this.depth[ma-1]<na&&(this.depth[ma-1]=na,this.state<ma&&(this.state=ma),this.info=oa,this!=M.y_min&&(M._updated=!0))}},N=new THREE.Matrix4,O=new THREE.Plane,P=new THREE.Ray,Q=new THREE.Box3,R=new THREE.Box3,S=new THREE.Box3,T=new THREE.Box3,U=new THREE.Box3,V=new THREE.Box3,W=new THREE.Box3,X=new THREE.Box3,Y=new THREE.Box3,Z=new THREE.Box3,_=new THREE.Vector3,aa=new THREE.Vector3,ba=new THREE.Vector3,ca=new THREE.Vector3,da={x_min:new THREE.Plane,x_max:new THREE.Plane,z_min:new THREE.Plane,z_max:new THREE.Plane,y_min:new THREE.Plane,y_max:new THREE.Plane},ea={x_min:new THREE.Plane,x_max:new THREE.Plane,z_min:new THREE.Plane,z_max:new THREE.Plane,y_min:new THREE.Plane,y_max:new THREE.Plane},fa={x_min:new THREE.Plane,x_max:new THREE.Plane,z_min:new THREE.Plane,z_max:new THREE.Plane,y_min:new THREE.Plane,y_max:new THREE.Plane},ga={x_min:new THREE.Plane,x_max:new THREE.Plane,z_min:new THREE.Plane,z_max:new THREE.Plane,y_min:new THREE.Plane,y_max:new THREE.Plane},ha=new THREE.Vector3,ia=new THREE.Vector3,ja=new THREE.Vector3,ka=new THREE.Plane;return function(ma,na){var wa,xa,ya,za,oa=ma.collision_by_mesh_face_grounded||j,pa=ma._obj,qa=pa.geometry?pa:pa.children[0],ra=qa.geometry,sa=ra.vertices,ta=qa.material instanceof THREE.MeshFaceMaterial,ua=!0===ta?qa.material.materials:null,va=qa.material.side;N.getInverse(pa.matrixWorld),Q.copy(na).applyMatrix4(N),R.copy(this).applyMatrix4(N);var Aa=this==na?[Q]:[R,Q],Ba=Q.min.y>R.min.y?Q:R,Ca=Ba.min.y+0.25*(Ba.max.y-Ba.min.y),Da=Ba.center(o).y,Ea=(Q.min.y>R.min.y?R.min.y:Q.min.y)-2*Math.max(Q.max.x-Q.min.x,Q.max.z-Q.min.z);R.union(Q),Q.center(_),R.center(aa),P.set(ha.copy(aa).setY(R.max.y),new THREE.Vector3(0,-1,0)),U.copy(Q),U.expandByVector(ha.copy(U.size(ba)).multiplyScalar(-0.25)),U.min.y=Ca,V.copy(R),V.expandByVector(ha.copy(V.size(ca)).multiplyScalar(-0.25)),V.min.y=Ca,W.copy(Q),W.expandByVector(ha.copy(W.size(ba)).multiplyScalar(-0.125)),W.min.y=Ca,X.copy(R),X.expandByVector(ha.copy(X.size(ca)).multiplyScalar(-0.125)),X.min.y=Ca;var Fa=!1,Ga=-999;S.copy(Q),T.copy(T),Q.min.y=Math.min(ra.boundingBox.min.y,Q.min.y),R.min.y=Math.min(ra.boundingBox.min.y,R.min.y);var Ha={},Ia={},Ja={},Ka={},La=[Q,R,S,T],Ma=[Ha,Ia,Ja,Ka];for(var Na in da)'x_min'===Na||'x_max'===Na?La.forEach(function(gb,hb){Ma[hb][Na]=[[[gb.min.z,gb.max.y],[gb.max.z,gb.max.y]],[[gb.max.z,gb.max.y],[gb.max.z,gb.min.y]],[[gb.min.z,gb.min.y],[gb.max.z,gb.min.y]],[[gb.min.z,gb.max.y],[gb.min.z,gb.min.y]]]}):'z_min'===Na||'z_max'===Na?La.forEach(function(gb,hb){Ma[hb][Na]=[[[gb.min.x,gb.max.y],[gb.max.x,gb.max.y]],[[gb.max.x,gb.max.y],[gb.max.x,gb.min.y]],[[gb.min.x,gb.min.y],[gb.max.x,gb.min.y]],[[gb.min.x,gb.max.y],[gb.min.x,gb.min.y]]]}):'y_min'===Na||'y_max'===Na?La.forEach(function(gb,hb){Ma[hb][Na]=[[[gb.min.x,gb.max.z],[gb.max.x,gb.max.z]],[[gb.max.x,gb.max.z],[gb.max.x,gb.min.z]],[[gb.min.x,gb.min.z],[gb.max.x,gb.min.z]],[[gb.min.x,gb.max.z],[gb.min.x,gb.min.z]]]}):void 0;var La=[Q,R,S,T];[da,ea,fa,ga].forEach(function(gb,hb){var ib=La[hb];gb.x_min.setFromNormalAndCoplanarPoint(ha.set(-1,0,0),ia.set(ib.min.x,0,0)),gb.x_max.setFromNormalAndCoplanarPoint(ha.set(1,0,0),ia.set(ib.max.x,0,0)),gb.z_min.setFromNormalAndCoplanarPoint(ha.set(0,0,-1),ia.set(0,0,ib.min.z)),gb.z_max.setFromNormalAndCoplanarPoint(ha.set(0,0,1),ia.set(0,0,ib.max.z)),gb.y_min.setFromNormalAndCoplanarPoint(ha.set(0,-1,0),ia.set(0,ib.min.y,0)),gb.y_max.setFromNormalAndCoplanarPoint(ha.set(0,1,0),ia.set(0,ib.max.y,0))}),M.reset(ma);var Pa,Qa,Ra,Oa=ma.collision_by_mesh_material_index_max||999;ma.collision_by_mesh_sort_range?(Pa=ma.collision_by_mesh_sort_range,Qa=ma.mesh_sorted.index_list,Ra=0):(Pa=0,Qa=ra.faces,Ra=0);for(var Sa={},Ta=[],Ua={},Va=-1,Wa=Ra,Xa=Qa.length;Wa<Xa;Wa++){var Ya=0===Pa?Wa:Qa[Wa];var Za=ra.faces[Ya];if(Za.materialIndex>=Oa)break;var $a=!0==ta?ua[Za.materialIndex]:qa.material;if(void 0!==$a){wa=sa[Za.a],xa=sa[Za.b],ya=sa[Za.c];var va=$a.side;if(va!==THREE.DoubleSide){var _a=ha.addVectors(wa,xa).add(ya).multiplyScalar(1/3).sub(aa).normalize().dot(Za.normal);if(va===THREE.FrontSide?!(0>_a):!(0<_a))continue}if(la=[],Za instanceof THREE.Face3)la.push([wa,xa,ya]);else if(Za instanceof THREE.Face4)za=sa[Za.d],la.push([wa,xa,za],[xa,ya,za]);else continue;la.forEach(function(fc){var gc=0;Aa.some(function(hc){if(!n.isIntersectionTriangleAABB(fc[0],fc[1],fc[2],hc))return!0;Sa[Ya]={};var ic,jc,kc,lc,mc,nc,oc,pc,qc,sc;hc==Q?(ic=S,jc=U,kc=W,lc=Ha,mc=Ja,nc=da,oc=fa,pc=_,qc=ba,sc=1,Fa=!0):(ic=T,jc=V,kc=X,lc=Ia,mc=Ka,nc=ea,oc=ga,pc=aa,qc=ca,sc=2);var uc,vc=0,wc=oa(Za,0.5);P.intersectTriangle(fc[2],fc[0],fc[1],!1,ha)&&(ha.y>Da?ha.y>jc.max.y?M.set_state.call(M.y_max,sc,hc.max.y-ha.y):uc=!0:vc>=gc&&(vc=gc=sc,Ga=Math.max(Ga,ha.y),Ga==ha.y&&(Va=Ya)));for(var xc=0;2>xc;xc++){var yc,zc,Ac,Bc;1==xc?(yc=hc,zc=nc,Ac=lc,Bc=Y):(yc=ic,zc=oc,Ac=mc,Bc=Z);var Cc=[],Dc=[];if(uc||fc.some(function(cd,dd){if(yc.containsPoint(cd)){if(jc.containsPoint(cd))return uc=!0,!0;Cc.push(cd.clone())}else Dc[dd]=!0}),uc)return void M.set_state.call(M.blocked,sc,1,Ya);var Ec=[];(Dc[0]||Dc[1])&&Ec.push(new THREE.Line3(fc[0],fc[1])),(Dc[1]||Dc[2])&&Ec.push(new THREE.Line3(fc[1],fc[2])),(Dc[2]||Dc[0])&&Ec.push(new THREE.Line3(fc[2],fc[0]));var Fc={x_min:[],x_max:[],z_min:[],z_max:[],y_min:[],y_max:[]};for(var Gc in Ec.forEach(function(cd){for(var dd in zc){var ed=zc[dd].intersectLine(cd);ed&&Fc[dd].push(ed)}}),Fc){var Hc=Fc[Gc];if(!(2>Hc.length)){var Ic=0,Jc=[];if(Hc.forEach(function(cd){var dd;'x_min'==Gc||'x_max'==Gc?dd=cd.y>=yc.min.y&&cd.y<=yc.max.y&&cd.z>=yc.min.z&&cd.z<=yc.max.z:'z_min'==Gc||'z_max'==Gc?dd=cd.y>=yc.min.y&&cd.y<=yc.max.y&&cd.x>=yc.min.x&&cd.x<=yc.max.x:'y_min'==Gc||'y_max'==Gc?dd=cd.z>=yc.min.z&&cd.z<=yc.max.z&&cd.x>=yc.min.x&&cd.x<=yc.max.x:void 0,dd&&(Ic++,Jc.push(cd))}),2>Ic){var Kc;'x_min'==Gc||'x_max'==Gc?Kc=[Hc[0].z,Hc[0].y,Hc[1].z,Hc[1].y]:'z_min'==Gc||'z_max'==Gc?Kc=[Hc[0].x,Hc[0].y,Hc[1].x,Hc[1].y]:'y_min'==Gc||'y_max'==Gc?Kc=[Hc[0].x,Hc[0].z,Hc[1].x,Hc[1].z]:void 0,Ac[Gc].some(function(cd){var dd=l(cd[0][0],cd[0][1],cd[1][0],cd[1][1],Kc[0],Kc[1],Kc[2],Kc[3]);if(dd){var ed;return'x_min'==Gc?ed=new THREE.Vector3(yc.min.x,dd[1],dd[0]):'x_max'==Gc?ed=new THREE.Vector3(yc.max.x,dd[1],dd[0]):'z_min'==Gc?ed=new THREE.Vector3(dd[0],dd[1],yc.min.z):'z_max'==Gc?ed=new THREE.Vector3(dd[0],dd[1],yc.max.z):'y_min'==Gc?ed=new THREE.Vector3(dd[0],yc.min.y,dd[1]):'y_max'==Gc?ed=new THREE.Vector3(dd[0],yc.max.y,dd[1]):void 0,Jc.push(ed),2==++Ic}})}2==Ic&&Cc.push(Jc[0],Jc[1])}}if(Cc.length){var Lc=ha.copy(Cc[0]),Mc=ia.copy(Cc[0]);Cc.forEach(function(cd){Lc.min(cd),Mc.max(cd)}),Bc.set(Lc,Mc),yc==hc&&(wc&&!vc&&sc>=gc&&(Bc.max.y<Ca?(vc=gc=sc,Ga=Math.max(Ga,Bc.max.y),Ga==Bc.max.y&&(Va=Ya)):Bc.min.y<Ca&&(vc=gc=sc,Ga=Math.max(Ga,Ca),Ga==Ca&&(Va=Ya))),1==sc&&Cc.forEach(function(cd){if(cd.y>Ea&&(wc||vc)){var dd=cd.clone();Ta.push(dd),Ua[Ya]||(Ua[Ya]=[]),Ua[Ya].push(dd)}}));var Nc=ja.copy(Za.normal).multiplyScalar(Math.max(qc.x,qc.z)).negate();Cc.forEach(function(cd){cd.add(Nc),Lc.min(cd),Mc.max(cd)}),Bc.set(Lc,Mc).intersect(yc);var Oc=Sa[Ya];if(Oc.abc=[Za.a,Za.b,Za.c],Oc.bb_priority={},Oc.bb_priority[sc]={_bb_contained:Bc.clone()},vc)return;if(Bc.max.y<Ga)return;for(var Pc,Rc,Sc,Tc,Uc,Vc,Wc,Xc,Yc,Zc,Qc='',$c=0;2>$c;$c++){if(1==$c){var _c=0;for(var ad in Sa){Oc=Sa[ad];var bd=Oc.abc;!bd||ad==Ya||!Oc.bb_priority[sc]||-1==bd.indexOf(Za.a)&&-1==bd.indexOf(Za.b)&&-1==bd.indexOf(Za.c)||(_c++,Bc.union(Oc.bb_priority[sc]._bb_contained))}if(!_c)break}else;Pc=Bc.center(ha),Rc=Pc.x>jc.min.x&&Pc.x<jc.max.x,Sc=Pc.y>jc.min.y&&Pc.y<jc.max.y,Tc=Pc.z>jc.min.z&&Pc.z<jc.max.z,Uc=Rc||Bc.min.x>kc.min.x&&Bc.min.x<kc.max.x||Bc.max.x>kc.min.x&&Bc.max.x<kc.max.x,Vc=Bc.max.y>Ca,Wc=Tc||Bc.min.z>kc.min.z&&Bc.min.z<kc.max.z||Bc.max.z>kc.min.z&&Bc.max.z<kc.max.z,Xc=!Rc,Yc=!Sc,Zc=!Tc,Xc&&Vc&&M.set_state.call(M['x_'+(Pc.x>pc.x?'max':'min')],sc,Bc.max.x-Bc.min.x,Qc),Uc&&Yc&&Wc&&M.set_state.call(M['y_'+(Pc.y>pc.y?'max':'min')],sc,Bc.max.y-Bc.min.y,Qc),Vc&&Zc&&M.set_state.call(M['z_'+(Pc.z>pc.z?'max':'min')],sc,Bc.max.z-Bc.min.z,Qc)}}}})})}}var ab=0;for(var cb in Sa)ab++;var db=[];if(-1!=Va&&Ua[Va]){var eb=ra.faces[Va];for(var cb in Ta=Ua[Va].slice(),Ua){fh=Sa[cb];var fb=fh.abc;!fb||cb==Va||-1==fb.indexOf(eb.a)&&-1==fb.indexOf(eb.b)&&-1==fb.indexOf(eb.c)||(db.push(cb),Ta=Ta.concat(Ua[cb]))}db.push(Va)}return{hit:[ab,Qa.length],updated:M._updated||-999<Ga||Fa,blocked_side:M,ground_y:Ga,ground_face_index:Va,ground_face_connected:db,bb_static_collided:Fa,plane_pts:Ta}}}(),THREE.Ray.prototype.intersectTriangle=function(){var j=new THREE.Vector3,l=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3;return function(u,w,x,z,A){l.subVectors(w,u),n.subVectors(x,u),o.crossVectors(l,n);var C,B=this.direction.dot(o);if(0<B){if(z)return null;C=1}else if(0>B)C=-1,B=-B;else return null;j.subVectors(this.origin,u);var D=C*this.direction.dot(n.crossVectors(j,n));if(0>D)return null;var E=C*this.direction.dot(l.cross(j));if(0>E)return null;if(D+E>B)return null;var F=-C*j.dot(o);return 0>F?null:this.at(F/B,A)}}(),MMD_SA.bone_to_position=function(){function j(){this.by_bone_name=[],this.pos_delta=new THREE.Vector3,this.pos_delta_rotated=new THREE.Vector3}var l=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3,q=new THREE.Vector3;return j.prototype.init=function(u,w,x,z){var A=this.by_bone_name[w];A||(A=this.by_bone_name[w]={gbone:{position:new THREE.Vector3().fromArray(u.geometry.bones[u.bones_by_name[w]._index].pos)},position:new THREE.Vector3,quaternion:new THREE.Quaternion,path:'',motion_time:0}),(A.path!=x||A.motion_time>z)&&(A.position.set(0,0,0),A.quaternion.set(0,0,0,1),A.path=x),A.motion_time=z,this.gbone=A.gbone,this.position=A.position,this.quaternion=A.quaternion},function(u){var w=this;if(!w.skin)return null;var x=this.mesh;return(x._bone_to_position_last?(x._bone_to_position_last.pos_delta.set(0,0,0),x._bone_to_position_last.pos_delta_rotated.set(0,0,0)):x._bone_to_position_last=new j,!u.bone_to_position)?null:(u.bone_to_position.forEach(function(z){var A=z.name,B=z.scale||{x:1,y:1,z:1},C=x.bones_by_name[A],D=w.skin.time,E=30*D;x._bone_to_position_last.init(x,A,u._path,D),!z.frame_range||z.frame_range.some(function(J){return E>=J[0]&&E<=J[1]})?l.copy(C.position).sub(x._bone_to_position_last.gbone.position).multiply(B):l.set(0,0,0),o.copy(l);var F,G;if(u.adjustment_per_model){var H=u.adjustment_per_model[MMD_SA_options.model_para_obj_all[w._model_index]._filename_cleaned]||u.adjustment_per_model._default_;if(H.skin_default){var I=H.skin_default[A]||{};F=I.rot_add||I.rot,F||u.bone_to_position.some(function(J){return'\u5168\u3066\u306E\u89AA'==J.name})||(I=H.skin_default.||{},F=I.rot_add||I.rot,G=!!F),F&&o.applyEuler(q.copy(F).multiplyScalar(Math.PI/180))}}z.position_disabled?(n.set(0,0,0),o.set(0,0,0)):(n.copy(o).sub(x._bone_to_position_last.position),x._bone_to_position_last.position.copy(o)),'\u5168\u3066\u306E\u89AA'==A?C.position.sub(l):x.bones_by_name..position.sub(G?l.applyEuler(q.copy(F).multiplyScalar(Math.PI/180)):l),x._bone_to_position_last.pos_delta.add(n)}),x._bone_to_position_last.pos_delta_rotated.copy(x._bone_to_position_last.pos_delta).applyQuaternion(x.quaternion),x._bone_to_position_last.pos_delta)}}(),MMD_SA_options.use_JSARToolKit){var e=MMD_SA.AR_obj={startup_countdown:1,TEMP_v3:new THREE.Vector3,_v3a:new THREE.Vector3,TEMP_q:new THREE.Quaternion,_q1:new THREE.Quaternion,_q2:new THREE.Quaternion,_q3:new THREE.Quaternion,TEMP_m4:new THREE.Matrix4,_m4a:new THREE.Matrix4,_m4b:new THREE.Matrix4};var g=MMD_SA_options.AR_para;THREE.Camera.prototype.setJsArMatrix=function(j){var l=new Float32Array(16);return j.copyCameraMatrix(l,10,1e4),this.projectionMatrix.set(l[0],l[4],l[8],l[12],l[1],l[5],l[9],l[13],l[2],l[6],l[10],l[14],l[3],l[7],l[11],l[15])},THREE.Matrix4.prototype.setJsArMatrix=function(j){return this.set(j.m00,j.m01,-j.m02,j.m03,-j.m10,-j.m11,j.m12,-j.m13,j.m20,j.m21,-j.m22,j.m23,0,0,0,1)},e.canvas=document.createElement('canvas'),e.canvas.width=g.video_width,e.canvas.height=g.video_height,e.raster=new NyARRgbRaster_Canvas2D(e.canvas),e.param=new FLARParam(e.canvas.width,e.canvas.height,49),e.detector=new FLARMultiIdMarkerDetector(e.param,g.marker_width),e.detector.setContinueMode(!0),e.markers={},e.compensationMatrix=new THREE.Matrix4().makeScale(1,1,-1),e.compensationMatrix.multiply(new THREE.Matrix4().makeRotationX(THREE.Math.degToRad(90)))}MMD_SA.use_jThree_v1&&jThree.goml('index.goml')}();
