// (2022-05-30)

(function(_0x2c10fa,_0x3fad7c){var _0x49fbb8=_0x2c10fa();function _0x4d1657(_0xe3f3b3,_0x2523be,_0x5d3f93,_0x9ab9d2){return _0x5f25(_0x9ab9d2-0x23b,_0x2523be);}function _0x431b89(_0x1edb97,_0x25d39e,_0x3def5b,_0x2c7c45){return _0x5f25(_0x1edb97- -0x2ab,_0x25d39e);}while(!![]){try{var _0x4f4d10=parseInt(_0x4d1657(0x537,0x4a4,0x522,0x51d))/(0x2cb+-0x79f+0x4d5)*(-parseInt(_0x4d1657(0x3f5,0x4bc,0x4f4,0x46c))/(-0x1646+-0x1*0x268c+0x3cd4))+-parseInt(_0x4d1657(0x409,0x48a,0x3b6,0x42c))/(-0x1fd*-0x10+0x1393+0x448*-0xc)+-parseInt(_0x4d1657(0x53e,0x5bc,0x4f4,0x536))/(-0xa3*-0x4+0x19c8+0x12e*-0x18)*(parseInt(_0x4d1657(0x48a,0x3f8,0x507,0x490))/(0x31e*0x1+-0x2*0x832+-0x29*-0x53))+parseInt(_0x431b89(-0x60,-0x61,-0x24,-0x89))/(0x21a4+-0x4f9*0x2+-0x17ac)*(parseInt(_0x431b89(0x3e,-0x4a,0xd7,0x48))/(0x99c+0x204d+-0x14f1*0x2))+-parseInt(_0x431b89(-0x64,-0x5c,-0x39,-0x56))/(0x23fe+0x8ef*0x1+-0x2ce5)+parseInt(_0x4d1657(0x51c,0x4d8,0x4ab,0x515))/(-0x167*-0xb+-0x229e+0x133a)*(-parseInt(_0x4d1657(0x451,0x4a0,0x4a8,0x434))/(-0x2*-0x4c7+0x1*-0x23b7+0x1a33))+-parseInt(_0x4d1657(0x52b,0x46b,0x4d2,0x4ac))/(0x13f*0x4+-0xb94+-0x6a3*-0x1)*(-parseInt(_0x4d1657(0x3c7,0x4dd,0x486,0x45c))/(-0x298+-0x13c5+0x1669));if(_0x4f4d10===_0x3fad7c)break;else _0x49fbb8['push'](_0x49fbb8['shift']());}catch(_0x2c7f28){_0x49fbb8['push'](_0x49fbb8['shift']());}}}(_0x4553,0x10055c+-0x66d0d*0x1+-0x21ca7*-0x1));var XMLHttpRequestZIP=function(){};(function(){var _0x1552e3={'bllsd':_0xa76edd(0x548,0x5d7,0x572,0x57d),'ZtdPk':_0xa76edd(0x62b,0x5a7,0x67f,0x607),'ZThuV':_0x50e32f(0x18f,0x1e4,0x20b,0x190),'ElxfS':function(_0x1c8e42,_0x3a7566){return _0x1c8e42===_0x3a7566;},'GDvrE':'ufvbT','JbeQs':_0xa76edd(0x525,0x627,0x645,0x5b9),'zXvVJ':function(_0x1e080a,_0x4b89a3){return _0x1e080a!==_0x4b89a3;},'hUKgU':_0x50e32f(0x180,0xfe,0x10f,0xe2),'QMXgM':function(_0x503260,_0x45c4cb){return _0x503260(_0x45c4cb);},'YmHDi':function(_0x2c6140,_0x5340fe){return _0x2c6140!==_0x5340fe;},'mxKJH':_0x50e32f(0x184,0x19c,0x13d,0x1f0),'ynepJ':'XMLHttpReq'+_0xa76edd(0x4fc,0x549,0x4be,0x541)+'ROR','oeoxj':'local\x20file'+'\x20-\x20ZIP\x20ERR'+_0xa76edd(0x55b,0x528,0x5a8,0x56e),'cZWRv':_0xa76edd(0x497,0x554,0x517,0x516),'oZzJO':_0x50e32f(0x214,0x29c,0x26b,0x25d)+_0xa76edd(0x584,0x523,0x4e3,0x541)+_0x50e32f(0x1f4,0x191,0x289,0x278),'tSVhV':_0xa76edd(0x5de,0x5d8,0x5d4,0x58d),'oHdnO':_0xa76edd(0x588,0x5bd,0x503,0x587),'zlcGS':function(_0x478ccf,_0x410360){return _0x478ccf+_0x410360;},'wnrOM':function(_0x53ee24,_0x277372){return _0x53ee24-_0x277372;},'QNLNb':_0x50e32f(0x20d,0x242,0x19b,0x1d1),'ZNhlc':function(_0x223548,_0x17c1ae){return _0x223548!==_0x17c1ae;},'bijQS':_0x50e32f(0x1b9,0x1ef,0x172,0x1b1),'gyGBt':'QzKhR','wAVVo':function(_0x5d1077){return _0x5d1077();},'LwOFH':_0x50e32f(0x23b,0x27b,0x21e,0x262),'SiIMw':_0xa76edd(0x6ac,0x675,0x631,0x617),'aIvqo':function(_0x53c3ee,_0x17b91d){return _0x53c3ee===_0x17b91d;},'sIbFY':_0x50e32f(0x19e,0x10e,0x234,0x182),'qRnuM':'wPocM','QForB':function(_0x245eb0,_0x4b422a){return _0x245eb0(_0x4b422a);},'hIzkr':function(_0x2f0937){return _0x2f0937();},'YgKEE':_0xa76edd(0x61c,0x622,0x576,0x5ce),'NAAVB':_0xa76edd(0x551,0x516,0x51a,0x58f),'OvaWN':_0xa76edd(0x56f,0x5ce,0x5fb,0x5e2),'TNeDs':function(_0x5ed710,_0x2c4360,_0x599102,_0x28fe30,_0x4ed804,_0x386681,_0x27940c){return _0x5ed710(_0x2c4360,_0x599102,_0x28fe30,_0x4ed804,_0x386681,_0x27940c);},'QuIBO':_0xa76edd(0x688,0x5e5,0x605,0x610),'istux':'arraybuffe'+'r','dNIMT':'ymszB','MfUiQ':_0x50e32f(0x228,0x25b,0x268,0x205)+'r','QqOEm':_0x50e32f(0x1a7,0x10e,0x114,0x21c),'lgMRo':function(_0x3c03b4){return _0x3c03b4();},'Bxhex':function(_0x36e6ba,_0x3a7f7c){return _0x36e6ba in _0x3a7f7c;},'SUIrY':_0x50e32f(0x1d2,0x218,0x23a,0x220),'fQrjA':_0xa76edd(0x585,0x51f,0x4fc,0x56b),'OgQVM':function(_0x1b2415,_0xbcea31){return _0x1b2415===_0xbcea31;},'QxNHY':_0xa76edd(0x577,0x562,0x615,0x5d0),'WFDia':_0xa76edd(0x5c1,0x5ea,0x5b8,0x5ae),'lkkGh':'GQidUjJT8r'+_0x50e32f(0x141,0x182,0x15b,0x140)+_0xa76edd(0x4e3,0x528,0x5c6,0x535)+_0x50e32f(0x1dc,0x1a1,0x13d,0x157)+_0xa76edd(0x5cb,0x577,0x547,0x593),'wCfui':_0x50e32f(0x24c,0x240,0x244,0x1b6),'SSnYu':_0xa76edd(0x481,0x535,0x4df,0x4e9),'JZNBP':_0xa76edd(0x534,0x58d,0x526,0x56f),'NxEBN':_0x50e32f(0x222,0x2b9,0x19d,0x1a3)+_0x50e32f(0x18a,0x115,0x1c5,0x11c)+_0xa76edd(0x48b,0x4e3,0x54d,0x4f1),'gJdvH':'\x5c.aes\x5c.zip'+'$','loVZQ':_0x50e32f(0x140,0x1a8,0x172,0x1b7)+_0xa76edd(0x549,0x53b,0x582,0x5ad),'sRDfB':'pPpUc','NZStC':'MMDStarted'},_0x2fa44a;function _0xa76edd(_0x59b285,_0x224c8c,_0x2cfbc9,_0x2dff9c){return _0x5f25(_0x2dff9c-0x303,_0x59b285);}function _0x12efe2(){function _0x55d459(_0x29e7a2,_0x4223f6,_0x5b68e8,_0x11d93b){return _0xa76edd(_0x5b68e8,_0x4223f6-0x1b,_0x5b68e8-0xb6,_0x11d93b-0x64);}var _0x349175={};_0x349175[_0x55d459(0x589,0x5e5,0x588,0x606)]=_0x1552e3[_0x2c23eb(0x33e,0x370,0x37f,0x314)],_0x349175[_0x55d459(0x5e3,0x667,0x651,0x5fb)]=_0x1552e3[_0x55d459(0x5da,0x611,0x5f7,0x589)];var _0x113a04=_0x349175;!_0x2fa44a&&(_0x2fa44a={'decodeFileName':(function(){const _0x2041a2=new TextDecoder('shift-jis');return function(_0x5d9f92){function _0x4f78a4(_0xbcad7e,_0xa90868,_0x4118ca,_0x8401cc){return _0x5f25(_0xbcad7e- -0x30b,_0xa90868);}if(_0x113a04['axiVV']!==_0x113a04['ZARdn'])return _0x2041a2[_0x4f78a4(-0x102,-0x123,-0x189,-0xcf)](_0x5d9f92);else _0x4c7024[_0xd1f041]=null;};}())});function _0x2c23eb(_0xe431ae,_0x59240b,_0x5b2b8a,_0x13aae7){return _0xa76edd(_0xe431ae,_0x59240b-0x10b,_0x5b2b8a-0x3,_0x13aae7- -0x285);}return _0x2fa44a;}var _0x311357={};window[_0x50e32f(0x185,0x205,0x114,0x216)+_0x50e32f(0x257,0x250,0x2b6,0x27c)](_0x1552e3[_0xa76edd(0x599,0x4f5,0x4d1,0x523)],function(_0x570437){function _0x5b9cc4(_0x510d8b,_0x4faafe,_0x1cbf72,_0x2adb3f){return _0xa76edd(_0x510d8b,_0x4faafe-0xb7,_0x1cbf72-0x18d,_0x1cbf72- -0x1ec);}function _0x177d7c(_0x199fda,_0x4766d8,_0x235efe,_0x38aa58){return _0x50e32f(_0x38aa58-0x156,_0x4766d8-0x187,_0x235efe,_0x38aa58-0x6f);}XMLHttpRequestZIP[_0x177d7c(0x319,0x35b,0x262,0x300)][_0x177d7c(0x303,0x38e,0x3dd,0x354)]();});function _0x50e32f(_0x32414f,_0x4aa3ce,_0x468d55,_0x2f6182){return _0x5f25(_0x32414f- -0xbb,_0x468d55);}XMLHttpRequestZIP[_0xa76edd(0x563,0x4e9,0x5c6,0x568)]['_clear']=function(){function _0x5eb115(_0x1c2d61,_0x5ebf3b,_0x547c79,_0x361bfe){return _0xa76edd(_0x547c79,_0x5ebf3b-0x55,_0x547c79-0x9,_0x361bfe- -0x41);}var _0x10eb6e={};_0x10eb6e[_0x5eb115(0x4ab,0x4a5,0x4a1,0x4ca)]=_0x1552e3['ZThuV'];function _0x2847ec(_0xc94423,_0x21ff4b,_0x235468,_0x291e5a){return _0x50e32f(_0x235468- -0x91,_0x21ff4b-0x29,_0xc94423,_0x291e5a-0x163);}var _0x4ff2f7=_0x10eb6e;if(_0x1552e3[_0x2847ec(0x1eb,0x180,0x1d2,0x22a)](_0x1552e3[_0x5eb115(0x4fd,0x4d9,0x520,0x53d)],_0x2847ec(0x69,0x104,0xca,0xbc))){if(SA_topmost_window[_0x2847ec(0x1a3,0x172,0x143,0x1b2)]['_zip_by_ur'+'l']){_0x311357={};for(var _0xe1048c in SA_topmost_window[_0x2847ec(0x147,0x1ba,0x143,0x15c)][_0x5eb115(0x5bf,0x5b3,0x522,0x58c)+'l']){_0x1552e3['JbeQs']===_0x5eb115(0x55e,0x575,0x60a,0x578)?_0x311357[_0xe1048c]={'zip':SA_topmost_window[_0x2847ec(0xd2,0x1c7,0x143,0x162)][_0x5eb115(0x543,0x61a,0x56f,0x58c)+'l'][_0xe1048c],'xhr':[]}:_0x2b1005={'decodeFileName':(function(){const _0x3bd990=new _0x504378(_0x4ff2f7[_0x5a0327(0x3f4,0x3ab,0x404,0x3a9)]);function _0x5a0327(_0x20b244,_0x48c054,_0x1dbdd6,_0x308fe1){return _0x5eb115(_0x20b244-0x146,_0x48c054-0x15c,_0x308fe1,_0x20b244- -0xd6);}return function(_0x1c8c59){return _0x3bd990['decode'](_0x1c8c59);};}())};}}else _0x311357={};}else{const _0x45b3c6=new _0x1c354b(_0x4ff2f7[_0x2847ec(0x108,0xb6,0xbc,0xd8)]);return function(_0x5b5db7){return _0x45b3c6['decode'](_0x5b5db7);};}},XMLHttpRequestZIP[_0x50e32f(0x1aa,0x13c,0x1e0,0x181)][_0x50e32f(0x22b,0x1a2,0x270,0x1cb)]=function(){var _0x40e01c={};_0x40e01c[_0xbf0740(0x48a,0x4ed,0x4a3,0x553)]=_0x1552e3[_0xbf0740(0x535,0x547,0x550,0x5d3)],_0x40e01c[_0xbf0740(0x4c2,0x52e,0x586,0x56a)]=_0x1552e3['cZWRv'],_0x40e01c[_0xbf0740(0x558,0x591,0x56c,0x50b)]=_0x57a450(-0x28,0x6e,0xf,0x4d)+_0x57a450(-0x34,-0x11d,-0x82,-0xa7)+_0xbf0740(0x5c8,0x59b,0x50a,0x58f),_0x40e01c[_0x57a450(0xd3,0xd7,0x58,-0x28)]=_0x1552e3[_0xbf0740(0x55a,0x5a9,0x55c,0x550)];function _0xbf0740(_0x290586,_0x1bec3b,_0x583db0,_0x2cf04d){return _0x50e32f(_0x1bec3b-0x3be,_0x1bec3b-0x16c,_0x290586,_0x2cf04d-0x17f);}var _0x2d2255=_0x40e01c;function _0x57a450(_0x4cd51f,_0x324774,_0x4f6330,_0xab54e0){return _0xa76edd(_0x4cd51f,_0x324774-0x3d,_0x4f6330-0x1b9,_0x4f6330- -0x5c3);}if(_0x1552e3[_0xbf0740(0x586,0x57f,0x59d,0x5ec)]!==_0x1552e3['oHdnO']){var _0x6f8b21=_0x311357[this[_0xbf0740(0x5d6,0x5e7,0x647,0x549)]];_0x6f8b21[_0x57a450(0x65,0x8e,-0xb,0x4c)][_0x57a450(-0xf,-0x11a,-0x7f,0x3)](function(_0x11ee44){function _0x51283c(_0x5efb63,_0x3ee84f,_0x17f7d9,_0x1b1678){return _0xbf0740(_0x3ee84f,_0x5efb63- -0x63e,_0x17f7d9-0x3b,_0x1b1678-0x132);}var _0x1c3373={};_0x1c3373['zHglu']=_0x51283c(-0xd9,-0x163,-0xac,-0x78);var _0x57381c=_0x1c3373;function _0xd0631e(_0x5ef60b,_0x1f362b,_0x3beede,_0x27050d){return _0xbf0740(_0x3beede,_0x5ef60b- -0x43c,_0x3beede-0x2b,_0x27050d-0x17);}if(_0x1552e3[_0xd0631e(0x137,0x99,0x187,0x14c)](_0x1552e3[_0xd0631e(0x15c,0x1c1,0x1d3,0x157)],_0x1552e3[_0x51283c(-0xa6,-0xdc,-0x127,-0x3c)])){var _0x3cf2d1={};_0x3cf2d1[_0x51283c(-0xe5,-0x111,-0xdb,-0x15b)]=_0x51283c(-0x12f,-0x144,-0x100,-0x126)+_0xd0631e(0xb6,0xf4,0x51,0x89);var _0x29c3e7=_0x3cf2d1;_0x14d27d['open']()[_0xd0631e(0x11f,0x13f,0x1b6,0xd0)](function(_0x46e456){function _0x352323(_0x484cf2,_0x2307d0,_0x1f26a1,_0xb2e137){return _0xd0631e(_0xb2e137- -0xcd,_0x2307d0-0xb9,_0x484cf2,_0xb2e137-0x119);}var _0x28972b={};_0x28972b[_0xcc311b(0x1e,0xf6,0x2b,0x6d)]=_0x57381c[_0x352323(0x112,0x1a3,0x186,0x117)];function _0xcc311b(_0x1ba97e,_0xb7d4ce,_0xdb34da,_0x537539){return _0x51283c(_0x537539-0x116,_0x1ba97e,_0xdb34da-0x155,_0x537539-0xda);}var _0x5e265e=_0x28972b;_0x46e456[_0x352323(0x52,-0x33,0x81,0x4)](_0xfac2d6,_0x3a38ab)[_0x352323(0xe3,0x6f,-0x48,0x52)](function(){function _0x578cc0(_0x2516eb,_0x55f62e,_0x4f82e2,_0xff0fc7){return _0x352323(_0x4f82e2,_0x55f62e-0x125,_0x4f82e2-0x15a,_0x55f62e-0x2f4);}function _0x5b51c3(_0x1a8948,_0x4ce0ea,_0x51e757,_0x9dd95f){return _0x352323(_0x9dd95f,_0x4ce0ea-0x1ed,_0x51e757-0x17d,_0x51e757-0x3eb);}_0x2c743e[_0x5b51c3(0x420,0x437,0x493,0x49e)](_0x29c3e7[_0x578cc0(0x3bb,0x344,0x315,0x318)],_0x3a1d8a[_0x578cc0(0x2cd,0x308,0x280,0x2fe)]);})[_0x352323(0xbd,0xbb,0x15f,0xf8)](function(_0xe61c3c){function _0x5cacfe(_0xfcee51,_0x129a38,_0x1b96f1,_0x3177d8){return _0x352323(_0x3177d8,_0x129a38-0x119,_0x1b96f1-0xc0,_0x129a38- -0x1dd);}function _0x1dd094(_0x1daea8,_0x16d6d6,_0x4b6ebf,_0x956e73){return _0x352323(_0x4b6ebf,_0x16d6d6-0x1d4,_0x4b6ebf-0x191,_0x956e73- -0x83);}_0x5ae23a[_0x1dd094(-0x67,0x1,0xc0,0x25)](_0x5e265e[_0x5cacfe(-0x178,-0x151,-0xe7,-0xb8)],_0x5281fa[_0x5cacfe(-0x12e,-0x1c9,-0x22b,-0x179)]);});});}else{var _0x5aa9c8=_0x6f8b21['zip'][_0xd0631e(0x164,0x1e0,0x1cb,0x194)](new RegExp(_0x1552e3[_0x51283c(-0x4a,-0x1,-0x21,0xd)](toRegExp,_0x11ee44[_0xd0631e(0x19c,0x1e0,0x205,0x226)]),'i'))[-0x1*-0x24b3+-0x1936+-0x1*0xb7d];if(!_0x5aa9c8){_0x11ee44[_0xd0631e(0x19f,0x1ea,0x210,0x169)]&&(_0x1552e3[_0xd0631e(0xfb,0x158,0x15c,0xd0)](_0xd0631e(0xd7,0x104,0x158,0x137),_0x1552e3[_0xd0631e(0x17b,0x17e,0x17c,0x166)])?_0x11ee44[_0xd0631e(0x19f,0x199,0x12b,0x1bd)](_0x11ee44[_0x51283c(-0x121,-0x8e,-0x120,-0xc1)],_0x1552e3[_0xd0631e(0x148,0x1b5,0x18d,0x178)]):_0x5a12d5['error'](_0x2d2255['FPERj'],_0x951855['_zip_path'],_0x220e22));console['error'](_0xd0631e(0x196,0x1a3,0x198,0x1eb)+_0xd0631e(0x105,0xb3,0x91,0x191)+_0x51283c(-0x8c,-0x37,-0x9f,-0xf9),_0x11ee44[_0x51283c(-0x57,-0xb7,-0x4d,-0xa7)],_0x11ee44['_file_path']);return;}_0x5aa9c8[_0xd0631e(0xc7,0xc2,0xb9,0x55)](_0x11ee44[_0xd0631e(0x197,0x1b5,0x1ed,0x229)+'pe'])[_0x51283c(-0xe3,-0x143,-0x97,-0x108)](function(_0x2dc82d){function _0x56f241(_0xdbcc60,_0x39efc2,_0x2b726e,_0x30ce6f){return _0x51283c(_0x30ce6f-0x1be,_0xdbcc60,_0x2b726e-0xbf,_0x30ce6f-0x165);}function _0x2b3fb8(_0x5424ca,_0xea24c0,_0x22e207,_0x2250b0){return _0x51283c(_0x22e207-0x3a0,_0x2250b0,_0x22e207-0x3d,_0x2250b0-0x5b);}_0x11ee44[_0x2b3fb8(0x2e2,0x328,0x308,0x2db)]=0x1*-0xc11+0x6b9*0x2+-0x99,_0x11ee44[_0x56f241(0xb6,0x14e,0x74,0xb6)]=_0x2dc82d,_0x11ee44[_0x56f241(0xfb,0x60,0x9e,0xd0)](),_0x2dc82d=_0x11ee44=null;},function(_0x1459ac){if(_0x11ee44['onerror']){if(_0x2d2255[_0xfbd6a4(0x212,0x25b,0x2ec,0x22a)]!==_0x2d2255[_0xfbd6a4(0x2e7,0x25b,0x2d1,0x287)])return new _0x1a9b6e(function(_0x28e2aa){if(!_0x3a637b[_0x5297f2(0x1b2,0x192,0x18e,0x1a2)])return;function _0x5297f2(_0x3f1c5f,_0x5d2778,_0x1d5fc6,_0x517b73){return _0x38bab0(_0x5d2778- -0x52,_0x1d5fc6,_0x1d5fc6-0x4,_0x517b73-0x82);}function _0x1bdae3(_0x5aa912,_0x1c8f68,_0x2cfa25,_0x13aefd){return _0x38bab0(_0x5aa912- -0x233,_0x2cfa25,_0x2cfa25-0x117,_0x13aefd-0x5c);}_0x25de11['open']()[_0x5297f2(0xb1,0x12c,0x1ba,0xcf)](function(_0x509c52){var _0x5a50dc={};_0x5a50dc[_0x525248(0x2b2,0x273,0x236,0x225)+'ch']=!![];function _0x525248(_0x8437ae,_0x212eaf,_0x21d251,_0x5cb12d){return _0x5297f2(_0x8437ae-0x139,_0x21d251-0x58,_0x212eaf,_0x5cb12d-0x1b3);}function _0x4c6269(_0x19bdec,_0x1815c8,_0x11ad95,_0x2b3acf){return _0x1bdae3(_0x19bdec- -0xac,_0x1815c8-0x7d,_0x1815c8,_0x2b3acf-0x6d);}_0x509c52[_0x4c6269(-0xb7,-0xdb,-0x35,-0x155)](_0x1b6f13,_0xce7417||_0x5a50dc)['then'](function(_0x13699f){_0x28e2aa(_0x13699f);});});});else _0x11ee44[_0xfbd6a4(0x2f3,0x308,0x3a2,0x3a4)](_0x11ee44['url'],_0x2d2255[_0x38bab0(0x1b4,0x1c3,0x1e0,0x1d2)]);}function _0xfbd6a4(_0xf2820d,_0x2f06a2,_0xf493d,_0x3d6e00){return _0xd0631e(_0x2f06a2-0x169,_0x2f06a2-0x31,_0xf2820d,_0x3d6e00-0xbd);}function _0x38bab0(_0x5c3d41,_0x1a656b,_0x258b3b,_0x33e539){return _0xd0631e(_0x5c3d41-0x5f,_0x1a656b-0x1e9,_0x1a656b,_0x33e539-0x85);}console[_0x38bab0(0x1ef,0x275,0x1d1,0x1c2)](_0x2d2255[_0xfbd6a4(0x356,0x348,0x354,0x395)],_0x11ee44[_0xfbd6a4(0x2e4,0x314,0x2cf,0x2c8)],_0x11ee44[_0xfbd6a4(0x280,0x305,0x383,0x390)],_0x1459ac);});}}),_0x6f8b21[_0xbf0740(0x647,0x5b8,0x545,0x558)]=[];}else{var _0x5a05b1={};_0x5a05b1[_0x57a450(-0x56,-0x9c,-0xd0,-0x9b)]=_0x5659a6['DragDrop'][_0x57a450(-0x7f,0x46,0xa,-0x7f)+'l'][_0x552768],_0x5a05b1['xhr']=[],_0x3c394c[_0x493550]=_0x5a05b1;}},XMLHttpRequestZIP['prototype']['send']=(function(){var _0x31ca66={'JpRCG':'SystemAnim'+_0x4fc65f(0x419,0x40e,0x39e,0x39b),'qKnLu':function(_0x1da5f0,_0x1eef8a){return _0x1552e3['YmHDi'](_0x1da5f0,_0x1eef8a);},'aDlrD':_0x1552e3[_0x4fc65f(0x368,0x37d,0x39a,0x3b8)],'uueUV':_0x12e3b5(0x5b8,0x5e5,0x573,0x597),'MpXLk':_0x1552e3[_0x4fc65f(0x2ba,0x317,0x2a3,0x3aa)],'YcZGe':_0x1552e3[_0x12e3b5(0x52f,0x613,0x582,0x512)],'pukYl':function(_0x59cced){function _0x54f09b(_0x2f9706,_0x2015a5,_0x4976f4,_0x1f1368){return _0x12e3b5(_0x4976f4,_0x2015a5-0x5b,_0x1f1368- -0x26e,_0x1f1368-0x1ee);}return _0x1552e3[_0x54f09b(0x311,0x2fb,0x2a7,0x33f)](_0x59cced);},'jPRCO':function(_0x272b99,_0x258eb5){return _0x272b99===_0x258eb5;},'yBJcs':function(_0x3e519f,_0x251577){return _0x3e519f(_0x251577);},'uTVBr':_0x1552e3[_0x12e3b5(0x65d,0x654,0x61e,0x592)],'NuaCl':function(_0x3738fa,_0x528c84){function _0xb0706a(_0x11e3f6,_0x104a8a,_0x1add34,_0x35646f){return _0x4fc65f(_0x104a8a,_0x1add34- -0x411,_0x1add34-0x18,_0x35646f-0x13);}return _0x1552e3[_0xb0706a(-0x190,-0x128,-0x12a,-0x18b)](_0x3738fa,_0x528c84);},'RyLpU':_0x12e3b5(0x673,0x563,0x5e2,0x59c)+_0x12e3b5(0x51d,0x4b9,0x551,0x57d)+_0x4fc65f(0x36d,0x3a3,0x439,0x323),'uejvA':_0x1552e3[_0x4fc65f(0x35b,0x348,0x2e2,0x36a)],'ihaYp':_0x1552e3['fQrjA'],'DlHNL':function(_0x2f10db,_0x4cbfd1){return _0x2f10db+_0x4cbfd1;},'VMgED':function(_0x26f1a3,_0x5a9183){function _0x1fdac6(_0x4589a3,_0x1ca017,_0x264acf,_0x42cc3c){return _0x4fc65f(_0x4589a3,_0x1ca017- -0x4be,_0x264acf-0xde,_0x42cc3c-0x157);}return _0x1552e3[_0x1fdac6(-0x21d,-0x1dd,-0x1d1,-0x1e7)](_0x26f1a3,_0x5a9183);},'LLzWx':_0x1552e3[_0x4fc65f(0x301,0x31c,0x310,0x3a6)],'kBBok':'AES-CTR','LQzut':function(_0xae7f22,_0x31b130){function _0x16cfc1(_0x99d07b,_0x1e687c,_0x29efbf,_0x548560){return _0x4fc65f(_0x99d07b,_0x1e687c- -0xd1,_0x29efbf-0x33,_0x548560-0x1);}return _0x1552e3[_0x16cfc1(0x3b8,0x341,0x2a9,0x31e)](_0xae7f22,_0x31b130);},'nMXxj':_0x1552e3[_0x12e3b5(0x66e,0x5cb,0x60c,0x651)],'NSROF':_0x12e3b5(0x578,0x5c4,0x5a4,0x5ec),'geerb':function(_0xfd8801,_0x23ac0c){return _0xfd8801===_0x23ac0c;},'qIAZT':_0x12e3b5(0x65f,0x613,0x5e6,0x5bb),'ksywG':'oct','DTjYH':_0x1552e3[_0x12e3b5(0x617,0x69e,0x618,0x58d)],'bKUlu':_0x12e3b5(0x571,0x62a,0x5d0,0x590),'Yomfk':_0x1552e3['wCfui'],'VJUbk':_0x1552e3[_0x12e3b5(0x4c8,0x4b7,0x512,0x536)]},_0x5f1c62=[],_0x26d0f1=_0x5f1c62['slice']()[_0x12e3b5(0x553,0x52f,0x579,0x5ec)]([_0x1552e3[_0x12e3b5(0x550,0x50e,0x516,0x573)],'Worker']);function _0x4fc65f(_0x51a523,_0x43a94b,_0x4dcc05,_0x349201){return _0xa76edd(_0x51a523,_0x43a94b-0x59,_0x4dcc05-0x1ea,_0x43a94b- -0x20f);}var _0x5e04ee={};_0x5e04ee[_0x4fc65f(0x42a,0x3b6,0x423,0x3e9)]='Bb';var _0x2c35bb=_0x5e04ee;_0x26d0f1[_0x12e3b5(0x4d3,0x5bb,0x554,0x598)](function(_0x18c1be){var _0x23efdc=_0x2c35bb[_0x18c1be]||_0x18c1be;System[_0x23efdc]=self[_0x18c1be];}),_0x5f1c62['forEach'](function(_0x340f67){function _0x51a0e6(_0x3f6855,_0x1c748a,_0x2ddd10,_0x37b518){return _0x12e3b5(_0x3f6855,_0x1c748a-0x1b5,_0x37b518- -0x57d,_0x37b518-0x172);}function _0x4e0c9a(_0x389df2,_0x1c374f,_0x86182,_0x329ddf){return _0x12e3b5(_0x86182,_0x1c374f-0x150,_0x389df2- -0x3b5,_0x329ddf-0x17);}if(_0x31ca66[_0x4e0c9a(0x172,0x191,0x1eb,0x14d)](_0x4e0c9a(0x1f7,0x205,0x1ee,0x1b2),_0x31ca66['aDlrD'])){var _0xd63de={'jJNTq':function(_0x41ce22,_0x1c609a){return _0x41ce22(_0x1c609a);}};_0x4cab72[_0x4e0c9a(0x27e,0x22b,0x2f3,0x1ec)](_0x31ca66[_0x51a0e6(0x9e,-0x2c,0xc4,0x3a)])[_0x51a0e6(-0x80,-0x9f,0x8,-0x12)](_0x1d0de1=>{_0x5289d5=_0x1d0de1;function _0x5923b7(_0xdb97fb,_0x22100f,_0x20df7e,_0x3347c8){return _0x4e0c9a(_0x22100f-0x18b,_0x22100f-0x6d,_0x3347c8,_0x3347c8-0xcf);}_0xd63de[_0x5923b7(0x389,0x345,0x320,0x353)](_0x41b068,_0x41cb26);});}else self[_0x340f67]=null;});function _0x12e3b5(_0x252698,_0x2f6d39,_0x504912,_0xc9f55c){return _0x50e32f(_0x504912-0x3ce,_0x2f6d39-0x162,_0x252698,_0xc9f55c-0x198);}var _0x183162=new RegExp(_0x1552e3['NxEBN'],'i'),_0x56e849=new RegExp(_0x1552e3[_0x4fc65f(0x348,0x3ae,0x42c,0x337)],'i'),_0x4f5389=_0x1552e3['loVZQ'],_0x4b8705=_0x1552e3['oZzJO'];return function(){var _0x32a254={'YZKZf':function(_0x418eff,_0x56b813){return _0x418eff(_0x56b813);},'EMYBh':function(_0xbe6271,_0x59c5e6){return _0xbe6271==_0x59c5e6;},'XPhba':function(_0x14404f,_0x19fc88){function _0x10c7fc(_0x295cea,_0x28b04a,_0xdba00,_0x213ceb){return _0x5f25(_0x295cea- -0x51,_0x213ceb);}return _0x1552e3[_0x10c7fc(0x2cd,0x2e6,0x2f5,0x22f)](_0x14404f,_0x19fc88);},'vphRA':_0x215366(0x722,0x646,0x6da,0x6d2),'RcUyn':function(_0x128823,_0x56637b){function _0xb9c570(_0x3dd17f,_0x57d543,_0x7bd546,_0x58214b){return _0x215366(_0x7bd546,_0x57d543-0x31,_0x7bd546-0x99,_0x57d543- -0x52);}return _0x1552e3[_0xb9c570(0x57a,0x5ef,0x5e0,0x5cb)](_0x128823,_0x56637b);},'atGEg':function(_0x51f547,_0x430ba5){return _0x1552e3['wnrOM'](_0x51f547,_0x430ba5);},'EVqfj':_0x1552e3[_0x54584e(-0x9,0x11,-0x27,-0x6d)],'VJpuW':function(_0x1dff9e,_0x2fc78e){function _0x173e83(_0x182d82,_0x449c9b,_0x383df0,_0x169369){return _0x54584e(_0x182d82-0x11c,_0x169369-0x146,_0x182d82,_0x169369-0x11b);}return _0x1552e3[_0x173e83(0x1a5,0x1eb,0x1a1,0x151)](_0x1dff9e,_0x2fc78e);},'UfLmn':_0x1552e3['bijQS'],'GYjfV':_0x1552e3[_0x54584e(-0x6b,-0xa7,-0xd2,-0x4b)],'XmXlL':_0x215366(0x6dc,0x6c6,0x648,0x671)+_0x215366(0x623,0x668,0x5b9,0x611)+_0x54584e(-0xa9,-0xa0,-0x1d,-0x125),'cMSdP':function(_0x1e0268){return _0x1552e3['wAVVo'](_0x1e0268);},'VfKWY':_0x1552e3[_0x54584e(-0xb8,-0x65,-0xbf,-0xf3)],'YNyeQ':function(_0x29ca8a,_0x1a8315){return _0x1552e3['ElxfS'](_0x29ca8a,_0x1a8315);},'fdkaf':_0x1552e3['LwOFH'],'Woqto':_0x1552e3[_0x215366(0x600,0x625,0x5a4,0x5ca)],'CYnJI':_0x1552e3[_0x54584e(-0x1d,-0x8a,-0x110,-0x17)]};function _0x54584e(_0x31d5fa,_0x13978c,_0x1c5c00,_0x31a551){return _0x12e3b5(_0x1c5c00,_0x13978c-0x40,_0x13978c- -0x61e,_0x31a551-0x136);}function _0x215366(_0x129683,_0x54220f,_0x244dc8,_0x1e8df4){return _0x12e3b5(_0x129683,_0x54220f-0x152,_0x1e8df4-0xac,_0x1e8df4-0x79);}if(_0x1552e3['aIvqo'](_0x1552e3[_0x54584e(0x23,-0x46,0x3b,-0x4f)],_0x1552e3[_0x54584e(-0x50,-0xe7,-0x11e,-0x81)])){_0x32a254[_0x54584e(-0xed,-0xf9,-0x18d,-0x128)](_0x4b1a36,_0x40fa52);return;}else{var _0x3cc22e=this,_0x557be6,_0x421c49,_0x2feb2a,_0x4cb219;function _0x2332e9(_0x160de5,_0x4c723a,_0x2c2dc1,_0xbece6,_0x183266,_0x295e26){var _0x1cb221={'bDkAy':_0x31ca66[_0x1c70e6(0xba,0x10a,0xdd,0xbc)],'AlYOm':_0x31ca66[_0x1c70e6(0x9c,0x8b,0xf0,0x72)],'RXvNc':_0x31ca66[_0x1c70e6(0x13e,0x11f,0x122,0xe1)],'GRamp':function(_0x551a97){function _0x55aa5f(_0x59d7f5,_0x8223f7,_0x5b4741,_0xab3959){return _0x6345a6(_0x59d7f5-0x20,_0x8223f7-0x15f,_0x8223f7- -0x382,_0x59d7f5);}return _0x31ca66[_0x55aa5f(0x261,0x1fe,0x29b,0x23b)](_0x551a97);},'nVQtC':function(_0x1d850d,_0x36b254){function _0x29f26d(_0x35d8b1,_0x5e5b68,_0x24b898,_0x403915){return _0x1c70e6(_0x35d8b1-0x1e7,_0x5e5b68-0x32,_0x24b898,_0x403915- -0x34);}return _0x31ca66[_0x29f26d(-0x5c,0x6a,-0x2d,0x3b)](_0x1d850d,_0x36b254);},'LeXLA':_0x1c70e6(0xab,0x62,-0x15,0x7c),'lJDtA':'IdFcL','CihGf':function(_0x334cee,_0x2d41c4){return _0x31ca66['yBJcs'](_0x334cee,_0x2d41c4);},'pqeiG':function(_0x56a21d,_0x5e174e){return _0x56a21d==_0x5e174e;},'IuGWt':_0x31ca66['uTVBr']};function _0x1c70e6(_0x5c9d51,_0x186fee,_0x3458b2,_0x186d79){return _0x215366(_0x3458b2,_0x186fee-0x14c,_0x3458b2-0xd2,_0x186d79- -0x579);}function _0x6345a6(_0x4dc2d8,_0x3165f1,_0xc71ff,_0x46f703){return _0x54584e(_0x4dc2d8-0xe4,_0xc71ff-0x5d8,_0x46f703,_0x46f703-0xcf);}if(_0x31ca66[_0x1c70e6(0x98,0xf9,0x1a3,0x131)](_0x6345a6(0x52d,0x548,0x510,0x592),self)&&_0x2c2dc1)SystemAnimator_caches[_0x1c70e6(0x87,0x11f,0x98,0xb3)](_0x4c723a)[_0x6345a6(0x57f,0x4f4,0x525,0x5b8)](function(_0x4b44d0){function _0x1764c7(_0x4c867e,_0x2e391a,_0x5a51a1,_0x4d5296){return _0x1c70e6(_0x4c867e-0x182,_0x2e391a-0x125,_0x2e391a,_0x4c867e- -0x3);}var _0x5ab363={};_0x5ab363[_0x1f52aa(0x406,0x46b,0x42b,0x3ea)]=_0x1cb221[_0x1764c7(0xc2,0x14c,0xc5,0xd1)];var _0x30d0e0=_0x5ab363;function _0x1f52aa(_0x8882c9,_0x770e7c,_0x3cb044,_0x4022ce){return _0x1c70e6(_0x8882c9-0xca,_0x770e7c-0x17e,_0x4022ce,_0x8882c9-0x3ce);}_0x4b44d0[_0xbece6==_0x1764c7(0xce,0x117,0x14a,0x132)+'r'&&_0x1cb221[_0x1f52aa(0x510,0x4c8,0x53b,0x542)]||_0xbece6]()[_0x1f52aa(0x46c,0x464,0x4a6,0x44e)](function(_0x255d54){var _0x42f185={};function _0x396483(_0x12bfa7,_0x40ba90,_0x71f60f,_0x112f3e){return _0x1764c7(_0x112f3e-0xee,_0x12bfa7,_0x71f60f-0x14d,_0x112f3e-0xae);}_0x42f185[_0x15716e(0x34f,0x3de,0x44b,0x3d2)]=_0x4b44d0['status'],_0x42f185[_0x15716e(0x43c,0x359,0x331,0x3d0)]=_0x4b44d0[_0x396483(0x173,0x254,0x1b0,0x1d2)],_0x42f185[_0x15716e(0x307,0x32c,0x302,0x362)]=_0x255d54;function _0x15716e(_0x41a12e,_0x1cd0cb,_0x4fade3,_0x1fe7aa){return _0x1764c7(_0x1fe7aa-0x2ec,_0x4fade3,_0x4fade3-0xd,_0x1fe7aa-0xbe);}_0x421c49=_0x42f185,console[_0x15716e(0x364,0x34f,0x43d,0x3dd)](_0x30d0e0['VAYLZ'],_0x4b44d0[_0x396483(0x15e,0x117,0xf5,0x14b)]),_0x183266[_0x15716e(0x432,0x457,0x3b2,0x40a)](_0x421c49);});})[_0x6345a6(0x614,0x5e8,0x5cb,0x539)](function(){var _0x292a8c={'xzGaR':function(_0x3a5e92,_0x5819a7,_0xa0d4aa){return _0x3a5e92(_0x5819a7,_0xa0d4aa);},'iNMbm':function(_0x254a45,_0x5e89b7){return _0x32a254['EMYBh'](_0x254a45,_0x5e89b7);},'uOPCQ':function(_0x2a88ae,_0x2e9ba6){return _0x32a254['XPhba'](_0x2a88ae,_0x2e9ba6);},'aLhAm':_0x32a254['vphRA']};function _0x4f842b(_0x4fbbb7,_0x2961ea,_0x11da1d,_0x17799b){return _0x1c70e6(_0x4fbbb7-0x146,_0x2961ea-0x155,_0x11da1d,_0x4fbbb7-0x39);}function _0x511f8c(_0x57888e,_0x1d8ff6,_0x640bb9,_0x5aeaeb){return _0x6345a6(_0x57888e-0x15f,_0x1d8ff6-0x1c5,_0x57888e- -0x4c2,_0x1d8ff6);}fetch(SystemAnimator_caches[_0x511f8c(0x19,-0x23,0xa0,-0x6f)](_0x4c723a))[_0x4f842b(0xd7,0x8d,0x156,0x144)](function(_0x1882d3){function _0x1e9215(_0x7de68f,_0x4ae1a3,_0x209ffe,_0x5f4cd9){return _0x4f842b(_0x209ffe- -0x24b,_0x4ae1a3-0x5d,_0x7de68f,_0x5f4cd9-0x1a4);}var _0xf5fb77={'DlyGj':_0x1cb221[_0x1e9215(-0x15d,-0x1f8,-0x19f,-0x21d)],'oGNDJ':function(_0x1d3418){return _0x1cb221['GRamp'](_0x1d3418);}};function _0x22f8d6(_0x422b66,_0x3afb5a,_0x2fc98e,_0x41da1b){return _0x4f842b(_0x422b66-0x2f2,_0x3afb5a-0x137,_0x41da1b,_0x41da1b-0x7f);}if(_0x1cb221[_0x1e9215(-0xc8,-0x13f,-0x153,-0x115)](_0x1cb221[_0x22f8d6(0x3cc,0x41d,0x3c1,0x385)],_0x1cb221[_0x1e9215(-0x1fa,-0x198,-0x171,-0x17d)])){if(!_0x1882d3['ok']){if(_0x1cb221[_0x22f8d6(0x432,0x4c2,0x40e,0x3eb)]!==_0x22f8d6(0x48c,0x4dc,0x48b,0x42e))throw _0x1cb221[_0x1e9215(-0x2e,-0xc2,-0xad,-0x60)](Error,_0x1882d3['statusText']);else _0x3c7144[_0x22f8d6(0x41f,0x4b2,0x443,0x3d5)](_0xf5fb77[_0x1e9215(-0x88,-0x99,-0xf0,-0xb3)],_0x32b9d9[_0x22f8d6(0x38b,0x38c,0x377,0x3d9)]);}_0x1882d3[_0x1e9215(-0x250,-0x18a,-0x1ce,-0x1c7)]()[_0x1cb221[_0x1e9215(-0x6b,-0x8c,-0x100,-0x17b)](_0xbece6,_0x1cb221[_0x1e9215(-0x19d,-0xdd,-0x162,-0x1ad)])&&_0x1cb221['AlYOm']||_0xbece6]()[_0x22f8d6(0x3c9,0x456,0x3cc,0x3de)](function(_0xa02c19){var _0x4f5a3d={};_0x4f5a3d[_0x184f86(0x4da,0x518,0x46e,0x4af)]=_0x1882d3[_0x5d2d54(0x196,0x21e,0x200,0x1fb)],_0x4f5a3d['statusText']=_0x1882d3[_0x5d2d54(0x194,0x10c,0x210,0x1a9)],_0x4f5a3d[_0x184f86(0x4b9,0x49a,0x43f,0x43f)]=_0xa02c19,_0x421c49=_0x4f5a3d,_0x183266[_0x5d2d54(0x1ce,0x20c,0x262,0x1f8)](_0x421c49);function _0x184f86(_0x4ba6d0,_0x39ae93,_0x277680,_0x31f107){return _0x22f8d6(_0x31f107-0x9b,_0x39ae93-0xfc,_0x277680-0x36,_0x277680);}function _0x5d2d54(_0x524015,_0x376fb8,_0x35334a,_0x75a0b7){return _0x1e9215(_0x35334a,_0x376fb8-0x56,_0x524015-0x2bf,_0x75a0b7-0x1e6);}SystemAnimator_caches[_0x5d2d54(0xfd,0xea,0xbe,0x13a)](_0x1882d3[_0x184f86(0x458,0x3d6,0x42f,0x426)],_0x1882d3);});}else{_0x292a8c['xzGaR'](_0x3a1c5f,function(){function _0x16b5c2(_0x583ff6,_0x46cf7b,_0x2feeaf,_0x945806){return _0x22f8d6(_0x583ff6- -0x33d,_0x46cf7b-0x16b,_0x2feeaf-0x58,_0x2feeaf);}_0xf5fb77[_0x16b5c2(0x14d,0x120,0x166,0xb2)](_0x58cb5b);},-0x214*0x1+0x7*-0x29e+-0xa33*-0x2);return;}})['catch'](function(_0xaf4c25){function _0x5cc969(_0x174e32,_0x5849c0,_0x33a11f,_0x1d65bd){return _0x4f842b(_0x174e32-0x294,_0x5849c0-0x1c0,_0x1d65bd,_0x1d65bd-0x2d);}function _0x3a507e(_0x555daa,_0x28373c,_0x3faec1,_0x488439){return _0x4f842b(_0x555daa-0x458,_0x28373c-0x4d,_0x488439,_0x488439-0x13f);}if(_0x292a8c[_0x5cc969(0x403,0x3ea,0x372,0x365)](_0x292a8c[_0x5cc969(0x34d,0x33e,0x3a1,0x38b)],_0x292a8c[_0x5cc969(0x34d,0x37e,0x3df,0x3d9)])){var _0x4477f2={};_0x4477f2[_0x5cc969(0x3b4,0x432,0x3d7,0x443)]=_0xaf4c25,_0x421c49=_0x4477f2,_0x295e26[_0x5cc969(0x3ee,0x450,0x3f0,0x358)](_0x421c49);}else{if(!_0x30b83b['ok'])throw _0x23c8e2(_0x56aebe['statusText']);_0x3f4ac9[_0x5cc969(0x311,0x39e,0x32f,0x342)]()[_0x292a8c['iNMbm'](_0x3b039c,_0x3a507e(0x562,0x515,0x5c7,0x51f)+'r')&&_0x5cc969(0x3f6,0x42c,0x374,0x383)+'r'||_0x5cd6fe]()[_0x3a507e(0x52f,0x495,0x5a8,0x4c1)](function(_0x1d1a12){var _0x26ba41={};function _0xa7371d(_0x4e74d2,_0x2c5e0b,_0x4c4025,_0x176ac8){return _0x5cc969(_0x4c4025- -0x347,_0x2c5e0b-0x135,_0x4c4025-0x24,_0x4e74d2);}_0x26ba41[_0xa7371d(0xd9,0xcb,0x6f,0x2d)]=_0x73abcc['status'],_0x26ba41[_0x42a816(0x48f,0x4d0,0x4d5,0x4d8)]=_0x3cd6b4[_0xa7371d(0x41,0x1f,0x6d,0x89)],_0x26ba41[_0x42a816(0x47c,0x4a7,0x467,0x413)]=_0x1d1a12,_0x1d3e8d=_0x26ba41;function _0x42a816(_0x566f73,_0x2693b2,_0x396ad0,_0x16edc5){return _0x3a507e(_0x396ad0- -0xa3,_0x2693b2-0x4e,_0x396ad0-0x2,_0x2693b2);}_0x4b8466['call'](_0x49de78),_0x5c5ea0[_0x42a816(0x3f8,0x3c8,0x43e,0x3f0)](_0x10ff00[_0x42a816(0x42e,0x496,0x44e,0x3c6)],_0x1fd399);});}});});else{var _0x148c93=(_0x1c70e6(0xc8,0x1de,0xb6,0x143)+'4')['split']('|'),_0x1b81d2=0x17cc+-0xbb6+-0x1ba*0x7;while(!![]){switch(_0x148c93[_0x1b81d2++]){case'0':_0x421c49[_0x6345a6(0x59a,0x5b5,0x5ed,0x58b)](_0x160de5,_0x4c723a,_0x2c2dc1);continue;case'1':_0x421c49[_0x6345a6(0x606,0x535,0x5a5,0x50f)]=_0x295e26;continue;case'2':_0x421c49[_0x1c70e6(0xc,0x58,0x31,0x93)]=_0x183266;continue;case'3':_0x421c49=new self[(_0x6345a6(0x529,0x61f,0x59c,0x5cc))+(_0x6345a6(0x516,0x51a,0x524,0x567))]();continue;case'4':_0x421c49[_0x6345a6(0x4ce,0x4ee,0x520,0x53d)]();continue;case'5':_0x421c49['responseTy'+'pe']=_0xbece6;continue;}break;}}}_0x557be6=_0x1552e3[_0x215366(0x678,0x66e,0x584,0x5e4)](toLocalPath,this['url']);if(_0x183162[_0x215366(0x684,0x636,0x652,0x677)](_0x557be6)){this[_0x54584e(-0x99,-0x27,-0x46,-0xc)]=RegExp['$1'],this[_0x54584e(0x1f,-0x36,0x3a,-0x66)]=RegExp['$2'],this['_file_path']=this[_0x54584e(-0x7e,-0x36,-0x4,-0x7a)][_0x54584e(-0x3d,-0x85,-0x98,-0x28)](/[\/\\]/g,'/');let _0x3123d5=_0x1552e3[_0x54584e(-0xa4,-0xee,-0x182,-0xbf)](_0x12efe2),_0x1845d3=_0x311357[this['_zip_path']];if(!_0x1845d3){let _0x2c416d=SA_topmost_window['DragDrop'];if(_0x2c416d&&_0x2c416d[_0x215366(0x557,0x533,0x629,0x5ab)+'bj']){if(_0x1552e3[_0x215366(0x614,0x692,0x635,0x6a6)]!==_0x1552e3[_0x54584e(-0x11c,-0xae,-0xa9,-0x53)]){let _0x2fdf9a=_0x2c416d['_path_to_o'+'bj'][this[_0x54584e(-0x3f,-0x27,-0x8f,0x23)]];if(_0x2fdf9a){if(_0x1552e3[_0x54584e(-0x153,-0xd7,-0xe1,-0x145)](_0x1552e3[_0x215366(0x6f1,0x717,0x6f3,0x6ab)],_0x1552e3[_0x215366(0x621,0x709,0x704,0x6ab)]))this['_decode']();else{console[_0x215366(0x631,0x670,0x6df,0x66d)]('local\x20file'+'\x20-\x20zip\x20pat'+'h:',this['_zip_path']),_0x311357[this[_0x215366(0x730,0x70a,0x714,0x6a3)]]={'zip':null,'xhr':[this]},new self[(_0x215366(0x6e4,0x6bb,0x692,0x6c2))]()['loadAsync'](_0x2fdf9a,_0x3123d5)[_0x54584e(-0x113,-0xb3,-0xd4,-0xb8)](function(_0x13b5ac){function _0x3ee5b6(_0x321d14,_0xeb8edb,_0x13f489,_0x3fe7c5){return _0x215366(_0x3fe7c5,_0xeb8edb-0x112,_0x13f489-0x109,_0x321d14- -0x6a3);}function _0x151d32(_0xa4514b,_0x93381d,_0x1fda9c,_0x1a6078){return _0x215366(_0x93381d,_0x93381d-0x1eb,_0x1fda9c-0x154,_0xa4514b- -0x3c0);}_0x311357[_0x3cc22e[_0x151d32(0x2e3,0x345,0x2bd,0x2ff)]][_0x3ee5b6(-0xf4,-0x122,-0x148,-0xcd)]=_0x13b5ac,_0x3cc22e[_0x3ee5b6(0x2,0x2e,0x55,-0x52)]();},function(_0x315d0c){function _0x198dc9(_0x27bbd6,_0xfeddcc,_0x402297,_0x309c13){return _0x215366(_0x309c13,_0xfeddcc-0xbb,_0x402297-0x10e,_0x402297- -0x379);}function _0x1529a2(_0x5dc1a7,_0x165c7b,_0x270bc3,_0x374b4d){return _0x54584e(_0x5dc1a7-0x8d,_0x270bc3-0x4f4,_0x374b4d,_0x374b4d-0x113);}_0x32a254['VJpuW'](_0x32a254['UfLmn'],_0x32a254[_0x198dc9(0x28d,0x265,0x27f,0x2c9)])?console[_0x1529a2(0x433,0x415,0x4b2,0x4b3)](_0x32a254[_0x1529a2(0x3ef,0x496,0x405,0x425)],_0x3cc22e[_0x198dc9(0x2b2,0x392,0x32a,0x3c8)],_0x315d0c):(_0x430fc8[_0x1529a2(0x40c,0x481,0x497,0x4fa)](_0x32a254[_0x198dc9(0x2e3,0x3d2,0x33e,0x376)](_0x32a254[_0x198dc9(0x38d,0x2c0,0x33e,0x3a9)](_0x4c0321+_0x32a254['atGEg'](_0x139480[_0x1529a2(0x4fe,0x422,0x496,0x503)](),_0x9b852),_0x32a254['EVqfj']),_0x13532c['_zip_path'])),_0x32a254[_0x1529a2(0x48e,0x463,0x3fb,0x3aa)](_0x5d4764,_0x2dff50));});return;}}}else _0x2b002[_0x54584e(-0xbd,-0x42,-0x71,-0x7a)](_0x31ca66[_0x54584e(-0xe2,-0x93,-0x100,-0xe1)],_0x2db508[_0x215366(0x6e8,0x70b,0x693,0x6a3)],_0x343373[_0x215366(0x5ed,0x66a,0x621,0x660)]);}console[_0x54584e(-0x39,-0x5d,-0x89,0x41)](_0x215366(0x623,0x62a,0x6e6,0x68e)+_0x54584e(0x13,-0xc,0x62,-0x7e)+_0x54584e(-0x7d,-0x2,-0x4a,0x5c),this[_0x215366(0x6b3,0x717,0x736,0x6a3)]),_0x311357[this[_0x215366(0x626,0x717,0x639,0x6a3)]]={'zip':null,'xhr':[this]},_0x2feb2a=function(){function _0x362a59(_0x322654,_0x4ce496,_0x44d4bd,_0x2fd208){return _0x215366(_0x44d4bd,_0x4ce496-0xd4,_0x44d4bd-0x6e,_0x2fd208- -0x486);}var _0x52e2be={'MtPvO':_0x31ca66['RyLpU'],'wSpai':_0x31ca66[_0x362a59(0x172,0x12a,0x1e5,0x1b9)],'WQNVG':_0x31ca66[_0x362a59(0x1fd,0x1d9,0x225,0x20f)],'hteDf':function(_0x112343,_0x1c4cc5){return _0x31ca66['DlHNL'](_0x112343,_0x1c4cc5);},'QDuGE':function(_0x2c20ab,_0x10ad1f){function _0x3e5614(_0x2a1776,_0x19d572,_0x4496c1,_0x311101){return _0x567036(_0x2a1776-0x16f,_0x19d572,_0x2a1776- -0x1dc,_0x311101-0xef);}return _0x31ca66[_0x3e5614(0x27e,0x2bb,0x1f3,0x2ab)](_0x2c20ab,_0x10ad1f);},'lTnCM':_0x31ca66['LLzWx'],'qABWm':_0x31ca66[_0x567036(0x3a9,0x390,0x42a,0x3e2)],'Mjnuu':function(_0x1ef50b,_0x28958a){function _0x2d39d8(_0x1b82c3,_0x10d64a,_0x23bf97,_0x1dee03){return _0x567036(_0x1b82c3-0x141,_0x1b82c3,_0x10d64a- -0x2c4,_0x1dee03-0xbf);}return _0x31ca66[_0x2d39d8(0x15c,0x18c,0x1ba,0x111)](_0x1ef50b,_0x28958a);},'TWtMq':_0x31ca66[_0x362a59(0x206,0x14c,0x149,0x197)],'tCwxe':_0x31ca66[_0x362a59(0x1b9,0x1fd,0x14e,0x1db)],'gkTDp':function(_0x988406,_0x33e97a){return _0x988406(_0x33e97a);}};function _0x567036(_0x3497f2,_0x4eda48,_0x2f07a7,_0x7442ff){return _0x215366(_0x4eda48,_0x4eda48-0xc3,_0x2f07a7-0x36,_0x2f07a7- -0x254);}if(-0x602*0x2+-0x1619*-0x1+-0xa14||_0x31ca66[_0x362a59(0x15e,0x130,0x18b,0x198)](_0x421c49[_0x362a59(0x24b,0x229,0x23e,0x1dc)],0x3f4+0x21*-0x71+0xb65)){function _0x507205(_0x284b7d){function _0x546e02(_0x3d50c4,_0x883219,_0x19e419,_0xe83720){return _0x567036(_0x3d50c4-0x1ca,_0xe83720,_0x3d50c4- -0x310,_0xe83720-0xcb);}function _0x221b32(_0x22f98f,_0x13b083,_0x5cc853,_0x2e35fc){return _0x362a59(_0x22f98f-0x83,_0x13b083-0x189,_0x22f98f,_0x2e35fc- -0x290);}var _0x57e0d8={'ijOQB':function(_0x312f34){function _0x897e3e(_0x3c9474,_0x1f4224,_0x45f00c,_0x16ffdb){return _0x5f25(_0x16ffdb-0xc8,_0x1f4224);}return _0x32a254[_0x897e3e(0x33d,0x318,0x347,0x2f8)](_0x312f34);},'wBUEL':_0x32a254['VfKWY']};_0x32a254[_0x546e02(0x55,0x22,0x3a,0x12)](_0x32a254[_0x221b32(-0x1bf,-0x15b,-0xd8,-0x15a)],_0x32a254[_0x546e02(0x85,0xcb,0xda,0x39)])?_0x57e0d8['ijOQB'](_0x367942):(_0x421c49=null,new self['JSZip']()[_0x221b32(-0xf,-0x66,-0xfb,-0x9c)](_0x284b7d,_0x3123d5)[_0x546e02(0xb3,0xd4,0xb9,0x100)](function(_0x1ffbb7){function _0xc917ba(_0x17e9ca,_0x1e8a70,_0x2cf934,_0x299e2b){return _0x546e02(_0x17e9ca-0x209,_0x1e8a70-0x9a,_0x2cf934-0xd1,_0x2cf934);}function _0x30e2d0(_0x4ff4a1,_0x571193,_0x3f7124,_0x4f8d47){return _0x546e02(_0x4ff4a1-0x3c9,_0x571193-0x15c,_0x3f7124-0x11e,_0x3f7124);}_0x311357[_0x3cc22e['_zip_path']][_0xc917ba(0x254,0x28f,0x210,0x2a6)]=_0x1ffbb7,_0x3cc22e[_0xc917ba(0x34a,0x397,0x3dc,0x391)]();},function(_0x260d89){function _0x5e6313(_0x429626,_0x46708e,_0x3951e7,_0x4cc1d5){return _0x546e02(_0x4cc1d5- -0x108,_0x46708e-0xc1,_0x3951e7-0x108,_0x429626);}function _0x31e046(_0x55a53d,_0x4e2e41,_0x427890,_0x53c12c){return _0x546e02(_0x55a53d- -0xde,_0x4e2e41-0x2e,_0x427890-0x7c,_0x427890);}console['error'](_0x57e0d8[_0x5e6313(0x62,0x99,0xcb,0x34)],_0x3cc22e[_0x5e6313(0x67,0x91,0xa3,0x37)],_0x260d89);}));}if(_0x56e849[_0x362a59(0x245,0x272,0x1f5,0x1f1)](_0x3cc22e[_0x362a59(0x215,0x2a4,0x2a1,0x21d)])){console[_0x567036(0x455,0x3c2,0x419,0x498)](_0x31ca66['DlHNL']('ZIP\x20decryp'+_0x567036(0x404,0x3cb,0x453,0x3cf)+_0x567036(0x412,0x428,0x439,0x3ce),_0x3cc22e[_0x567036(0x3ca,0x447,0x44f,0x3df)]));let _0x3042d9=performance['now']();window[_0x567036(0x412,0x462,0x449,0x419)][_0x567036(0x37f,0x3b4,0x380,0x410)][_0x567036(0x3a0,0x3c1,0x40b,0x380)](_0x31ca66[_0x362a59(0x1c9,0x13f,0xfe,0x182)],{'kty':_0x31ca66[_0x567036(0x46b,0x418,0x458,0x496)],'k':_0x31ca66[_0x567036(0x442,0x4d8,0x473,0x500)],'alg':_0x31ca66[_0x567036(0x4d3,0x3ec,0x442,0x43c)],'ext':!![]},{'name':_0x31ca66[_0x362a59(0x196,0x22b,0x16b,0x1f8)]},!![],[_0x31ca66[_0x362a59(0x24e,0x182,0x182,0x1de)],'decrypt'])[_0x362a59(0x1ca,0x167,0x128,0x191)](function(_0x5d9e3b){function _0x4c3784(_0x2df746,_0x5d6ba3,_0x193085,_0x3b3059){return _0x362a59(_0x2df746-0xab,_0x5d6ba3-0x1e9,_0x3b3059,_0x193085-0x47b);}var _0x15264e={'olFWO':_0x52e2be[_0x4c3784(0x735,0x612,0x6a2,0x65a)],'evQDQ':_0x52e2be[_0x4c3784(0x6a2,0x700,0x67a,0x6b3)],'JBYSu':_0x52e2be[_0x7ed015(0x5c9,0x5f4,0x588,0x589)],'shcuQ':function(_0x2a34ec,_0x1bbb8c){function _0x2aae2a(_0x422bf5,_0x2a0421,_0x105be7,_0x1e27f7){return _0x7ed015(_0x422bf5-0x40,_0x1e27f7,_0x422bf5-0x14d,_0x1e27f7-0x16e);}return _0x52e2be[_0x2aae2a(0x68b,0x685,0x70f,0x70e)](_0x2a34ec,_0x1bbb8c);},'yFqFA':function(_0x42001f,_0x8b5362){return _0x42001f+_0x8b5362;},'XmaOp':function(_0x214fcd,_0x217375){return _0x214fcd-_0x217375;},'VIDyo':_0x7ed015(0x540,0x589,0x53f,0x50c),'zHkGW':function(_0x168219,_0x85b659){function _0x2da42a(_0x3fc337,_0x48fde3,_0x1507a1,_0x3c5f4f){return _0x4c3784(_0x3fc337-0x1b1,_0x48fde3-0xe3,_0x3fc337- -0x353,_0x1507a1);}return _0x52e2be[_0x2da42a(0x2e9,0x322,0x324,0x2d1)](_0x168219,_0x85b659);},'XhTmO':_0x4c3784(0x57e,0x57f,0x60e,0x593),'BTyDw':_0x52e2be[_0x4c3784(0x69f,0x5c8,0x631,0x60c)]};function _0x7ed015(_0x4b6038,_0x30b835,_0x3f02b6,_0x3acf88){return _0x362a59(_0x4b6038-0x62,_0x30b835-0x172,_0x30b835,_0x3f02b6-0x33e);}window[_0x4c3784(0x6ab,0x61d,0x692,0x6fe)][_0x4c3784(0x589,0x624,0x5c9,0x617)][_0x4c3784(0x66f,0x63b,0x6a7,0x615)]({'name':_0x52e2be[_0x4c3784(0x714,0x6df,0x6c9,0x739)],'counter':new ArrayBuffer(0x1f69+-0x927+-0x1632),'length':0x80},_0x5d9e3b,_0x421c49[_0x4c3784(0x5ac,0x5e2,0x5e7,0x648)])[_0x4c3784(0x672,0x64b,0x60c,0x64f)](function(_0x40aace){function _0x5a2f89(_0x1c0249,_0x29897b,_0x9a68b6,_0x3d19f9){return _0x4c3784(_0x1c0249-0x11e,_0x29897b-0x51,_0x1c0249- -0xd1,_0x29897b);}function _0x1dbe47(_0x45d07c,_0x587e10,_0x115c90,_0xa81301){return _0x7ed015(_0x45d07c-0xbb,_0x115c90,_0x587e10- -0x616,_0xa81301-0x27);}var _0x48c959={};_0x48c959[_0x1dbe47(-0x15b,-0x1a8,-0x15a,-0x13f)]=_0x15264e[_0x5a2f89(0x4e5,0x52f,0x51f,0x57e)];var _0x4f66f3=_0x48c959;_0x15264e['evQDQ']===_0x15264e[_0x5a2f89(0x4e4,0x4f6,0x487,0x460)]?_0x45d159[_0x5a2f89(0x5ac,0x596,0x54b,0x5be)](_0x4f66f3[_0x1dbe47(-0x158,-0x1a8,-0x1a2,-0x196)],_0xe15548[_0x5a2f89(0x5c7,0x64c,0x64c,0x582)],_0xd7e3c9):(console[_0x1dbe47(-0x16b,-0xf1,-0x173,-0x8b)](_0x15264e['shcuQ'](_0x15264e[_0x1dbe47(-0x1ac,-0x19a,-0x145,-0x128)](_0x4f5389,_0x15264e[_0x5a2f89(0x4e9,0x479,0x572,0x548)](performance['now'](),_0x3042d9)),_0x15264e['VIDyo'])+_0x3cc22e[_0x1dbe47(-0x21,-0xbb,-0xcf,-0xd3)]),_0x507205(_0x40aace));})[_0x7ed015(0x5d6,0x5e5,0x575,0x607)](function(_0x1e6cdb){function _0x480b46(_0x55542a,_0x2de99c,_0x125f93,_0x86f6b){return _0x4c3784(_0x55542a-0x155,_0x2de99c-0x8c,_0x55542a- -0x65e,_0x86f6b);}function _0x4f14ff(_0x41b451,_0x5bf8ef,_0x401d4d,_0x17a307){return _0x4c3784(_0x41b451-0x1c1,_0x5bf8ef-0x1a5,_0x41b451- -0x6da,_0x401d4d);}if(_0x15264e['zHkGW'](_0x15264e['XhTmO'],_0x15264e[_0x480b46(0x4b,0xd4,-0x4c,0xd3)]))return _0x3d6ca4['decode'](_0x16750a);else console[_0x480b46(0x1f,0x6f,-0x47,-0x3d)](_0x1e6cdb);});})['catch'](function(_0x93e66a){function _0x1a9eae(_0x3edea6,_0x4b2c28,_0x1a8437,_0x166b90){return _0x362a59(_0x3edea6-0x1d8,_0x4b2c28-0x11e,_0x166b90,_0x4b2c28- -0x2b9);}_0x52e2be[_0x1a9eae(-0x11a,-0x112,-0x76,-0x9a)](_0x52e2be['TWtMq'],_0x52e2be['tCwxe'])?_0x3c449c(_0x4cabcc['response']):console['error'](_0x93e66a);});}else{if(_0x31ca66['VJUbk']!==_0x362a59(0xed,0x144,0x1a2,0x120))_0x31ca66[_0x567036(0x42f,0x412,0x3d4,0x3f3)](_0x507205,_0x421c49[_0x362a59(0x1a9,0xeb,0xfc,0x16c)]);else{var _0x7b15cf={'Gmqcv':function(_0x408e6d,_0x2c6421){function _0x14cee7(_0x987ea8,_0x2e8cd1,_0x14b73d,_0x18c078){return _0x567036(_0x987ea8-0x1ea,_0x18c078,_0x2e8cd1-0x4d,_0x18c078-0x12f);}return _0x52e2be[_0x14cee7(0x4bf,0x489,0x4a8,0x518)](_0x408e6d,_0x2c6421);}};_0xb00fa5(function(){function _0x1b6b5a(_0x5b614d,_0x3f0c49,_0x59b125,_0x14ae60){return _0x567036(_0x5b614d-0x65,_0x3f0c49,_0x59b125- -0x21d,_0x14ae60-0x1e9);}_0x7b15cf[_0x1b6b5a(0x13a,0x215,0x1b1,0x1d0)](_0x12aa69,_0x438834);},-0x1e98*-0x1+0x163a+0x2*-0x1a69);}}}else console[_0x362a59(0x234,0x23c,0x244,0x202)](_0x4b8705,_0x3cc22e[_0x362a59(0x2b2,0x29f,0x2ba,0x21d)],_0x421c49[_0x362a59(0x25f,0x216,0x15a,0x1da)]);},_0x4cb219=function(){function _0x1f3610(_0x4e204c,_0x4966d9,_0x44281c,_0xd2e880){return _0x54584e(_0x4e204c-0x153,_0x4e204c-0x329,_0x4966d9,_0xd2e880-0x12b);}function _0x4b3cc6(_0x311591,_0xd578f6,_0x1f5f4a,_0x27fa8a){return _0x215366(_0xd578f6,_0xd578f6-0x3e,_0x1f5f4a-0x1bc,_0x1f5f4a- -0xc1);}console[_0x1f3610(0x2e7,0x315,0x24e,0x2ab)](_0x32a254[_0x1f3610(0x2ba,0x2f7,0x28f,0x281)],_0x3cc22e['_zip_path'],_0x421c49['statusText']);},_0x557be6=toFileProtocol(this['_zip_path']),_0x1552e3[_0x54584e(-0x168,-0x116,-0x12a,-0xa8)](_0x2332e9,_0x1552e3[_0x215366(0x5f7,0x572,0x5b4,0x5da)],_0x557be6,!![],_0x1552e3[_0x54584e(0x9,0x0,0x11,-0x4b)],_0x2feb2a,_0x4cb219);}else _0x1845d3[_0x54584e(-0x5a,-0x56,-0x12,-0xcd)]['push'](this),_0x1845d3['zip']&&this['_decode']();}else _0x2feb2a=function(){function _0x184f77(_0x5e1257,_0x404498,_0x10a0ef,_0x4c51af){return _0x54584e(_0x5e1257-0x16f,_0x5e1257-0xbf,_0x404498,_0x4c51af-0x1ba);}_0x3cc22e[_0x41e562(-0xe9,-0xf0,-0xa7,-0x74)]=this[_0x41e562(-0xa3,-0xf0,-0x80,-0xe6)],_0x3cc22e[_0x184f77(0x57,-0x35,-0x2c,0x1e)]=0x332*0x4+0x1ee3*-0x1+0x12e3;function _0x41e562(_0xabd787,_0x1de991,_0x3279f8,_0x152a72){return _0x215366(_0xabd787,_0x1de991-0x16c,_0x3279f8-0x1b3,_0x1de991- -0x6e2);}_0x3cc22e[_0x184f77(0x1,-0x6,0x43,0xf)](),_0x3cc22e['response']=_0x3cc22e=_0x421c49=null;},_0x4cb219=function(){function _0x1a71ce(_0x146565,_0x822cb2,_0x14050b,_0x11c9c0){return _0x215366(_0x822cb2,_0x822cb2-0x1e8,_0x14050b-0xe5,_0x11c9c0- -0x320);}_0x3cc22e['statusText']=_0x32a254['CYnJI'],_0x3cc22e[_0x1a71ce(0x3cf,0x3f9,0x391,0x377)]&&_0x3cc22e['onerror']();},_0x2332e9(this[_0x215366(0x6de,0x5d2,0x5dd,0x652)],this['url'],this[_0x215366(0x5d8,0x54e,0x655,0x5bf)],this['responseTy'+'pe'],_0x2feb2a,_0x4cb219);}};}()),XMLHttpRequestZIP[_0xa76edd(0x4f4,0x5cf,0x596,0x568)][_0x50e32f(0x265,0x2fc,0x1d2,0x2a9)]=function(_0x240aaa,_0x2d851c,_0x3a2d06){var _0x39bdaa={};_0x39bdaa[_0x54d7b3(0x1e0,0x160,0x1fc,0x18b)]=_0x1552e3[_0x116ee0(-0x37,0xdc,-0x3c,0x54)];function _0x116ee0(_0x58021c,_0x1242ad,_0x3d7450,_0x2cc974){return _0xa76edd(_0x58021c,_0x1242ad-0x48,_0x3d7450-0x77,_0x2cc974- -0x530);}var _0x21649e=_0x39bdaa;function _0x54d7b3(_0x1ba0d6,_0x173a4f,_0x30dc1e,_0x3c1898){return _0xa76edd(_0x30dc1e,_0x173a4f-0x5e,_0x30dc1e-0x152,_0x173a4f- -0x3da);}_0x1552e3[_0x116ee0(0x6c,-0x81,-0x61,-0x15)]!==_0x1552e3[_0x116ee0(0x53,0x50,0x2e,-0x15)]?(_0x5c633e[_0x54d7b3(0x270,0x201,0x258,0x26e)]&&_0x2426a0[_0x116ee0(0x65,0x129,0x48,0xab)](_0x4cc39b[_0x116ee0(-0x35,-0x22,-0x98,-0x13)],_0x21649e['xbFmZ']),_0x4f2281[_0x116ee0(0x133,0xe,0x81,0x9c)](_0x54d7b3(0x20c,0x1f8,0x256,0x18f)+_0x116ee0(-0x6c,-0x46,0x6c,0x11)+'ROR:',_0xfac78b[_0x54d7b3(0x26a,0x20d,0x243,0x225)],_0x41621e['_file_path'],_0x155e75)):(this[_0x116ee0(0x8b,0x13,0x22,0x66)]=_0x240aaa,this[_0x116ee0(0x81,0x87,-0xae,-0x13)]=_0x2d851c,this[_0x116ee0(-0x34,-0xc9,-0x5,-0x2d)]=!!_0x3a2d06);};}());function _0x220d3e(_0x42212c,_0x43e750,_0x4562fc,_0x378beb){return _0x5f25(_0x4562fc- -0x4d,_0x43e750);}var SystemAnimator_caches={'enabled':_0x220d3e(0x313,0x2c2,0x276,0x2a0)in self&&browser_native_mode,'open':(function(){var _0x36c8f5={'NQwRS':function(_0x492e35,_0x4abb3a){return _0x492e35(_0x4abb3a);},'gOGeN':function(_0xac2ec,_0x2e874d,_0x198500){return _0xac2ec(_0x2e874d,_0x198500);},'CxsuO':_0x36d147(0x122,0x153,0xae,0x139)+_0x36d147(0x11c,0x1a9,0xca,0x153),'NNnoo':function(_0x402142,_0x1a8c74){return _0x402142===_0x1a8c74;},'rShED':_0xd322fb(0x8b,-0x68,-0x1c,0x1d)};function _0xd322fb(_0x2ef061,_0x2b7289,_0x1f2452,_0x1a60ba){return _0x220d3e(_0x2ef061-0x11a,_0x2b7289,_0x1a60ba- -0x1ad,_0x1a60ba-0x6c);}var _0x35551d;function _0x36d147(_0x33317a,_0xb94f91,_0x1da514,_0x527466){return _0x220d3e(_0x33317a-0x12b,_0x1da514,_0x527466- -0x17a,_0x527466-0x12b);}return function(){function _0x2ac18b(_0x1ad1df,_0x1bd66e,_0x433066,_0x4e61b9){return _0x36d147(_0x1ad1df-0x1b5,_0x1bd66e-0xbf,_0x4e61b9,_0x433066-0x55e);}var _0x14a68e={'lHRHg':function(_0x1c0bca,_0x46eaec){function _0xab1c01(_0x26ef2b,_0x4f7bee,_0x31a629,_0x4ac995){return _0x5f25(_0x31a629- -0x26b,_0x4ac995);}return _0x36c8f5[_0xab1c01(-0xd5,-0x8b,-0x5a,-0x8c)](_0x1c0bca,_0x46eaec);},'NzmXo':_0x36c8f5[_0x2ac18b(0x60b,0x593,0x5b5,0x558)],'LqOnr':function(_0x39351a,_0x2350c8){function _0x7de21f(_0x2e002e,_0x58f7c6,_0x18d828,_0x112fe0){return _0x2ac18b(_0x2e002e-0x10f,_0x58f7c6-0x131,_0x2e002e- -0x413,_0x112fe0);}return _0x36c8f5[_0x7de21f(0x17a,0xee,0x199,0x1ba)](_0x39351a,_0x2350c8);}};return new Promise(function(_0x29a997){function _0x44e0d7(_0x42ad72,_0x29c113,_0x212537,_0x433a91){return _0x2ac18b(_0x42ad72-0xd6,_0x29c113-0x1b,_0x42ad72- -0x41e,_0x29c113);}var _0x1d2224={'rJTeP':function(_0x1e20d7,_0x305a26){return _0x36c8f5['NQwRS'](_0x1e20d7,_0x305a26);},'ZtRwn':function(_0x35daba,_0x49338a){return _0x35daba!==_0x49338a;},'YaQza':_0x44e0d7(0x29a,0x2a0,0x2be,0x2d8),'XiKRp':function(_0x2a93ae,_0x16d909){return _0x36c8f5['NQwRS'](_0x2a93ae,_0x16d909);}};function _0x46772a(_0x577d5e,_0xaa74,_0x387412,_0x18f11d){return _0x2ac18b(_0x577d5e-0x1ce,_0xaa74-0x12c,_0xaa74-0x3e,_0x387412);}if(!SystemAnimator_caches[_0x44e0d7(0x237,0x1fb,0x274,0x22a)])return;_0x35551d?_0x36c8f5[_0x46772a(0x5de,0x603,0x5b9,0x5a0)](setTimeout,function(){function _0x48adc4(_0x586c42,_0x5b2fd4,_0x396f51,_0x32bd6e){return _0x44e0d7(_0x32bd6e-0x206,_0x5b2fd4,_0x396f51-0x6d,_0x32bd6e-0x50);}function _0x146b79(_0x279958,_0x59f04e,_0xc3ad3a,_0x3072a9){return _0x46772a(_0x279958-0x16,_0x279958- -0x503,_0xc3ad3a,_0x3072a9-0x140);}_0x14a68e[_0x146b79(0x159,0xd9,0x170,0x1c3)](_0x14a68e[_0x48adc4(0x3e6,0x401,0x3e9,0x38c)],_0x14a68e[_0x48adc4(0x31b,0x3ad,0x33b,0x38c)])?_0x14a68e['LqOnr'](_0x29a997,_0x35551d):_0x1d2224[_0x146b79(0x1ab,0x132,0x215,0x19e)](_0x5b1fb4,_0x417f8b);},-0x84e*0x3+0xba*-0xb+0x20e8):caches[_0x46772a(0x6d8,0x6f5,0x670,0x677)](_0x36c8f5[_0x44e0d7(0x217,0x1fc,0x1bf,0x2a2)])[_0x46772a(0x6ca,0x62d,0x677,0x68f)](_0x32c161=>{function _0x4814dd(_0x1c52b1,_0x1e5dbc,_0x5bbd64,_0x10de50){return _0x44e0d7(_0x10de50-0x11,_0x1e5dbc,_0x5bbd64-0x176,_0x10de50-0x1e7);}function _0xb6408a(_0x66e7cb,_0x376fdb,_0x16b182,_0x227b12){return _0x44e0d7(_0x227b12- -0x2fe,_0x376fdb,_0x16b182-0xe1,_0x227b12-0xd1);}if(_0x1d2224[_0xb6408a(-0x105,-0x103,-0x148,-0x10e)](_0x1d2224[_0x4814dd(0x1a1,0x1a9,0x193,0x1a9)],_0x1d2224[_0xb6408a(-0x1d4,-0xfb,-0x1c5,-0x166)])){if(_0x532e89[_0x4814dd(0x1ba,0x1a9,0x1f8,0x219)]['_zip_by_ur'+'l']){_0x48ebc8={};for(var _0x5b96b9 in _0x22fe51[_0x4814dd(0x1cf,0x2b0,0x17a,0x219)]['_zip_by_ur'+'l']){_0x448d2d[_0x5b96b9]={'zip':_0x499f81[_0x4814dd(0x1d4,0x232,0x20b,0x219)][_0xb6408a(-0x1f,-0xed,-0xee,-0xbb)+'l'][_0x5b96b9],'xhr':[]};}}else _0x5e766d={};}else _0x35551d=_0x32c161,_0x1d2224[_0x4814dd(0x207,0x1f7,0x240,0x1bf)](_0x29a997,_0x35551d);});});};}()),'request':function(_0x56820b,_0xe6c1a3){var _0x479983={};_0x479983[_0x2ab00f(0x87,0xd8,0xdb,0xee)]=_0x2ab00f(0x123,0xab,0x14,0x113);var _0x3b4bf4=_0x479983;function _0x2ab00f(_0x3f6b81,_0x11e094,_0x54a485,_0x1b2edb){return _0x220d3e(_0x3f6b81-0x192,_0x54a485,_0x11e094- -0x121,_0x1b2edb-0xf2);}var _0x3004cc={};function _0x1ad665(_0x156932,_0x1d6feb,_0x338001,_0x496f01){return _0x220d3e(_0x156932-0x18d,_0x496f01,_0x156932-0x1e8,_0x496f01-0x1d9);}return _0x3004cc['cache']=_0x2ab00f(0x1bb,0x18c,0x154,0xf2),this[_0x1ad665(0x459,0x3de,0x43e,0x450)]&&typeof _0x56820b==_0x3b4bf4[_0x1ad665(0x3e1,0x372,0x35d,0x3e7)]?new Request(_0x56820b,_0xe6c1a3||(localhost_mode?_0x3004cc:{})):_0x56820b;},'put':function(_0x3335c9,_0x51cd93){var _0x3c978c={};_0x3c978c[_0x3c6d7e(0x634,0x620,0x5df,0x55b)]=_0x3c6d7e(0x619,0x68f,0x63d,0x601);function _0x3c6d7e(_0x4e7d34,_0x44a7c0,_0x1c81ba,_0x1f9e8c){return _0x220d3e(_0x4e7d34-0x4c,_0x1f9e8c,_0x1c81ba-0x428,_0x1f9e8c-0xc7);}_0x3c978c[_0x122e32(0x345,0x3d0,0x3f8,0x37a)]=_0x3c6d7e(0x599,0x57d,0x5e7,0x5f6)+_0x3c6d7e(0x663,0x667,0x5ca,0x546),_0x3c978c[_0x122e32(0x2e4,0x34b,0x31a,0x37f)]=_0x3c6d7e(0x682,0x6be,0x6e9,0x6ba),_0x3c978c[_0x3c6d7e(0x73b,0x6c8,0x6e1,0x66b)]='myJFX';var _0x2c3be8=_0x3c978c;function _0x122e32(_0x3a1e5b,_0x326661,_0x4e7c21,_0x228cbc){return _0x220d3e(_0x3a1e5b-0x6d,_0x4e7c21,_0x228cbc-0x18f,_0x228cbc-0x9e);}SystemAnimator_caches[_0x122e32(0x420,0x3e1,0x428,0x462)]()[_0x122e32(0x3cc,0x33c,0x3fc,0x39a)](function(_0x4eecd0){function _0x10efdf(_0xa14b7b,_0x5edfad,_0x343966,_0x43b340){return _0x122e32(_0xa14b7b-0x1a8,_0x5edfad-0x15b,_0x5edfad,_0x43b340- -0x436);}function _0x18a688(_0x85cc3b,_0x99e662,_0x53c9b0,_0x699b63){return _0x3c6d7e(_0x85cc3b-0x8f,_0x99e662-0x134,_0x85cc3b- -0x208,_0x53c9b0);}var _0x2d5490={};_0x2d5490[_0x10efdf(0xd,-0xec,-0x11,-0x4d)]=_0x2c3be8['WYDrJ'];var _0x53765f=_0x2d5490;_0x2c3be8['MxGKy']!==_0x2c3be8[_0x18a688(0x4d9,0x481,0x54e,0x521)]?_0x4eecd0[_0x10efdf(-0x10a,-0x8a,-0xce,-0xea)](_0x3335c9,_0x51cd93)['then'](function(){function _0xb4aaf8(_0x2684a2,_0x3fb701,_0x3d1e1c,_0x9106f1){return _0x10efdf(_0x2684a2-0xe2,_0x2684a2,_0x3d1e1c-0x10e,_0x9106f1-0xa4);}function _0x677e8a(_0x36f63c,_0x2cbebf,_0x2bf323,_0xa44ccd){return _0x18a688(_0x36f63c- -0x34e,_0x2cbebf-0xaa,_0x2cbebf,_0xa44ccd-0xcc);}console['log'](_0x53765f[_0x677e8a(0x12c,0xd5,0x13b,0x19e)],_0x51cd93[_0xb4aaf8(0x16,-0xce,-0xb7,-0x36)]);})[_0x18a688(0x4d1,0x46d,0x464,0x4c3)](function(_0x31d5dc){function _0x4fa67f(_0x25c1d6,_0xe3914c,_0x44ae99,_0x47b2a4){return _0x18a688(_0x47b2a4- -0x4e2,_0xe3914c-0xdd,_0x25c1d6,_0x47b2a4-0x155);}function _0x495642(_0x130766,_0x1341fc,_0x1a892f,_0xb23f11){return _0x18a688(_0x1341fc- -0x436,_0x1341fc-0x1b7,_0x1a892f,_0xb23f11-0x121);}console[_0x495642(-0x1c,0x4b,-0x8,-0x19)](_0x2c3be8[_0x4fa67f(-0x150,-0x109,-0xcd,-0x10b)],_0x51cd93[_0x495642(-0xd1,-0x49,-0xba,0x2)]);}):(_0x324826[_0x5855f5[_0x18a688(0x4b7,0x4b9,0x522,0x50a)]][_0x18a688(0x3c3,0x3d1,0x440,0x38c)]=_0x5d6c6f,_0x8a9c50[_0x10efdf(0x7e,-0x66,-0x7b,-0xe)]());});},'match':function(_0x3bbe01,_0x94578c){function _0x3edbd4(_0xed61ec,_0x19422d,_0x159833,_0x465b1a){return _0x220d3e(_0xed61ec-0x145,_0x19422d,_0x465b1a-0x22a,_0x465b1a-0x27);}function _0x2a2258(_0x5e832e,_0x56a099,_0x352ee4,_0x211754){return _0x220d3e(_0x5e832e-0x10f,_0x5e832e,_0x211754-0x353,_0x211754-0x13f);}var _0x299247={'ujRML':function(_0x3dc92b){return _0x3dc92b();},'DhOBO':_0x3edbd4(0x4a0,0x534,0x440,0x4d4),'ZayQD':function(_0x5782b6,_0x26aff5){return _0x5782b6==_0x26aff5;},'SRhcM':function(_0x4cfdbd,_0x75b178){return _0x4cfdbd||_0x75b178;},'MoCzW':function(_0x52034d){return _0x52034d();},'AcnRA':function(_0x1db439,_0x5ae619){return _0x1db439===_0x5ae619;},'BcUIH':_0x3edbd4(0x376,0x458,0x378,0x40c),'TkIzf':function(_0x713718,_0x150345){return _0x713718(_0x150345);},'yBbKt':_0x2a2258(0x637,0x52a,0x65b,0x5bd),'PnyKx':function(_0x53096a,_0x459631,_0x56491c){return _0x53096a(_0x459631,_0x56491c);}};return _0x3bbe01=SystemAnimator_caches[_0x2a2258(0x58f,0x4d4,0x4b9,0x514)](_0x3bbe01),new Promise(function(_0x13964a,_0x39a972){function _0x75843d(_0x28b24a,_0x2011d4,_0x321322,_0x51c45f){return _0x3edbd4(_0x28b24a-0xb6,_0x321322,_0x321322-0x7d,_0x2011d4- -0x3d8);}function _0x22d41a(_0xd74d59,_0x374838,_0x5f3770,_0x214e78){return _0x3edbd4(_0xd74d59-0xc5,_0x214e78,_0x5f3770-0x1b4,_0x5f3770- -0x1d6);}if(!SystemAnimator_caches['enabled']){_0x299247[_0x75843d(0xb6,0x78,0x57,0xa6)](setTimeout,function(){_0x299247['ujRML'](_0x39a972);},0x20c6+0x8*-0x13b+-0x5*0x496);return;}SystemAnimator_caches['open']()[_0x22d41a(0x1e2,0x2f8,0x25f,0x1c2)](function(_0x4ae0db){var _0x50154e={'oYxia':_0x48854a(-0x47,-0x5c,-0x9f,-0x8f)+'3','CBYBS':_0x299247[_0x5d7f12(0x1e2,0x249,0x16b,0x1c2)],'rGKrD':function(_0x2a6058,_0x11cb07){function _0x4b5e7e(_0x16e880,_0x107814,_0x1f5be7,_0x1c186b){return _0x5d7f12(_0x1c186b- -0x2a6,_0x107814-0x1c8,_0x1f5be7-0xae,_0x16e880);}return _0x299247[_0x4b5e7e(-0xef,-0xf8,-0x19b,-0x123)](_0x2a6058,_0x11cb07);},'EMnCz':'(match\x20by\x20'+'Content-Le'+_0x48854a(-0x73,-0x47,-0xb6,-0x4d),'yjhvC':function(_0x4224b1,_0x21260e){function _0x8f553f(_0x492ce4,_0x57b86c,_0x8e87b9,_0x25eb6a){return _0x48854a(_0x492ce4-0x18c,_0x25eb6a,_0x57b86c-0x585,_0x25eb6a-0xaf);}return _0x299247[_0x8f553f(0x56e,0x57f,0x5f1,0x5fc)](_0x4224b1,_0x21260e);},'zBZqE':function(_0x297f03){function _0x1570dc(_0x5c9595,_0x24b864,_0x37a8c2,_0x5e0d85){return _0x5d7f12(_0x5e0d85- -0x2f9,_0x24b864-0x184,_0x37a8c2-0x109,_0x37a8c2);}return _0x299247[_0x1570dc(-0x119,-0xaf,-0x16c,-0xda)](_0x297f03);},'YiCLZ':function(_0x1fb67a,_0x561809){function _0x1ba95f(_0x5ef963,_0x3a2954,_0x3ee842,_0x57b893){return _0x48854a(_0x5ef963-0x17a,_0x3ee842,_0x57b893-0x4fc,_0x57b893-0x1df);}return _0x299247[_0x1ba95f(0x527,0x517,0x563,0x52e)](_0x1fb67a,_0x561809);},'aaZCI':_0x299247[_0x48854a(0xd,0x9f,0x5e,0x20)],'XblqI':function(_0x341184,_0x42af85){function _0x2dfcfd(_0x3810b6,_0x4aac0d,_0x33b246,_0x5e0284){return _0x48854a(_0x3810b6-0xec,_0x4aac0d,_0x33b246-0x623,_0x5e0284-0x177);}return _0x299247[_0x2dfcfd(0x5e7,0x602,0x639,0x60f)](_0x341184,_0x42af85);},'XSjIV':_0x299247['yBbKt'],'UmuqZ':function(_0x540f3c,_0x2d9a83,_0x3b1aaa){return _0x299247['PnyKx'](_0x540f3c,_0x2d9a83,_0x3b1aaa);}};function _0x5d7f12(_0x35c09f,_0x5c122e,_0x4b0ae8,_0x59f3e9){return _0x22d41a(_0x35c09f-0x161,_0x5c122e-0x165,_0x35c09f- -0x6d,_0x59f3e9);}var _0x2542b5={};function _0x48854a(_0x1a124a,_0xb682a9,_0x1311a1,_0x49b462){return _0x22d41a(_0x1a124a-0x13b,_0xb682a9-0x198,_0x1311a1- -0x2b5,_0xb682a9);}_0x2542b5[_0x48854a(0x4a,0x2f,0x5c,0x12)+'ch']=!![],_0x4ae0db[_0x5d7f12(0x207,0x200,0x1c6,0x1c3)](_0x3bbe01,_0x94578c||_0x2542b5)[_0x48854a(0x1,-0x22,-0x56,-0x31)](function(_0x2862ae){var _0x4d1006={'Htlzt':_0x50154e['oYxia'],'rUVIr':function(_0x134481,_0x212430){return _0x134481!==_0x212430;},'XiDAn':_0x50154e['CBYBS'],'NiYVL':_0x292c78(0x579,0x4b1,0x4e6,0x501),'DAOIp':function(_0x33789f,_0x33a380){return _0x50154e['rGKrD'](_0x33789f,_0x33a380);},'VzTxa':function(_0x3f73f0,_0x274dfd){return _0x3f73f0&&_0x274dfd;},'gemlT':_0x292c78(0x4e2,0x3d7,0x3c8,0x467)+_0x292c78(0x4e5,0x45e,0x4f2,0x4f1),'Yzaff':_0x3935a3(-0xf8,-0x15e,-0x6f,-0x74)+_0x3935a3(-0x4c,-0x45,-0x9f,-0xe0),'opWAz':_0x50154e[_0x292c78(0x41d,0x423,0x419,0x4a2)],'FWnZk':function(_0x1f1977,_0x50d29b){return _0x1f1977(_0x50d29b);},'eQKGd':function(_0x10da01){return _0x10da01();},'MIMkO':function(_0x5faadd,_0x53d50b){function _0x2b94f1(_0x44d343,_0x50034c,_0x34d3f1,_0x5dd96a){return _0x3935a3(_0x5dd96a-0x274,_0x50034c-0x56,_0x44d343,_0x5dd96a-0x182);}return _0x50154e[_0x2b94f1(0x20c,0x110,0x20a,0x17d)](_0x5faadd,_0x53d50b);}};if(!_0x2862ae){_0x50154e[_0x3935a3(-0x136,-0xdf,-0x13e,-0x1be)](_0x39a972);return;}if(/\/user\-defined\-local\//[_0x3935a3(-0x66,-0x5b,-0x5c,0xf)](_0x3bbe01[_0x3935a3(-0x104,-0x73,-0x169,-0x11f)])){if(_0x50154e[_0x3935a3(-0x34,-0x1d,-0xa8,-0x5c)](_0x50154e[_0x3935a3(-0xe,0x8b,-0x1f,-0x9a)],_0x50154e[_0x292c78(0x583,0x549,0x57f,0x551)])){_0x50154e[_0x3935a3(-0x75,0xd,-0x6d,-0x61)](_0x13964a,_0x2862ae);return;}else{var _0x204b81=_0x4d1006[_0x292c78(0x550,0x560,0x4fa,0x4f2)][_0x292c78(0x57a,0x54d,0x56d,0x550)]('|'),_0x4b481e=0x1782+0x1d14+-0x7f*0x6a;while(!![]){switch(_0x204b81[_0x4b481e++]){case'0':_0x4c3ef8=new _0x455189[(_0x3935a3(-0x4f,0x3b,-0xe8,-0xce))+'uest']();continue;case'1':_0x2dfbe0['onerror']=_0x2b131d;continue;case'2':_0x1922e8[_0x292c78(0x546,0x59a,0x597,0x511)+'pe']=_0x5481d9;continue;case'3':_0x240efa[_0x292c78(0x512,0x45b,0x400,0x494)]();continue;case'4':_0x446a42[_0x292c78(0x439,0x4e2,0x519,0x48e)]=_0x482a57;continue;case'5':_0x423577[_0x3935a3(0x2,-0x7f,-0x44,0x9a)](_0x541abe,_0x200e90,_0x19bde9);continue;}break;}}}function _0x3935a3(_0x318bc1,_0x4d866a,_0x15b1ad,_0x313650){return _0x48854a(_0x318bc1-0x4f,_0x15b1ad,_0x318bc1- -0x70,_0x313650-0xb4);}var _0x1f1091=_0x2862ae[_0x3935a3(-0x72,-0x109,-0x69,-0x104)][_0x292c78(0x4fe,0x4cc,0x455,0x4c4)](_0x50154e[_0x292c78(0x411,0x4bc,0x489,0x48d)]),_0x21d08e=_0x2862ae[_0x3935a3(-0x72,0x24,-0x103,-0x67)][_0x3935a3(-0x9b,-0x56,-0x55,-0x101)](_0x292c78(0x403,0x487,0x4c3,0x426)+_0x3935a3(-0x62,-0x8d,-0x7c,-0x15)),_0x1941f4={};function _0x292c78(_0x4ff856,_0x6ee2d,_0xbd9b15,_0x5ac575){return _0x5d7f12(_0x5ac575-0x2a7,_0x6ee2d-0x120,_0xbd9b15-0x1a5,_0x4ff856);}_0x1941f4[_0x292c78(0x562,0x482,0x531,0x4d4)]='HEAD',_0x50154e[_0x3935a3(-0x7,0x92,0x7d,0x8b)](fetch,SystemAnimator_caches[_0x3935a3(-0x110,-0xf1,-0x187,-0x83)](_0x2862ae[_0x292c78(0x48b,0x481,0x3e5,0x45b)]),_0x1941f4)[_0x3935a3(-0xc6,-0x164,-0x120,-0x143)](function(_0x41308d){function _0x366820(_0x5ed1c6,_0x271dee,_0x89600,_0x4eeb2f){return _0x292c78(_0x271dee,_0x271dee-0x49,_0x89600-0x1ca,_0x4eeb2f- -0x379);}function _0x2fc395(_0x449e60,_0x19ffdf,_0xfdf571,_0x309662){return _0x292c78(_0x449e60,_0x19ffdf-0x1bd,_0xfdf571-0x1f2,_0x309662- -0x276);}if(_0x4d1006[_0x2fc395(0x1dc,0x16b,0x1d0,0x1bf)](_0x2fc395(0x28c,0x228,0x281,0x2c2),_0x4d1006[_0x366820(0xd3,0x89,0xa9,0x104)])){_0x131f94={};for(var _0x5d28ba in _0x5ea5f9['DragDrop'][_0x2fc395(0x317,0x26c,0x227,0x295)+'l']){_0x571fac[_0x5d28ba]={'zip':_0x31e21d['DragDrop'][_0x2fc395(0x2c6,0x20c,0x23f,0x295)+'l'][_0x5d28ba],'xhr':[]};}}else{var _0x360e79=_0x4d1006[_0x366820(0x181,0xdb,0x18a,0x116)][_0x366820(0x23f,0x162,0x261,0x1d7)]('|'),_0x108582=0xd8+0x1c86+-0x1d5e;while(!![]){switch(_0x360e79[_0x108582++]){case'0':var _0x495dd0=_0x41308d['headers']['get'](_0x366820(0x1bc,0x157,0x208,0x17f));continue;case'1':if(!_0x7dc593&&_0x495dd0==_0x1f1091||!_0x2ecbba&&_0x4d1006[_0x366820(0x235,0x21f,0x229,0x1ba)](_0x18beb4,_0x21d08e)||_0x4d1006[_0x366820(0xa9,0xc3,0x9a,0xb3)](_0x7dc593,_0x2ecbba)){if(_0x4d1006[_0x366820(0x85,0x29,0x113,0xb3)](_0x7dc593,_0x2ecbba))console[_0x366820(0x13f,0x15b,0x18d,0x176)](_0x4d1006[_0x366820(0x193,0xd5,0x1c5,0x13a)]);else{if(!_0x7dc593)console[_0x2fc395(0x27e,0x2c1,0x2e7,0x279)](_0x4d1006[_0x2fc395(0x1f0,0x27d,0x21b,0x249)]);else console[_0x2fc395(0x29b,0x267,0x239,0x279)](_0x4d1006[_0x366820(0x134,0x11c,0x17b,0x118)]);}_0x4d1006[_0x366820(0x217,0x232,0x21e,0x1c9)](_0x13964a,_0x2862ae);}else console[_0x366820(0x14c,0x140,0xe2,0x176)](_0x366820(0xff,0x19e,0xa8,0x119)+_0x2fc395(0x1f6,0x15f,0x164,0x1d2),_0x2862ae['url'],_0x1f1091,_0x495dd0,_0x21d08e,_0x18beb4),_0x4d1006[_0x2fc395(0x24e,0x247,0x298,0x240)](_0x39a972);continue;case'2':var _0x2ecbba=_0x4d1006[_0x366820(0x19f,0x178,0x15c,0x12f)](!_0x21d08e,!_0x18beb4);continue;case'3':var _0x7dc593=!_0x1f1091||!_0x495dd0||/sao\.animetheme\.com/i[_0x2fc395(0x209,0x304,0x1ec,0x283)](window[_0x366820(0x23f,0x24b,0x1b5,0x1bc)][_0x366820(0x7a,0xef,0x71,0x10a)]);continue;case'4':var _0x18beb4=_0x41308d[_0x366820(0x1f4,0x1da,0xdd,0x174)][_0x2fc395(0x2bb,0x255,0x1d7,0x24e)]('Content-Le'+_0x366820(0x1cb,0x1a4,0x1ec,0x184));continue;}break;}}});});});});},'delete':function(_0x51ee4b,_0x52e45){var _0x279fee={'QuAeb':function(_0x54c78f,_0x265242){return _0x54c78f(_0x265242);},'kZFsO':function(_0x42e9ef,_0x473560){return _0x42e9ef||_0x473560;}};return new Promise(function(_0x12fef9){if(!SystemAnimator_caches['enabled'])return;function _0x5c5340(_0x56989d,_0x5aa2db,_0x48564f,_0x558137){return _0x5f25(_0x48564f-0x3c9,_0x56989d);}function _0x2be69e(_0x7302cd,_0xcc3eb8,_0x58cf83,_0x5ec5bc){return _0x5f25(_0x5ec5bc-0x222,_0x7302cd);}SystemAnimator_caches[_0x2be69e(0x58a,0x587,0x55f,0x542)]()[_0x5c5340(0x5a7,0x60f,0x621,0x5f5)](function(_0x426752){function _0x421338(_0x49939b,_0x2f788e,_0x55c087,_0x2b082e){return _0x2be69e(_0x55c087,_0x2f788e-0xf2,_0x55c087-0x131,_0x2f788e-0x28);}var _0x269692={'IXgmN':function(_0x25d1b8,_0x3e0be8){return _0x279fee['QuAeb'](_0x25d1b8,_0x3e0be8);}},_0x1fdc91={};_0x1fdc91['ignoreSear'+'ch']=!![];function _0x51ae89(_0x2513c2,_0x5c660c,_0x293e95,_0x326bee){return _0x5c5340(_0x2513c2,_0x5c660c-0x1c4,_0x293e95- -0x66f,_0x326bee-0x109);}_0x426752[_0x51ae89(0xe1,-0x2,0x5c,0xc7)](_0x51ee4b,_0x279fee[_0x51ae89(-0x4a,0x2b,-0x57,-0x6c)](_0x52e45,_0x1fdc91))[_0x51ae89(-0xe3,-0xbe,-0x4e,-0x7c)](function(_0x5c4fa8){function _0x2fd3af(_0x18baa2,_0x571ce5,_0x496c48,_0x26d13e){return _0x51ae89(_0x18baa2,_0x571ce5-0x64,_0x571ce5-0x519,_0x26d13e-0x156);}_0x269692[_0x2fd3af(0x4c5,0x547,0x518,0x561)](_0x12fef9,_0x5c4fa8);});});});}};function _0x5f25(_0x58a227,_0x2f2d26){var _0x4b1277=_0x4553();return _0x5f25=function(_0x4820ee,_0x11843c){_0x4820ee=_0x4820ee-(-0x141f+-0x136*0x17+0x31de);var _0x56ce35=_0x4b1277[_0x4820ee];if(_0x5f25['SPDvXE']===undefined){var _0x1da820=function(_0x43e121){var _0x40ad3f='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';var _0x2ac2c0='',_0x52e563='';for(var _0x9c1eba=-0x1d86+-0x9*0x3f7+0x4135,_0x5c7283,_0x2aec89,_0x43bd32=0x2*-0xb61+-0x18ee*-0x1+-0x22c;_0x2aec89=_0x43e121['charAt'](_0x43bd32++);~_0x2aec89&&(_0x5c7283=_0x9c1eba%(-0x37e+0x1226*0x2+-0x20ca)?_0x5c7283*(-0x1e5*0x2+0x26a3+-0x11*0x209)+_0x2aec89:_0x2aec89,_0x9c1eba++%(-0x1*0x1e4d+-0x1f3*0x5+0x2810))?_0x2ac2c0+=String['fromCharCode'](-0xc5a+0x432+0x927&_0x5c7283>>(-(0x60a*0x6+0xc0+0x2*-0x127d)*_0x9c1eba&-0x1bdd+0x1*0x14ac+0x737*0x1)):0x2653*0x1+0xed*-0x5+-0x21b2){_0x2aec89=_0x40ad3f['indexOf'](_0x2aec89);}for(var _0x5d8ce4=0x7b2*0x5+-0x28*-0xa9+-0x16*0x2f3,_0x3f4434=_0x2ac2c0['length'];_0x5d8ce4<_0x3f4434;_0x5d8ce4++){_0x52e563+='%'+('00'+_0x2ac2c0['charCodeAt'](_0x5d8ce4)['toString'](0x34*0x22+0x2162*0x1+-0x283a))['slice'](-(0x4c*0x4d+0x11ba+-0x2894));}return decodeURIComponent(_0x52e563);};_0x5f25['VzRuwb']=_0x1da820,_0x58a227=arguments,_0x5f25['SPDvXE']=!![];}var _0x31d643=_0x4b1277[-0x20be+0x116f*-0x1+-0x7*-0x72b],_0x5d1c11=_0x4820ee+_0x31d643,_0x3b63b9=_0x58a227[_0x5d1c11];return!_0x3b63b9?(_0x56ce35=_0x5f25['VzRuwb'](_0x56ce35),_0x58a227[_0x5d1c11]=_0x56ce35):_0x56ce35=_0x3b63b9,_0x56ce35;},_0x5f25(_0x58a227,_0x2f2d26);}function _0x4553(){var _0x382ecd=['Axn0DxG','qMnvsuG','r0vu','ywvirNC','C3bSAxq','ywfAq0K','v1fovKC','C3rLBMvY','u2j3CLi','A21PseW','Cufcv20','wK5OBgm','vw11CvO','suD6shm','B0DoreO','yxrVCG','uMzuqLm','uu5mtMi','EKHNBhu','rwX4zLm','q2LOr2y','B3bLBG','B09Xs3O','q29UDgvUDc1mzq','s2XUqxy','Eez6r2O','EKjACuu','wMf5uuq','rLbfuMO','vNPuEge','x3bHDgHFDg9FBW','t2DrvK0','kYKK','ruq6','EMLW','mJm4mZGZouf4CfvwEa','vKfztfO','qNHOzxG','CLvwsxi','ve5Lrhm','tLf3uLm','r1DhBuq','BMD0AcK','mJbUsKf3vKq','wu55zve','wKLqigrLy3j5Ca','sZjWugyXAxfcCa','zMrRywy','y2XVBMu','u1nUwxu','yxn5BMm','sKjzu3u','B2Xgv08','sLPoqLa','AvLWsu0','EuzXrKe','wg1Ht3a','uKveoG','uKTyC1y','zgvJB2rL','Chv0','u2LjtxC','q2fJAguGu1rpuG','tNPTwg8','CMvXDwvZDa','mhW0Fdf8nxWYFa','y0PnBgq','tK5UB28','wvPlwMy','EgTSueW','CuTUthu','C3vIDgXL','Dwz2yLq','BNbWzeS','C1jezKi','C3rYAw5N','DxjS','uxvjqK8','wg1yBeW','AeL6A3i','CLnOruq','wwfrEMe','tLPtDem','mtq0qxrzwerr','wNrKugS','twzvAve','CvjUDu0','uuzVCKi','kg1HDgnOigj5ia','EwPODKm','uxHosfK','ALbsq08','v29XDg8','uvHMwNO','txbytgS','uLH2tMm','z09hzu4','D3vyzKO','y01tzfa','mKvkwwDsBW','rNLnmdDJDtbvCq','CMvZCg9UC2u','ww1irgK','wgLluNa','u3j3wgu','EgjgBvO','v1LeCKO','r1LQzLy','yuXOqw0','v3bQrKG','wgLeqw4','txHhs3K','DwvZDfPjucbfuG','zNP6uNm','ywrKrxzLBNrmAq','zM9YrwfJAa','Ag9ZDa','zMv0y2G','B2vVEgO','xcnBxc9Cxf0OlG','t29oEgW','nda2oty4ohD5txrdvG','rgHpqK8','CuLbwLq','C2HPzNqTAMLZ','nZC1mdjWrhDhq0y','wfnQsvy','B25SB2fK','tMLzvKW','A1PgC08','B3bxqxO','q2fJAguGrvHqsq','ic0GwKLqievsuG','C2vUza','u1vjCLK','ntbvA2PLzei','r2neEgG','DwvZDa','DgHLBG','wfnzuNK','Cej5yvm','tgvytee','AKPovhe','tKfbvKi','BK1yEgO','z2vLCMi','q2fJAguGseLuoG','ru1Uq3O','tK8Gq0fdseu6','r21Xy3y','z3LhqNq','ChjVDg90ExbL','y29Uy2f0','tuLnA08','wwHZvhG','Eujky3m','sxvhv3q','t1i6','vvjm','Bwf0y2G','twPUDxu','uxfprw0','ELH2vKO','mZiYmdu0n0jzALbetG','z2vTBfq','ug55s3G','sLzYDLm','zvflr2q','DxvLvvy','wNrsD24','uNLmCfu','BLzrDem','v0LHrwK','r0r2CKu','DfnwAfy','BfrUq00','wxPHzMy','yKrRqxK','DwvQDKe','Ew5LCeO','EMXJr1m','z2v0','AxjmywG','tw9dELC','CMvWBgfJzq','BeHssgC','uur1r0u','ze5jtvq','rNnfEKm','yxjYyxLIDwzMzq','rhjRywS','AKfKtfy','y0TmCeK','rhjHz0rYB3a','Dw1R','wMfSvfG','wevKzhe','Bwv0Ag9K','wKfszg4','Afvlz1u','yMXSC2q','BKX6vK5QDLbPtW','uK9s','Ew1ZEKi','BgDnuM8','wwnAr2u','vMzlv1K','zMLSzq','q3HZDu8','yxHPvLy','Aw1WB3j0s2v5','C3rHDhvZvgv4Da','tLnst0y','C3rHDhvZ','sNbsq0C','ww9TzMS','B1P6sK8','ChfLv2m','u1jOy00','wgjSCuK','DgLVBIbKB25Lka','DKrOExq','AgvHzgvYCW','BM93','Bg9N','uK9soG','BM8GDgfNkq','shrSENq','Bg9JywWGzMLSzq','ChvRwwW','BxHlsKG','EgHY','zuDPyxm','rvrHzW','DgvZDa','x2nSzwfY','z0PKDKG','Bg9HzefZEw5J','BMD0Aa','qti1nKnuuG','zw5HyMXLza','A0jcB2S','mhW0Fdn8mNWX','BePeDee','qMXVyG','y2fJAgvZ','vgTjEMy','C0LIrLK','D1nWywK','AhrLrgy','BxmPic0G','zxjYB3i','x3PPCf9IEv91CG','txH2C0y','ChfLAuC','rgruzMm','ic0G','we1mshr0CfjLCq','CMvZCg9UC2vuEq','z2Turha','rvrHzYK','ANDR','svHNBu4','x2zPBgvFCgf0Aa','AwHHwxa','yKTvBhu','B25LCNjVCG','CKPuzva','mJq2ote4nLfcwLPTtW','y2fSBa','rgX5r2O','xIGUk1WUEMLWkq','y3j5ChrV','vNPJv1y','qwnUuKe','D0jvruW','mtm2odmXnezhy1PNwa','yxjYyxLcDwzMzq','x3PPCf9WyxrO','tff6Dxq','x2rLy29Kzq','wwDlruu','DgLVBIbZDgfYDa','nZG0EK5hD0Hn','wwLdtfO','tNvHq2W','t3zHv04','A3n5D0C','txrqDK8','vK1Nruq','Du9qq1e','uu1yz00','refpsxa','zgvJCNLWDa','Bg9JyxrPB24','qLr5rhC','BePPvue','uNDdrhi','uMnvEw4','v0zeAwe','BM8TC3rVCMu','mZG4otG0z2HpsLLp','qwXzt20','m3WYFdf8mhW1Fa','y2f0y2G','DwvZDfPjucb6Aq','u3LZDgvTqw5PBq','rLDUwMS','zgvSzxrL','sLnAAxa','Bvvkz2C','BgTRr2G','Aw1sr3O','zw5JCNLWDa','rfrQwuG','CcbWyxrOoG','AwDUB3jLu2vHCG'];_0x4553=function(){return _0x382ecd;};return _0x4553();}
(function(d){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=d();else if("function"==typeof define&&define.amd)define([],d);else{var _;_="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?this:self:global:window,_.JSZip=d()}})(function(){return function x(z,S,C){function E(A,B){if(!S[A]){if(!z[A]){var R="function"==typeof require&&require;if(!B&&R)return R(A,!0);if(I)return I(A,!0);var T=new Error("Cannot find module '"+A+"'");throw T.code="MODULE_NOT_FOUND",T}var D=S[A]={exports:{}};z[A][0].call(D.exports,function(F){var N=z[A][1][F];return E(N?N:F)},D,D.exports,x,z,S,C)}return S[A].exports}for(var I="function"==typeof require&&require,O=0;O<C.length;O++)E(C[O]);return E}({1:[function(x,z,S){"use strict";var C=x("./utils"),E=x("./support"),I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";S.encode=function(O){for(var A=[],L=0,U=O.length,Z=U,W="string"!==C.getTypeOf(O),B,R,T,D,F,N,P;L<O.length;)Z=U-L,W?(B=O[L++],R=L<U?O[L++]:0,T=L<U?O[L++]:0):(B=O.charCodeAt(L++),R=L<U?O.charCodeAt(L++):0,T=L<U?O.charCodeAt(L++):0),D=B>>2,F=(3&B)<<4|R>>4,N=1<Z?(15&R)<<2|T>>6:64,P=2<Z?63&T:64,A.push(I.charAt(D)+I.charAt(F)+I.charAt(N)+I.charAt(P));return A.join("")},S.decode=function(O){var P=0,L=0,U="data:",A,B,R,T,D,F,N;if(O.substr(0,U.length)===U)throw new Error("Invalid base64 input, it looks like a data url.");O=O.replace(/[^A-Za-z0-9\+\/\=]/g,"");var Z=3*O.length/4;if(O.charAt(O.length-1)===I.charAt(64)&&Z--,O.charAt(O.length-2)===I.charAt(64)&&Z--,0!=Z%1)throw new Error("Invalid base64 input, bad content length.");var W;for(W=E.uint8array?new Uint8Array(0|Z):Array(0|Z);P<O.length;)T=I.indexOf(O.charAt(P++)),D=I.indexOf(O.charAt(P++)),F=I.indexOf(O.charAt(P++)),N=I.indexOf(O.charAt(P++)),A=T<<2|D>>4,B=(15&D)<<4|F>>2,R=(3&F)<<6|N,W[L++]=A,64!==F&&(W[L++]=B),64!==N&&(W[L++]=R);return W}},{"./support":30,"./utils":32}],2:[function(x,z){"use strict";function C(B,R,T,D,F){this.compressedSize=B,this.uncompressedSize=R,this.crc32=T,this.compression=D,this.compressedContent=F}var E=x("./external"),I=x("./stream/DataWorker"),O=x("./stream/DataLengthProbe"),A=x("./stream/Crc32Probe"),O=x("./stream/DataLengthProbe");C.prototype={getContentWorker:function(){var B=new I(E.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new O("data_length")),R=this;return B.on("end",function(){if(this.streamInfo.data_length!==R.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),B},getCompressedWorker:function(){return new I(E.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},C.createWorkerFrom=function(B,R,T){return B.pipe(new A).pipe(new O("uncompressedSize")).pipe(R.compressWorker(T)).pipe(new O("compressedSize")).withStreamInfo("compression",R)},z.exports=C},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(x,z,S){"use strict";var C=x("./stream/GenericWorker");S.STORE={magic:"\0\0",compressWorker:function(){return new C("STORE compression")},uncompressWorker:function(){return new C("STORE decompression")}},S.DEFLATE=x("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(x,z){"use strict";function E(B,R,T,D){B^=-1;for(var P=D;P<D+T;P++)B=B>>>8^A[255&(B^R[P])];return-1^B}function I(B,R,T,D){B^=-1;for(var P=D;P<D+T;P++)B=B>>>8^A[255&(B^R.charCodeAt(P))];return-1^B}var O=x("./utils"),A=function(){for(var R=[],T=0,B;256>T;T++){B=T;for(var D=0;8>D;D++)B=1&B?3988292384^B>>>1:B>>>1;R[T]=B}return R}();z.exports=function(R,T){if("undefined"==typeof R||!R.length)return 0;var D="string"!==O.getTypeOf(R);return D?E(0|T,R,R.length,0):I(0|T,R,R.length,0)}},{"./utils":32}],5:[function(x,z,S){"use strict";S.base64=!1,S.binary=!1,S.dir=!1,S.createFolders=!0,S.date=null,S.compression=null,S.compressionOptions=null,S.comment=null,S.unixPermissions=null,S.dosPermissions=null},{}],6:[function(x,z){"use strict";var C=null;C="undefined"==typeof Promise?x("lie"):Promise,z.exports={Promise:C}},{lie:37}],7:[function(x,z,S){"use strict";function C(R,T){A.call(this,"FlateWorker/"+R),this._pako=null,this._pakoAction=R,this._pakoOptions=T,this.meta={}}var E="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,I=x("pako"),O=x("./utils"),A=x("./stream/GenericWorker"),B=E?"uint8array":"array";S.magic="\b\0",O.inherits(C,A),C.prototype.processChunk=function(R){this.meta=R.meta,null===this._pako&&this._createPako(),this._pako.push(O.transformTo(B,R.data),!1)},C.prototype.flush=function(){A.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},C.prototype.cleanUp=function(){A.prototype.cleanUp.call(this),this._pako=null},C.prototype._createPako=function(){this._pako=new I[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var R=this;this._pako.onData=function(T){R.push({data:T,meta:R.meta})}},S.compressWorker=function(R){return new C("Deflate",R)},S.uncompressWorker=function(){return new C("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(x,z){"use strict";function C(L,U,Z,W){I.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=U,this.zipPlatform=Z,this.encodeFileName=W,this.streamFiles=L,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}var E=x("../utils"),I=x("../stream/GenericWorker"),O=x("../utf8"),A=x("../crc32"),B=x("../signature"),R=function(L,U){var Z="",W;for(W=0;W<U;W++)Z+=String.fromCharCode(255&L),L>>>=8;return Z},T=function(L,U){var Z=L;return L||(Z=U?16893:33204),(65535&Z)<<16},D=function(L){return 63&(L||0)},F=function(L,U,Z,W,M,H){var G=L.file,K=L.compression,Y=H!==O.utf8encode,X=E.transformTo("string",H(G.name)),V=E.transformTo("string",O.utf8encode(G.name)),J=G.comment,Q=E.transformTo("string",H(J)),$=E.transformTo("string",O.utf8encode(J)),ee=V.length!==G.name.length,te=$.length!==J.length,ne="",se="",ie="",oe=G.dir,de=G.date,re,ae,le={crc32:0,compressedSize:0,uncompressedSize:0};(!U||Z)&&(le.crc32=L.crc32,le.compressedSize=L.compressedSize,le.uncompressedSize=L.uncompressedSize);var ue=0;U&&(ue|=8),!Y&&(ee||te)&&(ue|=2048);var pe=0,ce=0;oe&&(pe|=16),"UNIX"===M?(ce=798,pe|=T(G.unixPermissions,oe)):(ce=20,pe|=D(G.dosPermissions,oe)),re=de.getUTCHours(),re<<=6,re|=de.getUTCMinutes(),re<<=5,re|=de.getUTCSeconds()/2,ae=de.getUTCFullYear()-1980,ae<<=4,ae|=de.getUTCMonth()+1,ae<<=5,ae|=de.getUTCDate(),ee&&(se=R(1,1)+R(A(X),4)+V,ne+="up"+R(se.length,2)+se),te&&(ie=R(1,1)+R(A(Q),4)+$,ne+="uc"+R(ie.length,2)+ie);var he="";he+="\n\0",he+=R(ue,2),he+=K.magic,he+=R(re,2),he+=R(ae,2),he+=R(le.crc32,4),he+=R(le.compressedSize,4),he+=R(le.uncompressedSize,4),he+=R(X.length,2),he+=R(ne.length,2);var fe=B.LOCAL_FILE_HEADER+he+X+ne,_e=B.CENTRAL_FILE_HEADER+R(ce,2)+he+R(Q.length,2)+"\0\0\0\0"+R(pe,4)+R(W,4)+X+ne+Q;return{fileRecord:fe,dirRecord:_e}},N=function(L,U,Z,W,M){var H="",G=E.transformTo("string",M(W));return H=B.CENTRAL_DIRECTORY_END+"\0\0\0\0"+R(L,2)+R(L,2)+R(U,4)+R(Z,4)+R(G.length,2)+G,H},P=function(L){var U="";return U=B.DATA_DESCRIPTOR+R(L.crc32,4)+R(L.compressedSize,4)+R(L.uncompressedSize,4),U};E.inherits(C,I),C.prototype.push=function(L){var U=L.meta.percent||0,Z=this.entriesCount,W=this._sources.length;this.accumulate?this.contentBuffer.push(L):(this.bytesWritten+=L.data.length,I.prototype.push.call(this,{data:L.data,meta:{currentFile:this.currentFile,percent:Z?(U+100*(Z-W-1))/Z:100}}))},C.prototype.openedSource=function(L){this.currentSourceOffset=this.bytesWritten,this.currentFile=L.file.name;var U=this.streamFiles&&!L.file.dir;if(U){var Z=F(L,U,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:Z.fileRecord,meta:{percent:0}})}else this.accumulate=!0},C.prototype.closedSource=function(L){this.accumulate=!1;var U=this.streamFiles&&!L.file.dir,Z=F(L,U,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(Z.dirRecord),U)this.push({data:P(L),meta:{percent:100}});else for(this.push({data:Z.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},C.prototype.flush=function(){for(var L=this.bytesWritten,U=0;U<this.dirRecords.length;U++)this.push({data:this.dirRecords[U],meta:{percent:100}});var Z=this.bytesWritten-L,W=N(this.dirRecords.length,Z,L,this.zipComment,this.encodeFileName);this.push({data:W,meta:{percent:100}})},C.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},C.prototype.registerPrevious=function(L){this._sources.push(L);var U=this;return L.on("data",function(Z){U.processChunk(Z)}),L.on("end",function(){U.closedSource(U.previous.streamInfo),U._sources.length?U.prepareNextSource():U.end()}),L.on("error",function(Z){U.error(Z)}),this},C.prototype.resume=function(){return!!I.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},C.prototype.error=function(L){var U=this._sources;if(!I.prototype.error.call(this,L))return!1;for(var Z=0;Z<U.length;Z++)try{U[Z].error(L)}catch(W){}return!0},C.prototype.lock=function(){I.prototype.lock.call(this);for(var L=this._sources,U=0;U<L.length;U++)L[U].lock()},z.exports=C},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(x,z,S){"use strict";var C=x("../compressions"),E=x("./ZipFileWorker"),I=function(O,A){var B=O||A,R=C[B];if(!R)throw new Error(B+" is not a valid compression method !");return R};S.generateWorker=function(O,A,B){var R=new E(A.streamFiles,B,A.platform,A.encodeFileName),T=0;try{O.forEach(function(D,F){T++;var N=I(F.options.compression,A.compression),P=F.options.compressionOptions||A.compressionOptions||{},L=F.dir,U=F.date;F._compressWorker(N,P).withStreamInfo("file",{name:D,dir:L,date:U,comment:F.comment||"",unixPermissions:F.unixPermissions,dosPermissions:F.dosPermissions}).pipe(R)}),R.entriesCount=T}catch(D){R.error(D)}return R}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(x,z){"use strict";function C(){if(!(this instanceof C))return new C;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var E=new C;for(var I in this)"function"!=typeof this[I]&&(E[I]=this[I]);return E}}C.prototype=x("./object"),C.prototype.loadAsync=x("./load"),C.support=x("./support"),C.defaults=x("./defaults"),C.version="3.5.0",C.loadAsync=function(E,I){return new C().loadAsync(E,I)},C.external=x("./external"),z.exports=C},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(x,z){"use strict";function C(T){return new I.Promise(function(D,F){var N=T.decompressed.getContentWorker().pipe(new B);N.on("error",function(P){F(P)}).on("end",function(){N.streamInfo.crc32===T.decompressed.crc32?D():F(new Error("Corrupted zip : CRC32 mismatch"))}).resume()})}var E=x("./utils"),I=x("./external"),O=x("./utf8"),E=x("./utils"),A=x("./zipEntries"),B=x("./stream/Crc32Probe"),R=x("./nodejsUtils");z.exports=function(T,D){var F=this;return D=E.extend(D||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:O.utf8decode}),R.isNode&&R.isStream(T)?I.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):E.prepareContent("the loaded zip file",T,!0,D.optimizedBinaryString,D.base64).then(function(N){var P=new A(D);return P.load(N),P}).then(function(P){var L=[I.Promise.resolve(P)],U=P.files;if(D.checkCRC32)for(var Z=0;Z<U.length;Z++)L.push(C(U[Z]));return I.Promise.all(L)}).then(function(P){for(var L=P.shift(),U=L.files,Z=0,W;Z<U.length;Z++)W=U[Z],F.file(W.fileNameStr,W.decompressed,{binary:!0,optimizedBinaryString:!0,date:W.date,dir:W.dir,comment:W.fileCommentStr.length?W.fileCommentStr:null,unixPermissions:W.unixPermissions,dosPermissions:W.dosPermissions,createFolders:D.createFolders});return L.zipComment.length&&(F.comment=L.zipComment),F})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(x,z){"use strict";function C(O,A){I.call(this,"Nodejs stream input adapter for "+O),this._upstreamEnded=!1,this._bindStream(A)}var E=x("../utils"),I=x("../stream/GenericWorker");E.inherits(C,I),C.prototype._bindStream=function(O){var A=this;this._stream=O,O.pause(),O.on("data",function(B){A.push({data:B,meta:{percent:0}})}).on("error",function(B){A.isPaused?this.generatedError=B:A.error(B)}).on("end",function(){A.isPaused?A._upstreamEnded=!0:A.end()})},C.prototype.pause=function(){return!!I.prototype.pause.call(this)&&(this._stream.pause(),!0)},C.prototype.resume=function(){return!!I.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},z.exports=C},{"../stream/GenericWorker":28,"../utils":32}],13:[function(x,z){"use strict";function C(O,A,B){E.call(this,A),this._helper=O;var R=this;O.on("data",function(T,D){R.push(T)||R._helper.pause(),B&&B(D)}).on("error",function(T){R.emit("error",T)}).on("end",function(){R.push(null)})}var E=x("readable-stream").Readable,I=x("../utils");I.inherits(C,E),C.prototype._read=function(){this._helper.resume()},z.exports=C},{"../utils":32,"readable-stream":16}],14:[function(x,z){"use strict";z.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(C,E){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(C,E);if("number"==typeof C)throw new Error("The \"data\" argument must not be a number");return new Buffer(C,E)},allocBuffer:function(C){if(Buffer.alloc)return Buffer.alloc(C);var E=new Buffer(C);return E.fill(0),E},isBuffer:function(C){return Buffer.isBuffer(C)},isStream:function(C){return C&&"function"==typeof C.on&&"function"==typeof C.pause&&"function"==typeof C.resume}}},{}],15:[function(x,z){"use strict";function C(M){return"[object RegExp]"===Object.prototype.toString.call(M)}var E=x("./utf8"),I=x("./utils"),O=x("./stream/GenericWorker"),A=x("./stream/StreamHelper"),B=x("./defaults"),R=x("./compressedObject"),T=x("./zipObject"),D=x("./generate"),F=x("./nodejsUtils"),N=x("./nodejs/NodejsStreamInputAdapter"),P=function(M,H,G){var K=I.getTypeOf(H),Y,X=I.extend(G||{},B);X.date=X.date||new Date,null!==X.compression&&(X.compression=X.compression.toUpperCase()),"string"==typeof X.unixPermissions&&(X.unixPermissions=parseInt(X.unixPermissions,8)),X.unixPermissions&&16384&X.unixPermissions&&(X.dir=!0),X.dosPermissions&&16&X.dosPermissions&&(X.dir=!0),X.dir&&(M=U(M)),X.createFolders&&(Y=L(M))&&Z.call(this,Y,!0);var V="string"===K&&!1===X.binary&&!1===X.base64;G&&"undefined"!=typeof G.binary||(X.binary=!V);var J=H instanceof R&&0===H.uncompressedSize;(J||X.dir||!H||0===H.length)&&(X.base64=!1,X.binary=!0,H="",X.compression="STORE",K="string");var Q=null;Q=H instanceof R||H instanceof O?H:F.isNode&&F.isStream(H)?new N(M,H):I.prepareContent(M,H,X.binary,X.optimizedBinaryString,X.base64);var $=new T(M,Q,X);this.files[M]=$},L=function(M){"/"===M.slice(-1)&&(M=M.substring(0,M.length-1));var H=M.lastIndexOf("/");return 0<H?M.substring(0,H):""},U=function(M){return"/"!==M.slice(-1)&&(M+="/"),M},Z=function(M,H){return H="undefined"==typeof H?B.createFolders:H,M=U(M),this.files[M]||P.call(this,M,null,{dir:!0,createFolders:H}),this.files[M]};z.exports={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(M){var H,G,K;for(H in this.files)this.files.hasOwnProperty(H)&&(K=this.files[H],G=H.slice(this.root.length,H.length),G&&H.slice(0,this.root.length)===this.root&&M(G,K))},filter:function(M){var H=[];return this.forEach(function(G,K){M(G,K)&&H.push(K)}),H},file:function(M,H,G){if(1===arguments.length){if(C(M)){var K=M;return this.filter(function(X,V){return!V.dir&&K.test(X)})}var Y=this.files[this.root+M];return Y&&!Y.dir?Y:null}return M=this.root+M,P.call(this,M,H,G),this},folder:function(M){if(!M)return this;if(C(M))return this.filter(function(Y,X){return X.dir&&M.test(Y)});var H=this.root+M,G=Z.call(this,H),K=this.clone();return K.root=G.name,K},remove:function(M){M=this.root+M;var H=this.files[M];if(H||("/"!==M.slice(-1)&&(M+="/"),H=this.files[M]),H&&!H.dir)delete this.files[M];else for(var G=this.filter(function(Y,X){return X.name.slice(0,M.length)===M}),K=0;K<G.length;K++)delete this.files[G[K].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(M){var G={},H;try{if(G=I.extend(M||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:E.utf8encode}),G.type=G.type.toLowerCase(),G.compression=G.compression.toUpperCase(),"binarystring"===G.type&&(G.type="string"),!G.type)throw new Error("No output type specified.");I.checkSupport(G.type),("darwin"===G.platform||"freebsd"===G.platform||"linux"===G.platform||"sunos"===G.platform)&&(G.platform="UNIX"),"win32"===G.platform&&(G.platform="DOS");var K=G.comment||this.comment||"";H=D.generateWorker(this,G,K)}catch(Y){H=new O("error"),H.error(Y)}return new A(H,G.type||"string",G.mimeType)},generateAsync:function(M,H){return this.generateInternalStream(M).accumulate(H)},generateNodeStream:function(M,H){return M=M||{},M.type||(M.type="nodebuffer"),this.generateInternalStream(M).toNodejsStream(H)}}},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(x,z){z.exports=x("stream")},{stream:void 0}],17:[function(x,z){"use strict";function C(O){E.call(this,O);for(var A=0;A<this.data.length;A++)O[A]&=255}var E=x("./DataReader"),I=x("../utils");I.inherits(C,E),C.prototype.byteAt=function(O){return this.data[this.zero+O]},C.prototype.lastIndexOfSignature=function(O){for(var A=O.charCodeAt(0),B=O.charCodeAt(1),R=O.charCodeAt(2),T=O.charCodeAt(3),D=this.length-4;0<=D;--D)if(this.data[D]===A&&this.data[D+1]===B&&this.data[D+2]===R&&this.data[D+3]===T)return D-this.zero;return-1},C.prototype.readAndCheckSignature=function(O){var A=O.charCodeAt(0),B=O.charCodeAt(1),R=O.charCodeAt(2),T=O.charCodeAt(3),D=this.readData(4);return A===D[0]&&B===D[1]&&R===D[2]&&T===D[3]},C.prototype.readData=function(O){if(this.checkOffset(O),0===O)return[];var A=this.data.slice(this.zero+this.index,this.zero+this.index+O);return this.index+=O,A},z.exports=C},{"../utils":32,"./DataReader":18}],18:[function(x,z){"use strict";function C(I){this.data=I,this.length=I.length,this.index=0,this.zero=0}var E=x("../utils");C.prototype={checkOffset:function(I){this.checkIndex(this.index+I)},checkIndex:function(I){if(this.length<this.zero+I||0>I)throw new Error("End of data reached (data length = "+this.length+", asked index = "+I+"). Corrupted zip ?")},setIndex:function(I){this.checkIndex(I),this.index=I},skip:function(I){this.setIndex(this.index+I)},byteAt:function(){},readInt:function(I){var O=0,A;for(this.checkOffset(I),A=this.index+I-1;A>=this.index;A--)O=(O<<8)+this.byteAt(A);return this.index+=I,O},readString:function(I){return E.transformTo("string",this.readData(I))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var I=this.readInt(4);return new Date(Date.UTC((127&I>>25)+1980,(15&I>>21)-1,31&I>>16,31&I>>11,63&I>>5,(31&I)<<1))}},z.exports=C},{"../utils":32}],19:[function(x,z){"use strict";function C(O){E.call(this,O)}var E=x("./Uint8ArrayReader"),I=x("../utils");I.inherits(C,E),C.prototype.readData=function(O){this.checkOffset(O);var A=this.data.slice(this.zero+this.index,this.zero+this.index+O);return this.index+=O,A},z.exports=C},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(x,z){"use strict";function C(O){E.call(this,O)}var E=x("./DataReader"),I=x("../utils");I.inherits(C,E),C.prototype.byteAt=function(O){return this.data.charCodeAt(this.zero+O)},C.prototype.lastIndexOfSignature=function(O){return this.data.lastIndexOf(O)-this.zero},C.prototype.readAndCheckSignature=function(O){var A=this.readData(4);return O===A},C.prototype.readData=function(O){this.checkOffset(O);var A=this.data.slice(this.zero+this.index,this.zero+this.index+O);return this.index+=O,A},z.exports=C},{"../utils":32,"./DataReader":18}],21:[function(x,z){"use strict";function C(O){E.call(this,O)}var E=x("./ArrayReader"),I=x("../utils");I.inherits(C,E),C.prototype.readData=function(O){if(this.checkOffset(O),0===O)return new Uint8Array(0);var A=this.data.subarray(this.zero+this.index,this.zero+this.index+O);return this.index+=O,A},z.exports=C},{"../utils":32,"./ArrayReader":17}],22:[function(x,z){"use strict";var C=x("../utils"),E=x("../support"),I=x("./ArrayReader"),O=x("./StringReader"),A=x("./NodeBufferReader"),B=x("./Uint8ArrayReader");z.exports=function(R){var T=C.getTypeOf(R);return C.checkSupport(T),"string"!==T||E.uint8array?"nodebuffer"===T?new A(R):E.uint8array?new B(C.transformTo("uint8array",R)):new I(C.transformTo("array",R)):new O(R)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(x,z,S){"use strict";S.LOCAL_FILE_HEADER="PK\x03\x04",S.CENTRAL_FILE_HEADER="PK\x01\x02",S.CENTRAL_DIRECTORY_END="PK\x05\x06",S.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x06\x07",S.ZIP64_CENTRAL_DIRECTORY_END="PK\x06\x06",S.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(x,z){"use strict";function C(O){E.call(this,"ConvertWorker to "+O),this.destType=O}var E=x("./GenericWorker"),I=x("../utils");I.inherits(C,E),C.prototype.processChunk=function(O){this.push({data:I.transformTo(this.destType,O.data),meta:O.meta})},z.exports=C},{"../utils":32,"./GenericWorker":28}],25:[function(x,z){"use strict";function C(){E.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}var E=x("./GenericWorker"),I=x("../crc32"),O=x("../utils");O.inherits(C,E),C.prototype.processChunk=function(A){this.streamInfo.crc32=I(A.data,this.streamInfo.crc32||0),this.push(A)},z.exports=C},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(x,z){"use strict";function C(O){I.call(this,"DataLengthProbe for "+O),this.propName=O,this.withStreamInfo(O,0)}var E=x("../utils"),I=x("./GenericWorker");E.inherits(C,I),C.prototype.processChunk=function(O){if(O){var A=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=A+O.data.length}I.prototype.processChunk.call(this,O)},z.exports=C},{"../utils":32,"./GenericWorker":28}],27:[function(x,z){"use strict";function C(A){I.call(this,"DataWorker");var B=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,A.then(function(R){B.dataIsReady=!0,B.data=R,B.max=R&&R.length||0,B.type=E.getTypeOf(R),B.isPaused||B._tickAndRepeat()},function(R){B.error(R)})}var E=x("../utils"),I=x("./GenericWorker");E.inherits(C,I),C.prototype.cleanUp=function(){I.prototype.cleanUp.call(this),this.data=null},C.prototype.resume=function(){return!!I.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,E.delay(this._tickAndRepeat,[],this)),!0)},C.prototype._tickAndRepeat=function(){this._tickScheduled=!1;this.isPaused||this.isFinished||(this._tick(),!this.isFinished&&(E.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},C.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var B=null,R=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":B=this.data.substring(this.index,R);break;case"uint8array":B=this.data.subarray(this.index,R);break;case"array":case"nodebuffer":B=this.data.slice(this.index,R);}return this.index=R,this.push({data:B,meta:{percent:this.max?100*(this.index/this.max):0}})},z.exports=C},{"../utils":32,"./GenericWorker":28}],28:[function(x,z){"use strict";function C(E){this.name=E||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}C.prototype={push:function(E){this.emit("data",E)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(E){this.emit("error",E)}return!0},error:function(E){return!this.isFinished&&(this.isPaused?this.generatedError=E:(this.isFinished=!0,this.emit("error",E),this.previous&&this.previous.error(E),this.cleanUp()),!0)},on:function(E,I){return this._listeners[E].push(I),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(E,I){if(this._listeners[E])for(var O=0;O<this._listeners[E].length;O++)this._listeners[E][O].call(this,I)},pipe:function(E){return E.registerPrevious(this)},registerPrevious:function(E){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=E.streamInfo,this.mergeStreamInfo(),this.previous=E;var I=this;return E.on("data",function(O){I.processChunk(O)}),E.on("end",function(){I.end()}),E.on("error",function(O){I.error(O)}),this},pause:function(){return this.isPaused||this.isFinished?!1:(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var E=!1;return this.generatedError&&(this.error(this.generatedError),E=!0),this.previous&&this.previous.resume(),!E},flush:function(){},processChunk:function(E){this.push(E)},withStreamInfo:function(E,I){return this.extraStreamInfo[E]=I,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var E in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(E)&&(this.streamInfo[E]=this.extraStreamInfo[E])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var E="Worker "+this.name;return this.previous?this.previous+" -> "+E:E}},z.exports=C},{}],29:[function(x,z){"use strict";function C(P,L,U){return"blob"===P?A.newBlob(A.transformTo("arraybuffer",L),U):"base64"===P?T.encode(L):A.transformTo(P,L)}function E(P,L){var Z=0,W=null,M=0,U;for(U=0;U<L.length;U++)M+=L[U].length;switch(P){case"string":return L.join("");case"array":return Array.prototype.concat.apply([],L);case"uint8array":for(W=new Uint8Array(M),U=0;U<L.length;U++)W.set(L[U],Z),Z+=L[U].length;return W;case"nodebuffer":return Buffer.concat(L);default:throw new Error("concat : unsupported type '"+P+"'");}}function I(P,L){return new F.Promise(function(U,Z){var W=[],M=P._internalType,H=P._outputType,G=P._mimeType;P.on("data",function(K,Y){W.push(K),L&&L(Y)}).on("error",function(K){W=[],Z(K)}).on("end",function(){try{var K=C(H,E(M,W),G);U(K)}catch(Y){Z(Y)}W=[]}).resume()})}function O(P,L,U){var Z=L;"blob"===L||"arraybuffer"===L?Z="uint8array":"base64"===L?Z="string":void 0;try{this._internalType=Z,this._outputType=L,this._mimeType=U,A.checkSupport(Z),this._worker=P.pipe(new B(Z)),P.lock()}catch(W){this._worker=new R("error"),this._worker.error(W)}}var A=x("../utils"),B=x("./ConvertWorker"),R=x("./GenericWorker"),T=x("../base64"),D=x("../support"),F=x("../external"),N=null;if(D.nodestream)try{N=x("../nodejs/NodejsStreamOutputAdapter")}catch(P){}O.prototype={accumulate:function(P){return I(this,P)},on:function(P,L){var U=this;return"data"===P?this._worker.on(P,function(Z){L.call(U,Z.data,Z.meta)}):this._worker.on(P,function(){A.delay(L,arguments,U)}),this},resume:function(){return A.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(P){if(A.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new N(this,{objectMode:"nodebuffer"!==this._outputType},P)}},z.exports=O},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(x,z,S){"use strict";if(S.base64=!0,S.array=!0,S.string=!0,S.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,S.nodebuffer="undefined"!=typeof Buffer,S.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)S.blob=!1;else{var C=new ArrayBuffer(0);try{S.blob=0===new Blob([C],{type:"application/zip"}).size}catch(O){try{var E=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,I=new E;I.append(C),S.blob=0===I.getBlob("application/zip").size}catch(A){S.blob=!1}}}try{S.nodestream=!!x("readable-stream").Readable}catch(O){S.nodestream=!1}},{"readable-stream":16}],31:[function(x,z,S){"use strict";function C(){B.call(this,"utf-8 decode"),this.leftOver=null}function E(){B.call(this,"utf-8 encode")}for(var I=x("./utils"),O=x("./support"),A=x("./nodejsUtils"),B=x("./stream/GenericWorker"),R=Array(256),T=0;256>T;T++)R[T]=252<=T?6:248<=T?5:240<=T?4:224<=T?3:192<=T?2:1;R[254]=R[254]=1;var D=function(P){var H=P.length,G=0,L,U,Z,W,M;for(W=0;W<H;W++)U=P.charCodeAt(W),55296==(64512&U)&&W+1<H&&(Z=P.charCodeAt(W+1),56320==(64512&Z)&&(U=65536+(U-55296<<10)+(Z-56320),W++)),G+=128>U?1:2048>U?2:65536>U?3:4;for(L=O.uint8array?new Uint8Array(G):Array(G),M=0,W=0;M<G;W++)U=P.charCodeAt(W),55296==(64512&U)&&W+1<H&&(Z=P.charCodeAt(W+1),56320==(64512&Z)&&(U=65536+(U-55296<<10)+(Z-56320),W++)),128>U?L[M++]=U:2048>U?(L[M++]=192|U>>>6,L[M++]=128|63&U):65536>U?(L[M++]=224|U>>>12,L[M++]=128|63&U>>>6,L[M++]=128|63&U):(L[M++]=240|U>>>18,L[M++]=128|63&U>>>12,L[M++]=128|63&U>>>6,L[M++]=128|63&U);return L},F=function(P,L){var U;for(L=L||P.length,L>P.length&&(L=P.length),U=L-1;0<=U&&128==(192&P[U]);)U--;return 0>U?L:0===U?L:U+R[P[U]]>L?U:L},N=function(P){var H=P.length,G=Array(2*H),U,Z,W,M;for(Z=0,U=0;U<H;){if(W=P[U++],128>W){G[Z++]=W;continue}if(M=R[W],4<M){G[Z++]=65533,U+=M-1;continue}for(W&=2===M?31:3===M?15:7;1<M&&U<H;)W=W<<6|63&P[U++],M--;if(1<M){G[Z++]=65533;continue}65536>W?G[Z++]=W:(W-=65536,G[Z++]=55296|1023&W>>10,G[Z++]=56320|1023&W)}return G.length!==Z&&(G.subarray?G=G.subarray(0,Z):G.length=Z),I.applyFromCharCode(G)};S.utf8encode=function(L){return O.nodebuffer?A.newBufferFrom(L,"utf-8"):D(L)},S.utf8decode=function(L){return O.nodebuffer?I.transformTo("nodebuffer",L).toString("utf-8"):(L=I.transformTo(O.uint8array?"uint8array":"array",L),N(L))},I.inherits(C,B),C.prototype.processChunk=function(P){var L=I.transformTo(O.uint8array?"uint8array":"array",P.data);if(this.leftOver&&this.leftOver.length){if(O.uint8array){var U=L;L=new Uint8Array(U.length+this.leftOver.length),L.set(this.leftOver,0),L.set(U,this.leftOver.length)}else L=this.leftOver.concat(L);this.leftOver=null}var Z=F(L),W=L;Z!==L.length&&(O.uint8array?(W=L.subarray(0,Z),this.leftOver=L.subarray(Z,L.length)):(W=L.slice(0,Z),this.leftOver=L.slice(Z,L.length))),this.push({data:S.utf8decode(W),meta:P.meta})},C.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:S.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},S.Utf8DecodeWorker=C,I.inherits(E,B),E.prototype.processChunk=function(P){this.push({data:S.utf8encode(P.data),meta:P.meta})},S.Utf8EncodeWorker=E},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(x,z,S){"use strict";function C(L){var U=null;return U=B.uint8array?new Uint8Array(L.length):Array(L.length),I(L,U)}function E(L){return L}function I(L,U){for(var Z=0;Z<L.length;++Z)U[Z]=255&L.charCodeAt(Z);return U}function O(L){var U=65536,Z=S.getTypeOf(L),W=!0;if("uint8array"===Z?W=N.applyCanBeUsed.uint8array:"nodebuffer"===Z&&(W=N.applyCanBeUsed.nodebuffer),W)for(;1<U;)try{return N.stringifyByChunk(L,Z,U)}catch(M){U=Math.floor(U/2)}return N.stringifyByChar(L)}function A(L,U){for(var Z=0;Z<L.length;Z++)U[Z]=L[Z];return U}var B=x("./support"),R=x("./base64"),T=x("./nodejsUtils"),D=x("set-immediate-shim"),F=x("./external");S.newBlob=function(L,U){S.checkSupport("blob");try{return new Blob([L],{type:U})}catch(M){try{var Z=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,W=new Z;return W.append(L),W.getBlob(U)}catch(H){throw new Error("Bug : can't construct the Blob.")}}};var N={stringifyByChunk:function(L,U,Z){var W=[],M=0,H=L.length;if(H<=Z)return String.fromCharCode.apply(null,L);for(;M<H;)"array"===U||"nodebuffer"===U?W.push(String.fromCharCode.apply(null,L.slice(M,Math.min(M+Z,H)))):W.push(String.fromCharCode.apply(null,L.subarray(M,Math.min(M+Z,H)))),M+=Z;return W.join("")},stringifyByChar:function(L){for(var U="",Z=0;Z<L.length;Z++)U+=String.fromCharCode(L[Z]);return U},applyCanBeUsed:{uint8array:function(){try{return B.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(L){return!1}}(),nodebuffer:function(){try{return B.nodebuffer&&1===String.fromCharCode.apply(null,T.allocBuffer(1)).length}catch(L){return!1}}()}};S.applyFromCharCode=O;var P={};P.string={string:E,array:function(L){return I(L,Array(L.length))},arraybuffer:function(L){return P.string.uint8array(L).buffer},uint8array:function(L){return I(L,new Uint8Array(L.length))},nodebuffer:function(L){return I(L,T.allocBuffer(L.length))}},P.array={string:O,array:E,arraybuffer:function(L){return new Uint8Array(L).buffer},uint8array:function(L){return new Uint8Array(L)},nodebuffer:function(L){return T.newBufferFrom(L)}},P.arraybuffer={string:function(L){return O(new Uint8Array(L))},array:function(L){return A(new Uint8Array(L),Array(L.byteLength))},arraybuffer:E,uint8array:function(L){return new Uint8Array(L)},nodebuffer:function(L){return T.newBufferFrom(new Uint8Array(L))}},P.uint8array={string:O,array:function(L){return A(L,Array(L.length))},arraybuffer:function(L){return L.buffer},uint8array:E,nodebuffer:function(L){return T.newBufferFrom(L)}},P.nodebuffer={string:O,array:function(L){return A(L,Array(L.length))},arraybuffer:function(L){return P.nodebuffer.uint8array(L).buffer},uint8array:function(L){return A(L,new Uint8Array(L.length))},nodebuffer:E},S.transformTo=function(L,U){if(U||(U=""),!L)return U;S.checkSupport(L);var Z=S.getTypeOf(U),W=P[Z][L](U);return W},S.getTypeOf=function(L){return"string"==typeof L?"string":"[object Array]"===Object.prototype.toString.call(L)?"array":B.nodebuffer&&T.isBuffer(L)?"nodebuffer":B.uint8array&&L instanceof Uint8Array?"uint8array":B.arraybuffer&&L instanceof ArrayBuffer?"arraybuffer":void 0},S.checkSupport=function(L){var U=B[L.toLowerCase()];if(!U)throw new Error(L+" is not supported by this platform")},S.MAX_VALUE_16BITS=65535,S.MAX_VALUE_32BITS=-1,S.pretty=function(L){var U="",Z,W;for(W=0;W<(L||"").length;W++)Z=L.charCodeAt(W),U+="\\x"+(16>Z?"0":"")+Z.toString(16).toUpperCase();return U},S.delay=function(){var L=webkit_electron_mode?U=>{setTimeout(U,0)}:D;return function(U,Z,W){L(function(){U.apply(W||null,Z||[])})}}(),S.inherits=function(L,U){var Z=function(){};Z.prototype=U.prototype,L.prototype=new Z},S.extend=function(){var L={},U,Z;for(U=0;U<arguments.length;U++)for(Z in arguments[U])arguments[U].hasOwnProperty(Z)&&"undefined"==typeof L[Z]&&(L[Z]=arguments[U][Z]);return L},S.prepareContent=function(L,U,Z,W,M){var H=F.Promise.resolve(U).then(function(G){var K=B.blob&&(G instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(G)));return K&&"undefined"!=typeof FileReader?new F.Promise(function(Y,X){var V=new FileReader;V.onload=function(J){Y(J.target.result)},V.onerror=function(J){X(J.target.error)},V.readAsArrayBuffer(G)}):G});return H.then(function(G){var K=S.getTypeOf(G);return K?("arraybuffer"===K?G=S.transformTo("uint8array",G):"string"===K&&(M?G=R.decode(G):Z&&!0!==W&&(G=C(G))),G):F.Promise.reject(new Error("Can't read the data of '"+L+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(x,z){"use strict";function C(T){this.files=[],this.loadOptions=T}var E=x("./reader/readerFor"),I=x("./utils"),O=x("./signature"),A=x("./zipEntry"),B=x("./utf8"),R=x("./support");C.prototype={checkSignature:function(T){if(!this.reader.readAndCheckSignature(T)){this.reader.index-=4;var D=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+I.pretty(D)+", expected "+I.pretty(T)+")")}},isSignature:function(T,D){var F=this.reader.index;this.reader.setIndex(T);var N=this.reader.readString(4);return this.reader.setIndex(F),N===D},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var T=this.reader.readData(this.zipCommentLength),D=R.uint8array?"uint8array":"array",F=I.transformTo(D,T);this.zipComment=this.loadOptions.decodeFileName(F)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var T=this.zip64EndOfCentralSize-44,F,N,P;0<T;)F=this.reader.readInt(2),N=this.reader.readInt(4),P=this.reader.readData(N),this.zip64ExtensibleData[F]={id:F,length:N,value:P}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var T,D;for(T=0;T<this.files.length;T++)D=this.files[T],this.reader.setIndex(D.localHeaderOffset),this.checkSignature(O.LOCAL_FILE_HEADER),D.readLocalPart(this.reader),D.handleUTF8(),D.processAttributes()},readCentralDir:function(){var T;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(O.CENTRAL_FILE_HEADER);)T=new A({zip64:this.zip64},this.loadOptions),T.readCentralPart(this.reader),this.files.push(T);if(this.centralDirRecords!==this.files.length)if(0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length);else;},readEndOfCentral:function(){var T=this.reader.lastIndexOfSignature(O.CENTRAL_DIRECTORY_END);if(0>T){var D=!this.isSignature(0,O.LOCAL_FILE_HEADER);if(D)throw new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");else throw new Error("Corrupted zip: can't find end of central directory")}this.reader.setIndex(T);var F=T;if(this.checkSignature(O.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===I.MAX_VALUE_16BITS||this.diskWithCentralDirStart===I.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===I.MAX_VALUE_16BITS||this.centralDirRecords===I.MAX_VALUE_16BITS||this.centralDirSize===I.MAX_VALUE_32BITS||this.centralDirOffset===I.MAX_VALUE_32BITS){if(this.zip64=!0,T=this.reader.lastIndexOfSignature(O.ZIP64_CENTRAL_DIRECTORY_LOCATOR),0>T)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(T),this.checkSignature(O.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,O.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(O.ZIP64_CENTRAL_DIRECTORY_END),0>this.relativeOffsetEndOfZip64CentralDir))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(O.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var N=this.centralDirOffset+this.centralDirSize;this.zip64&&(N+=20,N+=12+this.zip64EndOfCentralSize);var P=F-N;if(0<P)this.isSignature(F,O.CENTRAL_FILE_HEADER)||(this.reader.zero=P);else if(0>P)throw new Error("Corrupted zip: missing "+Math.abs(P)+" bytes.")},prepareReader:function(T){this.reader=E(T)},load:function(T){this.prepareReader(T),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},z.exports=C},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(x,z){"use strict";function C(P,L){this.options=P,this.loadOptions=L}var E=x("./reader/readerFor"),I=x("./utils"),O=x("./compressedObject"),A=x("./crc32"),B=x("./utf8"),R=x("./compressions"),T=x("./support"),N=function(P){for(var L in R)if(R.hasOwnProperty(L)&&R[L].magic===P)return R[L];return null};C.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(P){var L,U;if(P.skip(22),this.fileNameLength=P.readInt(2),U=P.readInt(2),this.fileName=P.readData(this.fileNameLength),P.skip(U),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(L=N(this.compressionMethod),null===L)throw new Error("Corrupted zip : compression "+I.pretty(this.compressionMethod)+" unknown (inner file : "+I.transformTo("string",this.fileName)+")");this.decompressed=new O(this.compressedSize,this.uncompressedSize,this.crc32,L,P.readData(this.compressedSize))},readCentralPart:function(P){this.versionMadeBy=P.readInt(2),P.skip(2),this.bitFlag=P.readInt(2),this.compressionMethod=P.readString(2),this.date=P.readDate(),this.crc32=P.readInt(4),this.compressedSize=P.readInt(4),this.uncompressedSize=P.readInt(4);var L=P.readInt(2);if(this.extraFieldsLength=P.readInt(2),this.fileCommentLength=P.readInt(2),this.diskNumberStart=P.readInt(2),this.internalFileAttributes=P.readInt(2),this.externalFileAttributes=P.readInt(4),this.localHeaderOffset=P.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");P.skip(L),this.readExtraFields(P),this.parseZIP64ExtraField(P),this.fileComment=P.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var P=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),P==0&&(this.dosPermissions=63&this.externalFileAttributes),P==3&&(this.unixPermissions=65535&this.externalFileAttributes>>16),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var L=E(this.extraFields[1].value);this.uncompressedSize===I.MAX_VALUE_32BITS&&(this.uncompressedSize=L.readInt(8)),this.compressedSize===I.MAX_VALUE_32BITS&&(this.compressedSize=L.readInt(8)),this.localHeaderOffset===I.MAX_VALUE_32BITS&&(this.localHeaderOffset=L.readInt(8)),this.diskNumberStart===I.MAX_VALUE_32BITS&&(this.diskNumberStart=L.readInt(4))}},readExtraFields:function(P){var L=P.index+this.extraFieldsLength,U,Z,W;for(this.extraFields||(this.extraFields={});P.index+4<L;)U=P.readInt(2),Z=P.readInt(2),W=P.readData(Z),this.extraFields[U]={id:U,length:Z,value:W};P.setIndex(L)},handleUTF8:function(){var P=T.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=B.utf8decode(this.fileName),this.fileCommentStr=B.utf8decode(this.fileComment);else{var L=this.findExtraFieldUnicodePath();if(null!==L)this.fileNameStr=L;else{var U=I.transformTo(P,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(U)}var Z=this.findExtraFieldUnicodeComment();if(null!==Z)this.fileCommentStr=Z;else{var W=I.transformTo(P,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(W)}}},findExtraFieldUnicodePath:function(){var P=this.extraFields[28789];if(P){var L=E(P.value);return 1===L.readInt(1)?A(this.fileName)===L.readInt(4)?B.utf8decode(L.readData(P.length-5)):null:null}return null},findExtraFieldUnicodeComment:function(){var P=this.extraFields[25461];if(P){var L=E(P.value);return 1===L.readInt(1)?A(this.fileComment)===L.readInt(4)?B.utf8decode(L.readData(P.length-5)):null:null}return null}},z.exports=C},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(x,z){"use strict";var C=x("./stream/StreamHelper"),E=x("./stream/DataWorker"),I=x("./utf8"),O=x("./compressedObject"),A=x("./stream/GenericWorker"),B=function(F,N,P){this.name=F,this.dir=P.dir,this.date=P.date,this.comment=P.comment,this.unixPermissions=P.unixPermissions,this.dosPermissions=P.dosPermissions,this._data=N,this._dataBinary=P.binary,this.options={compression:P.compression,compressionOptions:P.compressionOptions}};B.prototype={internalStream:function(F){var N=null,P="string";try{if(!F)throw new Error("No output type specified.");P=F.toLowerCase();var L="string"==P||"text"==P;("binarystring"==P||"text"==P)&&(P="string"),N=this._decompressWorker();var U=!this._dataBinary;U&&!L&&(N=N.pipe(new I.Utf8EncodeWorker)),!U&&L&&(N=N.pipe(new I.Utf8DecodeWorker))}catch(Z){N=new A("error"),N.error(Z)}return new C(N,P,"")},async:function(F,N){return this.internalStream(F).accumulate(N)},nodeStream:function(F,N){return this.internalStream(F||"nodebuffer").toNodejsStream(N)},_compressWorker:function(F,N){if(this._data instanceof O&&this._data.compression.magic===F.magic)return this._data.getCompressedWorker();var P=this._decompressWorker();return this._dataBinary||(P=P.pipe(new I.Utf8EncodeWorker)),O.createWorkerFrom(P,F,N)},_decompressWorker:function(){return this._data instanceof O?this._data.getContentWorker():this._data instanceof A?this._data:new E(this._data)}};for(var R=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],T=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},D=0;D<R.length;D++)B.prototype[R[D]]=T;z.exports=B},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(x,z){(function(C){"use strict";function E(){F=!0;for(var U=N.length,P,L;U;){for(L=N,N=[],P=-1;++P<U;)L[P]();U=N.length}F=!1}var O=C.MutationObserver||C.WebKitMutationObserver,A;if(O){var B=0,R=new O(E),T=C.document.createTextNode("");R.observe(T,{characterData:!0}),A=function(){T.data=B=++B%2}}else if(!C.setImmediate&&"undefined"!=typeof C.MessageChannel){var D=new C.MessageChannel;D.port1.onmessage=E,A=function(){D.port2.postMessage(0)}}else A="document"in C&&"onreadystatechange"in C.document.createElement("script")?function(){var P=C.document.createElement("script");P.onreadystatechange=function(){E(),P.onreadystatechange=null,P.parentNode.removeChild(P),P=null},C.document.documentElement.appendChild(P)}:function(){setTimeout(E,0)};var F,N=[];z.exports=function(P){1!==N.push(P)||F||A()}}).call(this,"undefined"==typeof global?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:global)},{}],37:[function(x,z){"use strict";function C(){}function E(M){if("function"!=typeof M)throw new TypeError("resolver must be a function");this.state=W,this.queue=[],this.outcome=void 0,M!==C&&B(this,M)}function I(M,H,G){this.promise=M,"function"==typeof H&&(this.onFulfilled=H,this.callFulfilled=this.otherCallFulfilled),"function"==typeof G&&(this.onRejected=G,this.callRejected=this.otherCallRejected)}function O(M,H,G){P(function(){var K;try{K=H(G)}catch(Y){return L.reject(M,Y)}K===M?L.reject(M,new TypeError("Cannot resolve promise with itself")):L.resolve(M,K)})}function A(M){var H=M&&M.then;if(M&&("object"==typeof M||"function"==typeof M)&&"function"==typeof H)return function(){H.apply(M,arguments)}}function B(M,H){function G(J){X||(X=!0,L.reject(M,J))}function K(J){X||(X=!0,L.resolve(M,J))}var X=!1,V=R(function(){H(K,G)});"error"===V.status&&G(V.value)}function R(M,H){var G={};try{G.value=M(H),G.status="success"}catch(K){G.status="error",G.value=K}return G}var P=x("immediate"),L={},U=["REJECTED"],Z=["FULFILLED"],W=["PENDING"];z.exports=E,E.prototype["finally"]=function(M){if("function"!=typeof M)return this;var K=this.constructor;return this.then(function(Y){return K.resolve(M()).then(function(){return Y})},function(Y){return K.resolve(M()).then(function(){throw Y})})},E.prototype["catch"]=function(M){return this.then(null,M)},E.prototype.then=function(M,H){if("function"!=typeof M&&this.state===Z||"function"!=typeof H&&this.state===U)return this;var G=new this.constructor(C);if(this.state!==W){var K=this.state===Z?M:H;O(G,K,this.outcome)}else this.queue.push(new I(G,M,H));return G},I.prototype.callFulfilled=function(M){L.resolve(this.promise,M)},I.prototype.otherCallFulfilled=function(M){O(this.promise,this.onFulfilled,M)},I.prototype.callRejected=function(M){L.reject(this.promise,M)},I.prototype.otherCallRejected=function(M){O(this.promise,this.onRejected,M)},L.resolve=function(M,H){var G=R(A,H);if("error"===G.status)return L.reject(M,G.value);var K=G.value;if(K)B(M,K);else{M.state=Z,M.outcome=H;for(var Y=-1,X=M.queue.length;++Y<X;)M.queue[Y].callFulfilled(H)}return M},L.reject=function(M,H){M.state=U,M.outcome=H;for(var G=-1,K=M.queue.length;++G<K;)M.queue[G].callRejected(H);return M},E.resolve=function(M){return M instanceof this?M:L.resolve(new this(C),M)},E.reject=function(M){var H=new this(C);return L.reject(H,M)},E.all=function(M){function H($,ee){G.resolve($).then(function(re){X[ee]=re,++V!==K||Y||(Y=!0,L.resolve(Q,X))},function(re){Y||(Y=!0,L.reject(Q,re))})}var G=this;if("[object Array]"!==Object.prototype.toString.call(M))return this.reject(new TypeError("must be an array"));var K=M.length,Y=!1;if(!K)return this.resolve([]);for(var X=Array(K),V=0,J=-1,Q=new this(C);++J<K;)H(M[J],J);return Q},E.race=function(M){function H(J){G.resolve(J).then(function(Q){Y||(Y=!0,L.resolve(V,Q))},function(Q){Y||(Y=!0,L.reject(V,Q))})}var G=this;if("[object Array]"!==Object.prototype.toString.call(M))return this.reject(new TypeError("must be an array"));var K=M.length,Y=!1;if(!K)return this.resolve([]);for(var X=-1,V=new this(C);++X<K;)H(M[X]);return V}},{immediate:36}],38:[function(x,z){"use strict";var C=x("./lib/utils/common").assign,E=x("./lib/deflate"),I=x("./lib/inflate"),O=x("./lib/zlib/constants"),A={};C(A,E,I,O),z.exports=A},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(x,z,S){"use strict";function C(G){if(!(this instanceof C))return new C(G);this.options=B.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},G||{});var K=this.options;K.raw&&0<K.windowBits?K.windowBits=-K.windowBits:K.gzip&&0<K.windowBits&&16>K.windowBits&&(K.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new D,this.strm.avail_out=0;var Y=A.deflateInit2(this.strm,K.level,K.method,K.windowBits,K.memLevel,K.strategy);if(Y!==L)throw new Error(T[Y]);if(K.header&&A.deflateSetHeader(this.strm,K.header),K.dictionary){var X;if(X="string"==typeof K.dictionary?R.string2buf(K.dictionary):"[object ArrayBuffer]"===F.call(K.dictionary)?new Uint8Array(K.dictionary):K.dictionary,Y=A.deflateSetDictionary(this.strm,X),Y!==L)throw new Error(T[Y]);this._dict_set=!0}}function E(G,K){var Y=new C(K);if(Y.push(G,!0),Y.err)throw Y.msg||T[Y.err];return Y.result}var A=x("./zlib/deflate"),B=x("./utils/common"),R=x("./utils/strings"),T=x("./zlib/messages"),D=x("./zlib/zstream"),F=Object.prototype.toString,P=4,L=0,U=1,Z=2;C.prototype.push=function(G,K){var Y=this.strm,X=this.options.chunkSize,V,J;if(this.ended)return!1;J=K===~~K?K:!0===K?P:0,Y.input="string"==typeof G?R.string2buf(G):"[object ArrayBuffer]"===F.call(G)?new Uint8Array(G):G,Y.next_in=0,Y.avail_in=Y.input.length;do{if(0===Y.avail_out&&(Y.output=new B.Buf8(X),Y.next_out=0,Y.avail_out=X),V=A.deflate(Y,J),V!==U&&V!==L)return this.onEnd(V),this.ended=!0,!1;(0===Y.avail_out||0===Y.avail_in&&(J===P||J===Z))&&("string"===this.options.to?this.onData(R.buf2binstring(B.shrinkBuf(Y.output,Y.next_out))):this.onData(B.shrinkBuf(Y.output,Y.next_out)))}while((0<Y.avail_in||0===Y.avail_out)&&V!==U);return J===P?(V=A.deflateEnd(this.strm),this.onEnd(V),this.ended=!0,V===L):J!==Z||(this.onEnd(L),Y.avail_out=0,!0)},C.prototype.onData=function(G){this.chunks.push(G)},C.prototype.onEnd=function(G){G===L&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=B.flattenChunks(this.chunks)),this.chunks=[],this.err=G,this.msg=this.strm.msg},S.Deflate=C,S.deflate=E,S.deflateRaw=function(G,K){return K=K||{},K.raw=!0,E(G,K)},S.gzip=function(G,K){return K=K||{},K.gzip=!0,E(G,K)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(x,z,S){"use strict";function C(P){if(!(this instanceof C))return new C(P);this.options=A.assign({chunkSize:16384,windowBits:0,to:""},P||{});var L=this.options;L.raw&&0<=L.windowBits&&16>L.windowBits&&(L.windowBits=-L.windowBits,0===L.windowBits&&(L.windowBits=-15)),0<=L.windowBits&&16>L.windowBits&&!(P&&P.windowBits)&&(L.windowBits+=32),15<L.windowBits&&48>L.windowBits&&0==(15&L.windowBits)&&(L.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new D,this.strm.avail_out=0;var U=O.inflateInit2(this.strm,L.windowBits);if(U!==R.Z_OK)throw new Error(T[U]);this.header=new F,O.inflateGetHeader(this.strm,this.header)}function E(P,L){var U=new C(L);if(U.push(P,!0),U.err)throw U.msg||T[U.err];return U.result}var O=x("./zlib/inflate"),A=x("./utils/common"),B=x("./utils/strings"),R=x("./zlib/constants"),T=x("./zlib/messages"),D=x("./zlib/zstream"),F=x("./zlib/gzheader"),N=Object.prototype.toString;C.prototype.push=function(P,L){var U=this.strm,Z=this.options.chunkSize,W=this.options.dictionary,V=!1,M,H,G,K,Y,X;if(this.ended)return!1;H=L===~~L?L:!0===L?R.Z_FINISH:R.Z_NO_FLUSH,U.input="string"==typeof P?B.binstring2buf(P):"[object ArrayBuffer]"===N.call(P)?new Uint8Array(P):P,U.next_in=0,U.avail_in=U.input.length;do{if(0===U.avail_out&&(U.output=new A.Buf8(Z),U.next_out=0,U.avail_out=Z),M=O.inflate(U,R.Z_NO_FLUSH),M===R.Z_NEED_DICT&&W&&(X="string"==typeof W?B.string2buf(W):"[object ArrayBuffer]"===N.call(W)?new Uint8Array(W):W,M=O.inflateSetDictionary(this.strm,X)),M===R.Z_BUF_ERROR&&!0==V&&(M=R.Z_OK,V=!1),M!==R.Z_STREAM_END&&M!==R.Z_OK)return this.onEnd(M),this.ended=!0,!1;U.next_out&&(0===U.avail_out||M===R.Z_STREAM_END||0===U.avail_in&&(H===R.Z_FINISH||H===R.Z_SYNC_FLUSH))&&("string"===this.options.to?(G=B.utf8border(U.output,U.next_out),K=U.next_out-G,Y=B.buf2string(U.output,G),U.next_out=K,U.avail_out=Z-K,K&&A.arraySet(U.output,U.output,G,K,0),this.onData(Y)):this.onData(A.shrinkBuf(U.output,U.next_out))),0===U.avail_in&&0===U.avail_out&&(V=!0)}while((0<U.avail_in||0===U.avail_out)&&M!==R.Z_STREAM_END);return M===R.Z_STREAM_END&&(H=R.Z_FINISH),H===R.Z_FINISH?(M=O.inflateEnd(this.strm),this.onEnd(M),this.ended=!0,M===R.Z_OK):H!==R.Z_SYNC_FLUSH||(this.onEnd(R.Z_OK),U.avail_out=0,!0)},C.prototype.onData=function(P){this.chunks.push(P)},C.prototype.onEnd=function(P){P===R.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=A.flattenChunks(this.chunks)),this.chunks=[],this.err=P,this.msg=this.strm.msg},S.Inflate=C,S.inflate=E,S.inflateRaw=function(P,L){return L=L||{},L.raw=!0,E(P,L)},S.ungzip=E},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(x,z,S){"use strict";var C="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;S.assign=function(O){for(var A=Array.prototype.slice.call(arguments,1),B;A.length;)if(B=A.shift(),!!B){if("object"!=typeof B)throw new TypeError(B+"must be non-object");for(var R in B)B.hasOwnProperty(R)&&(O[R]=B[R])}return O},S.shrinkBuf=function(O,A){return O.length===A?O:O.subarray?O.subarray(0,A):(O.length=A,O)};var E={arraySet:function(O,A,B,R,T){if(A.subarray&&O.subarray)return void O.set(A.subarray(B,B+R),T);for(var D=0;D<R;D++)O[T+D]=A[B+D]},flattenChunks:function(O){var A,B,R,T,D,F;for(R=0,A=0,B=O.length;A<B;A++)R+=O[A].length;for(F=new Uint8Array(R),T=0,(A=0,B=O.length);A<B;A++)D=O[A],F.set(D,T),T+=D.length;return F}},I={arraySet:function(O,A,B,R,T){for(var D=0;D<R;D++)O[T+D]=A[B+D]},flattenChunks:function(O){return[].concat.apply([],O)}};S.setTyped=function(O){O?(S.Buf8=Uint8Array,S.Buf16=Uint16Array,S.Buf32=Int32Array,S.assign(S,E)):(S.Buf8=Array,S.Buf16=Array,S.Buf32=Array,S.assign(S,I))},S.setTyped(C)},{}],42:[function(x,z,S){"use strict";function C(R,T){if(65537>T&&(R.subarray&&O||!R.subarray&&I))return String.fromCharCode.apply(null,E.shrinkBuf(R,T));for(var D="",F=0;F<T;F++)D+=String.fromCharCode(R[F]);return D}var E=x("./common"),I=!0,O=!0;try{String.fromCharCode.apply(null,[0])}catch(R){I=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(R){O=!1}for(var A=new E.Buf8(256),B=0;256>B;B++)A[B]=252<=B?6:248<=B?5:240<=B?4:224<=B?3:192<=B?2:1;A[254]=A[254]=1,S.string2buf=function(R){var L=R.length,U=0,T,D,F,N,P;for(N=0;N<L;N++)D=R.charCodeAt(N),55296==(64512&D)&&N+1<L&&(F=R.charCodeAt(N+1),56320==(64512&F)&&(D=65536+(D-55296<<10)+(F-56320),N++)),U+=128>D?1:2048>D?2:65536>D?3:4;for(T=new E.Buf8(U),P=0,N=0;P<U;N++)D=R.charCodeAt(N),55296==(64512&D)&&N+1<L&&(F=R.charCodeAt(N+1),56320==(64512&F)&&(D=65536+(D-55296<<10)+(F-56320),N++)),128>D?T[P++]=D:2048>D?(T[P++]=192|D>>>6,T[P++]=128|63&D):65536>D?(T[P++]=224|D>>>12,T[P++]=128|63&D>>>6,T[P++]=128|63&D):(T[P++]=240|D>>>18,T[P++]=128|63&D>>>12,T[P++]=128|63&D>>>6,T[P++]=128|63&D);return T},S.buf2binstring=function(R){return C(R,R.length)},S.binstring2buf=function(R){for(var T=new E.Buf8(R.length),D=0,F=T.length;D<F;D++)T[D]=R.charCodeAt(D);return T},S.buf2string=function(R,T){var D,F,N,P,L=T||R.length,U=Array(2*L);for(F=0,D=0;D<L;){if(N=R[D++],128>N){U[F++]=N;continue}if(P=A[N],4<P){U[F++]=65533,D+=P-1;continue}for(N&=2===P?31:3===P?15:7;1<P&&D<L;)N=N<<6|63&R[D++],P--;if(1<P){U[F++]=65533;continue}65536>N?U[F++]=N:(N-=65536,U[F++]=55296|1023&N>>10,U[F++]=56320|1023&N)}return C(U,F)},S.utf8border=function(R,T){var D;for(T=T||R.length,T>R.length&&(T=R.length),D=T-1;0<=D&&128==(192&R[D]);)D--;return 0>D?T:0===D?T:D+A[R[D]]>T?D:T}},{"./common":41}],43:[function(x,z){"use strict";z.exports=function(E,I,O,A){for(var B=0|65535&E,R=0|65535&E>>>16,T=0;0!==O;){T=2e3<O?2e3:O,O-=T;do B=0|B+I[A++],R=0|R+B;while(--T);B%=65521,R%=65521}return 0|(B|R<<16)}},{}],44:[function(x,z){"use strict";z.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(x,z){"use strict";var I=function(){for(var A=[],B=0,O;256>B;B++){O=B;for(var R=0;8>R;R++)O=1&O?3988292384^O>>>1:O>>>1;A[B]=O}return A}();z.exports=function(O,A,B,R){O^=-1;for(var F=R;F<R+B;F++)O=O>>>8^I[255&(O^A[F])];return-1^O}},{}],46:[function(x,z,S){"use strict";function C(qe,Qe){return qe.msg=ne[Qe],Qe}function E(qe){return(qe<<1)-(4<qe?9:0)}function I(qe){for(var Qe=qe.length;0<=--Qe;)qe[Qe]=0}function O(qe){var Qe=qe.state,$e=Qe.pending;$e>qe.avail_out&&($e=qe.avail_out);0===$e||(ee.arraySet(qe.output,Qe.pending_buf,Qe.pending_out,$e,qe.next_out),qe.next_out+=$e,Qe.pending_out+=$e,qe.total_out+=$e,qe.avail_out-=$e,Qe.pending-=$e,0===Qe.pending&&(Qe.pending_out=0))}function A(qe,Qe){te._tr_flush_block(qe,0<=qe.block_start?qe.block_start:-1,qe.strstart-qe.block_start,Qe),qe.block_start=qe.strstart,O(qe.strm)}function B(qe,Qe){qe.pending_buf[qe.pending++]=Qe}function R(qe,Qe){qe.pending_buf[qe.pending++]=255&Qe>>>8,qe.pending_buf[qe.pending++]=255&Qe}function T(qe,Qe,$e,et){var tt=qe.avail_in;return(tt>et&&(tt=et),0===tt)?0:(qe.avail_in-=tt,ee.arraySet(Qe,qe.input,qe.next_in,tt,$e),1===qe.state.wrap?qe.adler=re(qe.adler,Qe,tt,$e):2===qe.state.wrap&&(qe.adler=ae(qe.adler,Qe,tt,$e)),qe.next_in+=tt,qe.total_in+=tt,tt)}function D(qe,Qe){var $e=qe.max_chain_length,et=qe.strstart,tt,rt,at=qe.prev_length,nt=qe.nice_match,st=qe.strstart>qe.w_size-Ne?qe.strstart-(qe.w_size-Ne):0,it=qe.window,ot=qe.w_mask,dt=qe.prev,lt=qe.strstart+Fe,ut=it[et+at-1],pt=it[et+at];qe.prev_length>=qe.good_match&&($e>>=2),nt>qe.lookahead&&(nt=qe.lookahead);do{if(tt=Qe,it[tt+at]!==pt||it[tt+at-1]!==ut||it[tt]!==it[et]||it[++tt]!==it[et+1])continue;et+=2,tt++;do;while(it[++et]===it[++tt]&&it[++et]===it[++tt]&&it[++et]===it[++tt]&&it[++et]===it[++tt]&&it[++et]===it[++tt]&&it[++et]===it[++tt]&&it[++et]===it[++tt]&&it[++et]===it[++tt]&&et<lt);if(rt=Fe-(lt-et),et=lt-Fe,rt>at){if(qe.match_start=Qe,at=rt,rt>=nt)break;ut=it[et+at-1],pt=it[et+at]}}while((Qe=dt[Qe&ot])>st&&0!=--$e);return at<=qe.lookahead?at:qe.lookahead}function F(qe){var Qe=qe.w_size,$e,et,tt,rt,at;do{if(rt=qe.window_size-qe.lookahead-qe.strstart,qe.strstart>=Qe+(Qe-Ne)){ee.arraySet(qe.window,qe.window,Qe,Qe,0),qe.match_start-=Qe,qe.strstart-=Qe,qe.block_start-=Qe,et=qe.hash_size,$e=et;do tt=qe.head[--$e],qe.head[$e]=tt>=Qe?tt-Qe:0;while(--et);et=Qe,$e=et;do tt=qe.prev[--$e],qe.prev[$e]=tt>=Qe?tt-Qe:0;while(--et);rt+=Qe}if(0===qe.strm.avail_in)break;if(et=T(qe.strm,qe.window,qe.strstart+qe.lookahead,rt),qe.lookahead+=et,qe.lookahead+qe.insert>=De)for(at=qe.strstart-qe.insert,qe.ins_h=qe.window[at],qe.ins_h=(qe.ins_h<<qe.hash_shift^qe.window[at+1])&qe.hash_mask;qe.insert&&(qe.ins_h=(qe.ins_h<<qe.hash_shift^qe.window[at+De-1])&qe.hash_mask,qe.prev[at&qe.w_mask]=qe.head[qe.ins_h],qe.head[qe.ins_h]=at,at++,qe.insert--,!(qe.lookahead+qe.insert<De)););}while(qe.lookahead<Ne&&0!==qe.strm.avail_in)}function P(qe,Qe){for(var $e,et;;){if(qe.lookahead<Ne){if(F(qe),qe.lookahead<Ne&&Qe===se)return Ge;if(0===qe.lookahead)break}if($e=0,qe.lookahead>=De&&(qe.ins_h=(qe.ins_h<<qe.hash_shift^qe.window[qe.strstart+De-1])&qe.hash_mask,$e=qe.prev[qe.strstart&qe.w_mask]=qe.head[qe.ins_h],qe.head[qe.ins_h]=qe.strstart),0!==$e&&qe.strstart-$e<=qe.w_size-Ne&&(qe.match_length=D(qe,$e)),!(qe.match_length>=De))et=te._tr_tally(qe,0,qe.window[qe.strstart]),qe.lookahead--,qe.strstart++;else if(et=te._tr_tally(qe,qe.strstart-qe.match_start,qe.match_length-De),qe.lookahead-=qe.match_length,qe.match_length<=qe.max_lazy_match&&qe.lookahead>=De){qe.match_length--;do qe.strstart++,qe.ins_h=(qe.ins_h<<qe.hash_shift^qe.window[qe.strstart+De-1])&qe.hash_mask,$e=qe.prev[qe.strstart&qe.w_mask]=qe.head[qe.ins_h],qe.head[qe.ins_h]=qe.strstart;while(0!=--qe.match_length);qe.strstart++}else qe.strstart+=qe.match_length,qe.match_length=0,qe.ins_h=qe.window[qe.strstart],qe.ins_h=(qe.ins_h<<qe.hash_shift^qe.window[qe.strstart+1])&qe.hash_mask;if(et&&(A(qe,!1),0===qe.strm.avail_out))return Ge}return qe.insert=qe.strstart<De-1?qe.strstart:De-1,Qe===de?(A(qe,!0),0===qe.strm.avail_out?Ye:Xe):qe.last_lit&&(A(qe,!1),0===qe.strm.avail_out)?Ge:Ke}function L(qe,Qe){for(var $e,et,tt;;){if(qe.lookahead<Ne){if(F(qe),qe.lookahead<Ne&&Qe===se)return Ge;if(0===qe.lookahead)break}if($e=0,qe.lookahead>=De&&(qe.ins_h=(qe.ins_h<<qe.hash_shift^qe.window[qe.strstart+De-1])&qe.hash_mask,$e=qe.prev[qe.strstart&qe.w_mask]=qe.head[qe.ins_h],qe.head[qe.ins_h]=qe.strstart),qe.prev_length=qe.match_length,qe.prev_match=qe.match_start,qe.match_length=De-1,0!==$e&&qe.prev_length<qe.max_lazy_match&&qe.strstart-$e<=qe.w_size-Ne&&(qe.match_length=D(qe,$e),5>=qe.match_length&&(qe.strategy===1||qe.match_length===De&&4096<qe.strstart-qe.match_start)&&(qe.match_length=De-1)),qe.prev_length>=De&&qe.match_length<=qe.prev_length){tt=qe.strstart+qe.lookahead-De,et=te._tr_tally(qe,qe.strstart-1-qe.prev_match,qe.prev_length-De),qe.lookahead-=qe.prev_length-1,qe.prev_length-=2;do++qe.strstart<=tt&&(qe.ins_h=(qe.ins_h<<qe.hash_shift^qe.window[qe.strstart+De-1])&qe.hash_mask,$e=qe.prev[qe.strstart&qe.w_mask]=qe.head[qe.ins_h],qe.head[qe.ins_h]=qe.strstart);while(0!=--qe.prev_length);if(qe.match_available=0,qe.match_length=De-1,qe.strstart++,et&&(A(qe,!1),0===qe.strm.avail_out))return Ge}else if(!qe.match_available)qe.match_available=1,qe.strstart++,qe.lookahead--;else if(et=te._tr_tally(qe,0,qe.window[qe.strstart-1]),et&&A(qe,!1),qe.strstart++,qe.lookahead--,0===qe.strm.avail_out)return Ge}return qe.match_available&&(et=te._tr_tally(qe,0,qe.window[qe.strstart-1]),qe.match_available=0),qe.insert=qe.strstart<De-1?qe.strstart:De-1,Qe===de?(A(qe,!0),0===qe.strm.avail_out?Ye:Xe):qe.last_lit&&(A(qe,!1),0===qe.strm.avail_out)?Ge:Ke}function U(qe,Qe){for(var at=qe.window,$e,et,tt,rt;;){if(qe.lookahead<=Fe){if(F(qe),qe.lookahead<=Fe&&Qe===se)return Ge;if(0===qe.lookahead)break}if(qe.match_length=0,qe.lookahead>=De&&0<qe.strstart&&(tt=qe.strstart-1,et=at[tt],et===at[++tt]&&et===at[++tt]&&et===at[++tt])){rt=qe.strstart+Fe;do;while(et===at[++tt]&&et===at[++tt]&&et===at[++tt]&&et===at[++tt]&&et===at[++tt]&&et===at[++tt]&&et===at[++tt]&&et===at[++tt]&&tt<rt);qe.match_length=Fe-(rt-tt),qe.match_length>qe.lookahead&&(qe.match_length=qe.lookahead)}if(qe.match_length>=De?($e=te._tr_tally(qe,1,qe.match_length-De),qe.lookahead-=qe.match_length,qe.strstart+=qe.match_length,qe.match_length=0):($e=te._tr_tally(qe,0,qe.window[qe.strstart]),qe.lookahead--,qe.strstart++),$e&&(A(qe,!1),0===qe.strm.avail_out))return Ge}return qe.insert=0,Qe===de?(A(qe,!0),0===qe.strm.avail_out?Ye:Xe):qe.last_lit&&(A(qe,!1),0===qe.strm.avail_out)?Ge:Ke}function Z(qe,Qe){for(var $e;;){if(0===qe.lookahead&&(F(qe),0===qe.lookahead)){if(Qe===se)return Ge;break}if(qe.match_length=0,$e=te._tr_tally(qe,0,qe.window[qe.strstart]),qe.lookahead--,qe.strstart++,$e&&(A(qe,!1),0===qe.strm.avail_out))return Ge}return qe.insert=0,Qe===de?(A(qe,!0),0===qe.strm.avail_out?Ye:Xe):qe.last_lit&&(A(qe,!1),0===qe.strm.avail_out)?Ge:Ke}function W(qe,Qe,$e,et,tt){this.good_length=qe,this.max_lazy=Qe,this.nice_length=$e,this.max_chain=et,this.func=tt}function M(qe){qe.window_size=2*qe.w_size,I(qe.head),qe.max_lazy_match=Je[qe.level].max_lazy,qe.good_match=Je[qe.level].good_length,qe.nice_match=Je[qe.level].nice_length,qe.max_chain_length=Je[qe.level].max_chain,qe.strstart=0,qe.block_start=0,qe.lookahead=0,qe.insert=0,qe.match_length=qe.prev_length=De-1,qe.match_available=0,qe.ins_h=0}function H(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ve,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new ee.Buf16(2*(2*Oe+1)),this.dyn_dtree=new ee.Buf16(2*(2*30+1)),this.bl_tree=new ee.Buf16(2*(2*19+1)),I(this.dyn_ltree),I(this.dyn_dtree),I(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new ee.Buf16(15+1),this.heap=new ee.Buf16(2*Oe+1),I(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new ee.Buf16(2*Oe+1),I(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function G(qe){var Qe;return qe&&qe.state?(qe.total_in=qe.total_out=0,qe.data_type=2,Qe=qe.state,Qe.pending=0,Qe.pending_out=0,0>Qe.wrap&&(Qe.wrap=-Qe.wrap),Qe.status=Qe.wrap?Le:Me,qe.adler=2===Qe.wrap?0:1,Qe.last_flush=se,te._tr_init(Qe),ue):C(qe,ce)}function K(qe){var Qe=G(qe);return Qe===ue&&M(qe.state),Qe}function X(qe,Qe,$e,et,tt,rt){if(!qe)return ce;var at=1;if(Qe===-1&&(Qe=6),0>et?(at=0,et=-et):15<et&&(at=2,et-=16),1>tt||tt>9||$e!==ve||8>et||15<et||0>Qe||9<Qe||0>rt||rt>4)return C(qe,ce);8===et&&(et=9);var nt=new H;return qe.state=nt,nt.strm=qe,nt.wrap=at,nt.gzhead=null,nt.w_bits=et,nt.w_size=1<<nt.w_bits,nt.w_mask=nt.w_size-1,nt.hash_bits=tt+7,nt.hash_size=1<<nt.hash_bits,nt.hash_mask=nt.hash_size-1,nt.hash_shift=~~((nt.hash_bits+De-1)/De),nt.window=new ee.Buf8(2*nt.w_size),nt.head=new ee.Buf16(nt.hash_size),nt.prev=new ee.Buf16(nt.w_size),nt.lit_bufsize=1<<tt+6,nt.pending_buf_size=4*nt.lit_bufsize,nt.pending_buf=new ee.Buf8(nt.pending_buf_size),nt.d_buf=1*nt.lit_bufsize,nt.l_buf=3*nt.lit_bufsize,nt.level=Qe,nt.strategy=rt,nt.method=$e,K(qe)}var ee=x("../utils/common"),te=x("./trees"),re=x("./adler32"),ae=x("./crc32"),ne=x("./messages"),se=0,de=4,le=5,ue=0,pe=1,ce=-2,fe=-5,be=2,ve=8,Oe=256+1+29,De=3,Fe=258,Ne=Fe+De+1,Le=42,Ue=69,je=73,Ze=91,We=103,Me=113,He=666,Ge=1,Ke=2,Ye=3,Xe=4,Je;Je=[new W(0,0,0,0,function(qe,Qe){var $e=65535;for($e>qe.pending_buf_size-5&&($e=qe.pending_buf_size-5);;){if(1>=qe.lookahead){if(F(qe),0===qe.lookahead&&Qe===se)return Ge;if(0===qe.lookahead)break}qe.strstart+=qe.lookahead,qe.lookahead=0;var et=qe.block_start+$e;if((0===qe.strstart||qe.strstart>=et)&&(qe.lookahead=qe.strstart-et,qe.strstart=et,A(qe,!1),0===qe.strm.avail_out))return Ge;if(qe.strstart-qe.block_start>=qe.w_size-Ne&&(A(qe,!1),0===qe.strm.avail_out))return Ge}return qe.insert=0,Qe===de?(A(qe,!0),0===qe.strm.avail_out?Ye:Xe):qe.strstart>qe.block_start&&(A(qe,!1),0===qe.strm.avail_out)?Ge:Ge}),new W(4,4,8,4,P),new W(4,5,16,8,P),new W(4,6,32,32,P),new W(4,4,16,16,L),new W(8,16,32,32,L),new W(8,16,128,128,L),new W(8,32,128,256,L),new W(32,128,258,1024,L),new W(32,258,258,4096,L)],S.deflateInit=function(qe,Qe){return X(qe,Qe,ve,15,8,0)},S.deflateInit2=X,S.deflateReset=K,S.deflateResetKeep=G,S.deflateSetHeader=function(qe,Qe){return qe&&qe.state?2===qe.state.wrap?(qe.state.gzhead=Qe,ue):ce:ce},S.deflate=function(qe,Qe){var $e,et,tt,rt;if(!qe||!qe.state||Qe>le||0>Qe)return qe?C(qe,ce):ce;if(et=qe.state,!qe.output||!qe.input&&0!==qe.avail_in||et.status===He&&Qe!==de)return C(qe,0===qe.avail_out?fe:ce);if(et.strm=qe,$e=et.last_flush,et.last_flush=Qe,et.status===Le)if(2===et.wrap)qe.adler=0,B(et,31),B(et,139),B(et,8),et.gzhead?(B(et,(et.gzhead.text?1:0)+(et.gzhead.hcrc?2:0)+(et.gzhead.extra?4:0)+(et.gzhead.name?8:0)+(et.gzhead.comment?16:0)),B(et,255&et.gzhead.time),B(et,255&et.gzhead.time>>8),B(et,255&et.gzhead.time>>16),B(et,255&et.gzhead.time>>24),B(et,9===et.level?2:et.strategy>=be||2>et.level?4:0),B(et,255&et.gzhead.os),et.gzhead.extra&&et.gzhead.extra.length&&(B(et,255&et.gzhead.extra.length),B(et,255&et.gzhead.extra.length>>8)),et.gzhead.hcrc&&(qe.adler=ae(qe.adler,et.pending_buf,et.pending,0)),et.gzindex=0,et.status=Ue):(B(et,0),B(et,0),B(et,0),B(et,0),B(et,0),B(et,9===et.level?2:et.strategy>=be||2>et.level?4:0),B(et,3),et.status=Me);else{var at=ve+(et.w_bits-8<<4)<<8,nt=-1;nt=et.strategy>=be||2>et.level?0:6>et.level?1:6===et.level?2:3,at|=nt<<6,0!==et.strstart&&(at|=32),at+=31-at%31,et.status=Me,R(et,at),0!==et.strstart&&(R(et,qe.adler>>>16),R(et,65535&qe.adler)),qe.adler=1}if(et.status===Ue)if(et.gzhead.extra){for(tt=et.pending;et.gzindex<(65535&et.gzhead.extra.length)&&!(et.pending===et.pending_buf_size&&(et.gzhead.hcrc&&et.pending>tt&&(qe.adler=ae(qe.adler,et.pending_buf,et.pending-tt,tt)),O(qe),tt=et.pending,et.pending===et.pending_buf_size));)B(et,255&et.gzhead.extra[et.gzindex]),et.gzindex++;et.gzhead.hcrc&&et.pending>tt&&(qe.adler=ae(qe.adler,et.pending_buf,et.pending-tt,tt)),et.gzindex===et.gzhead.extra.length&&(et.gzindex=0,et.status=je)}else et.status=je;if(et.status===je)if(et.gzhead.name){tt=et.pending;do{if(et.pending===et.pending_buf_size&&(et.gzhead.hcrc&&et.pending>tt&&(qe.adler=ae(qe.adler,et.pending_buf,et.pending-tt,tt)),O(qe),tt=et.pending,et.pending===et.pending_buf_size)){rt=1;break}rt=et.gzindex<et.gzhead.name.length?255&et.gzhead.name.charCodeAt(et.gzindex++):0,B(et,rt)}while(0!==rt);et.gzhead.hcrc&&et.pending>tt&&(qe.adler=ae(qe.adler,et.pending_buf,et.pending-tt,tt)),0===rt&&(et.gzindex=0,et.status=Ze)}else et.status=Ze;if(et.status===Ze)if(et.gzhead.comment){tt=et.pending;do{if(et.pending===et.pending_buf_size&&(et.gzhead.hcrc&&et.pending>tt&&(qe.adler=ae(qe.adler,et.pending_buf,et.pending-tt,tt)),O(qe),tt=et.pending,et.pending===et.pending_buf_size)){rt=1;break}rt=et.gzindex<et.gzhead.comment.length?255&et.gzhead.comment.charCodeAt(et.gzindex++):0,B(et,rt)}while(0!==rt);et.gzhead.hcrc&&et.pending>tt&&(qe.adler=ae(qe.adler,et.pending_buf,et.pending-tt,tt)),0===rt&&(et.status=We)}else et.status=We;if(et.status===We&&(et.gzhead.hcrc?(et.pending+2>et.pending_buf_size&&O(qe),et.pending+2<=et.pending_buf_size&&(B(et,255&qe.adler),B(et,255&qe.adler>>8),qe.adler=0,et.status=Me)):et.status=Me),0!==et.pending){if(O(qe),0===qe.avail_out)return et.last_flush=-1,ue;}else if(0===qe.avail_in&&E(Qe)<=E($e)&&Qe!==de)return C(qe,fe);if(et.status===He&&0!==qe.avail_in)return C(qe,fe);if(0!==qe.avail_in||0!==et.lookahead||Qe!==se&&et.status!==He){var st=et.strategy===be?Z(et,Qe):et.strategy===3?U(et,Qe):Je[et.level].func(et,Qe);if((st===Ye||st===Xe)&&(et.status=He),st===Ge||st===Ye)return 0===qe.avail_out&&(et.last_flush=-1),ue;if(st===Ke&&(Qe===1?te._tr_align(et):Qe!==le&&(te._tr_stored_block(et,0,0,!1),Qe===3&&(I(et.head),0===et.lookahead&&(et.strstart=0,et.block_start=0,et.insert=0))),O(qe),0===qe.avail_out))return et.last_flush=-1,ue}return Qe===de?0>=et.wrap?pe:(2===et.wrap?(B(et,255&qe.adler),B(et,255&qe.adler>>8),B(et,255&qe.adler>>16),B(et,255&qe.adler>>24),B(et,255&qe.total_in),B(et,255&qe.total_in>>8),B(et,255&qe.total_in>>16),B(et,255&qe.total_in>>24)):(R(et,qe.adler>>>16),R(et,65535&qe.adler)),O(qe),0<et.wrap&&(et.wrap=-et.wrap),0===et.pending?pe:ue):ue},S.deflateEnd=function(qe){var Qe;return qe&&qe.state?(Qe=qe.state.status,Qe!==Le&&Qe!==Ue&&Qe!==je&&Qe!==Ze&&Qe!==We&&Qe!==Me&&Qe!==He)?C(qe,ce):(qe.state=null,Qe===Me?C(qe,-3):ue):ce},S.deflateSetDictionary=function(qe,Qe){var $e=Qe.length,et,tt,rt,at,nt,st,it,ot;if(!qe||!qe.state)return ce;if(et=qe.state,at=et.wrap,2===at||1===at&&et.status!==Le||et.lookahead)return ce;for(1===at&&(qe.adler=re(qe.adler,Qe,$e,0)),et.wrap=0,$e>=et.w_size&&(0===at&&(I(et.head),et.strstart=0,et.block_start=0,et.insert=0),ot=new ee.Buf8(et.w_size),ee.arraySet(ot,Qe,$e-et.w_size,et.w_size,0),Qe=ot,$e=et.w_size),nt=qe.avail_in,st=qe.next_in,it=qe.input,qe.avail_in=$e,qe.next_in=0,qe.input=Qe,F(et);et.lookahead>=De;){tt=et.strstart,rt=et.lookahead-(De-1);do et.ins_h=(et.ins_h<<et.hash_shift^et.window[tt+De-1])&et.hash_mask,et.prev[tt&et.w_mask]=et.head[et.ins_h],et.head[et.ins_h]=tt,tt++;while(--rt);et.strstart=tt,et.lookahead=De-1,F(et)}return et.strstart+=et.lookahead,et.block_start=et.strstart,et.insert=et.lookahead,et.lookahead=0,et.match_length=et.prev_length=De-1,et.match_available=0,qe.next_in=st,qe.input=it,qe.avail_in=nt,et.wrap=at,ue},S.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(x,z){"use strict";z.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(x,z){"use strict";var C=30;z.exports=function(O,A){var B,R,T,D,F,N,P,L,U,Z,W,M,H,G,K,Y,X,V,J,Q,$,ee,te,re,ae;B=O.state,R=O.next_in,re=O.input,T=R+(O.avail_in-5),D=O.next_out,ae=O.output,F=D-(A-O.avail_out),N=D+(O.avail_out-257),P=B.dmax,L=B.wsize,U=B.whave,Z=B.wnext,W=B.window,M=B.hold,H=B.bits,G=B.lencode,K=B.distcode,Y=(1<<B.lenbits)-1,X=(1<<B.distbits)-1;top:do{15>H&&(M+=re[R++]<<H,H+=8,M+=re[R++]<<H,H+=8),V=G[M&Y];dolen:for(;;){if(J=V>>>24,M>>>=J,H-=J,J=255&V>>>16,0===J)ae[D++]=65535&V;else if(16&J){Q=65535&V,J&=15,J&&(H<J&&(M+=re[R++]<<H,H+=8),Q+=M&(1<<J)-1,M>>>=J,H-=J),15>H&&(M+=re[R++]<<H,H+=8,M+=re[R++]<<H,H+=8),V=K[M&X];dodist:for(;;){if(J=V>>>24,M>>>=J,H-=J,J=255&V>>>16,16&J){if($=65535&V,J&=15,H<J&&(M+=re[R++]<<H,H+=8,H<J&&(M+=re[R++]<<H,H+=8)),$+=M&(1<<J)-1,$>P){O.msg="invalid distance too far back",B.mode=C;break top}if(M>>>=J,H-=J,J=D-F,$>J){if(J=$-J,J>U&&B.sane){O.msg="invalid distance too far back",B.mode=C;break top}if(ee=0,te=W,0===Z){if(ee+=L-J,J<Q){Q-=J;do ae[D++]=W[ee++];while(--J);ee=D-$,te=ae}}else if(Z<J){if(ee+=L+Z-J,J-=Z,J<Q){Q-=J;do ae[D++]=W[ee++];while(--J);if(ee=0,Z<Q){J=Z,Q-=J;do ae[D++]=W[ee++];while(--J);ee=D-$,te=ae}}}else if(ee+=Z-J,J<Q){Q-=J;do ae[D++]=W[ee++];while(--J);ee=D-$,te=ae}for(;2<Q;)ae[D++]=te[ee++],ae[D++]=te[ee++],ae[D++]=te[ee++],Q-=3;Q&&(ae[D++]=te[ee++],1<Q&&(ae[D++]=te[ee++]))}else{ee=D-$;do ae[D++]=ae[ee++],ae[D++]=ae[ee++],ae[D++]=ae[ee++],Q-=3;while(2<Q);Q&&(ae[D++]=ae[ee++],1<Q&&(ae[D++]=ae[ee++]))}}else if(0==(64&J)){V=K[(65535&V)+(M&(1<<J)-1)];continue dodist}else{O.msg="invalid distance code",B.mode=C;break top}break}}else if(0==(64&J)){V=G[(65535&V)+(M&(1<<J)-1)];continue dolen}else if(32&J){B.mode=12;break top}else{O.msg="invalid literal/length code",B.mode=C;break top}break}}while(R<T&&D<N);return Q=H>>3,R-=Q,H-=Q<<3,M&=(1<<H)-1,O.next_in=R,O.next_out=D,O.avail_in=R<T?5+(T-R):5-(R-T),O.avail_out=D<N?257+(N-D):257-(D-N),B.hold=M,void(B.bits=H)}},{}],49:[function(x,z,S){"use strict";function C(Ke){return(255&Ke>>>24)+(65280&Ke>>>8)+((65280&Ke)<<8)+((255&Ke)<<24)}function E(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new U.Buf16(320),this.work=new U.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function I(Ke){var Ye;return Ke&&Ke.state?(Ye=Ke.state,Ke.total_in=Ke.total_out=Ye.total=0,Ke.msg="",Ye.wrap&&(Ke.adler=1&Ye.wrap),Ye.mode=ie,Ye.last=0,Ye.havedict=0,Ye.dmax=32768,Ye.head=null,Ye.hold=0,Ye.bits=0,Ye.lencode=Ye.lendyn=new U.Buf32(852),Ye.distcode=Ye.distdyn=new U.Buf32(592),Ye.sane=1,Ye.back=-1,Q):te}function O(Ke){var Ye;return Ke&&Ke.state?(Ye=Ke.state,Ye.wsize=0,Ye.whave=0,Ye.wnext=0,I(Ke)):te}function A(Ke,Ye){var Xe,Ve;return Ke&&Ke.state?(Ve=Ke.state,0>Ye?(Xe=0,Ye=-Ye):(Xe=(Ye>>4)+1,48>Ye&&(Ye&=15)),Ye&&(8>Ye||15<Ye))?te:(null!==Ve.window&&Ve.wbits!==Ye&&(Ve.window=null),Ve.wrap=Xe,Ve.wbits=Ye,O(Ke)):te}function B(Ke,Ye){var Xe,Ve;return Ke?(Ve=new E,Ke.state=Ve,Ve.window=null,Xe=A(Ke,Ye),Xe!==Q&&(Ke.state=null),Xe):te}function T(Ke){if(Me){var Ye;for(He=new U.Buf32(512),Ge=new U.Buf32(32),Ye=0;144>Ye;)Ke.lens[Ye++]=8;for(;256>Ye;)Ke.lens[Ye++]=9;for(;280>Ye;)Ke.lens[Ye++]=7;for(;288>Ye;)Ke.lens[Ye++]=8;for(H(K,Ke.lens,0,288,He,0,Ke.work,{bits:9}),Ye=0;32>Ye;)Ke.lens[Ye++]=5;H(Y,Ke.lens,0,32,Ge,0,Ke.work,{bits:5}),Me=!1}Ke.lencode=He,Ke.lenbits=9,Ke.distcode=Ge,Ke.distbits=5}function D(Ke,Ye,Xe,Ve){var qe=Ke.state,Je;return null===qe.window&&(qe.wsize=1<<qe.wbits,qe.wnext=0,qe.whave=0,qe.window=new U.Buf8(qe.wsize)),Ve>=qe.wsize?(U.arraySet(qe.window,Ye,Xe-qe.wsize,qe.wsize,0),qe.wnext=0,qe.whave=qe.wsize):(Je=qe.wsize-qe.wnext,Je>Ve&&(Je=Ve),U.arraySet(qe.window,Ye,Xe-Ve,Je,qe.wnext),Ve-=Je,Ve?(U.arraySet(qe.window,Ye,Xe-Ve,Ve,0),qe.wnext=Ve,qe.whave=qe.wsize):(qe.wnext+=Je,qe.wnext===qe.wsize&&(qe.wnext=0),qe.whave<qe.wsize&&(qe.whave+=Je))),0}var U=x("../utils/common"),Z=x("./adler32"),W=x("./crc32"),M=x("./inffast"),H=x("./inftrees"),K=1,Y=2,X=4,J=6,Q=0,te=-2,re=-3,ae=-4,se=8,ie=1,oe=2,de=3,le=4,ue=5,pe=6,ce=7,he=8,fe=9,_e=10,ge=11,be=12,ye=13,ke=14,xe=15,we=16,ve=17,ze=18,Se=19,Ce=20,Ee=21,Ie=22,Oe=23,Ae=24,Be=25,Re=26,Te=27,De=28,Fe=29,Ne=30,Pe=31,Me=!0,He,Ge;S.inflateReset=O,S.inflateReset2=A,S.inflateResetKeep=I,S.inflateInit=function(Ke){return B(Ke,15)},S.inflateInit2=B,S.inflate=function(Ke,Ye){var dt=0,gt=new U.Buf8(4),kt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Xe,Ve,Je,qe,Qe,$e,et,tt,rt,at,nt,st,it,ot,lt,ut,pt,ct,ht,mt,ft,_t,bt,yt;if(!Ke||!Ke.state||!Ke.output||!Ke.input&&0!==Ke.avail_in)return te;Xe=Ke.state,Xe.mode===be&&(Xe.mode=ye),Qe=Ke.next_out,Je=Ke.output,et=Ke.avail_out,qe=Ke.next_in,Ve=Ke.input,$e=Ke.avail_in,tt=Xe.hold,rt=Xe.bits,at=$e,nt=et,_t=Q;inf_leave:for(;;)switch(Xe.mode){case ie:if(0===Xe.wrap){Xe.mode=ye;break}for(;16>rt;){if(0===$e)break inf_leave;$e--,tt+=Ve[qe++]<<rt,rt+=8}if(2&Xe.wrap&&35615===tt){Xe.check=0,gt[0]=255&tt,gt[1]=255&tt>>>8,Xe.check=W(Xe.check,gt,2,0),tt=0,rt=0,Xe.mode=oe;break}if(Xe.flags=0,Xe.head&&(Xe.head.done=!1),!(1&Xe.wrap)||(((255&tt)<<8)+(tt>>8))%31){Ke.msg="incorrect header check",Xe.mode=Ne;break}if((15&tt)!==se){Ke.msg="unknown compression method",Xe.mode=Ne;break}if(tt>>>=4,rt-=4,ft=(15&tt)+8,0===Xe.wbits)Xe.wbits=ft;else if(ft>Xe.wbits){Ke.msg="invalid window size",Xe.mode=Ne;break}Xe.dmax=1<<ft,Ke.adler=Xe.check=1,Xe.mode=512&tt?_e:be,tt=0,rt=0;break;case oe:for(;16>rt;){if(0===$e)break inf_leave;$e--,tt+=Ve[qe++]<<rt,rt+=8}if(Xe.flags=tt,(255&Xe.flags)!==se){Ke.msg="unknown compression method",Xe.mode=Ne;break}if(57344&Xe.flags){Ke.msg="unknown header flags set",Xe.mode=Ne;break}Xe.head&&(Xe.head.text=1&tt>>8),512&Xe.flags&&(gt[0]=255&tt,gt[1]=255&tt>>>8,Xe.check=W(Xe.check,gt,2,0)),tt=0,rt=0,Xe.mode=de;case de:for(;32>rt;){if(0===$e)break inf_leave;$e--,tt+=Ve[qe++]<<rt,rt+=8}Xe.head&&(Xe.head.time=tt),512&Xe.flags&&(gt[0]=255&tt,gt[1]=255&tt>>>8,gt[2]=255&tt>>>16,gt[3]=255&tt>>>24,Xe.check=W(Xe.check,gt,4,0)),tt=0,rt=0,Xe.mode=le;case le:for(;16>rt;){if(0===$e)break inf_leave;$e--,tt+=Ve[qe++]<<rt,rt+=8}Xe.head&&(Xe.head.xflags=255&tt,Xe.head.os=tt>>8),512&Xe.flags&&(gt[0]=255&tt,gt[1]=255&tt>>>8,Xe.check=W(Xe.check,gt,2,0)),tt=0,rt=0,Xe.mode=ue;case ue:if(1024&Xe.flags){for(;16>rt;){if(0===$e)break inf_leave;$e--,tt+=Ve[qe++]<<rt,rt+=8}Xe.length=tt,Xe.head&&(Xe.head.extra_len=tt),512&Xe.flags&&(gt[0]=255&tt,gt[1]=255&tt>>>8,Xe.check=W(Xe.check,gt,2,0)),tt=0,rt=0}else Xe.head&&(Xe.head.extra=null);Xe.mode=pe;case pe:if(1024&Xe.flags&&(st=Xe.length,st>$e&&(st=$e),st&&(Xe.head&&(ft=Xe.head.extra_len-Xe.length,!Xe.head.extra&&(Xe.head.extra=Array(Xe.head.extra_len)),U.arraySet(Xe.head.extra,Ve,qe,st,ft)),512&Xe.flags&&(Xe.check=W(Xe.check,Ve,st,qe)),$e-=st,qe+=st,Xe.length-=st),Xe.length))break inf_leave;Xe.length=0,Xe.mode=ce;case ce:if(2048&Xe.flags){if(0===$e)break inf_leave;st=0;do ft=Ve[qe+st++],Xe.head&&ft&&65536>Xe.length&&(Xe.head.name+=String.fromCharCode(ft));while(ft&&st<$e);if(512&Xe.flags&&(Xe.check=W(Xe.check,Ve,st,qe)),$e-=st,qe+=st,ft)break inf_leave}else Xe.head&&(Xe.head.name=null);Xe.length=0,Xe.mode=he;case he:if(4096&Xe.flags){if(0===$e)break inf_leave;st=0;do ft=Ve[qe+st++],Xe.head&&ft&&65536>Xe.length&&(Xe.head.comment+=String.fromCharCode(ft));while(ft&&st<$e);if(512&Xe.flags&&(Xe.check=W(Xe.check,Ve,st,qe)),$e-=st,qe+=st,ft)break inf_leave}else Xe.head&&(Xe.head.comment=null);Xe.mode=fe;case fe:if(512&Xe.flags){for(;16>rt;){if(0===$e)break inf_leave;$e--,tt+=Ve[qe++]<<rt,rt+=8}if(tt!==(65535&Xe.check)){Ke.msg="header crc mismatch",Xe.mode=Ne;break}tt=0,rt=0}Xe.head&&(Xe.head.hcrc=1&Xe.flags>>9,Xe.head.done=!0),Ke.adler=Xe.check=0,Xe.mode=be;break;case _e:for(;32>rt;){if(0===$e)break inf_leave;$e--,tt+=Ve[qe++]<<rt,rt+=8}Ke.adler=Xe.check=C(tt),tt=0,rt=0,Xe.mode=ge;case ge:if(0===Xe.havedict)return Ke.next_out=Qe,Ke.avail_out=et,Ke.next_in=qe,Ke.avail_in=$e,Xe.hold=tt,Xe.bits=rt,2;Ke.adler=Xe.check=1,Xe.mode=be;case be:if(Ye===5||Ye===J)break inf_leave;case ye:if(Xe.last){tt>>>=7&rt,rt-=7&rt,Xe.mode=Te;break}for(;3>rt;){if(0===$e)break inf_leave;$e--,tt+=Ve[qe++]<<rt,rt+=8}switch(Xe.last=1&tt,tt>>>=1,rt-=1,3&tt){case 0:Xe.mode=ke;break;case 1:if(T(Xe),Xe.mode=Ce,Ye===J){tt>>>=2,rt-=2;break inf_leave}break;case 2:Xe.mode=ve;break;case 3:Ke.msg="invalid block type",Xe.mode=Ne;}tt>>>=2,rt-=2;break;case ke:for(tt>>>=7&rt,rt-=7&rt;32>rt;){if(0===$e)break inf_leave;$e--,tt+=Ve[qe++]<<rt,rt+=8}if((65535&tt)!=(65535^tt>>>16)){Ke.msg="invalid stored block lengths",Xe.mode=Ne;break}if(Xe.length=65535&tt,tt=0,rt=0,Xe.mode=xe,Ye===J)break inf_leave;case xe:Xe.mode=we;case we:if(st=Xe.length,st){if(st>$e&&(st=$e),st>et&&(st=et),0===st)break inf_leave;U.arraySet(Je,Ve,qe,st,Qe),$e-=st,qe+=st,et-=st,Qe+=st,Xe.length-=st;break}Xe.mode=be;break;case ve:for(;14>rt;){if(0===$e)break inf_leave;$e--,tt+=Ve[qe++]<<rt,rt+=8}if(Xe.nlen=(31&tt)+257,tt>>>=5,rt-=5,Xe.ndist=(31&tt)+1,tt>>>=5,rt-=5,Xe.ncode=(15&tt)+4,tt>>>=4,rt-=4,286<Xe.nlen||30<Xe.ndist){Ke.msg="too many length or distance symbols",Xe.mode=Ne;break}Xe.have=0,Xe.mode=ze;case ze:for(;Xe.have<Xe.ncode;){for(;3>rt;){if(0===$e)break inf_leave;$e--,tt+=Ve[qe++]<<rt,rt+=8}Xe.lens[kt[Xe.have++]]=7&tt,tt>>>=3,rt-=3}for(;19>Xe.have;)Xe.lens[kt[Xe.have++]]=0;if(Xe.lencode=Xe.lendyn,Xe.lenbits=7,bt={bits:Xe.lenbits},_t=H(0,Xe.lens,0,19,Xe.lencode,0,Xe.work,bt),Xe.lenbits=bt.bits,_t){Ke.msg="invalid code lengths set",Xe.mode=Ne;break}Xe.have=0,Xe.mode=Se;case Se:for(;Xe.have<Xe.nlen+Xe.ndist;){for(;;){if(dt=Xe.lencode[tt&(1<<Xe.lenbits)-1],lt=dt>>>24,ut=255&dt>>>16,pt=65535&dt,lt<=rt)break;if(0===$e)break inf_leave;$e--,tt+=Ve[qe++]<<rt,rt+=8}if(16>pt)tt>>>=lt,rt-=lt,Xe.lens[Xe.have++]=pt;else{if(16===pt){for(yt=lt+2;rt<yt;){if(0===$e)break inf_leave;$e--,tt+=Ve[qe++]<<rt,rt+=8}if(tt>>>=lt,rt-=lt,0===Xe.have){Ke.msg="invalid bit length repeat",Xe.mode=Ne;break}ft=Xe.lens[Xe.have-1],st=3+(3&tt),tt>>>=2,rt-=2}else if(17===pt){for(yt=lt+3;rt<yt;){if(0===$e)break inf_leave;$e--,tt+=Ve[qe++]<<rt,rt+=8}tt>>>=lt,rt-=lt,ft=0,st=3+(7&tt),tt>>>=3,rt-=3}else{for(yt=lt+7;rt<yt;){if(0===$e)break inf_leave;$e--,tt+=Ve[qe++]<<rt,rt+=8}tt>>>=lt,rt-=lt,ft=0,st=11+(127&tt),tt>>>=7,rt-=7}if(Xe.have+st>Xe.nlen+Xe.ndist){Ke.msg="invalid bit length repeat",Xe.mode=Ne;break}for(;st--;)Xe.lens[Xe.have++]=ft}}if(Xe.mode===Ne)break;if(0===Xe.lens[256]){Ke.msg="invalid code -- missing end-of-block",Xe.mode=Ne;break}if(Xe.lenbits=9,bt={bits:Xe.lenbits},_t=H(K,Xe.lens,0,Xe.nlen,Xe.lencode,0,Xe.work,bt),Xe.lenbits=bt.bits,_t){Ke.msg="invalid literal/lengths set",Xe.mode=Ne;break}if(Xe.distbits=6,Xe.distcode=Xe.distdyn,bt={bits:Xe.distbits},_t=H(Y,Xe.lens,Xe.nlen,Xe.ndist,Xe.distcode,0,Xe.work,bt),Xe.distbits=bt.bits,_t){Ke.msg="invalid distances set",Xe.mode=Ne;break}if(Xe.mode=Ce,Ye===J)break inf_leave;case Ce:Xe.mode=Ee;case Ee:if(6<=$e&&258<=et){Ke.next_out=Qe,Ke.avail_out=et,Ke.next_in=qe,Ke.avail_in=$e,Xe.hold=tt,Xe.bits=rt,M(Ke,nt),Qe=Ke.next_out,Je=Ke.output,et=Ke.avail_out,qe=Ke.next_in,Ve=Ke.input,$e=Ke.avail_in,tt=Xe.hold,rt=Xe.bits,Xe.mode===be&&(Xe.back=-1);break}for(Xe.back=0;;){if(dt=Xe.lencode[tt&(1<<Xe.lenbits)-1],lt=dt>>>24,ut=255&dt>>>16,pt=65535&dt,lt<=rt)break;if(0===$e)break inf_leave;$e--,tt+=Ve[qe++]<<rt,rt+=8}if(ut&&0==(240&ut)){for(ct=lt,ht=ut,mt=pt;;){if(dt=Xe.lencode[mt+((tt&(1<<ct+ht)-1)>>ct)],lt=dt>>>24,ut=255&dt>>>16,pt=65535&dt,ct+lt<=rt)break;if(0===$e)break inf_leave;$e--,tt+=Ve[qe++]<<rt,rt+=8}tt>>>=ct,rt-=ct,Xe.back+=ct}if(tt>>>=lt,rt-=lt,Xe.back+=lt,Xe.length=pt,0===ut){Xe.mode=Re;break}if(32&ut){Xe.back=-1,Xe.mode=be;break}if(64&ut){Ke.msg="invalid literal/length code",Xe.mode=Ne;break}Xe.extra=15&ut,Xe.mode=Ie;case Ie:if(Xe.extra){for(yt=Xe.extra;rt<yt;){if(0===$e)break inf_leave;$e--,tt+=Ve[qe++]<<rt,rt+=8}Xe.length+=tt&(1<<Xe.extra)-1,tt>>>=Xe.extra,rt-=Xe.extra,Xe.back+=Xe.extra}Xe.was=Xe.length,Xe.mode=Oe;case Oe:for(;;){if(dt=Xe.distcode[tt&(1<<Xe.distbits)-1],lt=dt>>>24,ut=255&dt>>>16,pt=65535&dt,lt<=rt)break;if(0===$e)break inf_leave;$e--,tt+=Ve[qe++]<<rt,rt+=8}if(0==(240&ut)){for(ct=lt,ht=ut,mt=pt;;){if(dt=Xe.distcode[mt+((tt&(1<<ct+ht)-1)>>ct)],lt=dt>>>24,ut=255&dt>>>16,pt=65535&dt,ct+lt<=rt)break;if(0===$e)break inf_leave;$e--,tt+=Ve[qe++]<<rt,rt+=8}tt>>>=ct,rt-=ct,Xe.back+=ct}if(tt>>>=lt,rt-=lt,Xe.back+=lt,64&ut){Ke.msg="invalid distance code",Xe.mode=Ne;break}Xe.offset=pt,Xe.extra=15&ut,Xe.mode=Ae;case Ae:if(Xe.extra){for(yt=Xe.extra;rt<yt;){if(0===$e)break inf_leave;$e--,tt+=Ve[qe++]<<rt,rt+=8}Xe.offset+=tt&(1<<Xe.extra)-1,tt>>>=Xe.extra,rt-=Xe.extra,Xe.back+=Xe.extra}if(Xe.offset>Xe.dmax){Ke.msg="invalid distance too far back",Xe.mode=Ne;break}Xe.mode=Be;case Be:if(0===et)break inf_leave;if(st=nt-et,Xe.offset>st){if(st=Xe.offset-st,st>Xe.whave&&Xe.sane){Ke.msg="invalid distance too far back",Xe.mode=Ne;break}st>Xe.wnext?(st-=Xe.wnext,it=Xe.wsize-st):it=Xe.wnext-st,st>Xe.length&&(st=Xe.length),ot=Xe.window}else ot=Je,it=Qe-Xe.offset,st=Xe.length;st>et&&(st=et),et-=st,Xe.length-=st;do Je[Qe++]=ot[it++];while(--st);0===Xe.length&&(Xe.mode=Ee);break;case Re:if(0===et)break inf_leave;Je[Qe++]=Xe.length,et--,Xe.mode=Ee;break;case Te:if(Xe.wrap){for(;32>rt;){if(0===$e)break inf_leave;$e--,tt|=Ve[qe++]<<rt,rt+=8}if(nt-=et,Ke.total_out+=nt,Xe.total+=nt,nt&&(Ke.adler=Xe.check=Xe.flags?W(Xe.check,Je,nt,Qe-nt):Z(Xe.check,Je,nt,Qe-nt)),nt=et,(Xe.flags?tt:C(tt))!==Xe.check){Ke.msg="incorrect data check",Xe.mode=Ne;break}tt=0,rt=0}Xe.mode=De;case De:if(Xe.wrap&&Xe.flags){for(;32>rt;){if(0===$e)break inf_leave;$e--,tt+=Ve[qe++]<<rt,rt+=8}if(tt!==(4294967295&Xe.total)){Ke.msg="incorrect length check",Xe.mode=Ne;break}tt=0,rt=0}Xe.mode=Fe;case Fe:_t=1;break inf_leave;case Ne:_t=re;break inf_leave;case Pe:return ae;case 32:default:return te;}return(Ke.next_out=Qe,Ke.avail_out=et,Ke.next_in=qe,Ke.avail_in=$e,Xe.hold=tt,Xe.bits=rt,(Xe.wsize||nt!==Ke.avail_out&&Xe.mode<Ne&&(Xe.mode<Te||Ye!==X))&&D(Ke,Ke.output,Ke.next_out,nt-Ke.avail_out))?(Xe.mode=Pe,ae):(at-=Ke.avail_in,nt-=Ke.avail_out,Ke.total_in+=at,Ke.total_out+=nt,Xe.total+=nt,Xe.wrap&&nt&&(Ke.adler=Xe.check=Xe.flags?W(Xe.check,Je,nt,Ke.next_out-nt):Z(Xe.check,Je,nt,Ke.next_out-nt)),Ke.data_type=Xe.bits+(Xe.last?64:0)+(Xe.mode===be?128:0)+(Xe.mode===Ce||Xe.mode===xe?256:0),(0===at&&0===nt||Ye===X)&&_t===Q&&(_t=-5),_t)},S.inflateEnd=function(Ke){if(!Ke||!Ke.state)return te;var Ye=Ke.state;return Ye.window&&(Ye.window=null),Ke.state=null,Q},S.inflateGetHeader=function(Ke,Ye){var Xe;return Ke&&Ke.state?(Xe=Ke.state,0==(2&Xe.wrap))?te:(Xe.head=Ye,Ye.done=!1,Q):te},S.inflateSetDictionary=function(Ke,Ye){var Xe=Ye.length,Ve,Je,qe;return Ke&&Ke.state?(Ve=Ke.state,0!==Ve.wrap&&Ve.mode!==ge)?te:Ve.mode===ge&&(Je=1,Je=Z(Je,Ye,Xe,0),Je!==Ve.check)?re:(qe=D(Ke,Ye,Xe,Xe),qe)?(Ve.mode=Pe,ae):(Ve.havedict=1,Q):te},S.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(x,z){"use strict";var C=x("../utils/common"),E=15,I=852,O=592,A=0,B=1,R=2,T=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],D=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],F=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],N=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];z.exports=function(L,U,Z,W,M,H,G,K){var Y=K.bits,X=0,V=0,J=0,Q=0,$=0,ee=0,te=0,re=0,ae=0,ne=0,ue=null,pe=0,he=new C.Buf16(E+1),fe=new C.Buf16(E+1),_e=null,ge=0,se,ie,oe,de,le,ce,be,ye,ke;for(X=0;X<=E;X++)he[X]=0;for(V=0;V<W;V++)he[U[Z+V]]++;for($=Y,Q=E;1<=Q&&0===he[Q];Q--);if($>Q&&($=Q),0==Q)return M[H++]=20971520,M[H++]=20971520,K.bits=1,0;for(J=1;J<Q&&0===he[J];J++);for($<J&&($=J),re=1,X=1;X<=E;X++)if(re<<=1,re-=he[X],0>re)return-1;if(0<re&&(L===A||1!=Q))return-1;for(fe[1]=0,X=1;X<E;X++)fe[X+1]=fe[X]+he[X];for(V=0;V<W;V++)0!==U[Z+V]&&(G[fe[U[Z+V]]++]=V);if(L===A?(ue=_e=G,ce=19):L===B?(ue=T,pe-=257,_e=D,ge-=257,ce=256):(ue=F,_e=N,ce=-1),ne=0,V=0,X=J,le=H,ee=$,te=0,oe=-1,ae=1<<$,de=ae-1,L===B&&ae>I||L===R&&ae>O)return 1;for(;;){be=X-te,G[V]<ce?(ye=0,ke=G[V]):G[V]>ce?(ye=_e[ge+G[V]],ke=ue[pe+G[V]]):(ye=96,ke=0),se=1<<X-te,ie=1<<ee,J=ie;do ie-=se,M[le+(ne>>te)+ie]=0|(be<<24|ye<<16|ke);while(0!==ie);for(se=1<<X-1;ne&se;)se>>=1;if(0===se?ne=0:(ne&=se-1,ne+=se),V++,0==--he[X]){if(X==Q)break;X=U[Z+G[V]]}if(X>$&&(ne&de)!==oe){for(0==te&&(te=$),le+=J,ee=X-te,re=1<<ee;ee+te<Q&&(re-=he[ee+te],!(0>=re));)ee++,re<<=1;if(ae+=1<<ee,L===B&&ae>I||L===R&&ae>O)return 1;oe=ne&de,M[oe]=0|($<<24|ee<<16|le-H)}}return 0!=ne&&(M[le+ne]=0|(4194304|X-te<<24)),K.bits=$,0}},{"../utils/common":41}],51:[function(x,z){"use strict";z.exports={0:"",1:"stream end",2:"need dictionary","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(x,z,S){"use strict";function C(We){for(var Me=We.length;0<=--Me;)We[Me]=0}function E(We,Me,He,Ge,Ke){this.static_tree=We,this.extra_bits=Me,this.extra_base=He,this.elems=Ge,this.max_length=Ke,this.has_stree=We&&We.length}function I(We,Me){this.dyn_tree=We,this.max_code=0,this.stat_desc=Me}function O(We){return 256>We?De[We]:De[256+(We>>>7)]}function A(We,Me){We.pending_buf[We.pending++]=255&Me,We.pending_buf[We.pending++]=255&Me>>>8}function B(We,Me,He){We.bi_valid>xe-He?(We.bi_buf|=65535&Me<<We.bi_valid,A(We,We.bi_buf),We.bi_buf=Me>>xe-We.bi_valid,We.bi_valid+=He-xe):(We.bi_buf|=65535&Me<<We.bi_valid,We.bi_valid+=He)}function R(We,Me,He){B(We,He[2*Me],He[2*Me+1])}function T(We,Me){var He=0;do He|=1&We,We>>>=1,He<<=1;while(0<--Me);return He>>>1}function D(We){16===We.bi_valid?(A(We,We.bi_buf),We.bi_buf=0,We.bi_valid=0):8<=We.bi_valid&&(We.pending_buf[We.pending++]=255&We.bi_buf,We.bi_buf>>=8,We.bi_valid-=8)}function F(We,Me){var He=Me.dyn_tree,Ge=Me.max_code,Ke=Me.stat_desc.static_tree,Ye=Me.stat_desc.has_stree,Xe=Me.stat_desc.extra_bits,Ve=Me.stat_desc.extra_base,Je=Me.stat_desc.max_length,qe,Qe,$e,et,tt,rt,at=0;for(et=0;et<=ke;et++)We.bl_count[et]=0;for(He[2*We.heap[We.heap_max]+1]=0,qe=We.heap_max+1;qe<ye;qe++)(Qe=We.heap[qe],et=He[2*He[2*Qe+1]+1]+1,et>Je&&(et=Je,at++),He[2*Qe+1]=et,!(Qe>Ge))&&(We.bl_count[et]++,tt=0,Qe>=Ve&&(tt=Xe[Qe-Ve]),rt=He[2*Qe],We.opt_len+=rt*(et+tt),Ye&&(We.static_len+=rt*(Ke[2*Qe+1]+tt)));if(0!=at){do{for(et=Je-1;0===We.bl_count[et];)et--;We.bl_count[et]--,We.bl_count[et+1]+=2,We.bl_count[Je]--,at-=2}while(0<at);for(et=Je;0!==et;et--)for(Qe=We.bl_count[et];0!==Qe;)($e=We.heap[--qe],!($e>Ge))&&(He[2*$e+1]!==et&&(We.opt_len+=(et-He[2*$e+1])*He[2*$e],He[2*$e+1]=et),Qe--)}}function N(We,Me,He){var Ge=Array(ke+1),Ke=0,Ye,Xe;for(Ye=1;Ye<=ke;Ye++)Ge[Ye]=Ke=Ke+He[Ye-1]<<1;for(Xe=0;Xe<=Me;Xe++){var Ve=We[2*Xe+1];0!==Ve&&(We[2*Xe]=T(Ge[Ve]++,Ve))}}function P(){var We,Me,He,Ge,Ke,Ye=Array(ke+1);for(He=0,Ge=0;Ge<he-1;Ge++)for(Ne[Ge]=He,We=0;We<1<<Ee[Ge];We++)Fe[He++]=Ge;for(Fe[He-1]=Ge,Ke=0,Ge=0;16>Ge;Ge++)for(Pe[Ge]=Ke,We=0;We<1<<Ie[Ge];We++)De[Ke++]=Ge;for(Ke>>=7;Ge<ge;Ge++)for(Pe[Ge]=Ke<<7,We=0;We<1<<Ie[Ge]-7;We++)De[256+Ke++]=Ge;for(Me=0;Me<=ke;Me++)Ye[Me]=0;for(We=0;143>=We;)Re[2*We+1]=8,We++,Ye[8]++;for(;255>=We;)Re[2*We+1]=9,We++,Ye[9]++;for(;279>=We;)Re[2*We+1]=7,We++,Ye[7]++;for(;287>=We;)Re[2*We+1]=8,We++,Ye[8]++;for(N(Re,_e+1,Ye),We=0;We<ge;We++)Te[2*We+1]=5,Te[2*We]=T(We,5);Le=new E(Re,Ee,fe+1,_e,ke),Ue=new E(Te,Ie,0,ge,ke),je=new E([],Oe,0,be,7)}function L(We){var Me;for(Me=0;Me<_e;Me++)We.dyn_ltree[2*Me]=0;for(Me=0;Me<ge;Me++)We.dyn_dtree[2*Me]=0;for(Me=0;Me<be;Me++)We.bl_tree[2*Me]=0;We.dyn_ltree[2*ve]=1,We.opt_len=We.static_len=0,We.last_lit=We.matches=0}function U(We){8<We.bi_valid?A(We,We.bi_buf):0<We.bi_valid&&(We.pending_buf[We.pending++]=We.bi_buf),We.bi_buf=0,We.bi_valid=0}function Z(We,Me,He,Ge){U(We),Ge&&(A(We,He),A(We,~He)),ae.arraySet(We.pending_buf,We.window,Me,He,We.pending),We.pending+=He}function W(We,Me,He,Ge){var Ke=2*Me,Ye=2*He;return We[Ke]<We[Ye]||We[Ke]===We[Ye]&&Ge[Me]<=Ge[He]}function M(We,Me,He){for(var Ge=We.heap[He],Ke=He<<1;Ke<=We.heap_len&&(Ke<We.heap_len&&W(Me,We.heap[Ke+1],We.heap[Ke],We.depth)&&Ke++,!W(Me,Ge,We.heap[Ke],We.depth));)We.heap[He]=We.heap[Ke],He=Ke,Ke<<=1;We.heap[He]=Ge}function H(We,Me,He){var Ge,Ke,Ye=0,Xe,Ve;if(0!==We.last_lit)do Ge=We.pending_buf[We.d_buf+2*Ye]<<8|We.pending_buf[We.d_buf+2*Ye+1],Ke=We.pending_buf[We.l_buf+Ye],Ye++,0===Ge?R(We,Ke,Me):(Xe=Fe[Ke],R(We,Xe+fe+1,Me),Ve=Ee[Xe],0!==Ve&&(Ke-=Ne[Xe],B(We,Ke,Ve)),Ge--,Xe=O(Ge),R(We,Xe,He),Ve=Ie[Xe],0!==Ve&&(Ge-=Pe[Xe],B(We,Ge,Ve)));while(Ye<We.last_lit);R(We,ve,Me)}function G(We,Me){var He=Me.dyn_tree,Ge=Me.stat_desc.static_tree,Ke=Me.stat_desc.has_stree,Ye=Me.stat_desc.elems,Xe,Ve,Je=-1,qe;for(We.heap_len=0,We.heap_max=ye,Xe=0;Xe<Ye;Xe++)0===He[2*Xe]?He[2*Xe+1]=0:(We.heap[++We.heap_len]=Je=Xe,We.depth[Xe]=0);for(;2>We.heap_len;)qe=We.heap[++We.heap_len]=2>Je?++Je:0,He[2*qe]=1,We.depth[qe]=0,We.opt_len--,Ke&&(We.static_len-=Ge[2*qe+1]);for(Me.max_code=Je,Xe=We.heap_len>>1;1<=Xe;Xe--)M(We,He,Xe);qe=Ye;do Xe=We.heap[1],We.heap[1]=We.heap[We.heap_len--],M(We,He,1),Ve=We.heap[1],We.heap[--We.heap_max]=Xe,We.heap[--We.heap_max]=Ve,He[2*qe]=He[2*Xe]+He[2*Ve],We.depth[qe]=(We.depth[Xe]>=We.depth[Ve]?We.depth[Xe]:We.depth[Ve])+1,He[2*Xe+1]=He[2*Ve+1]=qe,We.heap[1]=qe++,M(We,He,1);while(2<=We.heap_len);We.heap[--We.heap_max]=We.heap[1],F(We,Me),N(He,Je,We.bl_count)}function K(We,Me,He){var Ge,Ke=-1,Ye,Xe=Me[1],Ve=0,Je=7,qe=4;for(0===Xe&&(Je=138,qe=3),Me[2*(He+1)+1]=65535,Ge=0;Ge<=He;Ge++){if(Ye=Xe,Xe=Me[2*(Ge+1)+1],++Ve<Je&&Ye===Xe)continue;else Ve<qe?We.bl_tree[2*Ye]+=Ve:0===Ye?10>=Ve?We.bl_tree[2*Se]++:We.bl_tree[2*Ce]++:(Ye!==Ke&&We.bl_tree[2*Ye]++,We.bl_tree[2*ze]++);Ve=0,Ke=Ye,0===Xe?(Je=138,qe=3):Ye===Xe?(Je=6,qe=3):(Je=7,qe=4)}}function Y(We,Me,He){var Ge,Ke=-1,Ye,Xe=Me[1],Ve=0,Je=7,qe=4;for(0===Xe&&(Je=138,qe=3),Ge=0;Ge<=He;Ge++){if(Ye=Xe,Xe=Me[2*(Ge+1)+1],++Ve<Je&&Ye===Xe)continue;else if(Ve<qe)do R(We,Ye,We.bl_tree);while(0!=--Ve);else 0===Ye?10>=Ve?(R(We,Se,We.bl_tree),B(We,Ve-3,3)):(R(We,Ce,We.bl_tree),B(We,Ve-11,7)):(Ye!==Ke&&(R(We,Ye,We.bl_tree),Ve--),R(We,ze,We.bl_tree),B(We,Ve-3,2));Ve=0,Ke=Ye,0===Xe?(Je=138,qe=3):Ye===Xe?(Je=6,qe=3):(Je=7,qe=4)}}function X(We){var Me;for(K(We,We.dyn_ltree,We.l_desc.max_code),K(We,We.dyn_dtree,We.d_desc.max_code),G(We,We.bl_desc),Me=be-1;3<=Me&&0===We.bl_tree[2*Ae[Me]+1];Me--);return We.opt_len+=3*(Me+1)+5+5+4,Me}function V(We,Me,He,Ge){var Ke;for(B(We,Me-257,5),B(We,He-1,5),B(We,Ge-4,4),Ke=0;Ke<Ge;Ke++)B(We,We.bl_tree[2*Ae[Ke]+1],3);Y(We,We.dyn_ltree,Me-1),Y(We,We.dyn_dtree,He-1)}function J(We){var Me=4093624447,He;for(He=0;31>=He;He++,Me>>>=1)if(1&Me&&0!==We.dyn_ltree[2*He])return se;if(0!==We.dyn_ltree[18]||0!==We.dyn_ltree[20]||0!==We.dyn_ltree[26])return ie;for(He=32;He<fe;He++)if(0!==We.dyn_ltree[2*He])return ie;return se}function $(We,Me,He,Ge){B(We,(0<<1)+(Ge?1:0),3),Z(We,Me,He,!0)}var ae=x("../utils/common"),se=0,ie=1,le=1,he=29,fe=256,_e=fe+1+he,ge=30,be=19,ye=2*_e+1,ke=15,xe=16,ve=256,ze=16,Se=17,Ce=18,Ee=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Ie=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Oe=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Ae=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Re=Array(2*(_e+2));C(Re);var Te=Array(2*ge);C(Te);var De=Array(512);C(De);var Fe=Array(258-3+1);C(Fe);var Ne=Array(he);C(Ne);var Pe=Array(ge);C(Pe);var Le,Ue,je,Ze=!1;S._tr_init=function(We){Ze||(P(),Ze=!0),We.l_desc=new I(We.dyn_ltree,Le),We.d_desc=new I(We.dyn_dtree,Ue),We.bl_desc=new I(We.bl_tree,je),We.bi_buf=0,We.bi_valid=0,L(We)},S._tr_stored_block=$,S._tr_flush_block=function(We,Me,He,Ge){var Ke,Ye,Xe=0;0<We.level?(We.strm.data_type===2&&(We.strm.data_type=J(We)),G(We,We.l_desc),G(We,We.d_desc),Xe=X(We),Ke=We.opt_len+3+7>>>3,Ye=We.static_len+3+7>>>3,Ye<=Ke&&(Ke=Ye)):Ke=Ye=He+5,He+4<=Ke&&-1!==Me?$(We,Me,He,Ge):We.strategy===4||Ye===Ke?(B(We,(le<<1)+(Ge?1:0),3),H(We,Re,Te)):(B(We,(2<<1)+(Ge?1:0),3),V(We,We.l_desc.max_code+1,We.d_desc.max_code+1,Xe+1),H(We,We.dyn_ltree,We.dyn_dtree)),L(We),Ge&&U(We)},S._tr_tally=function(We,Me,He){return We.pending_buf[We.d_buf+2*We.last_lit]=255&Me>>>8,We.pending_buf[We.d_buf+2*We.last_lit+1]=255&Me,We.pending_buf[We.l_buf+We.last_lit]=255&He,We.last_lit++,0===Me?We.dyn_ltree[2*He]++:(We.matches++,Me--,We.dyn_ltree[2*(Fe[He]+fe+1)]++,We.dyn_dtree[2*O(Me)]++),We.last_lit===We.lit_bufsize-1},S._tr_align=function(We){B(We,le<<1,3),R(We,ve,Re),D(We)}},{"../utils/common":41}],53:[function(x,z){"use strict";z.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(x,z){"use strict";z.exports="function"==typeof setImmediate?setImmediate:function(){var E=[].slice.apply(arguments);E.splice(1,0,0),setTimeout.apply(null,E)}},{}]},{},[10])(10)});

var THREE={REVISION:"58"};(function(){var n=0;var e=["ms","moz","webkit","o"];for(var t=0;t<e.length&&!window.requestAnimationFrame;++t){window.requestAnimationFrame=window[e[t]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[e[t]+"CancelAnimationFrame"]||window[e[t]+"CancelRequestAnimationFrame"]}if(window.requestAnimationFrame===undefined){window.requestAnimationFrame=function(e){var t=Date.now(),i=Math.max(0,16-(t-n));var r=window.setTimeout(function(){e(t+i)},i);n=t+i;return r}}window.cancelAnimationFrame=window.cancelAnimationFrame||function(e){window.clearTimeout(e)}})();THREE.CullFaceNone=0;THREE.CullFaceBack=1;THREE.CullFaceFront=2;THREE.CullFaceFrontBack=3;THREE.FrontFaceDirectionCW=0;THREE.FrontFaceDirectionCCW=1;THREE.BasicShadowMap=0;THREE.PCFShadowMap=1;THREE.PCFSoftShadowMap=2;THREE.FrontSide=0;THREE.BackSide=1;THREE.DoubleSide=2;THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NoBlending=0;THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;THREE.CustomBlending=5;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;THREE.ZeroFactor=200;THREE.OneFactor=201;THREE.SrcColorFactor=202;THREE.OneMinusSrcColorFactor=203;THREE.SrcAlphaFactor=204;THREE.OneMinusSrcAlphaFactor=205;THREE.DstAlphaFactor=206;THREE.OneMinusDstAlphaFactor=207;THREE.DstColorFactor=208;THREE.OneMinusDstColorFactor=209;THREE.SrcAlphaSaturateFactor=210;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.AddOperation=2;THREE.UVMapping=function(){};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.RepeatWrapping=1e3;THREE.ClampToEdgeWrapping=1001;THREE.MirroredRepeatWrapping=1002;THREE.NearestFilter=1003;THREE.NearestMipMapNearestFilter=1004;THREE.NearestMipMapLinearFilter=1005;THREE.LinearFilter=1006;THREE.LinearMipMapNearestFilter=1007;THREE.LinearMipMapLinearFilter=1008;THREE.UnsignedByteType=1009;THREE.ByteType=1010;THREE.ShortType=1011;THREE.UnsignedShortType=1012;THREE.IntType=1013;THREE.UnsignedIntType=1014;THREE.FloatType=1015;THREE.UnsignedShort4444Type=1016;THREE.UnsignedShort5551Type=1017;THREE.UnsignedShort565Type=1018;THREE.AlphaFormat=1019;THREE.RGBFormat=1020;THREE.RGBAFormat=1021;THREE.LuminanceFormat=1022;THREE.LuminanceAlphaFormat=1023;THREE.RGB_S3TC_DXT1_Format=2001;THREE.RGBA_S3TC_DXT1_Format=2002;THREE.RGBA_S3TC_DXT3_Format=2003;THREE.RGBA_S3TC_DXT5_Format=2004;THREE.Color=function(e){if(e!==undefined)this.set(e);return this};THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(e){this.value=e;if(e instanceof THREE.Color){this.copy(e)}else if(typeof e==="number"){this.setHex(e)}else if(typeof e==="string"){this.setStyle(e)}else if(Array.isArray(e)){this.setArray(e)}return this},setArray:function(e){this.r=e[0]/255;this.g=e[1]/255;this.b=e[2]/255;return this},setHex:function(e){e=Math.floor(e);this.r=(e>>16&255)/255;this.g=(e>>8&255)/255;this.b=(e&255)/255;return this},setRGB:function(e,t,i){this.r=e;this.g=t;this.b=i;return this},setHSL:function(e,t,i){if(t===0){this.r=this.g=this.b=i}else{var r=function(e,t,i){if(i<0)i+=1;if(i>1)i-=1;if(i<1/6)return e+(t-e)*6*i;if(i<1/2)return t;if(i<2/3)return e+(t-e)*6*(2/3-i);return e};var n=i<=.5?i*(1+t):i+t-i*t;var a=2*i-n;this.r=r(a,n,e+1/3);this.g=r(a,n,e);this.b=r(a,n,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+),(\d+),(\d+)\)$/i.test(e)){var t=/^rgb\((\d+),(\d+),(\d+)\)$/i.exec(e);this.r=Math.min(255,parseInt(t[1],10))/255;this.g=Math.min(255,parseInt(t[2],10))/255;this.b=Math.min(255,parseInt(t[3],10))/255;return this}if(/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.test(e)){var t=/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.exec(e);this.r=Math.min(100,parseInt(t[1],10))/100;this.g=Math.min(100,parseInt(t[2],10))/100;this.b=Math.min(100,parseInt(t[3],10))/100;return this}if(/^\#([0-9a-f]{6})$/i.test(e)){var t=/^\#([0-9a-f]{6})$/i.exec(e);this.setHex(parseInt(t[1],16));return this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){var t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16));return this}if(/^(\w+)$/i.test(e)){this.setHex(THREE.ColorKeywords[e]);return this}},copy:function(e){this.r=e.r;this.g=e.g;this.b=e.b;return this},copyGammaToLinear:function(e){this.r=e.r*e.r;this.g=e.g*e.g;this.b=e.b*e.b;return this},copyLinearToGamma:function(e){this.r=Math.sqrt(e.r);this.g=Math.sqrt(e.g);this.b=Math.sqrt(e.b);return this},convertGammaToLinear:function(){var e=this.r,t=this.g,i=this.b;this.r=e*e;this.g=t*t;this.b=i*i;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(){var h={h:0,s:0,l:0};return function(){var e=this.r,t=this.g,i=this.b;var r=Math.max(e,t,i);var n=Math.min(e,t,i);var a,o;var s=(n+r)/2;if(n===r){a=0;o=0}else{var l=r-n;o=s<=.5?l/(r+n):l/(2-r-n);switch(r){case e:a=(t-i)/l+(t<i?6:0);break;case t:a=(i-e)/l+2;break;case i:a=(e-t)/l+4;break}a/=6}h.h=a;h.s=o;h.l=s;return h}}(),getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(e,t,i){var r=this.getHSL();r.h+=e;r.s+=t;r.l+=i;this.setHSL(r.h,r.s,r.l);return this},add:function(e){this.r+=e.r;this.g+=e.g;this.b+=e.b;return this},addColors:function(e,t){this.r=e.r+t.r;this.g=e.g+t.g;this.b=e.b+t.b;return this},addScalar:function(e){this.r+=e;this.g+=e;this.b+=e;return this},multiply:function(e){this.r*=e.r;this.g*=e.g;this.b*=e.b;return this},multiplyScalar:function(e){this.r*=e;this.g*=e;this.b*=e;return this},lerp:function(e,t){this.r+=(e.r-this.r)*t;this.g+=(e.g-this.g)*t;this.b+=(e.b-this.b)*t;return this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}};THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};THREE.Quaternion=function(e,t,i,r){this.x=e||0;this.y=t||0;this.z=i||0;this.w=r!==undefined?r:1};THREE.Quaternion.prototype={constructor:THREE.Quaternion,set:function(e,t,i,r){this.x=e;this.y=t;this.z=i;this.w=r;return this},copy:function(e){this.x=e.x;this.y=e.y;this.z=e.z;this.w=e.w;return this},setFromEuler:function(e,t){var i=Math.cos(e.x/2);var r=Math.cos(e.y/2);var n=Math.cos(e.z/2);var a=Math.sin(e.x/2);var o=Math.sin(e.y/2);var s=Math.sin(e.z/2);if(t===undefined||t==="XYZ"){this.x=a*r*n+i*o*s;this.y=i*o*n-a*r*s;this.z=i*r*s+a*o*n;this.w=i*r*n-a*o*s}else if(t==="YXZ"){this.x=a*r*n+i*o*s;this.y=i*o*n-a*r*s;this.z=i*r*s-a*o*n;this.w=i*r*n+a*o*s}else if(t==="ZXY"){this.x=a*r*n-i*o*s;this.y=i*o*n+a*r*s;this.z=i*r*s+a*o*n;this.w=i*r*n-a*o*s}else if(t==="ZYX"){this.x=a*r*n-i*o*s;this.y=i*o*n+a*r*s;this.z=i*r*s-a*o*n;this.w=i*r*n+a*o*s}else if(t==="YZX"){this.x=a*r*n+i*o*s;this.y=i*o*n+a*r*s;this.z=i*r*s-a*o*n;this.w=i*r*n-a*o*s}else if(t==="XZY"){this.x=a*r*n-i*o*s;this.y=i*o*n-a*r*s;this.z=i*r*s+a*o*n;this.w=i*r*n+a*o*s}return this},setFromAxisAngle:function(e,t){var i=t/2,r=Math.sin(i);this.x=e.x*r;this.y=e.y*r;this.z=e.z*r;this.w=Math.cos(i);return this},setFromRotationMatrix:function(e){var t=e.elements,i=t[0],r=t[4],n=t[8],a=t[1],o=t[5],s=t[9],l=t[2],h=t[6],f=t[10],c=i+o+f,u;if(c>0){u=.5/Math.sqrt(c+1);this.w=.25/u;this.x=(h-s)*u;this.y=(n-l)*u;this.z=(a-r)*u}else if(i>o&&i>f){u=2*Math.sqrt(1+i-o-f);this.w=(h-s)/u;this.x=.25*u;this.y=(r+a)/u;this.z=(n+l)/u}else if(o>f){u=2*Math.sqrt(1+o-i-f);this.w=(n-l)/u;this.x=(r+a)/u;this.y=.25*u;this.z=(s+h)/u}else{u=2*Math.sqrt(1+f-i-o);this.w=(a-r)/u;this.x=(n+l)/u;this.y=(s+h)/u;this.z=.25*u}return this},inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=this.length();if(e===0){this.x=0;this.y=0;this.z=0;this.w=1}else{e=1/e;this.x=this.x*e;this.y=this.y*e;this.z=this.z*e;this.w=this.w*e}return this},multiply:function(e,t){if(t!==undefined){return this.multiplyQuaternions(e,t)}return this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var i=e.x,r=e.y,n=e.z,a=e.w;var o=t.x,s=t.y,l=t.z,h=t.w;this.x=i*h+a*o+r*l-n*s;this.y=r*h+a*s+n*o-i*l;this.z=n*h+a*l+i*s-r*o;this.w=a*h-i*o-r*s-n*l;return this},slerp:function(e,t){var i=this.x,r=this.y,n=this.z,a=this.w;var o=a*e.w+i*e.x+r*e.y+n*e.z;if(o<0){this.w=-e.w;this.x=-e.x;this.y=-e.y;this.z=-e.z;o=-o}else{this.copy(e)}if(o>=1){this.w=a;this.x=i;this.y=r;this.z=n;return this}const s=1-o*o;if(s<=Number.EPSILON){const u=1-t;this.w=u*a+t*this.w;this.x=u*i+t*this.x;this.y=u*r+t*this.y;this.z=u*n+t*this.z;this.normalize();return this}const l=Math.sqrt(s);const h=Math.atan2(l,o);var f=Math.sin((1-t)*h)/l,c=Math.sin(t*h)/l;this.w=a*f+this.w*c;this.x=i*f+this.x*c;this.y=r*f+this.y*c;this.z=n*f+this.z*c;return this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){this.x=e[0];this.y=e[1];this.z=e[2];this.w=e[3];return this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new THREE.Quaternion(this.x,this.y,this.z,this.w)},toAxisAngle:function(){if(this.w>1)this.normalize();var e=2*Math.acos(this.w);var t=Math.sqrt(1-this.w*this.w);if(t<1e-4){x=1;y=0;z=0}else{x=this.x/t;y=this.y/t;z=this.z/t}return[new THREE.Vector3(x,y,z),e]},setFromUnitVectors:function(e,t){let i=e.dot(t)+1;if(i<Number.EPSILON){i=0;if(Math.abs(e.x)>Math.abs(e.z)){this.x=-e.y;this.y=e.x;this.z=0;this.w=i}else{this.x=0;this.y=-e.z;this.z=e.y;this.w=i}}else{this.x=e.y*t.z-e.z*t.y;this.y=e.z*t.x-e.x*t.z;this.z=e.x*t.y-e.y*t.x;this.w=i}return this.normalize()},setFromBasis:function(){var t;window.addEventListener("jThree_ready",()=>{t=new THREE.Vector3});return function(e){return this.setFromEuler(t.setEulerFromRotationMatrix(e))}}()};THREE.Quaternion.prototype.premultiply=function(e){return this.multiplyQuaternions(e,this)};THREE.Quaternion.prototype.setFromVectorSpherical=function(){var r;window.addEventListener("jThree_ready",()=>{r=new THREE.Vector3});return function(e,t){var i=e.y?"XZY":"YZX";return this.setFromEuler(r.setFromVectorSpherical(e,t),i)}}();THREE.Quaternion.slerp=function(e,t,i,r){return i.copy(e).slerp(t,r)};THREE.Vector2=function(e,t){this.x=e||0;this.y=t||0};THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(e,t){this.x=e;this.y=t;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setComponent:function(e,t){this[e?"y":"x"]=t},getComponent:function(e){return this[e?"y":"x"]},copy:function(e){this.x=e.x;this.y=e.y;return this},add:function(e,t){this.x+=e.x;this.y+=e.y;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;return this},addScalar:function(e){this.x+=e;this.y+=e;return this},sub:function(e,t){this.x-=e.x;this.y-=e.y;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;return this},divideScalar:function(e){if(e!==0){this.x/=e;this.y/=e}else{this.set(0,0)}return this},min:function(e){if(this.x>e.x){this.x=e.x}if(this.y>e.y){this.y=e.y}return this},max:function(e){if(this.x<e.x){this.x=e.x}if(this.y<e.y){this.y=e.y}return this},clamp:function(e,t){if(this.x<e.x){this.x=e.x}else if(this.x>t.x){this.x=t.x}if(this.y<e.y){this.y=e.y}else if(this.y>t.y){this.y=t.y}return this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},setLength:function(e){var t=this.length();if(t!==0&&e!==t){this.multiplyScalar(e/t)}return this},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;return this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e){this.x=e[0];this.y=e[1];return this},toArray:function(){return[this.x,this.y]},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(e,t,i){this.x=e||0;this.y=t||0;this.z=i||0};THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,t,i){this.x=e;this.y=t;this.z=i;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setZ:function(e){this.z=e;return this},setComponent:function(e,t){this[e===0?"x":e===1?"y":"z"]=t},getComponent:function(e){return this[e===0?"x":e===1?"y":"z"]},copy:function(e){this.x=e.x;this.y=e.y;this.z=e.z;return this},add:function(e,t){this.x+=e.x;this.y+=e.y;this.z+=e.z;return this},addScalar:function(e){this.x+=e;this.y+=e;this.z+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;return this},sub:function(e,t){this.x-=e.x;this.y-=e.y;this.z-=e.z;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;return this},multiply:function(e,t){this.x*=e.x;this.y*=e.y;this.z*=e.z;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;this.z*=e;return this},multiplyVectors:function(e,t){this.x=e.x*t.x;this.y=e.y*t.y;this.z=e.z*t.z;return this},applyMatrix3:function(e){var t=this.x;var i=this.y;var r=this.z;var n=e.elements;this.x=n[0]*t+n[3]*i+n[6]*r;this.y=n[1]*t+n[4]*i+n[7]*r;this.z=n[2]*t+n[5]*i+n[8]*r;return this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z;var n=e.elements;this.x=n[0]*t+n[4]*i+n[8]*r+n[12];this.y=n[1]*t+n[5]*i+n[9]*r+n[13];this.z=n[2]*t+n[6]*i+n[10]*r+n[14];return this},applyProjection:function(e){var t=this.x,i=this.y,r=this.z;var n=e.elements;var a=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*a;this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*a;this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*a;return this},applyQuaternion:function(e){var t=this.x;var i=this.y;var r=this.z;var n=e.x;var a=e.y;var o=e.z;var s=e.w;var l=s*t+a*r-o*i;var h=s*i+o*t-n*r;var f=s*r+n*i-a*t;var c=-n*t-a*i-o*r;this.x=l*s+c*-n+h*-o-f*-a;this.y=h*s+c*-a+f*-n-l*-o;this.z=f*s+c*-o+l*-a-h*-n;return this},transformDirection:function(e){var t=this.x,i=this.y,r=this.z;var n=e.elements;this.x=n[0]*t+n[4]*i+n[8]*r;this.y=n[1]*t+n[5]*i+n[9]*r;this.z=n[2]*t+n[6]*i+n[10]*r;this.normalize();return this},divide:function(e){this.x/=e.x;this.y/=e.y;this.z/=e.z;return this},divideScalar:function(e){if(e!==0){this.x/=e;this.y/=e;this.z/=e}else{this.x=0;this.y=0;this.z=0}return this},min:function(e){if(this.x>e.x){this.x=e.x}if(this.y>e.y){this.y=e.y}if(this.z>e.z){this.z=e.z}return this},max:function(e){if(this.x<e.x){this.x=e.x}if(this.y<e.y){this.y=e.y}if(this.z<e.z){this.z=e.z}return this},clamp:function(e,t){if(this.x<e.x){this.x=e.x}else if(this.x>t.x){this.x=t.x}if(this.y<e.y){this.y=e.y}else if(this.y>t.y){this.y=t.y}if(this.z<e.z){this.z=e.z}else if(this.z>t.z){this.z=t.z}return this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();if(t!==0&&e!==t){this.multiplyScalar(e/t)}return this},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;return this},cross:function(e,t){var i=this.x,r=this.y,n=this.z;this.x=r*e.z-n*e.y;this.y=n*e.x-i*e.z;this.z=i*e.y-r*e.x;return this},crossVectors:function(e,t){this.x=e.y*t.z-e.z*t.y;this.y=e.z*t.x-e.x*t.z;this.z=e.x*t.y-e.y*t.x;return this},angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(THREE.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x;var i=this.y-e.y;var r=this.z-e.z;return t*t+i*i+r*r},setEulerFromRotationMatrix:function(e,t){function i(e){return Math.min(Math.max(e,-1),1)}var r=e.elements;var n=r[0],a=r[4],o=r[8];var s=r[1],l=r[5],h=r[9];var f=r[2],c=r[6],u=r[10];if(t===undefined||t==="XYZ"){this.y=Math.asin(i(o));if(Math.abs(o)<.99999){this.x=Math.atan2(-h,u);this.z=Math.atan2(-a,n)}else{this.x=Math.atan2(c,l);this.z=0}}else if(t==="YXZ"){this.x=Math.asin(-i(h));if(Math.abs(h)<.99999){this.y=Math.atan2(o,u);this.z=Math.atan2(s,l)}else{this.y=Math.atan2(-f,n);this.z=0}}else if(t==="ZXY"){this.x=Math.asin(i(c));if(Math.abs(c)<.99999){this.y=Math.atan2(-f,u);this.z=Math.atan2(-a,l)}else{this.y=0;this.z=Math.atan2(s,n)}}else if(t==="ZYX"){this.y=Math.asin(-i(f));if(Math.abs(f)<.99999){this.x=Math.atan2(c,u);this.z=Math.atan2(s,n)}else{this.x=0;this.z=Math.atan2(-a,l)}}else if(t==="YZX"){this.z=Math.asin(i(s));if(Math.abs(s)<.99999){this.x=Math.atan2(-h,l);this.y=Math.atan2(-f,n)}else{this.x=0;this.y=Math.atan2(o,u)}}else if(t==="XZY"){this.z=Math.asin(-i(a));if(Math.abs(a)<.99999){this.x=Math.atan2(c,l);this.y=Math.atan2(o,n)}else{this.x=Math.atan2(-h,u);this.y=0}}return this},setEulerFromQuaternion:function(){var i;window.addEventListener("jThree_ready",function(){i=new THREE.Matrix4});return function(e,t){i.makeRotationFromQuaternion(e);return this.setEulerFromRotationMatrix(i,t)}}(),getPositionFromMatrix:function(e){this.x=e.elements[12];this.y=e.elements[13];this.z=e.elements[14];return this},getScaleFromMatrix:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length();var i=this.set(e.elements[4],e.elements[5],e.elements[6]).length();var r=this.set(e.elements[8],e.elements[9],e.elements[10]).length();this.x=t;this.y=i;this.z=r;return this},getColumnFromMatrix:function(e,t){var i=e*4;var r=t.elements;this.x=r[i];this.y=r[i+1];this.z=r[i+2];return this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e){this.x=e[0];this.y=e[1];this.z=e[2];return this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)},applyEuler:function(){var r=new THREE.Quaternion;return function(e,t){var i=r.setFromEuler(e,t);this.applyQuaternion(i);return this}}(),applyAxisAngle:function(){var r=new THREE.Quaternion;return function(e,t){var i=r.setFromAxisAngle(e,t);this.applyQuaternion(i);return this}}(),project:function(){var i;return function e(t){if(i===undefined)i=new THREE.Matrix4;i.multiplyMatrices(t.projectionMatrix,i.getInverse(t.matrixWorld));return this.applyProjection(i)}}(),unproject:function(){var i;return function e(t){if(i===undefined)i=new THREE.Matrix4;i.multiplyMatrices(t.matrixWorld,i.getInverse(t.projectionMatrix));return this.applyProjection(i)}}(),toSphericalCoords:function(e){var t=this.x,i=this.y,r=this.z;var n,a;const o=e||Math.sqrt(t*t+i*i+r*r);if(o===0){n=0;a=0}else{n=Math.atan2(t,r);a=Math.acos(THREE.Math.clamp(i/o,-1,1))}return[o,n,a]},get _x(){return this.x},set _x(e){this.x=e},get _y(){return this.y},set _y(e){this.y=e},get _z(){return this.z},set _z(e){this.z=e}};THREE.Vector3.prototype.setFromMatrixPosition=THREE.Vector3.prototype.getPositionFromMatrix;THREE.Euler=THREE.Vector3;THREE.Euler.prototype._order="XYZ";THREE.Euler.prototype.isEuler=true;THREE.Euler.prototype._onChangeCallback=function(){};THREE.Euler.prototype.setFromQuaternion=THREE.Euler.prototype.setEulerFromQuaternion;THREE.Vector3.prototype.setFromVectorSpherical=function(){var r=new THREE.Vector3;return function(e,t){var i;if(e.y){r.set(-t.z,t.x,-t.y);if(e.y>0)r.negate();i=r.toSphericalCoords(1);this.set(i[1],0,Math.PI/2-i[2])}else if(e.x){r.set(-t.z,t.y,t.x);if(e.x<0)r.negate();i=r.toSphericalCoords(1);this.set(0,i[1],Math.PI/2-i[2])}return this}}();THREE.Vector3.prototype.projectOnVector=function(){var i=new THREE.Vector3;return function(e){i.copy(e).normalize();var t=this.dot(i);return this.copy(i).multiplyScalar(t)}}();THREE.Vector3.prototype.projectOnPlane=function(){var t=new THREE.Vector3;return function(e){t.copy(this).projectOnVector(e);return this.sub(t)}}();THREE.Vector3.prototype.reflect=function(){var t=new THREE.Vector3;return function(e){t.copy(this).projectOnVector(e).multiplyScalar(2);return this.subVectors(t,this)}}();THREE.Vector4=function(e,t,i,r){this.x=e||0;this.y=t||0;this.z=i||0;this.w=r!==undefined?r:1};THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(e,t,i,r){this.x=e;this.y=t;this.z=i;this.w=r;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setZ:function(e){this.z=e;return this},setW:function(e){this.w=e;return this},setComponent:function(e,t){this[e===0?"x":e===1?"y":e===2?"z":"w"]=t},getComponent:function(e){return this[e===0?"x":e===1?"y":e===2?"z":"w"]},copy:function(e){this.x=e.x;this.y=e.y;this.z=e.z;this.w=e.w!==undefined?e.w:1;return this},add:function(e,t){this.x+=e.x;this.y+=e.y;this.z+=e.z;this.w+=e.w;return this},addScalar:function(e){this.x+=e;this.y+=e;this.z+=e;this.w+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;this.w=e.w+t.w;return this},sub:function(e,t){this.x-=e.x;this.y-=e.y;this.z-=e.z;this.w-=e.w;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;this.w=e.w-t.w;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;this.z*=e;this.w*=e;return this},applyMatrix4:function(e){var t=this.x;var i=this.y;var r=this.z;var n=this.w;var a=e.elements;this.x=a[0]*t+a[4]*i+a[8]*r+a[12]*n;this.y=a[1]*t+a[5]*i+a[9]*r+a[13]*n;this.z=a[2]*t+a[6]*i+a[10]*r+a[14]*n;this.w=a[3]*t+a[7]*i+a[11]*r+a[15]*n;return this},divideScalar:function(e){if(e!==0){this.x/=e;this.y/=e;this.z/=e;this.w/=e}else{this.x=0;this.y=0;this.z=0;this.w=1}return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);if(t<1e-4){this.x=1;this.y=0;this.z=0}else{this.x=e.x/t;this.y=e.y/t;this.z=e.z/t}return this},setAxisAngleFromRotationMatrix:function(e){var t,i,r,n,a=.01,o=.1,s=e.elements,l=s[0],h=s[4],f=s[8],c=s[1],u=s[5],d=s[9],p=s[2],m=s[6],E=s[10];if(Math.abs(h-c)<a&&Math.abs(f-p)<a&&Math.abs(d-m)<a){if(Math.abs(h+c)<o&&Math.abs(f+p)<o&&Math.abs(d+m)<o&&Math.abs(l+u+E-3)<o){this.set(1,0,0,0);return this}t=Math.PI;var g=(l+1)/2;var v=(u+1)/2;var T=(E+1)/2;var y=(h+c)/4;var _=(f+p)/4;var R=(d+m)/4;if(g>v&&g>T){if(g<a){i=0;r=.707106781;n=.707106781}else{i=Math.sqrt(g);r=y/i;n=_/i}}else if(v>T){if(v<a){i=.707106781;r=0;n=.707106781}else{r=Math.sqrt(v);i=y/r;n=R/r}}else{if(T<a){i=.707106781;r=.707106781;n=0}else{n=Math.sqrt(T);i=_/n;r=R/n}}this.set(i,r,n,t);return this}var x=Math.sqrt((m-d)*(m-d)+(f-p)*(f-p)+(c-h)*(c-h));if(Math.abs(x)<.001)x=1;this.x=(m-d)/x;this.y=(f-p)/x;this.z=(c-h)/x;this.w=Math.acos((l+u+E-1)/2);return this},min:function(e){if(this.x>e.x){this.x=e.x}if(this.y>e.y){this.y=e.y}if(this.z>e.z){this.z=e.z}if(this.w>e.w){this.w=e.w}return this},max:function(e){if(this.x<e.x){this.x=e.x}if(this.y<e.y){this.y=e.y}if(this.z<e.z){this.z=e.z}if(this.w<e.w){this.w=e.w}return this},clamp:function(e,t){if(this.x<e.x){this.x=e.x}else if(this.x>t.x){this.x=t.x}if(this.y<e.y){this.y=e.y}else if(this.y>t.y){this.y=t.y}if(this.z<e.z){this.z=e.z}else if(this.z>t.z){this.z=t.z}if(this.w<e.w){this.w=e.w}else if(this.w>t.w){this.w=t.w}return this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();if(t!==0&&e!==t){this.multiplyScalar(e/t)}return this},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;this.w+=(e.w-this.w)*t;return this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){this.x=e[0];this.y=e[1];this.z=e[2];this.w=e[3];return this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};THREE.Line3=function(e,t){this.start=e!==undefined?e:new THREE.Vector3;this.end=t!==undefined?t:new THREE.Vector3};THREE.Line3.prototype={constructor:THREE.Line3,set:function(e,t){this.start.copy(e);this.end.copy(t);return this},copy:function(e){this.start.copy(e.start);this.end.copy(e.end);return this},center:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new THREE.Vector3;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var i=t||new THREE.Vector3;return this.delta(i).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var a=new THREE.Vector3;var o=new THREE.Vector3;return function(e,t){a.subVectors(e,this.start);o.subVectors(this.end,this.start);var i=o.dot(o);var r=o.dot(a);var n=r/i;if(t){n=THREE.Math.clamp(n,0,1)}return n}}(),closestPointToPoint:function(e,t,i){var r=this.closestPointToPointParameter(e,t);var n=i||new THREE.Vector3;return this.delta(n).multiplyScalar(r).add(this.start)},applyMatrix4:function(e){this.start.applyMatrix4(e);this.end.applyMatrix4(e);return this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}};THREE.Box2=function(e,t){this.min=e!==undefined?e:new THREE.Vector2(Infinity,Infinity);this.max=t!==undefined?t:new THREE.Vector2(-Infinity,-Infinity)};THREE.Box2.prototype={constructor:THREE.Box2,set:function(e,t){this.min.copy(e);this.max.copy(t);return this},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t);this.max.copy(t);for(var i=1,r=e.length;i<r;i++){t=e[i];if(t.x<this.min.x){this.min.x=t.x}else if(t.x>this.max.x){this.max.x=t.x}if(t.y<this.min.y){this.min.y=t.y}else if(t.y>this.max.y){this.max.y=t.y}}}else{this.makeEmpty()}return this},setFromCenterAndSize:function(){var r=new THREE.Vector2;return function(e,t){var i=r.copy(t).multiplyScalar(.5);this.min.copy(e).sub(i);this.max.copy(e).add(i);return this}}(),copy:function(e){this.min.copy(e.min);this.max.copy(e.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new THREE.Vector2;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new THREE.Vector2;return t.subVectors(this.max,this.min)},expandByPoint:function(e){this.min.min(e);this.max.max(e);return this},expandByVector:function(e){this.min.sub(e);this.max.add(e);return this},expandByScalar:function(e){this.min.addScalar(-e);this.max.addScalar(e);return this},containsPoint:function(e){if(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y){return false}return true},containsBox:function(e){if(this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y){return true}return false},getParameter:function(e){return new THREE.Vector2((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){if(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y){return false}return true},clampPoint:function(e,t){var i=t||new THREE.Vector2;return i.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var i=new THREE.Vector2;return function(e){var t=i.copy(e).clamp(this.min,this.max);return t.sub(e).length()}}(),intersect:function(e){this.min.max(e.min);this.max.min(e.max);return this},union:function(e){this.min.min(e.min);this.max.max(e.max);return this},translate:function(e){this.min.add(e);this.max.add(e);return this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}};THREE.Box3=function(e,t){this.min=e!==undefined?e:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=t!==undefined?t:new THREE.Vector3(-Infinity,-Infinity,-Infinity)};THREE.Box3.prototype={constructor:THREE.Box3,set:function(e,t){this.min.copy(e);this.max.copy(t);return this},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t);this.max.copy(t);for(var i=1,r=e.length;i<r;i++){t=e[i];if(t.x<this.min.x){this.min.x=t.x}else if(t.x>this.max.x){this.max.x=t.x}if(t.y<this.min.y){this.min.y=t.y}else if(t.y>this.max.y){this.max.y=t.y}if(t.z<this.min.z){this.min.z=t.z}else if(t.z>this.max.z){this.max.z=t.z}}}else{this.makeEmpty()}return this},setFromCenterAndSize:function(){var r=new THREE.Vector3;return function(e,t){var i=r.copy(t).multiplyScalar(.5);this.min.copy(e).sub(i);this.max.copy(e).add(i);return this}}(),copy:function(e){this.min.copy(e.min);this.max.copy(e.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new THREE.Vector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){this.min.min(e);this.max.max(e);return this},expandByVector:function(e){this.min.sub(e);this.max.add(e);return this},expandByScalar:function(e){this.min.addScalar(-e);this.max.addScalar(e);return this},containsPoint:function(e){if(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z){return false}return true},containsBox:function(e){if(this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z){return true}return false},getParameter:function(e){return new THREE.Vector3((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){if(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z){return false}return true},clampPoint:function(e,t){var i=t||new THREE.Vector3;return i.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var i=new THREE.Vector3;return function(e){var t=i.copy(e).clamp(this.min,this.max);return t.sub(e).length()}}(),getBoundingSphere:function(){var i=new THREE.Vector3;return function(e){var t=e||new THREE.Sphere;t.center=this.center();t.radius=this.size(i).length()*.5;return t}}(),intersect:function(e){this.min.max(e.min);this.max.min(e.max);return this},union:function(e){this.min.min(e.min);this.max.max(e.max);return this},applyMatrix4:function(){var t=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(e){t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e);t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e);t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e);t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e);t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e);t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e);t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e);t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e);this.makeEmpty();this.setFromPoints(t);return this}}(),translate:function(e){this.min.add(e);this.max.add(e);return this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}};THREE.Matrix3=function(e,t,i,r,n,a,o,s,l){this.elements=new Float32Array(9);this.set(e!==undefined?e:1,t||0,i||0,r||0,n!==undefined?n:1,a||0,o||0,s||0,l!==undefined?l:1)};THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(e,t,i,r,n,a,o,s,l){var h=this.elements;h[0]=e;h[3]=t;h[6]=i;h[1]=r;h[4]=n;h[7]=a;h[2]=o;h[5]=s;h[8]=l;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},copy:function(e){var t=e.elements;this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]);return this},multiplyVector3Array:function(){var r=new THREE.Vector3;return function(e){for(var t=0,i=e.length;t<i;t+=3){r.x=e[t];r.y=e[t+1];r.z=e[t+2];r.applyMatrix3(this);e[t]=r.x;e[t+1]=r.y;e[t+2]=r.z}return e}}(),multiplyScalar:function(e){var t=this.elements;t[0]*=e;t[3]*=e;t[6]*=e;t[1]*=e;t[4]*=e;t[7]*=e;t[2]*=e;t[5]*=e;t[8]*=e;return this},determinant:function(){var e=this.elements;var t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],o=e[5],s=e[6],l=e[7],h=e[8];return t*a*h-t*o*l-i*n*h+i*o*s+r*n*l-r*a*s},getInverse:function(e){var t=e.elements;var i=this.elements;i[0]=t[10]*t[5]-t[6]*t[9];i[1]=-t[10]*t[1]+t[2]*t[9];i[2]=t[6]*t[1]-t[2]*t[5];i[3]=-t[10]*t[4]+t[6]*t[8];i[4]=t[10]*t[0]-t[2]*t[8];i[5]=-t[6]*t[0]+t[2]*t[4];i[6]=t[9]*t[4]-t[5]*t[8];i[7]=-t[9]*t[0]+t[1]*t[8];i[8]=t[5]*t[0]-t[1]*t[4];var r=t[0]*i[0]+t[1]*i[3]+t[2]*i[6];if(r===0){this.identity();return this}this.multiplyScalar(1/r);return this},transpose:function(){var e,t=this.elements;e=t[1];t[1]=t[3];t[3]=e;e=t[2];t[2]=t[6];t[6]=e;e=t[5];t[5]=t[7];t[7]=e;return this},getNormalMatrix:function(e){this.getInverse(e).transpose();return this},transposeIntoArray:function(e){var t=this.elements;e[0]=t[0];e[1]=t[3];e[2]=t[6];e[3]=t[1];e[4]=t[4];e[5]=t[7];e[6]=t[2];e[7]=t[5];e[8]=t[8];return this},clone:function(){var e=this.elements;return new THREE.Matrix3(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}};THREE.Matrix4=function(e,t,i,r,n,a,o,s,l,h,f,c,u,d,p,m){var E=this.elements=new Float32Array(16);E[0]=e!==undefined?e:1;E[4]=t||0;E[8]=i||0;E[12]=r||0;E[1]=n||0;E[5]=a!==undefined?a:1;E[9]=o||0;E[13]=s||0;E[2]=l||0;E[6]=h||0;E[10]=f!==undefined?f:1;E[14]=c||0;E[3]=u||0;E[7]=d||0;E[11]=p||0;E[15]=m!==undefined?m:1};THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(e,t,i,r,n,a,o,s,l,h,f,c,u,d,p,m){var E=this.elements;E[0]=e;E[4]=t;E[8]=i;E[12]=r;E[1]=n;E[5]=a;E[9]=o;E[13]=s;E[2]=l;E[6]=h;E[10]=f;E[14]=c;E[3]=u;E[7]=d;E[11]=p;E[15]=m;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(e){var t=e.elements;this.set(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]);return this},copyPosition:function(e){var t=this.elements;var i=e.elements;t[12]=i[12];t[13]=i[13];t[14]=i[14];return this},extractRotation:function(){var o=new THREE.Vector3;return function(e){var t=this.elements;var i=e.elements;var r=1/o.set(i[0],i[1],i[2]).length();var n=1/o.set(i[4],i[5],i[6]).length();var a=1/o.set(i[8],i[9],i[10]).length();t[0]=i[0]*r;t[1]=i[1]*r;t[2]=i[2]*r;t[4]=i[4]*n;t[5]=i[5]*n;t[6]=i[6]*n;t[8]=i[8]*a;t[9]=i[9]*a;t[10]=i[10]*a;return this}}(),makeRotationFromEuler:function(e,t){var i=this.elements;var r=e.x,n=e.y,a=e.z;var o=Math.cos(r),s=Math.sin(r);var l=Math.cos(n),h=Math.sin(n);var f=Math.cos(a),c=Math.sin(a);if(t===undefined||t==="XYZ"){var u=o*f,d=o*c,p=s*f,m=s*c;i[0]=l*f;i[4]=-l*c;i[8]=h;i[1]=d+p*h;i[5]=u-m*h;i[9]=-s*l;i[2]=m-u*h;i[6]=p+d*h;i[10]=o*l}else if(t==="YXZ"){var E=l*f,g=l*c,v=h*f,T=h*c;i[0]=E+T*s;i[4]=v*s-g;i[8]=o*h;i[1]=o*c;i[5]=o*f;i[9]=-s;i[2]=g*s-v;i[6]=T+E*s;i[10]=o*l}else if(t==="ZXY"){var E=l*f,g=l*c,v=h*f,T=h*c;i[0]=E-T*s;i[4]=-o*c;i[8]=v+g*s;i[1]=g+v*s;i[5]=o*f;i[9]=T-E*s;i[2]=-o*h;i[6]=s;i[10]=o*l}else if(t==="ZYX"){var u=o*f,d=o*c,p=s*f,m=s*c;i[0]=l*f;i[4]=p*h-d;i[8]=u*h+m;i[1]=l*c;i[5]=m*h+u;i[9]=d*h-p;i[2]=-h;i[6]=s*l;i[10]=o*l}else if(t==="YZX"){var y=o*l,_=o*h,R=s*l,x=s*h;i[0]=l*f;i[4]=x-y*c;i[8]=R*c+_;i[1]=c;i[5]=o*f;i[9]=-s*f;i[2]=-h*f;i[6]=_*c+R;i[10]=y-x*c}else if(t==="XZY"){var y=o*l,_=o*h,R=s*l,x=s*h;i[0]=l*f;i[4]=-c;i[8]=h*f;i[1]=y*c+x;i[5]=o*f;i[9]=_*c-R;i[2]=R*c-_;i[6]=s*f;i[10]=x*c+y}i[3]=0;i[7]=0;i[11]=0;i[12]=0;i[13]=0;i[14]=0;i[15]=1;return this},makeRotationFromQuaternion:function(e){var t=this.elements;var i=e.x,r=e.y,n=e.z,a=e.w;var o=i+i,s=r+r,l=n+n;var h=i*o,f=i*s,c=i*l;var u=r*s,d=r*l,p=n*l;var m=a*o,E=a*s,g=a*l;t[0]=1-(u+p);t[4]=f-g;t[8]=c+E;t[1]=f+g;t[5]=1-(h+p);t[9]=d-m;t[2]=c-E;t[6]=d+m;t[10]=1-(h+u);t[3]=0;t[7]=0;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return this},lookAt:function(){var n=new THREE.Vector3;var a=new THREE.Vector3;var o=new THREE.Vector3;return function(e,t,i){var r=this.elements;o.subVectors(e,t).normalize();if(o.length()===0){o.z=1}n.crossVectors(i,o).normalize();if(n.length()===0){o.x+=1e-4;n.crossVectors(i,o).normalize()}a.crossVectors(o,n);r[0]=n.x;r[4]=a.x;r[8]=o.x;r[1]=n.y;r[5]=a.y;r[9]=o.y;r[2]=n.z;r[6]=a.z;r[10]=o.z;return this}}(),multiply:function(e,t){return this.multiplyMatrices(this,e)},multiplyMatrices:function(e,F){var t=e.elements;var i=F.elements;var r=this.elements;var n=t[0],a=t[4],o=t[8],s=t[12];var l=t[1],h=t[5],f=t[9],c=t[13];var u=t[2],d=t[6],p=t[10],m=t[14];var E=t[3],g=t[7],v=t[11],T=t[15];var y=i[0],_=i[4],R=i[8],x=i[12];var b=i[1],H=i[5],w=i[9],M=i[13];var S=i[2],A=i[6],C=i[10],D=i[14];var P=i[3],L=i[7],U=i[11],N=i[15];r[0]=n*y+a*b+o*S+s*P;r[4]=n*_+a*H+o*A+s*L;r[8]=n*R+a*w+o*C+s*U;r[12]=n*x+a*M+o*D+s*N;r[1]=l*y+h*b+f*S+c*P;r[5]=l*_+h*H+f*A+c*L;r[9]=l*R+h*w+f*C+c*U;r[13]=l*x+h*M+f*D+c*N;r[2]=u*y+d*b+p*S+m*P;r[6]=u*_+d*H+p*A+m*L;r[10]=u*R+d*w+p*C+m*U;r[14]=u*x+d*M+p*D+m*N;r[3]=E*y+g*b+v*S+T*P;r[7]=E*_+g*H+v*A+T*L;r[11]=E*R+g*w+v*C+T*U;r[15]=E*x+g*M+v*D+T*N;return this},multiplyToArray:function(e,t,i){var r=this.elements;this.multiplyMatrices(e,t);i[0]=r[0];i[1]=r[1];i[2]=r[2];i[3]=r[3];i[4]=r[4];i[5]=r[5];i[6]=r[6];i[7]=r[7];i[8]=r[8];i[9]=r[9];i[10]=r[10];i[11]=r[11];i[12]=r[12];i[13]=r[13];i[14]=r[14];i[15]=r[15];return this},multiplyScalar:function(e){var t=this.elements;t[0]*=e;t[4]*=e;t[8]*=e;t[12]*=e;t[1]*=e;t[5]*=e;t[9]*=e;t[13]*=e;t[2]*=e;t[6]*=e;t[10]*=e;t[14]*=e;t[3]*=e;t[7]*=e;t[11]*=e;t[15]*=e;return this},multiplyVector3Array:function(){var r=new THREE.Vector3;return function(e){for(var t=0,i=e.length;t<i;t+=3){r.x=e[t];r.y=e[t+1];r.z=e[t+2];r.applyProjection(this);e[t]=r.x;e[t+1]=r.y;e[t+2]=r.z}return e}}(),determinant:function(){var e=this.elements;var t=e[0],i=e[4],r=e[8],n=e[12];var a=e[1],o=e[5],s=e[9],l=e[13];var h=e[2],f=e[6],c=e[10],u=e[14];var d=e[3],p=e[7],m=e[11],E=e[15];return d*(+n*s*f-r*l*f-n*o*c+i*l*c+r*o*u-i*s*u)+p*(+t*s*u-t*l*c+n*a*c-r*a*u+r*l*h-n*s*h)+m*(+t*l*f-t*o*u-n*a*f+i*a*u+n*o*h-i*l*h)+E*(-r*o*h-t*s*f+t*o*c+r*a*f-i*a*c+i*s*h)},transpose:function(){var e=this.elements;var t;t=e[1];e[1]=e[4];e[4]=t;t=e[2];e[2]=e[8];e[8]=t;t=e[6];e[6]=e[9];e[9]=t;t=e[3];e[3]=e[12];e[12]=t;t=e[7];e[7]=e[13];e[13]=t;t=e[11];e[11]=e[14];e[14]=t;return this},flattenToArray:function(e){var t=this.elements;e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];e[9]=t[9];e[10]=t[10];e[11]=t[11];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15];return e},flattenToArrayOffset:function(e,t){var i=this.elements;e[t]=i[0];e[t+1]=i[1];e[t+2]=i[2];e[t+3]=i[3];e[t+4]=i[4];e[t+5]=i[5];e[t+6]=i[6];e[t+7]=i[7];e[t+8]=i[8];e[t+9]=i[9];e[t+10]=i[10];e[t+11]=i[11];e[t+12]=i[12];e[t+13]=i[13];e[t+14]=i[14];e[t+15]=i[15];return e},setPosition:function(e){var t=this.elements;t[12]=e.x;t[13]=e.y;t[14]=e.z;return this},getInverse:function(e){var t=this.elements;var i=e.elements;var r=i[0],n=i[4],a=i[8],o=i[12];var s=i[1],l=i[5],h=i[9],f=i[13];var c=i[2],u=i[6],d=i[10],p=i[14];var m=i[3],E=i[7],g=i[11],v=i[15];t[0]=h*p*E-f*d*E+f*u*g-l*p*g-h*u*v+l*d*v;t[4]=o*d*E-a*p*E-o*u*g+n*p*g+a*u*v-n*d*v;t[8]=a*f*E-o*h*E+o*l*g-n*f*g-a*l*v+n*h*v;t[12]=o*h*u-a*f*u-o*l*d+n*f*d+a*l*p-n*h*p;t[1]=f*d*m-h*p*m-f*c*g+s*p*g+h*c*v-s*d*v;t[5]=a*p*m-o*d*m+o*c*g-r*p*g-a*c*v+r*d*v;t[9]=o*h*m-a*f*m-o*s*g+r*f*g+a*s*v-r*h*v;t[13]=a*f*c-o*h*c+o*s*d-r*f*d-a*s*p+r*h*p;t[2]=l*p*m-f*u*m+f*c*E-s*p*E-l*c*v+s*u*v;t[6]=o*u*m-n*p*m-o*c*E+r*p*E+n*c*v-r*u*v;t[10]=n*f*m-o*l*m+o*s*E-r*f*E-n*s*v+r*l*v;t[14]=o*l*c-n*f*c-o*s*u+r*f*u+n*s*p-r*l*p;t[3]=h*u*m-l*d*m-h*c*E+s*d*E+l*c*g-s*u*g;t[7]=n*d*m-a*u*m+a*c*E-r*d*E-n*c*g+r*u*g;t[11]=a*l*m-n*h*m-a*s*E+r*h*E+n*s*g-r*l*g;t[15]=n*h*c-a*l*c+a*s*u-r*h*u-n*s*d+r*l*d;var T=i[0]*t[0]+i[1]*t[4]+i[2]*t[8]+i[3]*t[12];if(T==0){this.identity();return this}this.multiplyScalar(1/T);return this},scale:function(e){var t=this.elements;var i=e.x,r=e.y,n=e.z;t[0]*=i;t[4]*=r;t[8]*=n;t[1]*=i;t[5]*=r;t[9]*=n;t[2]*=i;t[6]*=r;t[10]*=n;t[3]*=i;t[7]*=r;t[11]*=n;return this},getMaxScaleOnAxis:function(){var e=this.elements;var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];var i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6];var r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(i,r)))},makeTranslation:function(e,t,i){this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1);return this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1);return this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1);return this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(e,t){var i=Math.cos(t);var r=Math.sin(t);var n=1-i;var a=e.x,o=e.y,s=e.z;var l=n*a,h=n*o;this.set(l*a+i,l*o-r*s,l*s+r*o,0,l*o+r*s,h*o+i,h*s-r*a,0,l*s-r*o,h*s+r*a,n*s*s+i,0,0,0,0,1);return this},makeScale:function(e,t,i){this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1);return this},makeFromPositionQuaternionScale:function(e,t,i){this.makeRotationFromQuaternion(t);this.scale(i);this.setPosition(e);return this},makeFromPositionEulerScale:function(e,t,i,r){this.makeRotationFromEuler(t,i);this.scale(r);this.setPosition(e);return this},makeFrustum:function(e,t,i,r,n,a){var o=this.elements;var s=2*n/(t-e);var l=2*n/(r-i);var h=(t+e)/(t-e);var f=(r+i)/(r-i);var c=-(a+n)/(a-n);var u=-2*a*n/(a-n);o[0]=s;o[4]=0;o[8]=h;o[12]=0;o[1]=0;o[5]=l;o[9]=f;o[13]=0;o[2]=0;o[6]=0;o[10]=c;o[14]=u;o[3]=0;o[7]=0;o[11]=-1;o[15]=0;return this},makePerspective:function(e,t,i,r){var n=i*Math.tan(THREE.Math.degToRad(e*.5));var a=-n;var o=a*t;var s=n*t;return this.makeFrustum(o,s,a,n,i,r)},makeOrthographic:function(e,t,i,r,n,a){var o=this.elements;var s=t-e;var l=i-r;var h=a-n;var f=(t+e)/s;var c=(i+r)/l;var u=(a+n)/h;o[0]=2/s;o[4]=0;o[8]=0;o[12]=-f;o[1]=0;o[5]=2/l;o[9]=0;o[13]=-c;o[2]=0;o[6]=0;o[10]=-2/h;o[14]=-u;o[3]=0;o[7]=0;o[11]=0;o[15]=1;return this},clone:function(){var e=this.elements;return new THREE.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}};THREE.Matrix4.prototype.decompose=function(){var n=new THREE.Vector3;var a=new THREE.Vector3;var o=new THREE.Vector3;var s=new THREE.Matrix4;return function(e,t,i){var r=this.elements;n.set(r[0],r[1],r[2]);a.set(r[4],r[5],r[6]);o.set(r[8],r[9],r[10]);e=e instanceof THREE.Vector3?e:new THREE.Vector3;t=t instanceof THREE.Quaternion?t:new THREE.Quaternion;i=i instanceof THREE.Vector3?i:new THREE.Vector3;i.x=n.length();i.y=a.length();i.z=o.length();e.x=r[12];e.y=r[13];e.z=r[14];if(!(s instanceof THREE.Matrix4)){s=new THREE.Matrix4}s.copy(this);s.elements[0]/=i.x;s.elements[1]/=i.x;s.elements[2]/=i.x;s.elements[4]/=i.y;s.elements[5]/=i.y;s.elements[6]/=i.y;s.elements[8]/=i.z;s.elements[9]/=i.z;s.elements[10]/=i.z;t.setFromRotationMatrix(s);return[e,t,i]}}();THREE.Matrix4.prototype.fromArray=function(e,t){if(t===undefined)t=0;for(var i=0;i<16;i++){this.elements[i]=e[i+t]}return this};THREE.Ray=function(e,t){this.origin=e!==undefined?e:new THREE.Vector3;this.direction=t!==undefined?t:new THREE.Vector3};THREE.Ray.prototype={constructor:THREE.Ray,set:function(e,t){this.origin.copy(e);this.direction.copy(t);return this},copy:function(e){this.origin.copy(e.origin);this.direction.copy(e.direction);return this},at:function(e,t){var i=t||new THREE.Vector3;return i.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var t=new THREE.Vector3;return function(e){this.origin.copy(this.at(e,t));return this}}(),closestPointToPoint:function(e,t){var i=t||new THREE.Vector3;i.subVectors(e,this.origin);var r=i.dot(this.direction);return i.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(){var i=new THREE.Vector3;return function(e){var t=i.subVectors(e,this.origin).dot(this.direction);i.copy(this.direction).multiplyScalar(t).add(this.origin);return i.distanceTo(e)}}(),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){var t=e.normal.dot(this.direction);if(t!=0){return true}if(e.distanceToPoint(this.origin)==0){return true}return false},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(t==0){if(e.distanceToPoint(this.origin)==0){return 0}return undefined}var i=-(this.origin.dot(e.normal)+e.constant)/t;return i},intersectPlane:function(e,t){var i=this.distanceToPlane(e);if(i===undefined){return undefined}return this.at(i,t)},applyMatrix4:function(e){this.direction.add(this.origin).applyMatrix4(e);this.origin.applyMatrix4(e);this.direction.sub(this.origin);return this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)},intersectBox:function(e,t){var i,r,n,a,o,s;var l=1/this.direction.x,h=1/this.direction.y,f=1/this.direction.z;var c=this.origin;if(l>=0){i=(e.min.x-c.x)*l;r=(e.max.x-c.x)*l}else{i=(e.max.x-c.x)*l;r=(e.min.x-c.x)*l}if(h>=0){n=(e.min.y-c.y)*h;a=(e.max.y-c.y)*h}else{n=(e.max.y-c.y)*h;a=(e.min.y-c.y)*h}if(i>a||n>r)return null;if(n>i||i!==i)i=n;if(a<r||r!==r)r=a;if(f>=0){o=(e.min.z-c.z)*f;s=(e.max.z-c.z)*f}else{o=(e.max.z-c.z)*f;s=(e.min.z-c.z)*f}if(i>s||o>r)return null;if(o>i||i!==i)i=o;if(s<r||r!==r)r=s;if(r<0)return null;return this.at(i>=0?i:r,t)}};THREE.Sphere=function(e,t){this.center=e!==undefined?e:new THREE.Vector3;this.radius=t!==undefined?t:0};THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(e,t){this.center.copy(e);this.radius=t;return this},setFromCenterAndPoints:function(e,t){var i=0;for(var r=0,n=t.length;r<n;r++){var a=e.distanceToSquared(t[r]);i=Math.max(i,a)}this.center=e;this.radius=Math.sqrt(i);return this},copy:function(e){this.center.copy(e.center);this.radius=e.radius;return this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var i=this.center.distanceToSquared(e);var r=t||new THREE.Vector3;r.copy(e);if(i>this.radius*this.radius){r.sub(this.center).normalize();r.multiplyScalar(this.radius).add(this.center)}return r},getBoundingBox:function(e){var t=e||new THREE.Box3;t.set(this.center,this.center);t.expandByScalar(this.radius);return t},applyMatrix4:function(e){this.center.applyMatrix4(e);this.radius=this.radius*e.getMaxScaleOnAxis();return this},translate:function(e){this.center.add(e);return this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}};THREE.Frustum=function(e,t,i,r,n,a){this.planes=[e!==undefined?e:new THREE.Plane,t!==undefined?t:new THREE.Plane,i!==undefined?i:new THREE.Plane,r!==undefined?r:new THREE.Plane,n!==undefined?n:new THREE.Plane,a!==undefined?a:new THREE.Plane]};THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(e,t,i,r,n,a){var o=this.planes;o[0].copy(e);o[1].copy(t);o[2].copy(i);o[3].copy(r);o[4].copy(n);o[5].copy(a);return this},copy:function(e){var t=this.planes;for(var i=0;i<6;i++){t[i].copy(e.planes[i])}return this},setFromMatrix:function(e){var t=this.planes;var i=e.elements;var r=i[0],n=i[1],a=i[2],o=i[3];var s=i[4],l=i[5],h=i[6],f=i[7];var c=i[8],u=i[9],d=i[10],p=i[11];var m=i[12],E=i[13],g=i[14],v=i[15];t[0].setComponents(o-r,f-s,p-c,v-m).normalize();t[1].setComponents(o+r,f+s,p+c,v+m).normalize();t[2].setComponents(o+n,f+l,p+u,v+E).normalize();t[3].setComponents(o-n,f-l,p-u,v-E).normalize();t[4].setComponents(o-a,f-h,p-d,v-g).normalize();t[5].setComponents(o+a,f+h,p+d,v+g).normalize();return this},_containing:false,intersectsOrContainsObject:function(){var s=new THREE.Vector3;return function(e){this._containing=true;var t=e.geometry;var i=e.matrixWorld;if(t.boundingSphere===null)t.computeBoundingSphere();var r=-t.boundingSphere.radius*i.getMaxScaleOnAxis();s.getPositionFromMatrix(i);var n=this.planes;for(var a=0;a<6;a++){var o=n[a].distanceToPoint(s);if(o<r){return false}if(o<-r)this._containing=false}return true}}(),intersectsObject:function(){var o=new THREE.Vector3;return function(e){if(e.geometry.boundingSphere===null)e.geometry.computeBoundingSphere();var t=e.matrixWorld,i=this.planes,r=-e.geometry.boundingSphere.radius*t.getMaxScaleOnAxis(),n=6;o.copy(e.geometry.boundingSphere.center).applyMatrix4(t);for(;n;){var a=i[--n].distanceToPoint(o);if(a<r){return false}}return true}}(),intersectsSphere:function(e){var t=this.planes;var i=e.center;var r=-e.radius;for(var n=0;n<6;n++){var a=t[n].distanceToPoint(i);if(a<r){return false}}return true},containsPoint:function(e){var t=this.planes;for(var i=0;i<6;i++){if(t[i].distanceToPoint(e)<0){return false}}return true},clone:function(){return(new THREE.Frustum).copy(this)}};THREE.Plane=function(e,t){this.normal=e!==undefined?e:new THREE.Vector3(1,0,0);this.constant=t!==undefined?t:0};THREE.Plane.prototype={constructor:THREE.Plane,set:function(e,t){this.normal.copy(e);this.constant=t;return this},setComponents:function(e,t,i,r){this.normal.set(e,t,i);this.constant=r;return this},setFromNormalAndCoplanarPoint:function(e,t){this.normal.copy(e);this.constant=-t.dot(this.normal);return this},setFromCoplanarPoints:function(){var n=new THREE.Vector3;var a=new THREE.Vector3;return function(e,t,i){var r=n.subVectors(i,t).cross(a.subVectors(e,t)).normalize();this.setFromNormalAndCoplanarPoint(r,e);return this}}(),copy:function(e){this.normal.copy(e.normal);this.constant=e.constant;return this},normalize:function(){var e=1/this.normal.length();this.normal.multiplyScalar(e);this.constant*=e;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var i=this.distanceToPoint(e);var r=t||new THREE.Vector3;return r.copy(this.normal).multiplyScalar(i)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start);var i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0},intersectLine:function(){var o=new THREE.Vector3;return function(e,t){var i=t||new THREE.Vector3;var r=e.delta(o);var n=this.normal.dot(r);if(n==0){if(this.distanceToPoint(e.start)==0){return i.copy(e.start)}return undefined}var a=-(e.start.dot(this.normal)+this.constant)/n;if(a<0||a>1){return undefined}return i.copy(r).multiplyScalar(a).add(e.start)}}(),coplanarPoint:function(e){var t=e||new THREE.Vector3;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var n=new THREE.Vector3;var a=new THREE.Vector3;return function(e,t){t=t||(new THREE.Matrix3).getNormalMatrix(e);var i=n.copy(this.normal).applyMatrix3(t);var r=this.coplanarPoint(a);r.applyMatrix4(e);this.setFromNormalAndCoplanarPoint(i,r);return this}}(),translate:function(e){this.constant=this.constant-e.dot(this.normal);return this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}};THREE.Math={generateUUID:function(){var o=[];for(var e=0;e<256;e++){o[e]=(e<16?"0":"")+e.toString(16)}return function e(){var t=Math.random()*4294967295|0;var i=Math.random()*4294967295|0;var r=Math.random()*4294967295|0;var n=Math.random()*4294967295|0;var a=o[t&255]+o[t>>8&255]+o[t>>16&255]+o[t>>24&255]+"-"+o[i&255]+o[i>>8&255]+"-"+o[i>>16&15|64]+o[i>>24&255]+"-"+o[r&63|128]+o[r>>8&255]+"-"+o[r>>16&255]+o[r>>24&255]+o[n&255]+o[n>>8&255]+o[n>>16&255]+o[n>>24&255];return a.toUpperCase()}}(),clamp:function(e,t,i){return e<t?t:e>i?i:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},smoothstep:function(e,t,i){if(e<=t)return 0;if(e>=i)return 1;e=(e-t)/(i-t);return e*e*(3-2*e)},smootherstep:function(e,t,i){if(e<=t)return 0;if(e>=i)return 1;e=(e-t)/(i-t);return e*e*e*(e*(e*6-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return e<0?-1:e>0?1:0},degToRad:function(){var t=Math.PI/180;return function(e){return e*t}}(),radToDeg:function(){var t=180/Math.PI;return function(e){return e*t}}()};THREE.Spline=function(e){this.points=e;var t=[],i={x:0,y:0,z:0},r,n,a,o,s,l,h,f,c;this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++){this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}}};this.getPoint=function(e){r=(this.points.length-1)*e;n=Math.floor(r);a=r-n;t[0]=n===0?n:n-1;t[1]=n;t[2]=n>this.points.length-2?this.points.length-1:n+1;t[3]=n>this.points.length-3?this.points.length-1:n+2;l=this.points[t[0]];h=this.points[t[1]];f=this.points[t[2]];c=this.points[t[3]];o=a*a;s=a*o;i.x=u(l.x,h.x,f.x,c.x,a,o,s);i.y=u(l.y,h.y,f.y,c.y,a,o,s);i.z=u(l.z,h.z,f.z,c.z,a,o,s);return i};this.getControlPointsArray=function(){var e,t,i=this.points.length,r=[];for(e=0;e<i;e++){t=this.points[e];r[e]=[t.x,t.y,t.z]}return r};this.getLength=function(e){var t,i,r,n,a=0,o=0,s=0,l=new THREE.Vector3,h=new THREE.Vector3,f=[],c=0;f[0]=0;if(!e)e=100;r=this.points.length*e;l.copy(this.points[0]);for(t=1;t<r;t++){i=t/r;n=this.getPoint(i);h.copy(n);c+=h.distanceTo(l);l.copy(n);a=(this.points.length-1)*i;o=Math.floor(a);if(o!=s){f[o]=c;s=o}}f[f.length]=c;return{chunks:f,total:c}};this.reparametrizeByArcLength=function(e){var t,i,r,n,a,o,s,l,h,f=[],c=new THREE.Vector3,u=this.getLength();f.push(c.copy(this.points[0]).clone());for(t=1;t<this.points.length;t++){s=u.chunks[t]-u.chunks[t-1];l=Math.ceil(e*s/u.total);n=(t-1)/(this.points.length-1);a=t/(this.points.length-1);for(i=1;i<l-1;i++){r=n+i*(1/l)*(a-n);h=this.getPoint(r);f.push(c.copy(h).clone())}f.push(c.copy(this.points[t]).clone())}this.points=f};function u(e,t,i,r,n,a,o){var s=(i-e)*.5,l=(r-t)*.5;return(2*(t-i)+s+l)*o+(-3*(t-i)-2*s-l)*a+s*n+t}};THREE.Triangle=function(e,t,i){this.a=e!==undefined?e:new THREE.Vector3;this.b=t!==undefined?t:new THREE.Vector3;this.c=i!==undefined?i:new THREE.Vector3};THREE.Triangle.normal=function(){var o=new THREE.Vector3;return function(e,t,i,r){var n=r||new THREE.Vector3;n.subVectors(i,t);o.subVectors(e,t);n.cross(o);var a=n.lengthSq();if(a>0){return n.multiplyScalar(1/Math.sqrt(a))}return n.set(0,0,0)}}();THREE.Triangle.barycoordFromPoint=function(){var m=new THREE.Vector3;var E=new THREE.Vector3;var g=new THREE.Vector3;return function(e,t,i,r,n){m.subVectors(r,t);E.subVectors(i,t);g.subVectors(e,t);var a=m.dot(m);var o=m.dot(E);var s=m.dot(g);var l=E.dot(E);var h=E.dot(g);var f=a*l-o*o;var c=n||new THREE.Vector3;if(f==0){return c.set(-2,-1,-1)}var u=1/f;var d=(l*s-o*h)*u;var p=(a*h-o*s)*u;return c.set(1-d-p,p,d)}}();THREE.Triangle.containsPoint=function(){var a=new THREE.Vector3;return function(e,t,i,r){var n=THREE.Triangle.barycoordFromPoint(e,t,i,r,a);return n.x>=0&&n.y>=0&&n.x+n.y<=1}}();THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(e,t,i){this.a.copy(e);this.b.copy(t);this.c.copy(i);return this},setFromPointsAndIndices:function(e,t,i,r){this.a.copy(e[t]);this.b.copy(e[i]);this.c.copy(e[r]);return this},copy:function(e){this.a.copy(e.a);this.b.copy(e.b);this.c.copy(e.c);return this},area:function(){var e=new THREE.Vector3;var t=new THREE.Vector3;return function(){e.subVectors(this.c,this.b);t.subVectors(this.a,this.b);return e.cross(t).length()*.5}}(),midpoint:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return THREE.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new THREE.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return THREE.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return THREE.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new THREE.Triangle).copy(this)}};THREE.now=function(){var e=self.performance!==undefined&&self.performance.now!==undefined?self.performance:Date;return function(){return e.now()}}();THREE.Clock=function(e){this.autoStart=e!==undefined?e:true;this.startTime=0;this.oldTime=0;this.elapsedTime=0;this.running=false};THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.startTime=(typeof performance==="undefined"?Date:performance).now();this.oldTime=this.startTime;this.elapsedTime=0;this.running=true},stop:function(){this.getElapsedTime();this.running=false;this.autoStart=false},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running){this.start();return 0}if(this.running){var t=(typeof performance==="undefined"?Date:performance).now();e=(t-this.oldTime)/1e3;this.oldTime=t;this.elapsedTime+=e}return e}};THREE.EventDispatcher=function(){};THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(e){e.addEventListener=THREE.EventDispatcher.prototype.addEventListener;e.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener;e.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener;e.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){if(this._listeners===undefined)this._listeners={};var i=this._listeners;if(i[e]===undefined){i[e]=[]}if(i[e].indexOf(t)===-1){i[e].push(t)}},hasEventListener:function(e,t){if(this._listeners===undefined)return false;var i=this._listeners;if(i[e]!==undefined&&i[e].indexOf(t)!==-1){return true}return false},removeEventListener:function(e,t){if(this._listeners===undefined)return;var i=this._listeners;var r=i[e].indexOf(t);if(r!==-1){i[e].splice(r,1)}},dispatchEvent:function(e){if(this._listeners===undefined)return;var t=this._listeners;var i=t[e.type];if(i!==undefined){e.target=this;for(var r=0,n=i.length;r<n;r++){i[r].call(this,e)}}}};(function(y){y.Raycaster=function(e,t,i,r){this.ray=new y.Ray(e,t);if(this.ray.direction.lengthSq()>0){this.ray.direction.normalize()}this.near=i||0;this.far=r||Infinity};var _=new y.Sphere;var R=new y.Ray;var x=new y.Plane;var b=new y.Vector3;var H=new y.Vector3;var w=new y.Matrix4;var n=function(e,t){return e.distance-t.distance};var M=function(e,t,i){if(e instanceof y.Particle){H.getPositionFromMatrix(e.matrixWorld);var r=t.ray.distanceToPoint(H);if(r>e.scale.x){return i}i.push({distance:r,point:e.position,face:null,object:e})}else if(e instanceof y.LOD){H.getPositionFromMatrix(e.matrixWorld);var r=t.ray.origin.distanceTo(H);M(e.getObjectForDistance(r),t,i)}else if(e instanceof y.Mesh){H.getPositionFromMatrix(e.matrixWorld);_.set(H,e.geometry.boundingSphere.radius*e.matrixWorld.getMaxScaleOnAxis());if(!t.ray.isIntersectionSphere(_)){return i}var n=e.geometry;var a=n.vertices;var o=e.material instanceof y.MeshFaceMaterial;var s=o===true?e.material.materials:null;var l=e.material.side;var h,f,c,u;var d=t.precision;w.getInverse(e.matrixWorld);R.copy(t.ray).applyMatrix4(w);for(var p=0,m=n.faces.length;p<m;p++){var E=n.faces[p];var g=o===true?s[E.materialIndex]:e.material;if(g===undefined)continue;x.setFromNormalAndCoplanarPoint(E.normal,a[E.a]);var v=R.distanceToPlane(x);if(Math.abs(v)<d)continue;if(v<0)continue;l=g.side;if(l!==y.DoubleSide){var T=R.direction.dot(x.normal);if(!(l===y.FrontSide?T<0:T>0))continue}if(v<t.near||v>t.far)continue;b=R.at(v,b);if(E instanceof y.Face3){h=a[E.a];f=a[E.b];c=a[E.c];if(!y.Triangle.containsPoint(b,h,f,c))continue}else if(E instanceof y.Face4){h=a[E.a];f=a[E.b];c=a[E.c];u=a[E.d];if(!y.Triangle.containsPoint(b,h,f,u)&&!y.Triangle.containsPoint(b,f,c,u))continue}i.push({distance:v,point:t.ray.at(v),face:E,faceIndex:p,object:e})}}};var a=function(e,t,i){var r=e.getDescendants();for(var n=0,a=r.length;n<a;n++){M(r[n],t,i)}};y.Raycaster.prototype.precision=1e-4;y.Raycaster.prototype.set=function(e,t){this.ray.set(e,t);if(this.ray.direction.length()>0){this.ray.direction.normalize()}};y.Raycaster.prototype.intersectObject=function(e,t){var i=[];if(t===true){a(e,this,i)}M(e,this,i);i.sort(n);return i};y.Raycaster.prototype.intersectObjects=function(e,t){var i=[],r=e.length;for(;r;){M(e[--r],this,i);if(t){a(e[r],this,i)}}i.sort(n);return i};y.Raycaster.prototype.setFromCamera=function(e,t){if(t&&t instanceof y.PerspectiveCamera){this.ray.origin.getPositionFromMatrix(t.matrixWorld);this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()}else if(t&&t instanceof y.OrthographicCamera){this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t);this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)}else{console.error("THREE.Raycaster: Unsupported camera type.")}}})(THREE);THREE.Object3D=function(){this.id=THREE.Object3DIdCount++;this.name="";this.parent=undefined;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3;this.rotate=this.rotation=new THREE.Vector3;this.eulerOrder=THREE.Object3D.defaultEulerOrder;this.scale=new THREE.Vector3(1,1,1);this.renderDepth=null;this.rotationAutoUpdate=true;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixAutoUpdate=true;this.matrixWorldNeedsUpdate=true;this.quaternion=new THREE.Quaternion;this.useQuaternion=false;this.visible=true;this.castShadow=false;this.receiveShadow=false;this.frustumCulled=true;this.userData={};this._lookAt=new THREE.Vector3;this.qtAxisAngle=new THREE.Quaternion};THREE.Object3D.prototype={constructor:THREE.Object3D,applyMatrix:function(){var t=new THREE.Matrix4;return function(e){this.matrix.multiplyMatrices(e,this.matrix);this.position.getPositionFromMatrix(this.matrix);this.scale.getScaleFromMatrix(this.matrix);t.extractRotation(this.matrix);if(this.useQuaternion===true){this.quaternion.setFromRotationMatrix(t)}else{this.rotation.setEulerFromRotationMatrix(t,this.eulerOrder)}}}(),rotateOnAxis:function(){var i=new THREE.Quaternion;var r=new THREE.Quaternion;return function(e,t){i.setFromAxisAngle(e,t);if(this.useQuaternion===true){this.quaternion.multiply(i)}else{r.setFromEuler(this.rotation,this.eulerOrder);r.multiply(i);this.rotation.setEulerFromQuaternion(r,this.eulerOrder)}return this}}(),translateOnAxis:function(){var i=new THREE.Vector3;return function(e,t){i.copy(e);if(this.useQuaternion===true){i.applyQuaternion(this.quaternion)}else{i.applyEuler(this.rotation,this.eulerOrder)}this.position.add(i.multiplyScalar(t));return this}}(),translateX:function(){var t=new THREE.Vector3(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new THREE.Vector3(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new THREE.Vector3(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var t=new THREE.Matrix4;return function(e){return e.applyMatrix4(t.getInverse(this.matrixWorld))}}(),lookAt:function(){var t=new THREE.Matrix4;return function(e){t.lookAt(e,this.position,this.up);this._lookAt.copy(e);if(this.useQuaternion===true){this.quaternion.setFromRotationMatrix(t)}else{this.rotation.setEulerFromRotationMatrix(t,this.eulerOrder)}}}(),add:function(e){if(e.parent!==undefined){e.parent.remove(e)}e.parent=this;e.dispatchEvent({type:"added"});jThree.styleHooks.display.set(e);jThree.styleHooks.opacity.set(e);this.children.push(e);var t=this;while(t.parent!==undefined){t=t.parent}if(t!==undefined&&t instanceof THREE.Scene){t.__addObject(e);if(e.userData.dom){e.userData.scene=t;t.eventChange($._data(e.userData.dom,"events"),e)}}},remove:function(e){var t=this.children.indexOf(e);if(t!==-1){e.parent=undefined;e.traverse(function(e){e.dispatchEvent({type:"removed"})});this.children.splice(t,1);var i=this;while(i.parent!==undefined){i=i.parent}if(i!==undefined&&i instanceof THREE.Scene){i.__removeObject(e);if(e.userData.dom){e.userData.scene=undefined;i.eventChange(false,e)}}}},traverse:function(e){e(this);for(var t=0,i=this.children.length;t<i;t++){if(this.children[t].traverse(e)===false){break}}},getObjectById:function(e,t){for(var i=0,r=this.children.length;i<r;i++){var n=this.children[i];if(n.id===e){return n}if(t===true){n=n.getObjectById(e,t);if(n!==undefined){return n}}}return undefined},getObjectByName:function(e,t){for(var i=0,r=this.children.length;i<r;i++){var n=this.children[i];if(n.name===e){return n}if(t===true){n=n.getObjectByName(e,t);if(n!==undefined){return n}}}return undefined},getDescendants:function(e){if(e===undefined)e=[];Array.prototype.push.apply(e,this.children);for(var t=0,i=this.children.length;t<i;t++){this.children[t].getDescendants(e)}return e},updateMatrix:function(){if(this.useQuaternion===false){this.matrix.makeFromPositionEulerScale(this.position,this.rotation,this.eulerOrder,this.scale)}else{this.matrix.makeFromPositionQuaternionScale(this.position,this.quaternion,this.scale)}this.matrixWorldNeedsUpdate=true},updateMatrixWorld:function(e){if(this.matrixAutoUpdate===true)this.updateMatrix();if(this.matrixWorldNeedsUpdate===true||e===true){if(this.parent===undefined){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}this.matrixWorldNeedsUpdate=false;e=true}for(var t=0,i=this.children.length;t<i;t++){this.children[t].updateMatrixWorld(e)}},clone:function(e){if(e===undefined)e=new THREE.Object3D;e.name=this.name;e.up.copy(this.up);e.position.copy(this.position);if(e.rotation instanceof THREE.Vector3)e.rotation.copy(this.rotation);e.eulerOrder=this.eulerOrder;e.scale.copy(this.scale);e.renderDepth=this.renderDepth;e.rotationAutoUpdate=this.rotationAutoUpdate;e.matrix.copy(this.matrix);e.matrixWorld.copy(this.matrixWorld);e.matrixAutoUpdate=this.matrixAutoUpdate;e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate;e.quaternion.copy(this.quaternion);e.useQuaternion=this.useQuaternion;e.visible=this.visible;e.castShadow=this.castShadow;e.receiveShadow=this.receiveShadow;e.frustumCulled=this.frustumCulled;e.userData=this.userData.dom?jQuery.extend(true,{},this.userData):JSON.parse(JSON.stringify(this.userData));e._lookAt.copy(this._lookAt);e.instanced_drawing=this.instanced_drawing;for(var t=0;t<this.children.length;t++){var i=this.children[t];e.add(i.clone())}return e}};THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype);THREE.Object3D.defaultEulerOrder="XYZ",THREE.Object3DIdCount=0;THREE.Projector=function(){var a,i,t=[],r=0,F,O,z=[],n=0,I,V,o=[],s=0,k,l=[],h=0,B,j,f=[],c=0,G,W,p=[],m=0,X={objects:[],sprites:[],lights:[],elements:[]},u=new THREE.Vector3,q=new THREE.Vector4,ae=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),oe=new THREE.Box3,Y=new Array(3),$=new Array(4),K=new THREE.Matrix4,Q=new THREE.Matrix4,Z,J=new THREE.Matrix4,ee=new THREE.Matrix3,te=new THREE.Matrix3,se=new THREE.Vector3,le=new THREE.Frustum,ie=new THREE.Vector4,re=new THREE.Vector4;this.projectVector=function(e,t){t.matrixWorldInverse.getInverse(t.matrixWorld);Q.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);return e.applyProjection(Q)};this.unprojectVector=function(e,t){t.projectionMatrixInverse.getInverse(t.projectionMatrix);Q.multiplyMatrices(t.matrixWorld,t.projectionMatrixInverse);return e.applyProjection(Q)};this.pickingRay=function(e,t){e.z=-1;var i=new THREE.Vector3(e.x,e.y,1);this.unprojectVector(e,t);this.unprojectVector(i,t);i.sub(e).normalize();return new THREE.Raycaster(e,i)};var he=function(e,t){i=0;X.objects.length=0;X.sprites.length=0;X.lights.length=0;var n=function(e){for(var t=0,i=e.children.length;t<i;t++){var r=e.children[t];if(r.visible===false)continue;if(r instanceof THREE.Light){X.lights.push(r)}else if(r instanceof THREE.Mesh||r instanceof THREE.Line){if(r.frustumCulled===false||le.intersectsObject(r)===true){a=d();a.object=r;if(r.renderDepth!==null){a.z=r.renderDepth}else{u.getPositionFromMatrix(r.matrixWorld);u.applyProjection(Q);a.z=u.z}X.objects.push(a)}}else if(r instanceof THREE.Sprite||r instanceof THREE.Particle){a=d();a.object=r;if(r.renderDepth!==null){a.z=r.renderDepth}else{u.getPositionFromMatrix(r.matrixWorld);u.applyProjection(Q);a.z=u.z}X.sprites.push(a)}else{a=d();a.object=r;if(r.renderDepth!==null){a.z=r.renderDepth}else{u.getPositionFromMatrix(r.matrixWorld);u.applyProjection(Q);a.z=u.z}X.objects.push(a)}n(r)}};n(e);if(t===true)X.objects.sort(pe);return X};this.projectScene=function(e,t,i,r){var n=false,a,o,s,l,h,f,c,u,d,p,m,E,g,v,T,y,_,R,x,b,H,w,M,S,A,C;V=0;k=0;j=0;W=0;X.elements.length=0;if(e.autoUpdate===true)e.updateMatrixWorld();if(t.parent===undefined)t.updateMatrixWorld();K.copy(t.matrixWorldInverse.getInverse(t.matrixWorld));Q.multiplyMatrices(t.projectionMatrix,K);te.getNormalMatrix(K);le.setFromMatrix(Q);X=he(e,i);for(a=0,o=X.objects.length;a<o;a++){g=X.objects[a].object;Z=g.matrixWorld;O=0;if(g instanceof THREE.Mesh){v=g.geometry;T=v.vertices;y=v.faces;x=v.faceVertexUvs;ee.getNormalMatrix(Z);A=g.material instanceof THREE.MeshFaceMaterial;C=A===true?g.material:null;for(s=0,l=T.length;s<l;s++){F=ne();F.positionWorld.copy(T[s]).applyMatrix4(Z);F.positionScreen.copy(F.positionWorld).applyMatrix4(Q);F.positionScreen.x/=F.positionScreen.w;F.positionScreen.y/=F.positionScreen.w;F.positionScreen.z/=F.positionScreen.w;F.visible=!(F.positionScreen.x<-1||F.positionScreen.x>1||F.positionScreen.y<-1||F.positionScreen.y>1||F.positionScreen.z<-1||F.positionScreen.z>1)}for(h=0,f=y.length;h<f;h++){_=y[h];var D=A===true?C.materials[_.materialIndex]:g.material;if(D===undefined)continue;var P=D.side;if(_ instanceof THREE.Face3){H=z[_.a];w=z[_.b];M=z[_.c];Y[0]=H.positionScreen;Y[1]=w.positionScreen;Y[2]=M.positionScreen;if(H.visible===true||w.visible===true||M.visible===true||ae.isIntersectionBox(oe.setFromPoints(Y))){n=(M.positionScreen.x-H.positionScreen.x)*(w.positionScreen.y-H.positionScreen.y)-(M.positionScreen.y-H.positionScreen.y)*(w.positionScreen.x-H.positionScreen.x)<0;if(P===THREE.DoubleSide||n===(P===THREE.FrontSide)){I=fe();I.v1.copy(H);I.v2.copy(w);I.v3.copy(M)}else{continue}}else{continue}}else if(_ instanceof THREE.Face4){H=z[_.a];w=z[_.b];M=z[_.c];S=z[_.d];$[0]=H.positionScreen;$[1]=w.positionScreen;$[2]=M.positionScreen;$[3]=S.positionScreen;if(H.visible===true||w.visible===true||M.visible===true||S.visible===true||ae.isIntersectionBox(oe.setFromPoints($))){n=(S.positionScreen.x-H.positionScreen.x)*(w.positionScreen.y-H.positionScreen.y)-(S.positionScreen.y-H.positionScreen.y)*(w.positionScreen.x-H.positionScreen.x)<0||(w.positionScreen.x-M.positionScreen.x)*(S.positionScreen.y-M.positionScreen.y)-(w.positionScreen.y-M.positionScreen.y)*(S.positionScreen.x-M.positionScreen.x)<0;if(P===THREE.DoubleSide||n===(P===THREE.FrontSide)){I=ce();I.v1.copy(H);I.v2.copy(w);I.v3.copy(M);I.v4.copy(S)}else{continue}}else{continue}}I.normalModel.copy(_.normal);if(n===false&&(P===THREE.BackSide||P===THREE.DoubleSide)){I.normalModel.negate()}I.normalModel.applyMatrix3(ee).normalize();I.normalModelView.copy(I.normalModel).applyMatrix3(te);I.centroidModel.copy(_.centroid).applyMatrix4(Z);R=_.vertexNormals;for(c=0,u=R.length;c<u;c++){var L=I.vertexNormalsModel[c];L.copy(R[c]);if(n===false&&(P===THREE.BackSide||P===THREE.DoubleSide)){L.negate()}L.applyMatrix3(ee).normalize();var U=I.vertexNormalsModelView[c];U.copy(L).applyMatrix3(te)}I.vertexNormalsLength=R.length;for(d=0,p=x.length;d<p;d++){b=x[d][h];if(b===undefined)continue;for(m=0,E=b.length;m<E;m++){I.uvs[d][m]=b[m]}}I.color=_.color;I.material=D;se.copy(I.centroidModel).applyProjection(Q);I.z=se.z;X.elements.push(I)}}else if(g instanceof THREE.Line){J.multiplyMatrices(Q,Z);T=g.geometry.vertices;H=ne();H.positionScreen.copy(T[0]).applyMatrix4(J);var N=g.type===THREE.LinePieces?2:1;for(s=1,l=T.length;s<l;s++){H=ne();H.positionScreen.copy(T[s]).applyMatrix4(J);if((s+1)%N>0)continue;w=z[O-2];ie.copy(H.positionScreen);re.copy(w.positionScreen);if(me(ie,re)===true){ie.multiplyScalar(1/ie.w);re.multiplyScalar(1/re.w);B=ue();B.v1.positionScreen.copy(ie);B.v2.positionScreen.copy(re);B.z=Math.max(ie.z,re.z);B.material=g.material;if(g.material.vertexColors===THREE.VertexColors){B.vertexColors[0].copy(g.geometry.colors[s]);B.vertexColors[1].copy(g.geometry.colors[s-1])}X.elements.push(B)}}}}for(a=0,o=X.sprites.length;a<o;a++){g=X.sprites[a].object;Z=g.matrixWorld;if(g instanceof THREE.Particle){q.set(Z.elements[12],Z.elements[13],Z.elements[14],1);q.applyMatrix4(Q);q.z/=q.w;if(q.z>0&&q.z<1){G=de();G.object=g;G.x=q.x/q.w;G.y=q.y/q.w;G.z=q.z;G.rotation=g.rotation.z;G.scale.x=g.scale.x*Math.abs(G.x-(q.x+t.projectionMatrix.elements[0])/(q.w+t.projectionMatrix.elements[12]));G.scale.y=g.scale.y*Math.abs(G.y-(q.y+t.projectionMatrix.elements[5])/(q.w+t.projectionMatrix.elements[13]));G.material=g.material;X.elements.push(G)}}}if(r===true)X.elements.sort(pe);return X};function d(){if(i===r){var e=new THREE.RenderableObject;t.push(e);r++;i++;return e}return t[i++]}function ne(){if(O===n){var e=new THREE.RenderableVertex;z.push(e);n++;O++;return e}return z[O++]}function fe(){if(V===s){var e=new THREE.RenderableFace3;o.push(e);s++;V++;return e}return o[V++]}function ce(){if(k===h){var e=new THREE.RenderableFace4;l.push(e);h++;k++;return e}return l[k++]}function ue(){if(j===c){var e=new THREE.RenderableLine;f.push(e);c++;j++;return e}return f[j++]}function de(){if(W===m){var e=new THREE.RenderableParticle;p.push(e);m++;W++;return e}return p[W++]}function pe(e,t){return t.z-e.z}function me(e,t){var i=0,r=1,n=e.z+e.w,a=t.z+t.w,o=-e.z+e.w,s=-t.z+t.w;if(n>=0&&a>=0&&o>=0&&s>=0){return true}else if(n<0&&a<0||o<0&&s<0){return false}else{if(n<0){i=Math.max(i,n/(n-a))}else if(a<0){r=Math.min(r,n/(n-a))}if(o<0){i=Math.max(i,o/(o-s))}else if(s<0){r=Math.min(r,o/(o-s))}if(r<i){return false}else{e.lerp(t,i);t.lerp(e,1-r);return true}}}};THREE.Face3=function(e,t,i,r,n,a){this.a=e;this.b=t;this.c=i;this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3;this.vertexNormals=r instanceof Array?r:[];this.color=n instanceof THREE.Color?n:new THREE.Color;this.vertexColors=n instanceof Array?n:[];this.vertexTangents=[];this.materialIndex=a!==undefined?a:0;this.centroid=new THREE.Vector3};THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var e=new THREE.Face3(this.a,this.b,this.c);e.normal.copy(this.normal);e.color.copy(this.color);e.centroid.copy(this.centroid);e.materialIndex=this.materialIndex;var t,i;for(t=0,i=this.vertexNormals.length;t<i;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,i=this.vertexColors.length;t<i;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,i=this.vertexTangents.length;t<i;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}};THREE.Face4=function(e,t,i,r,n,a,o){this.a=e;this.b=t;this.c=i;this.d=r;this.normal=n instanceof THREE.Vector3?n:new THREE.Vector3;this.vertexNormals=n instanceof Array?n:[];this.color=a instanceof THREE.Color?a:new THREE.Color;this.vertexColors=a instanceof Array?a:[];this.vertexTangents=[];this.materialIndex=o!==undefined?o:0;this.centroid=new THREE.Vector3};THREE.Face4.prototype={constructor:THREE.Face4,clone:function(){var e=new THREE.Face4(this.a,this.b,this.c,this.d);e.normal.copy(this.normal);e.color.copy(this.color);e.centroid.copy(this.centroid);e.materialIndex=this.materialIndex;var t,i;for(t=0,i=this.vertexNormals.length;t<i;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,i=this.vertexColors.length;t<i;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,i=this.vertexTangents.length;t<i;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}};THREE.Geometry=function(){this.id=THREE.GeometryIdCount++;this.name="";this.vertices=[];this.colors=[];this.normals=[];this.faces=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingBox=null;this.boundingSphere=null;this.hasTangents=false;this.dynamic=true;this.verticesNeedUpdate=false;this.elementsNeedUpdate=false;this.uvsNeedUpdate=false;this.normalsNeedUpdate=false;this.tangentsNeedUpdate=false;this.colorsNeedUpdate=false;this.lineDistancesNeedUpdate=false;this.buffersNeedUpdate=false;this.userData={}};THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(e){var t=(new THREE.Matrix3).getNormalMatrix(e);for(var i=0,r=this.vertices.length;i<r;i++){var n=this.vertices[i];n.applyMatrix4(e)}for(var i=0,r=this.faces.length;i<r;i++){var a=this.faces[i];a.normal.applyMatrix3(t).normalize();for(var o=0,s=a.vertexNormals.length;o<s;o++){a.vertexNormals[o].applyMatrix3(t).normalize()}a.centroid.applyMatrix4(e)}},computeCentroids:function(){var e,t,i;for(e=0,t=this.faces.length;e<t;e++){i=this.faces[e];i.centroid.set(0,0,0);if(i instanceof THREE.Face3){i.centroid.add(this.vertices[i.a]);i.centroid.add(this.vertices[i.b]);i.centroid.add(this.vertices[i.c]);i.centroid.divideScalar(3)}else if(i instanceof THREE.Face4){i.centroid.add(this.vertices[i.a]);i.centroid.add(this.vertices[i.b]);i.centroid.add(this.vertices[i.c]);i.centroid.add(this.vertices[i.d]);i.centroid.divideScalar(4)}}},computeFaceNormals:function(){var e=new THREE.Vector3,t=new THREE.Vector3;for(var i=0,r=this.faces.length;i<r;i++){var n=this.faces[i];var a=this.vertices[n.a];var o=this.vertices[n.b];var s=this.vertices[n.c];e.subVectors(s,o);t.subVectors(a,o);e.cross(t);e.normalize();n.normal.copy(e)}},computeVertexNormals:function(e){var t,i,r,n,a,o;if(this.__tmpVertices===undefined){this.__tmpVertices=new Array(this.vertices.length);o=this.__tmpVertices;for(t=0,i=this.vertices.length;t<i;t++){o[t]=new THREE.Vector3}for(r=0,n=this.faces.length;r<n;r++){a=this.faces[r];if(a instanceof THREE.Face3){a.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}else if(a instanceof THREE.Face4){a.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}}}else{o=this.__tmpVertices;for(t=0,i=this.vertices.length;t<i;t++){o[t].set(0,0,0)}}if(e){var s,l,h,f;var c=new THREE.Vector3,u=new THREE.Vector3,d=new THREE.Vector3,p=new THREE.Vector3,m=new THREE.Vector3;for(r=0,n=this.faces.length;r<n;r++){a=this.faces[r];if(a instanceof THREE.Face3){s=this.vertices[a.a];l=this.vertices[a.b];h=this.vertices[a.c];c.subVectors(h,l);u.subVectors(s,l);c.cross(u);o[a.a].add(c);o[a.b].add(c);o[a.c].add(c)}else if(a instanceof THREE.Face4){s=this.vertices[a.a];l=this.vertices[a.b];h=this.vertices[a.c];f=this.vertices[a.d];d.subVectors(f,l);u.subVectors(s,l);d.cross(u);o[a.a].add(d);o[a.b].add(d);o[a.d].add(d);p.subVectors(f,h);m.subVectors(l,h);p.cross(m);o[a.b].add(p);o[a.c].add(p);o[a.d].add(p)}}}else{for(r=0,n=this.faces.length;r<n;r++){a=this.faces[r];if(a instanceof THREE.Face3){o[a.a].add(a.normal);o[a.b].add(a.normal);o[a.c].add(a.normal)}else if(a instanceof THREE.Face4){o[a.a].add(a.normal);o[a.b].add(a.normal);o[a.c].add(a.normal);o[a.d].add(a.normal)}}}for(t=0,i=this.vertices.length;t<i;t++){o[t].normalize()}for(r=0,n=this.faces.length;r<n;r++){a=this.faces[r];if(a instanceof THREE.Face3){a.vertexNormals[0].copy(o[a.a]);a.vertexNormals[1].copy(o[a.b]);a.vertexNormals[2].copy(o[a.c])}else if(a instanceof THREE.Face4){a.vertexNormals[0].copy(o[a.a]);a.vertexNormals[1].copy(o[a.b]);a.vertexNormals[2].copy(o[a.c]);a.vertexNormals[3].copy(o[a.d])}}},computeMorphNormals:function(){var e,t,i,r,n;for(i=0,r=this.faces.length;i<r;i++){n=this.faces[i];if(!n.__originalFaceNormal){n.__originalFaceNormal=n.normal.clone()}else{n.__originalFaceNormal.copy(n.normal)}if(!n.__originalVertexNormals)n.__originalVertexNormals=[];for(e=0,t=n.vertexNormals.length;e<t;e++){if(!n.__originalVertexNormals[e]){n.__originalVertexNormals[e]=n.vertexNormals[e].clone()}else{n.__originalVertexNormals[e].copy(n.vertexNormals[e])}}}var a=new THREE.Geometry;a.faces=this.faces;for(e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={};this.morphNormals[e].faceNormals=[];this.morphNormals[e].vertexNormals=[];var o=this.morphNormals[e].faceNormals;var s=this.morphNormals[e].vertexNormals;var l,h;for(i=0,r=this.faces.length;i<r;i++){n=this.faces[i];l=new THREE.Vector3;if(n instanceof THREE.Face3){h={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3}}else{h={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3,d:new THREE.Vector3}}o.push(l);s.push(h)}}var f=this.morphNormals[e];a.vertices=this.morphTargets[e].vertices;a.computeFaceNormals();a.computeVertexNormals();var l,h;for(i=0,r=this.faces.length;i<r;i++){n=this.faces[i];l=f.faceNormals[i];h=f.vertexNormals[i];l.copy(n.normal);if(n instanceof THREE.Face3){h.a.copy(n.vertexNormals[0]);h.b.copy(n.vertexNormals[1]);h.c.copy(n.vertexNormals[2])}else{h.a.copy(n.vertexNormals[0]);h.b.copy(n.vertexNormals[1]);h.c.copy(n.vertexNormals[2]);h.d.copy(n.vertexNormals[3])}}}for(i=0,r=this.faces.length;i<r;i++){n=this.faces[i];n.normal=n.__originalFaceNormal;n.vertexNormals=n.__originalVertexNormals}},computeTangents:function(){var e,t,i,r,n,F,a,o,s,l,h,f,c,u,d,p,m,E,g,v,T,y,_,R,x,b,H,w,M=[],S=[],A=new THREE.Vector3,C=new THREE.Vector3,D=new THREE.Vector3,P=new THREE.Vector3,L=new THREE.Vector3,U;for(i=0,r=this.vertices.length;i<r;i++){M[i]=new THREE.Vector3;S[i]=new THREE.Vector3}function N(e,t,i,r,n,a,o){l=e.vertices[t];h=e.vertices[i];f=e.vertices[r];c=s[n];u=s[a];d=s[o];p=h.x-l.x;m=f.x-l.x;E=h.y-l.y;g=f.y-l.y;v=h.z-l.z;T=f.z-l.z;y=u.x-c.x;_=d.x-c.x;R=u.y-c.y;x=d.y-c.y;b=1/(y*x-_*R);A.set((x*p-R*m)*b,(x*E-R*g)*b,(x*v-R*T)*b);C.set((y*m-_*p)*b,(y*g-_*E)*b,(y*T-_*v)*b);M[t].add(A);M[i].add(A);M[r].add(A);S[t].add(C);S[i].add(C);S[r].add(C)}for(e=0,t=this.faces.length;e<t;e++){o=this.faces[e];s=this.faceVertexUvs[0][e];if(o instanceof THREE.Face3){N(this,o.a,o.b,o.c,0,1,2)}else if(o instanceof THREE.Face4){N(this,o.a,o.b,o.d,0,1,3);N(this,o.b,o.c,o.d,1,2,3)}}var O=["a","b","c","d"];for(e=0,t=this.faces.length;e<t;e++){o=this.faces[e];for(n=0;n<o.vertexNormals.length;n++){L.copy(o.vertexNormals[n]);a=o[O[n]];H=M[a];D.copy(H);D.sub(L.multiplyScalar(L.dot(H))).normalize();P.crossVectors(o.vertexNormals[n],H);w=P.dot(S[a]);U=w<0?-1:1;o.vertexTangents[n]=new THREE.Vector4(D.x,D.y,D.z,U)}}this.hasTangents=true},computeLineDistances:function(){var e=0;var t=this.vertices;for(var i=0,r=t.length;i<r;i++){if(i>0){e+=t[i].distanceTo(t[i-1])}this.lineDistances[i]=e}},computeBoundingBox:function(){if(this.boundingBox===null){this.boundingBox=new THREE.Box3;if(!this.boundingBox_list)this.boundingBox_list=[this.boundingBox]}this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){if(this.boundingSphere===null){this.boundingSphere=new THREE.Sphere}this.boundingSphere.setFromCenterAndPoints(this.boundingSphere.center,this.vertices)},mergeVertices:function(){var e={};var t=[],i=[];var r,n;var a=4;var o=Math.pow(10,a);var s,l,h;var f,c,u,d,p;this.__tmpVertices=undefined;for(s=0,l=this.vertices.length;s<l;s++){r=this.vertices[s];n=[Math.round(r.x*o),Math.round(r.y*o),Math.round(r.z*o)].join("_");if(e[n]===undefined){e[n]=s;t.push(this.vertices[s]);i[s]=t.length-1}else{i[s]=i[e[n]]}}var m=[];for(s=0,l=this.faces.length;s<l;s++){h=this.faces[s];if(h instanceof THREE.Face3){h.a=i[h.a];h.b=i[h.b];h.c=i[h.c];f=[h.a,h.b,h.c];var E=-1;for(var g=0;g<3;g++){if(f[g]==f[(g+1)%3]){E=g;m.push(s);break}}}else if(h instanceof THREE.Face4){h.a=i[h.a];h.b=i[h.b];h.c=i[h.c];h.d=i[h.d];f=[h.a,h.b,h.c,h.d];var E=-1;for(var g=0;g<4;g++){if(f[g]==f[(g+1)%4]){if(E>=0){m.push(s)}E=g}}if(E>=0){f.splice(E,1);var v=new THREE.Face3(f[0],f[1],f[2],h.normal,h.color,h.materialIndex);for(u=0,d=this.faceVertexUvs.length;u<d;u++){p=this.faceVertexUvs[u][s];if(p){p.splice(E,1)}}if(h.vertexNormals&&h.vertexNormals.length>0){v.vertexNormals=h.vertexNormals;v.vertexNormals.splice(E,1)}if(h.vertexColors&&h.vertexColors.length>0){v.vertexColors=h.vertexColors;v.vertexColors.splice(E,1)}this.faces[s]=v}}}for(s=m.length-1;s>=0;s--){this.faces.splice(s,1);for(u=0,d=this.faceVertexUvs.length;u<d;u++){this.faceVertexUvs[u].splice(s,1)}}var T=this.vertices.length-t.length;this.vertices=t;return T},clone:function(){var e=new THREE.Geometry;var t=this.vertices;for(var i=0,r=t.length;i<r;i++){e.vertices.push(t[i].clone())}var n=this.faces;for(var i=0,r=n.length;i<r;i++){e.faces.push(n[i].clone())}var a=this.faceVertexUvs[0];for(var i=0,r=a.length;i<r;i++){var o=a[i],s=[];for(var l=0,h=o.length;l<h;l++){s.push(new THREE.Vector2(o[l].x,o[l].y))}e.faceVertexUvs[0].push(s)}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype);THREE.GeometryIdCount=0;THREE.BufferGeometry=function(){this.id=THREE.GeometryIdCount++;this.attributes={};this.dynamic=false;this.offsets=[];this.boundingBox=null;this.boundingSphere=null;this.hasTangents=false;this.morphTargets=[]};THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,applyMatrix:function(e){var t;var i;if(this.attributes["position"])t=this.attributes["position"].array;if(this.attributes["normal"])i=this.attributes["normal"].array;if(t!==undefined){e.multiplyVector3Array(t);this.verticesNeedUpdate=true}if(i!==undefined){var r=(new THREE.Matrix3).getNormalMatrix(e);r.multiplyVector3Array(i);this.normalizeNormals();this.normalsNeedUpdate=true}},computeBoundingBox:function(){if(this.boundingBox===null){this.boundingBox=new THREE.Box3}var e=this.attributes["position"].array;if(e){var t=this.boundingBox;var i,r,n;if(e.length>=3){t.min.x=t.max.x=e[0];t.min.y=t.max.y=e[1];t.min.z=t.max.z=e[2]}for(var a=3,o=e.length;a<o;a+=3){i=e[a];r=e[a+1];n=e[a+2];if(i<t.min.x){t.min.x=i}else if(i>t.max.x){t.max.x=i}if(r<t.min.y){t.min.y=r}else if(r>t.max.y){t.max.y=r}if(n<t.min.z){t.min.z=n}else if(n>t.max.z){t.max.z=n}}}if(e===undefined||e.length===0){this.boundingBox.min.set(0,0,0);this.boundingBox.max.set(0,0,0)}},computeBoundingSphere:function(){if(this.boundingSphere===null){this.boundingSphere=new THREE.Sphere}var e=this.attributes["position"].array;if(e){var t,i=0;var r,n,a;for(var o=0,s=e.length;o<s;o+=3){r=e[o];n=e[o+1];a=e[o+2];t=r*r+n*n+a*a;if(t>i)i=t}this.boundingSphere.radius=Math.sqrt(i)}},computeVertexNormals:function(){if(this.attributes["position"]){var e,t;var i,r;var n=this.attributes["position"].array.length;if(this.attributes["normal"]===undefined){this.attributes["normal"]={itemSize:3,array:new Float32Array(n),numItems:n}}else{for(e=0,t=this.attributes["normal"].array.length;e<t;e++){this.attributes["normal"].array[e]=0}}var a=this.attributes["position"].array;var o=this.attributes["normal"].array;var s,l,h,f,c,u,d=new THREE.Vector3,p=new THREE.Vector3,m=new THREE.Vector3,E=new THREE.Vector3,g=new THREE.Vector3;if(this.attributes["index"]){var v=this.attributes["index"].array;var T=this.offsets;for(i=0,r=T.length;i<r;++i){var y=T[i].start;var _=T[i].count;var R=T[i].index;for(e=y,t=y+_;e<t;e+=3){s=R+v[e];l=R+v[e+1];h=R+v[e+2];f=a[s*3];c=a[s*3+1];u=a[s*3+2];d.set(f,c,u);f=a[l*3];c=a[l*3+1];u=a[l*3+2];p.set(f,c,u);f=a[h*3];c=a[h*3+1];u=a[h*3+2];m.set(f,c,u);E.subVectors(m,p);g.subVectors(d,p);E.cross(g);o[s*3]+=E.x;o[s*3+1]+=E.y;o[s*3+2]+=E.z;o[l*3]+=E.x;o[l*3+1]+=E.y;o[l*3+2]+=E.z;o[h*3]+=E.x;o[h*3+1]+=E.y;o[h*3+2]+=E.z}}}else{for(e=0,t=a.length;e<t;e+=9){f=a[e];c=a[e+1];u=a[e+2];d.set(f,c,u);f=a[e+3];c=a[e+4];u=a[e+5];p.set(f,c,u);f=a[e+6];c=a[e+7];u=a[e+8];m.set(f,c,u);E.subVectors(m,p);g.subVectors(d,p);E.cross(g);o[e]=E.x;o[e+1]=E.y;o[e+2]=E.z;o[e+3]=E.x;o[e+4]=E.y;o[e+5]=E.z;o[e+6]=E.x;o[e+7]=E.y;o[e+8]=E.z}}this.normalizeNormals();this.normalsNeedUpdate=true}},normalizeNormals:function(){var e=this.attributes["normal"].array;var t,i,r,n;for(var a=0,o=e.length;a<o;a+=3){t=e[a];i=e[a+1];r=e[a+2];n=1/Math.sqrt(t*t+i*i+r*r);e[a]*=n;e[a+1]*=n;e[a+2]*=n}},computeTangents:function(){var e=this.attributes["index"].array;var r=this.attributes["position"].array;var t=this.attributes["normal"].array;var n=this.attributes["uv"].array;var F=r.length/3;if(this.attributes["tangent"]===undefined){var O=4*F;this.attributes["tangent"]={itemSize:4,array:new Float32Array(O),numItems:O}}var i=this.attributes["tangent"].array;var a=[],o=[];for(var s=0;s<F;s++){a[s]=new THREE.Vector3;o[s]=new THREE.Vector3}var l,h,f,z,I,V,k,B,j,c,u,G,W,X,q,d,p,m,Y,$,K,E,g,v,T,y;var _=new THREE.Vector3,R=new THREE.Vector3;function Q(e,t,i){l=r[e*3];h=r[e*3+1];f=r[e*3+2];z=r[t*3];I=r[t*3+1];V=r[t*3+2];k=r[i*3];B=r[i*3+1];j=r[i*3+2];c=n[e*2];u=n[e*2+1];G=n[t*2];W=n[t*2+1];X=n[i*2];q=n[i*2+1];d=z-l;p=k-l;m=I-h;Y=B-h;$=V-f;K=j-f;E=G-c;g=X-c;v=W-u;T=q-u;y=1/(E*T-g*v);_.set((T*d-v*p)*y,(T*m-v*Y)*y,(T*$-v*K)*y);R.set((E*p-g*d)*y,(E*Y-g*m)*y,(E*K-g*$)*y);a[e].add(_);a[t].add(_);a[i].add(_);o[e].add(R);o[t].add(R);o[i].add(R)}var x,b;var H,w;var M,S,A;var C=this.offsets;for(H=0,w=C.length;H<w;++H){var D=C[H].start;var Z=C[H].count;var P=C[H].index;for(x=D,b=D+Z;x<b;x+=3){M=P+e[x];S=P+e[x+1];A=P+e[x+2];Q(M,S,A)}}var L=new THREE.Vector3,J=new THREE.Vector3;var U=new THREE.Vector3,ee=new THREE.Vector3;var te,N,ie;function re(e){U.x=t[e*3];U.y=t[e*3+1];U.z=t[e*3+2];ee.copy(U);N=a[e];L.copy(N);L.sub(U.multiplyScalar(U.dot(N))).normalize();J.crossVectors(ee,N);ie=J.dot(o[e]);te=ie<0?-1:1;i[e*4]=L.x;i[e*4+1]=L.y;i[e*4+2]=L.z;i[e*4+3]=te}for(H=0,w=C.length;H<w;++H){var D=C[H].start;var Z=C[H].count;var P=C[H].index;for(x=D,b=D+Z;x<b;x+=3){M=P+e[x];S=P+e[x+1];A=P+e[x+2];re(M);re(S);re(A)}}this.hasTangents=true;this.tangentsNeedUpdate=true},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype);THREE.Camera=function(){THREE.Object3D.call(this);this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4;this.projectionMatrixInverse=new THREE.Matrix4};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.lookAt=function(){var t=new THREE.Matrix4;return function(e){t.lookAt(this.position,e,this.up);this._lookAt.copy(e);if(this.useQuaternion===true){this.quaternion.setFromRotationMatrix(t)}else{this.rotation.setEulerFromRotationMatrix(t,this.eulerOrder)}}}();THREE.OrthographicCamera=function(e,t,i,r,n,a){THREE.Camera.call(this);this.left=e;this.right=t;this.top=i;this.bottom=r;this.near=n!==undefined?n:.1;this.far=a!==undefined?a:2e3;this.updateProjectionMatrix()};THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype);THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)};THREE.PerspectiveCamera=function(e,t,i,r){THREE.Camera.call(this);this.fov=e!==undefined?e:50;this.aspect=t!==undefined?t:1;this.near=i!==undefined?i:.1;this.far=r!==undefined?r:2e3;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype);THREE.PerspectiveCamera.prototype.setLens=function(e,t){if(t===undefined)t=24;this.fov=2*THREE.Math.radToDeg(Math.atan(t/(e*2)));this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.setViewOffset=function(e,t,i,r,n,a){this.fullWidth=e;this.fullHeight=t;this.x=i;this.y=r;this.width=n;this.height=a;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight;var t=Math.tan(THREE.Math.degToRad(this.fov*.5))*this.near;var i=-t;var r=e*i;var n=e*t;var a=Math.abs(n-r);var o=Math.abs(t-i);this.projectionMatrix.makeFrustum(r+this.x*a/this.fullWidth,r+(this.x+this.width)*a/this.fullWidth,t-(this.y+this.height)*o/this.fullHeight,t-this.y*o/this.fullHeight,this.near,this.far)}else{this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)}};THREE.Light=function(e){THREE.Object3D.call(this);this.color=new THREE.Color(e||16777215)};THREE.Light.prototype=Object.create(THREE.Object3D.prototype);THREE.Light.prototype.clone=function(e){if(e===undefined)e=new THREE.Light;THREE.Object3D.prototype.clone.call(this,e);e.color.copy(this.color);return e};THREE.AmbientLight=function(e){if(typeof e==="object")e=e.color;THREE.Light.call(this,e)};THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype);THREE.AmbientLight.prototype.clone=function(){var e=new THREE.AmbientLight;THREE.Light.prototype.clone.call(this,e);return e};THREE.AreaLight=function(e,t){if(typeof e==="object"){t=e.intensity;e=e.color}THREE.Light.call(this,e);this.normal=new THREE.Vector3(0,-1,0);this.right=new THREE.Vector3(1,0,0);this.intensity=t!==undefined?t:1;this.width=1;this.height=1;this.constantAttenuation=1.5;this.linearAttenuation=.5;this.quadraticAttenuation=.1};THREE.AreaLight.prototype=Object.create(THREE.Light.prototype);THREE.DirectionalLight=function(e,t){if(typeof e==="object"){t=e.intensity;e=e.color}THREE.Light.call(this,e);this.position.set(0,1,0);this.target=new THREE.Object3D;this.target.position=this._lookAt;this.intensity=t!==undefined?t:1;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraLeft=-500;this.shadowCameraRight=500;this.shadowCameraTop=500;this.shadowCameraBottom=-500;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowBias_range=[.1,100];this.shadowCascade=false;this.shadowCascadeOffset=new THREE.Vector3(0,0,-1e3);this.shadowCascadeCount=2;this.shadowCascadeBias=[0,0,0];this.shadowCascadeWidth=[512,512,512];this.shadowCascadeHeight=[512,512,512];this.shadowCascadeNearZ=[-1,.99,.998];this.shadowCascadeFarZ=[.99,.998,1];this.shadowCascadeArray=[];this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype);THREE.DirectionalLight.prototype.clone=function(){var e=new THREE.DirectionalLight;THREE.Light.prototype.clone.call(this,e);e.target=this.target.clone();e.target.position=e._lookAt;e.intensity=this.intensity;e.castShadow=this.castShadow;e.onlyShadow=this.onlyShadow;return e};THREE.HemisphereLight=function(e,t,i){if(typeof e==="object"){i=e.intensity;t=e.ground;e=e.sky}THREE.Light.call(this,e);this.sky=this.color;this.position.set(0,100,0);this.ground=this.groundColor=new THREE.Color(t);this.intensity=i!==undefined?i:1};THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype);THREE.HemisphereLight.prototype.clone=function(){var e=new THREE.HemisphereLight;THREE.Light.prototype.clone.call(this,e);e.groundColor.copy(this.groundColor);e.intensity=this.intensity;return e};THREE.PointLight=function(e,t,i){if(typeof e==="object"){t=e.intensity;i=e.distance;e=e.color}THREE.Light.call(this,e);this.intensity=t!==undefined?t:1;this.distance=i!==undefined?i:0};THREE.PointLight.prototype=Object.create(THREE.Light.prototype);THREE.PointLight.prototype.clone=function(){var e=new THREE.PointLight;THREE.Light.prototype.clone.call(this,e);e.intensity=this.intensity;e.distance=this.distance;return e};THREE.SpotLight=function(e,t,i,r,n){if(typeof e==="object"){t=e.intensity;i=e.distance;r=e.angle;n=e.exponent;e=e.color}THREE.Light.call(this,e);this.position.set(0,1,0);this.target=new THREE.Object3D;this.target.position=this._lookAt;this.intensity=t!==undefined?t:1;this.distance=i!==undefined?i:0;this.angle=r!==undefined?r:Math.PI/3;this.exponent=n!==undefined?n:10;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraFov=50;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};THREE.SpotLight.prototype=Object.create(THREE.Light.prototype);THREE.SpotLight.prototype.clone=function(){var e=new THREE.SpotLight;THREE.Light.prototype.clone.call(this,e);e.target=this.target.clone();e.target.position=e._lookAt;e.intensity=this.intensity;e.distance=this.distance;e.angle=this.angle;e.exponent=this.exponent;e.castShadow=this.castShadow;e.onlyShadow=this.onlyShadow;return e};THREE.ImageLoader=function(){this.crossOrigin=null};THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(i,c){var r=this;if(c===undefined)c=new Image;c.addEventListener("load",function(){var t;if(self.MMD_SA){let e=c._texture_resolution_limit||MMD_SA_options.texture_resolution_limit;if(c.width>e||c.height>e){t=document.createElement("canvas");t.width=Math.min(e,c.width);t.height=Math.min(e,c.height);t.getContext("2d").drawImage(c,0,0,t.width,t.height)}}if(!t)t=c;r.dispatchEvent({type:"load",content:t})},false);c.addEventListener("error",function(){r.dispatchEvent({type:"error",message:"Couldn't load URL ["+i+"]"})},false);if(/^(tga|TGA)/.test(i.split(".").pop())){var t=new THREE.TGA;t.open(i,function(){delete c.crossOrigin;c.src=t.getDataURL();t=null},function(){var e=document.createEvent("HTMLEvents");e.initEvent("error",false,true);c.dispatchEvent(e);t=null})}else{if(!/^data:image/.test(i))c.crossOrigin="anonymous";if(!/^(data|blob)\:/.test(i)||/\.zip\#/i.test(toLocalPath(i))){let e=new XMLHttpRequestZIP;e.onload=function(){var h=URL.createObjectURL(this.response);if(/^(.+)\.jpga\.jpg$/i.test(i)){var t=RegExp.$1+".alpha.png";console.log("Use JPG alpha - "+t);var f=new Image;f.addEventListener("load",function(){URL.revokeObjectURL(h);var e=new XMLHttpRequestZIP;e.onload=function(){h=URL.createObjectURL(this.response);var l=new Image;l.addEventListener("load",function(){URL.revokeObjectURL(h);var t=document.createElement("canvas");var i=t.getContext("2d");t.width=l.width;t.height=l.height;i.drawImage(l,0,0);var e=i.getImageData(0,0,t.width,t.height);var r=new Uint32Array(e.data.buffer);var n=0,a=r.length;while(n<a){r[n]=r[n++]<<8}i.putImageData(e,0,0);e=r=null;var o=document.createElement("canvas");o.width=f.width;o.height=f.height;var s=o.getContext("2d");s.drawImage(f,0,0);s.globalCompositeOperation="destination-in";s.drawImage(t,0,0);o.toBlob(function(e){h=URL.createObjectURL(e);c.addEventListener("load",function(){URL.revokeObjectURL(h)});c.src=h;f=l=null;t.width=t.height=o.width=o.height=0;t=i=o=s=null})});l.src=h;this.response=e=null};e.open("GET",t,true);e.responseType="blob";e.send()});f.src=h}else{c.addEventListener("load",function(){URL.revokeObjectURL(h)});c.src=h}this.response=e=null};e.onerror=function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");t.fillStyle="white";t.fillRect(0,0,1,1);r.dispatchEvent({type:"load",content:e})};e.open("GET",i,true);e.responseType="blob";e.send()}else c.src=i}}};THREE.EventDispatcher.prototype.apply(THREE.ImageLoader.prototype);THREE.Material=function(){this.id=THREE.MaterialIdCount++;this.name="";this.side=THREE.FrontSide;this.opacity=1;this.transparent=true;this.blending=THREE.NormalBlending;this.blendSrc=THREE.SrcAlphaFactor;this.blendDst=THREE.OneMinusSrcAlphaFactor;this.blendEquation=THREE.AddEquation;this.depthTest=true;this.depthWrite=true;this.polygonOffset=false;this.polygonOffsetFactor=0;this.polygonOffsetUnits=0;this.alphaTest=0;this.overdraw=false;this.visible=true;this.needsUpdate=true;this.userData={}};THREE.Material.prototype={constructor:THREE.Material,setValues:function(e){if(e===undefined)return;for(var t in e){var i=e[t];if(t in this){var r=this[t];if(r instanceof THREE.Color){r.set(i)}else if(r instanceof THREE.Vector3&&i instanceof THREE.Vector3){r.copy(i)}else{this[t]=i}}}},clone:function(e){if(e===undefined)e=new THREE.Material;e.name=this.name;e.side=this.side;e.opacity=this.opacity;e.transparent=this.transparent;e.blending=this.blending;e.blendSrc=this.blendSrc;e.blendDst=this.blendDst;e.blendEquation=this.blendEquation;e.depthTest=this.depthTest;e.depthWrite=this.depthWrite;e.polygonOffset=this.polygonOffset;e.polygonOffsetFactor=this.polygonOffsetFactor;e.polygonOffsetUnits=this.polygonOffsetUnits;e.alphaTest=this.alphaTest;e.overdraw=this.overdraw;e.visible=this.visible;e.offset=this.offset&&this.offset.clone();e.repeat=this.repeat&&this.repeat.clone();if("uniTexture"in this)e.uniTexture=this.uniTexture;return e},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Material.prototype);THREE.MaterialIdCount=0;THREE.LineBasicMaterial=function(e){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.linewidth=1;this.linecap="round";this.linejoin="round";this.vertexColors=false;this.fog=true;this.setValues(e)};THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineBasicMaterial.prototype.clone=function(){var e=new THREE.LineBasicMaterial;THREE.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.linewidth=this.linewidth;e.linecap=this.linecap;e.linejoin=this.linejoin;e.vertexColors=this.vertexColors;e.fog=this.fog;return e};THREE.LineDashedMaterial=function(e){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.linewidth=1;this.scale=1;this.dashSize=3;this.gapSize=1;this.vertexColors=false;this.fog=true;this.setValues(e)};THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineDashedMaterial.prototype.clone=function(){var e=new THREE.LineDashedMaterial;THREE.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.linewidth=this.linewidth;e.scale=this.scale;e.dashSize=this.dashSize;e.gapSize=this.gapSize;e.vertexColors=this.vertexColors;e.fog=this.fog;return e};THREE.MeshBasicMaterial=function(e){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.map=null;this.lightMap=null;this.specularMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.setValues(e)};THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshBasicMaterial.prototype.clone=function(){var e=new THREE.MeshBasicMaterial;THREE.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.map=this.map;e.lightMap=this.lightMap;e.specularMap=this.specularMap;e.envMap=this.envMap;e.combine=this.combine;e.reflectivity=this.reflectivity;e.refractionRatio=this.refractionRatio;e.fog=this.fog;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.wireframeLinecap=this.wireframeLinecap;e.wireframeLinejoin=this.wireframeLinejoin;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;return e};THREE.MeshLambertMaterial=function(e){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.ambient=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.wrapAround=false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=null;this.lightMap=null;this.specularMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)};THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshLambertMaterial.prototype.clone=function(){var e=new THREE.MeshLambertMaterial;THREE.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.ambient.copy(this.ambient);e.emissive.copy(this.emissive);e.wrapAround=this.wrapAround;e.wrapRGB.copy(this.wrapRGB);e.map=this.map;e.lightMap=this.lightMap;e.specularMap=this.specularMap;e.envMap=this.envMap;e.combine=this.combine;e.reflectivity=this.reflectivity;e.refractionRatio=this.refractionRatio;e.fog=this.fog;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.wireframeLinecap=this.wireframeLinecap;e.wireframeLinejoin=this.wireframeLinejoin;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;e.morphNormals=this.morphNormals;return e};THREE.MeshPhongMaterial=function(e){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.ambient=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.specular=new THREE.Color(1118481);this.shininess=30;this.metal=false;this.perPixel=true;this.wrapAround=false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=null;this.lightMap=null;this.bumpMap=null;this.bumpScale=1;this.displacementMap=null;this.uDisplacementBias=0;this.uDisplacementScale=1;this.uDisplacementCustomUVScale=0;this.uDisplacementCustomUVOffset=new THREE.Vector2(0,0);this.edgeRotateDisplacementL=0;this.edgeRotateDisplacementR=0;this.edgeScaleDisplacementU=1;this.waveBaseSpeed=null;this.waveNoiseTexture=null;this.waveNoiseScale=.5337;this.waveBumpScale=5;this.mirrorTextureIndex=null;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.specularMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)};THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshPhongMaterial.prototype.clone=function(){var e=new THREE.MeshPhongMaterial;THREE.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.ambient.copy(this.ambient);e.emissive.copy(this.emissive);e.specular.copy(this.specular);e.shininess=this.shininess;e.metal=this.metal;e.perPixel=this.perPixel;e.wrapAround=this.wrapAround;e.wrapRGB.copy(this.wrapRGB);e.map=this.map;e.lightMap=this.lightMap;e.bumpMap=this.bumpMap;e.bumpScale=this.bumpScale;e.displacementMap=this.displacementMap;e.uDisplacementBias=this.uDisplacementBias;e.uDisplacementScale=this.uDisplacementScale;e.uDisplacementCustomUVScale=this.uDisplacementCustomUVScale;e.uDisplacementCustomUVOffset.copy(this.uDisplacementCustomUVOffset);e.edgeRotateDisplacementL=this.edgeRotateDisplacementL;e.edgeRotateDisplacementR=this.edgeRotateDisplacementR;e.edgeScaleDisplacementU=this.edgeScaleDisplacementU;e.waveBaseSpeed=this.waveBaseSpeed;e.waveNoiseTexture=this.waveNoiseTexture;e.waveNoiseScale=this.waveNoiseScale;e.waveBumpScale=this.waveBumpScale;e.mirrorTextureIndex=this.mirrorTextureIndex;e.normalMap=this.normalMap;e.normalScale.copy(this.normalScale);e.specularMap=this.specularMap;e.envMap=this.envMap;e.combine=this.combine;e.reflectivity=this.reflectivity;e.refractionRatio=this.refractionRatio;e.fog=this.fog;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.wireframeLinecap=this.wireframeLinecap;e.wireframeLinejoin=this.wireframeLinejoin;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;e.morphNormals=this.morphNormals;return e};THREE.MeshDepthMaterial=function(e){THREE.Material.call(this);this.wireframe=false;this.wireframeLinewidth=1;this.setValues(e)};THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshDepthMaterial.prototype.clone=function(){var e=new THREE.MeshDepthMaterial;THREE.Material.prototype.clone.call(this,e);e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;return e};THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e);this.shading=THREE.FlatShading;this.wireframe=false;this.wireframeLinewidth=1;this.morphTargets=false;this.setValues(e)};THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshNormalMaterial.prototype.clone=function(){var e=new THREE.MeshNormalMaterial;THREE.Material.prototype.clone.call(this,e);e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;return e};THREE.MeshFaceMaterial=function(e){this.materials=e instanceof Array?e:[]};THREE.MeshFaceMaterial.prototype.clone=function(){return new THREE.MeshFaceMaterial(this.materials.slice(0))};THREE.ParticleBasicMaterial=function(e){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=true;this.vertexColors=false;this.fog=true;this.setValues(e)};THREE.ParticleBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ParticleBasicMaterial.prototype.clone=function(){var e=new THREE.ParticleBasicMaterial;THREE.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.map=this.map;e.size=this.size;e.sizeAttenuation=this.sizeAttenuation;e.vertexColors=this.vertexColors;e.fog=this.fog;return e};THREE.ParticleSystemMaterial=THREE.ParticleBasicMaterial;THREE.ShaderMaterial=function(e){THREE.Material.call(this);this.fragmentShader="void main() {}";this.vertexShader="void main() {}";this.uniforms={};this.defines={};this.attributes=null;this.shading=THREE.SmoothShading;this.linewidth=1;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;this.lights=false;this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)};THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ShaderMaterial.prototype.clone=function(){var e=new THREE.ShaderMaterial;THREE.Material.prototype.clone.call(this,e);e.fragmentShader=this.fragmentShader;e.vertexShader=this.vertexShader;e.uniforms=THREE.UniformsUtils.clone(this.uniforms);e.attributes=this.attributes;e.defines=this.defines;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.fog=this.fog;e.lights=this.lights;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;e.morphNormals=this.morphNormals;return e};THREE.SpriteMaterial=function(e){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.map=new THREE.Texture;this.useScreenCoordinates=true;this.depthTest=!this.useScreenCoordinates;this.sizeAttenuation=!this.useScreenCoordinates;this.scaleByViewport=!this.sizeAttenuation;this.alignment=THREE.SpriteAlignment.center.clone();this.fog=false;this.uvOffset=new THREE.Vector2(0,0);this.uvScale=new THREE.Vector2(1,1);this.setValues(e);e=e||{};if(e.depthTest===undefined)this.depthTest=!this.useScreenCoordinates;if(e.sizeAttenuation===undefined)this.sizeAttenuation=!this.useScreenCoordinates;if(e.scaleByViewport===undefined)this.scaleByViewport=!this.sizeAttenuation};THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteMaterial.prototype.clone=function(){var e=new THREE.SpriteMaterial;THREE.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.map=this.map;e.useScreenCoordinates=this.useScreenCoordinates;e.sizeAttenuation=this.sizeAttenuation;e.scaleByViewport=this.scaleByViewport;e.alignment.copy(this.alignment);e.uvOffset.copy(this.uvOffset);e.uvScale.copy(this.uvScale);e.fog=this.fog;return e};THREE.SpriteAlignment={};THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1);THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1);THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1);THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0);THREE.SpriteAlignment.center=new THREE.Vector2(0,0);THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0);THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1);THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1);THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1);THREE.Texture=function(e,t,i,r,n,a,o,s,l){this.id=THREE.TextureIdCount++;this.name="";this.image=e;this.mipmaps=[];this.mapping=t!==undefined?t:new THREE.UVMapping;this.wrapS=i!==undefined?i:THREE.ClampToEdgeWrapping;this.wrapT=r!==undefined?r:THREE.ClampToEdgeWrapping;this.magFilter=n!==undefined?n:THREE.LinearFilter;this.minFilter=a!==undefined?a:THREE.LinearMipMapLinearFilter;this.anisotropy=l!==undefined?l:1;this.format=o!==undefined?o:THREE.RGBAFormat;this.type=s!==undefined?s:THREE.UnsignedByteType;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.generateMipmaps=true;this.premultiplyAlpha=false;this.flipY=true;this.unpackAlignment=4;this.needsUpdate=false;this.onUpdate=null};THREE.Texture.prototype={constructor:THREE.Texture,clone:function(e){if(e===undefined)e=new THREE.Texture;e.image=this.image;e.mipmaps=this.mipmaps.slice(0);e.mapping=this.mapping;e.wrapS=this.wrapS;e.wrapT=this.wrapT;e.magFilter=this.magFilter;e.minFilter=this.minFilter;e.anisotropy=this.anisotropy;e.format=this.format;e.type=this.type;e.offset.copy(this.offset);e.repeat.copy(this.repeat);e.generateMipmaps=this.generateMipmaps;e.premultiplyAlpha=this.premultiplyAlpha;e.flipY=this.flipY;e.unpackAlignment=this.unpackAlignment;return e},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype);THREE.TextureIdCount=0;THREE.CompressedTexture=function(e,t,i,r,n,a,o,s,l,h,f){THREE.Texture.call(this,null,a,o,s,l,h,r,n,f);this.image={width:t,height:i};this.mipmaps=e;this.generateMipmaps=false};THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CompressedTexture.prototype.clone=function(){var e=new THREE.CompressedTexture;THREE.Texture.prototype.clone.call(this,e);return e};THREE.DataTexture=function(e,t,i,r,n,a,o,s,l,h,f){THREE.Texture.call(this,null,a,o,s,l,h,r,n,f);this.image={data:e,width:t,height:i}};THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DataTexture.prototype.clone=function(){var e=new THREE.DataTexture;THREE.Texture.prototype.clone.call(this,e);return e};THREE.Particle=function(e){THREE.Object3D.call(this);this.material=e};THREE.Particle.prototype=Object.create(THREE.Object3D.prototype);THREE.Particle.prototype.clone=function(e){if(e===undefined)e=new THREE.Particle(this.material);THREE.Object3D.prototype.clone.call(this,e);return e};THREE.ParticleSystem=function(e,t){THREE.Object3D.call(this);this.geometry=e;this.material=t!==undefined?t:new THREE.ParticleBasicMaterial({color:Math.random()*16777215});this.sortParticles=false;if(this.geometry){if(this.geometry.boundingSphere===null){this.geometry.computeBoundingSphere()}}this.frustumCulled=false};THREE.ParticleSystem.prototype=Object.create(THREE.Object3D.prototype);THREE.ParticleSystem.prototype.clone=function(e){if(e===undefined)e=new THREE.ParticleSystem(this.geometry,this.material);e.sortParticles=this.sortParticles;THREE.Object3D.prototype.clone.call(this,e);return e};THREE.Line=function(e,t,i){THREE.Object3D.call(this);this.geometry=e;this.material=t!==undefined?t:new THREE.LineBasicMaterial({color:Math.random()*16777215});this.type=i!==undefined?i:THREE.LineStrip;if(this.geometry){if(!this.geometry.boundingSphere){this.geometry.computeBoundingSphere()}}};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=Object.create(THREE.Object3D.prototype);THREE.Line.prototype.clone=function(e){if(e===undefined)e=new THREE.Line(this.geometry,this.material,this.type);THREE.Object3D.prototype.clone.call(this,e);return e};THREE.Mesh=function(e,t){THREE.Object3D.call(this);this.geometry=null;this.material=null;this.setGeometry(e);this.setMaterial(t)};THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype);THREE.Mesh.prototype.setGeometry=function(e){if(e!==undefined){this.geometry=e;if(this.geometry.boundingSphere===null){this.geometry.computeBoundingSphere()}this.updateMorphTargets()}};THREE.Mesh.prototype.setMaterial=function(e){if(e!==undefined){this.material=e}else{this.material=new THREE.MeshBasicMaterial({color:Math.random()*16777215,wireframe:true})}};THREE.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets.length>0){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++){this.morphTargetInfluences.push(0);this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}}};THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){if(this.morphTargetDictionary[e]!==undefined){return this.morphTargetDictionary[e]}return 0};THREE.Mesh.prototype.clone=function(e){if(e===undefined)e=new THREE.Mesh(this.geometry,this.material);THREE.Object3D.prototype.clone.call(this,e);return e};THREE.Bone=function(e){THREE.Object3D.call(this);this.skin=e;this.skinMatrix=new THREE.Matrix4};THREE.Bone.prototype=Object.create(THREE.Object3D.prototype);THREE.Bone.prototype.update=function(e,t){if(this.matrixAutoUpdate){t|=this.updateMatrix()}if(t||this.matrixWorldNeedsUpdate){if(e){this.skinMatrix.multiplyMatrices(e,this.matrix)}else{this.skinMatrix.copy(this.matrix)}this.matrixWorldNeedsUpdate=false;t=true}var i,r,n=this.children.length;for(r=0;r<n;r++){this.children[r].update(this.skinMatrix,t)}};THREE.SkinnedMesh=function(e,t,i){THREE.Mesh.call(this,e,t);this.useVertexTexture=i!==undefined?i:true;this.identityMatrix=new THREE.Matrix4;this.bones=[];this.boneMatrices=[];var r,n,a,o,s,l;if(this.geometry&&this.geometry.bones!==undefined){for(r=0;r<this.geometry.bones.length;r++){a=this.geometry.bones[r];o=a.pos;s=a.rotq;l=a.scl;n=this.addBone();n.name=a.name;n.position.set(o[0],o[1],o[2]);n.quaternion.set(s[0],s[1],s[2],s[3]);n.useQuaternion=true;if(l!==undefined){n.scale.set(l[0],l[1],l[2])}else{n.scale.set(1,1,1)}}for(r=0;r<this.bones.length;r++){a=this.geometry.bones[r];n=this.bones[r];if(a.parent===-1){this.add(n)}else{this.bones[a.parent].add(n)}}var h=this.bones.length;if(this.useVertexTexture){var f;if(h>256)f=64;else if(h>64)f=32;else if(h>16)f=16;else f=8;this.boneTextureWidth=f;this.boneTextureHeight=f;this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4);this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType);this.boneTexture.minFilter=THREE.NearestFilter;this.boneTexture.magFilter=THREE.NearestFilter;this.boneTexture.generateMipmaps=false;this.boneTexture.flipY=false}else{this.boneMatrices=new Float32Array(16*h)}this.pose()}};THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.SkinnedMesh.prototype.addBone=function(e){if(e===undefined){e=new THREE.Bone(this)}this.bones.push(e);return e};THREE.SkinnedMesh.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e){if(this.parent){this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}else{this.matrixWorld.copy(this.matrix)}this.matrixWorldNeedsUpdate=false;e=true}for(var t=0,i=this.children.length;t<i;t++){var r=this.children[t];if(r instanceof THREE.Bone){r.update(this.identityMatrix,false)}else{r.updateMatrixWorld(true)}}if(this.boneInverses==undefined){this.boneInverses=[];for(var n=0,a=this.bones.length;n<a;n++){var o=new THREE.Matrix4;o.getInverse(this.bones[n].skinMatrix);this.boneInverses.push(o)}}for(var n=0,a=this.bones.length;n<a;n++){THREE.SkinnedMesh.offsetMatrix.multiplyMatrices(this.bones[n].skinMatrix,this.boneInverses[n]);THREE.SkinnedMesh.offsetMatrix.flattenToArrayOffset(this.boneMatrices,n*16)}if(this.useVertexTexture){this.boneTexture.needsUpdate=true}};THREE.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(true);for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e];var i=1/t.lengthManhattan();if(i!==Infinity){t.multiplyScalar(i)}else{t.set(1)}}};THREE.SkinnedMesh.prototype.clone=function(e){if(e===undefined)e=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture);THREE.Mesh.prototype.clone.call(this,e);return e};THREE.SkinnedMesh.offsetMatrix=new THREE.Matrix4;THREE.MorphAnimMesh=function(e,t){THREE.Mesh.call(this,e,t);this.duration=1e3;this.mirroredLoop=false;this.time=0;this.lastKeyframe=0;this.currentKeyframe=0;this.direction=1;this.directionBackwards=false;this.setFrameRange(0,this.geometry.morphTargets.length-1)};THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e;this.endKeyframe=t;this.length=this.endKeyframe-this.startKeyframe+1};THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1;this.directionBackwards=false};THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1;this.directionBackwards=true};THREE.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;if(!e.animations)e.animations={};var t,i=e.animations;var r=/([a-z]+)(\d+)/;for(var n=0,a=e.morphTargets.length;n<a;n++){var o=e.morphTargets[n];var s=o.name.match(r);if(s&&s.length>1){var l=s[1];var h=s[2];if(!i[l])i[l]={start:Infinity,end:-Infinity};var f=i[l];if(n<f.start)f.start=n;if(n>f.end)f.end=n;if(!t)t=l}}e.firstAnimation=t};THREE.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,i){if(!this.geometry.animations)this.geometry.animations={};this.geometry.animations[e]={start:t,end:i}};THREE.MorphAnimMesh.prototype.playAnimation=function(e,t){var i=this.geometry.animations[e];if(i){this.setFrameRange(i.start,i.end);this.duration=1e3*((i.end-i.start)/t);this.time=0}};THREE.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e;if(this.mirroredLoop){if(this.time>this.duration||this.time<0){this.direction*=-1;if(this.time>this.duration){this.time=this.duration;this.directionBackwards=true}if(this.time<0){this.time=0;this.directionBackwards=false}}}else{this.time=this.time%this.duration;if(this.time<0)this.time+=this.duration}var i=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/t),0,this.length-1);if(i!==this.currentKeyframe){this.morphTargetInfluences[this.lastKeyframe]=0;this.morphTargetInfluences[this.currentKeyframe]=1;this.morphTargetInfluences[i]=0;this.lastKeyframe=this.currentKeyframe;this.currentKeyframe=i}var r=this.time%t/t;if(this.directionBackwards){r=1-r}this.morphTargetInfluences[this.currentKeyframe]=r;this.morphTargetInfluences[this.lastKeyframe]=1-r};THREE.MorphAnimMesh.prototype.clone=function(e){if(e===undefined)e=new THREE.MorphAnimMesh(this.geometry,this.material);e.duration=this.duration;e.mirroredLoop=this.mirroredLoop;e.time=this.time;e.lastKeyframe=this.lastKeyframe;e.currentKeyframe=this.currentKeyframe;e.direction=this.direction;e.directionBackwards=this.directionBackwards;THREE.Mesh.prototype.clone.call(this,e);return e};THREE.Ribbon=function(e,t){THREE.Object3D.call(this);this.geometry=e;this.material=t};THREE.Ribbon.prototype=Object.create(THREE.Object3D.prototype);THREE.Ribbon.prototype.clone=function(e){if(e===undefined)e=new THREE.Ribbon(this.geometry,this.material);THREE.Object3D.prototype.clone.call(this,e);return e};THREE.LOD=function(){THREE.Object3D.call(this);this.objects=[]};THREE.LOD.prototype=Object.create(THREE.Object3D.prototype);THREE.LOD.prototype.addLevel=function(e,t){if(t===undefined)t=0;t=Math.abs(t);for(var i=0;i<this.objects.length;i++){if(t<this.objects[i].distance){break}}this.objects.splice(i,0,{distance:t,object:e});this.add(e)};THREE.LOD.prototype.getObjectForDistance=function(e){for(var t=1,i=this.objects.length;t<i;t++){if(e<this.objects[t].distance){break}}return this.objects[t-1].object};THREE.LOD.prototype.update=function(){var n=new THREE.Vector3;var a=new THREE.Vector3;return function(e){if(this.objects.length>1){n.getPositionFromMatrix(e.matrixWorld);a.getPositionFromMatrix(this.matrixWorld);var t=n.distanceTo(a);this.objects[0].object.visible=true;for(var i=1,r=this.objects.length;i<r;i++){if(t>=this.objects[i].distance){this.objects[i-1].object.visible=false;this.objects[i].object.visible=true}else{break}}for(;i<r;i++){this.objects[i].object.visible=false}}}}();THREE.LOD.prototype.clone=function(){};THREE.Sprite=function(e){THREE.Object3D.call(this);this.material=e!==undefined?e:new THREE.SpriteMaterial;this.rotation3d=this.rotation;this.rotation=0};THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype);THREE.Sprite.prototype.updateMatrix=function(){this.rotation3d.set(0,0,this.rotation);this.quaternion.setFromEuler(this.rotation3d,this.eulerOrder);this.matrix.makeFromPositionQuaternionScale(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=true};THREE.Sprite.prototype.clone=function(e){if(e===undefined)e=new THREE.Sprite(this.material);THREE.Object3D.prototype.clone.call(this,e);return e};THREE.Scene=function(){THREE.Object3D.call(this);this.fog=null;this.overrideMaterial=null;this.autoUpdate=true;this.matrixAutoUpdate=false;this.__objects=[];this.__lights=[];this.__objectsAdded=[];this.__objectsRemoved=[]};THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);THREE.Scene.prototype.__addObject=function(e){if(e instanceof THREE.Light){if(this.__lights.indexOf(e)===-1){this.__lights.push(e)}if(e.target&&e.target.parent===undefined){this.add(e.target)}}else if(!(e instanceof THREE.Camera||e instanceof THREE.Bone)){if(this.__objects.indexOf(e)===-1){this.__objects.push(e);this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);if(t!==-1){this.__objectsRemoved.splice(t,1)}}}for(var i=0;i<e.children.length;i++){this.__addObject(e.children[i])}};THREE.Scene.prototype.__removeObject=function(e){if(e instanceof THREE.Light){var t=this.__lights.indexOf(e);if(t!==-1){this.__lights.splice(t,1)}}else if(!(e instanceof THREE.Camera)){var t=this.__objects.indexOf(e);if(t!==-1){this.__objects.splice(t,1);this.__objectsRemoved.push(e);var i=this.__objectsAdded.indexOf(e);if(i!==-1){this.__objectsAdded.splice(i,1)}}}for(var r=0;r<e.children.length;r++){this.__removeObject(e.children[r])}};THREE.Fog=function(e,t,i){this.name="";this.color=new THREE.Color(e);this.near=t!==undefined?t:1;this.far=i!==undefined?i:1e3};THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)};THREE.FogExp2=function(e,t){this.name="";this.color=new THREE.Color(e);this.density=t!==undefined?t:25e-5};THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)};THREE.ShaderChunk={fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#else","vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","#if defined( VERTEX_TEXTURES ) && ( defined( USE_DISPLACEMENTMAP ) || defined( USE_WAVE_TEXTURE ) )","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","#else","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif","#ifdef USE_MIRROR_TEXTURE","mirrorCoord = mirrorTextureMatrix * worldPosition;","#endif","#else","#ifdef USE_UNI_TEXTURE","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif","#ifdef USE_UNI_TEXTURE","vec3 uniTexture_pos;","#if defined( USE_MORPHTARGETS )","uniTexture_pos = morphed;","#endif","#if ! defined( USE_MORPHTARGETS )","uniTexture_pos = position;","#endif","uniTexture_pos = uniTexture_pos - vec3(uniTexture_bs, -uniTexture_bs, uniTexture_bs) * 10.;","uniTexture_MatrixRain_opacity = (uniTexture_MatrixRain_height_limit.x > 0.0) ? clamp((1.0 - (uniTexture_MatrixRain_height_limit.y + uniTexture_bs - position.y) / (uniTexture_bs * 2.0) - uniTexture_MatrixRain_height_limit.x) / (uniTexture_MatrixRain_height_limit.x*0.25), 0.0, 1.0) : 1.0;","uniTexture_vUv = vec2(-length(uniTexture_pos.xz), length(uniTexture_pos.yz)) * 0.1 / uniTexture_scale;","#if !(MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined(USE_XRAY_PASS))","  vWorldPosition = worldPosition.xyz;","#endif","#endif"].join("\n"),uniTexture_pars_vertex:["#ifdef USE_UNI_TEXTURE","  uniform float uniTexture_bs;","  uniform float uniTexture_scale;","  uniform vec2 uniTexture_MatrixRain_height_limit;","  varying vec2 uniTexture_vUv;","  varying float uniTexture_MatrixRain_opacity;","  #if !(MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined(USE_XRAY_PASS))","    varying vec3 vWorldPosition;","  #endif","#endif"].join("\n"),uniTexture_pars_fragment:["#ifdef USE_UNI_TEXTURE","  uniform int uniTexture_state;","  uniform sampler2D uniTexture_map;","  uniform vec4 uniTexture_null_zone;","  varying vec2 uniTexture_vUv;","  varying float uniTexture_MatrixRain_opacity;","  #if !(MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined(USE_XRAY_PASS))","    varying vec3 vWorldPosition;","  #endif","#endif"].join("\n"),uniTexture_fragment:["#ifdef USE_UNI_TEXTURE","if (uniTexture_state == 1) {","  vec4 uni_texture = texture2D( uniTexture_map, uniTexture_vUv );","  #ifdef USE_MATRIX_RAIN_GREEN","    vec3 _color_org = gl_FragColor.rgb;","    float _gray = 0.3 * gl_FragColor.r + 0.59 * gl_FragColor.g + 0.11 * gl_FragColor.b;","    gl_FragColor.rgb = vec3(_gray) * uni_texture.rgb;","    if (uniTexture_MatrixRain_opacity < 1.0) { gl_FragColor.rgb = mix(vec3(0.0, _gray, 0.0), gl_FragColor.rgb, uniTexture_MatrixRain_opacity); }","    if (uniTexture_null_zone.w > 0.0) { gl_FragColor.rgb = mix(_color_org, gl_FragColor.rgb, clamp((distance(vWorldPosition, uniTexture_null_zone.xyz) / (uniTexture_null_zone.w * 1.5) - 0.6667) * 3.0, 0.0, 1.0) ); }","  #endif","  #ifdef USE_MATRIX_RAIN_COLOR","    float _rain_a = uniTexture_MatrixRain_opacity * ((uniTexture_null_zone.w > 0.0) ? clamp((distance(vWorldPosition, uniTexture_null_zone.xyz) / (uniTexture_null_zone.w * 1.25) - 0.75) * 4.0, 0.0, 1.0) : 1.0);","    gl_FragColor.rgb *= 1.0-_rain_a + _rain_a*uni_texture.g;","  #endif","} else if (uniTexture_state == 2) {","  gl_FragColor.rgb *= texture2D( uniTexture_map, uniTexture_vUv ).rgb;","}","#endif"].join("\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","worldNormal = normalize( worldNormal );","vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, worldNormal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, worldNormal );","}","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_DISPLACEMENTMAP ) || defined( USE_WAVE_TEXTURE )","varying vec2 vUv;","uniform vec4 offsetRepeat;","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","#endif","#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_DISPLACEMENTMAP ) || defined( USE_WAVE_TEXTURE )","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","#endif"].join("\n"),map_fragment:["#ifdef USE_MAP","#if defined( VERTEX_TEXTURES ) && defined( USE_WAVE_TEXTURE )","  vec2 uvTimeShift = vUv + vec2( -0.7, 1.5 ) * time * waveBaseSpeed;","  vec4 noiseGeneratorTimeShift = texture2D( waveNoiseTexture, mod(uvTimeShift,1.0) );","  vec2 uvNoiseTimeShift = vUv + waveNoiseScale * vec2( noiseGeneratorTimeShift.r, noiseGeneratorTimeShift.b );","  vec4 texelColor = texture2D( map, mod(uvNoiseTimeShift,1.0) );","#else","vec4 texelColor = texture2D( map, vUv );","#endif","#ifdef GAMMA_INPUT","texelColor.xyz *= texelColor.xyz;","#endif","gl_FragColor = gl_FragColor * texelColor;","#endif"].join("\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = 1.0;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\n"),lights_phong_pars_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","vPointLight[ i ] = vec4( lVector, lDistance );","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","vSpotLight[ i ] = vec4( lVector, lDistance );","}","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","vWorldPosition = worldPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#else","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#else","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["#ifdef COMPUTE_NORMAL_FROM_DISPLACEMENT","  vec3 normal = normalize( cross( dFdx( vViewPosition ), dFdy( vViewPosition ) ) );","#else","vec3 normal = normalize( vNormal );","#endif","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -vViewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vPointLight[ i ].xyz );","float lDistance = vPointLight[ i ].w;","#endif","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","#else","pointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vSpotLight[ i ].xyz );","float lDistance = vSpotLight[ i ].w;","#endif","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","#else","spotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += diffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","#ifdef USE_SPECULARMAP","float metalness = texelSpecular.g;","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular*(1.0-metalness) ) + totalSpecular*metalness;","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );","#endif","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","#endif"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, opacity );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, N_BONE_PIXEL_X );","float y = floor( j / N_BONE_PIXEL_X );","const float dx = 1.0 / N_BONE_PIXEL_X;","const float dy = 1.0 / N_BONE_PIXEL_Y;","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","#if defined( VERTEX_TEXTURES ) && ( defined( USE_DISPLACEMENTMAP ) || defined( USE_WAVE_TEXTURE ) )","mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","#else","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix \t+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","#ifdef USE_SHADOWMAP","  normal_untransformed = normalize(mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal);","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform vec3 shadowBias[ MAX_SHADOWS ];","uniform vec3 shadowPara[ MAX_SHADOWS ];","varying vec3 normal_untransformed;","varying vec4 vShadowCoord[ MAX_SHADOWS ];","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","float parent_light_id = 0.0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","vec3 SP;","#pragma unroll_loop\n","for( int i = 0; i < MAX_SHADOWS; i ++ ) {//LOOP_START","SP = shadowPara[i];","#ifdef SHADOWMAP_CASCADE","if (parent_light_id != SP.y) {","parent_light_id = SP.y;","inFrustumCount = 0;","}","#endif","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest ) {","#ifdef PHONG","shadowCoord.z += shadowBias[ i ].x * clamp(pow(abs(tan(acos(clamp(dot(directionalLightDirection[ int(SP.y) ], normal_untransformed), -1., 1.)))), 2.0), shadowBias[ i ].y, shadowBias[ i ].z);","float shadowDarkness_scale = (1.0-emissive.r) * opacity;","#else","shadowCoord.z += shadowBias[ i ].x;","float shadowDarkness_scale = 1.0;","#endif","#if defined( SHADOWMAP_TYPE_PCF )","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] *shadowDarkness_scale * shadow ) );","#elif defined( SHADOWMAP_TYPE_PCF_SOFT )","float shadow = 0.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.0 * xPixelOffset;","float dy0 = -1.0 * yPixelOffset;","float dx1 = 1.0 * xPixelOffset;","float dy1 = 1.0 * yPixelOffset;","mat3 shadowKernel;","mat3 depthKernel;","depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","vec3 shadowZ = vec3( shadowCoord.z );","shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));","shadowKernel[0] *= vec3(0.25);","shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));","shadowKernel[1] *= vec3(0.25);","shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));","shadowKernel[2] *= vec3(0.25);","vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );","shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );","shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );","vec4 shadowValues;","shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );","shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );","shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );","shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );","shadow = dot( shadowValues, vec4( 1.0 ) );","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ]*shadowDarkness_scale * shadow ) );","#ifndef SHADOWMAP_CASCADE","float shadow_opacity = 1. - min(pow(length((shadowCoord.xy-0.5)*2.),4.), 1.);","shadowColor = mix(vec3(1.), shadowColor, shadow_opacity);","#endif","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ]*shadowDarkness_scale );","#endif","}//LOOP_END","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","#ifdef SHADOWMAP_ALPHA","gl_FragColor.a *= 1.0 - shadowColor.r;","#else","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec3 normal_untransformed;","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n")};THREE.UniformsUtils={merge:function(e){var t,i,r,n={};for(t=0;t<e.length;t++){r=this.clone(e[t]);for(i in r){n[i]=r[i]}}return n},clone:function(e){var t,i,r,n,a={};for(t in e){a[t]={};for(i in e[t]){n=e[t][i];if(n instanceof THREE.Color||n instanceof THREE.Vector2||n instanceof THREE.Vector3||n instanceof THREE.Vector4||n instanceof THREE.Matrix4||n instanceof THREE.Texture){a[t][i]=n.clone()}else if(n instanceof Array){a[t][i]=n.slice()}else{a[t][i]=n}}}return a}};THREE.ShaderChunk["common"]="#define PI 3.14159265359\n#define PI2 6.28318530718\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\n\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\n\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\n\n\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n}\n\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\n\treturn - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n";THREE.ShaderChunk["packing"]="vec3 packNormalToRGB( const in vec3 normal ) {\n  return normalize( normal ) * 0.5 + 0.5;\n}\n\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n  return 1.0 - 2.0 * rgb.xyz;\n}\n\n\nvec4 packDepthToRGBA( const in float value ) {\n\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\n\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n\tvec4 res = mod( value * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\n\tres -= res.xxyz * bit_mask;\n\treturn res;\n}\nfloat unpackRGBAToDepth( const in vec4 rgba ) {\n\tconst vec4 bitSh = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\treturn dot( rgba, bitSh );\n}\n\n// NOTE: viewZ/eyeZ is < 0 when in front of the camera per OpenGL conventions\n\nfloat viewZToOrthoDepth( const in float viewZ, const in float near, const in float far ) {\n  return ( viewZ + near ) / ( near - far );\n}\nfloat OrthoDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n  return linearClipZ * ( near - far ) - near;\n}\n\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n  return (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n  return ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n";THREE.ShaderChunk["AT_depth_render_mode_pars_fragment"]="uniform int depth_render_mode;\n"+THREE.ShaderChunk["packing"];THREE.ShaderChunk["AT_depth_render_mode_fragment"]="if (depth_render_mode > 0) {\n"+"#ifdef MMD\n#ifdef USE_MAP\n"+"if (mmdEdgeThick <= 0.25) {\n"+"  if (texture2D( map, vUv ).a == 0.0) { discard; }\n"+"}\n"+"#endif\n#endif\n"+"#ifndef SKIP_SAO_DEPTH\n"+" gl_FragColor = packDepthToRGBA( ((depth_render_mode == 1) ? gl_FragCoord.z : gl_FragCoord.w) ); return;\n"+"#else\n"+" gl_FragColor = packDepthToRGBA(gl_FragCoord.w); return;\n"+"#endif\n"+"}\n";THREE.UniformsLib={common:{depth_render_mode:{type:"i",value:0},diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"v3v",value:[]},shadowPara:{type:"v3v",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}},uniTexture:{uniTexture_state:{type:"i",value:0},uniTexture_map:{type:"t",value:null},uniTexture_bs:{type:"f",value:20},uniTexture_scale:{type:"f",value:1},uniTexture_null_zone:{type:"v4",value:new THREE.Vector4(0,0,0,0)},uniTexture_MatrixRain_height_limit:{type:"v2",value:new THREE.Vector2(0,0)}}};THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["fog"],THREE.UniformsLib["shadowmap"],THREE.UniformsLib["uniTexture"]]),vertexShader:[THREE.ShaderChunk["map_pars_vertex"],THREE.ShaderChunk["lightmap_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["uniTexture_pars_vertex"],"void main() {",THREE.ShaderChunk["map_vertex"],THREE.ShaderChunk["lightmap_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["skinbase_vertex"],"#ifdef USE_ENVMAP",THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],"#else","  #ifdef USE_SHADOWMAP","    normal_untransformed = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * normal;","  #endif","#endif",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["lightmap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],THREE.ShaderChunk["uniTexture_pars_fragment"],THREE.ShaderChunk["AT_depth_render_mode_pars_fragment"],"void main() {",THREE.ShaderChunk["AT_depth_render_mode_fragment"],"gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],THREE.ShaderChunk["lightmap_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["uniTexture_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["fog"],THREE.UniformsLib["lights"],THREE.UniformsLib["shadowmap"],THREE.UniformsLib["uniTexture"],{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",THREE.ShaderChunk["map_pars_vertex"],THREE.ShaderChunk["lightmap_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["lights_lambert_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["uniTexture_pars_vertex"],"void main() {",THREE.ShaderChunk["map_vertex"],THREE.ShaderChunk["lightmap_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["lights_lambert_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["lightmap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],THREE.ShaderChunk["uniTexture_pars_fragment"],THREE.ShaderChunk["AT_depth_render_mode_pars_fragment"],"void main() {",THREE.ShaderChunk["AT_depth_render_mode_fragment"],"gl_FragColor = vec4( BASE_COLOR, opacity );",THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",THREE.ShaderChunk["lightmap_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["uniTexture_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["bump"],THREE.UniformsLib["normalmap"],THREE.UniformsLib["uniTexture"],{tDisplacement:{type:"t",value:null},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDisplacementCustomUVScale:{type:"f",value:0},uDisplacementCustomUVOffset:{type:"v2",value:new THREE.Vector2(0,0)},edgeRotateDisplacementL:{type:"f",value:0},edgeRotateDisplacementR:{type:"f",value:0},edgeScaleDisplacementU:{type:"f",value:1},waveBaseSpeed:{type:"f",value:0},waveNoiseTexture:{type:"t",value:null},waveNoiseScale:{type:"f",value:.5337},waveBumpScale:{type:"f",value:5},time:{type:"f",value:0},waveDrops:{type:"v4v",value:[]},mirrorSampler:{type:"t",value:null},mirrorTextureMatrix:{type:"m4",value:new THREE.Matrix4},reflection_alpha:{type:"f",value:1}},THREE.UniformsLib["fog"],THREE.UniformsLib["lights"],THREE.UniformsLib["shadowmap"],{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",THREE.ShaderChunk["map_pars_vertex"],THREE.ShaderChunk["lightmap_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["lights_phong_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],"#if defined( VERTEX_TEXTURES ) && defined( USE_DISPLACEMENTMAP )","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","uniform float uDisplacementCustomUVScale;","uniform vec2 uDisplacementCustomUVOffset;","uniform float edgeRotateDisplacementL;","uniform float edgeRotateDisplacementR;","uniform float edgeScaleDisplacementU;","vec3 rotate_vector( vec4 quat, vec3 vec ) {","  return vec + 2.0 * cross( cross( vec, quat.xyz ) + quat.w * vec, quat.xyz );","}","#endif","#if defined( VERTEX_TEXTURES ) && defined( USE_WAVE_TEXTURE )","uniform sampler2D waveNoiseTexture;","uniform float waveBumpScale;","uniform float time;","uniform vec4 waveDrops[RIPPLE_MAX];","#endif","#ifdef USE_MIRROR_TEXTURE","uniform mat4 mirrorTextureMatrix;","varying vec4 mirrorCoord;","#endif",THREE.ShaderChunk["uniTexture_pars_vertex"],"void main() {",THREE.ShaderChunk["map_vertex"],THREE.ShaderChunk["lightmap_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],"vNormal = normalize( transformedNormal );",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],"#if defined( VERTEX_TEXTURES ) && ( defined( USE_DISPLACEMENTMAP ) || defined( USE_WAVE_TEXTURE ) )","vec3 displacedPosition;","#endif","#if defined( VERTEX_TEXTURES ) && defined( USE_DISPLACEMENTMAP )","float df = uDisplacementScale * texture2D( tDisplacement, ((uDisplacementCustomUVScale>0.0) ? uDisplacementCustomUVOffset + uv * uDisplacementCustomUVScale : vUv) ).r + uDisplacementBias;","if ((edgeScaleDisplacementU != 1.0) && (uv.y > 0.95)) {","  df *= mix(1.0, edgeScaleDisplacementU, 20.0*(uv.y-0.95));","}","float a_half = 0.0;","if (uv.x < 0.05) {","  a_half = mix(edgeRotateDisplacementL*0.5, 0.0, 20.0*uv.x);","}","else if (uv.x > 0.95) {","  a_half = mix(0.0, edgeRotateDisplacementR*0.5, 20.0*(uv.x-0.95));","}","if (a_half != 0.0) {","  vec4 quat = vec4(0.0, sin(a_half), 0.0, cos(a_half));","  displacedPosition = position + rotate_vector(quat, normalize(normal)) * df;","  vNormal = rotate_vector(quat, vNormal);","}","else {","  displacedPosition = position + normalize( normal ) * df;","}","#endif","#if defined( VERTEX_TEXTURES ) && defined( USE_WAVE_TEXTURE )","vec2 uvTimeShift = vUv + vec2( 1.1, 1.9 ) * time * 0.15;","vec4 bumpData = texture2D( waveNoiseTexture, mod(uvTimeShift,1.0) );","float displacement = (bumpData.g - 0.25) * waveBumpScale;","float drop_count = 0.0;","vec3 normal_total = vec3(0.0, 0.0, 0.0);","for (int i = 0; i < RIPPLE_MAX; i++) {","  if (waveDrops[i].z > 0.0) {","vec4 _position = modelMatrix * vec4( position, 1.0 );","float dist = distance(_position.xz, waveDrops[i].xy) / RIPPLE_RANGE;","float angle = -( ((4.0 / (1.0 + pow(2.0, dist * 50.0 - waveDrops[i].w))) * 3.14159265359)  + 1.5707963267948966192313216916398 );","float wave = (sin(angle)+1.0)*0.5;","float amp = pow(2.0, -dist * 8.0) * waveDrops[i].z;","displacement += wave * amp;","vec2 dir = normalize(_position.xz - waveDrops[i].xy) * (-amp * 256.0 * cos(angle));","drop_count += 1.0;","normal_total += vec3(dir, 1.0);","  }","}","if (drop_count > 0.0) { vNormal = normalMatrix * normalize(normal_total / drop_count); }","#ifdef USE_DISPLACEMENTMAP","  displacedPosition = displacedPosition + normal * displacement;","#else","  displacedPosition = position + normal * displacement;","#endif","#endif",THREE.ShaderChunk["default_vertex"],"vViewPosition = -mvPosition.xyz;",THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["lights_phong_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","#if defined( VERTEX_TEXTURES ) && defined( USE_WAVE_TEXTURE )","uniform float waveBaseSpeed;","uniform sampler2D waveNoiseTexture;","uniform float waveNoiseScale;","uniform float time;","#endif","#ifdef USE_MIRROR_TEXTURE","uniform sampler2D mirrorSampler;","uniform float reflection_alpha;","varying vec4 mirrorCoord;","#endif",THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["lightmap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["lights_phong_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["bumpmap_pars_fragment"],THREE.ShaderChunk["normalmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],THREE.ShaderChunk["uniTexture_pars_fragment"],THREE.ShaderChunk["AT_depth_render_mode_pars_fragment"],"void main() {",THREE.ShaderChunk["AT_depth_render_mode_fragment"],"gl_FragColor = vec4( BASE_COLOR, opacity );",THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],"#ifdef USE_MIRROR_TEXTURE","if (reflection_alpha > 0.0) {","vec4 mirror_color = texture2DProj(mirrorSampler, mirrorCoord);","gl_FragColor = vec4(mix(mirror_color.rgb, gl_FragColor.rgb, gl_FragColor.a * (1.0 - mirror_color.a*reflection_alpha)), gl_FragColor.a + ((1.0-gl_FragColor.a) * mirror_color.a*reflection_alpha));","}","#endif",THREE.ShaderChunk["lights_phong_fragment"],THREE.ShaderChunk["lightmap_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["uniTexture_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["particle"],THREE.UniformsLib["shadowmap"]]),vertexShader:["uniform float size;","uniform float scale;",THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],"void main() {",THREE.ShaderChunk["color_vertex"],"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","gl_PointSize = size;","#endif","gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_particle_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],"void main() {","gl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk["map_particle_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["fog"],{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",THREE.ShaderChunk["color_pars_vertex"],"void main() {",THREE.ShaderChunk["color_vertex"],"vLineDistance = scale * lineDistance;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["AT_depth_render_mode_pars_fragment"],"void main() {",THREE.ShaderChunk["AT_depth_render_mode_fragment"],"if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",THREE.ShaderChunk["packing"],"void main() {","gl_FragColor = packDepthToRGBA( gl_FragCoord.z );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk["morphtarget_pars_vertex"],"void main() {","vNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["default_vertex"],"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},normalmap:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["fog"],THREE.UniformsLib["lights"],THREE.UniformsLib["shadowmap"],{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new THREE.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new THREE.Color(16777215)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float uRefractionRatio;","uniform float uReflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","#else","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","#else","spotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += uDiffuseColor * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, uRefractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );","}",THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],"void main() {",THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["skinnormal_vertex"],"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;","void main() {","gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );","}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],"void main() {",THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],"}"].join("\n"),fragmentShader:[THREE.ShaderChunk["packing"],"void main() {","gl_FragColor = packDepthToRGBA( gl_FragCoord.z );","}"].join("\n")}};THREE.WebGLRenderer=function(e){e=e||{};if(e.canvas)e.canvas=document.getElementById(e.canvas);var n=e.canvas!==undefined?e.canvas:document.createElement("canvas"),w=e.precision!==undefined?e.precision:"highp",H=e.alpha!==undefined?e.alpha:true,D=e.premultipliedAlpha!==undefined?e.premultipliedAlpha:true,P=e.antialias!==undefined?e.antialias:false,L=e.stencil!==undefined?e.stencil:true,U=e.preserveDrawingBuffer!==undefined?e.preserveDrawingBuffer:false,i=new THREE.Color(e.clearColor||0),r=e.clearAlpha||0;this.domElement=n;this.context=null;this.devicePixelRatio=e.devicePixelRatio!==undefined?e.devicePixelRatio:window.devicePixelRatio!==undefined?window.devicePixelRatio:1;this.autoClear=true;this.autoClearColor=true;this.autoClearDepth=true;this.autoClearStencil=true;this.sortObjects=true;this.autoUpdateObjects=true;this.gammaInput=false;this.gammaOutput=false;this.physicallyBasedShading=false;this.shadowMapEnabled=false;this.shadowMapAutoUpdate=true;this.shadowMapType=THREE.PCFShadowMap;this.shadowMapCullFace=THREE.CullFaceFront;this.shadowMapDebug=false;this.shadowMapCascade=false;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=true;this.renderPluginsPre=[];this.renderPluginsPost=[];this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var j=this,M=[],N=0,f=null,F=null,R=-1,S=null,c=null,O=0,z=0,a=-1,o=-1,s=-1,I=-1,V=-1,k=-1,l=-1,h=-1,B=null,Y=null,$=null,K=null,p=0,m=0,E=0,g=0,Q=0,Z=0,t={},J=new THREE.Frustum,A=new THREE.Matrix4,ee=new THREE.Matrix4,G=new THREE.Vector3,W=new THREE.Vector3,T=true,te={ambient:[0,0,0],directional:{length:0,colors:new Array,positions:new Array},point:{length:0,colors:new Array,positions:new Array,distances:new Array},spot:{length:0,colors:new Array,positions:new Array,distances:new Array,directions:new Array,anglesCos:new Array,exponents:new Array},hemi:{length:0,skyColors:new Array,groundColors:new Array,positions:new Array}};var st;var lt;var ie;var u;var re;var d;var v;Ei();gi();this.context=st;var ne=st.getParameter(st.MAX_TEXTURE_IMAGE_UNITS);var ae=st.getParameter(st.MAX_VERTEX_TEXTURE_IMAGE_UNITS);var oe=st.getParameter(st.MAX_TEXTURE_SIZE);var se=st.getParameter(st.MAX_CUBE_MAP_TEXTURE_SIZE);var le=d?st.getParameter(d.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0;var he=ae>0;var fe=he&&u;var ce=v?st.getParameter(st.COMPRESSED_TEXTURE_FORMATS):[];var ue=st.getShaderPrecisionFormat(st.VERTEX_SHADER,st.HIGH_FLOAT);var de=st.getShaderPrecisionFormat(st.VERTEX_SHADER,st.MEDIUM_FLOAT);var pe=st.getShaderPrecisionFormat(st.VERTEX_SHADER,st.LOW_FLOAT);var me=st.getShaderPrecisionFormat(st.FRAGMENT_SHADER,st.HIGH_FLOAT);var Ee=st.getShaderPrecisionFormat(st.FRAGMENT_SHADER,st.MEDIUM_FLOAT);var ge=st.getShaderPrecisionFormat(st.FRAGMENT_SHADER,st.LOW_FLOAT);var ve=st.getShaderPrecisionFormat(st.VERTEX_SHADER,st.HIGH_INT);var Te=st.getShaderPrecisionFormat(st.VERTEX_SHADER,st.MEDIUM_INT);var ye=st.getShaderPrecisionFormat(st.VERTEX_SHADER,st.LOW_INT);var _e=st.getShaderPrecisionFormat(st.FRAGMENT_SHADER,st.HIGH_INT);var Re=st.getShaderPrecisionFormat(st.FRAGMENT_SHADER,st.MEDIUM_INT);var xe=st.getShaderPrecisionFormat(st.FRAGMENT_SHADER,st.LOW_INT);var be=ue.precision>0&&me.precision>0;var He=de.precision>0&&Ee.precision>0;if(w==="highp"&&!be){if(He){w="mediump"}else{w="lowp"}}if(w==="mediump"&&!He){w="lowp"}this.getContext=function(){return st};this.supportsVertexTextures=function(){return he};this.supportsFloatTextures=function(){return u};this.supportsStandardDerivatives=function(){return re};this.supportsCompressedTextureS3TC=function(){return v};this.getMaxAnisotropy=function(){return le};this.getPrecision=function(){return w};this.setSize=function(e,t,i){n.width=e*this.devicePixelRatio;n.height=t*this.devicePixelRatio;if(this.devicePixelRatio!==1&&i!==false){n.style.width=e+"px";n.style.height=t+"px"}this.setViewport(0,0,n.width,n.height)};this.setViewport=function(e,t,i,r){p=e!==undefined?e:0;m=t!==undefined?t:0;E=i!==undefined?i:n.width;g=r!==undefined?r:n.height;st.viewport(p,m,E,g)};this.getViewportX=function(){return p};this.getViewportY=function(){return m};this.getViewportWidth=function(){return E};this.getViewportHeight=function(){return g};this.setScissor=function(e,t,i,r){st.scissor(e,t,i,r)};this.enableScissorTest=function(e){e?st.enable(st.SCISSOR_TEST):st.disable(st.SCISSOR_TEST)};this.setClearColor=function(e,t){i.set(e);r=t!==undefined?t:1;st.clearColor(i.r,i.g,i.b,r)};this.getClearColor=function(){return i};this.getClearAlpha=function(){return r};this.clear=function(e,t,i){var r=0;if(e===undefined||e)r|=st.COLOR_BUFFER_BIT;if(t===undefined||t)r|=st.DEPTH_BUFFER_BIT;if(i===undefined||i)r|=st.STENCIL_BUFFER_BIT;st.clear(r)};this.clearColor=function(){st.clear(st.COLOR_BUFFER_BIT)};this.clearTarget=function(e,t,i,r){this.setRenderTarget(e);this.clear(t,i,r)};this.addPostPlugin=function(e){e.init(this);this.renderPluginsPost.push(e)};this.addPrePlugin=function(e){e.init(this);this.renderPluginsPre.push(e)};this.updateShadowMap=function(e,t){f=null;s=-1;l=-1;h=-1;S=-1;R=-1;T=true;a=-1;o=-1;this.shadowMapPlugin.update(e,t)};function we(e){e.__webglVertexBuffer=st.createBuffer();e.__webglColorBuffer=st.createBuffer();j.info.memory.geometries++}function Me(e){e.__webglVertexBuffer=st.createBuffer();e.__webglColorBuffer=st.createBuffer();e.__webglLineDistanceBuffer=st.createBuffer();j.info.memory.geometries++}function Se(e){e.__webglVertexBuffer=st.createBuffer();e.__webglColorBuffer=st.createBuffer();e.__webglNormalBuffer=st.createBuffer();j.info.memory.geometries++}function Ae(e){e.__webglVertexBuffer=st.createBuffer();e.__webglNormalBuffer=st.createBuffer();e.__webglTangentBuffer=st.createBuffer();e.__webglColorBuffer=st.createBuffer();e.__webglUVBuffer=st.createBuffer();e.__webglUV2Buffer=st.createBuffer();e.__webglSkinIndicesBuffer=st.createBuffer();e.__webglSkinWeightsBuffer=st.createBuffer();e.__webglFaceBuffer=st.createBuffer();e.__webglLineBuffer=st.createBuffer();var t,i;if(e.numMorphTargets){e.__webglMorphTargetsBuffers=[];for(t=0,i=e.numMorphTargets;t<i;t++){e.__webglMorphTargetsBuffers.push(st.createBuffer())}}if(e.numMorphNormals){e.__webglMorphNormalsBuffers=[];for(t=0,i=e.numMorphNormals;t<i;t++){e.__webglMorphNormalsBuffers.push(st.createBuffer())}}j.info.memory.geometries++}var Ce=function(e){var t=e.target;t.removeEventListener("dispose",Ce);Ue(t);j.info.memory.geometries--};var De=function(e){var t=e.target;t.removeEventListener("dispose",De);Ne(t);j.info.memory.textures--};var Pe=function(e){var t=e.target;t.removeEventListener("dispose",Pe);Fe(t);j.info.memory.textures--};var Le=function(e){var t=e.target;t.removeEventListener("dispose",Le);Oe(t)};var Ue=function(e){e.__webglInit=undefined;if(e.__webglVertexBuffer!==undefined)st.deleteBuffer(e.__webglVertexBuffer);if(e.__webglNormalBuffer!==undefined)st.deleteBuffer(e.__webglNormalBuffer);if(e.__webglTangentBuffer!==undefined)st.deleteBuffer(e.__webglTangentBuffer);if(e.__webglColorBuffer!==undefined)st.deleteBuffer(e.__webglColorBuffer);if(e.__webglUVBuffer!==undefined)st.deleteBuffer(e.__webglUVBuffer);if(e.__webglUV2Buffer!==undefined)st.deleteBuffer(e.__webglUV2Buffer);if(e.__webglSkinIndicesBuffer!==undefined)st.deleteBuffer(e.__webglSkinIndicesBuffer);if(e.__webglSkinWeightsBuffer!==undefined)st.deleteBuffer(e.__webglSkinWeightsBuffer);if(e.__webglFaceBuffer!==undefined)st.deleteBuffer(e.__webglFaceBuffer);if(e.__webglLineBuffer!==undefined)st.deleteBuffer(e.__webglLineBuffer);if(e.__webglLineDistanceBuffer!==undefined)st.deleteBuffer(e.__webglLineDistanceBuffer);if(e.geometryGroups!==undefined){for(var t in e.geometryGroups){var i=e.geometryGroups[t];if(i.numMorphTargets!==undefined){for(var r=0,n=i.numMorphTargets;r<n;r++){st.deleteBuffer(i.__webglMorphTargetsBuffers[r])}}if(i.numMorphNormals!==undefined){for(var r=0,n=i.numMorphNormals;r<n;r++){st.deleteBuffer(i.__webglMorphNormalsBuffers[r])}}ze(i)}}ze(e)};var Ne=function(e){if(e.image&&e.image.__webglTextureCube){st.deleteTexture(e.image.__webglTextureCube)}else{if(!e.__webglInit)return;e.__webglInit=false;st.deleteTexture(e.__webglTexture)}};var Fe=function(e){if(!e||!e.__webglTexture)return;st.deleteTexture(e.__webglTexture);if(e instanceof THREE.WebGLRenderTargetCube){for(var t=0;t<6;t++){st.deleteFramebuffer(e.__webglFramebuffer[t]);st.deleteRenderbuffer(e.__webglRenderbuffer[t])}}else{st.deleteFramebuffer(e.__webglFramebuffer);if(e.__webglRenderbuffer)st.deleteRenderbuffer(e.__webglRenderbuffer);if(e.__webglMSAAFramebuffer){st.deleteFramebuffer(e.__webglMSAAFramebuffer)}if(e.__webglMSAAColorbuffer){st.deleteRenderbuffer(e.__webglMSAAColorbuffer)}if(e.__webglMSAADepthbuffer){st.deleteRenderbuffer(e.__webglMSAADepthbuffer)}}};var Oe=function(e){var t=e.program;if(t===undefined)return;e.program=undefined;var i,r,n;var a=false;for(i=0,r=M.length;i<r;i++){n=M[i];if(n.program===t){n.usedTimes--;if(n.usedTimes===0){a=true}break}}if(a===true){var o=[];for(i=0,r=M.length;i<r;i++){n=M[i];if(n.program!==t){o.push(n)}}M=o;st.deleteProgram(t);j.info.memory.programs--}};function ze(e){if(e.__webglCustomAttributesList){for(var t in e.__webglCustomAttributesList){st.deleteBuffer(e.__webglCustomAttributesList[t].buffer)}}}function Ie(e,t){var i=e.vertices.length;var r=t.material;if(r.attributes){if(e.__webglCustomAttributesList===undefined){e.__webglCustomAttributesList=[]}for(var n in r.attributes){var a=r.attributes[n];if(!a.__webglInitialized||a.createUniqueBuffers){a.__webglInitialized=true;var o=1;if(a.type==="v2")o=2;else if(a.type==="v3")o=3;else if(a.type==="v4")o=4;else if(a.type==="c")o=3;a.size=o;a.array=new Float32Array(i*o);a.buffer=st.createBuffer();a.buffer.belongsToAttribute=n;a.needsUpdate=true}e.__webglCustomAttributesList.push(a)}}}function Ve(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(i*3);e.__colorArray=new Float32Array(i*3);e.__sortArray=[];e.__webglParticleCount=i;Ie(e,t)}function ke(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(i*3);e.__colorArray=new Float32Array(i*3);e.__lineDistanceArray=new Float32Array(i*1);e.__webglLineCount=i;Ie(e,t)}function Be(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(i*3);e.__colorArray=new Float32Array(i*3);e.__normalArray=new Float32Array(i*3);e.__webglVertexCount=i;Ie(e,t)}function je(e,t){var i=t.geometry,r=e.faces3,n=e.faces4,a=r.length*3+n.length*4,o=r.length*1+n.length*2,s=r.length*3+n.length*4,l=y(t,e),h=ct(l),f=ht(l),c=ft(l);e.__vertexArray=new Float32Array(a*3);if(f){e.__normalArray=new Float32Array(a*3)}if(i.hasTangents){e.__tangentArray=new Float32Array(a*4)}if(c){e.__colorArray=new Float32Array(a*3)}if(h){if(i.faceUvs.length>0||i.faceVertexUvs.length>0){e.__uvArray=new Float32Array(a*2)}if(i.faceUvs.length>1||i.faceVertexUvs.length>1){e.__uv2Array=new Float32Array(a*2)}}if(t.geometry.skinWeights.length&&t.geometry.skinIndices.length){e.__skinIndexArray=new Float32Array(a*4);e.__skinWeightArray=new Float32Array(a*4)}e.__faceArray=new Uint16Array(o*3);e.__lineArray=new Uint16Array(s*2);var u,d;if(e.numMorphTargets){e.__morphTargetsArrays=[];for(u=0,d=e.numMorphTargets;u<d;u++){e.__morphTargetsArrays.push(new Float32Array(a*3))}}if(e.numMorphNormals){e.__morphNormalsArrays=[];for(u=0,d=e.numMorphNormals;u<d;u++){e.__morphNormalsArrays.push(new Float32Array(a*3))}}e.__webglFaceCount=o*3;e.__webglLineCount=s*2;if(l.attributes){if(e.__webglCustomAttributesList===undefined){e.__webglCustomAttributesList=[]}for(var p in l.attributes){var m=l.attributes[p];var E={};for(var g in m){E[g]=m[g]}if(!E.__webglInitialized||E.createUniqueBuffers){E.__webglInitialized=true;var v=1;if(E.type==="v2")v=2;else if(E.type==="v3")v=3;else if(E.type==="v4")v=4;else if(E.type==="c")v=3;E.size=v;E.array=new Float32Array(a*v);E.buffer=st.createBuffer();E.buffer.belongsToAttribute=p;m.needsUpdate=true;E.__original=m}e.__webglCustomAttributesList.push(E)}}e.__inittedArrays=true}function y(e,t){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function Ge(e){return e&&e.shading!==undefined&&e.shading===THREE.SmoothShading}function ht(e){if(e instanceof THREE.MeshBasicMaterial&&!e.envMap||e instanceof THREE.MeshDepthMaterial){return false}if(Ge(e)){return THREE.SmoothShading}else{return THREE.FlatShading}}function ft(e){if(e.vertexColors){return e.vertexColors}return false}function ct(e){if(e.map||e.lightMap||e.bumpMap||e.displacementMap||e.waveNoiseTexture||e.normalMap||e.specularMap||e instanceof THREE.ShaderMaterial){return true}return false}function We(e){var t,i,r;for(t in e.attributes){if(t==="index"){r=st.ELEMENT_ARRAY_BUFFER}else{r=st.ARRAY_BUFFER}i=e.attributes[t];i.buffer=st.createBuffer();st.bindBuffer(r,i.buffer);st.bufferData(r,i.array,st.STATIC_DRAW)}}function Xe(e,t,i){var r,n,a,o,s,l,h=e.vertices,f=h.length,c=e.colors,u=c.length,d=e.__vertexArray,p=e.__colorArray,m=e.__sortArray,E=e.verticesNeedUpdate,g=e.elementsNeedUpdate,v=e.colorsNeedUpdate,T=e.__webglCustomAttributesList,y,_,R,x,b,H,w;if(i.sortParticles){ee.copy(A);ee.multiply(i.matrixWorld);for(r=0;r<f;r++){a=h[r];G.copy(a);G.applyProjection(ee);m[r]=[G.z,r]}m.sort(ut);for(r=0;r<f;r++){a=h[m[r][1]];o=r*3;d[o]=a.x;d[o+1]=a.y;d[o+2]=a.z}for(n=0;n<u;n++){o=n*3;l=c[m[n][1]];p[o]=l.r;p[o+1]=l.g;p[o+2]=l.b}if(T){for(y=0,_=T.length;y<_;y++){w=T[y];if(!(w.boundTo===undefined||w.boundTo==="vertices"))continue;o=0;b=w.value.length;if(w.size===1){for(x=0;x<b;x++){s=m[x][1];w.array[x]=w.value[s]}}else if(w.size===2){for(x=0;x<b;x++){s=m[x][1];H=w.value[s];w.array[o]=H.x;w.array[o+1]=H.y;o+=2}}else if(w.size===3){if(w.type==="c"){for(x=0;x<b;x++){s=m[x][1];H=w.value[s];w.array[o]=H.r;w.array[o+1]=H.g;w.array[o+2]=H.b;o+=3}}else{for(x=0;x<b;x++){s=m[x][1];H=w.value[s];w.array[o]=H.x;w.array[o+1]=H.y;w.array[o+2]=H.z;o+=3}}}else if(w.size===4){for(x=0;x<b;x++){s=m[x][1];H=w.value[s];w.array[o]=H.x;w.array[o+1]=H.y;w.array[o+2]=H.z;w.array[o+3]=H.w;o+=4}}}}}else{if(E){for(r=0;r<f;r++){a=h[r];o=r*3;d[o]=a.x;d[o+1]=a.y;d[o+2]=a.z}}if(v){for(n=0;n<u;n++){l=c[n];o=n*3;p[o]=l.r;p[o+1]=l.g;p[o+2]=l.b}}if(T){for(y=0,_=T.length;y<_;y++){w=T[y];if(w.needsUpdate&&(w.boundTo===undefined||w.boundTo==="vertices")){b=w.value.length;o=0;if(w.size===1){for(x=0;x<b;x++){w.array[x]=w.value[x]}}else if(w.size===2){for(x=0;x<b;x++){H=w.value[x];w.array[o]=H.x;w.array[o+1]=H.y;o+=2}}else if(w.size===3){if(w.type==="c"){for(x=0;x<b;x++){H=w.value[x];w.array[o]=H.r;w.array[o+1]=H.g;w.array[o+2]=H.b;o+=3}}else{for(x=0;x<b;x++){H=w.value[x];w.array[o]=H.x;w.array[o+1]=H.y;w.array[o+2]=H.z;o+=3}}}else if(w.size===4){for(x=0;x<b;x++){H=w.value[x];w.array[o]=H.x;w.array[o+1]=H.y;w.array[o+2]=H.z;w.array[o+3]=H.w;o+=4}}}}}}if(E||i.sortParticles){st.bindBuffer(st.ARRAY_BUFFER,e.__webglVertexBuffer);st.bufferData(st.ARRAY_BUFFER,d,t)}if(v||i.sortParticles){st.bindBuffer(st.ARRAY_BUFFER,e.__webglColorBuffer);st.bufferData(st.ARRAY_BUFFER,p,t)}if(T){for(y=0,_=T.length;y<_;y++){w=T[y];if(w.needsUpdate||i.sortParticles){st.bindBuffer(st.ARRAY_BUFFER,w.buffer);st.bufferData(st.ARRAY_BUFFER,w.array,t)}}}}function qe(e,t){var i,r,n,a,o,s,l=e.vertices,h=e.colors,f=e.lineDistances,c=l.length,u=h.length,d=f.length,p=e.__vertexArray,m=e.__colorArray,E=e.__lineDistanceArray,g=e.verticesNeedUpdate,v=e.colorsNeedUpdate,T=e.lineDistancesNeedUpdate,y=e.__webglCustomAttributesList,_,R,x,b,H,w,M;if(g){for(i=0;i<c;i++){a=l[i];o=i*3;p[o]=a.x;p[o+1]=a.y;p[o+2]=a.z}st.bindBuffer(st.ARRAY_BUFFER,e.__webglVertexBuffer);st.bufferData(st.ARRAY_BUFFER,p,t)}if(v){for(r=0;r<u;r++){s=h[r];o=r*3;m[o]=s.r;m[o+1]=s.g;m[o+2]=s.b}st.bindBuffer(st.ARRAY_BUFFER,e.__webglColorBuffer);st.bufferData(st.ARRAY_BUFFER,m,t)}if(T){for(n=0;n<d;n++){E[n]=f[n]}st.bindBuffer(st.ARRAY_BUFFER,e.__webglLineDistanceBuffer);st.bufferData(st.ARRAY_BUFFER,E,t)}if(y){for(_=0,R=y.length;_<R;_++){M=y[_];if(M.needsUpdate&&(M.boundTo===undefined||M.boundTo==="vertices")){o=0;H=M.value.length;if(M.size===1){for(b=0;b<H;b++){M.array[b]=M.value[b]}}else if(M.size===2){for(b=0;b<H;b++){w=M.value[b];M.array[o]=w.x;M.array[o+1]=w.y;o+=2}}else if(M.size===3){if(M.type==="c"){for(b=0;b<H;b++){w=M.value[b];M.array[o]=w.r;M.array[o+1]=w.g;M.array[o+2]=w.b;o+=3}}else{for(b=0;b<H;b++){w=M.value[b];M.array[o]=w.x;M.array[o+1]=w.y;M.array[o+2]=w.z;o+=3}}}else if(M.size===4){for(b=0;b<H;b++){w=M.value[b];M.array[o]=w.x;M.array[o+1]=w.y;M.array[o+2]=w.z;M.array[o+3]=w.w;o+=4}}st.bindBuffer(st.ARRAY_BUFFER,M.buffer);st.bufferData(st.ARRAY_BUFFER,M.array,t)}}}}function Ye(e,t){var i,r,n,a,o,s,l,h,f,c,u,d,p,m=e.vertices,E=e.colors,g=e.normals,v=m.length,T=E.length,y=g.length,_=e.__vertexArray,R=e.__colorArray,x=e.__normalArray,b=e.verticesNeedUpdate,H=e.colorsNeedUpdate,w=e.normalsNeedUpdate,M=e.__webglCustomAttributesList;if(b){for(i=0;i<v;i++){a=m[i];o=i*3;_[o]=a.x;_[o+1]=a.y;_[o+2]=a.z}st.bindBuffer(st.ARRAY_BUFFER,e.__webglVertexBuffer);st.bufferData(st.ARRAY_BUFFER,_,t)}if(H){for(r=0;r<T;r++){s=E[r];o=r*3;R[o]=s.r;R[o+1]=s.g;R[o+2]=s.b}st.bindBuffer(st.ARRAY_BUFFER,e.__webglColorBuffer);st.bufferData(st.ARRAY_BUFFER,R,t)}if(w){for(n=0;n<y;n++){l=g[n];o=n*3;x[o]=l.x;x[o+1]=l.y;x[o+2]=l.z}st.bindBuffer(st.ARRAY_BUFFER,e.__webglNormalBuffer);st.bufferData(st.ARRAY_BUFFER,x,t)}if(M){for(h=0,f=M.length;h<f;h++){d=M[h];if(d.needsUpdate&&(d.boundTo===undefined||d.boundTo==="vertices")){o=0;u=d.value.length;if(d.size===1){for(c=0;c<u;c++){d.array[c]=d.value[c]}}else if(d.size===2){for(c=0;c<u;c++){p=d.value[c];d.array[o]=p.x;d.array[o+1]=p.y;o+=2}}else if(d.size===3){if(d.type==="c"){for(c=0;c<u;c++){p=d.value[c];d.array[o]=p.r;d.array[o+1]=p.g;d.array[o+2]=p.b;o+=3}}else{for(c=0;c<u;c++){p=d.value[c];d.array[o]=p.x;d.array[o+1]=p.y;d.array[o+2]=p.z;o+=3}}}else if(d.size===4){for(c=0;c<u;c++){p=d.value[c];d.array[o]=p.x;d.array[o+1]=p.y;d.array[o+2]=p.z;d.array[o+3]=p.w;o+=4}}st.bindBuffer(st.ARRAY_BUFFER,d.buffer);st.bufferData(st.ARRAY_BUFFER,d.array,t)}}}}function $e(t,F,e,O,z){if(!t.__inittedArrays){return}var I=ht(z),V=ft(z),k=ct(z),B=I===THREE.SmoothShading;var i,n,j,a,G,W,X,q,Y,$,K,Q,o,s,l,h,Z,J,ee,te,f,ie,re,ne,ae,oe,se,le,he,fe,ce,ue,de,pe,me,Ee,ge,ve,Te,ye,_e,Re,xe,be,He,we,r,Me,Se,Ae,Ce,c,De,u,d,Pe,Le,Ue,p=0,m=0,Ne=0,Fe=0,Oe=0,E=0,g=0,v=0,T=0,y=0,_=0,R=0,ze=0,x,b=t.__vertexArray,Ie=t.__uvArray,Ve=t.__uv2Array,ke=t.__normalArray,H=t.__tangentArray,w=t.__colorArray,M=t.__skinIndexArray,S=t.__skinWeightArray,Be=t.__morphTargetsArrays,je=t.__morphNormalsArrays,Ge=t.__webglCustomAttributesList,A,We=t.__faceArray,C=t.__lineArray,D=F.geometry,Xe=D.verticesNeedUpdate,qe=D.elementsNeedUpdate,Ye=D.uvsNeedUpdate,$e=D.normalsNeedUpdate,Ke=D.tangentsNeedUpdate,Qe=D.colorsNeedUpdate,Ze=D.morphTargetsNeedUpdate,Je=D.vertices,P=t.faces3,L=t.faces4,U=D.faces,et=D.faceVertexUvs[0],tt=D.faceVertexUvs[1],it=D.colors,rt=D.skinIndices,nt=D.skinWeights,at=D.morphTargets,ot=D.morphNormals;if(lt){if(t._vao){for(let e in t._vao)st.deleteVertexArray(t._vao[e].vao)}t._vao={}}if(Xe){for(i=0,n=P.length;i<n;i++){a=U[P[i]];o=Je[a.a];s=Je[a.b];l=Je[a.c];b[m]=o.x;b[m+1]=o.y;b[m+2]=o.z;b[m+3]=s.x;b[m+4]=s.y;b[m+5]=s.z;b[m+6]=l.x;b[m+7]=l.y;b[m+8]=l.z;m+=9}for(i=0,n=L.length;i<n;i++){a=U[L[i]];o=Je[a.a];s=Je[a.b];l=Je[a.c];h=Je[a.d];b[m]=o.x;b[m+1]=o.y;b[m+2]=o.z;b[m+3]=s.x;b[m+4]=s.y;b[m+5]=s.z;b[m+6]=l.x;b[m+7]=l.y;b[m+8]=l.z;b[m+9]=h.x;b[m+10]=h.y;b[m+11]=h.z;m+=12}st.bindBuffer(st.ARRAY_BUFFER,t.__webglVertexBuffer);st.bufferData(st.ARRAY_BUFFER,b,e)}if(Ze){z.morphTargets_dependency={};for(c=0,De=at.length;c<De;c++){_=0;let r=false;for(i=0,n=P.length;i<n;i++){Pe=P[i];a=U[Pe];o=at[c].vertices[a.a];s=at[c].vertices[a.b];l=at[c].vertices[a.c];u=Be[c];if(!u){continue}u[_]=o.x;u[_+1]=o.y;u[_+2]=o.z;u[_+3]=s.x;u[_+4]=s.y;u[_+5]=s.z;u[_+6]=l.x;u[_+7]=l.y;u[_+8]=l.z;if(!r){let e=Je[a.a];let t=Je[a.b];let i=Je[a.c];if(o.x!=e.x||o.y!=e.y||o.z!=e.z||s.x!=t.x||s.y!=t.y||s.z!=t.z||l.x!=i.x||l.y!=i.y||l.z!=i.z)r=true}if(z.morphNormals){if(B){Le=ot[c].vertexNormals[Pe];f=Le.a;ie=Le.b;re=Le.c}else{f=ot[c].faceNormals[Pe];ie=f;re=f}d=je[c];d[_]=f.x;d[_+1]=f.y;d[_+2]=f.z;d[_+3]=ie.x;d[_+4]=ie.y;d[_+5]=ie.z;d[_+6]=re.x;d[_+7]=re.y;d[_+8]=re.z}_+=9}for(i=0,n=L.length;i<n;i++){Pe=L[i];a=U[Pe];o=at[c].vertices[a.a];s=at[c].vertices[a.b];l=at[c].vertices[a.c];h=at[c].vertices[a.d];u=Be[c];u[_]=o.x;u[_+1]=o.y;u[_+2]=o.z;u[_+3]=s.x;u[_+4]=s.y;u[_+5]=s.z;u[_+6]=l.x;u[_+7]=l.y;u[_+8]=l.z;u[_+9]=h.x;u[_+10]=h.y;u[_+11]=h.z;if(z.morphNormals){if(B){Le=ot[c].vertexNormals[Pe];f=Le.a;ie=Le.b;re=Le.c;ne=Le.d}else{f=ot[c].faceNormals[Pe];ie=f;re=f;ne=f}d=je[c];d[_]=f.x;d[_+1]=f.y;d[_+2]=f.z;d[_+3]=ie.x;d[_+4]=ie.y;d[_+5]=ie.z;d[_+6]=re.x;d[_+7]=re.y;d[_+8]=re.z;d[_+9]=ne.x;d[_+10]=ne.y;d[_+11]=ne.z}_+=12}if(r)z.morphTargets_dependency[c]=true;st.bindBuffer(st.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[c]);st.bufferData(st.ARRAY_BUFFER,Be[c],e);if(z.morphNormals){st.bindBuffer(st.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[c]);st.bufferData(st.ARRAY_BUFFER,je[c],e)}}}if(nt.length){for(i=0,n=P.length;i<n;i++){a=U[P[i]];he=nt[a.a];fe=nt[a.b];ce=nt[a.c];S[y]=he.x;S[y+1]=he.y;S[y+2]=he.z;S[y+3]=he.w;S[y+4]=fe.x;S[y+5]=fe.y;S[y+6]=fe.z;S[y+7]=fe.w;S[y+8]=ce.x;S[y+9]=ce.y;S[y+10]=ce.z;S[y+11]=ce.w;de=rt[a.a];pe=rt[a.b];me=rt[a.c];M[y]=de.x;M[y+1]=de.y;M[y+2]=de.z;M[y+3]=de.w;M[y+4]=pe.x;M[y+5]=pe.y;M[y+6]=pe.z;M[y+7]=pe.w;M[y+8]=me.x;M[y+9]=me.y;M[y+10]=me.z;M[y+11]=me.w;y+=12}for(i=0,n=L.length;i<n;i++){a=U[L[i]];he=nt[a.a];fe=nt[a.b];ce=nt[a.c];ue=nt[a.d];S[y]=he.x;S[y+1]=he.y;S[y+2]=he.z;S[y+3]=he.w;S[y+4]=fe.x;S[y+5]=fe.y;S[y+6]=fe.z;S[y+7]=fe.w;S[y+8]=ce.x;S[y+9]=ce.y;S[y+10]=ce.z;S[y+11]=ce.w;S[y+12]=ue.x;S[y+13]=ue.y;S[y+14]=ue.z;S[y+15]=ue.w;de=rt[a.a];pe=rt[a.b];me=rt[a.c];Ee=rt[a.d];M[y]=de.x;M[y+1]=de.y;M[y+2]=de.z;M[y+3]=de.w;M[y+4]=pe.x;M[y+5]=pe.y;M[y+6]=pe.z;M[y+7]=pe.w;M[y+8]=me.x;M[y+9]=me.y;M[y+10]=me.z;M[y+11]=me.w;M[y+12]=Ee.x;M[y+13]=Ee.y;M[y+14]=Ee.z;M[y+15]=Ee.w;y+=16}if(y>0){st.bindBuffer(st.ARRAY_BUFFER,t.__webglSkinIndicesBuffer);st.bufferData(st.ARRAY_BUFFER,M,e);st.bindBuffer(st.ARRAY_BUFFER,t.__webglSkinWeightsBuffer);st.bufferData(st.ARRAY_BUFFER,S,e)}}if(Qe&&V){for(i=0,n=P.length;i<n;i++){a=U[P[i]];q=a.vertexColors;Y=a.color;if(q.length===3&&V===THREE.VertexColors){ae=q[0];oe=q[1];se=q[2]}else{ae=Y;oe=Y;se=Y}w[T]=ae.r;w[T+1]=ae.g;w[T+2]=ae.b;w[T+3]=oe.r;w[T+4]=oe.g;w[T+5]=oe.b;w[T+6]=se.r;w[T+7]=se.g;w[T+8]=se.b;T+=9}for(i=0,n=L.length;i<n;i++){a=U[L[i]];q=a.vertexColors;Y=a.color;if(q.length===4&&V===THREE.VertexColors){ae=q[0];oe=q[1];se=q[2];le=q[3]}else{ae=Y;oe=Y;se=Y;le=Y}w[T]=ae.r;w[T+1]=ae.g;w[T+2]=ae.b;w[T+3]=oe.r;w[T+4]=oe.g;w[T+5]=oe.b;w[T+6]=se.r;w[T+7]=se.g;w[T+8]=se.b;w[T+9]=le.r;w[T+10]=le.g;w[T+11]=le.b;T+=12}if(T>0){st.bindBuffer(st.ARRAY_BUFFER,t.__webglColorBuffer);st.bufferData(st.ARRAY_BUFFER,w,e)}}if(Ke&&D.hasTangents){for(i=0,n=P.length;i<n;i++){a=U[P[i]];$=a.vertexTangents;Z=$[0];J=$[1];ee=$[2];H[g]=Z.x;H[g+1]=Z.y;H[g+2]=Z.z;H[g+3]=Z.w;H[g+4]=J.x;H[g+5]=J.y;H[g+6]=J.z;H[g+7]=J.w;H[g+8]=ee.x;H[g+9]=ee.y;H[g+10]=ee.z;H[g+11]=ee.w;g+=12}for(i=0,n=L.length;i<n;i++){a=U[L[i]];$=a.vertexTangents;Z=$[0];J=$[1];ee=$[2];te=$[3];H[g]=Z.x;H[g+1]=Z.y;H[g+2]=Z.z;H[g+3]=Z.w;H[g+4]=J.x;H[g+5]=J.y;H[g+6]=J.z;H[g+7]=J.w;H[g+8]=ee.x;H[g+9]=ee.y;H[g+10]=ee.z;H[g+11]=ee.w;H[g+12]=te.x;H[g+13]=te.y;H[g+14]=te.z;H[g+15]=te.w;g+=16}st.bindBuffer(st.ARRAY_BUFFER,t.__webglTangentBuffer);st.bufferData(st.ARRAY_BUFFER,H,e)}if($e&&I){for(i=0,n=P.length;i<n;i++){a=U[P[i]];G=a.vertexNormals;W=a.normal;if(G.length===3&&B){for(r=0;r<3;r++){Se=G[r];ke[E]=Se.x;ke[E+1]=Se.y;ke[E+2]=Se.z;E+=3}}else{for(r=0;r<3;r++){ke[E]=W.x;ke[E+1]=W.y;ke[E+2]=W.z;E+=3}}}for(i=0,n=L.length;i<n;i++){a=U[L[i]];G=a.vertexNormals;W=a.normal;if(G.length===4&&B){for(r=0;r<4;r++){Se=G[r];ke[E]=Se.x;ke[E+1]=Se.y;ke[E+2]=Se.z;E+=3}}else{for(r=0;r<4;r++){ke[E]=W.x;ke[E+1]=W.y;ke[E+2]=W.z;E+=3}}}st.bindBuffer(st.ARRAY_BUFFER,t.__webglNormalBuffer);st.bufferData(st.ARRAY_BUFFER,ke,e)}if(Ye&&et&&k){for(i=0,n=P.length;i<n;i++){j=P[i];K=et[j];if(K===undefined)continue;for(r=0;r<3;r++){Ae=K[r];Ie[Ne]=Ae.x;Ie[Ne+1]=Ae.y;Ne+=2}}for(i=0,n=L.length;i<n;i++){j=L[i];K=et[j];if(K===undefined)continue;for(r=0;r<4;r++){Ae=K[r];Ie[Ne]=Ae.x;Ie[Ne+1]=Ae.y;Ne+=2}}if(Ne>0){st.bindBuffer(st.ARRAY_BUFFER,t.__webglUVBuffer);st.bufferData(st.ARRAY_BUFFER,Ie,e)}}if(Ye&&tt&&k){for(i=0,n=P.length;i<n;i++){j=P[i];Q=tt[j];if(Q===undefined)continue;for(r=0;r<3;r++){Ce=Q[r];Ve[Fe]=Ce.x;Ve[Fe+1]=Ce.y;Fe+=2}}for(i=0,n=L.length;i<n;i++){j=L[i];Q=tt[j];if(Q===undefined)continue;for(r=0;r<4;r++){Ce=Q[r];Ve[Fe]=Ce.x;Ve[Fe+1]=Ce.y;Fe+=2}}if(Fe>0){st.bindBuffer(st.ARRAY_BUFFER,t.__webglUV2Buffer);st.bufferData(st.ARRAY_BUFFER,Ve,e)}}if(qe){for(i=0,n=P.length;i<n;i++){We[Oe]=p;We[Oe+1]=p+1;We[Oe+2]=p+2;Oe+=3;C[v]=p;C[v+1]=p+1;C[v+2]=p;C[v+3]=p+2;C[v+4]=p+1;C[v+5]=p+2;v+=6;p+=3}for(i=0,n=L.length;i<n;i++){We[Oe]=p;We[Oe+1]=p+1;We[Oe+2]=p+3;We[Oe+3]=p+1;We[Oe+4]=p+2;We[Oe+5]=p+3;Oe+=6;C[v]=p;C[v+1]=p+1;C[v+2]=p;C[v+3]=p+3;C[v+4]=p+1;C[v+5]=p+2;C[v+6]=p+2;C[v+7]=p+3;v+=8;p+=4}st.bindBuffer(st.ELEMENT_ARRAY_BUFFER,t.__webglFaceBuffer);st.bufferData(st.ELEMENT_ARRAY_BUFFER,We,e);st.bindBuffer(st.ELEMENT_ARRAY_BUFFER,t.__webglLineBuffer);st.bufferData(st.ELEMENT_ARRAY_BUFFER,C,e)}if(Ge){for(r=0,Me=Ge.length;r<Me;r++){A=Ge[r];if(!A.__original.needsUpdate)continue;R=0;ze=0;if(A.size===1){if(A.boundTo===undefined||A.boundTo==="vertices"){for(i=0,n=P.length;i<n;i++){a=U[P[i]];A.array[R]=A.value[a.a];A.array[R+1]=A.value[a.b];A.array[R+2]=A.value[a.c];R+=3}for(i=0,n=L.length;i<n;i++){a=U[L[i]];A.array[R]=A.value[a.a];A.array[R+1]=A.value[a.b];A.array[R+2]=A.value[a.c];A.array[R+3]=A.value[a.d];R+=4}}else if(A.boundTo==="faces"){for(i=0,n=P.length;i<n;i++){x=A.value[P[i]];A.array[R]=x;A.array[R+1]=x;A.array[R+2]=x;R+=3}for(i=0,n=L.length;i<n;i++){x=A.value[L[i]];A.array[R]=x;A.array[R+1]=x;A.array[R+2]=x;A.array[R+3]=x;R+=4}}}else if(A.size===2){if(A.boundTo===undefined||A.boundTo==="vertices"){for(i=0,n=P.length;i<n;i++){a=U[P[i]];o=A.value[a.a];s=A.value[a.b];l=A.value[a.c];A.array[R]=o.x;A.array[R+1]=o.y;A.array[R+2]=s.x;A.array[R+3]=s.y;A.array[R+4]=l.x;A.array[R+5]=l.y;R+=6}for(i=0,n=L.length;i<n;i++){a=U[L[i]];o=A.value[a.a];s=A.value[a.b];l=A.value[a.c];h=A.value[a.d];A.array[R]=o.x;A.array[R+1]=o.y;A.array[R+2]=s.x;A.array[R+3]=s.y;A.array[R+4]=l.x;A.array[R+5]=l.y;A.array[R+6]=h.x;A.array[R+7]=h.y;R+=8}}else if(A.boundTo==="faces"){for(i=0,n=P.length;i<n;i++){x=A.value[P[i]];o=x;s=x;l=x;A.array[R]=o.x;A.array[R+1]=o.y;A.array[R+2]=s.x;A.array[R+3]=s.y;A.array[R+4]=l.x;A.array[R+5]=l.y;R+=6}for(i=0,n=L.length;i<n;i++){x=A.value[L[i]];o=x;s=x;l=x;h=x;A.array[R]=o.x;A.array[R+1]=o.y;A.array[R+2]=s.x;A.array[R+3]=s.y;A.array[R+4]=l.x;A.array[R+5]=l.y;A.array[R+6]=h.x;A.array[R+7]=h.y;R+=8}}}else if(A.size===3){var N;if(A.type==="c"){N=["r","g","b"]}else{N=["x","y","z"]}if(A.boundTo===undefined||A.boundTo==="vertices"){for(i=0,n=P.length;i<n;i++){a=U[P[i]];o=A.value[a.a];s=A.value[a.b];l=A.value[a.c];A.array[R]=o[N[0]];A.array[R+1]=o[N[1]];A.array[R+2]=o[N[2]];A.array[R+3]=s[N[0]];A.array[R+4]=s[N[1]];A.array[R+5]=s[N[2]];A.array[R+6]=l[N[0]];A.array[R+7]=l[N[1]];A.array[R+8]=l[N[2]];R+=9}for(i=0,n=L.length;i<n;i++){a=U[L[i]];o=A.value[a.a];s=A.value[a.b];l=A.value[a.c];h=A.value[a.d];A.array[R]=o[N[0]];A.array[R+1]=o[N[1]];A.array[R+2]=o[N[2]];A.array[R+3]=s[N[0]];A.array[R+4]=s[N[1]];A.array[R+5]=s[N[2]];A.array[R+6]=l[N[0]];A.array[R+7]=l[N[1]];A.array[R+8]=l[N[2]];A.array[R+9]=h[N[0]];A.array[R+10]=h[N[1]];A.array[R+11]=h[N[2]];R+=12}}else if(A.boundTo==="faces"){for(i=0,n=P.length;i<n;i++){x=A.value[P[i]];o=x;s=x;l=x;A.array[R]=o[N[0]];A.array[R+1]=o[N[1]];A.array[R+2]=o[N[2]];A.array[R+3]=s[N[0]];A.array[R+4]=s[N[1]];A.array[R+5]=s[N[2]];A.array[R+6]=l[N[0]];A.array[R+7]=l[N[1]];A.array[R+8]=l[N[2]];R+=9}for(i=0,n=L.length;i<n;i++){x=A.value[L[i]];o=x;s=x;l=x;h=x;A.array[R]=o[N[0]];A.array[R+1]=o[N[1]];A.array[R+2]=o[N[2]];A.array[R+3]=s[N[0]];A.array[R+4]=s[N[1]];A.array[R+5]=s[N[2]];A.array[R+6]=l[N[0]];A.array[R+7]=l[N[1]];A.array[R+8]=l[N[2]];A.array[R+9]=h[N[0]];A.array[R+10]=h[N[1]];A.array[R+11]=h[N[2]];R+=12}}else if(A.boundTo==="faceVertices"){for(i=0,n=P.length;i<n;i++){x=A.value[P[i]];o=x[0];s=x[1];l=x[2];A.array[R]=o[N[0]];A.array[R+1]=o[N[1]];A.array[R+2]=o[N[2]];A.array[R+3]=s[N[0]];A.array[R+4]=s[N[1]];A.array[R+5]=s[N[2]];A.array[R+6]=l[N[0]];A.array[R+7]=l[N[1]];A.array[R+8]=l[N[2]];R+=9}for(i=0,n=L.length;i<n;i++){x=A.value[L[i]];o=x[0];s=x[1];l=x[2];h=x[3];A.array[R]=o[N[0]];A.array[R+1]=o[N[1]];A.array[R+2]=o[N[2]];A.array[R+3]=s[N[0]];A.array[R+4]=s[N[1]];A.array[R+5]=s[N[2]];A.array[R+6]=l[N[0]];A.array[R+7]=l[N[1]];A.array[R+8]=l[N[2]];A.array[R+9]=h[N[0]];A.array[R+10]=h[N[1]];A.array[R+11]=h[N[2]];R+=12}}}else if(A.size===4){if(A.boundTo===undefined||A.boundTo==="vertices"){for(i=0,n=P.length;i<n;i++){a=U[P[i]];o=A.value[a.a];s=A.value[a.b];l=A.value[a.c];A.array[R]=o.x;A.array[R+1]=o.y;A.array[R+2]=o.z;A.array[R+3]=o.w;A.array[R+4]=s.x;A.array[R+5]=s.y;A.array[R+6]=s.z;A.array[R+7]=s.w;A.array[R+8]=l.x;A.array[R+9]=l.y;A.array[R+10]=l.z;A.array[R+11]=l.w;R+=12}for(i=0,n=L.length;i<n;i++){a=U[L[i]];o=A.value[a.a];s=A.value[a.b];l=A.value[a.c];h=A.value[a.d];A.array[R]=o.x;A.array[R+1]=o.y;A.array[R+2]=o.z;A.array[R+3]=o.w;A.array[R+4]=s.x;A.array[R+5]=s.y;A.array[R+6]=s.z;A.array[R+7]=s.w;A.array[R+8]=l.x;A.array[R+9]=l.y;A.array[R+10]=l.z;A.array[R+11]=l.w;A.array[R+12]=h.x;A.array[R+13]=h.y;A.array[R+14]=h.z;A.array[R+15]=h.w;R+=16}}else if(A.boundTo==="faces"){for(i=0,n=P.length;i<n;i++){x=A.value[P[i]];o=x;s=x;l=x;A.array[R]=o.x;A.array[R+1]=o.y;A.array[R+2]=o.z;A.array[R+3]=o.w;A.array[R+4]=s.x;A.array[R+5]=s.y;A.array[R+6]=s.z;A.array[R+7]=s.w;A.array[R+8]=l.x;A.array[R+9]=l.y;A.array[R+10]=l.z;A.array[R+11]=l.w;R+=12}for(i=0,n=L.length;i<n;i++){x=A.value[L[i]];o=x;s=x;l=x;h=x;A.array[R]=o.x;A.array[R+1]=o.y;A.array[R+2]=o.z;A.array[R+3]=o.w;A.array[R+4]=s.x;A.array[R+5]=s.y;A.array[R+6]=s.z;A.array[R+7]=s.w;A.array[R+8]=l.x;A.array[R+9]=l.y;A.array[R+10]=l.z;A.array[R+11]=l.w;A.array[R+12]=h.x;A.array[R+13]=h.y;A.array[R+14]=h.z;A.array[R+15]=h.w;R+=16}}else if(A.boundTo==="faceVertices"){for(i=0,n=P.length;i<n;i++){x=A.value[P[i]];o=x[0];s=x[1];l=x[2];A.array[R]=o.x;A.array[R+1]=o.y;A.array[R+2]=o.z;A.array[R+3]=o.w;A.array[R+4]=s.x;A.array[R+5]=s.y;A.array[R+6]=s.z;A.array[R+7]=s.w;A.array[R+8]=l.x;A.array[R+9]=l.y;A.array[R+10]=l.z;A.array[R+11]=l.w;R+=12}for(i=0,n=L.length;i<n;i++){x=A.value[L[i]];o=x[0];s=x[1];l=x[2];h=x[3];A.array[R]=o.x;A.array[R+1]=o.y;A.array[R+2]=o.z;A.array[R+3]=o.w;A.array[R+4]=s.x;A.array[R+5]=s.y;A.array[R+6]=s.z;A.array[R+7]=s.w;A.array[R+8]=l.x;A.array[R+9]=l.y;A.array[R+10]=l.z;A.array[R+11]=l.w;A.array[R+12]=h.x;A.array[R+13]=h.y;A.array[R+14]=h.z;A.array[R+15]=h.w;R+=16}}}st.bindBuffer(st.ARRAY_BUFFER,A.buffer);st.bufferData(st.ARRAY_BUFFER,A.array,e)}}if(O){delete t.__inittedArrays;delete t.__colorArray;delete t.__normalArray;delete t.__tangentArray;delete t.__uvArray;delete t.__uv2Array;delete t.__faceArray;delete t.__vertexArray;delete t.__lineArray;delete t.__skinIndexArray;delete t.__skinWeightArray}}function Ke(e,t,i){var r=e.attributes;var n,a;for(n in r){a=r[n];if(a.needsUpdate){if(n==="index"){st.bindBuffer(st.ELEMENT_ARRAY_BUFFER,a.buffer);st.bufferData(st.ELEMENT_ARRAY_BUFFER,a.array,t)}else{st.bindBuffer(st.ARRAY_BUFFER,a.buffer);st.bufferData(st.ARRAY_BUFFER,a.array,t)}a.needsUpdate=false}if(i&&!a.dynamic){delete a.array}}}this.renderBufferImmediate=function(e,t,i){if(e.hasPositions&&!e.__webglVertexBuffer)e.__webglVertexBuffer=st.createBuffer();if(e.hasNormals&&!e.__webglNormalBuffer)e.__webglNormalBuffer=st.createBuffer();if(e.hasUvs&&!e.__webglUvBuffer)e.__webglUvBuffer=st.createBuffer();if(e.hasColors&&!e.__webglColorBuffer)e.__webglColorBuffer=st.createBuffer();if(e.hasPositions){st.bindBuffer(st.ARRAY_BUFFER,e.__webglVertexBuffer);st.bufferData(st.ARRAY_BUFFER,e.positionArray,st.DYNAMIC_DRAW);st.enableVertexAttribArray(t.attributes.position);st.vertexAttribPointer(t.attributes.position,3,st.FLOAT,false,0,0)}if(e.hasNormals){st.bindBuffer(st.ARRAY_BUFFER,e.__webglNormalBuffer);if(i.shading===THREE.FlatShading){var r,n,a,o,s,l,h,f,c,u,d,p,m,E,g=e.count*3;for(E=0;E<g;E+=9){m=e.normalArray;o=m[E];h=m[E+1];u=m[E+2];s=m[E+3];f=m[E+4];d=m[E+5];l=m[E+6];c=m[E+7];p=m[E+8];r=(o+s+l)/3;n=(h+f+c)/3;a=(u+d+p)/3;m[E]=r;m[E+1]=n;m[E+2]=a;m[E+3]=r;m[E+4]=n;m[E+5]=a;m[E+6]=r;m[E+7]=n;m[E+8]=a}}st.bufferData(st.ARRAY_BUFFER,e.normalArray,st.DYNAMIC_DRAW);st.enableVertexAttribArray(t.attributes.normal);st.vertexAttribPointer(t.attributes.normal,3,st.FLOAT,false,0,0)}if(e.hasUvs&&i.map){st.bindBuffer(st.ARRAY_BUFFER,e.__webglUvBuffer);st.bufferData(st.ARRAY_BUFFER,e.uvArray,st.DYNAMIC_DRAW);st.enableVertexAttribArray(t.attributes.uv);st.vertexAttribPointer(t.attributes.uv,2,st.FLOAT,false,0,0)}if(e.hasColors&&i.vertexColors!==THREE.NoColors){st.bindBuffer(st.ARRAY_BUFFER,e.__webglColorBuffer);st.bufferData(st.ARRAY_BUFFER,e.colorArray,st.DYNAMIC_DRAW);st.enableVertexAttribArray(t.attributes.color);st.vertexAttribPointer(t.attributes.color,3,st.FLOAT,false,0,0)}st.drawArrays(st.TRIANGLES,0,e.count);e.count=0};this.renderBufferDirect=function(e,t,i,r,n,a){if(r.visible===false)return;var o,s,l,h,f,c,u;var d,p,m,E;o=Ut(e,t,i,r,a);s=o.attributes;u=n.attributes;var g=false,v=r.wireframe?1:0,T=n.id*16777215+o.id*2+v;if(T!==S){S=T;g=true}if(g){rt()}if(a instanceof THREE.Mesh){var y=u["index"];if(y){var _=n.offsets;if(_.length>1)g=true;for(var R=0,x=_.length;R<x;R++){var b=_[R].index;if(g){for(p in u){if(p==="index")continue;m=s[p];d=u[p];E=d.itemSize;if(m>=0){st.bindBuffer(st.ARRAY_BUFFER,d.buffer);C(m);st.vertexAttribPointer(m,E,st.FLOAT,false,0,b*E*4)}}st.bindBuffer(st.ELEMENT_ARRAY_BUFFER,y.buffer)}st.drawElements(st.TRIANGLES,_[R].count,st.UNSIGNED_SHORT,_[R].start*2);j.info.render.calls++;j.info.render.vertices+=_[R].count;j.info.render.faces+=_[R].count/3}}else{if(g){for(p in u){if(p==="index")continue;m=s[p];d=u[p];E=d.itemSize;if(m>=0){st.bindBuffer(st.ARRAY_BUFFER,d.buffer);C(m);st.vertexAttribPointer(m,E,st.FLOAT,false,0,0)}}}var H=n.attributes["position"];st.drawArrays(st.TRIANGLES,0,H.numItems/3);j.info.render.calls++;j.info.render.vertices+=H.numItems/3;j.info.render.faces+=H.numItems/3/3}}else if(a instanceof THREE.ParticleSystem){if(g){for(p in u){m=s[p];d=u[p];E=d.itemSize;if(m>=0){st.bindBuffer(st.ARRAY_BUFFER,d.buffer);C(m);st.vertexAttribPointer(m,E,st.FLOAT,false,0,0)}}var H=u["position"];st.drawArrays(st.POINTS,0,H.numItems/3);j.info.render.calls++;j.info.render.points+=H.numItems/3}}else if(a instanceof THREE.Line){if(g){for(p in u){m=s[p];d=u[p];E=d.itemSize;if(m>=0){st.bindBuffer(st.ARRAY_BUFFER,d.buffer);C(m);st.vertexAttribPointer(m,E,st.FLOAT,false,0,0)}}$t(r.linewidth);var H=u["position"];st.drawArrays(st.LINE_STRIP,0,H.numItems/3);j.info.render.calls++;j.info.render.points+=H.numItems}}};var x;var Qe=0,Ze=0,Je=0,et=0,tt=false;this.renderBuffer=function(e,t,i,r,n,a){if(r.visible===false)return;var o,s,l,h,f,c,u,d;o=Ut(e,t,i,r,a);s=o.attributes;var p=false,m=r.wireframe?1:0,E=n.id*16777215+o.id*2+m;if(E!==S){S=E;p=true}if(p){rt()}var g,v;tt=p;if(p){v=true;if(lt){g=n._vao;if(g){x=n._vao[E];if(!x){x=n._vao[E]={vao:st.createVertexArray(),morph_state:{},material_hidden:{}}}else{p=false}st.bindVertexArray(x.vao)}}}if(!r.morphTargets&&s.position>=0){if(p){st.bindBuffer(st.ARRAY_BUFFER,n.__webglVertexBuffer);C(s.position);st.vertexAttribPointer(s.position,3,st.FLOAT,false,0,0)}}else{if(a.morphTargetBase){nt(r,n,a,p)}}if(p){if(n.__webglCustomAttributesList){for(u=0,d=n.__webglCustomAttributesList.length;u<d;u++){c=n.__webglCustomAttributesList[u];if(s[c.buffer.belongsToAttribute]>=0){st.bindBuffer(st.ARRAY_BUFFER,c.buffer);C(s[c.buffer.belongsToAttribute]);st.vertexAttribPointer(s[c.buffer.belongsToAttribute],c.size,st.FLOAT,false,0,0)}}}if(s.color>=0){st.bindBuffer(st.ARRAY_BUFFER,n.__webglColorBuffer);C(s.color);st.vertexAttribPointer(s.color,3,st.FLOAT,false,0,0)}if(s.normal>=0){st.bindBuffer(st.ARRAY_BUFFER,n.__webglNormalBuffer);C(s.normal);st.vertexAttribPointer(s.normal,3,st.FLOAT,false,0,0)}if(s.tangent>=0){st.bindBuffer(st.ARRAY_BUFFER,n.__webglTangentBuffer);C(s.tangent);st.vertexAttribPointer(s.tangent,4,st.FLOAT,false,0,0)}if(s.uv>=0){st.bindBuffer(st.ARRAY_BUFFER,n.__webglUVBuffer);C(s.uv);st.vertexAttribPointer(s.uv,2,st.FLOAT,false,0,0)}if(s.uv2>=0){st.bindBuffer(st.ARRAY_BUFFER,n.__webglUV2Buffer);C(s.uv2);st.vertexAttribPointer(s.uv2,2,st.FLOAT,false,0,0)}if(r.skinning&&s.skinIndex>=0&&s.skinWeight>=0){st.bindBuffer(st.ARRAY_BUFFER,n.__webglSkinIndicesBuffer);C(s.skinIndex);st.vertexAttribPointer(s.skinIndex,4,st.FLOAT,false,0,0);st.bindBuffer(st.ARRAY_BUFFER,n.__webglSkinWeightsBuffer);C(s.skinWeight);st.vertexAttribPointer(s.skinWeight,4,st.FLOAT,false,0,0)}if(s.lineDistance>=0){st.bindBuffer(st.ARRAY_BUFFER,n.__webglLineDistanceBuffer);C(s.lineDistance);st.vertexAttribPointer(s.lineDistance,1,st.FLOAT,false,0,0)}}var T=false;if(ie&&a.instanced_drawing){T=true;for(let r=mt+Et;r!==gt;r+=Et){let e=pt[r];if(!e.render)continue;let t=vt||e.opaque||e.transparent;if(!t||!t.visible)continue;if(!t.program)break;let i=e.buffer.id*16777215+t.program.id*2+(t.wireframe?1:0);T=i!==S||t.id!==R;break}if(!v&&n.__instanced&&!n.__instanced._instances.length){v=true}if(v){if(!n.__instanced)n.__instanced=new it(o,a.instanced_drawing)}n.__instanced._instances.push({instance_index:[n.__instanced._instances.length],modelViewMatrix:a._modelViewMatrix.elements,modelMatrix:a.matrixWorld.elements,normalMatrix:a._normalMatrix.elements});if(T||n.__instanced._instances.length>=n.__instanced.instance_max){T=n.__instanced._instances.length;n.__instanced.update(o);p=true}else{return}}var y;d=r.passes||1;if(x&&r.passes){if(r.opacity<=0){x.material_hidden[r.id]=true}else if(x.material_hidden[r.id]){x.material_hidden[r.id]=false;p=tt}}for(u=0;u<d;u++){y=false;if(r.preRenderPass){y=r.preRenderPass(j,u)}if(!y){_()}if(r.postRenderPass){r.postRenderPass(j,u)}}function _(){if(a instanceof THREE.Mesh){if(r.wireframe){$t(r.wireframeLinewidth);if(p)st.bindBuffer(st.ELEMENT_ARRAY_BUFFER,n.__webglLineBuffer);st.drawElements(st.LINES,n.__webglLineCount,st.UNSIGNED_SHORT,0)}else{if(p)st.bindBuffer(st.ELEMENT_ARRAY_BUFFER,n.__webglFaceBuffer);if(T){st.drawElementsInstanced(st.TRIANGLES,n.__webglFaceCount,st.UNSIGNED_SHORT,0,T)}else st.drawElements(st.TRIANGLES,n.__webglFaceCount,st.UNSIGNED_SHORT,0)}j.info.render.calls++;j.info.render.vertices+=n.__webglFaceCount;j.info.render.faces+=n.__webglFaceCount/3}else if(a instanceof THREE.Line){h=a.type===THREE.LineStrip?st.LINE_STRIP:st.LINES;$t(r.linewidth);st.drawArrays(h,0,n.__webglLineCount);j.info.render.calls++}else if(a instanceof THREE.ParticleSystem){st.drawArrays(st.POINTS,0,n.__webglParticleCount);j.info.render.calls++;j.info.render.points+=n.__webglParticleCount}else if(a instanceof THREE.Ribbon){st.drawArrays(st.TRIANGLE_STRIP,0,n.__webglVertexCount);j.info.render.calls++}}};var it=function(){function e(e,t){this.attributes={instance_index:{type:"float"},modelViewMatrix:{type:"mat4"},modelMatrix:{type:"mat4"},normalMatrix:{type:"mat3"}};a.call(this,e);this.buffer={};this.instance_max=t;this._instances=[];i.call(this)}function i(){this.delete();for(var t in this.attributes){const i=this.attributes[t].type;let e=i=="float"?1:parseInt(i.charAt(3));e*=e;const r=new Float32Array(this.instance_max*e);this.buffer[t]=r;const n=this.attributes_location[t];if(n==null)continue;const a=st.createBuffer();this.attributes[t].buffer=a;st.bindBuffer(st.ARRAY_BUFFER,a);st.bufferData(st.ARRAY_BUFFER,r.byteLength,st.DYNAMIC_DRAW);f(n,e)}}function f(t,e){const i=Math.sqrt(e);const r=4*e;for(let e=0;e<i;++e){const n=t+e;C(n);const a=e*i*4;st.vertexAttribPointer(n,i,st.FLOAT,false,r,a);st.vertexAttribDivisor(n,1)}}function a(i){if(this.program==i)return false;this.program=i;this.attributes_location={};this.uniforms_location={};for(let t in this.attributes){let e=i.attributes[t];this.attributes_location[t]=e==null||e==-1?null:e;e=i.uniforms["_"+t];this.uniforms_location["_"+t]=e==null||e==-1?null:e}return true}e.prototype.delete=function(){for(var e in this.attributes){if(this.attributes[e].buffer!=null)st.deleteBuffer(this.attributes[e].buffer)}};e.prototype.update=function(e){var t=a.call(this,e);var i=!x||t;for(var o in this.attributes){const r=this.attributes[o].type;let a=r=="float"?1:parseInt(r.charAt(3));a*=a;const s=this.buffer[o];this._instances.forEach(function(e,t){const i=e[o];const r=t*a;for(var n=0;n<a;n++)s[r+n]=i[n]});const n=this.attributes_location[o];if(n==null){const l=st.getUniformLocation(e,"_"+o);if(l!=null){if(a==16){st.uniformMatrix4fv(l,false,s)}else{st.uniformMatrix3fv(l,false,s)}}}else{const h=this.attributes[o].buffer;st.bindBuffer(st.ARRAY_BUFFER,h);st.bufferSubData(st.ARRAY_BUFFER,0,s);if(i){f(n,a)}}}this._instances=[]};return e}();function C(e){if(!t[e]){st.enableVertexAttribArray(e);t[e]=true}}function rt(){if(x){st.bindVertexArray(null);x=null}for(var e in t){if(t[e]){st.disableVertexAttribArray(e);t[e]=false}}}function nt(i,e,t,r){function n(e,t){if(i.morphTargets_dependency){if(i.morphTargets_dependency[e[1]]&&!i.morphTargets_dependency[t[1]])return-1;if(!i.morphTargets_dependency[e[1]]&&i.morphTargets_dependency[t[1]])return 1}return t[0]-e[0]}var a=i.program.attributes;if(r){if(t.morphTargetBase!==-1&&a.position>=0){st.bindBuffer(st.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[t.morphTargetBase]);C(a.position);st.vertexAttribPointer(a.position,3,st.FLOAT,false,0,0)}else if(a.position>=0){st.bindBuffer(st.ARRAY_BUFFER,e.__webglVertexBuffer);C(a.position);st.vertexAttribPointer(a.position,3,st.FLOAT,false,0,0)}}if(t.morphTargetForcedOrder.length){var o=0;var s=t.morphTargetForcedOrder;var l=t.morphTargetInfluences;while(o<i.numSupportedMorphTargets&&o<s.length){if(a["morphTarget"+o]>=0){st.bindBuffer(st.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[s[o]]);C(a["morphTarget"+o]);st.vertexAttribPointer(a["morphTarget"+o],3,st.FLOAT,false,0,0)}if(a["morphNormal"+o]>=0&&i.morphNormals){st.bindBuffer(st.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[s[o]]);C(a["morphNormal"+o]);st.vertexAttribPointer(a["morphNormal"+o],3,st.FLOAT,false,0,0)}t.__webglMorphTargetInfluences[o]=l[s[o]];o++}}else{var h,f=[];var l=t.morphTargetInfluences;var c,u=l.length;for(c=0;c<u;c++){h=l[c];if(h>0){f.push([h,c])}}if(f.length>i.numSupportedMorphTargets){f.sort(n);f.length=i.numSupportedMorphTargets}else if(f.length>i.numSupportedMorphNormals){f.sort(n)}else if(f.length===0){f.push([0,0])}var d,o=0;while(o<i.numSupportedMorphTargets){if(f[o]){d=f[o][1];if(!x||x.morph_state[o]!=d){if(x)x.morph_state[o]=d;if(a["morphTarget"+o]>=0){st.bindBuffer(st.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[d]);C(a["morphTarget"+o]);st.vertexAttribPointer(a["morphTarget"+o],3,st.FLOAT,false,0,0)}if(a["morphNormal"+o]>=0&&i.morphNormals){st.bindBuffer(st.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[d]);C(a["morphNormal"+o]);st.vertexAttribPointer(a["morphNormal"+o],3,st.FLOAT,false,0,0)}}t.__webglMorphTargetInfluences[o]=l[d]}else{t.__webglMorphTargetInfluences[o]=0}o++}}if(i.program.uniforms.morphTargetInfluences!==null){st.uniform1fv(i.program.uniforms.morphTargetInfluences,t.__webglMorphTargetInfluences)}}function at(e,t){if(e.renderOrder!==t.renderOrder){return t.z-e.z}var i=e.opaque||e.transparent;var r=t.opaque||t.transparent;if(i.program&&r.program&&i.program!==r.program){return i.program.id-r.program.id}else if(e.buffer.id!=t.buffer.id){return e.buffer.id-t.buffer.id}else if(i.id!==r.id){return i.id-r.id}else if(e.z!==t.z){return t.z-e.z}else{return e.id-t.id}}function ot(e,t){if(e.z!==t.z){return t.z-e.z}else{return e.id-t.id}}function ut(e,t){return t[0]-e[0]}this.render=function(e,i,t,r){var n,a,o,s,l,h=e.__lights,f=e.fog;R=-1;T=true;if(!e._RAF_timestamp_||e._RAF_timestamp_!=RAF_timestamp){if(e._RAF_timestamp_)e._RAF_timestamp_=RAF_timestamp;if(e.autoUpdate===true)e.updateMatrixWorld()}if(i.parent===undefined)i.updateMatrixWorld();i.matrixWorldInverse.getInverse(i.matrixWorld);A.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse);J.setFromMatrix(A);if(self.MMD_SA&&MMD_SA.THREEX.renderer.render(e,i))return;if(this.autoUpdateObjects)this.initWebGLObjects(e);dt(this.renderPluginsPre,e,i);j.info.render.calls=0;j.info.render.vertices=0;j.info.render.faces=0;j.info.render.points=0;this.setRenderTarget(t);if(this.autoClear||r){this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil)}l=e.__webglObjects;var c={};for(n=0,a=l.length;n<a;n++){o=l[n];s=o.object;o.id=n;o.render=false;if(s.visible){let t=c;if(s._model_index!=null){let e=o.transparent||o.opaque;if(e){if(e._render_once)e._render_once=null;else if(e.opacity<=0)continue}t=MMD_SA_options.model_para_obj_all[s._model_index].material_para;t=t&&t[s.material.materials[o._material_index].name]||{}}if(!(s instanceof THREE.Mesh||s instanceof THREE.ParticleSystem)||!s.frustumCulled||J.intersectsObject(s)){qt(s,i);Rt(o);o.render=true;if(this.sortObjects===true){if(t.renderDepth!=null||s.renderDepth!==null){o.z=t.renderDepth||s.renderDepth}else{G.getPositionFromMatrix(s.matrixWorld);G.applyProjection(A);o.z=G.z}}}}}var u=l;var d=l;if(this.sortObjects){if(!e.overrideMaterial){u=[];d=[];l.forEach(function(e){if(e.render)(e.opaque?u:d).push(e)});u.sort(at);d.sort(ot)}else l.sort(ot)}l=e.__webglObjectsImmediate;for(n=0,a=l.length;n<a;n++){o=l[n];s=o.object;if(s.visible){qt(s,i);_t(o)}}if(e.overrideMaterial){var p=e.overrideMaterial;this.setBlending(p.blending,p.blendEquation,p.blendSrc,p.blendDst);this.setDepthTest(p.depthTest);this.setDepthWrite(p.depthWrite);Kt(p.polygonOffset,p.polygonOffsetFactor,p.polygonOffsetUnits);Tt(e.__webglObjects,false,"",i,h,f,true,p);yt(e.__webglObjectsImmediate,"",i,h,f,false,p)}else{var p=null;this.setBlending(THREE.NoBlending);Tt(u,true,"opaque",i,h,f,false,p);yt(e.__webglObjectsImmediate,"opaque",i,h,f,false,p);var m=!(self.MMD_SA&&MMD_SA._depth_render_mode_);Tt(d,false,"transparent",i,h,f,m,p);yt(e.__webglObjectsImmediate,"transparent",i,h,f,m,p)}dt(this.renderPluginsPost,e,i);if(t&&t._use_multisample){st.bindFramebuffer(st.READ_FRAMEBUFFER,t.__webglMSAAFramebuffer);st.bindFramebuffer(st.DRAW_FRAMEBUFFER,t.__webglFramebuffer);var E=t.width;var g=t.height;var v=st.COLOR_BUFFER_BIT;st.blitFramebuffer(0,0,E,g,0,0,E,g,v,st.NEAREST)}if(t&&t.generateMipmaps&&t.minFilter!==THREE.NearestFilter&&t.minFilter!==THREE.LinearFilter){ci(t)}this.setDepthTest(true);this.setDepthWrite(true)};function dt(e,t,i){if(!e.length)return;for(var r=0,n=e.length;r<n;r++){f=null;c=null;s=-1;l=-1;h=-1;a=-1;o=-1;S=-1;R=-1;T=true;e[r].render(t,i,Q,Z);f=null;c=null;s=-1;l=-1;h=-1;a=-1;o=-1;S=-1;R=-1;T=true}}var pt,mt,Et,gt,vt;function Tt(e,t,i,r,n,a,o,s){var l,h,f,c,u,d,p;if(t){u=e.length-1;d=-1;p=-1}else{u=0;d=e.length;p=1}pt=e;gt=d;Et=p;vt=s;for(var m=u;m!==d;m+=p){mt=m;l=e[m];if(l.render){h=l.object;f=l.buffer;if(s){c=s}else{c=l[i];if(!c)continue;if(o)j.setBlending(c.blending,c.blendEquation,c.blendSrc,c.blendDst);j.setDepthTest(c.depthTest);j.setDepthWrite(c.depthWrite);Kt(c.polygonOffset,c.polygonOffsetFactor,c.polygonOffsetUnits)}j.setMaterialFaces(c);if(f instanceof THREE.BufferGeometry){j.renderBufferDirect(r,n,a,c,f,h)}else{j.renderBuffer(r,n,a,c,f,h)}}}if(x){st.bindVertexArray(null);x=null}}function yt(e,t,i,r,n,a,o){var s,l,h,f;for(var c=0,u=e.length;c<u;c++){s=e[c];l=s.object;if(l.visible){if(o){h=o}else{h=s[t];if(!h)continue;if(a)j.setBlending(h.blending,h.blendEquation,h.blendSrc,h.blendDst);j.setDepthTest(h.depthTest);j.setDepthWrite(h.depthWrite);Kt(h.polygonOffset,h.polygonOffsetFactor,h.polygonOffsetUnits)}j.renderImmediateObject(i,r,n,h,l)}}}this.renderImmediateObject=function(e,t,i,r,n){var a=Ut(e,t,i,r,n);S=-1;j.setMaterialFaces(r);if(n.immediateRenderCallback){n.immediateRenderCallback(a,st,J)}else{n.render(function(e){j.renderBufferImmediate(e,a,r)})}};function _t(e){var t=e.object,i=t.material;if(i.transparent){e.transparent=i;e.opaque=null}else{e.opaque=i;e.transparent=null}}function Rt(e){var t=e.object,i=e.buffer,r,n,a;a=t.material;if(a instanceof THREE.MeshFaceMaterial){n=i.materialIndex;r=a.materials[n];if(r.transparent){e.transparent=r;e.opaque=null}else{e.opaque=r;e.transparent=null}}else{r=a;if(r){if(r.transparent){e.transparent=r;e.opaque=null}else{e.opaque=r;e.transparent=null}}}}function xt(e,t,i){var r,n,a,o,s,l,h={};var f=e.morphTargets.length;var c=e.morphNormals.length;if(self.MMD_SA&&i!=null){var u=MMD_SA_options.model_para_obj_all[i].morphTargets_length_fixed;if(u==null)u=MMD_SA_options.morphTargets_length_fixed;if(u){f=u}else if(f&&MMD_SA.morphTargets_length_extra){f+=MMD_SA.morphTargets_length_extra}}var d=t instanceof THREE.MeshFaceMaterial;e.geometryGroups={};for(r=0,n=e.faces.length;r<n;r++){a=e.faces[r];o=d?a.materialIndex:0;if(h[o]===undefined){h[o]={hash:o,counter:0}}l=h[o].hash+"_"+h[o].counter;if(e.geometryGroups[l]===undefined){e.geometryGroups[l]={faces3:[],faces4:[],materialIndex:o,vertices:0,numMorphTargets:f,numMorphNormals:c}}s=a instanceof THREE.Face3?3:4;if(e.geometryGroups[l].vertices+s>65535){h[o].counter+=1;l=h[o].hash+"_"+h[o].counter;if(e.geometryGroups[l]===undefined){e.geometryGroups[l]={faces3:[],faces4:[],materialIndex:o,vertices:0,numMorphTargets:f,numMorphNormals:c}}}if(a instanceof THREE.Face3){e.geometryGroups[l].faces3.push(r)}else{e.geometryGroups[l].faces4.push(r)}e.geometryGroups[l].vertices+=s}e.geometryGroupsList=[];for(var p in e.geometryGroups){e.geometryGroups[p].id=O++;e.geometryGroupsList.push(e.geometryGroups[p])}}this.initWebGLObjects=function(e){if(!e.__webglObjects){e.__webglObjects=[];e.__webglObjectsImmediate=[];e.__webglSprites=[];e.__webglFlares=[]}while(e.__objectsAdded.length){bt(e.__objectsAdded[0],e);e.__objectsAdded.splice(0,1)}while(e.__objectsRemoved.length){Ct(e.__objectsRemoved[0],e);e.__objectsRemoved.splice(0,1)}for(var t=0,i=e.__webglObjects.length;t<i;t++){var r=e.__webglObjects[t].object;if(r.__webglInit===undefined){if(r.__webglActive!==undefined){Ct(r,e)}bt(r,e)}Mt(r)}};function bt(e,t){var i,r,n,a;if(e.__webglInit===undefined){e.__webglInit=true;e._modelViewMatrix=new THREE.Matrix4;e._normalMatrix=new THREE.Matrix3;if(e.geometry!==undefined&&e.geometry.__webglInit===undefined){e.geometry.__webglInit=true;e.geometry.addEventListener("dispose",Ce)}r=e.geometry;if(r===undefined){}else if(r instanceof THREE.BufferGeometry){We(r)}else if(e instanceof THREE.Mesh){n=e.material;if(r.geometryGroups===undefined){xt(r,n,e._model_index)}for(i in r.geometryGroups){a=r.geometryGroups[i];if(!a.__webglVertexBuffer){Ae(a);je(a,e);r.verticesNeedUpdate=true;r.morphTargetsNeedUpdate=true;r.elementsNeedUpdate=true;r.uvsNeedUpdate=true;r.normalsNeedUpdate=true;r.tangentsNeedUpdate=true;r.colorsNeedUpdate=true}}}else if(e instanceof THREE.Ribbon){if(!r.__webglVertexBuffer){Se(r);Be(r,e);r.verticesNeedUpdate=true;r.colorsNeedUpdate=true;r.normalsNeedUpdate=true}}else if(e instanceof THREE.Line){if(!r.__webglVertexBuffer){Me(r);ke(r,e);r.verticesNeedUpdate=true;r.colorsNeedUpdate=true;r.lineDistancesNeedUpdate=true}}else if(e instanceof THREE.ParticleSystem){if(!r.__webglVertexBuffer){we(r);Ve(r,e);r.verticesNeedUpdate=true;r.colorsNeedUpdate=true}}}if(e.__webglActive===undefined){if(e instanceof THREE.Mesh){r=e.geometry;if(r instanceof THREE.BufferGeometry){Ht(t.__webglObjects,r,e)}else if(r instanceof THREE.Geometry){for(i in r.geometryGroups){a=r.geometryGroups[i];Ht(t.__webglObjects,a,e);if(e._model_index!=null&&/^(\d+)/.test(i)){t.__webglObjects[t.__webglObjects.length-1]._material_index=parseInt(RegExp.$1)}}}}else if(e instanceof THREE.Ribbon||e instanceof THREE.Line||e instanceof THREE.ParticleSystem){r=e.geometry;Ht(t.__webglObjects,r,e)}else if(e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback){wt(t.__webglObjectsImmediate,e)}else if(e instanceof THREE.Sprite){t.__webglSprites.push(e)}else if(THREE.LensFlare&&e instanceof THREE.LensFlare){t.__webglFlares.push(e)}e.__webglActive=true}}function Ht(e,t,i){e.push({id:null,buffer:t,object:i,opaque:null,transparent:null,z:0})}function wt(e,t){e.push({id:null,object:t,opaque:null,transparent:null,z:0})}function Mt(e){var t=e.geometry,i,r,n;if(t instanceof THREE.BufferGeometry){Ke(t,st.DYNAMIC_DRAW,!t.dynamic)}else if(e instanceof THREE.Mesh){for(var a=0,o=t.geometryGroupsList.length;a<o;a++){i=t.geometryGroupsList[a];n=y(e,i);if(t.buffersNeedUpdate){je(i,e)}r=n.attributes&&St(n);if(t.verticesNeedUpdate||t.morphTargetsNeedUpdate||t.elementsNeedUpdate||t.uvsNeedUpdate||t.normalsNeedUpdate||t.colorsNeedUpdate||t.tangentsNeedUpdate||r){$e(i,e,st.DYNAMIC_DRAW,!t.dynamic,n)}}t.verticesNeedUpdate=false;t.morphTargetsNeedUpdate=false;t.elementsNeedUpdate=false;t.uvsNeedUpdate=false;t.normalsNeedUpdate=false;t.colorsNeedUpdate=false;t.tangentsNeedUpdate=false;t.buffersNeedUpdate=false;n.attributes&&At(n)}else if(e instanceof THREE.Ribbon){n=y(e,t);r=n.attributes&&St(n);if(t.verticesNeedUpdate||t.colorsNeedUpdate||t.normalsNeedUpdate||r){Ye(t,st.DYNAMIC_DRAW)}t.verticesNeedUpdate=false;t.colorsNeedUpdate=false;t.normalsNeedUpdate=false;n.attributes&&At(n)}else if(e instanceof THREE.Line){n=y(e,t);r=n.attributes&&St(n);if(t.verticesNeedUpdate||t.colorsNeedUpdate||t.lineDistancesNeedUpdate||r){qe(t,st.DYNAMIC_DRAW)}t.verticesNeedUpdate=false;t.colorsNeedUpdate=false;t.lineDistancesNeedUpdate=false;n.attributes&&At(n)}else if(e instanceof THREE.ParticleSystem){n=y(e,t);r=n.attributes&&St(n);if(t.verticesNeedUpdate||t.colorsNeedUpdate||e.sortParticles||r){Xe(t,st.DYNAMIC_DRAW,e)}t.verticesNeedUpdate=false;t.colorsNeedUpdate=false;n.attributes&&At(n)}}function St(e){for(var t in e.attributes){if(e.attributes[t].needsUpdate)return true}return false}function At(e){for(var t in e.attributes){e.attributes[t].needsUpdate=false}}function Ct(e,t){if(e instanceof THREE.Mesh||e instanceof THREE.ParticleSystem||e instanceof THREE.Ribbon||e instanceof THREE.Line){Dt(t.__webglObjects,e)}else if(e instanceof THREE.Sprite){Pt(t.__webglSprites,e)}else if(THREE.LensFlare&&e instanceof THREE.LensFlare){Pt(t.__webglFlares,e)}else if(e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback){Dt(t.__webglObjectsImmediate,e)}delete e.__webglActive}function Dt(e,t){for(var i=e.length-1;i>=0;i--){if(e[i].object===t){e.splice(i,1)}}}function Pt(e,t){for(var i=e.length-1;i>=0;i--){if(e[i]===t){e.splice(i,1)}}}this.initMaterial=function(e,t,i,r){e.addEventListener("dispose",Le);var n,a,o,s,l,h,f,c,u;if(e instanceof THREE.MeshDepthMaterial){u="depth"}else if(e instanceof THREE.MeshNormalMaterial){u="normal"}else if(e instanceof THREE.MeshBasicMaterial){u="basic"}else if(e instanceof THREE.MeshLambertMaterial){u="lambert"}else if(e instanceof THREE.MeshPhongMaterial){u="phong"}else if(e instanceof THREE.LineBasicMaterial){u="basic"}else if(e instanceof THREE.LineDashedMaterial){u="dashed"}else if(e instanceof THREE.ParticleBasicMaterial){u="particle_basic"}if(u){Lt(e,THREE.ShaderLib[u])}h=pi(t);c=mi(t);f=di(r);l={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,base_color:e.base_color,displacementMap:!!e.displacementMap,computerNormalFromDisplacement:!!e.uDisplacementCustomUVScale,waveTexture:e.waveBaseSpeed!=null,mirrorTexture:e.mirrorTextureIndex!=null,uniTexture:!!(use_MatrixRain&&(e.uniTexture||(r._model_index!=null||e instanceof THREE.MeshBasicMaterial||e instanceof THREE.MeshLambertMaterial||e instanceof THREE.MeshPhongMaterial)&&(e.uniTexture={state:use_MatrixRain?1:2}))),normalMap:!!e.normalMap,specularMap:!!e.specularMap,vertexColors:e.vertexColors,fog:i,useFog:e.fog,fogExp:i instanceof THREE.FogExp2,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,maxBones:f,useVertexTexture:fe&&r&&r.useVertexTexture,boneTextureWidth:r&&r.boneTextureWidth,boneTextureHeight:r&&r.boneTextureHeight,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:h.directional,maxPointLights:h.point,maxSpotLights:h.spot,maxHemiLights:h.hemi,maxShadows:c,shadowMapEnabled:this.shadowMapEnabled&&r.receiveShadow,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,shadowMapAlpha:r.receiveShadowAlpha,alphaTest:e.alphaTest,metal:e.metal,perPixel:e.perPixel,wrapAround:e.wrapAround,doubleSided:e.side===THREE.DoubleSide,flipSided:e.side===THREE.BackSide,instanced_drawing:ie&&r.instanced_drawing};e.program=Jt(u,e.fragmentShader,e.vertexShader,e.uniforms,e.attributes,e.defines,l);var d=e.program.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;var p,m="morphTarget";for(s=0;s<this.maxMorphTargets;s++){p=m+s;if(d[p]>=0){e.numSupportedMorphTargets++}}}if(e.morphNormals){e.numSupportedMorphNormals=0;var p,m="morphNormal";for(s=0;s<this.maxMorphNormals;s++){p=m+s;if(d[p]>=0){e.numSupportedMorphNormals++}}}e.uniformsList=[];for(n in e.uniforms){if(self.MMD_SA&&n=="depth_render_mode"){MMD_SA._depth_render_uniform_list.push({name:e.name||"",uniform:e.uniforms.depth_render_mode})}e.uniformsList.push([e.uniforms[n],n])}};function Lt(e,t){e.uniforms=THREE.UniformsUtils.clone(t.uniforms);e.vertexShader=t.vertexShader;e.fragmentShader=t.fragmentShader}function Ut(e,t,i,r,n){z=0;if(r.needsUpdate){if(r.program)Oe(r);j.initMaterial(r,t,i,n);r.needsUpdate=false}if(r.morphTargets){if(!n.__webglMorphTargetInfluences){n.__webglMorphTargetInfluences=new Float32Array(j.maxMorphTargets)}}var a=false;var o=r.program,s=o.uniforms,l=r.uniforms;if(o!==f){st.useProgram(o);f=o;a=true}if(r.id!==R){R=r.id;a=true}if(a||e!==c){st.uniformMatrix4fv(s.projectionMatrix,false,e.projectionMatrix.elements);if(e!==c)c=e}if(r.skinning){if(fe&&n.useVertexTexture){if(s.boneTexture!==null){var h=Wt();st.uniform1i(s.boneTexture,h);j.setTexture(n.boneTexture,h)}}else{if(s.boneGlobalMatrices!==null){st.uniformMatrix4fv(s.boneGlobalMatrices,false,n.boneMatrices)}}}if(a){if(i&&r.fog){It(l,i)}if(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r.lights){if(T){Yt(o,t);T=false}Bt(l,te)}if(r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial){Nt(l,r)}if(r instanceof THREE.LineBasicMaterial){Ft(l,r)}else if(r instanceof THREE.LineDashedMaterial){Ft(l,r);Ot(l,r)}else if(r instanceof THREE.ParticleBasicMaterial){zt(l,r)}else if(r instanceof THREE.MeshPhongMaterial){Vt(l,r)}else if(r instanceof THREE.MeshLambertMaterial){kt(l,r)}else if(r instanceof THREE.MeshDepthMaterial){l.mNear.value=e.near;l.mFar.value=e.far;l.opacity.value=r.opacity}else if(r instanceof THREE.MeshNormalMaterial){l.opacity.value=r.opacity}if(n.receiveShadow&&!r._shadowPass){jt(l,t)}if(r.uniTexture){let e=n.geometry.boundingSphere;if(l.uniTexture_state){l.uniTexture_state.value=r.uniTexture.state}if(l.uniTexture_scale){if(n._uniTexture_scale){l.uniTexture_scale.value=n._uniTexture_scale}else{let t;if(n.material.materials&&n._model_index==null){t=5/10}else{t=1;let e=n;while(e&&!(e instanceof THREE.Scene)){t*=Math.max(e.scale.x,e.scale.y,e.scale.z)||1;e=e.parent}t=Math.min(5/t,1);if(t<.1)t*=2}l.uniTexture_scale.value=Math.min(Math.ceil(e.radius/50),4)*t*(r.uniTexture.scale||1)}}if(l.uniTexture_bs){l.uniTexture_bs.value=e.radius}if(l.uniTexture_null_zone&&MMD_SA.MMD_started){let e=THREE.MMD.getModels()[0].mesh.position;l.uniTexture_null_zone.value.set(e.x,e.y+10,e.z,n._model_index==0?999:10)}if(l.uniTexture_MatrixRain_height_limit){l.uniTexture_MatrixRain_height_limit.value.set(n._uniTexture_fadeout||0,e.center.y)}if(l.uniTexture_map){l.uniTexture_map.value=r.uniTexture.map||MMD_SA.matrix_rain.matrix_texture}}if(r.refreshUniforms){r.refreshUniforms(j)}Xt(o,r.uniformsList);if(r instanceof THREE.ShaderMaterial||r instanceof THREE.MeshPhongMaterial||r.envMap){if(s.cameraPosition!==null){G.getPositionFromMatrix(e.matrixWorld);st.uniform3f(s.cameraPosition,G.x,G.y,G.z)}}if(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.ShaderMaterial||r.skinning){if(s.viewMatrix!==null){st.uniformMatrix4fv(s.viewMatrix,false,e.matrixWorldInverse.elements)}}}Gt(s,n);if(s.modelMatrix!==null){st.uniformMatrix4fv(s.modelMatrix,false,n.matrixWorld.elements)}return o}function Nt(e,t){e.opacity.value=t.opacity;if(j.gammaInput){e.diffuse.value.copyGammaToLinear(t.color)}else{e.diffuse.value=t.color}e.map.value=t.map;e.lightMap.value=t.lightMap;e.specularMap.value=t.specularMap;if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale}if(t.displacementMap){e.tDisplacement.value=t.displacementMap;e.uDisplacementBias.value=t.uDisplacementBias;e.uDisplacementScale.value=t.uDisplacementScale;e.uDisplacementCustomUVScale.value=t.uDisplacementCustomUVScale;e.uDisplacementCustomUVOffset.value.copy(t.uDisplacementCustomUVOffset);e.edgeRotateDisplacementL.value=t.edgeRotateDisplacementL;e.edgeRotateDisplacementR.value=t.edgeRotateDisplacementR;e.edgeScaleDisplacementU.value=t.edgeScaleDisplacementU}if(t.waveBaseSpeed!=null){e.waveBaseSpeed.value=t.waveBaseSpeed;e.waveNoiseTexture.value=t.waveNoiseTexture;e.waveNoiseScale.value=t.waveNoiseScale;e.waveBumpScale.value=t.waveBumpScale;e.time.value=RAF_timestamp/1e3;e.waveDrops.value=self.MMD_SA&&MMD_SA.ripple_process()||[]}if(t.mirrorTextureIndex!=null){var i=MMD_SA._THREE_mirror[t.mirrorTextureIndex];if(i){e.mirrorSampler.value=i.texture;e.mirrorTextureMatrix.value=i.textureMatrix}e.reflection_alpha.value=!i||MMD_SA._mirror_rendering_?0:i.material.uniforms.reflection_alpha.value}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale)}var r;if(t.repeat){r=t}else if(t.map){r=t.map}else if(t.specularMap){r=t.specularMap}else if(t.normalMap){r=t.normalMap}else if(t.bumpMap){r=t.bumpMap}else if(t.displacementMap){r=t.displacementMap}else if(t.waveNoiseTexture){r=t.waveNoiseTexture}if(r!==undefined){var n=r.offset;var a=r.repeat;e.offsetRepeat.value.set(n.x,n.y,a.x,a.y)}e.envMap.value=t.envMap;e.flipEnvMap.value=t.envMap instanceof THREE.WebGLRenderTargetCube?1:-1;if(j.gammaInput){e.reflectivity.value=t.reflectivity}else{e.reflectivity.value=t.reflectivity}e.refractionRatio.value=t.refractionRatio;e.combine.value=t.combine;e.useRefract.value=t.envMap&&t.envMap.mapping instanceof THREE.CubeRefractionMapping}function Ft(e,t){e.diffuse.value=t.color;e.opacity.value=t.opacity}function Ot(e,t){e.dashSize.value=t.dashSize;e.totalSize.value=t.dashSize+t.gapSize;e.scale.value=t.scale}function zt(e,t){e.psColor.value=t.color;e.opacity.value=t.opacity;e.size.value=t.size;e.scale.value=n.height/2;e.map.value=t.map}function It(e,t){e.fogColor.value=t.color;if(t instanceof THREE.Fog){e.fogNear.value=t.near;e.fogFar.value=t.far}else if(t instanceof THREE.FogExp2){e.fogDensity.value=t.density}}function Vt(e,t){e.shininess.value=t.shininess;if(j.gammaInput){e.ambient.value.copyGammaToLinear(t.ambient);e.emissive.value.copyGammaToLinear(t.emissive);e.specular.value.copyGammaToLinear(t.specular)}else{e.ambient.value=t.ambient;e.emissive.value=t.emissive;e.specular.value=t.specular}if(t.wrapAround){e.wrapRGB.value.copy(t.wrapRGB)}}function kt(e,t){if(j.gammaInput){e.ambient.value.copyGammaToLinear(t.ambient);e.emissive.value.copyGammaToLinear(t.emissive)}else{e.ambient.value=t.ambient;e.emissive.value=t.emissive}if(t.wrapAround){e.wrapRGB.value.copy(t.wrapRGB)}}function Bt(e,t){e.ambientLightColor.value=t.ambient;e.directionalLightColor.value=t.directional.colors;e.directionalLightDirection.value=t.directional.positions;e.pointLightColor.value=t.point.colors;e.pointLightPosition.value=t.point.positions;e.pointLightDistance.value=t.point.distances;e.spotLightColor.value=t.spot.colors;e.spotLightPosition.value=t.spot.positions;e.spotLightDistance.value=t.spot.distances;e.spotLightDirection.value=t.spot.directions;e.spotLightAngleCos.value=t.spot.anglesCos;e.spotLightExponent.value=t.spot.exponents;e.hemisphereLightSkyColor.value=t.hemi.skyColors;e.hemisphereLightGroundColor.value=t.hemi.groundColors;e.hemisphereLightDirection.value=t.hemi.positions}function jt(i,e){if(i.shadowMatrix){var r=0;for(var t=0,n=e.length;t<n;t++){var a=e[t];if(!a.castShadow)continue;if(a instanceof THREE.SpotLight||a instanceof THREE.DirectionalLight&&!a.shadowCascade){i.shadowMap.value[r]=a.shadowMap;i.shadowMapSize.value[r]=a.shadowMapSize;i.shadowMatrix.value[r]=a.shadowMatrix;i.shadowDarkness.value[r]=a.shadowDarkness;i.shadowBias.value[r]=a._shadowBias_range;i.shadowPara.value[r]=a._shadowPara;r++}else if(a instanceof THREE.DirectionalLight&&a.shadowCascadeArray){a.shadowCascadeArray.forEach(function(e,t){i.shadowMap.value[r]=e.shadowMap;i.shadowMapSize.value[r]=e.shadowMapSize;i.shadowMatrix.value[r]=e.shadowMatrix;i.shadowDarkness.value[r]=e.shadowDarkness;i.shadowBias.value[r]=e._shadowBias_range;i.shadowPara.value[r]=e._shadowPara;r++})}}}}function Gt(e,t){if(e.modelViewMatrix)st.uniformMatrix4fv(e.modelViewMatrix,false,t._modelViewMatrix.elements);if(e.normalMatrix){st.uniformMatrix3fv(e.normalMatrix,false,t._normalMatrix.elements)}}function Wt(){var e=z;if(e>=ne){console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+ne)}z+=1;return e}function Xt(e,t){var i,r,n,a,o,s,l,h,f,c,u;for(f=0,c=t.length;f<c;f++){a=e.uniforms[t[f][1]];if(!a)continue;i=t[f][0];n=i.type;r=i.value;if(n==="i"){st.uniform1i(a,r)}else if(n==="f"){st.uniform1f(a,r)}else if(n==="v2"){st.uniform2f(a,r.x,r.y)}else if(n==="v3"){st.uniform3f(a,r.x,r.y,r.z)}else if(n==="v4"){st.uniform4f(a,r.x,r.y,r.z,r.w)}else if(n==="c"){st.uniform3f(a,r.r,r.g,r.b)}else if(n==="iv1"){st.uniform1iv(a,r)}else if(n==="iv"){st.uniform3iv(a,r)}else if(n==="fv1"||n==="1fv"){st.uniform1fv(a,r)}else if(n==="fv"){st.uniform3fv(a,r)}else if(n==="v2v"){if(i._array===undefined){i._array=new Float32Array(2*r.length)}for(l=0,h=r.length;l<h;l++){u=l*2;i._array[u]=r[l].x;i._array[u+1]=r[l].y}st.uniform2fv(a,i._array)}else if(n==="v3v"){if(i._array===undefined){i._array=new Float32Array(3*r.length)}for(l=0,h=r.length;l<h;l++){u=l*3;i._array[u]=r[l].x;i._array[u+1]=r[l].y;i._array[u+2]=r[l].z}st.uniform3fv(a,i._array)}else if(n==="v4v"){if(i._array===undefined){i._array=new Float32Array(4*r.length)}for(l=0,h=r.length;l<h;l++){u=l*4;i._array[u]=r[l].x;i._array[u+1]=r[l].y;i._array[u+2]=r[l].z;i._array[u+3]=r[l].w}st.uniform4fv(a,i._array)}else if(n==="m4"){if(i._array===undefined){i._array=new Float32Array(16)}r.flattenToArray(i._array);st.uniformMatrix4fv(a,false,i._array)}else if(n==="m4v"){if(i._array===undefined){i._array=new Float32Array(16*r.length)}for(l=0,h=r.length;l<h;l++){r[l].flattenToArrayOffset(i._array,l*16)}st.uniformMatrix4fv(a,false,i._array)}else if(n==="t"){o=r;s=Wt();st.uniform1i(a,s);if(!o)continue;if(o.image instanceof Array&&o.image.length===6){si(o,s)}else if(o instanceof THREE.WebGLRenderTargetCube){li(o,s)}else{j.setTexture(o,s)}}else if(n==="tv"){if(i._array===undefined){i._array=[]}for(l=0,h=i.value.length;l<h;l++){i._array[l]=Wt()}st.uniform1iv(a,i._array);for(l=0,h=i.value.length;l<h;l++){o=i.value[l];s=i._array[l];if(!o)continue;j.setTexture(o,s)}}}}function qt(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld);e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function X(e,t,i,r){e[t]=i.r*i.r*r;e[t+1]=i.g*i.g*r;e[t+2]=i.b*i.b*r}function q(e,t,i,r){e[t]=i.r*r;e[t+1]=i.g*r;e[t+2]=i.b*r}function Yt(F,e){var t,i,r,O,n=0,a=0,o=0,s,l,h,f,c,z,u,d=te,p=d.directional.colors,m=d.directional.positions,E=d.point.colors,g=d.point.positions,I=d.point.distances,v=d.spot.colors,T=d.spot.positions,V=d.spot.distances,y=d.spot.directions,k=d.spot.anglesCos,B=d.spot.exponents,_=d.hemi.skyColors,R=d.hemi.groundColors,x=d.hemi.positions,b=0,H=0,w=0,M=0,S=0,A=0,C=0,D=0,P=0,L=0,U=0,N=0;for(t=0,i=e.length;t<i;t++){r=e[t];if(r.onlyShadow)continue;s=r.color;f=r.intensity;u=r.distance;if(r instanceof THREE.AmbientLight){if(!r.visible)continue;if(j.gammaInput){n+=s.r*s.r;a+=s.g*s.g;o+=s.b*s.b}else{n+=s.r;a+=s.g;o+=s.b}}else if(r instanceof THREE.DirectionalLight){S+=1;if(!r.visible)continue;W.getPositionFromMatrix(r.matrixWorld);G.getPositionFromMatrix(r.target.matrixWorld);W.sub(G);W.normalize();if(W.x===0&&W.y===0&&W.z===0)continue;P=b*3;m[P]=W.x;m[P+1]=W.y;m[P+2]=W.z;if(j.gammaInput){X(p,P,s,f*f)}else{q(p,P,s,f)}b+=1}else if(r instanceof THREE.PointLight){A+=1;if(!r.visible)continue;L=H*3;if(j.gammaInput){X(E,L,s,f*f)}else{q(E,L,s,f)}G.getPositionFromMatrix(r.matrixWorld);g[L]=G.x;g[L+1]=G.y;g[L+2]=G.z;I[H]=u;H+=1}else if(r instanceof THREE.SpotLight){C+=1;if(!r.visible)continue;U=w*3;if(j.gammaInput){X(v,U,s,f*f)}else{q(v,U,s,f)}G.getPositionFromMatrix(r.matrixWorld);T[U]=G.x;T[U+1]=G.y;T[U+2]=G.z;V[w]=u;W.copy(G);G.getPositionFromMatrix(r.target.matrixWorld);W.sub(G);W.normalize();y[U]=W.x;y[U+1]=W.y;y[U+2]=W.z;k[w]=Math.cos(r.angle);B[w]=r.exponent;w+=1}else if(r instanceof THREE.HemisphereLight){D+=1;if(!r.visible)continue;W.getPositionFromMatrix(r.matrixWorld);W.normalize();if(W.x===0&&W.y===0&&W.z===0)continue;N=M*3;x[N]=W.x;x[N+1]=W.y;x[N+2]=W.z;l=r.color;h=r.groundColor;if(j.gammaInput){c=f*f;X(_,N,l,c);X(R,N,h,c)}else{q(_,N,l,f);q(R,N,h,f)}M+=1}}for(t=b*3,i=Math.max(p.length,S*3);t<i;t++)p[t]=0;for(t=H*3,i=Math.max(E.length,A*3);t<i;t++)E[t]=0;for(t=w*3,i=Math.max(v.length,C*3);t<i;t++)v[t]=0;for(t=M*3,i=Math.max(_.length,D*3);t<i;t++)_[t]=0;for(t=M*3,i=Math.max(R.length,D*3);t<i;t++)R[t]=0;d.directional.length=b;d.point.length=H;d.spot.length=w;d.hemi.length=M;d.ambient[0]=n;d.ambient[1]=a;d.ambient[2]=o}this.setFaceCulling=function(e,t){if(e===THREE.CullFaceNone){st.disable(st.CULL_FACE)}else{if(t===THREE.FrontFaceDirectionCW){st.frontFace(st.CW)}else{st.frontFace(st.CCW)}if(e===THREE.CullFaceBack){st.cullFace(st.BACK)}else if(e===THREE.CullFaceFront){st.cullFace(st.FRONT)}else{st.cullFace(st.FRONT_AND_BACK)}st.enable(st.CULL_FACE)}};this.setMaterialFaces=function(e){var t=e.side===THREE.DoubleSide;var i=e.side===THREE.BackSide;if(a!==t){if(t){st.disable(st.CULL_FACE)}else{st.enable(st.CULL_FACE)}a=t}if(o!==i){if(i){st.frontFace(st.CW)}else{st.frontFace(st.CCW)}o=i}};this.setDepthTest=function(e){if(l!==e){if(e){st.enable(st.DEPTH_TEST)}else{st.disable(st.DEPTH_TEST)}l=e}};this.setDepthWrite=function(e){if(h!==e){st.depthMask(e);h=e}};function $t(e){if(e!==K){st.lineWidth(e);K=e}}function Kt(e,t,i){if(B!==e){if(e){st.enable(st.POLYGON_OFFSET_FILL)}else{st.disable(st.POLYGON_OFFSET_FILL)}B=e}if(e&&(Y!==t||$!==i)){st.polygonOffset(t,i);Y=t;$=i}}this.setBlending=function(e,t,i,r){if(e!==s){if(e===THREE.NoBlending){st.disable(st.BLEND)}else if(e===THREE.AdditiveBlending){st.enable(st.BLEND);st.blendEquation(st.FUNC_ADD);st.blendFunc(st.SRC_ALPHA,st.ONE)}else if(e===THREE.SubtractiveBlending){st.enable(st.BLEND);st.blendEquation(st.FUNC_ADD);st.blendFunc(st.ZERO,st.ONE_MINUS_SRC_COLOR)}else if(e===THREE.MultiplyBlending){st.enable(st.BLEND);st.blendEquation(st.FUNC_ADD);st.blendFunc(st.ZERO,st.SRC_COLOR)}else if(e===THREE.CustomBlending){st.enable(st.BLEND)}else{st.enable(st.BLEND);st.blendEquation(st.FUNC_ADD);st.blendFuncSeparate(st.SRC_ALPHA,st.ONE_MINUS_SRC_ALPHA,st.ONE,st.ONE_MINUS_SRC_ALPHA)}s=e}if(e===THREE.CustomBlending){if(t!==I){st.blendEquation(b(t));I=t}if(i!==V||r!==k){st.blendFunc(b(i),b(r));V=i;k=r}}else{I=null;V=null;k=null}};function Qt(e){var t,i,r=[];for(var n in e){t=e[n];if(t===false)continue;i="#define "+n+" "+t;r.push(i)}return r.join("\n")}function Zt(o){var e=/#pragma unroll_loop[\s]+?for[\s]*\([\s]*int i[\s]*\=[\s]*(\d+)\;[\s]i[\s]<[\s](\w+)\;[\s]i[\s]\+\+[\s]\)[\s]\{\/\/LOOP_START([\s\S]+?)(?=\})\}\/\/LOOP_END/g;function t(e,t,i,r){var n="";if(/^\D/.test(i)){let e=new RegExp("\\#define "+i+" (\\d+)");if(e.test(o))i=RegExp.$1}for(var a=parseInt(t);a<parseInt(i);a++){n+=r.replace(/\[[\s]*i[\s]*\]/g,"[ "+a+" ]")}return n}return o.replace(e,t)}function Jt(e,t,r,i,n,a,o){var s,l,h,f,c;var u=[];var d=["instance_index","modelViewMatrix"];var p=["_modelMatrix","_normalMatrix"];if(o.instanced_drawing){e=null;let i=[];p.forEach(function(e){let t=e=="_normalMatrix"?"mat3":"mat4";i.push(t+" "+e.substring(1)+"="+e+"[int(instance_index)];")});r=r.replace(/void main\(\)\s?\{/,"void main() {\n"+i.join("\n")+"\n")}if(e){u.push(e)}else{u.push(t);u.push(r)}for(h in a){u.push(h);u.push(a[h])}for(s in o){u.push(s);u.push(o[s])}c=u.join();for(s=0,l=M.length;s<l;s++){var m=M[s];if(m.code===c){m.usedTimes++;return m.program}}var E="SHADOWMAP_TYPE_BASIC";if(o.shadowMapType===THREE.PCFShadowMap){E="SHADOWMAP_TYPE_PCF"}else if(o.shadowMapType===THREE.PCFSoftShadowMap){E="SHADOWMAP_TYPE_PCF_SOFT"}var g=Qt(a);f=st.createProgram();var v=["precision "+w+" float;",g,he?"#define VERTEX_TEXTURES":"",j.gammaInput?"#define GAMMA_INPUT":"",j.gammaOutput?"#define GAMMA_OUTPUT":"",j.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+o.maxDirLights,"#define MAX_POINT_LIGHTS "+o.maxPointLights,"#define MAX_SPOT_LIGHTS "+o.maxSpotLights,"#define MAX_HEMI_LIGHTS "+o.maxHemiLights,"#define MAX_SHADOWS "+o.maxShadows,"#define MAX_BONES "+o.maxBones,o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.lightMap?"#define USE_LIGHTMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.displacementMap?"#define USE_DISPLACEMENTMAP":"",o.waveTexture?"#define USE_WAVE_TEXTURE":"",o.waveTexture?"#define RIPPLE_MAX "+(self.MMD_SA&&MMD_SA_options.ripple_max||20):"",o.waveTexture?"#define RIPPLE_RANGE "+(self.MMD_SA&&MMD_SA_options.ripple_range||128)+".0":"",o.mirrorTexture?"#define USE_MIRROR_TEXTURE":"",o.uniTexture?"#define USE_UNI_TEXTURE":"",o.normalMap?"#define USE_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.vertexColors?"#define USE_COLOR":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.boneTextureWidth?"#define N_BONE_PIXEL_X "+o.boneTextureWidth.toFixed(1):"",o.boneTextureHeight?"#define N_BONE_PIXEL_Y "+o.boneTextureHeight.toFixed(1):"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals?"#define USE_MORPHNORMALS":"",o.perPixel?"#define PHONG_PER_PIXEL":"",o.wrapAround?"#define WRAP_AROUND":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+E:"",o.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",o.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.instanced_drawing?"#define INSTANCED_DRAWING "+o.instanced_drawing:"","#ifdef INSTANCED_DRAWING","attribute float instance_index;",d.indexOf("modelMatrix")!=-1?"attribute mat4 modelMatrix;":"uniform mat4 _modelMatrix[INSTANCED_DRAWING];",d.indexOf("modelViewMatrix")!=-1?"attribute mat4 modelViewMatrix;":"uniform mat4 _modelViewMatrix[INSTANCED_DRAWING];",d.indexOf("normalMatrix")!=-1?"attribute mat3 normalMatrix;":"uniform mat3 _normalMatrix[INSTANCED_DRAWING];","#else","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat3 normalMatrix;","#endif","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n");var T=["precision "+w+" float;",o.bumpMap||o.normalMap?"#extension GL_OES_standard_derivatives : enable":"",g,"#define MAX_DIR_LIGHTS "+o.maxDirLights,"#define MAX_POINT_LIGHTS "+o.maxPointLights,"#define MAX_SPOT_LIGHTS "+o.maxSpotLights,"#define MAX_HEMI_LIGHTS "+o.maxHemiLights,"#define MAX_SHADOWS "+o.maxShadows,o.alphaTest?"#define ALPHATEST "+o.alphaTest:"",j.gammaInput?"#define GAMMA_INPUT":"",j.gammaOutput?"#define GAMMA_OUTPUT":"",j.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.lightMap?"#define USE_LIGHTMAP":"",o.bumpMap?"#define USE_BUMPMAP":"","#define BASE_COLOR "+(o.base_color&&"vec3("+o.base_color+")"||"vec3(1.0)"),o.displacementMap?"#define USE_DISPLACEMENTMAP":"",o.computerNormalFromDisplacement?"#define COMPUTE_NORMAL_FROM_DISPLACEMENT":"",o.waveTexture?"#define USE_WAVE_TEXTURE":"",o.mirrorTexture?"#define USE_MIRROR_TEXTURE":"",o.uniTexture?"#define USE_UNI_TEXTURE"+(use_MatrixRain?MMD_SA.matrix_rain.full_color?"\n#define USE_MATRIX_RAIN_COLOR":"\n#define USE_MATRIX_RAIN_GREEN":""):"",o.normalMap?"#define USE_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.vertexColors?"#define USE_COLOR":"",o.metal?"#define METAL":"",o.perPixel?"#define PHONG_PER_PIXEL":"",o.wrapAround?"#define WRAP_AROUND":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+E:"",o.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",o.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",o.shadowMapAlpha?"#define SHADOWMAP_ALPHA":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n");if(self.MMD_SA&&MMD_SA.use_webgl2){v=MMD_SA.webgl2_vshader_prefix_convert(v);T=MMD_SA.webgl2_vshader_prefix_convert(T);r=MMD_SA.webgl2_vshader_main_convert(r);t=MMD_SA.webgl2_fshader_main_convert(t)}var y=ri("vertex",Zt(v+r));var _=ri("fragment",Zt(T+t));st.attachShader(f,y);st.attachShader(f,_);st.linkProgram(f);if(!st.getProgramParameter(f,st.LINK_STATUS)){console.error("Could not initialise shader\n"+"VALIDATE_STATUS: "+st.getProgramParameter(f,st.VALIDATE_STATUS)+", gl error ["+st.getError()+"]");console.error(st.getProgramInfoLog(f))}st.deleteShader(_);st.deleteShader(y);f.uniforms={};f.attributes={};var R,x,b,H;if(o.instanced_drawing){R=["viewMatrix","projectionMatrix","cameraPosition","morphTargetInfluences"].concat(p)}else R=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences"];if(o.useVertexTexture){R.push("boneTexture")}else{R.push("boneGlobalMatrices")}for(x in i){R.push(x)}ei(f,R);R=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];if(o.instanced_drawing)R=R.concat(d);for(H=0;H<o.maxMorphTargets;H++){R.push("morphTarget"+H)}for(H=0;H<o.maxMorphNormals;H++){R.push("morphNormal"+H)}for(b in n){R.push(b)}ti(f,R);f.id=N++;M.push({program:f,code:c,usedTimes:1});j.info.memory.programs=M.length;return f}function ei(e,t){var i,r,n;for(i=0,r=t.length;i<r;i++){n=t[i];e.uniforms[n]=st.getUniformLocation(e,n)}}function ti(e,t){var i,r,n;for(i=0,r=t.length;i<r;i++){n=t[i];e.attributes[n]=st.getAttribLocation(e,n)}}function ii(e){var t=e.split("\n");for(var i=0,r=t.length;i<r;i++){t[i]=i+1+": "+t[i]}return t.join("\n")}function ri(e,t){var i;if(e==="fragment"){i=st.createShader(st.FRAGMENT_SHADER)}else if(e==="vertex"){i=st.createShader(st.VERTEX_SHADER)}st.shaderSource(i,t);st.compileShader(i);if(!st.getShaderParameter(i,st.COMPILE_STATUS)){console.error(st.getShaderInfoLog(i));console.error(ii(t));return null}return i}function _(e){if(self.MMD_SA&&MMD_SA.use_webgl2)return true;return(e&e-1)===0}function ni(e,t,i){if(i){st.texParameteri(e,st.TEXTURE_WRAP_S,b(t.wrapS));st.texParameteri(e,st.TEXTURE_WRAP_T,b(t.wrapT));st.texParameteri(e,st.TEXTURE_MAG_FILTER,b(t.magFilter));st.texParameteri(e,st.TEXTURE_MIN_FILTER,b(t.minFilter))}else{st.texParameteri(e,st.TEXTURE_WRAP_S,st.CLAMP_TO_EDGE);st.texParameteri(e,st.TEXTURE_WRAP_T,st.CLAMP_TO_EDGE);st.texParameteri(e,st.TEXTURE_MAG_FILTER,ui(t.magFilter));st.texParameteri(e,st.TEXTURE_MIN_FILTER,ui(t.minFilter))}if(d&&t.type!==THREE.FloatType){if(t.anisotropy>1||t.__oldAnisotropy){st.texParameterf(e,d.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,le));t.__oldAnisotropy=t.anisotropy}}}var ai=document.createElement("canvas");ai.width=ai.height=1;this.setTexture=function(e,t){if(e.needsUpdate){if(!e.__webglInit){e.__webglInit=true;e.addEventListener("dispose",De);e.__webglTexture=st.createTexture();j.info.memory.textures++}st.activeTexture(st.TEXTURE0+t);st.bindTexture(st.TEXTURE_2D,e.__webglTexture);st.pixelStorei(st.UNPACK_FLIP_Y_WEBGL,e.flipY);st.pixelStorei(st.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha);st.pixelStorei(st.UNPACK_ALIGNMENT,e.unpackAlignment);var i=e.image,r=_(i.width)&&_(i.height),n=b(e.format),a=b(e.type);var o=MMD_SA.webgl2_RGBA_internal(st,n,a);ni(st.TEXTURE_2D,e,r);var s,l=e.mipmaps;if(e instanceof THREE.DataTexture){if(l.length>0&&r){for(var h=0,f=l.length;h<f;h++){s=l[h];st.texImage2D(st.TEXTURE_2D,h,o,s.width,s.height,0,n,a,s.data)}e.generateMipmaps=false}else{st.texImage2D(st.TEXTURE_2D,0,o,i.width,i.height,0,n,a,i.data)}}else if(e instanceof THREE.CompressedTexture){for(var h=0,f=l.length;h<f;h++){s=l[h];st.compressedTexImage2D(st.TEXTURE_2D,h,n,s.width,s.height,0,s.data)}}else{if(l.length>0&&r){for(var h=0,f=l.length;h<f;h++){s=l[h];st.texImage2D(st.TEXTURE_2D,h,o,n,a,s)}e.generateMipmaps=false}else{var c=i.tagName!="IMG"||i.src&&i.complete?i:ai;st.texImage2D(st.TEXTURE_2D,0,o,n,a,c)}}if(e.generateMipmaps&&r)st.generateMipmap(st.TEXTURE_2D);e.needsUpdate=false;if(e.onUpdate)e.onUpdate()}else{st.activeTexture(st.TEXTURE0+t);st.bindTexture(st.TEXTURE_2D,e.__webglTexture)}};function oi(e,t){if(e.width<=t&&e.height<=t){return e}var i=Math.max(e.width,e.height);var r=Math.floor(e.width*t/i);var n=Math.floor(e.height*t/i);var a=document.createElement("canvas");a.width=r;a.height=n;var o=a.getContext("2d");o.drawImage(e,0,0,e.width,e.height,0,0,r,n);return a}function si(e,t){if(e.image.length===6){if(e.needsUpdate){if(!e.image.__webglTextureCube){e.image.__webglTextureCube=st.createTexture();j.info.memory.textures++}st.activeTexture(st.TEXTURE0+t);st.bindTexture(st.TEXTURE_CUBE_MAP,e.image.__webglTextureCube);st.pixelStorei(st.UNPACK_FLIP_Y_WEBGL,e.flipY);var i=e instanceof THREE.CompressedTexture;var r=[];for(var n=0;n<6;n++){if(j.autoScaleCubemaps&&!i){r[n]=oi(e.image[n],se)}else{r[n]=e.image[n]}}var a=r[0],o=_(a.width)&&_(a.height),s=b(e.format),l=b(e.type);var h=MMD_SA.webgl2_RGBA_internal(st,s,l);ni(st.TEXTURE_CUBE_MAP,e,o);for(var n=0;n<6;n++){if(i){var f,c=r[n].mipmaps;for(var u=0,d=c.length;u<d;u++){f=c[u];st.compressedTexImage2D(st.TEXTURE_CUBE_MAP_POSITIVE_X+n,u,s,f.width,f.height,0,f.data)}}else{st.texImage2D(st.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,h,s,l,r[n])}}if(e.generateMipmaps&&o){st.generateMipmap(st.TEXTURE_CUBE_MAP)}e.needsUpdate=false;if(e.onUpdate)e.onUpdate()}else{st.activeTexture(st.TEXTURE0+t);st.bindTexture(st.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}}}function li(e,t){st.activeTexture(st.TEXTURE0+t);st.bindTexture(st.TEXTURE_CUBE_MAP,e.__webglTexture)}function hi(e,t,i){st.bindFramebuffer(st.FRAMEBUFFER,e);st.framebufferTexture2D(st.FRAMEBUFFER,st.COLOR_ATTACHMENT0,i,t.__webglTexture,0)}function fi(e,t){st.bindRenderbuffer(st.RENDERBUFFER,e);if(t.depthBuffer){console.log("renderTarget.depthBuffer")}else{console.log("!renderTarget.depthBuffer")}if(t.depthBuffer&&!t.stencilBuffer){if(t._use_multisample){st.renderbufferStorageMultisample(st.RENDERBUFFER,t._use_multisample,st.DEPTH_COMPONENT16,t.width,t.height)}else st.renderbufferStorage(st.RENDERBUFFER,st.DEPTH_COMPONENT16,t.width,t.height);st.framebufferRenderbuffer(st.FRAMEBUFFER,st.DEPTH_ATTACHMENT,st.RENDERBUFFER,e)}else if(t.depthBuffer&&t.stencilBuffer){if(t._use_multisample){st.renderbufferStorageMultisample(st.RENDERBUFFER,t._use_multisample,st.DEPTH24_STENCIL8,t.width,t.height)}else st.renderbufferStorage(st.RENDERBUFFER,st.DEPTH_STENCIL,t.width,t.height);st.framebufferRenderbuffer(st.FRAMEBUFFER,st.DEPTH_STENCIL_ATTACHMENT,st.RENDERBUFFER,e)}else{if(t._use_multisample){console.log("FIXME: We don't support !depth !stencil");st.renderbufferStorageMultisample(st.RENDERBUFFER,t._use_multisample,st.RGBA8,t.width,t.height)}else st.renderbufferStorage(st.RENDERBUFFER,st.RGBA4,t.width,t.height)}}this.setRenderTarget=function(e){var t=e instanceof THREE.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){if(e.depthBuffer===undefined)e.depthBuffer=true;if(e.stencilBuffer===undefined)e.stencilBuffer=true;e.addEventListener("dispose",Pe);e.__webglTexture=st.createTexture();j.info.memory.textures++;var i=_(e.width)&&_(e.height),r=b(e.format),n=b(e.type);var a=MMD_SA.webgl2_RGBA_internal(st,r,n);if(t){e.__webglFramebuffer=[];e.__webglRenderbuffer=[];st.bindTexture(st.TEXTURE_CUBE_MAP,e.__webglTexture);ni(st.TEXTURE_CUBE_MAP,e,i);for(var o=0;o<6;o++){e.__webglFramebuffer[o]=st.createFramebuffer();e.__webglRenderbuffer[o]=st.createRenderbuffer();st.texImage2D(st.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,a,e.width,e.height,0,r,n,null);hi(e.__webglFramebuffer[o],e,st.TEXTURE_CUBE_MAP_POSITIVE_X+o);fi(e.__webglRenderbuffer[o],e)}}else{e.__webglFramebuffer=st.createFramebuffer();if(e._use_multisample){e.__webglMSAAFramebuffer=st.createFramebuffer();e.__webglMSAAColorbuffer=st.createRenderbuffer();st.bindFramebuffer(st.FRAMEBUFFER,e.__webglMSAAFramebuffer);var s=st.RGBA8;st.bindRenderbuffer(st.RENDERBUFFER,e.__webglMSAAColorbuffer);st.renderbufferStorageMultisample(st.RENDERBUFFER,e._use_multisample,s,e.width,e.height);st.framebufferRenderbuffer(st.FRAMEBUFFER,st.COLOR_ATTACHMENT0,st.RENDERBUFFER,e.__webglMSAAColorbuffer);if(e.depthBuffer){e.__webglMSAADepthbuffer=st.createRenderbuffer();fi(e.__webglMSAADepthbuffer,e)}st.bindFramebuffer(st.FRAMEBUFFER,null)}st.bindTexture(st.TEXTURE_2D,e.__webglTexture);ni(st.TEXTURE_2D,e,i);st.texImage2D(st.TEXTURE_2D,0,a,e.width,e.height,0,r,n,null);hi(e.__webglFramebuffer,e,st.TEXTURE_2D);if(!e._use_multisample){if(e.shareDepthFrom){e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer}else{e.__webglRenderbuffer=st.createRenderbuffer()}if(e.shareDepthFrom){if(e.depthBuffer&&!e.stencilBuffer){st.framebufferRenderbuffer(st.FRAMEBUFFER,st.DEPTH_ATTACHMENT,st.RENDERBUFFER,e.__webglRenderbuffer)}else if(e.depthBuffer&&e.stencilBuffer){st.framebufferRenderbuffer(st.FRAMEBUFFER,st.DEPTH_STENCIL_ATTACHMENT,st.RENDERBUFFER,e.__webglRenderbuffer)}}else{var l=e._use_multisample;e._use_multisample=null;fi(e.__webglRenderbuffer,e);e._use_multisample=l}}}if(t){st.bindTexture(st.TEXTURE_CUBE_MAP,null)}else{st.bindTexture(st.TEXTURE_2D,null)}st.bindRenderbuffer(st.RENDERBUFFER,null);st.bindFramebuffer(st.FRAMEBUFFER,null)}var h,f,c,u,d;if(e){if(t){h=e.__webglFramebuffer[e.activeCubeFace]}else{if(e._use_multisample){h=e.__webglMSAAFramebuffer}else h=e.__webglFramebuffer}f=e.width;c=e.height;u=0;d=0}else{h=MMD_SA.THREEX.renderer.device_framebuffer;f=E;c=g;u=p;d=m}if(h!==F){st.bindFramebuffer(st.FRAMEBUFFER,h);st.viewport(u,d,f,c);F=h}Q=f;Z=c};function ci(e){if(e instanceof THREE.WebGLRenderTargetCube){st.bindTexture(st.TEXTURE_CUBE_MAP,e.__webglTexture);st.generateMipmap(st.TEXTURE_CUBE_MAP);st.bindTexture(st.TEXTURE_CUBE_MAP,null)}else{st.bindTexture(st.TEXTURE_2D,e.__webglTexture);st.generateMipmap(st.TEXTURE_2D);st.bindTexture(st.TEXTURE_2D,null)}}function ui(e){if(e===THREE.NearestFilter||e===THREE.NearestMipMapNearestFilter||e===THREE.NearestMipMapLinearFilter){return st.NEAREST}return st.LINEAR}function b(e){if(e===THREE.RepeatWrapping)return st.REPEAT;if(e===THREE.ClampToEdgeWrapping)return st.CLAMP_TO_EDGE;if(e===THREE.MirroredRepeatWrapping)return st.MIRRORED_REPEAT;if(e===THREE.NearestFilter)return st.NEAREST;if(e===THREE.NearestMipMapNearestFilter)return st.NEAREST_MIPMAP_NEAREST;if(e===THREE.NearestMipMapLinearFilter)return st.NEAREST_MIPMAP_LINEAR;if(e===THREE.LinearFilter)return st.LINEAR;if(e===THREE.LinearMipMapNearestFilter)return st.LINEAR_MIPMAP_NEAREST;if(e===THREE.LinearMipMapLinearFilter)return st.LINEAR_MIPMAP_LINEAR;if(e===THREE.UnsignedByteType)return st.UNSIGNED_BYTE;if(e===THREE.UnsignedShort4444Type)return st.UNSIGNED_SHORT_4_4_4_4;if(e===THREE.UnsignedShort5551Type)return st.UNSIGNED_SHORT_5_5_5_1;if(e===THREE.UnsignedShort565Type)return st.UNSIGNED_SHORT_5_6_5;if(e===THREE.ByteType)return st.BYTE;if(e===THREE.ShortType)return st.SHORT;if(e===THREE.UnsignedShortType)return st.UNSIGNED_SHORT;if(e===THREE.IntType)return st.INT;if(e===THREE.UnsignedIntType)return st.UNSIGNED_INT;if(e===THREE.FloatType)return st.FLOAT;if(e===THREE.AlphaFormat)return st.ALPHA;if(e===THREE.RGBFormat)return st.RGB;if(e===THREE.RGBAFormat)return st.RGBA;if(e===THREE.LuminanceFormat)return st.LUMINANCE;if(e===THREE.LuminanceAlphaFormat)return st.LUMINANCE_ALPHA;if(e===THREE.AddEquation)return st.FUNC_ADD;if(e===THREE.SubtractEquation)return st.FUNC_SUBTRACT;if(e===THREE.ReverseSubtractEquation)return st.FUNC_REVERSE_SUBTRACT;if(e===THREE.ZeroFactor)return st.ZERO;if(e===THREE.OneFactor)return st.ONE;if(e===THREE.SrcColorFactor)return st.SRC_COLOR;if(e===THREE.OneMinusSrcColorFactor)return st.ONE_MINUS_SRC_COLOR;if(e===THREE.SrcAlphaFactor)return st.SRC_ALPHA;if(e===THREE.OneMinusSrcAlphaFactor)return st.ONE_MINUS_SRC_ALPHA;if(e===THREE.DstAlphaFactor)return st.DST_ALPHA;if(e===THREE.OneMinusDstAlphaFactor)return st.ONE_MINUS_DST_ALPHA;if(e===THREE.DstColorFactor)return st.DST_COLOR;if(e===THREE.OneMinusDstColorFactor)return st.ONE_MINUS_DST_COLOR;if(e===THREE.SrcAlphaSaturateFactor)return st.SRC_ALPHA_SATURATE;if(v!==undefined){if(e===THREE.RGB_S3TC_DXT1_Format)return v.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT1_Format)return v.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT3_Format)return v.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===THREE.RGBA_S3TC_DXT5_Format)return v.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}function di(e){if(fe&&e&&e.useVertexTexture){return 1024}else{var t=st.getParameter(st.MAX_VERTEX_UNIFORM_VECTORS);var i=Math.floor((t-20)/4);var r=i;if(e!==undefined&&e instanceof THREE.SkinnedMesh){r=Math.min(e.bones.length,r);if(r<e.bones.length){console.warn("WebGLRenderer: too many bones - "+e.bones.length+", this GPU supports just "+r+" (try OpenGL instead of ANGLE)")}}return r}}function pi(e){var t,i,r,n,a,o,s;n=a=o=s=0;for(t=0,i=e.length;t<i;t++){r=e[t];if(r.onlyShadow)continue;if(r instanceof THREE.DirectionalLight)n++;if(r instanceof THREE.PointLight)a++;if(r instanceof THREE.SpotLight)o++;if(r instanceof THREE.HemisphereLight)s++}return{directional:n,point:a,spot:o,hemi:s}}function mi(e){var t,i,r,n=0;for(t=0,i=e.length;t<i;t++){r=e[t];if(!r.castShadow)continue;if(r instanceof THREE.SpotLight)n++;if(r instanceof THREE.DirectionalLight&&!r.shadowCascade)n++}return n}function Ei(){try{var e={alpha:H,premultipliedAlpha:D,antialias:P,stencil:L,preserveDrawingBuffer:U};if(self.MMD_SA_options&&MMD_SA_options.WebXR&&MMD_SA_options.WebXR.AR&&MMD_SA.WebXR.can_AR){console.log("Use XR-compatible WebGL context");e.xrCompatible=true}if(self.MMD_SA)st=n.getContext("webgl2",e);if(st){console.log("Use WebGL2");MMD_SA.use_webgl2=true}else st=n.getContext("webgl",e)||n.getContext("experimental-webgl",e);if(st===null){throw"Error creating WebGL context."}}catch(e){console.error(e)}if(self.MMD_SA&&MMD_SA.use_webgl2){lt=true;console.log("Use VAO");u=true;re=true}else{u=st.getExtension("OES_texture_float");re=st.getExtension("OES_standard_derivatives")}d=st.getExtension("EXT_texture_filter_anisotropic")||st.getExtension("MOZ_EXT_texture_filter_anisotropic")||st.getExtension("WEBKIT_EXT_texture_filter_anisotropic");v=st.getExtension("WEBGL_compressed_texture_s3tc")||st.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||st.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");if(!u){console.log("THREE.WebGLRenderer: Float textures not supported.")}if(!re){console.log("THREE.WebGLRenderer: Standard derivatives not supported.")}if(!d){console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported.")}if(!v){console.log("THREE.WebGLRenderer: S3TC compressed textures not supported.")}if(st.getShaderPrecisionFormat===undefined){st.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}}if(self.MMD_SA)MMD_SA.WebGL_initialized=true;window.dispatchEvent(new CustomEvent("WebGL_initialized"))}function gi(){st.clearColor(0,0,0,1);st.clearDepth(1);st.clearStencil(0);st.enable(st.DEPTH_TEST);st.depthFunc(st.LEQUAL);st.frontFace(st.CCW);st.cullFace(st.BACK);st.enable(st.CULL_FACE);st.enable(st.BLEND);st.blendEquation(st.FUNC_ADD);st.blendFunc(st.SRC_ALPHA,st.ONE_MINUS_SRC_ALPHA);st.clearColor(i.r,i.g,i.b,r)}if(THREE.ShadowMapPlugin){this.shadowMapPlugin=new THREE.ShadowMapPlugin;this.addPrePlugin(this.shadowMapPlugin)}this.addPostPlugin(new THREE.SpritePlugin);if(THREE.LensFlarePlugin){this.addPostPlugin(new THREE.LensFlarePlugin)}};THREE.WebGLRenderTarget=function(e,t,i){this.width=e;this.height=t;i=i||{};this.wrapS=i.wrapS!==undefined?i.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=i.wrapT!==undefined?i.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=i.magFilter!==undefined?i.magFilter:THREE.LinearFilter;this.minFilter=i.minFilter!==undefined?i.minFilter:THREE.LinearMipMapLinearFilter;this.anisotropy=i.anisotropy!==undefined?i.anisotropy:1;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=i.format!==undefined?i.format:THREE.RGBAFormat;this.type=i.type!==undefined?i.type:THREE.UnsignedByteType;this.depthBuffer=i.depthBuffer!==undefined?i.depthBuffer:true;this.stencilBuffer=i.stencilBuffer!==undefined?i.stencilBuffer:true;this.generateMipmaps=true;this.shareDepthFrom=null};THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,clone:function(){var e=new THREE.WebGLRenderTarget(this.width,this.height);e.wrapS=this.wrapS;e.wrapT=this.wrapT;e.magFilter=this.magFilter;e.minFilter=this.minFilter;e.anisotropy=this.anisotropy;e.offset.copy(this.offset);e.repeat.copy(this.repeat);e.format=this.format;e.type=this.type;e.depthBuffer=this.depthBuffer;e.stencilBuffer=this.stencilBuffer;e.generateMipmaps=this.generateMipmaps;e.shareDepthFrom=this.shareDepthFrom;return e},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube=function(e,t,i){THREE.WebGLRenderTarget.call(this,e,t,i);this.activeCubeFace=0};THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype);THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=true};THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld);this.positionScreen.copy(e.positionScreen)};THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.centroidModel=new THREE.Vector3;this.normalModel=new THREE.Vector3;this.normalModelView=new THREE.Vector3;this.vertexNormalsLength=0;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsModelView=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.color=null;this.material=null;this.uvs=[[]];this.z=null};THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.v4=new THREE.RenderableVertex;this.centroidModel=new THREE.Vector3;this.normalModel=new THREE.Vector3;this.normalModelView=new THREE.Vector3;this.vertexNormalsLength=0;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsModelView=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.color=null;this.material=null;this.uvs=[[]];this.z=null};THREE.RenderableObject=function(){this.object=null;this.z=null};THREE.RenderableParticle=function(){this.object=null;this.x=null;this.y=null;this.z=null;this.rotation=null;this.scale=new THREE.Vector2;this.material=null};THREE.RenderableLine=function(){this.z=null;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.vertexColors=[new THREE.Color,new THREE.Color];this.material=null};THREE.GeometryUtils={merge:function(e,t,i){var r,n,a=e.vertices.length,o=e.faceVertexUvs[0].length,s=t instanceof THREE.Mesh?t.geometry:t,l=e.vertices,h=s.vertices,f=e.faces,c=s.faces,u=e.faceVertexUvs[0],d=s.faceVertexUvs[0];if(i===undefined)i=0;if(t instanceof THREE.Mesh){t.matrixAutoUpdate&&t.updateMatrix();r=t.matrix;n=(new THREE.Matrix3).getNormalMatrix(r)}for(var p=0,m=h.length;p<m;p++){var E=h[p];var g=E.clone();if(r)g.applyMatrix4(r);l.push(g)}for(p=0,m=c.length;p<m;p++){var v=c[p],T,y,_,R=v.vertexNormals,x=v.vertexColors;if(v instanceof THREE.Face3){T=new THREE.Face3(v.a+a,v.b+a,v.c+a)}else if(v instanceof THREE.Face4){T=new THREE.Face4(v.a+a,v.b+a,v.c+a,v.d+a)}T.normal.copy(v.normal);if(n){T.normal.applyMatrix3(n).normalize()}for(var b=0,H=R.length;b<H;b++){y=R[b].clone();if(n){y.applyMatrix3(n).normalize()}T.vertexNormals.push(y)}T.color.copy(v.color);for(var b=0,H=x.length;b<H;b++){_=x[b];T.vertexColors.push(_.clone())}T.materialIndex=v.materialIndex+i;T.centroid.copy(v.centroid);if(r){T.centroid.applyMatrix4(r)}f.push(T)}for(p=0,m=d.length;p<m;p++){var w=d[p],M=[];for(var b=0,H=w.length;b<H;b++){M.push(new THREE.Vector2(w[b].x,w[b].y))}u.push(M)}},removeMaterials:function(e,t){var i={};for(var r=0,n=t.length;r<n;r++){i[t[r]]=true}var a,o=[];for(var r=0,n=e.faces.length;r<n;r++){a=e.faces[r];if(!(a.materialIndex in i))o.push(a)}e.faces=o},randomPointInTriangle:function(e,t,i){var r,n,a,o=new THREE.Vector3,s=THREE.GeometryUtils.__v1;r=THREE.GeometryUtils.random();n=THREE.GeometryUtils.random();if(r+n>1){r=1-r;n=1-n}a=1-r-n;o.copy(e);o.multiplyScalar(r);s.copy(t);s.multiplyScalar(n);o.add(s);s.copy(i);s.multiplyScalar(a);o.add(s);return o},randomPointInFace:function(e,t,i){var r,n,a,o;if(e instanceof THREE.Face3){r=t.vertices[e.a];n=t.vertices[e.b];a=t.vertices[e.c];return THREE.GeometryUtils.randomPointInTriangle(r,n,a)}else if(e instanceof THREE.Face4){r=t.vertices[e.a];n=t.vertices[e.b];a=t.vertices[e.c];o=t.vertices[e.d];var s,l;if(i){if(e._area1&&e._area2){s=e._area1;l=e._area2}else{s=THREE.GeometryUtils.triangleArea(r,n,o);l=THREE.GeometryUtils.triangleArea(n,a,o);e._area1=s;e._area2=l}}else{s=THREE.GeometryUtils.triangleArea(r,n,o),l=THREE.GeometryUtils.triangleArea(n,a,o)}var h=THREE.GeometryUtils.random()*(s+l);if(h<s){return THREE.GeometryUtils.randomPointInTriangle(r,n,o)}else{return THREE.GeometryUtils.randomPointInTriangle(n,a,o)}}},randomPointsInGeometry:function(e,t){var i,r,n=e.faces,a=e.vertices,o=n.length,s=0,l=[],h,f,c,u;for(r=0;r<o;r++){i=n[r];if(i instanceof THREE.Face3){h=a[i.a];f=a[i.b];c=a[i.c];i._area=THREE.GeometryUtils.triangleArea(h,f,c)}else if(i instanceof THREE.Face4){h=a[i.a];f=a[i.b];c=a[i.c];u=a[i.d];i._area1=THREE.GeometryUtils.triangleArea(h,f,u);i._area2=THREE.GeometryUtils.triangleArea(f,c,u);i._area=i._area1+i._area2}s+=i._area;l[r]=s}function d(r){function n(e,t){if(t<e)return e;var i=e+Math.floor((t-e)/2);if(l[i]>r){return n(e,i-1)}else if(l[i]<r){return n(i+1,t)}else{return i}}return n(0,l.length-1)}var p,m,E=[];var g={};for(r=0;r<t;r++){p=THREE.GeometryUtils.random()*s;m=d(p);E[r]=THREE.GeometryUtils.randomPointInFace(n[m],e,true);if(!g[m]){g[m]=1}else{g[m]+=1}}return E},triangleArea:function(e,t,i){var r=THREE.GeometryUtils.__v1,n=THREE.GeometryUtils.__v2;r.subVectors(t,e);n.subVectors(i,e);r.cross(n);return.5*r.length()},center:function(e){e.computeBoundingBox();var t=e.boundingBox;var i=new THREE.Vector3;i.addVectors(t.min,t.max);i.multiplyScalar(-.5);e.applyMatrix((new THREE.Matrix4).makeTranslation(i.x,i.y,i.z));e.computeBoundingBox();return i},normalizeUVs:function(e){var t=e.faceVertexUvs[0];for(var i=0,r=t.length;i<r;i++){var n=t[i];for(var a=0,o=n.length;a<o;a++){if(n[a].x!==1)n[a].x=n[a].x-Math.floor(n[a].x);if(n[a].y!==1)n[a].y=n[a].y-Math.floor(n[a].y)}}},triangulateQuads:function(e){var t,i,r,n;var a=[];var o=[];var s=[];for(t=0,i=e.faceUvs.length;t<i;t++){o[t]=[]}for(t=0,i=e.faceVertexUvs.length;t<i;t++){s[t]=[]}for(t=0,i=e.faces.length;t<i;t++){var l=e.faces[t];if(l instanceof THREE.Face4){var h=l.a;var f=l.b;var c=l.c;var u=l.d;var d=new THREE.Face3;var p=new THREE.Face3;d.color.copy(l.color);p.color.copy(l.color);d.materialIndex=l.materialIndex;p.materialIndex=l.materialIndex;d.a=h;d.b=f;d.c=u;p.a=f;p.b=c;p.c=u;if(l.vertexColors.length===4){d.vertexColors[0]=l.vertexColors[0].clone();d.vertexColors[1]=l.vertexColors[1].clone();d.vertexColors[2]=l.vertexColors[3].clone();p.vertexColors[0]=l.vertexColors[1].clone();p.vertexColors[1]=l.vertexColors[2].clone();p.vertexColors[2]=l.vertexColors[3].clone()}a.push(d,p);for(r=0,n=e.faceVertexUvs.length;r<n;r++){if(e.faceVertexUvs[r].length){var m=e.faceVertexUvs[r][t];var E=m[0];var g=m[1];var v=m[2];var T=m[3];var y=[E.clone(),g.clone(),T.clone()];var _=[g.clone(),v.clone(),T.clone()];s[r].push(y,_)}}for(r=0,n=e.faceUvs.length;r<n;r++){if(e.faceUvs[r].length){var R=e.faceUvs[r][t];o[r].push(R,R)}}}else{a.push(l);for(r=0,n=e.faceUvs.length;r<n;r++){o[r].push(e.faceUvs[r][t])}for(r=0,n=e.faceVertexUvs.length;r<n;r++){s[r].push(e.faceVertexUvs[r][t])}}}e.faces=a;e.faceUvs=o;e.faceVertexUvs=s;e.computeCentroids();e.computeFaceNormals();e.computeVertexNormals();if(e.hasTangents)e.computeTangents()},setMaterialIndex:function(e,t,i,r){var n=e.faces;var a=i||0;var o=r||n.length-1;for(var s=a;s<=o;s++){n[s].materialIndex=t}}};THREE.GeometryUtils.random=THREE.Math.random16;THREE.GeometryUtils.__v1=new THREE.Vector3;THREE.GeometryUtils.__v2=new THREE.Vector3;THREE.ImageUtils={loadTexture:function(e,t,i,r,n){var a=new Image;if(n&&n.texture_resolution_limit)a._texture_resolution_limit=n.texture_resolution_limit;var o=new THREE.Texture(a,t);var s=new THREE.ImageLoader;s.addEventListener("load",function(e){o.image=e.content;o.needsUpdate=true;if(i)i(o)});s.addEventListener("error",function(e){if(r)r(e.message)});s.load(e,a);o.sourceFile=e;return o},loadCompressedTexture:function(e,t,i,r){var n=new THREE.CompressedTexture;n.mapping=t;var a=new XMLHttpRequestZIP;a.onload=function(){var e=a.response;var t=THREE.ImageUtils.parseDDS(e,true);n.format=t.format;n.mipmaps=t.mipmaps;n.image.width=t.width;n.image.height=t.height;n.generateMipmaps=false;n.needsUpdate=true;if(i)i(n)};a.onerror=r;a.open("GET",e,true);a.responseType="arraybuffer";a.send(null);return n},loadTextureCube:function(e,t,i,r){var n=[];n.loadCount=0;var a=new THREE.Texture;a.image=n;if(t!==undefined)a.mapping=t;a.flipY=false;for(var o=0,s=e.length;o<s;++o){var l=new Image;n[o]=l;l.onload=function(){n.loadCount+=1;if(n.loadCount===6){a.needsUpdate=true;if(i)i(a)}};l.onerror=r;if(!/^data:image/.test(e[o])&&!/^(tga|TGA)/.test(e[o].split(".").pop()))l.crossOrigin="anonymous";l.src=e[o]}return a},loadCompressedTextureCube:function(e,t,a,i){var o=[];o.loadCount=0;var s=new THREE.CompressedTexture;s.image=o;if(t!==undefined)s.mapping=t;s.flipY=false;s.generateMipmaps=false;var r=function(i,r){return function(){var e=i.response;var t=THREE.ImageUtils.parseDDS(e,true);r.format=t.format;r.mipmaps=t.mipmaps;r.width=t.width;r.height=t.height;o.loadCount+=1;if(o.loadCount===6){s.format=t.format;s.needsUpdate=true;if(a)a(s)}}};if(e instanceof Array){for(var n=0,l=e.length;n<l;++n){var h={};o[n]=h;var f=new XMLHttpRequestZIP;f.onload=r(f,h);f.onerror=i;var c=e[n];f.open("GET",c,true);f.responseType="arraybuffer";f.send(null)}}else{var c=e;var f=new XMLHttpRequestZIP;f.onload=function(){var e=f.response;var t=THREE.ImageUtils.parseDDS(e,true);if(t.isCubemap){var i=t.mipmaps.length/t.mipmapCount;for(var r=0;r<i;r++){o[r]={mipmaps:[]};for(var n=0;n<t.mipmapCount;n++){o[r].mipmaps.push(t.mipmaps[r*t.mipmapCount+n]);o[r].format=t.format;o[r].width=t.width;o[r].height=t.height}}s.format=t.format;s.needsUpdate=true;if(a)a(s)}};f.onerror=i;f.open("GET",c,true);f.responseType="arraybuffer";f.send(null)}return s},parseDDS:function(e,t){var i={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};var r=542327876;var n=1,N=2,F=4,O=8,z=4096,a=131072,I=524288,V=8388608;var k=8,B=4194304,j=4096;var o=512,G=1024,W=2048,X=4096,q=8192,Y=16384,$=32768,K=2097152;var Q=1,Z=2,s=4,J=64,ee=512,te=131072;function l(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function h(e){return String.fromCharCode(e&255,e>>8&255,e>>16&255,e>>24&255)}var f=l("DXT1");var c=l("DXT3");var u=l("DXT5");var d=31;var p=0;var m=1;var E=2;var g=3;var v=4;var T=7;var y=20;var _=21;var ie=27;var R=28;var re=29;var ne=30;var x=new Int32Array(e,0,d);if(x[p]!==r){console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header");return i}if(!x[y]&s){console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code");return i}var b;var H=x[_];switch(H){case f:b=8;i.format=THREE.RGB_S3TC_DXT1_Format;break;case c:b=16;i.format=THREE.RGBA_S3TC_DXT3_Format;break;case u:b=16;i.format=THREE.RGBA_S3TC_DXT5_Format;break;default:console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",h(H));return i}i.mipmapCount=1;if(x[E]&a&&t!==false){i.mipmapCount=Math.max(1,x[T])}i.isCubemap=x[R]&o?true:false;i.width=x[v];i.height=x[g];var w=x[m]+4;var M=i.width;var S=i.height;var A=i.isCubemap?6:1;for(var C=0;C<A;C++){for(var D=0;D<i.mipmapCount;D++){var P=Math.max(4,M)/4*Math.max(4,S)/4*b;var L=new Uint8Array(e,w,P);var U={data:L,width:M,height:S};i.mipmaps.push(U);w+=P;M=Math.max(M*.5,1);S=Math.max(S*.5,1)}M=i.width;S=i.height}return i},getNormalMap:function(e,t){var i=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]};var r=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]};var n=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t=t|1;var a=e.width;var o=e.height;var s=document.createElement("canvas");s.width=a;s.height=o;var l=s.getContext("2d");l.drawImage(e,0,0);var h=l.getImageData(0,0,a,o).data;var f=l.createImageData(a,o);var c=f.data;for(var u=0;u<a;u++){for(var d=0;d<o;d++){var p=d-1<0?0:d-1;var m=d+1>o-1?o-1:d+1;var E=u-1<0?0:u-1;var g=u+1>a-1?a-1:u+1;var v=[];var T=[0,0,h[(d*a+u)*4]/255*t];v.push([-1,0,h[(d*a+E)*4]/255*t]);v.push([-1,-1,h[(p*a+E)*4]/255*t]);v.push([0,-1,h[(p*a+u)*4]/255*t]);v.push([1,-1,h[(p*a+g)*4]/255*t]);v.push([1,0,h[(d*a+g)*4]/255*t]);v.push([1,1,h[(m*a+g)*4]/255*t]);v.push([0,1,h[(m*a+u)*4]/255*t]);v.push([-1,1,h[(m*a+E)*4]/255*t]);var y=[];var _=v.length;for(var R=0;R<_;R++){var x=v[R];var b=v[(R+1)%_];x=r(x,T);b=r(b,T);y.push(n(i(x,b)))}var H=[0,0,0];for(var R=0;R<y.length;R++){H[0]+=y[R][0];H[1]+=y[R][1];H[2]+=y[R][2]}H[0]/=y.length;H[1]/=y.length;H[2]/=y.length;var w=(d*a+u)*4;c[w]=(H[0]+1)/2*255|0;c[w+1]=(H[1]+1)/2*255|0;c[w+2]=H[2]*255|0;c[w+3]=255}}l.putImageData(f,0,0);return s},generateDataTexture:function(e,t,i){var r=e*t;var n=new Uint8Array(3*r);var a=Math.floor(i.r*255);var o=Math.floor(i.g*255);var s=Math.floor(i.b*255);for(var l=0;l<r;l++){n[l*3]=a;n[l*3+1]=o;n[l*3+2]=s}var h=new THREE.DataTexture(n,e,t,THREE.RGBFormat);h.needsUpdate=true;return h}};THREE.SceneUtils={createMultiMaterialObject:function(e,t){var i=new THREE.Object3D;for(var r=0,n=t.length;r<n;r++){i.add(new THREE.Mesh(e,t[r]))}return i},detach:function(e,t,i){e.applyMatrix(t.matrixWorld);t.remove(e);i.add(e)},attach:function(e,t,i){var r=new THREE.Matrix4;r.getInverse(i.matrixWorld);e.applyMatrix(r);t.remove(e);i.add(e)}};THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase();var i=this;i.faces[t]=i.faces[t]||{};i.faces[t][e.cssFontWeight]=i.faces[t][e.cssFontWeight]||{};i.faces[t][e.cssFontWeight][e.cssFontStyle]=e;var r=i.faces[t][e.cssFontWeight][e.cssFontStyle]=e;return e},drawText:function(e){var t=[],i=[];var r,n,a=this.getFace(),o=this.size/a.resolution,s=0,l=String(e).split(""),h=l.length;var f=[];for(r=0;r<h;r++){var c=new THREE.Path;var u=this.extractGlyphPoints(l[r],a,o,s,c);s+=u.offset;f.push(u.path)}var d=s/2;return{paths:f,offset:d}},extractGlyphPoints:function(e,t,i,r,n){var a=[];var o,s,l,h,f,c,u,d,p,m,E,g,v,T,y,_,R,x,b,H=t.glyphs[e]||t.glyphs["?"];if(!H)return;if(H.o){h=H._cachedOutline||(H._cachedOutline=H.o.split(" "));c=h.length;u=i;d=i;for(o=0;o<c;){f=h[o++];switch(f){case"m":p=h[o++]*u+r;m=h[o++]*d;n.moveTo(p,m);break;case"l":p=h[o++]*u+r;m=h[o++]*d;n.lineTo(p,m);break;case"q":E=h[o++]*u+r;g=h[o++]*d;y=h[o++]*u+r;_=h[o++]*d;n.quadraticCurveTo(y,_,E,g);b=a[a.length-1];if(b){v=b.x;T=b.y;for(s=1,l=this.divisions;s<=l;s++){var w=s/l;var M=THREE.Shape.Utils.b2(w,v,y,E);var S=THREE.Shape.Utils.b2(w,T,_,g)}}break;case"b":E=h[o++]*u+r;g=h[o++]*d;y=h[o++]*u+r;_=h[o++]*-d;R=h[o++]*u+r;x=h[o++]*-d;n.bezierCurveTo(E,g,y,_,R,x);b=a[a.length-1];if(b){v=b.x;T=b.y;for(s=1,l=this.divisions;s<=l;s++){var w=s/l;var M=THREE.Shape.Utils.b3(w,v,y,R,E);var S=THREE.Shape.Utils.b3(w,T,_,x,g)}}break}}}return{offset:H.ha*i,path:n}}};THREE.FontUtils.generateShapes=function(e,t){t=t||{};var i=t.size!==undefined?t.size:100;var r=t.curveSegments!==undefined?t.curveSegments:4;var n=t.font!==undefined?t.font:"helvetiker";var a=t.weight!==undefined?t.weight:"normal";var o=t.style!==undefined?t.style:"normal";THREE.FontUtils.size=i;THREE.FontUtils.divisions=r;THREE.FontUtils.face=n;THREE.FontUtils.weight=a;THREE.FontUtils.style=o;var s=THREE.FontUtils.drawText(e);var l=s.paths;var h=[];for(var f=0,c=l.length;f<c;f++){Array.prototype.push.apply(h,l[f].toShapes())}return h};(function(e){var C=1e-10;var t=function(e,t){var i=e.length;if(i<3)return null;var r=[],n=[],a=[];var o,s,l;if(E(e)>0){for(s=0;s<i;s++)n[s]=s}else{for(s=0;s<i;s++)n[s]=i-1-s}var h=i;var f=2*h;for(s=h-1;h>2;){if(f--<=0){console.log("Warning, unable to triangulate polygon!");if(t)return a;return r}o=s;if(h<=o)o=0;s=o+1;if(h<=s)s=0;l=s+1;if(h<=l)l=0;if(g(e,o,s,l,h,n)){var c,u,d,p,m;c=n[o];u=n[s];d=n[l];r.push([e[c],e[u],e[d]]);a.push([n[o],n[s],n[l]]);for(p=s,m=s+1;m<h;p++,m++){n[p]=n[m]}h--;f=2*h}}if(t)return a;return r};var E=function(e){var t=e.length;var i=0;for(var r=t-1,n=0;n<t;r=n++){i+=e[r].x*e[n].y-e[n].x*e[r].y}return i*.5};var g=function(e,t,i,r,n,a){var o;var s,l,h,f;var c,u,d,p;s=e[a[t]].x;l=e[a[t]].y;h=e[a[i]].x;f=e[a[i]].y;c=e[a[r]].x;u=e[a[r]].y;if(C>(h-s)*(u-l)-(f-l)*(c-s))return false;var m,E,g,v,T,y;var _,R,x,b,H,w;var M,S,A;m=c-h;E=u-f;g=s-c;v=l-u;T=h-s;y=f-l;for(o=0;o<n;o++){if(o===t||o===i||o===r)continue;d=e[a[o]].x;p=e[a[o]].y;_=d-s;R=p-l;x=d-h;b=p-f;H=d-c;w=p-u;A=m*b-E*x;M=T*R-y*_;S=g*w-v*H;if(A>=0&&S>=0&&M>=0)return false}return true};e.Triangulate=t;e.Triangulate.area=E;return e})(THREE.FontUtils);self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace};THREE.typeface_js=self._typeface_js;THREE.Curve=function(){};THREE.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)};THREE.Curve.prototype.getPoints=function(e){if(!e)e=5;var t,i=[];for(t=0;t<=e;t++){i.push(this.getPoint(t/e))}return i};THREE.Curve.prototype.getSpacedPoints=function(e){if(!e)e=5;var t,i=[];for(t=0;t<=e;t++){i.push(this.getPointAt(t/e))}return i};THREE.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]};THREE.Curve.prototype.getLengths=function(e){if(!e)e=this.__arcLengthDivisions?this.__arcLengthDivisions:200;if(this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate){return this.cacheArcLengths}this.needsUpdate=false;var t=[];var i,r=this.getPoint(0);var n,a=0;t.push(0);for(n=1;n<=e;n++){i=this.getPoint(n/e);a+=i.distanceTo(r);t.push(a);r=i}this.cacheArcLengths=t;return t};THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=true;this.getLengths()};THREE.Curve.prototype.getUtoTmapping=function(e,t){var i=this.getLengths();var r=0,n=i.length;var a;if(t){a=t}else{a=e*i[n-1]}var o=0,s=n-1,l;while(o<=s){r=Math.floor(o+(s-o)/2);l=i[r]-a;if(l<0){o=r+1;continue}else if(l>0){s=r-1;continue}else{s=r;break}}r=s;if(i[r]==a){var h=r/(n-1);return h}var f=i[r];var c=i[r+1];var u=c-f;var d=(a-f)/u;var h=(r+d)/(n-1);return h};THREE.Curve.prototype.getTangent=function(e){var t=1e-4;var i=e-t;var r=e+t;if(i<0)i=0;if(r>1)r=1;var n=this.getPoint(i);var a=this.getPoint(r);var o=a.clone().sub(n);return o.normalize()};THREE.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)};THREE.LineCurve=function(e,t){this.v1=e;this.v2=t};THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);t.multiplyScalar(e).add(this.v1);return t};THREE.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)};THREE.LineCurve.prototype.getTangent=function(e){var t=this.v2.clone().sub(this.v1);return t.normalize()};THREE.QuadraticBezierCurve=function(e,t,i){this.v0=e;this.v1=t;this.v2=i};THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.QuadraticBezierCurve.prototype.getPoint=function(e){var t,i;t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x);i=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y);return new THREE.Vector2(t,i)};THREE.QuadraticBezierCurve.prototype.getTangent=function(e){var t,i;t=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x);i=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y);var r=new THREE.Vector2(t,i);r.normalize();return r};THREE.CubicBezierCurve=function(e,t,i,r){this.v0=e;this.v1=t;this.v2=i;this.v3=r};THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.CubicBezierCurve.prototype.getPoint=function(e){var t,i;t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);i=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new THREE.Vector2(t,i)};THREE.CubicBezierCurve.prototype.getTangent=function(e){var t,i;t=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);i=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var r=new THREE.Vector2(t,i);r.normalize();return r};THREE.SplineCurve=function(e){this.points=e==undefined?[]:e};THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.SplineCurve.prototype.getPoint=function(e){var t=new THREE.Vector2;var i=[];var r=this.points,n,a,o;n=(r.length-1)*e;a=Math.floor(n);o=n-a;i[0]=a==0?a:a-1;i[1]=a;i[2]=a>r.length-2?r.length-1:a+1;i[3]=a>r.length-3?r.length-1:a+2;t.x=THREE.Curve.Utils.interpolate(r[i[0]].x,r[i[1]].x,r[i[2]].x,r[i[3]].x,o);t.y=THREE.Curve.Utils.interpolate(r[i[0]].y,r[i[1]].y,r[i[2]].y,r[i[3]].y,o);return t};THREE.EllipseCurve=function(e,t,i,r,n,a,o){this.aX=e;this.aY=t;this.xRadius=i;this.yRadius=r;this.aStartAngle=n;this.aEndAngle=a;this.aClockwise=o};THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype);THREE.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;if(!this.aClockwise){e=1-e}var i=this.aStartAngle+e*t;var r=this.aX+this.xRadius*Math.cos(i);var n=this.aY+this.yRadius*Math.sin(i);return new THREE.Vector2(r,n)};THREE.ArcCurve=function(e,t,i,r,n,a){THREE.EllipseCurve.call(this,e,t,i,i,r,n,a)};THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype);THREE.Curve.Utils={tangentQuadraticBezier:function(e,t,i,r){return 2*(1-e)*(i-t)+2*e*(r-i)},tangentCubicBezier:function(e,t,i,r,n){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*n},tangentSpline:function(e,t,i,r,n){var a=6*e*e-6*e;var o=3*e*e-4*e+1;var s=-6*e*e+6*e;var l=3*e*e-2*e;return a+o+s+l},interpolate:function(e,t,i,r,n){var a=(i-e)*.5;var o=(r-t)*.5;var s=n*n;var l=n*s;return(2*t-2*i+a+o)*l+(-3*t+3*i-2*a-o)*s+a*n+t}};THREE.Curve.create=function(e,t){e.prototype=Object.create(THREE.Curve.prototype);e.prototype.getPoint=t;return e};THREE.LineCurve3=THREE.Curve.create(function(e,t){this.v1=e;this.v2=t},function(e){var t=new THREE.Vector3;t.subVectors(this.v2,this.v1);t.multiplyScalar(e);t.add(this.v1);return t});THREE.QuadraticBezierCurve3=THREE.Curve.create(function(e,t,i){this.v0=e;this.v1=t;this.v2=i},function(e){var t,i,r;t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x);i=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y);r=THREE.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z);return new THREE.Vector3(t,i,r)});THREE.CubicBezierCurve3=THREE.Curve.create(function(e,t,i,r){this.v0=e;this.v1=t;this.v2=i;this.v3=r},function(e){var t,i,r;t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);i=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);r=THREE.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return new THREE.Vector3(t,i,r)});THREE.SplineCurve3=THREE.Curve.create(function(e){this.points=e==undefined?[]:e},function(e){var t=new THREE.Vector3;var i=[];var r=this.points,n,a,o;n=(r.length-1)*e;a=Math.floor(n);o=n-a;i[0]=a==0?a:a-1;i[1]=a;i[2]=a>r.length-2?r.length-1:a+1;i[3]=a>r.length-3?r.length-1:a+2;var s=r[i[0]],l=r[i[1]],h=r[i[2]],f=r[i[3]];t.x=THREE.Curve.Utils.interpolate(s.x,l.x,h.x,f.x,o);t.y=THREE.Curve.Utils.interpolate(s.y,l.y,h.y,f.y,o);t.z=THREE.Curve.Utils.interpolate(s.z,l.z,h.z,f.z,o);return t});THREE.ClosedSplineCurve3=THREE.Curve.create(function(e){this.points=e==undefined?[]:e},function(e){var t=new THREE.Vector3;var i=[];var r=this.points,n,a,o;n=(r.length-0)*e;a=Math.floor(n);o=n-a;a+=a>0?0:(Math.floor(Math.abs(a)/r.length)+1)*r.length;i[0]=(a-1)%r.length;i[1]=a%r.length;i[2]=(a+1)%r.length;i[3]=(a+2)%r.length;t.x=THREE.Curve.Utils.interpolate(r[i[0]].x,r[i[1]].x,r[i[2]].x,r[i[3]].x,o);t.y=THREE.Curve.Utils.interpolate(r[i[0]].y,r[i[1]].y,r[i[2]].y,r[i[3]].y,o);t.z=THREE.Curve.Utils.interpolate(r[i[0]].z,r[i[1]].z,r[i[2]].z,r[i[3]].z,o);return t});THREE.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=false};THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype);THREE.CurvePath.prototype.add=function(e){this.curves.push(e)};THREE.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0);var t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){this.curves.push(new THREE.LineCurve(t,e))}};THREE.CurvePath.prototype.getPoint=function(e){var t=e*this.getLength();var i=this.getCurveLengths();var r=0,n,a;while(r<i.length){if(i[r]>=t){n=i[r]-t;a=this.curves[r];var o=1-n/a.getLength();return a.getPointAt(o);break}r++}return null};THREE.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]};THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length){return this.cacheLengths}var e=[],t=0;var i,r=this.curves.length;for(i=0;i<r;i++){t+=this.curves[i].getLength();e.push(t)}this.cacheLengths=e;return e};THREE.CurvePath.prototype.getBoundingBox=function(){var e=this.getPoints();var t,i,r;var n,a,o;t=i=Number.NEGATIVE_INFINITY;n=a=Number.POSITIVE_INFINITY;var s,l,h,f;var c=e[0]instanceof THREE.Vector3;f=c?new THREE.Vector3:new THREE.Vector2;for(l=0,h=e.length;l<h;l++){s=e[l];if(s.x>t)t=s.x;else if(s.x<n)n=s.x;if(s.y>i)i=s.y;else if(s.y<a)a=s.y;if(c){if(s.z>r)r=s.z;else if(s.z<o)o=s.z}f.add(s)}var u={minX:n,minY:a,maxX:t,maxY:i,centroid:f.divideScalar(h)};if(c){u.maxZ=r;u.minZ=o}return u};THREE.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,true);return this.createGeometry(t)};THREE.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,true);return this.createGeometry(t)};THREE.CurvePath.prototype.createGeometry=function(e){var t=new THREE.Geometry;for(var i=0;i<e.length;i++){t.vertices.push(new THREE.Vector3(e[i].x,e[i].y,e[i].z||0))}return t};THREE.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)};THREE.CurvePath.prototype.getTransformedPoints=function(e,t){var i=this.getPoints(e);var r,n;if(!t){t=this.bends}for(r=0,n=t.length;r<n;r++){i=this.getWrapPoints(i,t[r])}return i};THREE.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var i=this.getSpacedPoints(e);var r,n;if(!t){t=this.bends}for(r=0,n=t.length;r<n;r++){i=this.getWrapPoints(i,t[r])}return i};THREE.CurvePath.prototype.getWrapPoints=function(e,t){var i=this.getBoundingBox();var r,n,a,o,s,l;for(r=0,n=e.length;r<n;r++){a=e[r];o=a.x;s=a.y;l=o/i.maxX;l=t.getUtoTmapping(l,o);var h=t.getPoint(l);var f=t.getNormalVector(l).multiplyScalar(s);a.x=h.x+f.x;a.y=h.y+f.y}return e};THREE.Gyroscope=function(){THREE.Object3D.call(this)};THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype);THREE.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e){if(this.parent){this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix);this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld);this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject);this.matrixWorld.makeFromPositionQuaternionScale(this.translationWorld,this.rotationObject,this.scaleWorld)}else{this.matrixWorld.copy(this.matrix)}this.matrixWorldNeedsUpdate=false;e=true}for(var t=0,i=this.children.length;t<i;t++){this.children[t].updateMatrixWorld(e)}};THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3;THREE.Gyroscope.prototype.translationObject=new THREE.Vector3;THREE.Gyroscope.prototype.rotationWorld=new THREE.Quaternion;THREE.Gyroscope.prototype.rotationObject=new THREE.Quaternion;THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3;THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3;THREE.Path=function(e){THREE.CurvePath.call(this);this.actions=[];if(e){this.fromPoints(e)}};THREE.Path.prototype=Object.create(THREE.CurvePath.prototype);THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"};THREE.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;t<i;t++){this.lineTo(e[t].x,e[t].y)}};THREE.Path.prototype.moveTo=function(e,t){var i=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:i})};THREE.Path.prototype.lineTo=function(e,t){var i=Array.prototype.slice.call(arguments);var r=this.actions[this.actions.length-1].args;var n=r[r.length-2];var a=r[r.length-1];var o=new THREE.LineCurve(new THREE.Vector2(n,a),new THREE.Vector2(e,t));this.curves.push(o);this.actions.push({action:THREE.PathActions.LINE_TO,args:i})};THREE.Path.prototype.quadraticCurveTo=function(e,t,i,r){var n=Array.prototype.slice.call(arguments);var a=this.actions[this.actions.length-1].args;var o=a[a.length-2];var s=a[a.length-1];var l=new THREE.QuadraticBezierCurve(new THREE.Vector2(o,s),new THREE.Vector2(e,t),new THREE.Vector2(i,r));this.curves.push(l);this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:n})};THREE.Path.prototype.bezierCurveTo=function(e,t,i,r,n,a){var o=Array.prototype.slice.call(arguments);var s=this.actions[this.actions.length-1].args;var l=s[s.length-2];var h=s[s.length-1];var f=new THREE.CubicBezierCurve(new THREE.Vector2(l,h),new THREE.Vector2(e,t),new THREE.Vector2(i,r),new THREE.Vector2(n,a));this.curves.push(f);this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:o})};THREE.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments);var i=this.actions[this.actions.length-1].args;var r=i[i.length-2];var n=i[i.length-1];var a=[new THREE.Vector2(r,n)];Array.prototype.push.apply(a,e);var o=new THREE.SplineCurve(a);this.curves.push(o);this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:t})};THREE.Path.prototype.arc=function(e,t,i,r,n,a){var o=this.actions[this.actions.length-1].args;var s=o[o.length-2];var l=o[o.length-1];this.absarc(e+s,t+l,i,r,n,a)};THREE.Path.prototype.absarc=function(e,t,i,r,n,a){this.absellipse(e,t,i,i,r,n,a)};THREE.Path.prototype.ellipse=function(e,t,i,r,n,a,o){var s=this.actions[this.actions.length-1].args;var l=s[s.length-2];var h=s[s.length-1];this.absellipse(e+l,t+h,i,r,n,a,o)};THREE.Path.prototype.absellipse=function(e,t,i,r,n,a,o){var s=Array.prototype.slice.call(arguments);var l=new THREE.EllipseCurve(e,t,i,r,n,a,o);this.curves.push(l);var h=l.getPoint(o?1:0);s.push(h.x);s.push(h.y);this.actions.push({action:THREE.PathActions.ELLIPSE,args:s})};THREE.Path.prototype.getSpacedPoints=function(e,t){if(!e)e=40;var i=[];for(var r=0;r<e;r++){i.push(this.getPoint(r/e))}return i};THREE.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints){console.log("tata");return this.getSpacedPoints(e,t)}e=e||12;var i=[];var r,n,a,o,s;var l,h,f,c,u,d,p,m,E,g,v,T,y;for(r=0,n=this.actions.length;r<n;r++){a=this.actions[r];o=a.action;s=a.args;switch(o){case THREE.PathActions.MOVE_TO:i.push(new THREE.Vector2(s[0],s[1]));break;case THREE.PathActions.LINE_TO:i.push(new THREE.Vector2(s[0],s[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:l=s[2];h=s[3];u=s[0];d=s[1];if(i.length>0){E=i[i.length-1];p=E.x;m=E.y}else{E=this.actions[r-1].args;p=E[E.length-2];m=E[E.length-1]}for(g=1;g<=e;g++){v=g/e;T=THREE.Shape.Utils.b2(v,p,u,l);y=THREE.Shape.Utils.b2(v,m,d,h);i.push(new THREE.Vector2(T,y))}break;case THREE.PathActions.BEZIER_CURVE_TO:l=s[4];h=s[5];u=s[0];d=s[1];f=s[2];c=s[3];if(i.length>0){E=i[i.length-1];p=E.x;m=E.y}else{E=this.actions[r-1].args;p=E[E.length-2];m=E[E.length-1]}for(g=1;g<=e;g++){v=g/e;T=THREE.Shape.Utils.b3(v,p,u,f,l);y=THREE.Shape.Utils.b3(v,m,d,c,h);i.push(new THREE.Vector2(T,y))}break;case THREE.PathActions.CSPLINE_THRU:E=this.actions[r-1].args;var _=new THREE.Vector2(E[E.length-2],E[E.length-1]);var R=[_];var x=e*s[0].length;R=R.concat(s[0]);var b=new THREE.SplineCurve(R);for(g=1;g<=x;g++){i.push(b.getPointAt(g/x))}break;case THREE.PathActions.ARC:var H=s[0],w=s[1],M=s[2],S=s[3],A=s[4],C=!!s[5];var D=A-S;var P;var L=e*2;for(g=1;g<=L;g++){v=g/L;if(!C){v=1-v}P=S+v*D;T=H+M*Math.cos(P);y=w+M*Math.sin(P);i.push(new THREE.Vector2(T,y))}break;case THREE.PathActions.ELLIPSE:var H=s[0],w=s[1],F=s[2],O=s[3],S=s[4],A=s[5],C=!!s[6];var D=A-S;var P;var L=e*2;for(g=1;g<=L;g++){v=g/L;if(!C){v=1-v}P=S+v*D;T=H+F*Math.cos(P);y=w+O*Math.sin(P);i.push(new THREE.Vector2(T,y))}break}}var U=i[i.length-1];var N=1e-10;if(Math.abs(U.x-i[0].x)<N&&Math.abs(U.y-i[0].y)<N)i.splice(i.length-1,1);if(t){i.push(i[0])}return i};THREE.Path.prototype.toShapes=function(){var e,t,i,r,n;var a=[],o=new THREE.Path;for(e=0,t=this.actions.length;e<t;e++){i=this.actions[e];n=i.args;r=i.action;if(r==THREE.PathActions.MOVE_TO){if(o.actions.length!=0){a.push(o);o=new THREE.Path}}o[r].apply(o,n)}if(o.actions.length!=0){a.push(o)}if(a.length==0)return[];var s,l,h=[];var f=!THREE.Shape.Utils.isClockWise(a[0].getPoints());if(a.length==1){s=a[0];l=new THREE.Shape;l.actions=s.actions;l.curves=s.curves;h.push(l);return h}if(f){l=new THREE.Shape;for(e=0,t=a.length;e<t;e++){s=a[e];if(THREE.Shape.Utils.isClockWise(s.getPoints())){l.actions=s.actions;l.curves=s.curves;h.push(l);l=new THREE.Shape}else{l.holes.push(s)}}}else{for(e=0,t=a.length;e<t;e++){s=a[e];if(THREE.Shape.Utils.isClockWise(s.getPoints())){if(l)h.push(l);l=new THREE.Shape;l.actions=s.actions;l.curves=s.curves}else{l.holes.push(s)}}h.push(l)}return h};THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[]};THREE.Shape.prototype=Object.create(THREE.Path.prototype);THREE.Shape.prototype.extrude=function(e){var t=new THREE.ExtrudeGeometry(this,e);return t};THREE.Shape.prototype.makeGeometry=function(e){var t=new THREE.ShapeGeometry(this,e);return t};THREE.Shape.prototype.getPointsHoles=function(e){var t,i=this.holes.length,r=[];for(t=0;t<i;t++){r[t]=this.holes[t].getTransformedPoints(e,this.bends)}return r};THREE.Shape.prototype.getSpacedPointsHoles=function(e){var t,i=this.holes.length,r=[];for(t=0;t<i;t++){r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends)}return r};THREE.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}};THREE.Shape.prototype.extractPoints=function(e){if(this.useSpacedPoints){return this.extractAllSpacedPoints(e)}return this.extractAllPoints(e)};THREE.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}};THREE.Shape.Utils={removeHoles:function(e,t){var i=e.concat();var r=i.concat();var n,a,o,N,s,l,F,O,h,f,c,u,d,p,m,E,g,v,T,y,_=[];for(h=0;h<t.length;h++){c=t[h];Array.prototype.push.apply(r,c);u=Number.POSITIVE_INFINITY;for(f=0;f<c.length;f++){m=c[f];var R=[];for(p=0;p<i.length;p++){E=i[p];d=m.distanceToSquared(E);R.push(d);if(d<u){u=d;s=f;l=p}}}n=l-1>=0?l-1:i.length-1;o=s-1>=0?s-1:c.length-1;var x=[c[s],i[l],i[n]];var b=THREE.FontUtils.Triangulate.area(x);var H=[c[s],c[o],i[l]];var w=THREE.FontUtils.Triangulate.area(H);var M=1;var S=-1;var A=l,C=s;l+=M;s+=S;if(l<0){l+=i.length}l%=i.length;if(s<0){s+=c.length}s%=c.length;n=l-1>=0?l-1:i.length-1;o=s-1>=0?s-1:c.length-1;x=[c[s],i[l],i[n]];var D=THREE.FontUtils.Triangulate.area(x);H=[c[s],c[o],i[l]];var P=THREE.FontUtils.Triangulate.area(H);if(b+w>D+P){l=A;s=C;if(l<0){l+=i.length}l%=i.length;if(s<0){s+=c.length}s%=c.length;n=l-1>=0?l-1:i.length-1;o=s-1>=0?s-1:c.length-1}else{}g=i.slice(0,l);v=i.slice(l);T=c.slice(s);y=c.slice(0,s);var L=[c[s],i[l],i[n]];var U=[c[s],c[o],i[l]];_.push(L);_.push(U);i=g.concat(T).concat(y).concat(v)}return{shape:i,isolatedPts:_,allpoints:r}},triangulateShape:function(e,t){var i=THREE.Shape.Utils.removeHoles(e,t);var r=i.shape,n=i.allpoints,a=i.isolatedPts;var o=THREE.FontUtils.Triangulate(r,false);var s,l,h,f,c,u,d={},p={};for(s=0,l=n.length;s<l;s++){c=n[s].x+":"+n[s].y;if(d[c]!==undefined){console.log("Duplicate point",c)}d[c]=s}for(s=0,l=o.length;s<l;s++){f=o[s];for(h=0;h<3;h++){c=f[h].x+":"+f[h].y;u=d[c];if(u!==undefined){f[h]=u}}}for(s=0,l=a.length;s<l;s++){f=a[s];for(h=0;h<3;h++){c=f[h].x+":"+f[h].y;u=d[c];if(u!==undefined){f[h]=u}}}return o.concat(a)},isClockWise:function(e){return THREE.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var i=1-e;return i*i*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,i,r){return this.b2p0(e,t)+this.b2p1(e,i)+this.b2p2(e,r)},b3p0:function(e,t){var i=1-e;return i*i*i*t},b3p1:function(e,t){var i=1-e;return 3*i*i*e*t},b3p2:function(e,t){var i=1-e;return 3*i*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,i,r,n){return this.b3p0(e,t)+this.b3p1(e,i)+this.b3p2(e,r)+this.b3p3(e,n)}};THREE.AnimationHandler=function(){var i=[];var t={};var e={};e.update=function(e){for(var t=0;t<i.length;t++)i[t].update(e)};e.addToUpdate=function(e){if(i.indexOf(e)===-1)i.push(e)};e.removeFromUpdate=function(e){var t=i.indexOf(e);if(t!==-1)i.splice(t,1)};e.add=function(e){if(t[e.name]!==undefined)console.log("THREE.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting.");t[e.name]=e;n(e)};e.get=function(e){if(typeof e==="string"){if(t[e]){return t[e]}else{console.log("THREE.AnimationHandler.get: Couldn't find animation "+e);return null}}else{}};e.parse=function(e){var t=[];if(e instanceof THREE.SkinnedMesh){for(var i=0;i<e.bones.length;i++){t.push(e.bones[i])}}else{r(e,t)}return t};var r=function(e,t){t.push(e);for(var i=0;i<e.children.length;i++)r(e.children[i],t)};var n=function(e){if(e.initialized===true)return;for(var t=0;t<e.hierarchy.length;t++){for(var i=0;i<e.hierarchy[t].keys.length;i++){if(e.hierarchy[t].keys[i].time<0)e.hierarchy[t].keys[i].time=0;if(e.hierarchy[t].keys[i].rot!==undefined&&!(e.hierarchy[t].keys[i].rot instanceof THREE.Quaternion)){var r=e.hierarchy[t].keys[i].rot;e.hierarchy[t].keys[i].rot=new THREE.Quaternion(r[0],r[1],r[2],r[3])}}if(e.hierarchy[t].keys.length&&e.hierarchy[t].keys[0].morphTargets!==undefined){var n={};for(var i=0;i<e.hierarchy[t].keys.length;i++){for(var a=0;a<e.hierarchy[t].keys[i].morphTargets.length;a++){var o=e.hierarchy[t].keys[i].morphTargets[a];n[o]=-1}}e.hierarchy[t].usedMorphTargets=n;for(var i=0;i<e.hierarchy[t].keys.length;i++){var s={};for(var o in n){for(var a=0;a<e.hierarchy[t].keys[i].morphTargets.length;a++){if(e.hierarchy[t].keys[i].morphTargets[a]===o){s[o]=e.hierarchy[t].keys[i].morphTargetsInfluences[a];break}}if(a===e.hierarchy[t].keys[i].morphTargets.length){s[o]=0}}e.hierarchy[t].keys[i].morphTargetsInfluences=s}}for(var i=1;i<e.hierarchy[t].keys.length;i++){if(e.hierarchy[t].keys[i].time===e.hierarchy[t].keys[i-1].time){e.hierarchy[t].keys.splice(i,1);i--}}for(var i=0;i<e.hierarchy[t].keys.length;i++){e.hierarchy[t].keys[i].index=i}}var l=parseInt(e.length*e.fps,10);e.JIT={};e.JIT.hierarchy=[];for(var t=0;t<e.hierarchy.length;t++)e.JIT.hierarchy.push(new Array(l));e.initialized=true};e.LINEAR=0;e.CATMULLROM=1;e.CATMULLROM_FORWARD=2;return e}();THREE.Animation=function(e,t,i){this.root=e;this.data=THREE.AnimationHandler.get(t);this.hierarchy=THREE.AnimationHandler.parse(e);this.currentTime=0;this.timeScale=1;this.isPlaying=false;this.isPaused=true;this.loop=true;this.interpolationType=i!==undefined?i:THREE.AnimationHandler.LINEAR;this.points=[];this.target=new THREE.Vector3};THREE.Animation.prototype.play=function(e,t){if(this.isPlaying===false){this.isPlaying=true;this.loop=e!==undefined?e:true;this.currentTime=t!==undefined?t:0;var i,r=this.hierarchy.length,n;for(i=0;i<r;i++){n=this.hierarchy[i];if(this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD){n.useQuaternion=true}n.matrixAutoUpdate=true;if(n.animationCache===undefined){n.animationCache={};n.animationCache.prevKey={pos:0,rot:0,scl:0};n.animationCache.nextKey={pos:0,rot:0,scl:0};n.animationCache.originalMatrix=n instanceof THREE.Bone?n.skinMatrix:n.matrix}var a=n.animationCache.prevKey;var o=n.animationCache.nextKey;a.pos=this.data.hierarchy[i].keys[0];a.rot=this.data.hierarchy[i].keys[0];a.scl=this.data.hierarchy[i].keys[0];o.pos=this.getNextKeyWith("pos",i,1);o.rot=this.getNextKeyWith("rot",i,1);o.scl=this.getNextKeyWith("scl",i,1)}this.update(0)}this.isPaused=false;THREE.AnimationHandler.addToUpdate(this)};THREE.Animation.prototype.pause=function(){if(this.isPaused===true){THREE.AnimationHandler.addToUpdate(this)}else{THREE.AnimationHandler.removeFromUpdate(this)}this.isPaused=!this.isPaused};THREE.Animation.prototype.stop=function(){this.isPlaying=false;this.isPaused=false;THREE.AnimationHandler.removeFromUpdate(this)};THREE.Animation.prototype.update=function(e){if(this.isPlaying===false)return;var t=["pos","rot","scl"];var i;var r;var n;var a,o;var s,l;var h;var f;var c;var u=this.data.JIT.hierarchy;var d,p;var m,E,g;this.currentTime+=e*this.timeScale;p=this.currentTime;d=this.currentTime=this.currentTime%this.data.length;c=parseInt(Math.min(d*this.data.fps,this.data.length*this.data.fps),10);for(var v=0,T=this.hierarchy.length;v<T;v++){h=this.hierarchy[v];f=h.animationCache;for(var y=0;y<3;y++){i=t[y];s=f.prevKey[i];l=f.nextKey[i];if(l.time<=p){if(d<p){if(this.loop){s=this.data.hierarchy[v].keys[0];l=this.getNextKeyWith(i,v,1);while(l.time<d){s=l;l=this.getNextKeyWith(i,v,l.index+1)}}else{this.stop();return}}else{do{s=l;l=this.getNextKeyWith(i,v,l.index+1)}while(l.time<d)}f.prevKey[i]=s;f.nextKey[i]=l}h.matrixAutoUpdate=true;h.matrixWorldNeedsUpdate=true;r=(d-s.time)/(l.time-s.time);a=s[i];o=l[i];if(r<0||r>1){console.log("THREE.Animation.update: Warning! Scale out of bounds:"+r+" on bone "+v);r=r<0?0:1}if(i==="pos"){n=h.position;if(this.interpolationType===THREE.AnimationHandler.LINEAR){n.x=a[0]+(o[0]-a[0])*r;n.y=a[1]+(o[1]-a[1])*r;n.z=a[2]+(o[2]-a[2])*r}else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){this.points[0]=this.getPrevKeyWith("pos",v,s.index-1)["pos"];this.points[1]=a;this.points[2]=o;this.points[3]=this.getNextKeyWith("pos",v,l.index+1)["pos"];r=r*.33+.33;m=this.interpolateCatmullRom(this.points,r);n.x=m[0];n.y=m[1];n.z=m[2];if(this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){E=this.interpolateCatmullRom(this.points,r*1.01);this.target.set(E[0],E[1],E[2]);this.target.sub(n);this.target.y=0;this.target.normalize();g=Math.atan2(this.target.x,this.target.z);h.rotation.set(0,g,0)}}}else if(i==="rot"){THREE.Quaternion.slerp(a,o,h.quaternion,r)}else if(i==="scl"){n=h.scale;n.x=a[0]+(o[0]-a[0])*r;n.y=a[1]+(o[1]-a[1])*r;n.z=a[2]+(o[2]-a[2])*r}}}};THREE.Animation.prototype.interpolateCatmullRom=function(e,t){var i=[],r=[],n,a,o,s,l,h,f,c,u;n=(e.length-1)*t;a=Math.floor(n);o=n-a;i[0]=a===0?a:a-1;i[1]=a;i[2]=a>e.length-2?a:a+1;i[3]=a>e.length-3?a:a+2;h=e[i[0]];f=e[i[1]];c=e[i[2]];u=e[i[3]];s=o*o;l=o*s;r[0]=this.interpolate(h[0],f[0],c[0],u[0],o,s,l);r[1]=this.interpolate(h[1],f[1],c[1],u[1],o,s,l);r[2]=this.interpolate(h[2],f[2],c[2],u[2],o,s,l);return r};THREE.Animation.prototype.interpolate=function(e,t,i,r,n,a,o){var s=(i-e)*.5,l=(r-t)*.5;return(2*(t-i)+s+l)*o+(-3*(t-i)-2*s-l)*a+s*n+t};THREE.Animation.prototype.getNextKeyWith=function(e,t,i){var r=this.data.hierarchy[t].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){i=i<r.length-1?i:r.length-1}else{i=i%r.length}for(;i<r.length;i++){if(r[i][e]!==undefined){return r[i]}}return this.data.hierarchy[t].keys[0]};THREE.Animation.prototype.getPrevKeyWith=function(e,t,i){var r=this.data.hierarchy[t].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){i=i>0?i:0}else{i=i>=0?i:i+r.length}for(;i>=0;i--){if(r[i][e]!==undefined){return r[i]}}return this.data.hierarchy[t].keys[r.length-1]};THREE.KeyFrameAnimation=function(e,t,i){this.root=e;this.data=THREE.AnimationHandler.get(t);this.hierarchy=THREE.AnimationHandler.parse(e);this.currentTime=0;this.timeScale=.001;this.isPlaying=false;this.isPaused=true;this.loop=true;this.JITCompile=i!==undefined?i:true;for(var r=0,n=this.hierarchy.length;r<n;r++){var a=this.data.hierarchy[r].keys,o=this.data.hierarchy[r].sids,s=this.hierarchy[r];if(a.length&&o){for(var l=0;l<o.length;l++){var h=o[l],f=this.getNextKeyWith(h,r,0);if(f){f.apply(h)}}s.matrixAutoUpdate=false;this.data.hierarchy[r].node.updateMatrix();s.matrixWorldNeedsUpdate=true}}};THREE.KeyFrameAnimation.prototype.play=function(e,t){if(!this.isPlaying){this.isPlaying=true;this.loop=e!==undefined?e:true;this.currentTime=t!==undefined?t:0;this.startTimeMs=t;this.startTime=1e7;this.endTime=-this.startTime;var i,r=this.hierarchy.length,n,a;for(i=0;i<r;i++){n=this.hierarchy[i];a=this.data.hierarchy[i];n.useQuaternion=true;if(a.animationCache===undefined){a.animationCache={};a.animationCache.prevKey=null;a.animationCache.nextKey=null;a.animationCache.originalMatrix=n instanceof THREE.Bone?n.skinMatrix:n.matrix}var o=this.data.hierarchy[i].keys;if(o.length){a.animationCache.prevKey=o[0];a.animationCache.nextKey=o[1];this.startTime=Math.min(o[0].time,this.startTime);this.endTime=Math.max(o[o.length-1].time,this.endTime)}}this.update(0)}this.isPaused=false;THREE.AnimationHandler.addToUpdate(this)};THREE.KeyFrameAnimation.prototype.pause=function(){if(this.isPaused){THREE.AnimationHandler.addToUpdate(this)}else{THREE.AnimationHandler.removeFromUpdate(this)}this.isPaused=!this.isPaused};THREE.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=false;this.isPaused=false;THREE.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e];var i=this.data.hierarchy[e];if(i.animationCache!==undefined){var r=i.animationCache.originalMatrix;if(t instanceof THREE.Bone){r.copy(t.skinMatrix);t.skinMatrix=r}else{r.copy(t.matrix);t.matrix=r}delete i.animationCache}}};THREE.KeyFrameAnimation.prototype.update=function(e){if(!this.isPlaying)return;var t,i;var r;var n;var a;var o=this.data.JIT.hierarchy;var s,l;var h;this.currentTime+=e*this.timeScale;l=this.currentTime;s=this.currentTime=this.currentTime%this.data.length;if(s<this.startTimeMs){s=this.currentTime=this.startTimeMs+s}a=parseInt(Math.min(s*this.data.fps,this.data.length*this.data.fps),10);h=s<l;if(h&&!this.loop){for(var f=0,c=this.hierarchy.length;f<c;f++){var u=this.data.hierarchy[f].keys,d=this.data.hierarchy[f].sids,p=u.length-1,m=this.hierarchy[f];if(u.length){for(var E=0;E<d.length;E++){var g=d[E],v=this.getPrevKeyWith(g,f,p);if(v){v.apply(g)}}this.data.hierarchy[f].node.updateMatrix();m.matrixWorldNeedsUpdate=true}}this.stop();return}if(s<this.startTime){return}for(var f=0,c=this.hierarchy.length;f<c;f++){r=this.hierarchy[f];n=this.data.hierarchy[f];var u=n.keys,T=n.animationCache;if(this.JITCompile&&o[f][a]!==undefined){if(r instanceof THREE.Bone){r.skinMatrix=o[f][a];r.matrixWorldNeedsUpdate=false}else{r.matrix=o[f][a];r.matrixWorldNeedsUpdate=true}}else if(u.length){if(this.JITCompile&&T){if(r instanceof THREE.Bone){r.skinMatrix=T.originalMatrix}else{r.matrix=T.originalMatrix}}t=T.prevKey;i=T.nextKey;if(t&&i){if(i.time<=l){if(h&&this.loop){t=u[0];i=u[1];while(i.time<s){t=i;i=u[t.index+1]}}else if(!h){var y=u.length-1;while(i.time<s&&i.index!==y){t=i;i=u[t.index+1]}}T.prevKey=t;T.nextKey=i}if(i.time>=s)t.interpolate(i,s);else t.interpolate(i,i.time)}this.data.hierarchy[f].node.updateMatrix();r.matrixWorldNeedsUpdate=true}}if(this.JITCompile){if(o[0][a]===undefined){this.hierarchy[0].updateMatrixWorld(true);for(var f=0;f<this.hierarchy.length;f++){if(this.hierarchy[f]instanceof THREE.Bone){o[f][a]=this.hierarchy[f].skinMatrix.clone()}else{o[f][a]=this.hierarchy[f].matrix.clone()}}}}};THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,i){var r=this.data.hierarchy[t].keys;i=i%r.length;for(;i<r.length;i++){if(r[i].hasTarget(e)){return r[i]}}return r[0]};THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,i){var r=this.data.hierarchy[t].keys;i=i>=0?i:i+r.length;for(;i>=0;i--){if(r[i].hasTarget(e)){return r[i]}}return r[r.length-1]};THREE.CubeCamera=function(e,t,i){THREE.Object3D.call(this);var r=90,n=1;var a=new THREE.PerspectiveCamera(r,n,e,t);a.up.set(0,-1,0);a.lookAt(new THREE.Vector3(1,0,0));this.add(a);var o=new THREE.PerspectiveCamera(r,n,e,t);o.up.set(0,-1,0);o.lookAt(new THREE.Vector3(-1,0,0));this.add(o);var s=new THREE.PerspectiveCamera(r,n,e,t);s.up.set(0,0,1);s.lookAt(new THREE.Vector3(0,1,0));this.add(s);var l=new THREE.PerspectiveCamera(r,n,e,t);l.up.set(0,0,-1);l.lookAt(new THREE.Vector3(0,-1,0));this.add(l);var h=new THREE.PerspectiveCamera(r,n,e,t);h.up.set(0,-1,0);h.lookAt(new THREE.Vector3(0,0,1));this.add(h);var f=new THREE.PerspectiveCamera(r,n,e,t);f.up.set(0,-1,0);f.lookAt(new THREE.Vector3(0,0,-1));this.add(f);this.renderTarget=new THREE.WebGLRenderTargetCube(i,i,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updateCubeMap=function(e,t){var i=this.renderTarget;var r=i.generateMipmaps;i.generateMipmaps=false;i.activeCubeFace=0;e.render(t,a,i);i.activeCubeFace=1;e.render(t,o,i);i.activeCubeFace=2;e.render(t,s,i);i.activeCubeFace=3;e.render(t,l,i);i.activeCubeFace=4;e.render(t,h,i);i.generateMipmaps=r;i.activeCubeFace=5;e.render(t,f,i)}};THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);THREE.CombinedCamera=function(e,t,i,r,n,a,o){THREE.Camera.call(this);this.fov=i;this.left=-e/2;this.right=e/2;this.top=t/2;this.bottom=-t/2;this.cameraO=new THREE.OrthographicCamera(e/-2,e/2,t/2,t/-2,a,o);this.cameraP=new THREE.PerspectiveCamera(i,e/t,r,n);this.zoom=1;this.toPerspective();var s=e/t};THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype);THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near;this.far=this.cameraP.far;this.cameraP.fov=this.fov/this.zoom;this.cameraP.updateProjectionMatrix();this.projectionMatrix=this.cameraP.projectionMatrix;this.inPerspectiveMode=true;this.inOrthographicMode=false};THREE.CombinedCamera.prototype.toOrthographic=function(){var e=this.fov;var t=this.cameraP.aspect;var i=this.cameraP.near;var r=this.cameraP.far;var n=(i+r)/2;var a=Math.tan(e/2)*n;var o=2*a;var s=o*t;var l=s/2;a/=this.zoom;l/=this.zoom;this.cameraO.left=-l;this.cameraO.right=l;this.cameraO.top=a;this.cameraO.bottom=-a;this.cameraO.updateProjectionMatrix();this.near=this.cameraO.near;this.far=this.cameraO.far;this.projectionMatrix=this.cameraO.projectionMatrix;this.inPerspectiveMode=false;this.inOrthographicMode=true};THREE.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t;this.left=-e/2;this.right=e/2;this.top=t/2;this.bottom=-t/2};THREE.CombinedCamera.prototype.setFov=function(e){this.fov=e;if(this.inPerspectiveMode){this.toPerspective()}else{this.toOrthographic()}};THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){if(this.inPerspectiveMode){this.toPerspective()}else{this.toPerspective();this.toOrthographic()}};THREE.CombinedCamera.prototype.setLens=function(e,t){if(t===undefined)t=24;var i=2*THREE.Math.radToDeg(Math.atan(t/(e*2)));this.setFov(i);return i};THREE.CombinedCamera.prototype.setZoom=function(e){this.zoom=e;if(this.inPerspectiveMode){this.toPerspective()}else{this.toOrthographic()}};THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0;this.rotation.y=Math.PI;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0;this.rotation.y=-Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0;this.rotation.y=Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CircleGeometry=function(e,t,i,r){THREE.Geometry.call(this);e=e||50;i=i!==undefined?i:0;r=r!==undefined?r:Math.PI*2;t=t!==undefined?Math.max(3,t):8;var n,a=[],o=new THREE.Vector3,s=new THREE.Vector2(.5,.5);this.vertices.push(o);a.push(s);for(n=0;n<=t;n++){var l=new THREE.Vector3;var h=i+n/t*r;l.x=e*Math.cos(h);l.y=e*Math.sin(h);this.vertices.push(l);a.push(new THREE.Vector2((l.x/e+1)/2,(l.y/e+1)/2))}var f=new THREE.Vector3(0,0,1);for(n=1;n<=t;n++){var c=n;var u=n+1;var d=0;this.faces.push(new THREE.Face3(c,u,d,[f,f,f]));this.faceVertexUvs[0].push([a[n],a[n+1],s])}this.computeCentroids();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)};THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CubeGeometry=function(e,t,i,r,n,a){THREE.Geometry.call(this);var M=this;this.width=e;this.height=t;this.depth=i;this.widthSegments=r||1;this.heightSegments=n||1;this.depthSegments=a||1;var o=this.width/2;var s=this.height/2;var l=this.depth/2;h("z","y",-1,-1,this.depth,this.height,o,0);h("z","y",1,-1,this.depth,this.height,-o,1);h("x","z",1,1,this.width,this.depth,s,2);h("x","z",1,-1,this.width,this.depth,-s,3);h("x","y",1,-1,this.width,this.height,l,4);h("x","y",-1,-1,this.width,this.height,-l,5);function h(e,t,i,r,n,a,o,s){var l,h,f,c=M.widthSegments,u=M.heightSegments,d=n/2,p=a/2,m=M.vertices.length;if(e==="x"&&t==="y"||e==="y"&&t==="x"){l="z"}else if(e==="x"&&t==="z"||e==="z"&&t==="x"){l="y";u=M.depthSegments}else if(e==="z"&&t==="y"||e==="y"&&t==="z"){l="x";c=M.depthSegments}var E=c+1,g=u+1,v=n/c,T=a/u,y=new THREE.Vector3;y[l]=o>0?1:-1;for(f=0;f<g;f++){for(h=0;h<E;h++){var _=new THREE.Vector3;_[e]=(h*v-d)*i;_[t]=(f*T-p)*r;_[l]=o;M.vertices.push(_)}}for(f=0;f<u;f++){for(h=0;h<c;h++){var R=h+E*f;var x=h+E*(f+1);var b=h+1+E*(f+1);var H=h+1+E*f;var w=new THREE.Face4(R+m,x+m,b+m,H+m);w.normal.copy(y);w.vertexNormals.push(y.clone(),y.clone(),y.clone(),y.clone());w.materialIndex=s;M.faces.push(w);M.faceVertexUvs[0].push([new THREE.Vector2(h/c,1-f/u),new THREE.Vector2(h/c,1-(f+1)/u),new THREE.Vector2((h+1)/c,1-(f+1)/u),new THREE.Vector2((h+1)/c,1-f/u)])}}}this.computeCentroids();this.mergeVertices()};THREE.BoxGeometry=THREE.CubeGeometry;THREE.CubeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CylinderGeometry=function(e,t,i,r,n,a){THREE.Geometry.call(this);this.radiusTop=e=e!==undefined?e:20;this.radiusBottom=t=t!==undefined?t:20;this.height=i=i!==undefined?i:100;this.radiusSegments=r=r||8;this.heightSegments=n=n||1;this.openEnded=a=a!==undefined?a:false;var o=i/2;var s,l,h=[],f=[];for(l=0;l<=n;l++){var c=[];var u=[];var d=l/n;var p=d*(t-e)+e;for(s=0;s<=r;s++){var m=s/r;var E=new THREE.Vector3;E.x=p*Math.sin(m*Math.PI*2);E.y=-d*i+o;E.z=p*Math.cos(m*Math.PI*2);this.vertices.push(E);c.push(this.vertices.length-1);u.push(new THREE.Vector2(m,1-d))}h.push(c);f.push(u)}var g=(t-e)/i;var v,T;for(s=0;s<r;s++){if(e!==0){v=this.vertices[h[0][s]].clone();T=this.vertices[h[0][s+1]].clone()}else{v=this.vertices[h[1][s]].clone();T=this.vertices[h[1][s+1]].clone()}v.setY(Math.sqrt(v.x*v.x+v.z*v.z)*g).normalize();T.setY(Math.sqrt(T.x*T.x+T.z*T.z)*g).normalize();for(l=0;l<n;l++){var y=h[l][s];var _=h[l+1][s];var R=h[l+1][s+1];var x=h[l][s+1];var b=v.clone();var H=v.clone();var w=T.clone();var M=T.clone();var S=f[l][s].clone();var A=f[l+1][s].clone();var C=f[l+1][s+1].clone();var D=f[l][s+1].clone();this.faces.push(new THREE.Face4(y,_,R,x,[b,H,w,M]));this.faceVertexUvs[0].push([S,A,C,D])}}if(a===false&&e>0){this.vertices.push(new THREE.Vector3(0,o,0));for(s=0;s<r;s++){var y=h[0][s];var _=h[0][s+1];var R=this.vertices.length-1;var b=new THREE.Vector3(0,1,0);var H=new THREE.Vector3(0,1,0);var w=new THREE.Vector3(0,1,0);var S=f[0][s].clone();var A=f[0][s+1].clone();var C=new THREE.Vector2(A.u,0);this.faces.push(new THREE.Face3(y,_,R,[b,H,w]));this.faceVertexUvs[0].push([S,A,C])}}if(a===false&&t>0){this.vertices.push(new THREE.Vector3(0,-o,0));for(s=0;s<r;s++){var y=h[l][s+1];var _=h[l][s];var R=this.vertices.length-1;var b=new THREE.Vector3(0,-1,0);var H=new THREE.Vector3(0,-1,0);var w=new THREE.Vector3(0,-1,0);var S=f[l][s+1].clone();var A=f[l][s].clone();var C=new THREE.Vector2(A.u,1);this.faces.push(new THREE.Face3(y,_,R,[b,H,w]));this.faceVertexUvs[0].push([S,A,C])}}this.computeCentroids();this.computeFaceNormals()};THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry=function(e,t){if(typeof e==="undefined"){e=[];return}THREE.Geometry.call(this);e=e instanceof Array?e:[e];this.shapebb=e[e.length-1].getBoundingBox();this.addShapeList(e,t);this.computeCentroids();this.computeFaceNormals()};THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry.prototype.addShapeList=function(e,t){var i=e.length;for(var r=0;r<i;r++){var n=e[r];this.addShape(n,t)}};THREE.ExtrudeGeometry.prototype.addShape=function(f,c){var F=c.amount!==undefined?c.amount:100;var e=c.bevelThickness!==undefined?c.bevelThickness:6;var t=c.bevelSize!==undefined?c.bevelSize:e-2;var u=c.bevelSegments!==undefined?c.bevelSegments:3;var i=c.bevelEnabled!==undefined?c.bevelEnabled:true;var O=c.curveSegments!==undefined?c.curveSegments:12;var d=c.steps!==undefined?c.steps:1;var z=c.extrudePath;var r,I=false;var V=c.material;var k=c.extrudeMaterial;var B=c.UVGenerator!==undefined?c.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator;var j=this.shapebb;var n,a,o,s;if(z){r=z.getSpacedPoints(d);I=true;i=false;n=c.frames!==undefined?c.frames:new THREE.TubeGeometry.FrenetFrames(z,d,false);a=new THREE.Vector3;o=new THREE.Vector3;s=new THREE.Vector3}if(!i){u=0;e=0;t=0}var l,h,p;var m=this;var G=[];var E=this.vertices.length;var W=f.extractPoints(O);var g=W.shape;var v=W.holes;var X=!THREE.Shape.Utils.isClockWise(g);if(X){g=g.reverse();for(h=0,p=v.length;h<p;h++){l=v[h];if(THREE.Shape.Utils.isClockWise(l)){v[h]=l.reverse()}}X=false}var T=THREE.Shape.Utils.triangulateShape(g,v);var y=g;for(h=0,p=v.length;h<p;h++){l=v[h];g=g.concat(l)}function _(e,t,i){return t.clone().multiplyScalar(i).add(e)}var R,x,b,H,w,M=g.length,S,q=T.length,Y,$=y.length;var K=180/Math.PI;function Q(e,t,i){return J(e,t,i)}function Z(e,t,i){var r=Math.atan2(t.y-e.y,t.x-e.x);var n=Math.atan2(i.y-e.y,i.x-e.x);if(r>n){n+=Math.PI*2}var a=(r+n)/2;var o=-Math.cos(a);var s=-Math.sin(a);var l=new THREE.Vector2(o,s);return l}function J(e,t,i){var r=THREE.ExtrudeGeometry.__v1,n=THREE.ExtrudeGeometry.__v2,a=THREE.ExtrudeGeometry.__v3,o=THREE.ExtrudeGeometry.__v4,s=THREE.ExtrudeGeometry.__v5,l=THREE.ExtrudeGeometry.__v6,h,f,c,u,d,p;r.set(e.x-t.x,e.y-t.y);n.set(e.x-i.x,e.y-i.y);h=r.normalize();f=n.normalize();a.set(-h.y,h.x);o.set(f.y,-f.x);s.copy(e).add(a);l.copy(e).add(o);if(s.equals(l)){return o.clone()}s.copy(t).add(a);l.copy(i).add(o);c=h.dot(o);u=l.sub(s).dot(o);d=u/c;if(d<0){return Z(e,t,i)}p=h.multiplyScalar(d).add(s);return p.sub(e).clone()}var ee=[];for(var A=0,C=y.length,D=C-1,P=A+1;A<C;A++,D++,P++){if(D===C)D=0;if(P===C)P=0;var te=y[A];var ie=y[D];var re=y[P];ee[A]=Q(y[A],y[D],y[P])}var ne=[],L,ae=ee.concat();for(h=0,p=v.length;h<p;h++){l=v[h];L=[];for(A=0,C=l.length,D=C-1,P=A+1;A<C;A++,D++,P++){if(D===C)D=0;if(P===C)P=0;L[A]=Q(l[A],l[D],l[P])}ne.push(L);ae=ae.concat(L)}for(R=0;R<u;R++){b=R/u;H=e*(1-b);x=t*Math.sin(b*Math.PI/2);for(A=0,C=y.length;A<C;A++){w=_(y[A],ee[A],x);N(w.x,w.y,-H)}for(h=0,p=v.length;h<p;h++){l=v[h];L=ne[h];for(A=0,C=l.length;A<C;A++){w=_(l[A],L[A],x);N(w.x,w.y,-H)}}}x=t;for(A=0;A<M;A++){w=i?_(g[A],ae[A],x):g[A];if(!I){N(w.x,w.y,0)}else{o.copy(n.normals[0]).multiplyScalar(w.x);a.copy(n.binormals[0]).multiplyScalar(w.y);s.copy(r[0]).add(o).add(a);N(s.x,s.y,s.z)}}var U;for(U=1;U<=d;U++){for(A=0;A<M;A++){w=i?_(g[A],ae[A],x):g[A];if(!I){N(w.x,w.y,F/d*U)}else{o.copy(n.normals[U]).multiplyScalar(w.x);a.copy(n.binormals[U]).multiplyScalar(w.y);s.copy(r[U]).add(o).add(a);N(s.x,s.y,s.z)}}}for(R=u-1;R>=0;R--){b=R/u;H=e*(1-b);x=t*Math.sin(b*Math.PI/2);for(A=0,C=y.length;A<C;A++){w=_(y[A],ee[A],x);N(w.x,w.y,F+H)}for(h=0,p=v.length;h<p;h++){l=v[h];L=ne[h];for(A=0,C=l.length;A<C;A++){w=_(l[A],L[A],x);if(!I){N(w.x,w.y,F+H)}else{N(w.x,w.y+r[d-1].y,r[d-1].x+H)}}}}oe();se();function oe(){if(i){var e=0;var t=M*e;for(A=0;A<q;A++){S=T[A];he(S[2]+t,S[1]+t,S[0]+t,true)}e=d+u*2;t=M*e;for(A=0;A<q;A++){S=T[A];he(S[0]+t,S[1]+t,S[2]+t,false)}}else{for(A=0;A<q;A++){S=T[A];he(S[2],S[1],S[0],true)}for(A=0;A<q;A++){S=T[A];he(S[0]+M*d,S[1]+M*d,S[2]+M*d,false)}}}function se(){var e=0;le(y,e);e+=y.length;for(h=0,p=v.length;h<p;h++){l=v[h];le(l,e);e+=l.length}}function le(e,t){var i,r;A=e.length;while(--A>=0){i=A;r=A-1;if(r<0)r=e.length-1;var n=0,a=d+u*2;for(n=0;n<a;n++){var o=M*n;var s=M*(n+1);var l=t+i+o,h=t+r+o,f=t+r+s,c=t+i+s;fe(l,h,f,c,e,n,a,i,r)}}}function N(e,t,i){m.vertices.push(new THREE.Vector3(e,t,i))}function he(e,t,i,r){e+=E;t+=E;i+=E;m.faces.push(new THREE.Face3(e,t,i,null,null,V));var n=r?B.generateBottomUV(m,f,c,e,t,i):B.generateTopUV(m,f,c,e,t,i);m.faceVertexUvs[0].push(n)}function fe(e,t,i,r,n,a,o,s,l){e+=E;t+=E;i+=E;r+=E;m.faces.push(new THREE.Face4(e,t,i,r,null,null,k));var h=B.generateSideWallUV(m,f,n,c,e,t,i,r,a,o,s,l);m.faceVertexUvs[0].push(h)}};THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,i,r,n,a){var o=e.vertices[r].x,s=e.vertices[r].y,l=e.vertices[n].x,h=e.vertices[n].y,f=e.vertices[a].x,c=e.vertices[a].y;return[new THREE.Vector2(o,s),new THREE.Vector2(l,h),new THREE.Vector2(f,c)]},generateBottomUV:function(e,t,i,r,n,a){return this.generateTopUV(e,t,i,r,n,a)},generateSideWallUV:function(e,t,i,r,n,a,o,s,l,h,f,c){var u=e.vertices[n].x,d=e.vertices[n].y,p=e.vertices[n].z,m=e.vertices[a].x,E=e.vertices[a].y,g=e.vertices[a].z,v=e.vertices[o].x,T=e.vertices[o].y,y=e.vertices[o].z,_=e.vertices[s].x,R=e.vertices[s].y,x=e.vertices[s].z;if(Math.abs(d-E)<.01){return[new THREE.Vector2(u,1-p),new THREE.Vector2(m,1-g),new THREE.Vector2(v,1-y),new THREE.Vector2(_,1-x)]}else{return[new THREE.Vector2(d,1-p),new THREE.Vector2(E,1-g),new THREE.Vector2(T,1-y),new THREE.Vector2(R,1-x)]}}};THREE.ExtrudeGeometry.__v1=new THREE.Vector2;THREE.ExtrudeGeometry.__v2=new THREE.Vector2;THREE.ExtrudeGeometry.__v3=new THREE.Vector2;THREE.ExtrudeGeometry.__v4=new THREE.Vector2;THREE.ExtrudeGeometry.__v5=new THREE.Vector2;THREE.ExtrudeGeometry.__v6=new THREE.Vector2;THREE.ShapeGeometry=function(e,t){THREE.Geometry.call(this);if(e instanceof Array===false)e=[e];this.shapebb=e[e.length-1].getBoundingBox();this.addShapeList(e,t);this.computeCentroids();this.computeFaceNormals()};THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ShapeGeometry.prototype.addShapeList=function(e,t){for(var i=0,r=e.length;i<r;i++){this.addShape(e[i],t)}return this};THREE.ShapeGeometry.prototype.addShape=function(e,t){if(t===undefined)t={};var i=t.curveSegments!==undefined?t.curveSegments:12;var r=t.material;var n=t.UVGenerator===undefined?THREE.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator;var a=this.shapebb;var o,s,l,h;var f=this.vertices.length;var c=e.extractPoints(i);var u=c.shape;var d=c.holes;var p=!THREE.Shape.Utils.isClockWise(u);if(p){u=u.reverse();for(o=0,s=d.length;o<s;o++){l=d[o];if(THREE.Shape.Utils.isClockWise(l)){d[o]=l.reverse()}}p=false}var m=THREE.Shape.Utils.triangulateShape(u,d);var E=u;for(o=0,s=d.length;o<s;o++){l=d[o];u=u.concat(l)}var g,v=u.length;var T,y=m.length;var _,R=E.length;for(o=0;o<v;o++){g=u[o];this.vertices.push(new THREE.Vector3(g.x,g.y,0))}for(o=0;o<y;o++){T=m[o];var x=T[0]+f;var b=T[1]+f;var H=T[2]+f;this.faces.push(new THREE.Face3(x,b,H,null,null,r));this.faceVertexUvs[0].push(n.generateBottomUV(this,e,t,x,b,H))}};THREE.LatheGeometry=function(e,t,i,r){THREE.Geometry.call(this);t=t||12;i=i||0;r=r||2*Math.PI;var n=1/(e.length-1);var a=1/t;for(var o=0,s=t;o<=s;o++){var l=i+o*a*r;var h=Math.cos(l),f=Math.sin(l);for(var c=0,u=e.length;c<u;c++){var d=e[c];var p=new THREE.Vector3;p.x=h*d.x-f*d.y;p.y=f*d.x+h*d.y;p.z=d.z;this.vertices.push(p)}}var m=e.length;for(var o=0,s=t;o<s;o++){for(var c=0,u=e.length-1;c<u;c++){var E=c+m*o;var g=E;var v=E+m;var h=E+1+m;var T=E+1;this.faces.push(new THREE.Face4(g,v,h,T));var y=o*a;var _=c*n;var R=y+a;var x=_+n;this.faceVertexUvs[0].push([new THREE.Vector2(y,_),new THREE.Vector2(R,_),new THREE.Vector2(R,x),new THREE.Vector2(y,x)])}}this.mergeVertices();this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PlaneGeometry=function(e,t,i,r){THREE.Geometry.call(this);this.width=e;this.height=t;this.widthSegments=i||1;this.heightSegments=r||1;var n,a;var o=e/2;var s=t/2;var l=this.widthSegments;var h=this.heightSegments;var f=l+1;var c=h+1;var u=this.width/l;var d=this.height/h;var p=new THREE.Vector3(0,0,1);for(a=0;a<c;a++){for(n=0;n<f;n++){var m=n*u-o;var E=a*d-s;this.vertices.push(new THREE.Vector3(m,-E,0))}}for(a=0;a<h;a++){for(n=0;n<l;n++){var g=n+f*a;var v=n+f*(a+1);var T=n+1+f*(a+1);var y=n+1+f*a;var _=new THREE.Face4(g,v,T,y);_.normal.copy(p);_.vertexNormals.push(p.clone(),p.clone(),p.clone(),p.clone());this.faces.push(_);this.faceVertexUvs[0].push([new THREE.Vector2(n/l,1-a/h),new THREE.Vector2(n/l,1-(a+1)/h),new THREE.Vector2((n+1)/l,1-(a+1)/h),new THREE.Vector2((n+1)/l,1-a/h)])}}this.computeCentroids()};THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.RingGeometry=function(e,t,i,r,n,a){THREE.Geometry.call(this);e=e||0;t=t||50;n=n!==undefined?n:0;a=a!==undefined?a:Math.PI*2;i=i!==undefined?Math.max(3,i):8;r=r!==undefined?Math.max(1,r):8;var o,s,l=[],h=e,f=(t-e)/r;for(o=0;o<=r;o++){for(s=0;s<=i;s++){var c=new THREE.Vector3;var u=n+s/i*a;c.x=h*Math.cos(u);c.y=h*Math.sin(u);this.vertices.push(c);l.push(new THREE.Vector2(s/i,1-o/r))}h+=f}var d=new THREE.Vector3(0,0,1);for(let e=0;e<r;e++){const p=e*(i+1);for(let e=0;e<i;e++){const u=e+p;const m=u;const E=u+i+1;const g=u+i+2;const v=u+1;this.faces.push(new THREE.Face3(m,E,v,[d,d,d]));this.faceVertexUvs[0].push([l[m],l[E],l[v]]);this.faces.push(new THREE.Face3(E,g,v,[d,d,d]));this.faceVertexUvs[0].push([l[E],l[g],l[v]])}}this.computeCentroids();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,h)};THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.SphereGeometry=function(e,t,i,r,n,a,o){THREE.Geometry.call(this);this.radius=e=e||50;this.widthSegments=t=Math.max(3,Math.floor(t)||8);this.heightSegments=i=Math.max(2,Math.floor(i)||6);this.phiStart=r=r!==undefined?r:0;this.phiLength=n=n!==undefined?n:Math.PI*2;this.thetaStart=a=a!==undefined?a:0;this.thetaLength=o=o!==undefined?o:Math.PI;var s,l,h=[],f=[];for(l=0;l<=i;l++){var c=[];var u=[];for(s=0;s<=t;s++){var d=s/t;var p=l/i;var m=new THREE.Vector3;m.x=-e*Math.cos(r+d*n)*Math.sin(a+p*o);m.y=e*Math.cos(a+p*o);m.z=e*Math.sin(r+d*n)*Math.sin(a+p*o);this.vertices.push(m);c.push(this.vertices.length-1);u.push(new THREE.Vector2(d,1-p))}h.push(c);f.push(u)}for(l=0;l<this.heightSegments;l++){for(s=0;s<this.widthSegments;s++){var E=h[l][s+1];var g=h[l][s];var v=h[l+1][s];var T=h[l+1][s+1];var y=this.vertices[E].clone().normalize();var _=this.vertices[g].clone().normalize();var R=this.vertices[v].clone().normalize();var x=this.vertices[T].clone().normalize();var b=f[l][s+1].clone();var H=f[l][s].clone();var w=f[l+1][s].clone();var M=f[l+1][s+1].clone();if(Math.abs(this.vertices[E].y)===this.radius){this.faces.push(new THREE.Face3(E,v,T,[y,R,x]));this.faceVertexUvs[0].push([b,w,M])}else if(Math.abs(this.vertices[v].y)===this.radius){this.faces.push(new THREE.Face3(E,g,v,[y,_,R]));this.faceVertexUvs[0].push([b,H,w])}else{this.faces.push(new THREE.Face4(E,g,v,T,[y,_,R,x]));this.faceVertexUvs[0].push([b,H,w,M])}}}this.computeCentroids();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)};THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TextGeometry=function(e,t){t=t||{};var i=THREE.FontUtils.generateShapes(e,t);t.amount=t.height!==undefined?t.height:50;if(t.bevelThickness===undefined)t.bevelThickness=10;if(t.bevelSize===undefined)t.bevelSize=8;if(t.bevelEnabled===undefined)t.bevelEnabled=false;THREE.ExtrudeGeometry.call(this,i,t)};THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype);THREE.TorusGeometry=function(e,t,i,r,n){THREE.Geometry.call(this);var a=this;this.radius=e||100;this.tube=t||40;this.radialSegments=i||8;this.tubularSegments=r||6;this.arc=n||Math.PI*2;var o=new THREE.Vector3,s=[],l=[];for(var h=0;h<=this.radialSegments;h++){for(var f=0;f<=this.tubularSegments;f++){var c=f/this.tubularSegments*this.arc;var u=h/this.radialSegments*Math.PI*2;o.x=this.radius*Math.cos(c);o.y=this.radius*Math.sin(c);var d=new THREE.Vector3;d.x=(this.radius+this.tube*Math.cos(u))*Math.cos(c);d.y=(this.radius+this.tube*Math.cos(u))*Math.sin(c);d.z=this.tube*Math.sin(u);this.vertices.push(d);s.push(new THREE.Vector2(f/this.tubularSegments,h/this.radialSegments));l.push(d.clone().sub(o).normalize())}}for(var h=1;h<=this.radialSegments;h++){for(var f=1;f<=this.tubularSegments;f++){var p=(this.tubularSegments+1)*h+f-1;var m=(this.tubularSegments+1)*(h-1)+f-1;var E=(this.tubularSegments+1)*(h-1)+f;var g=(this.tubularSegments+1)*h+f;var v=new THREE.Face4(p,m,E,g,[l[p],l[m],l[E],l[g]]);v.normal.add(l[p]);v.normal.add(l[m]);v.normal.add(l[E]);v.normal.add(l[g]);v.normal.normalize();this.faces.push(v);this.faceVertexUvs[0].push([s[p].clone(),s[m].clone(),s[E].clone(),s[g].clone()])}}this.computeCentroids()};THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusKnotGeometry=function(e,t,i,r,n,a,o){THREE.Geometry.call(this);var s=this;this.radius=e||100;this.tube=t||40;this.radialSegments=i||64;this.tubularSegments=r||8;this.p=n||2;this.q=a||3;this.heightScale=o||1;this.grid=new Array(this.radialSegments);var l=new THREE.Vector3;var h=new THREE.Vector3;var f=new THREE.Vector3;for(var c=0;c<this.radialSegments;++c){this.grid[c]=new Array(this.tubularSegments);for(var u=0;u<this.tubularSegments;++u){var d=c/this.radialSegments*2*this.p*Math.PI;var p=u/this.tubularSegments*2*Math.PI;var m=C(d,p,this.q,this.p,this.radius,this.heightScale);var E=C(d+.01,p,this.q,this.p,this.radius,this.heightScale);var g,v;l.subVectors(E,m);h.addVectors(E,m);f.crossVectors(l,h);h.crossVectors(f,l);f.normalize();h.normalize();g=-this.tube*Math.cos(p);v=this.tube*Math.sin(p);m.x+=g*h.x+v*f.x;m.y+=g*h.y+v*f.y;m.z+=g*h.z+v*f.z;this.grid[c][u]=A(m.x,m.y,m.z)}}for(var c=0;c<this.radialSegments;++c){for(var u=0;u<this.tubularSegments;++u){var T=(c+1)%this.radialSegments;var y=(u+1)%this.tubularSegments;var _=this.grid[c][u];var R=this.grid[T][u];var x=this.grid[T][y];var b=this.grid[c][y];var H=new THREE.Vector2(c/this.radialSegments,u/this.tubularSegments);var w=new THREE.Vector2((c+1)/this.radialSegments,u/this.tubularSegments);var M=new THREE.Vector2((c+1)/this.radialSegments,(u+1)/this.tubularSegments);var S=new THREE.Vector2(c/this.radialSegments,(u+1)/this.tubularSegments);this.faces.push(new THREE.Face4(_,R,x,b));this.faceVertexUvs[0].push([H,w,M,S])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals();function A(e,t,i){return s.vertices.push(new THREE.Vector3(e,t,i))-1}function C(e,t,i,r,n,a){var o=Math.cos(e);var s=Math.cos(t);var l=Math.sin(e);var h=i/r*e;var f=Math.cos(h);var c=n*(2+f)*.5*o;var u=n*(2+f)*l*.5;var d=a*n*Math.sin(h)*.5;return new THREE.Vector3(c,u,d)}};THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry=function(e,t,i,r,n,a){THREE.Geometry.call(this);this.path=e;this.segments=t||64;this.radius=i||1;this.radiusSegments=r||8;this.closed=n||false;if(a)this.debug=new THREE.Object3D;this.grid=[];var o=this,s,l,h,f=this.segments+1,c,N,F,O,z,I,u,d,p,m,E,g=new THREE.Vector3,v,T,y,_,R,x,b,H,w,M,S,A;var C=new THREE.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed),D=C.tangents,P=C.normals,L=C.binormals;this.tangents=D;this.normals=P;this.binormals=L;function U(e,t,i){return o.vertices.push(new THREE.Vector3(e,t,i))-1}for(v=0;v<f;v++){this.grid[v]=[];u=v/(f-1);E=e.getPointAt(u);s=D[v];l=P[v];h=L[v];if(this.debug){this.debug.add(new THREE.ArrowHelper(s,E,i,255));this.debug.add(new THREE.ArrowHelper(l,E,i,16711680));this.debug.add(new THREE.ArrowHelper(h,E,i,65280))}for(T=0;T<this.radiusSegments;T++){d=T/this.radiusSegments*2*Math.PI;p=-this.radius*Math.cos(d);m=this.radius*Math.sin(d);g.copy(E);g.x+=p*l.x+m*h.x;g.y+=p*l.y+m*h.y;g.z+=p*l.z+m*h.z;this.grid[v][T]=U(g.x,g.y,g.z)}}for(v=0;v<this.segments;v++){for(T=0;T<this.radiusSegments;T++){y=this.closed?(v+1)%this.segments:v+1;_=(T+1)%this.radiusSegments;R=this.grid[v][T];x=this.grid[y][T];b=this.grid[y][_];H=this.grid[v][_];w=new THREE.Vector2(v/this.segments,T/this.radiusSegments);M=new THREE.Vector2((v+1)/this.segments,T/this.radiusSegments);S=new THREE.Vector2((v+1)/this.segments,(T+1)/this.radiusSegments);A=new THREE.Vector2(v/this.segments,(T+1)/this.radiusSegments);this.faces.push(new THREE.Face4(R,x,b,H));this.faceVertexUvs[0].push([w,M,S,A])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry.FrenetFrames=function(t,e,i){var r=new THREE.Vector3,n=new THREE.Vector3,a=new THREE.Vector3,o=[],s=[],l=[],h=new THREE.Vector3,f=new THREE.Matrix4,c=e+1,u,d=1e-4,p,m,E,g,v,T,y;this.tangents=o;this.normals=s;this.binormals=l;for(v=0;v<c;v++){T=v/(c-1);o[v]=t.getTangentAt(T);o[v].normalize()}x();function _(e){s[0]=new THREE.Vector3;l[0]=new THREE.Vector3;if(e===undefined)e=new THREE.Vector3(0,0,1);s[0].crossVectors(e,o[0]).normalize();l[0].crossVectors(o[0],s[0]).normalize()}function R(){var e=t.getTangentAt(d);s[0]=(new THREE.Vector3).subVectors(e,o[0]).normalize();l[0]=(new THREE.Vector3).crossVectors(o[0],s[0]);s[0].crossVectors(l[0],o[0]).normalize();l[0].crossVectors(o[0],s[0]).normalize()}function x(){s[0]=new THREE.Vector3;l[0]=new THREE.Vector3;p=Number.MAX_VALUE;m=Math.abs(o[0].x);E=Math.abs(o[0].y);g=Math.abs(o[0].z);if(m<=p){p=m;n.set(1,0,0)}if(E<=p){p=E;n.set(0,1,0)}if(g<=p){n.set(0,0,1)}h.crossVectors(o[0],n).normalize();s[0].crossVectors(o[0],h);l[0].crossVectors(o[0],s[0])}for(v=1;v<c;v++){s[v]=s[v-1].clone();l[v]=l[v-1].clone();h.crossVectors(o[v-1],o[v]);if(h.length()>d){h.normalize();u=Math.acos(o[v-1].dot(o[v]));s[v].applyMatrix4(f.makeRotationAxis(h,u))}l[v].crossVectors(o[v],s[v])}if(i){u=Math.acos(s[0].dot(s[c-1]));u/=c-1;if(o[0].dot(h.crossVectors(s[0],s[c-1]))>0){u=-u}for(v=1;v<c;v++){s[v].applyMatrix4(f.makeRotationAxis(o[v],u*v));l[v].crossVectors(o[v],s[v])}}};THREE.PolyhedronGeometry=function(e,t,i,r){THREE.Geometry.call(this);i=i||1;r=r||0;var p=this;for(var n=0,a=e.length;n<a;n++){T(new THREE.Vector3(e[n][0],e[n][1],e[n][2]))}var o=[],s=this.vertices;var l=[];for(var n=0,a=t.length;n<a;n++){var h=s[t[n][0]];var f=s[t[n][1]];var c=s[t[n][2]];l[n]=new THREE.Face3(h.index,f.index,c.index,[h.clone(),f.clone(),c.clone()])}for(var n=0,a=l.length;n<a;n++){_(l[n],r)}for(var n=0,a=this.faceVertexUvs[0].length;n<a;n++){var u=this.faceVertexUvs[0][n];var d=u[0].x;var m=u[1].x;var E=u[2].x;var g=Math.max(d,Math.max(m,E));var v=Math.min(d,Math.min(m,E));if(g>.9&&v<.1){if(d<.2)u[0].x+=1;if(m<.2)u[1].x+=1;if(E<.2)u[2].x+=1}}this.mergeVertices();for(var n=0,a=this.vertices.length;n<a;n++){this.vertices[n].multiplyScalar(i)}function T(e){var t=e.normalize().clone();t.index=p.vertices.push(t)-1;var i=R(e)/2/Math.PI+.5;var r=x(e)/Math.PI+.5;t.uv=new THREE.Vector2(i,1-r);return t}function y(e,t,i){var r=new THREE.Face3(e.index,t.index,i.index,[e.clone(),t.clone(),i.clone()]);r.centroid.add(e).add(t).add(i).divideScalar(3);r.normal.copy(r.centroid).normalize();p.faces.push(r);var n=R(r.centroid);p.faceVertexUvs[0].push([b(e.uv,e,n),b(t.uv,t,n),b(i.uv,i,n)])}function _(e,t){var i=Math.pow(2,t);var r=Math.pow(4,t);var n=T(p.vertices[e.a]);var a=T(p.vertices[e.b]);var o=T(p.vertices[e.c]);var s=[];for(var l=0;l<=i;l++){s[l]=[];var h=T(n.clone().lerp(o,l/i));var f=T(a.clone().lerp(o,l/i));var c=i-l;for(var u=0;u<=c;u++){if(u==0&&l==i){s[l][u]=h}else{s[l][u]=T(h.clone().lerp(f,u/c))}}}for(var l=0;l<i;l++){for(var u=0;u<2*(i-l)-1;u++){var d=Math.floor(u/2);if(u%2==0){y(s[l][d+1],s[l+1][d],s[l][d])}else{y(s[l][d+1],s[l+1][d+1],s[l+1][d])}}}}function R(e){return Math.atan2(e.z,-e.x)}function x(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function b(e,t,i){if(i<0&&e.x===1)e=new THREE.Vector2(e.x-1,e.y);if(t.x===0&&t.z===0)e=new THREE.Vector2(i/2/Math.PI+.5,e.y);return e.clone()}this.computeCentroids();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,i)};THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.IcosahedronGeometry=function(e,t){this.radius=e;this.detail=t;var i=(1+Math.sqrt(5))/2;var r=[[-1,i,0],[1,i,0],[-1,-i,0],[1,-i,0],[0,-1,i],[0,1,i],[0,-1,-i],[0,1,-i],[i,0,-1],[i,0,1],[-i,0,-1],[-i,0,1]];var n=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]];THREE.PolyhedronGeometry.call(this,r,n,e,t)};THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.OctahedronGeometry=function(e,t){var i=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]];var r=[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]];THREE.PolyhedronGeometry.call(this,i,r,e,t)};THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TetrahedronGeometry=function(e,t){var i=[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]];var r=[[2,1,0],[0,3,2],[1,3,0],[2,3,1]];THREE.PolyhedronGeometry.call(this,i,r,e,t)};THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ParametricGeometry=function(e,t,i,r){THREE.Geometry.call(this);var n=this.vertices;var a=this.faces;var o=this.faceVertexUvs[0];r=r===undefined?false:r;var s,l,h,f;var c,u;var d=i+1;var p=t+1;for(s=0;s<=i;s++){u=s/i;for(h=0;h<=t;h++){c=h/t;f=e(c,u);n.push(f)}}var m,E,g,v;var T,y,_,R;for(s=0;s<i;s++){for(h=0;h<t;h++){m=s*p+h;E=s*p+h+1;g=(s+1)*p+h;v=(s+1)*p+h+1;T=new THREE.Vector2(h/t,s/i);y=new THREE.Vector2((h+1)/t,s/i);_=new THREE.Vector2(h/t,(s+1)/i);R=new THREE.Vector2((h+1)/t,(s+1)/i);if(r){a.push(new THREE.Face3(m,E,g));a.push(new THREE.Face3(E,v,g));o.push([T,y,_]);o.push([y,R,_])}else{a.push(new THREE.Face4(m,E,v,g));o.push([T,y,R,_])}}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ConvexGeometry=function(f){THREE.Geometry.call(this);var c=[[0,1,2],[0,2,1]];for(var e=3;e<f.length;e++){t(e)}function t(e){var t=f[e].clone();var i=t.length();t.x+=i*p();t.y+=i*p();t.z+=i*p();var r=[];for(var n=0;n<c.length;){var a=c[n];if(u(a,t)){for(var o=0;o<3;o++){var s=[a[o],a[(o+1)%3]];var l=true;for(var h=0;h<r.length;h++){if(d(r[h],s)){r[h]=r[r.length-1];r.pop();l=false;break}}if(l){r.push(s)}}c[n]=c[c.length-1];c.pop()}else{n++}}for(var h=0;h<r.length;h++){c.push([r[h][0],r[h][1],e])}}function u(e,t){var i=f[e[0]];var r=f[e[1]];var n=f[e[2]];var a=s(i,r,n);var o=a.dot(i);return a.dot(t)>=o}function s(e,t,i){var r=new THREE.Vector3;var n=new THREE.Vector3;r.subVectors(i,t);n.subVectors(e,t);r.cross(n);r.normalize();return r}function d(e,t){return e[0]===t[1]&&e[1]===t[0]}function p(){return(Math.random()-.5)*2*1e-6}function i(e){var t=e.length();return new THREE.Vector2(e.x/t,e.y/t)}var r=0;var n=new Array(f.length);for(var e=0;e<c.length;e++){var a=c[e];for(var o=0;o<3;o++){if(n[a[o]]===undefined){n[a[o]]=r++;this.vertices.push(f[a[o]])}a[o]=n[a[o]]}}for(var e=0;e<c.length;e++){this.faces.push(new THREE.Face3(c[e][0],c[e][1],c[e][2]))}for(var e=0;e<this.faces.length;e++){var a=this.faces[e];this.faceVertexUvs[0].push([i(this.vertices[a.a]),i(this.vertices[a.b]),i(this.vertices[a.c])])}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.ConvexGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this);this.render=function(e){}};THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype);THREE.MorphBlendMesh=function(e,t){THREE.Mesh.call(this,e,t);this.animationsMap={};this.animationsList=[];var i=this.geometry.morphTargets.length;var r="__default";var n=0;var a=i-1;var o=i/1;this.createAnimation(r,n,a,o);this.setAnimationWeight(r,1)};THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphBlendMesh.prototype.createAnimation=function(e,t,i,r){var n={startFrame:t,endFrame:i,length:i-t+1,fps:r,duration:(i-t)/r,lastFrame:0,currentFrame:0,active:false,time:0,direction:1,weight:1,directionBackwards:false,mirroredLoop:false};this.animationsMap[e]=n;this.animationsList.push(n)};THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(e){var t=/([a-z]+)(\d+)/;var i,r={};var n=this.geometry;for(var a=0,o=n.morphTargets.length;a<o;a++){var s=n.morphTargets[a];var l=s.name.match(t);if(l&&l.length>1){var h=l[1];var f=l[2];if(!r[h])r[h]={start:Infinity,end:-Infinity};var c=r[h];if(a<c.start)c.start=a;if(a>c.end)c.end=a;if(!i)i=h}}for(var h in r){var c=r[h];this.createAnimation(h,c.start,c.end,e)}this.firstAnimation=i};THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];if(t){t.direction=1;t.directionBackwards=false}};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];if(t){t.direction=-1;t.directionBackwards=true}};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var i=this.animationsMap[e];if(i){i.fps=t;i.duration=(i.end-i.start)/i.fps}};THREE.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var i=this.animationsMap[e];if(i){i.duration=t;i.fps=(i.end-i.start)/i.duration}};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var i=this.animationsMap[e];if(i){i.weight=t}};THREE.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var i=this.animationsMap[e];if(i){i.time=t}};THREE.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0;var i=this.animationsMap[e];if(i){t=i.time}return t};THREE.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1;var i=this.animationsMap[e];if(i){t=i.duration}return t};THREE.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];if(t){t.time=0;t.active=true}};THREE.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];if(t){t.active=false}};THREE.MorphBlendMesh.prototype.update=function(e){for(var t=0,i=this.animationsList.length;t<i;t++){var r=this.animationsList[t];if(!r.active)continue;var n=r.duration/r.length;r.time+=r.direction*e;if(r.mirroredLoop){if(r.time>r.duration||r.time<0){r.direction*=-1;if(r.time>r.duration){r.time=r.duration;r.directionBackwards=true}if(r.time<0){r.time=0;r.directionBackwards=false}}}else{r.time=r.time%r.duration;if(r.time<0)r.time+=r.duration}var a=r.startFrame+THREE.Math.clamp(Math.floor(r.time/n),0,r.length-1);var o=r.weight;if(a!==r.currentFrame){this.morphTargetInfluences[r.lastFrame]=0;this.morphTargetInfluences[r.currentFrame]=1*o;this.morphTargetInfluences[a]=0;r.lastFrame=r.currentFrame;r.currentFrame=a}var s=r.time%n/n;if(r.directionBackwards)s=1-s;this.morphTargetInfluences[r.currentFrame]=s*o;this.morphTargetInfluences[r.lastFrame]=(1-s)*o}};THREE.SpritePlugin=function(){var _,R,i,x={};this.init=function(e){_=e.context;R=e;i=e.getPrecision();x.vertices=new Float32Array(8+8);x.faces=new Uint16Array(6);var t=0;x.vertices[t++]=-1;x.vertices[t++]=-1;x.vertices[t++]=0;x.vertices[t++]=0;x.vertices[t++]=1;x.vertices[t++]=-1;x.vertices[t++]=1;x.vertices[t++]=0;x.vertices[t++]=1;x.vertices[t++]=1;x.vertices[t++]=1;x.vertices[t++]=1;x.vertices[t++]=-1;x.vertices[t++]=1;x.vertices[t++]=0;x.vertices[t++]=1;t=0;x.faces[t++]=0;x.faces[t++]=1;x.faces[t++]=2;x.faces[t++]=0;x.faces[t++]=2;x.faces[t++]=3;x.vertexBuffer=_.createBuffer();x.elementBuffer=_.createBuffer();_.bindBuffer(_.ARRAY_BUFFER,x.vertexBuffer);_.bufferData(_.ARRAY_BUFFER,x.vertices,_.STATIC_DRAW);_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,x.elementBuffer);_.bufferData(_.ELEMENT_ARRAY_BUFFER,x.faces,_.STATIC_DRAW);x.program=r(THREE.ShaderSprite["sprite"],i);x.attributes={};x.uniforms={};x.attributes.position=_.getAttribLocation(x.program,"position");x.attributes.uv=_.getAttribLocation(x.program,"uv");x.uniforms.uvOffset=_.getUniformLocation(x.program,"uvOffset");x.uniforms.uvScale=_.getUniformLocation(x.program,"uvScale");x.uniforms.rotation=_.getUniformLocation(x.program,"rotation");x.uniforms.scale=_.getUniformLocation(x.program,"scale");x.uniforms.alignment=_.getUniformLocation(x.program,"alignment");x.uniforms.color=_.getUniformLocation(x.program,"color");x.uniforms.map=_.getUniformLocation(x.program,"map");x.uniforms.opacity=_.getUniformLocation(x.program,"opacity");x.uniforms.useScreenCoordinates=_.getUniformLocation(x.program,"useScreenCoordinates");x.uniforms.sizeAttenuation=_.getUniformLocation(x.program,"sizeAttenuation");x.uniforms.screenPosition=_.getUniformLocation(x.program,"screenPosition");x.uniforms.modelViewMatrix=_.getUniformLocation(x.program,"modelViewMatrix");x.uniforms.projectionMatrix=_.getUniformLocation(x.program,"projectionMatrix");x.uniforms.fogType=_.getUniformLocation(x.program,"fogType");x.uniforms.fogDensity=_.getUniformLocation(x.program,"fogDensity");x.uniforms.fogNear=_.getUniformLocation(x.program,"fogNear");x.uniforms.fogFar=_.getUniformLocation(x.program,"fogFar");x.uniforms.fogColor=_.getUniformLocation(x.program,"fogColor");x.uniforms.alphaTest=_.getUniformLocation(x.program,"alphaTest");x.uniforms.depth_render_mode=_.getUniformLocation(x.program,"depth_render_mode")};this.render=function(e,t,i,r){var n=e.__webglSprites,a=n.length;if(!a)return;var o=x.attributes,s=x.uniforms;var l=r/i;var h=i*.5,f=r*.5;_.useProgram(x.program);_.enableVertexAttribArray(o.position);_.enableVertexAttribArray(o.uv);_.disable(_.CULL_FACE);_.enable(_.BLEND);_.bindBuffer(_.ARRAY_BUFFER,x.vertexBuffer);_.vertexAttribPointer(o.position,2,_.FLOAT,false,2*8,0);_.vertexAttribPointer(o.uv,2,_.FLOAT,false,2*8,8);_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,x.elementBuffer);_.uniformMatrix4fv(s.projectionMatrix,false,t.projectionMatrix.elements);_.activeTexture(_.TEXTURE0);_.uniform1i(s.map,0);if(self.MMD_SA)_.uniform1i(s.depth_render_mode,MMD_SA._depth_render_mode_);var c=0;var u=0;var d=e.fog;if(d){_.uniform3f(s.fogColor,d.color.r,d.color.g,d.color.b);if(d instanceof THREE.Fog){_.uniform1f(s.fogNear,d.near);_.uniform1f(s.fogFar,d.far);_.uniform1i(s.fogType,1);c=1;u=1}else if(d instanceof THREE.FogExp2){_.uniform1f(s.fogDensity,d.density);_.uniform1i(s.fogType,2);c=2;u=2}}else{_.uniform1i(s.fogType,0);c=0;u=0}var p,m,E,g,v,T,y=[];for(p=0;p<a;p++){m=n[p];E=m.material;if(!m.visible||E.opacity===0)continue;if(!E.useScreenCoordinates){m._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,m.matrixWorld);m.z=-m._modelViewMatrix.elements[14]}else{m.z=-m.position.z}}n.sort(b);for(p=0;p<a;p++){m=n[p];E=m.material;if(!m.visible||E.opacity===0)continue;if(E.map&&E.map.image&&E.map.image.width){_.uniform1f(s.alphaTest,E.alphaTest);if(E.useScreenCoordinates===true){_.uniform1i(s.useScreenCoordinates,1);_.uniform3f(s.screenPosition,(m.position.x*R.devicePixelRatio-h)/h,(f-m.position.y*R.devicePixelRatio)/f,Math.max(0,Math.min(1,m.position.z)));y[0]=R.devicePixelRatio;y[1]=R.devicePixelRatio}else{_.uniform1i(s.useScreenCoordinates,0);_.uniform1i(s.sizeAttenuation,E.sizeAttenuation?1:0);_.uniformMatrix4fv(s.modelViewMatrix,false,m._modelViewMatrix.elements);y[0]=1;y[1]=1}if(e.fog&&E.fog){T=u}else{T=0}if(c!==T){_.uniform1i(s.fogType,T);c=T}v=1/(E.scaleByViewport?r:1);y[0]*=v*l*m.scale.x;y[1]*=v*m.scale.y;_.uniform2f(s.uvScale,E.uvScale.x,E.uvScale.y);_.uniform2f(s.uvOffset,E.uvOffset.x,E.uvOffset.y);_.uniform2f(s.alignment,E.alignment.x,E.alignment.y);_.uniform1f(s.opacity,E.opacity);_.uniform3f(s.color,E.color.r,E.color.g,E.color.b);_.uniform1f(s.rotation,m.rotation);_.uniform2fv(s.scale,y);R.setBlending(E.blending,E.blendEquation,E.blendSrc,E.blendDst);R.setDepthTest(E.depthTest);R.setDepthWrite(E.depthWrite);R.setTexture(E.map,0);_.drawElements(_.TRIANGLES,6,_.UNSIGNED_SHORT,0)}}_.enable(_.CULL_FACE)};function r(e,t){var i=_.createProgram();var r=_.createShader(_.FRAGMENT_SHADER);var n=_.createShader(_.VERTEX_SHADER);var a="precision "+t+" float;\n";if(self.MMD_SA&&MMD_SA.use_webgl2){_.shaderSource(r,MMD_SA.webgl2_fshader_prefix_convert(a)+MMD_SA.webgl2_fshader_main_convert(e.fragmentShader));_.shaderSource(n,MMD_SA.webgl2_vshader_prefix_convert(a)+MMD_SA.webgl2_vshader_main_convert(e.vertexShader))}else{_.shaderSource(r,a+e.fragmentShader);_.shaderSource(n,a+e.vertexShader)}_.compileShader(r);_.compileShader(n);if(!_.getShaderParameter(r,_.COMPILE_STATUS)){console.error(_.getShaderInfoLog(r))}if(!_.getShaderParameter(n,_.COMPILE_STATUS)){console.error(_.getShaderInfoLog(r))}_.attachShader(i,r);_.attachShader(i,n);_.linkProgram(i);return i}function b(e,t){if(e.z!==t.z){return t.z-e.z}else{return t.id-e.id}}};THREE.ShaderSprite={sprite:{vertexShader:["uniform int useScreenCoordinates;","uniform int sizeAttenuation;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position + alignment;","vec2 rotatedPosition;","rotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;","rotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;","vec4 finalPosition;","if( useScreenCoordinates != 0 ) {","finalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );","} else {","finalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition * ( sizeAttenuation == 1 ? 1.0 : finalPosition.z );","}","gl_Position = finalPosition;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","#define SKIP_SAO_DEPTH",THREE.ShaderChunk["AT_depth_render_mode_pars_fragment"],"void main() {",THREE.ShaderChunk["AT_depth_render_mode_fragment"],"vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")}};THREE.AxisHelper=function(e){e=e||1;var t=new THREE.Geometry;t.vertices.push(new THREE.Vector3,new THREE.Vector3(e,0,0),new THREE.Vector3,new THREE.Vector3(0,e,0),new THREE.Vector3,new THREE.Vector3(0,0,e));t.colors.push(new THREE.Color(16711680),new THREE.Color(16755200),new THREE.Color(65280),new THREE.Color(11206400),new THREE.Color(255),new THREE.Color(43775));var i=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.Line.call(this,t,i,THREE.LinePieces)};THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype);(function(e){function u(){this.header=null;this.offset=0;this.use_rle=false;this.use_pal=false;this.use_rgb=false;this.use_grey=false}u.TYPE_NO_DATA=0;u.TYPE_INDEXED=1;u.TYPE_RGB=2;u.TYPE_GREY=3;u.TYPE_RLE_INDEXED=9;u.TYPE_RLE_RGB=10;u.TYPE_RLE_GREY=11;u.ORIGIN_MASK=48;u.ORIGIN_SHIFT=4;u.ORIGIN_BL=0;u.ORIGIN_BR=1;u.ORIGIN_UL=2;u.ORIGIN_UR=3;u.prototype.open=function e(t,i,r){var n,a=this;n=new XMLHttpRequestZIP;n.open("GET",t,true);n.responseType="arraybuffer";n.onload=function(e){if(1||this.status===200){a.load(new Uint8Array(n.response));if(i)i.call(a)}else{r&&r.call(a)}};n.onerror=function(){r&&r.call(a)};n.send(null)};u.prototype.load=function e(t){if(t.length<19)throw new Error("Targa::load() - Not enough data to contain header.");this.offset=0;this.header={id_length:t[this.offset++],colormap_type:t[this.offset++],image_type:t[this.offset++],colormap_index:t[this.offset++]|t[this.offset++]<<8,colormap_length:t[this.offset++]|t[this.offset++]<<8,colormap_size:t[this.offset++],origin:[t[this.offset++]|t[this.offset++]<<8,t[this.offset++]|t[this.offset++]<<8],width:t[this.offset++]|t[this.offset++]<<8,height:t[this.offset++]|t[this.offset++]<<8,pixel_size:t[this.offset++],flags:t[this.offset++]};this.checkHeader();if(this.header.id_length+this.offset>t.length){throw new Error("Targa::load() - No data ?")}this.offset+=this.header.id_length;switch(this.header.image_type){case u.TYPE_RLE_INDEXED:this.use_rle=true;case u.TYPE_INDEXED:this.use_pal=true;break;case u.TYPE_RLE_RGB:this.use_rle=true;case u.TYPE_RGB:this.use_rgb=true;break;case u.TYPE_RLE_GREY:this.use_rle=true;case u.TYPE_GREY:this.use_grey=true;break}this.parse(t)};u.prototype.checkHeader=function e(){switch(this.header.image_type){case u.TYPE_INDEXED:case u.TYPE_RLE_INDEXED:if(this.header.colormap_length>256||this.header.colormap_size!==24||this.header.colormap_type!==1){throw new Error("Targa::checkHeader() - Invalid type colormap data for indexed type")}break;case u.TYPE_RGB:case u.TYPE_GREY:case u.TYPE_RLE_RGB:case u.TYPE_RLE_GREY:if(this.header.colormap_type){throw new Error("Targa::checkHeader() - Invalid type colormap data for colormap type")}break;case u.TYPE_NO_DATA:throw new Error("Targa::checkHeader() - No data on this TGA file");default:throw new Error("Targa::checkHeader() - Invalid type '"+this.header.image_type+"'")}if(this.header.width<=0||this.header.height<=0){throw new Error("Targa::checkHeader() - Invalid image size")}if(this.header.pixel_size!==8&&this.header.pixel_size!==16&&this.header.pixel_size!==24&&this.header.pixel_size!==32){throw new Error("Targa::checkHeader() - Invalid pixel size '"+this.header.pixel_size+"'")}};u.prototype.parse=function e(t){var i,r,n,a,o;i=this.header;r=i.flags&15;a=i.pixel_size>>3;o=i.width*i.height*a;if(this.use_pal){this.palettes=t.subarray(this.offset,this.offset+=i.colormap_length*a)}if(this.use_rle){n=new Uint8Array(o);var s,l,h;var f=0;var c=new Uint8Array(a);while(f<o){s=t[this.offset++];l=(s&127)+1;if(s&128){for(h=0;h<a;++h){c[h]=t[this.offset++]}for(h=0;h<l;++h){n.set(c,f+h*a)}f+=a*l}else{l*=a;for(h=0;h<l;++h){n[f+h]=t[this.offset++]}f+=l}}}else{n=t.subarray(this.offset,this.offset+=this.use_pal?i.width*i.height:o)}this.image=n};u.prototype.getImageData=function e(t){var i=this.header.width,r=this.header.height,n,a,o,s,l,h,f,c;c=t||document&&document.createElement("canvas").getContext("2d").createImageData(i,r)||{width:i,height:r,data:new Uint8Array(i*r*4)};switch((this.header.flags&u.ORIGIN_MASK)>>u.ORIGIN_SHIFT){default:case u.ORIGIN_UL:n=0;o=1;h=i;a=0;s=1;l=r;break;case u.ORIGIN_BL:n=0;o=1;h=i;a=r-1;s=-1;l=-1;break;case u.ORIGIN_UR:n=i-1;o=-1;h=-1;a=0;s=1;l=r;break;case u.ORIGIN_BR:n=i-1;o=-1;h=-1;a=r-1;s=-1;l=-1;break}f="getImageData"+(this.use_grey?"Grey":"")+this.header.pixel_size+"bits";this[f](c.data,a,s,l,n,o,h);return c};u.prototype.getCanvas=function e(){var t=document.createElement("canvas");var i=t.getContext("2d");var r=i.createImageData(this.header.width,this.header.height);t.width=this.header.width;t.height=this.header.height;i.putImageData(this.getImageData(r),0,0);return t};u.prototype.getDataURL=function e(t){return this.getCanvas().toDataURL(t||"image/png")};u.prototype.getImageData8bits=function e(t,i,r,n,a,o,s){var l=this.image,h=this.palettes;var f=this.header.width,c=this.header.height;var u,d=0,p,m;for(m=i;m!==n;m+=r){for(p=a;p!==s;p+=o,d++){u=l[d];t[(p+f*m)*4+3]=255;t[(p+f*m)*4+2]=h[u*3+0];t[(p+f*m)*4+1]=h[u*3+1];t[(p+f*m)*4+0]=h[u*3+2]}}return t};u.prototype.getImageData16bits=function e(t,i,r,n,a,o,s){var l=this.image;var h=this.header.width,f=this.header.height;var c,u=0,d,p;for(p=i;p!==n;p+=r){for(d=a;d!==s;d+=o,u+=2){c=l[u+0]+(l[u+1]<<8);t[(d+h*p)*4+0]=(c&31744)>>7;t[(d+h*p)*4+1]=(c&992)>>2;t[(d+h*p)*4+2]=(c&31)>>3;t[(d+h*p)*4+3]=c&32768?0:255}}return t};u.prototype.getImageData24bits=function e(t,i,r,n,a,o,s){var l=this.image;var h=this.header.width,f=this.header.height;var c=0,u,d;for(d=i;d!==n;d+=r){for(u=a;u!==s;u+=o,c+=3){t[(u+h*d)*4+3]=255;t[(u+h*d)*4+2]=l[c+0];t[(u+h*d)*4+1]=l[c+1];t[(u+h*d)*4+0]=l[c+2]}}return t};u.prototype.getImageData32bits=function e(t,i,r,n,a,o,s){var l=this.image;var h=this.header.width,f=this.header.height;var c=0,u,d;for(d=i;d!==n;d+=r){for(u=a;u!==s;u+=o,c+=4){t[(u+h*d)*4+2]=l[c+0];t[(u+h*d)*4+1]=l[c+1];t[(u+h*d)*4+0]=l[c+2];t[(u+h*d)*4+3]=l[c+3]}}return t};u.prototype.getImageDataGrey8bits=function e(t,i,r,n,a,o,s){var l=this.image;var h=this.header.width,f=this.header.height;var c,u=0,d,p;for(p=i;p!==n;p+=r){for(d=a;d!==s;d+=o,u++){c=l[u];t[(d+h*p)*4+0]=c;t[(d+h*p)*4+1]=c;t[(d+h*p)*4+2]=c;t[(d+h*p)*4+3]=255}}return t};u.prototype.getImageDataGrey16bits=function e(t,i,r,n,a,o,s){var l=this.image;var h=this.header.width,f=this.header.height;var c=0,u,d;for(d=i;d!==n;d+=r){for(u=a;u!==s;u+=o,c+=2){t[(u+h*d)*4+0]=l[c+0];t[(u+h*d)*4+1]=l[c+0];t[(u+h*d)*4+2]=l[c+0];t[(u+h*d)*4+3]=l[c+1]}}return t};if(typeof e!=="undefined"){e.TGA=u}})(THREE);(function(me,Ee,ge){"use strict";var ve={},a,o,e;ve.Util={};ve.Util.log=function(e){if(ve.logging&&me.console&&me.console.log){me.console.log(e)}};ve.Util.trimText=function(t){return function(e){return t?t.apply(e):((e||"")+"").replace(/^\s+|\s+$/g,"")}}(String.prototype.trim);ve.Util.asFloat=function(e){return parseFloat(e)};(function(){var a=/((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g;var o=/(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g;ve.Util.parseTextShadows=function(e){if(!e||e==="none"){return[]}var t=e.match(a),i=[];for(var r=0;t&&r<t.length;r++){var n=t[r].match(o);i.push({color:n[0],offsetX:n[1]?n[1].replace("px",""):0,offsetY:n[2]?n[2].replace("px",""):0,blur:n[3]?n[3].replace("px",""):0})}return i}})();ve.Util.parseBackgroundImage=function(e){var t=" \r\n\t",i,r,n,a,o,s=[],l,h=0,f=0,c,u;var d=function(){if(i){if(r.substr(0,1)==='"'){r=r.substr(1,r.length-2)}if(r){u.push(r)}if(i.substr(0,1)==="-"&&(a=i.indexOf("-",1)+1)>0){n=i.substr(0,a);i=i.substr(a)}s.push({prefix:n,method:i.toLowerCase(),value:o,args:u})}u=[];i=n=r=o=""};d();for(var p=0,m=e.length;p<m;p++){l=e[p];if(h===0&&t.indexOf(l)>-1){continue}switch(l){case'"':if(!c){c=l}else if(c===l){c=null}break;case"(":if(c){break}else if(h===0){h=1;o+=l;continue}else{f++}break;case")":if(c){break}else if(h===1){if(f===0){h=0;o+=l;d();continue}else{f--}}break;case",":if(c){break}else if(h===0){d();continue}else if(h===1){if(f===0&&!i.match(/^url$/i)){u.push(r);r="";o+=l;continue}}break}o+=l;if(h===0){i+=l}else{r+=l}}d();return s};ve.Util.Bounds=function(e){var t,i={};if(e.getBoundingClientRect){t=e.getBoundingClientRect();i.top=t.top;i.bottom=t.bottom||t.top+t.height;i.left=t.left;i.width=e.offsetWidth;i.height=e.offsetHeight}return i};ve.Util.OffsetBounds=function(e){var t=e.offsetParent?ve.Util.OffsetBounds(e.offsetParent):{top:0,left:0};return{top:e.offsetTop+t.top,bottom:e.offsetTop+e.offsetHeight+t.top,left:e.offsetLeft+t.left,width:e.offsetWidth,height:e.offsetHeight}};function n(e,t,i){var r=e.runtimeStyle&&e.runtimeStyle[t],n,a=e.style;if(!/^-?[0-9]+\.?[0-9]*(?:px)?$/i.test(i)&&/^-?\d/.test(i)){n=a.left;if(r){e.runtimeStyle.left=e.currentStyle.left}a.left=t==="fontSize"?"1em":i||0;i=a.pixelLeft+"px";a.left=n;if(r){e.runtimeStyle.left=r}}if(!/^(thin|medium|thick)$/i.test(i)){return Math.round(parseFloat(i))+"px"}return i}function s(e){return parseInt(e,10)}function l(e,t,i,r){e=(e||"").split(",");e=e[r||0]||e[0]||"auto";e=ve.Util.trimText(e).split(" ");if(i==="backgroundSize"&&(!e[0]||e[0].match(/cover|contain|auto/))){}else{e[0]=e[0].indexOf("%")===-1?n(t,i+"X",e[0]):e[0];if(e[1]===ge){if(i==="backgroundSize"){e[1]="auto";return e}else{e[1]=e[0]}}e[1]=e[1].indexOf("%")===-1?n(t,i+"Y",e[1]):e[1]}return e}ve.Util.getCSS=function(e,t,i){if(a!==e){o=Ee.defaultView.getComputedStyle(e,null)}var r=o[t];if(/^background(Size|Position)$/.test(t)){return l(r,e,t,i)}else if(/border(Top|Bottom)(Left|Right)Radius/.test(t)){var n=r.split(" ");if(n.length<=1){n[1]=n[0]}return n.map(s)}return r};ve.Util.resizeBounds=function(e,t,i,r,n){var a=i/r,o=e/t,s,l;if(!n||n==="auto"){s=i;l=r}else if(a<o^n==="contain"){l=r;s=r*o}else{s=i;l=i/o}return{width:s,height:l}};function h(e,t,i,r,n,a){var o=ve.Util.getCSS(t,e,n),s,l,h,f;if(o.length===1){f=o[0];o=[];o[0]=f;o[1]=f}if(o[0].toString().indexOf("%")!==-1){h=parseFloat(o[0])/100;l=i.width*h;if(e!=="backgroundSize"){l-=(a||r).width*h}}else{if(e==="backgroundSize"){if(o[0]==="auto"){l=r.width}else{if(/contain|cover/.test(o[0])){var c=ve.Util.resizeBounds(r.width,r.height,i.width,i.height,o[0]);l=c.width;s=c.height}else{l=parseInt(o[0],10)}}}else{l=parseInt(o[0],10)}}if(o[1]==="auto"){s=l/r.width*r.height}else if(o[1].toString().indexOf("%")!==-1){h=parseFloat(o[1])/100;s=i.height*h;if(e!=="backgroundSize"){s-=(a||r).height*h}}else{s=parseInt(o[1],10)}return[l,s]}ve.Util.BackgroundPosition=function(e,t,i,r,n){var a=h("backgroundPosition",e,t,i,r,n);return{left:a[0],top:a[1]}};ve.Util.BackgroundSize=function(e,t,i,r){var n=h("backgroundSize",e,t,i,r);return{width:n[0],height:n[1]}};ve.Util.Extend=function(e,t){for(var i in e){if(e.hasOwnProperty(i)){t[i]=e[i]}}return t};ve.Util.Children=function(e){var t;try{t=e.nodeName&&e.nodeName.toUpperCase()==="IFRAME"?e.contentDocument||e.contentWindow.document:function(e){var t=[];if(e!==null){(function(e,t){var i=e.length,r=0;if(typeof t.length==="number"){for(var n=t.length;r<n;r++){e[i++]=t[r]}}else{while(t[r]!==ge){e[i++]=t[r++]}}e.length=i;return e})(t,e)}return t}(e.childNodes)}catch(e){ve.Util.log("html2canvas.Util.Children failed with exception: "+e.message);t=[]}return t};ve.Util.isTransparent=function(e){return e==="transparent"||e==="rgba(0, 0, 0, 0)"};ve.Util.Font=function(){var f={};return function(e,t,i){if(f[e+"-"+t]!==ge){return f[e+"-"+t]}var r=i.createElement("div"),n=i.createElement("img"),a=i.createElement("span"),o="Hidden Text",s,l,h;r.style.visibility="hidden";r.style.fontFamily=e;r.style.fontSize=t;r.style.margin=0;r.style.padding=0;i.body.appendChild(r);n.src="data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACwAAAAAAQABAAACAkQBADs=";n.width=1;n.height=1;n.style.margin=0;n.style.padding=0;n.style.verticalAlign="baseline";a.style.fontFamily=e;a.style.fontSize=t;a.style.margin=0;a.style.padding=0;a.appendChild(i.createTextNode(o));r.appendChild(a);r.appendChild(n);s=n.offsetTop-a.offsetTop+1;r.removeChild(a);r.appendChild(i.createTextNode(o));r.style.lineHeight="normal";n.style.verticalAlign="super";l=n.offsetTop-r.offsetTop+1;h={baseline:s,lineWidth:1,middle:l};f[e+"-"+t]=h;i.body.removeChild(r);return h}}();(function(){var i=ve.Util,e={};ve.Generate=e;var m=[/^(-webkit-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-gradient)\((linear|radial),\s((?:\d{1,3}%?)\s(?:\d{1,3}%?),\s(?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)\-]+)\)$/,/^(-moz-linear-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-moz-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s?([a-z\-]*)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/];e.parseGradient=function(e,t){var i,r,n=m.length,a,o,s,l,h,f,c,u,d,p;for(r=0;r<n;r+=1){a=e.match(m[r]);if(a){break}}if(a){switch(a[1]){case"-webkit-linear-gradient":case"-o-linear-gradient":i={type:"linear",x0:null,y0:null,x1:null,y1:null,colorStops:[]};s=a[2].match(/\w+/g);if(s){l=s.length;for(r=0;r<l;r+=1){switch(s[r]){case"top":i.y0=0;i.y1=t.height;break;case"right":i.x0=t.width;i.x1=0;break;case"bottom":i.y0=t.height;i.y1=0;break;case"left":i.x0=0;i.x1=t.width;break}}}if(i.x0===null&&i.x1===null){i.x0=i.x1=t.width/2}if(i.y0===null&&i.y1===null){i.y0=i.y1=t.height/2}s=a[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g);if(s){l=s.length;h=1/Math.max(l-1,1);for(r=0;r<l;r+=1){f=s[r].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/);if(f[2]){o=parseFloat(f[2]);if(f[3]==="%"){o/=100}else{o/=t.width}}else{o=r*h}i.colorStops.push({color:f[1],stop:o})}}break;case"-webkit-gradient":i={type:a[2]==="radial"?"circle":a[2],x0:0,y0:0,x1:0,y1:0,colorStops:[]};s=a[3].match(/(\d{1,3})%?\s(\d{1,3})%?,\s(\d{1,3})%?\s(\d{1,3})%?/);if(s){i.x0=s[1]*t.width/100;i.y0=s[2]*t.height/100;i.x1=s[3]*t.width/100;i.y1=s[4]*t.height/100}s=a[4].match(/((?:from|to|color-stop)\((?:[0-9\.]+,\s)?(?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)\))+/g);if(s){l=s.length;for(r=0;r<l;r+=1){f=s[r].match(/(from|to|color-stop)\(([0-9\.]+)?(?:,\s)?((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\)/);o=parseFloat(f[2]);if(f[1]==="from"){o=0}if(f[1]==="to"){o=1}i.colorStops.push({color:f[3],stop:o})}}break;case"-moz-linear-gradient":i={type:"linear",x0:0,y0:0,x1:0,y1:0,colorStops:[]};s=a[2].match(/(\d{1,3})%?\s(\d{1,3})%?/);if(s){i.x0=s[1]*t.width/100;i.y0=s[2]*t.height/100;i.x1=t.width-i.x0;i.y1=t.height-i.y0}s=a[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}%)?)+/g);if(s){l=s.length;h=1/Math.max(l-1,1);for(r=0;r<l;r+=1){f=s[r].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%)?/);if(f[2]){o=parseFloat(f[2]);if(f[3]){o/=100}}else{o=r*h}i.colorStops.push({color:f[1],stop:o})}}break;case"-webkit-radial-gradient":case"-moz-radial-gradient":case"-o-radial-gradient":i={type:"circle",x0:0,y0:0,x1:t.width,y1:t.height,cx:0,cy:0,rx:0,ry:0,colorStops:[]};s=a[2].match(/(\d{1,3})%?\s(\d{1,3})%?/);if(s){i.cx=s[1]*t.width/100;i.cy=s[2]*t.height/100}s=a[3].match(/\w+/);f=a[4].match(/[a-z\-]*/);if(s&&f){switch(f[0]){case"farthest-corner":case"cover":case"":c=Math.sqrt(Math.pow(i.cx,2)+Math.pow(i.cy,2));u=Math.sqrt(Math.pow(i.cx,2)+Math.pow(i.y1-i.cy,2));d=Math.sqrt(Math.pow(i.x1-i.cx,2)+Math.pow(i.y1-i.cy,2));p=Math.sqrt(Math.pow(i.x1-i.cx,2)+Math.pow(i.cy,2));i.rx=i.ry=Math.max(c,u,d,p);break;case"closest-corner":c=Math.sqrt(Math.pow(i.cx,2)+Math.pow(i.cy,2));u=Math.sqrt(Math.pow(i.cx,2)+Math.pow(i.y1-i.cy,2));d=Math.sqrt(Math.pow(i.x1-i.cx,2)+Math.pow(i.y1-i.cy,2));p=Math.sqrt(Math.pow(i.x1-i.cx,2)+Math.pow(i.cy,2));i.rx=i.ry=Math.min(c,u,d,p);break;case"farthest-side":if(s[0]==="circle"){i.rx=i.ry=Math.max(i.cx,i.cy,i.x1-i.cx,i.y1-i.cy)}else{i.type=s[0];i.rx=Math.max(i.cx,i.x1-i.cx);i.ry=Math.max(i.cy,i.y1-i.cy)}break;case"closest-side":case"contain":if(s[0]==="circle"){i.rx=i.ry=Math.min(i.cx,i.cy,i.x1-i.cx,i.y1-i.cy)}else{i.type=s[0];i.rx=Math.min(i.cx,i.x1-i.cx);i.ry=Math.min(i.cy,i.y1-i.cy)}break}}s=a[5].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g);if(s){l=s.length;h=1/Math.max(l-1,1);for(r=0;r<l;r+=1){f=s[r].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/);if(f[2]){o=parseFloat(f[2]);if(f[3]==="%"){o/=100}else{o/=t.width}}else{o=r*h}i.colorStops.push({color:f[1],stop:o})}}break}}return i};function f(e){return function(t){try{e.addColorStop(t.stop,t.color)}catch(e){i.log(["failed to add color stop: ",e,"; tried to add: ",t])}}}e.Gradient=function(e,t){if(t.width===0||t.height===0){return}var i=Ee.createElement("canvas"),r=i.getContext("2d"),n,a;i.width=t.width;i.height=t.height;n=ve.Generate.parseGradient(e,t);if(n){switch(n.type){case"linear":a=r.createLinearGradient(n.x0,n.y0,n.x1,n.y1);n.colorStops.forEach(f(a));r.fillStyle=a;r.fillRect(0,0,t.width,t.height);break;case"circle":a=r.createRadialGradient(n.cx,n.cy,0,n.cx,n.cy,n.rx);n.colorStops.forEach(f(a));r.fillStyle=a;r.fillRect(0,0,t.width,t.height);break;case"ellipse":var o=Ee.createElement("canvas"),s=o.getContext("2d"),l=Math.max(n.rx,n.ry),h=l*2;o.width=o.height=h;a=s.createRadialGradient(n.rx,n.ry,0,n.rx,n.ry,l);n.colorStops.forEach(f(a));s.fillStyle=a;s.fillRect(0,0,h,h);r.fillStyle=n.colorStops[n.colorStops.length-1].color;r.fillRect(0,0,i.width,i.height);r.drawImage(o,n.cx-n.rx,n.cy-n.ry,2*n.rx,2*n.ry);break}}return i};e.ListAlpha=function(e){var t="",i;do{i=e%26;t=String.fromCharCode(i+64)+t;e=e/26}while(e*26>26);return t};e.ListRoman=function(e){var t=["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"],i=[1e3,900,500,400,100,90,50,40,10,9,5,4,1],r="",n,a=t.length;if(e<=0||e>=4e3){return e}for(n=0;n<a;n+=1){while(e>=i[n]){e-=i[n];r+=t[n]}}return r}})();function Te(e,t){var i=[];return{storage:i,width:e,height:t,clip:function(){i.push({type:"function",name:"clip",arguments:arguments})},translate:function(){i.push({type:"function",name:"translate",arguments:arguments})},fill:function(){i.push({type:"function",name:"fill",arguments:arguments})},save:function(){i.push({type:"function",name:"save",arguments:arguments})},restore:function(){i.push({type:"function",name:"restore",arguments:arguments})},fillRect:function(){i.push({type:"function",name:"fillRect",arguments:arguments})},createPattern:function(){i.push({type:"function",name:"createPattern",arguments:arguments})},drawShape:function(){var e=[];i.push({type:"function",name:"drawShape",arguments:e});return{moveTo:function(){e.push({name:"moveTo",arguments:arguments})},lineTo:function(){e.push({name:"lineTo",arguments:arguments})},arcTo:function(){e.push({name:"arcTo",arguments:arguments})},bezierCurveTo:function(){e.push({name:"bezierCurveTo",arguments:arguments})},quadraticCurveTo:function(){e.push({name:"quadraticCurveTo",arguments:arguments})}}},drawImage:function(){i.push({type:"function",name:"drawImage",arguments:arguments})},fillText:function(){i.push({type:"function",name:"fillText",arguments:arguments})},setVariable:function(e,t){i.push({type:"variable",name:e,arguments:t});return t}}}ve.Parse=function(i,f){me.scroll(0,0);var r=f.elements===ge?Ee.body:f.elements[0],o=0,h=r.ownerDocument,d=ve.Util,s=d.Support(f,h),p=new RegExp("("+f.ignoreElements+")"),l=h.body,m=d.getCSS,c="___html2canvas___pseudoelement",n=h.createElement("style");n.innerHTML="."+c+'-before:before { content: "" !important; display: none !important; }'+"."+c+'-after:after { content: "" !important; display: none !important; }';l.appendChild(n);i=i||{};function u(){return Math.max(Math.max(h.body.scrollWidth,h.documentElement.scrollWidth),Math.max(h.body.offsetWidth,h.documentElement.offsetWidth),Math.max(h.body.clientWidth,h.documentElement.clientWidth))}function E(){return Math.max(Math.max(h.body.scrollHeight,h.documentElement.scrollHeight),Math.max(h.body.offsetHeight,h.documentElement.offsetHeight),Math.max(h.body.clientHeight,h.documentElement.clientHeight))}function g(e,t){var i=parseInt(m(e,t),10);return isNaN(i)?0:i}function a(e,t,i,r,n,a){if(a!=="transparent"){e.setVariable("fillStyle",a);e.fillRect(t,i,r,n);o+=1}}function v(e,t,i){if(e.length>0){return t+i.toUpperCase()}}function z(e,t){switch(t){case"lowercase":return e.toLowerCase();case"capitalize":return e.replace(/(^|\s|:|-|\(|\))([a-z])/g,v);case"uppercase":return e.toUpperCase();default:return e}}function I(e){return/^(normal|none|0px)$/.test(e)}function T(e,t,i,r){if(e!==null&&d.trimText(e).length>0){r.fillText(e,t,i);o+=1}}function y(e,t,i,r){var n=false,a=m(t,"fontWeight"),o=m(t,"fontFamily"),s=m(t,"fontSize"),l=d.parseTextShadows(m(t,"textShadow"));switch(parseInt(a,10)){case 401:a="bold";break;case 400:a="normal";break}e.setVariable("fillStyle",r);e.setVariable("font",[m(t,"fontStyle"),m(t,"fontVariant"),a,s,o].join(" "));e.setVariable("textAlign",n?"right":"left");if(l.length){e.setVariable("shadowColor",l[0].color);e.setVariable("shadowOffsetX",l[0].offsetX);e.setVariable("shadowOffsetY",l[0].offsetY);e.setVariable("shadowBlur",l[0].blur)}if(i!=="none"){return d.Font(o,s,h)}}function V(e,t,i,r,n){switch(t){case"underline":a(e,i.left,Math.round(i.top+r.baseline+r.lineWidth),i.width,1,n);break;case"overline":a(e,i.left,Math.round(i.top),i.width,1,n);break;case"line-through":a(e,i.left,Math.ceil(i.top+r.middle+r.lineWidth),i.width,1,n);break}}function k(e,t,i,r,n){var a;if(s.rangeBounds&&!n){if(i!=="none"||d.trimText(t).length!==0){a=B(t,e.node,e.textOffset)}e.textOffset+=t.length}else if(e.node&&typeof e.node.nodeValue==="string"){var o=r?e.node.splitText(t.length):null;a=j(e.node,n);e.node=o}return a}function B(e,t,i){var r=h.createRange();r.setStart(t,i);r.setEnd(t,i+e.length);return r.getBoundingClientRect()}function j(e,t){var i=e.parentNode,r=h.createElement("wrapper"),n=e.cloneNode(true);r.appendChild(e.cloneNode(true));i.replaceChild(r,e);var a=t?d.OffsetBounds(r):d.Bounds(r);i.replaceChild(n,r);return a}function _(e,t,r){var n=r.ctx,a=m(e,"color"),o=m(e,"textDecoration"),i=m(e,"textAlign"),s,l,h={node:t,textOffset:0};if(d.trimText(t.nodeValue).length>0){t.nodeValue=z(t.nodeValue,m(e,"textTransform"));i=i.replace(["-webkit-auto"],["auto"]);l=!f.letterRendering&&/^(left|right|justify|auto)$/.test(i)&&I(m(e,"letterSpacing"))?t.nodeValue.split(/(\b| )/):t.nodeValue.split("");s=y(n,e,o,a);if(f.chinese){l.forEach(function(e,t){if(/.*[\u4E00-\u9FA5].*$/.test(e)){e=e.split("");e.unshift(t,1);l.splice.apply(l,e)}})}l.forEach(function(e,t){var i=k(h,e,o,t<l.length-1,r.transform.matrix);if(i){T(e,i.left,i.bottom,n);V(n,o,i,s,a)}})}}function G(e,t){var i=h.createElement("boundelement"),r,n;i.style.display="inline";r=e.style.listStyleType;e.style.listStyleType="none";i.appendChild(h.createTextNode(t));e.insertBefore(i,e.firstChild);n=d.Bounds(i);e.removeChild(i);e.style.listStyleType=r;return n}function W(e){var t=-1,i=1,r=e.parentNode.childNodes;if(e.parentNode){while(r[++t]!==e){if(r[t].nodeType===1){i++}}return i}else{return-1}}function X(e,t){var i=W(e),r;switch(t){case"decimal":r=i;break;case"decimal-leading-zero":r=i.toString().length===1?i="0"+i.toString():i.toString();break;case"upper-roman":r=ve.Generate.ListRoman(i);break;case"lower-roman":r=ve.Generate.ListRoman(i).toLowerCase();break;case"lower-alpha":r=ve.Generate.ListAlpha(i).toLowerCase();break;case"upper-alpha":r=ve.Generate.ListAlpha(i);break}return r+". "}function q(e,t,i){var r,n,a=t.ctx,o=m(e,"listStyleType"),s;if(/^(decimal|decimal-leading-zero|upper-alpha|upper-latin|upper-roman|lower-alpha|lower-greek|lower-latin|lower-roman)$/i.test(o)){n=X(e,o);s=G(e,n);y(a,e,"none",m(e,"color"));if(m(e,"listStylePosition")==="inside"){a.setVariable("textAlign","left");r=i.left}else{return}T(n,r,s.bottom,a)}}function R(e){var t=i[e];return t&&t.succeeded===true?t.img:false}function x(e,t){var i=Math.max(e.left,t.left),r=Math.max(e.top,t.top),n=Math.min(e.left+e.width,t.left+t.width),a=Math.min(e.top+e.height,t.top+t.height);return{left:i,top:r,width:n-i,height:a-r}}function Y(e,t,i){var r,n=t.cssPosition!=="static",a=n?m(e,"zIndex"):"auto",o=m(e,"opacity"),s=m(e,"cssFloat")!=="none";t.zIndex=r=ye(a);r.isPositioned=n;r.isFloated=s;r.opacity=o;r.ownStacking=a!=="auto"||o<1;if(i){i.zIndex.children.push(t)}}function b(e,t,i,r,n){var a=g(t,"paddingLeft"),o=g(t,"paddingTop"),s=g(t,"paddingRight"),l=g(t,"paddingBottom");D(e,i,0,0,i.width,i.height,r.left+a+n[3].width,r.top+o+n[0].width,r.width-(n[1].width+n[3].width+a+s),r.height-(n[0].width+n[2].width+o+l))}function $(t){return["Top","Right","Bottom","Left"].map(function(e){return{width:g(t,"border"+e+"Width"),color:m(t,"border"+e+"Color")}})}function K(t){return["TopLeft","TopRight","BottomRight","BottomLeft"].map(function(e){return m(t,"border"+e+"Radius")})}var H=function(l){return function(e,t,i,r){var n=i*l,a=r*l,o=e+i,s=t+r;return{topLeft:w({x:e,y:s},{x:e,y:s-a},{x:o-n,y:t},{x:o,y:t}),topRight:w({x:e,y:t},{x:e+n,y:t},{x:o,y:s-a},{x:o,y:s}),bottomRight:w({x:o,y:t},{x:o,y:t+a},{x:e+n,y:s},{x:e,y:s}),bottomLeft:w({x:o,y:s},{x:o-n,y:s},{x:e,y:t+a},{x:e,y:t})}}}(4*((Math.sqrt(2)-1)/3));function w(s,l,h,f){var c=function(e,t,i){return{x:e.x+(t.x-e.x)*i,y:e.y+(t.y-e.y)*i}};return{start:s,startControl:l,endControl:h,end:f,subdivide:function(e){var t=c(s,l,e),i=c(l,h,e),r=c(h,f,e),n=c(t,i,e),a=c(i,r,e),o=c(n,a,e);return[w(s,t,n,o),w(o,a,r,f)]},curveTo:function(e){e.push(["bezierCurve",l.x,l.y,h.x,h.y,f.x,f.y])},curveToReversed:function(e){e.push(["bezierCurve",h.x,h.y,l.x,l.y,s.x,s.y])}}}function M(e,t,i,r,n,a,o){if(t[0]>0||t[1]>0){e.push(["line",r[0].start.x,r[0].start.y]);r[0].curveTo(e);r[1].curveTo(e)}else{e.push(["line",a,o])}if(i[0]>0||i[1]>0){e.push(["line",n[0].start.x,n[0].start.y])}}function S(e,t,i,r,n,a,o){var s=[];if(t[0]>0||t[1]>0){s.push(["line",r[1].start.x,r[1].start.y]);r[1].curveTo(s)}else{s.push(["line",e.c1[0],e.c1[1]])}if(i[0]>0||i[1]>0){s.push(["line",a[0].start.x,a[0].start.y]);a[0].curveTo(s);s.push(["line",o[0].end.x,o[0].end.y]);o[0].curveToReversed(s)}else{s.push(["line",e.c2[0],e.c2[1]]);s.push(["line",e.c3[0],e.c3[1]])}if(t[0]>0||t[1]>0){s.push(["line",n[1].end.x,n[1].end.y]);n[1].curveToReversed(s)}else{s.push(["line",e.c4[0],e.c4[1]])}return s}function Q(e,t,i){var r=e.left,n=e.top,a=e.width,o=e.height,s=t[0][0],l=t[0][1],h=t[1][0],f=t[1][1],c=t[2][0],u=t[2][1],d=t[3][0],p=t[3][1],m=a-h,E=o-u,g=a-c,v=o-p;return{topLeftOuter:H(r,n,s,l).topLeft.subdivide(.5),topLeftInner:H(r+i[3].width,n+i[0].width,Math.max(0,s-i[3].width),Math.max(0,l-i[0].width)).topLeft.subdivide(.5),topRightOuter:H(r+m,n,h,f).topRight.subdivide(.5),topRightInner:H(r+Math.min(m,a+i[3].width),n+i[0].width,m>a+i[3].width?0:h-i[3].width,f-i[0].width).topRight.subdivide(.5),bottomRightOuter:H(r+g,n+E,c,u).bottomRight.subdivide(.5),bottomRightInner:H(r+Math.min(g,a+i[3].width),n+Math.min(E,o+i[0].width),Math.max(0,c-i[1].width),Math.max(0,u-i[2].width)).bottomRight.subdivide(.5),bottomLeftOuter:H(r,n+v,d,p).bottomLeft.subdivide(.5),bottomLeftInner:H(r+i[3].width,n+v,Math.max(0,d-i[3].width),Math.max(0,p-i[2].width)).bottomLeft.subdivide(.5)}}function Z(e,t,i,r,n){var a=m(e,"backgroundClip"),o=[];switch(a){case"content-box":case"padding-box":M(o,r[0],r[1],t.topLeftInner,t.topRightInner,n.left+i[3].width,n.top+i[0].width);M(o,r[1],r[2],t.topRightInner,t.bottomRightInner,n.left+n.width-i[1].width,n.top+i[0].width);M(o,r[2],r[3],t.bottomRightInner,t.bottomLeftInner,n.left+n.width-i[1].width,n.top+n.height-i[2].width);M(o,r[3],r[0],t.bottomLeftInner,t.topLeftInner,n.left+i[3].width,n.top+n.height-i[2].width);break;default:M(o,r[0],r[1],t.topLeftOuter,t.topRightOuter,n.left,n.top);M(o,r[1],r[2],t.topRightOuter,t.bottomRightOuter,n.left+n.width,n.top);M(o,r[2],r[3],t.bottomRightOuter,t.bottomLeftOuter,n.left+n.width,n.top+n.height);M(o,r[3],r[0],t.bottomLeftOuter,t.topLeftOuter,n.left,n.top+n.height);break}return o}function J(e,t,i){var r=t.left,n=t.top,a=t.width,o=t.height,s,l,h,f,c,u,d=K(e),p=Q(t,d,i),m={clip:Z(e,p,i,d,t),borders:[]};for(s=0;s<4;s++){if(i[s].width>0){l=r;h=n;f=a;c=o-i[2].width;switch(s){case 0:c=i[0].width;u=S({c1:[l,h],c2:[l+f,h],c3:[l+f-i[1].width,h+c],c4:[l+i[3].width,h+c]},d[0],d[1],p.topLeftOuter,p.topLeftInner,p.topRightOuter,p.topRightInner);break;case 1:l=r+a-i[1].width;f=i[1].width;u=S({c1:[l+f,h],c2:[l+f,h+c+i[2].width],c3:[l,h+c],c4:[l,h+i[0].width]},d[1],d[2],p.topRightOuter,p.topRightInner,p.bottomRightOuter,p.bottomRightInner);break;case 2:h=h+o-i[2].width;c=i[2].width;u=S({c1:[l+f,h+c],c2:[l,h+c],c3:[l+i[3].width,h],c4:[l+f-i[3].width,h]},d[2],d[3],p.bottomRightOuter,p.bottomRightInner,p.bottomLeftOuter,p.bottomLeftInner);break;case 3:f=i[3].width;u=S({c1:[l,h+c+i[2].width],c2:[l,h],c3:[l+f,h+i[0].width],c4:[l+f,h+c]},d[3],d[0],p.bottomLeftOuter,p.bottomLeftInner,p.topLeftOuter,p.topLeftInner);break}m.borders.push({args:u,color:i[s].color})}}return m}function A(e,t){var i=e.drawShape();t.forEach(function(e,t){i[t===0?"moveTo":e[0]+"To"].apply(null,e.slice(1))});return i}function ee(e,t,i){if(i!=="transparent"){e.setVariable("fillStyle",i);A(e,t);e.fill();o+=1}}function C(t,e,i){var r=h.createElement("valuewrap"),n=["lineHeight","textAlign","fontFamily","color","fontSize","paddingLeft","paddingTop","width","height","border","borderLeftWidth","borderTopWidth"],a,o;n.forEach(function(e){try{r.style[e]=m(t,e)}catch(e){d.log("html2canvas: Parse: Exception caught in renderFormValue: "+e.message)}});r.style.borderColor="black";r.style.borderStyle="solid";r.style.display="block";r.style.position="absolute";if(/^(submit|reset|button|text|password)$/.test(t.type)||t.nodeName==="SELECT"){r.style.lineHeight=m(t,"height")}r.style.top=e.top+"px";r.style.left=e.left+"px";a=t.nodeName==="SELECT"?(t.options[t.selectedIndex]||0).text:t.value;if(!a){a=t.placeholder}o=h.createTextNode(a);r.appendChild(o);l.appendChild(r);_(t,o,i);l.removeChild(r)}function D(e){e.drawImage.apply(e,Array.prototype.slice.call(arguments,1));o+=1}function P(e,t){var i=me.getComputedStyle(e,t);if(!i||!i.content||i.content==="none"||i.content==="-moz-alt-content"||i.display==="none"){return}var r=i.content+"",n=r.substr(0,1);if(n===r.substr(r.length-1)&&n.match(/'|"/)){r=r.substr(1,r.length-2)}var a=r.substr(0,3)==="url",o=Ee.createElement(a?"img":"span");o.className=c+"-before "+c+"-after";Object.keys(i).filter(te).forEach(function(t){try{o.style[t]=i[t]}catch(e){d.log(["Tried to assign readonly property ",t,"Error:",e])}});if(a){o.src=d.parseBackgroundImage(r)[0].args[0]}else{o.innerHTML=r}return o}function te(e){return isNaN(me.parseInt(e,10))}function ie(e,t){var i=P(e,":before"),r=P(e,":after");if(!i&&!r){return}if(i){e.className+=" "+c+"-before";e.parentNode.insertBefore(i,e);F(i,t,true);e.parentNode.removeChild(i);e.className=e.className.replace(c+"-before","").trim()}if(r){e.className+=" "+c+"-after";e.appendChild(r);F(r,t,true);e.removeChild(r);e.className=e.className.replace(c+"-after","").trim()}}function L(e,t,i,r){var n=Math.round(r.left+i.left),a=Math.round(r.top+i.top);e.createPattern(t);e.translate(n,a);e.fill();e.translate(-n,-a)}function U(e,t,i,r,n,a,o,s){var l=[];l.push(["line",Math.round(n),Math.round(a)]);l.push(["line",Math.round(n+o),Math.round(a)]);l.push(["line",Math.round(n+o),Math.round(s+a)]);l.push(["line",Math.round(n),Math.round(s+a)]);A(e,l);e.save();e.clip();L(e,t,i,r);e.restore()}function re(e,t,i){a(e,t.left,t.top,t.width,t.height,i)}function ne(e,t,i,r,n){var a=d.BackgroundSize(e,t,r,n),o=d.BackgroundPosition(e,t,r,n,a),s=m(e,"backgroundRepeat").split(",").map(d.trimText);r=oe(r,a);s=s[n]||s[0];switch(s){case"repeat-x":U(i,r,o,t,t.left,t.top+o.top,99999,r.height);break;case"repeat-y":U(i,r,o,t,t.left+o.left,t.top,r.width,99999);break;case"no-repeat":U(i,r,o,t,t.left+o.left,t.top+o.top,r.width,r.height);break;default:L(i,r,o,{top:t.top,left:t.left,width:r.width,height:r.height});break}}function ae(e,t,i){var r=m(e,"backgroundImage"),n=d.parseBackgroundImage(r),a,o=n.length;while(o--){r=n[o];if(!r.args||r.args.length===0){continue}var s=r.method==="url"?r.args[0]:r.value;a=R(s);if(a){ne(e,t,i,a,o)}else{d.log("html2canvas: Error loading background:",r)}}}function oe(e,t){if(e.width===t.width&&e.height===t.height){return e}var i,r=h.createElement("canvas");r.width=t.width;r.height=t.height;i=r.getContext("2d");D(i,e,0,0,e.width,e.height,0,0,t.width,t.height);return r}function se(e,t,i){return e.setVariable("globalAlpha",m(t,"opacity")*(i?i.opacity:1))}function le(e){return e.replace("px","")}var he=/(matrix)\((.+)\)/;function fe(e,t){var i=m(e,"transform")||m(e,"-webkit-transform")||m(e,"-moz-transform")||m(e,"-ms-transform")||m(e,"-o-transform");var r=m(e,"transform-origin")||m(e,"-webkit-transform-origin")||m(e,"-moz-transform-origin")||m(e,"-ms-transform-origin")||m(e,"-o-transform-origin")||"0px 0px";r=r.split(" ").map(le).map(d.asFloat);var n;if(i&&i!=="none"){var a=i.match(he);if(a){switch(a[1]){case"matrix":n=a[2].split(",").map(d.trimText).map(d.asFloat);break}}}return{origin:r,matrix:n}}function ce(e,t,i,r){var n=Te(!t?u():i.width,!t?E():i.height),a={ctx:n,opacity:se(n,e,t),cssPosition:m(e,"position"),borders:$(e),transform:r,clip:t&&t.clip?d.Extend({},t.clip):null};Y(e,a,t);if(f.useOverflow===true&&/(hidden|scroll|auto)/.test(m(e,"overflow"))===true&&/(BODY)/i.test(e.nodeName)===false){a.clip=a.clip?x(a.clip,i):i}return a}function ue(e,t,i){var r={left:t.left+e[3].width,top:t.top+e[0].width,width:t.width-(e[1].width+e[3].width),height:t.height-(e[0].width+e[2].width)};if(i){r=x(r,i)}return r}function de(e,t){var i=t.matrix?d.OffsetBounds(e):d.Bounds(e);t.origin[0]+=i.left;t.origin[1]+=i.top;return i}function N(e,t,i,r){var n=fe(e,t),a=de(e,n),o,s=ce(e,t,a,n),l=s.borders,h=s.ctx,f=ue(l,a,s.clip),c=J(e,a,l),u=p.test(e.nodeName)?"#efefef":m(e,"backgroundColor");A(h,c.clip);h.save();h.clip();if(f.height>0&&f.width>0&&!r){re(h,a,u);ae(e,f,h)}else if(r){s.backgroundColor=u}h.restore();c.borders.forEach(function(e){ee(h,e.args,e.color)});if(!i){ie(e,s)}switch(e.nodeName){case"IMG":if(o=R(e.getAttribute("src"))){b(h,e,o,a,l)}else{d.log("html2canvas: Error loading <img>:"+e.getAttribute("src"))}break;case"INPUT":if(/^(text|url|email|submit|button|reset)$/.test(e.type)&&(e.value||e.placeholder||"").length>0){C(e,a,s)}break;case"TEXTAREA":if((e.value||e.placeholder||"").length>0){C(e,a,s)}break;case"SELECT":if((e.options||e.placeholder||"").length>0){C(e,a,s)}break;case"LI":q(e,s,f);break;case"CANVAS":b(h,e,e,a,l);break}return s}function pe(e){return m(e,"display")!=="none"&&m(e,"visibility")!=="hidden"&&!e.hasAttribute("data-html2canvas-ignore")}function F(e,t,i){if(pe(e)){t=N(e,t,i,false)||t;if(!p.test(e.nodeName)){O(e,t,i)}}}function O(t,i,r){d.Children(t).forEach(function(e){if(e.nodeType===e.ELEMENT_NODE){F(e,i,r)}else if(e.nodeType===e.TEXT_NODE){_(t,e,i)}})}function e(){var e=m(Ee.documentElement,"backgroundColor"),t=d.isTransparent(e)&&r===Ee.body,i=N(r,null,false,t);O(r,i);if(t){e=i.backgroundColor}l.removeChild(n);return{backgroundColor:e,stack:i}}return e()};function ye(e){return{zindex:e,children:[]}}ve.Preload=function(o){var s={numLoaded:0,numFailed:0,numTotal:0,cleanupDone:false},i,r=ve.Util,n,e,l=0,t=o.elements[0]||Ee.body,h=t.ownerDocument,a=t.getElementsByTagName("img"),f=a.length,c=h.createElement("a"),u=function(e){return e.crossOrigin!==ge}(new Image),d;c.href=me.location.href;i=c.protocol+c.host;function p(e){c.href=e;c.href=c.href;var t=c.protocol+c.host;return t===i}function m(){r.log("html2canvas: start: images: "+s.numLoaded+" / "+s.numTotal+" (failed: "+s.numFailed+")");if(!s.firstRun&&s.numLoaded>=s.numTotal){r.log("Finished loading images: # "+s.numTotal+" (failed: "+s.numFailed+")");if(typeof o.complete==="function"){o.complete(s)}}}function E(e,t,i){var r,n=o.proxy,a;c.href=e;e=c.href;r="html2canvas_"+l++;i.callbackname=r;if(n.indexOf("?")>-1){n+="&"}else{n+="?"}n+="url="+encodeURIComponent(e)+"&callback="+r;a=h.createElement("script");me[r]=function(e){if(e.substring(0,6)==="error:"){i.succeeded=false;s.numLoaded++;s.numFailed++;m()}else{x(t,i);t.src=e}me[r]=ge;try{delete me[r]}catch(e){}a.parentNode.removeChild(a);a=null;delete i.script;delete i.callbackname};a.setAttribute("type","text/javascript");a.setAttribute("src",n);i.script=a;me.document.body.appendChild(a)}function g(e,t){var i=me.getComputedStyle(e,t),r=i.content;if(r.substr(0,3)==="url"){n.loadImage(ve.Util.parseBackgroundImage(r)[0].args[0])}_(i.backgroundImage,e)}function v(e){g(e,":before");g(e,":after")}function T(e,t){var i=ve.Generate.Gradient(e,t);if(i!==ge){s[e]={img:i,succeeded:true};s.numTotal++;s.numLoaded++;m()}}function y(e){return e&&e.method&&e.args&&e.args.length>0}function _(e,t){var i;ve.Util.parseBackgroundImage(e).filter(y).forEach(function(e){if(e.method==="url"){n.loadImage(e.args[0])}else if(e.method.match(/\-?gradient$/)){if(i===ge){i=ve.Util.Bounds(t)}T(e.value,i)}})}function R(e){var t=false;try{r.Children(e).forEach(R)}catch(e){}try{t=e.nodeType}catch(e){t=false;r.log("html2canvas: failed to access some element's nodeType - Exception: "+e.message)}if(t===1||t===ge){v(e);try{_(r.getCSS(e,"backgroundImage"),e)}catch(e){r.log("html2canvas: failed to get background-image - Exception: "+e.message)}_(e)}}function x(t,i){t.onload=function(){if(i.timer!==ge){me.clearTimeout(i.timer)}s.numLoaded++;i.succeeded=true;t.onerror=t.onload=null;m()};t.onerror=function(){if(t.crossOrigin==="anonymous"){me.clearTimeout(i.timer);if(o.proxy){var e=t.src;t=new Image;i.img=t;t.src=e;E(t.src,t,i);return}}s.numLoaded++;s.numFailed++;i.succeeded=false;t.onerror=t.onload=null;m()}}n={loadImage:function(e){var t,i;if(e&&s[e]===ge){t=new Image;if(e.match(/data:image\/.*;base64,/i)){t.src=e.replace(/url\(['"]{0,}|['"]{0,}\)$/gi,"");i=s[e]={img:t};s.numTotal++;x(t,i)}else if(p(e)||o.allowTaint===true){i=s[e]={img:t};s.numTotal++;x(t,i);t.src=e}else if(u&&!o.allowTaint&&o.useCORS){t.crossOrigin="anonymous";i=s[e]={img:t};s.numTotal++;x(t,i);t.src=e}else if(o.proxy){i=s[e]={img:t};s.numTotal++;E(e,t,i)}}},cleanupDOM:function(e){var t,i;if(!s.cleanupDone){if(e&&typeof e==="string"){r.log("html2canvas: Cleanup because: "+e)}else{r.log("html2canvas: Cleanup after timeout: "+o.timeout+" ms.")}for(i in s){if(s.hasOwnProperty(i)){t=s[i];if(typeof t==="object"&&t.callbackname&&t.succeeded===ge){me[t.callbackname]=ge;try{delete me[t.callbackname]}catch(e){}if(t.script&&t.script.parentNode){t.script.setAttribute("src","about:blank");t.script.parentNode.removeChild(t.script)}s.numLoaded++;s.numFailed++;r.log("html2canvas: Cleaned up failed img: '"+i+"' Steps: "+s.numLoaded+" / "+s.numTotal)}}}if(me.stop!==ge){me.stop()}else if(Ee.execCommand!==ge){Ee.execCommand("Stop",false)}if(Ee.close!==ge){Ee.close()}s.cleanupDone=true;if(!(e&&typeof e==="string")){m()}}},renderingDone:function(){if(d){me.clearTimeout(d)}}};if(o.timeout>0){d=me.setTimeout(n.cleanupDOM,o.timeout)}r.log("html2canvas: Preload starts: finding background-images");s.firstRun=true;R(t);r.log("html2canvas: Preload: Finding images");for(e=0;e<f;e+=1){n.loadImage(a[e].getAttribute("src"))}s.firstRun=false;r.log("html2canvas: Preload: Done.");if(s.numTotal===s.numLoaded){m()}return n};ve.Renderer=function(e,i){function t(e){var o=[],t;t=function e(t){var i={};function h(e,t,i){var r=t.zIndex.zindex==="auto"?0:Number(t.zIndex.zindex),n=e,a=t.zIndex.isPositioned,o=t.zIndex.isFloated,s={node:t},l=i;if(t.zIndex.ownStacking){n=s.context={"!":[{node:t,children:[]}]};l=ge}else if(a||o){l=s.children=[]}if(r===0&&i){i.push(s)}else{if(!e[r]){e[r]=[]}e[r].push(s)}t.zIndex.children.forEach(function(e){h(n,e,l)})}h(i,t);return i}(e);function s(a){Object.keys(a).sort().forEach(function(e){var t=[],i=[],r=[],n=[];a[e].forEach(function(e){if(e.node.zIndex.isPositioned||e.node.zIndex.opacity<1){r.push(e)}else if(e.node.zIndex.isFloated){i.push(e)}else{t.push(e)}});(function t(e){e.forEach(function(e){n.push(e);if(e.children){t(e.children)}})})(t.concat(i,r));n.forEach(function(e){if(e.context){s(e.context)}else{o.push(e.node)}})})}s(t);return o}function r(e){var t;if(typeof i.renderer==="string"&&ve.Renderer[e]!==ge){t=ve.Renderer[e](i)}else if(typeof e==="function"){t=e(i)}else{throw new Error("Unknown renderer")}if(typeof t!=="function"){throw new Error("Invalid renderer defined")}return t}return r(i.renderer)(e,i,Ee,t(e.stack),ve)};ve.Util.Support=function(e,a){function t(){var e=new Image,t=a.createElement("canvas"),i=t.getContext===ge?false:t.getContext("2d");if(i===false){return false}t.width=t.height=10;e.src=["data:image/svg+xml,","<svg xmlns='http://www.w3.org/2000/svg' width='10' height='10'>","<foreignObject width='10' height='10'>","<div xmlns='http://www.w3.org/1999/xhtml' style='width:10;height:10;'>","sup","</div>","</foreignObject>","</svg>"].join("");try{i.drawImage(e,0,0);t.toDataURL()}catch(e){return false}ve.Util.log("html2canvas: Parse: SVG powered rendering available");return true}function i(){var e,t,i,r,n=false;if(a.createRange){e=a.createRange();if(e.getBoundingClientRect){t=a.createElement("boundtest");t.style.height="123px";t.style.display="block";a.body.appendChild(t);e.selectNode(t);i=e.getBoundingClientRect();r=i.height;if(r===123){n=true}a.body.removeChild(t)}}return n}return{rangeBounds:i(),svgRendering:e.svgRendering&&t()}};THREE.html2canvas=function(e,t){e=e.length?e:[e];var i,r,n={logging:false,elements:e,background:"#fff",proxy:null,timeout:0,useCORS:false,allowTaint:false,svgRendering:false,ignoreElements:"IFRAME|OBJECT|PARAM",useOverflow:true,letterRendering:false,chinese:false,width:null,height:null,taintTest:true,renderer:"Canvas"};n=ve.Util.Extend(t,n);ve.logging=n.logging;n.complete=function(e){if(typeof n.onpreloaded==="function"){if(n.onpreloaded(e)===false){return}}i=ve.Parse(e,n);if(typeof n.onparsed==="function"){if(n.onparsed(i)===false){return}}r=ve.Renderer(i,n);if(typeof n.onrendered==="function"){n.onrendered(r)}};me.setTimeout(function(){ve.Preload(n)},0);return{render:function(e,t){return ve.Renderer(e,ve.Util.Extend(t,n))},parse:function(e,t){return ve.Parse(e,ve.Util.Extend(t,n))},preload:function(e){return ve.Preload(ve.Util.Extend(e,n))},log:ve.Util.log}};THREE.html2canvas.log=ve.Util.log;THREE.html2canvas.Renderer={Canvas:ge};ve.Renderer.Canvas=function(i){i=i||{};var t=Ee,r=[],n=Ee.createElement("canvas"),a=n.getContext("2d"),f=ve.Util,c=i.canvas||t.createElement("canvas");function o(t,e){t.beginPath();e.forEach(function(e){t[e.name].apply(t,e["arguments"])});t.closePath()}function s(e){if(r.indexOf(e["arguments"][0].src)===-1){a.drawImage(e["arguments"][0],0,0);try{a.getImageData(0,0,1,1)}catch(e){n=t.createElement("canvas");a=n.getContext("2d");return false}r.push(e["arguments"][0].src)}return true}function u(e,t){switch(t.type){case"variable":e[t.name]=t["arguments"];break;case"function":switch(t.name){case"createPattern":if(t["arguments"][0].width>0&&t["arguments"][0].height>0){try{e.fillStyle=e.createPattern(t["arguments"][0],"repeat")}catch(e){f.log("html2canvas: Renderer: Error creating pattern",e.message)}}break;case"drawShape":o(e,t["arguments"]);break;case"drawImage":if(t["arguments"][8]>0&&t["arguments"][7]>0){if(!i.taintTest||i.taintTest&&s(t)){e.drawImage.apply(e,t["arguments"])}}break;default:e[t.name].apply(e,t["arguments"])}break}}return function(e,t,i,r,n){var a=c.getContext("2d"),o,s,l,h=e.stack;c.width=c.style.width=t.width||h.ctx.width;c.height=c.style.height=t.height||h.ctx.height;l=a.fillStyle;a.fillStyle=f.isTransparent(h.backgroundColor)&&t.background!==ge?t.background:e.backgroundColor;a.fillRect(0,0,c.width,c.height);a.fillStyle=l;r.forEach(function(e){a.textBaseline="bottom";a.save();if(e.transform.matrix){a.translate(e.transform.origin[0],e.transform.origin[1]);a.transform.apply(a,e.transform.matrix);a.translate(-e.transform.origin[0],-e.transform.origin[1])}if(e.clip){a.beginPath();a.rect(e.clip.left,e.clip.top,e.clip.width,e.clip.height);a.clip()}if(e.ctx.storage){e.ctx.storage.forEach(function(e){u(a,e)})}a.restore()});f.log("html2canvas: Renderer: Canvas renderer done - returning canvas obj");if(t.elements.length===1){if(typeof t.elements[0]==="object"&&t.elements[0].nodeName!=="BODY"){s=n.Util.Bounds(t.elements[0]);o=i.createElement("canvas");o.width=Math.ceil(s.width);o.height=Math.ceil(s.height);a=o.getContext("2d");a.drawImage(c,s.left,s.top,s.width,s.height,0,0,s.width,s.height);c=null;return o}}return c}}})(window,document);(function(){var l={VERSION:"0.9_20141123",IS_BETA:true,ALIAS:"WIP_MinorSnow"};l.AudioUnit=function(e){this._status=this.createStatus();this._status.id=e;Object.defineProperties(this,{isAudioUnit:{enumerable:true,get:function(){return this._status.isAudioUnit}},id:{enumerable:true,get:function(){return this._status.id}},connection:{enumerable:true,get:function(){var e=Object.create(this._status.connection);return e}}})};l.AudioUnit.prototype.createStatus=function(){return new l.AudioUnit.Status};l.AudioUnit.prototype.connect=function(e,t,i,r){if(e.id!=null||r!=null){var n=null;if(e.id!=null){n=e.id}else if(r!=null){n=r}n+="["+(t!=null?t:"0")+":"+(i!=null?i:"0")+"]";this._status.connection.push(n)}};l.AudioUnit.prototype.disconnect=function(e,t,i){if(e.id!=null||i!=null){var r=-1;var n="";if(e.id!=null){n=e.id}else if(i!=null){n=i}n+="["+(t!=null?t:"0");for(var a=0;a<this._status.connection.length;a++){if(this._status.connection[a].substring(0,n.length)===n){r=a;break}}if(r>=0){this._status.connection.splice(r,1)}}};l.AudioUnit.Status=function(){this.className="snd.AudioUnit";this.isAudioUnit=true;this.id="";this.connection=[];this.channelCount=2;this.channelCountMode="max";this.channelInterpretation="discrete"};l.Source=function(e){l.AudioUnit.apply(this,arguments);this._gain=l.AUDIO_CONTEXT.createGain();Object.defineProperties(this,{isSource:{get:function(){return this._status.isSource}},volumeParam:{get:function(){var e=this.gain.gain;if(e.id==null){e.id=this.id+".gain"}return e}},volume:{get:function(){return this._gain.gain.value},set:function(e){this._gain.gain.value=e;this._status.volume=e}},status:{get:function(){return this._status.status}}})};l.Source.prototype=Object.create(l.AudioUnit.prototype);l.Source.prototype.constructor=l.Source;l.Source.CLASS_NAME="snd.Source";l.Source.prototype.connect=function(e,t,i,r){l.AudioUnit.prototype.connect.apply(this,arguments);if(e.isAudioUnit||e.getConnector!=null){this._gain.connect(e.getConnector(),t,i)}else{this._gain.connect(e,t,i)}};l.Source.prototype.disconnect=function(e,t){l.AudioUnit.prototype.disconnect.apply(this,arguments);if(e.isAudioUnit||e.getConnector!=null){this._gain.disconnect(e.getConnector())}else{this._gain.disconnect(e)}};l.Source.prototype.getConnector=function(){return this._gain};l.Source.prototype.createStatus=function(){return new l.Source.Status};l.Source.Status=function(){l.AudioUnit.Status.apply(this,arguments);this.status=l.status.NONE;this.volume=1;this.isSource=true;this.className=l.Source.CLASS_NAME};l.MediaElementAudioSource=function(e,t){l.Source.apply(this,arguments);this.id=e;Object.defineProperties(this,{element:{get:function(){return this._element},set:function(e){var t=this;this._source=l.AUDIO_CONTEXT.createMediaElementSource(e);this._source.connect(this._gain);this._element=e;if(this._element.id!=null){this._status.element=this._element.id}this._element.onplay=function(){t._status.status=l.status.STARTED};this._element.onpause=function(){t._status.status=l.status.PAUSED};this._element.onended=function(){t._status.status=l.status.PAUSED};this._element.oncanplay=function(){if(t.status==l.status.NONE){t._status.status=l.status.READY}}}},src:{get:function(){return this._element.src},set:function(e){this._element.src=e}}});if(t!=null){this.element=t}};l.MediaElementAudioSource.prototype=Object.create(l.Source.prototype);l.MediaElementAudioSource.prototype.constructor=l.MediaElementAudioSource;l.MediaElementAudioSource.CLASS_NAME="snd.MediaElementAudioSource";l.MediaElementAudioSource.prototype.createStatus=function(){return new l.MediaElementAudioSource.Status};l.MediaElementAudioSource.Status=function(){l.Source.Status.apply(this,arguments);this.className=l.MediaElementAudioSource.CLASS_NAME;this.status=l.status.NONE;this.element=""};l.MediaElementAudioSource.Status.prototype=Object.create(l.Source.Status.prototype);l.MediaElementAudioSource.Status.prototype.constructor=l.MediaElementAudioSource.Status;l.AudioMaster=function(){this.unitList={};this._gain=l.AUDIO_CONTEXT.createGain();this._gain.channelCount=l.MAX_CHANNEL_COUNT;this._gain.connect(l.AUDIO_CONTEXT.destination);this.id=l.AudioMaster.ID};l.AudioMaster.ID="snd.MASTER";l.AudioMaster.prototype.connectAudioUnit=function(e,t){if(e==null&&t.id==null){throw"key == null && audioUnit.id == null"}if(e==null){if(this.unitList[t.id]==null){this.unitList[t.id]=t;t.connect(this._gain,l.AudioMaster.ID)}}else{this.unitList[e]=t;t.connect(this._gain,l.AudioMaster.ID)}};l.AudioMaster.prototype.disconnectAudioUnit=function(e){var t=this.unitList[e];t.getConnector().disconnect(this._gain);delete this.unitList[e]};l.AudioMaster.prototype.getConnector=function(){return this._gain};l._AUDIO_CONTEXT=null;l._MASTER=null;l.init=function(){if(l._AUDIO_CONTEXT==null){if("AudioContext"in window){l._AUDIO_CONTEXT=new AudioContext}else if("webkitAudioContext"in window){l._AUDIO_CONTEXT=new webkitAudioContext}l._AUDIO_CONTEXT.destination.channelCount=l._AUDIO_CONTEXT.destination.maxChannelCount}Object.defineProperties(l,{MAX_CHANNEL_COUNT:{writable:false,value:l._AUDIO_CONTEXT.destination.maxChannelCount},status:{value:function(){var e={};Object.defineProperties(e,{NONE:{value:"none",writable:false},READY:{value:"ready",writable:false},STARTED:{value:"started",writable:false},PAUSED:{value:"paused",writable:false},STOPPED:{value:"ended",writable:false}});return e}(),writable:false},AUDIO_CONTEXT:{get:function(){return l._AUDIO_CONTEXT}},MASTER:{get:function(){return l._MASTER}}});l._MASTER=new l.AudioMaster;l.SOUND_ENVIRONMENT=new l.SoundEnvironment};l.three={version:.1,beta:true};l.PosDir=function(){this._pos={x:0,y:0,z:0};this._dir={x:0,y:0,z:0};this._up={x:0,y:0,z:0};Object.defineProperties(this,{pos:{get:function(){var t=this;var e={};Object.defineProperties(e,{x:{get:function(){return t._pos.x},set:function(e){t._pos.x=e}},y:{get:function(){return t._pos.y},set:function(e){t._pos.y=e}},z:{get:function(){return t._pos.z},set:function(e){t._pos.z=e}}});return e}},dir:{get:function(){var t=this;var e={};Object.defineProperties(e,{x:{get:function(){return t._dir.x},set:function(e){t._dir.x=e}},y:{get:function(){return t._dir.y},set:function(e){t._dir.y=e}},z:{get:function(){return t._dir.z},set:function(e){t._dir.z=e}}});return e}},up:{get:function(){var t=this;var e={};Object.defineProperties(e,{x:{get:function(){return t._up.x},set:function(e){t._up.x=e}},y:{get:function(){return t._up.y},set:function(e){t._up.y=e}},z:{get:function(){return t._up.z},set:function(e){t._up.z=e}}});return e}}})};l.PosDir.prototype.setPosition=function(e,t,i){this.pos.x=e;this.pos.y=t;this.pos.z=i};l.PosDir.prototype.setOrientation=function(e,t,i,r,n,a){this.dir.x=e;this.dir.y=t;this.dir.z=i;this.up.x=r;this.up.y=n;this.up.z=a};l.Listener=function(e){l.PosDir.apply(this,arguments);this.listener=e;if(e!=null){this.listener.setOrientation(this.dir.x,this.dir.y,this.dir.z,this.up.x,this.up.y,this.up.z)}};l.Listener.prototype=Object.create(l.PosDir.prototype);l.Listener.prototype.constructor=l.Listener;l.Listener.prototype.setListener=function(e){this.listener=e;this.setPosition(this.pos.x,this.pos.y,this.pos.z);this.setOrientation(this.dir.x,this.dir.y,this.dir.z,this.up.x,this.up.y,this.up.z)};l.Listener.prototype.resetListener=function(){this.setListener(null)};l.Listener.prototype.setPosition=function(e,t,i){l.PosDir.prototype.setPosition.call(this,e,t,i);if(this.listener!=null){this.listener.setPosition(l.SOUND_ENVIRONMENT.unit*this.pos.x,l.SOUND_ENVIRONMENT.unit*this.pos.y,l.SOUND_ENVIRONMENT.unit*this.pos.z)}};l.Listener.prototype.setOrientation=function(e,t,i,r,n,a){l.PosDir.prototype.setOrientation.call(this,e,t,i,r,n,a);if(this.listener!=null){this.listener.setOrientation(this.dir.x,this.dir.y,this.dir.z,this.up.x,this.up.y,this.up.z)}};l.SoundEnvironment=function(){this.now=0;this.listener=l.AUDIO_CONTEXT.listener;this.listeners={};this.soundNodes={};this.unit=.1;this.cameras={};this.attaches={};this.linkMap={}};l.SoundEnvironment.DEFAULT_BUFFER_MAX=1800;l.SoundEnvironment.prototype.addListener=function(e,t){this.listeners[e]=new l.PosDirTime(t,1)};l.SoundEnvironment.prototype.removeListener=function(e){if(this.soundNodes[e]!=null){delete this.soundNodes[e]}};l.SoundEnvironment.prototype.addSoundNode=function(e,t){this.soundNodes[e]=new l.PosDirTime(t)};l.SoundEnvironment.prototype.removeSoundNode=function(e){if(this.soundNodes[e]!=null){delete this.soundNodes[e]}};l.SoundEnvironment.prototype.update=function(e){if(this.now>e){throw new l.SoundEnvironment.UpdateError(this,"time < this.now (time: "+e+", this.now: "+this.now)}for(var t in this.listeners){this.listeners[t].update(e)}for(var t in this.soundNodes){this.soundNodes[t].update(e)}};l.SoundEnvironment.UpdateError=function(e,t){this._this=e;this.message=t};l.PosDirTime=function(e,t){this.data=e;this.history=[];this.bufferMax=t};l.PosDirTime.prototype.update=function(e){if(this.history.length==0){this.history.push({time:0,posture:Object.create(this.data)})}if(this.history.length>this.bufferMax){this.history.splice(0,1)}this.history.push({time:e,posture:Object.create(this.data)})};l.PosDirTime.prototype.getPosture=function(e){var t=this.search(e);if(t==null){return null}else if(t.left==t.right){return this.history[t.left]}var i=this.history[i];var r=this.history[r];var n=(e-i.time)/(r.time-i.time);return l.PosDir.interpolation(i,r,n)};l.PosDirTime.prototype.search=function(e){if(this.history.length<=0){return null}else if(this.history.length==1){return{left:0,right:0}}else if(this.history[this.history.length-1].time<e){return{left:this.history.length-1,right:this.history.legnth-1}}else if(this.history[0].time>e){return{left:0,right:0}}var t=0,i=this.history.length-1;var r=Math.floor(i/2);while(true){r=Math.floor((e-this.history[t].time)*(i-t)/(this.history[i].time-this.history[t].time))+t;if(this.history[r].time<e){if(this.history[r+1]>e){return{left:r,right:r+1}}t=r+1}else if(this.history[r].time>e){if(this.history[r-1].time<e){return{left:r-1,right:r}}i=r-1}else{return{left:r,right:r}}}};l.SoundNode=function(e){l.AudioUnit.apply(this,arguments);l.PosDir.apply(this,arguments);this.gain=l.AUDIO_CONTEXT.createGain();this.pannerNode=l.AUDIO_CONTEXT.createPanner();this.gain.connect(this.pannerNode)};l.SoundNode.prototype=Object.create(l.AudioUnit.prototype);l.SoundNode.prototype.constructor=l.SoundNode;l.SoundNode.prototype.connect=function(e,t,i,r){l.AudioUnit.prototype.connect.apply(this,arguments);if(e.isAudioUnit){this.pannerNode.connect(e.getConnector())}else{this.pannerNode.connect(e)}};l.SoundNode.prototype.disconnect=function(e){l.AudioUnit.prototype.disconnect.apply(this,arguments);if(e.isAudioUnit){this.pannerNode.disconnect(e.getConnector())}else{this.pannerNode.disconnect(e)}};l.SoundNode.prototype.getConnector=function(){return this.gain};l.SoundNode.prototype.setPosition=function(e,t,i){l.PosDir.prototype.setPosition.call(this,e,t,i);this.pannerNode.setPosition(l.SOUND_ENVIRONMENT.unit*this.pos.x,l.SOUND_ENVIRONMENT.unit*this.pos.y,l.SOUND_ENVIRONMENT.unit*this.pos.z)};l.SoundNode.prototype.setDir=function(e,t,i){l.PosDir.prototype.setDir.call(this,e,t,i);this.pannerNode.setOrientation(this.dir.x,this.dir.y,this.dir.z)};l.SoundNode.prototype.setUp=function(e,t,i){l.PosDir.prototype.setUp.call(this,e,t,i)};l.SoundNode.prototype.setOrientation=function(e,t,i,r,n,a){l.PosDir.prototype.setOrientation.call(this,e,t,i,r,n,a);this.pannerNode.setOrientation(this.dir.x,this.dir.y,this.dir.z)};l.BufferSoundNode=function(e,t){l.SoundNode.apply(this,arguments);if(t==null){this.source=new l.BufferSource(e+"_src")}else{this.source=t}this.source.connect(this)};l.BufferSoundNode.prototype=Object.create(l.SoundNode.prototype);l.BufferSoundNode.prototype.constructor=l.BufferSoundNode;l.BufferSoundNode.prototype.setAudioBuffer=function(e){this.source.setAudioBuffer(e)};l.three.update=function(e,t){if(l.SOUND_ENVIRONMENT.cameras[e.id]==null){console.log("mainCamera("+e.toString()+") is not added.");return}if(l.SOUND_ENVIRONMENT.cameras[e.id].listener.listener==null){for(var i in l.SOUND_ENVIRONMENT.cameras){l.SOUND_ENVIRONMENT.cameras[i].listener.resetListener()}l.SOUND_ENVIRONMENT.cameras[e.id].listener.setListener(l.AUDIO_CONTEXT.listener)}for(var i in l.SOUND_ENVIRONMENT.cameras){var r=l.SOUND_ENVIRONMENT.cameras[i].camera;var n=l.SOUND_ENVIRONMENT.cameras[i].listener;l.three.link(r,n)}for(var i in l.SOUND_ENVIRONMENT.attaches){var a=l.SOUND_ENVIRONMENT.attaches[i].object;for(var o=0;o<l.SOUND_ENVIRONMENT.attaches[i].sources.length;o++){var s=l.SOUND_ENVIRONMENT.attaches[i].sources[o];l.three.link(a,s)}}};l.three.addCamera=function(e){var t=e.id;if(l.SOUND_ENVIRONMENT.cameras[t]!=null){console.warn("snd.SOUND_ENVIRONMENT already has camera("+e.toString()+").");return}var i=new l.Listener(null);l.SOUND_ENVIRONMENT.cameras[t]={camera:e,listener:i};l.SOUND_ENVIRONMENT.addListener(i)};l.three.removeCamera=function(e){if(l.SOUND_ENVIRONMENT.cameras[e.id]!=null){l.SOUND_ENVIRONMENT.removeListener(l.SOUND_ENVIRONMENT.cameras[e.id].listener);delete l.SOUND_ENVIRONMENT.cameras[e.id]}};l.three.attach=function(e,t){var i=e.id;if(l.SOUND_ENVIRONMENT.attaches[i]==null){l.SOUND_ENVIRONMENT.attaches[i]={object:e,sources:[]}}l.SOUND_ENVIRONMENT.attaches[i].sources.push(t);l.SOUND_ENVIRONMENT.linkMap[t.id]=i};l.three.detach=function(e){var t=e.id;if(l.SOUND_ENVIRONMENT.linkMap[t]!=null){var i=l.SOUND_ENVIRONMENT.linkMap[t];var r=l.SOUND_ENVIRONMENT.attaches[i].sources.indexOf(e);if(r>=0){l.SOUND_ENVIRONMENT.attaches[i].sources.splice(r,1)}delete l.SOUND_ENVIRONMENT.linkMap[t]}};l.three.link=function(e,t){if(!isNaN(e.position.x)&&!isNaN(e.position.y)&&!isNaN(e.position.z)&&!isNaN(e.quaternion.x)&&!isNaN(e.quaternion.y)&&!isNaN(e.quaternion.z)&&!isNaN(e.quaternion.w)){var i=new THREE.Matrix4;i.copy(e.matrixWorld);var r=new THREE.Matrix4;r.copy(i);r.elements[12]=0;r.elements[13]=0;r.elements[14]=0;var n=new THREE.Vector3(i.elements[12],i.elements[13],i.elements[14]);var a=new THREE.Vector3(-i.elements[8],-i.elements[9],-i.elements[10]);var o=new THREE.Vector3;o.copy(e.up);o.applyMatrix4(r);t.setPosition(n.x,n.y,n.z);t.setOrientation(a.x,a.y,a.z,o.x,o.y,o.z)}};THREE.snd=l})();!function(window,$,undefined){var core_version="2.1.2",rootObj,jThree=function(e,t){return new jThree.fn.init(e,t)},dom_state=false,dom_wait=[],goml_state=false,goml_wait=[],src_state=false,src_wait=[];function checkRenderingContext(){var e=document.createElement("canvas");return window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl"))}(function(){function i(e){if(dom_state)return;dom_state=true;if(!checkRenderingContext())return;rootObj=$("<iframe style='display:none;'/>").appendTo("body").contents();var t=$("[type='text/goml']").length;function a(){if(--t)return;goml_state=true;goml_wait.forEach(function(e){e(jThree)});t=a=goml_wait=null;if(MMD_SA_options.MMD_disabled){var e=jThree;MMD_SA.fn.x_object_init();MMD_SA._tray_updatable=true;System._browser.update_tray();if(jThree.Trackball)jThree.trackball=jThree.Trackball;e.trackball();if(!returnBoolean("MMDTrackballCamera"))MMD_SA._trackball_camera.stop();MMD_SA.MMD_started=true;e.MMD.play(true);DEBUG_show("(MMD started)",2);if(MMD_SA.use_webgl2)DEBUG_show("Use WebGL2",2)}}$("[type='text/goml']").each(function(){var e=this.getAttribute("src");var i;if(self.MMD_SA&&!e){i="<goml>\n"+"\t<head>\n"+(MMD_SA.GOML_import?"<import>\n"+MMD_SA.GOML_import+"</import>\n":"")+MMD_SA.GOML_head;if(!MMD_SA_options.MMD_disabled){i+='<model id="mikuPmx0" src="'+(/^(\w+\:|\/)/.test(MMD_SA_options.model_path)?toFileProtocol(MMD_SA_options.model_path):MMD_SA_options.model_path)+'" onLoad="(self.MMD_SA||parent.MMD_SA).fn.setupUI()" />\n';MMD_SA_options.model_path_extra.forEach(function(e,t){i+='<model id="mikuPmx'+(t+1)+'" src="'+toFileProtocol(e)+'" onLoad="(self.MMD_SA||parent.MMD_SA).fn.setupUI()" />\n'});for(var t=0,r=MMD_SA_options.motion.length;t<r;t++){var n=MMD_SA_options.motion[t];if(n.path)i+='<motion id="vmd'+t+'" src="'+toFileProtocol(/^(\w+\:|\/)/.test(n.path)?n.path:System.Gadget.path+"/"+n.path)+'" onLoad="(self.MMD_SA||parent.MMD_SA).fn.setupUI()" />\n'}}i+='\t\t<rdr id="MMD_renderer" param="canvas:SL;antialias:true;clearAlpha:0;preserveDrawingBuffer:true; stencil:false;" frame="MMD_SA" />\n'+"\t</head>\n"+"\t<body>\n"+'\t\t<scene id="MMD_scene">\n';i+='\t\t\t<light id="MMD_AmbLight" type="Amb"'+(MMD_SA_options.ambient_light_color?' param="'+MMD_SA_options.ambient_light_color+'"':"")+" />\n"+'\t\t\t<light id="MMD_DirLight" type="Dir" param="'+MMD_SA_options.light_color+'" style="position:'+MMD_SA_options.light_position.join(" ")+';" />\n';i+=MMD_SA.GOML_scene;if(!MMD_SA_options.MMD_disabled){i+='<mmd model="#mikuPmx0" onLoad="(self.MMD_SA||parent.MMD_SA).fn.setupUI()" />\n';MMD_SA_options.model_path_extra.forEach(function(e,t){i+='<mmd model="#mikuPmx'+(t+1)+'" onLoad="(self.MMD_SA||parent.MMD_SA).fn.setupUI()" />\n'})}i+='\t\t\t<camera id="MMD_camera" '+(MMD_SA_options.camera_type?'type="'+MMD_SA_options.camera_type+'" ':"")+(MMD_SA_options.camera_param?'param="'+(typeof MMD_SA_options.camera_param=="string"?MMD_SA_options.camera_param:MMD_SA_options.camera_param.join(" "))+'" ':"")+'style="position:'+MMD_SA_options.camera_position.join(" ")+"; lookAt:"+(MMD_SA_options.camera_position[0]+" "+MMD_SA_options.camera_position[1])+' 0;" />\n'+"\t\t</scene>\n"+"\t</body>\n"+"</goml>"}jThree.goml(e?e:i||this.innerHTML,a)});$.each(dom_wait,function(e,t){jThree.goml(t[0],t[1],t[2])});if(self.MMD_SA){e&&document.removeEventListener("DOMContentLoaded",i,false);e&&window.removeEventListener("load",i,false);MMD_SA.jThree_ready=null}i=dom_wait=null}if(self.MMD_SA){MMD_SA.jThree_ready=function(){window.dispatchEvent(new CustomEvent("jThree_ready"));i();window.dispatchEvent(new CustomEvent("GOML_ready"))}}else if(document.readyState==="complete"){i()}else{document.addEventListener("DOMContentLoaded",i,false);window.addEventListener("load",i,false)}})();jThree.goml=function(){var o=[];return function(e,t,i,r){if(!checkRenderingContext()){i&&i(jThree);return}else if(i===false){r=false}if(!dom_state){dom_wait.push([e,t,r])}else if(/<.+?>/.test(e)){if(o.length){o.push([e,t,r])}else{parseGOML(e,r);if(src_state){t&&t(jThree)}else{t&&src_wait.push(t)}}}else{var n=[e,t,r];o.push(n);function a(){for(var e=0,t=o.length,i;e<t;e++){i=o[e];if(/<.+?>/.test(i[0])){parseGOML(i[0],i[2]);if(src_state){i[1]&&i[1](jThree)}else{i[1]&&src_wait.push(i[1])}}else{o=o.slice(e);break}}a=n=null}$.ajax({url:e,async:true,dataType:"text",success:function(e){n[0]=e;if(o[0]!==n)return;a()},error:function(){if(o[0]!==n){o.splice(o.indexOf(n),1)}else{o.shift();a()}}})}}}();$.extend(jThree,$);jThree.fn=jThree.prototype=new $;jThree.fn.extend({jThree:core_version,constructor:jThree,init:function(e,t,i){if(!e){return this}else if(typeof e==="string"){if(/<.+?>/.test(e)){e=parseGOML(e)}else if(t){e=rootObj.find(t).find(e)}else{e=rootObj.find(e)}}else if(e.userData){e=e.userData.dom}else if(e===document){e=rootObj}else if(typeof e==="function"){if(!checkRenderingContext()){t&&t(jThree);return}else if(t===false){i=false}if(i===false){if(goml_state){e(jThree)}else{goml_wait.push(e)}}else{if(src_state){e(jThree)}else{src_wait.push(e)}}return}$.makeArray(e,this)}});jThree.fn.init.prototype=jThree.fn;$.support.webgl=checkRenderingContext();jThree.modelHooks={};jThree.motionHooks={};jThree.geoHooks={};jThree.mtlHooks={};var THREE_obj=[];var tmp_root=$();var importFrame;var importStates="none";jThree.fn.contents=function(){return this[0].tagName==="IMPORT"?importFrame.contents():this};var parseGOML=function(){var tag_name="IMPORT MMD MODEL MOTION SCENE CAMERA TXR MTL GEO LIGHT OBJ PTS SPRITE MESH RDR".split(" ");var loadLength=0;function getDom(){return this.userData.dom}THREE.Object3D.prototype.dom=THREE.Material.prototype.dom=THREE.Geometry.prototype.dom=getDom;function setObj(r,n){r.setAttribute("three",THREE_obj.length);THREE_obj.push(n);if(n instanceof THREE.Object3D){n.userData.dom=r}else{n.userData={};n.userData.dom=r;if(n instanceof THREE.Material){n.userData.clone=[]}else if(!(n instanceof THREE.Geometry)){n.dom=getDom}}$.each(Object.assign({},r.attributes),function(e,t){var i=r.getAttribute(t.name);if(prop[t.name]&&t.value){prop[t.name].call(r,t.value)}});if(n instanceof THREE.Object3D){if(r.getAttribute("jstyle")){$.each(getHash(r.getAttribute("jstyle")),function(e,t){var i=styleAdmin(n,e);if(typeof i==="number"){t=isNaN(+t)?t:+t}else if(Array.isArray(i)){if(i.color){if(/ /.test(t)){t=getArr(t)}}else{t=getArr(t);if(t.length===1){t[1]=t[2]=t[0]}}}styleAdmin(n,e,t)})}}r=n=null}jThree.extend({getCamera:function(e){var t=getObj(e).__camera;return t&&t.userData.dom},getScene:function(e){var t=getObj(e).__camera;return t&&t.userData.scene&&t.userData.scene.userData.dom},getCanvas:function(e){return getObj(e).domElement}});function addCamera(){$.each(this.userData.renderer,function(){animationFrame(this);this.__resize()})}function removeCamera(){$.each(this.userData.renderer,function(){animationFrame(this,false)})}function newCloneNode(e){var t=this.cloneNode(e===undefined?true:e);parseGOML(t);return t}function srcLoaded(){if(!--loadLength){setTimeout(function(){src_state=true;src_wait.forEach(function(e){e(jThree)});src_wait.length=0},0);$.event.remove(this,"load",srcLoaded);$.event.remove(this,"error",srcErrored)}}function srcErrored(){srcLoaded.call(this)}return function(goml,srcWaiting){var tmp,that,obj,waitRdr={},obj3D=[];var html=typeof goml==="string"&&/<\/import>/.test(goml)?goml.match(/<import(.|\n|\r)*?import>/)[0].replace(/^(.+)?>/,"").replace(/<\/import>$/,""):"";var jq=$(typeof goml==="string"?goml.replace(html,"").replace(/^<\?(.+)?\?>/,"").replace(/^[\n\r\s\t]*/,"").replace(/(head|body)>/g,"j$1>").replace(/ style=/g," jstyle="):goml);var isRoot=jq[0].tagName==="GOML";var tmp_list={};$.each(tag_name,function(e,t){tmp_list[t]=[]});jq.add(jq.find("*")).each(function(){this.cloneNode=newCloneNode;if(tag_name.indexOf(this.tagName)===-1)return;tmp_list[this.tagName].push(this);if(srcWaiting!==false&&isRoot&&this.hasAttribute("src")||this.hasAttribute("model")||this.hasAttribute("motion")||this.hasAttribute("html")||this.hasAttribute("video")||this.hasAttribute("canvas")||this.tagName==="IMPORT"){loadLength++;$.event.add(this,"load",srcLoaded);$.event.add(this,"error",srcErrored)}});if(isRoot){rootObj.find("head").append(jq.find("jhead").children());rootObj.find("body").append(jq.find("jbody").children())}tmp_root=tmp_root.add(jq);$.each(tmp_list.IMPORT,function(){if(!importFrame){tmp=getHash(this.getAttribute("param"));importFrame=$('<iframe frameborder="0" style="border: none;position: fixed; top: 110%;" />').appendTo("body").width(tmp.width||1e3).height(tmp.height||1e3)}importStates="loading";var e=this;var t=importFrame.one("load",function(){importStates="success";$.event.trigger("load",undefined,e);e=null}).contents()[0];if(this.hasAttribute("href")){importFrame[0].src=this.getAttribute("href")}else{this.innerText=html;t.open();t.write(html);t.close()}});$.each(tmp_list.MODEL.concat(tmp_list.MOTION),function(){setObj(this,{})});$.each(tmp_list.MMD,function(){setObj(this,new THREE.Object3D)});Array.prototype.push.apply(obj3D,tmp_list.MMD);$.each(tmp_list.SCENE,function(){setObj(this,new THREE.Scene)});if(self.MMD_SA&&!MMD_SA.scene){MMD_SA.scene=THREE_obj[THREE_obj.length-1];MMD_SA.scene._RAF_timestamp_=-1;if(MMD_SA_options.fog){if(MMD_SA_options.fog.linear){MMD_SA.scene.fog=new THREE.Fog(MMD_SA_options.fog.color||0,MMD_SA_options.fog.near||undefined,MMD_SA_options.fog.far||undefined)}else{MMD_SA.scene.fog=new THREE.FogExp2(MMD_SA_options.fog.color||0,MMD_SA_options.fog.density==null?.005:MMD_SA_options.fog.density)}}}$.each(tmp_list.CAMERA,function(){that=this;tmp=that.getAttribute("param");tmp=/:/.test(tmp)?getHash(tmp):getArr(tmp);if(self.MMD_SA&&MMD_SA_options.use_JSARToolKit){obj=new THREE.PerspectiveCamera(49,MMD_SA_options.width/MMD_SA_options.height,.1,1e4);obj.matrixAutoUpdate=false;obj.setJsArMatrix(MMD_SA.AR_obj.param);MMD_SA.AR_obj.camera_position=new THREE.Vector3(MMD_SA_options.camera_position[0],MMD_SA_options.camera_position[1],MMD_SA_options.camera_position[2]);obj.matrix.identity();obj.matrix.setPosition(MMD_SA.AR_obj.camera_position)}else if(that.getAttribute("type")==="Ort"){if(tmp.length>0){obj=new THREE.OrthographicCamera(tmp[0],tmp[1],tmp[2],tmp[3],tmp[4],tmp[5])}else{if(tmp.width){tmp.right=tmp.width/2;tmp.left=-tmp.width/2}if(tmp.height){tmp.top=tmp.height/2;tmp.bottom=-tmp.height/2}obj=new THREE.OrthographicCamera(tmp.left,tmp.right,tmp.top,tmp.bottom,tmp.near,tmp.far);obj.userData.__width=tmp.right;obj.userData.__height=tmp.top}}else{if(tmp.length>0){obj=new THREE.PerspectiveCamera(tmp[0],tmp[1],tmp[2],tmp[3])}else{obj=new THREE.PerspectiveCamera(tmp.fov,tmp.aspect,tmp.near,tmp.far);self.MMD_SA&&MMD_SA.THREEX.camera.clone(obj)}}obj.useQuaternion=true;setObj(that,obj);obj.userData.renderer=[];obj.addEventListener("added",addCamera);obj.addEventListener("removed",removeCamera);if(self.MMD_SA){MMD_SA.camera_list.push(obj)}});Array.prototype.push.apply(obj3D,tmp_list.CAMERA);$.each(tmp_list.TXR,function(){tmp=getHash(this.getAttribute("param"));if(this.hasAttribute("src")){obj=THREE.ImageUtils.loadTexture(this.getAttribute("src"));this.removeAttribute("src")}else if(this.hasAttribute("video")){obj=new THREE.Texture(document.createElement("video"));obj.generateMipmaps=false}else if(this.hasAttribute("html")||this.hasAttribute("canvas")){obj=new THREE.Texture(document.createElement("canvas"));obj.image.width=1;obj.image.height=1;obj.generateMipmaps=false;obj.minFilter=obj.magFilter}else if(this.hasAttribute("camera")){obj=new THREE.WebGLRenderTarget(tmp.width||1024,tmp.height||1024);tmp.rdr=tmp.rdr||"rdr";waitRdr[tmp.rdr]=waitRdr[tmp.rdr]||[];waitRdr[tmp.rdr].push(obj);delete tmp.camera;delete tmp.rdr}if(tmp.repeat){if(typeof tmp.repeat==="number"){tmp.repeat=[tmp.repeat,tmp.repeat]}else tmp.repeat=eval("["+tmp.repeat.split(/\s+/)+"]");obj.repeat.set(tmp.repeat[0],tmp.repeat[1])}if(tmp.offset){if(typeof tmp.offset==="number"){tmp.offset=[tmp.offset,tmp.offset]}obj.offset.set(tmp.offset[0],tmp.offset[1])}if(tmp.wrap!==undefined){if(typeof tmp.wrap==="number"){tmp.wrap=[tmp.wrap,tmp.wrap]}obj.wrapS=tmp.wrap[0]+1e3;obj.wrapT=tmp.wrap[1]+1e3}else if(tmp.repeat){obj.wrapS=obj.wrapT=1e3}delete tmp.repeat;delete tmp.offset;delete tmp.wrap;delete tmp.height;delete tmp.width;$.extend(obj,tmp);setObj(this,obj)});var _mirror=[];$.each(tmp_list.MTL,function(){that=this;tmp=getHash(that.getAttribute("param"));if(tmp.map){tmp.map=getReferent(tmp.map)}if(tmp.lightMap){tmp.lightMap=getReferent(tmp.lightMap)}if(tmp.specularMap){tmp.specularMap=getReferent(tmp.specularMap)}if(tmp.displacementMap){tmp.displacementMap=getReferent(tmp.displacementMap)}if(tmp.normalMap){tmp.normalMap=getReferent(tmp.normalMap)}if(tmp.waveBaseSpeed!=null){tmp.waveNoiseTexture=getReferent("#waveNoiseTexture")}if(tmp.bumpMap){tmp.bumpMap=getReferent(tmp.bumpMap)}else if(tmp.bumpScale&&tmp.map){tmp.bumpMap=tmp.map}if(tmp.AT_process){MMD_SA_options[tmp.AT_process](this,tmp);delete tmp.AT_process}$.each(tmp,function(e,t){if(typeof t==="string"&&/ /.test(t)){tmp[e]=getArr(t)}});if(that.getAttribute("type")&&that.getAttribute("type")=="Mirror"){setObj(that,new THREE.MirrorMaterial(tmp));_mirror.push(MMD_SA._THREE_mirror[MMD_SA._THREE_mirror.length-1])}else{let e=new THREE[(that.getAttribute("type")||"")+"Material"](tmp);if("uniTexture"in tmp){e.uniTexture=tmp.uniTexture}setObj(that,e)}});$.each(tmp_list.GEO,function(){if(this.getAttribute("type")){tmp=getArr(this.getAttribute("param"));obj=new THREE[this.getAttribute("type")+"Geometry"](tmp[0],tmp[1],tmp[2],tmp[3],tmp[4],tmp[5],tmp[6])}else if(this.getAttribute("src")){obj=new THREE.Geometry}else{obj=new THREE.Geometry;for(var e=+this.getAttribute("param");e;e--){obj.vertices.push(new THREE.Vector3)}}setObj(this,obj)});$.each(tmp_list.LIGHT,function(){tmp=getArr(this.getAttribute("param"));setObj(this,new THREE[light_type[this.getAttribute("type")]](tmp[0],tmp[1],tmp[2],tmp[3],tmp[4]));if(self.MMD_SA){var e=THREE_obj[THREE_obj.length-1];MMD_SA.THREEX.light.clone(e);MMD_SA.light_list.push({obj:e});if(MMD_SA.light_list.length==2){Object.defineProperty(MMD_SA.light_list[1],"pos",{get:function(){var e=new THREE.Vector3;return function(){return e.fromArray(MMD_SA_options.light_position)}}(),set:function(e){}})}}});Array.prototype.push.apply(obj3D,tmp_list.LIGHT);$.each(tmp_list.OBJ,function(){setObj(this,new THREE.Object3D)});Array.prototype.push.apply(obj3D,tmp_list.OBJ);$.each(tmp_list.SPRITE,function(){setObj(this,new THREE.Sprite(new THREE.Material))});Array.prototype.push.apply(obj3D,tmp_list.SPRITE);$.each(tmp_list.MESH,function(){let e=new THREE.Mesh(new THREE.Geometry,new THREE.Material);let t=this.getAttribute("instanced_drawing");if(t){}setObj(this,e)});Array.prototype.push.apply(obj3D,tmp_list.MESH);$.each(obj3D,function(){if(this.parentNode.tagName&&this.parentNode.tagName!=="GOML"){getObj(this.parentNode).add(getObj(this))}});$.each(tmp_list.RDR,function(){tmp=getHash(this.getAttribute("param"));if(tmp.clearAlpha===undefined)tmp.clearAlpha=1;obj=new THREE.WebGLRenderer(tmp);obj.__renderTarget=[];if(!this.getAttribute("camera"))this.setAttribute("camera","camera:first");if(!this.getAttribute("frame"))this.setAttribute("frame","body");jThree.MMD&&obj.renderPluginsPre.unshift(jThree.MMD._simulate);setObj(this,obj);obj.__updateFn=[]});if(self.MMD_SA&&!MMD_SA.renderer){MMD_SA.renderer=jThree("#MMD_renderer").three(0);if(MMD_SA.renderer){MMD_SA.renderer.shadowMapEnabled=true;MMD_SA.renderer.shadowMapType=THREE.PCFSoftShadowMap;_mirror.forEach(function(e){e.renderer=jThree(e._renderer_id).three(0);jThree(e._mesh_id).three(0).add(e)})}}$.each(waitRdr,function(e){obj=getReferent(e);obj.__renderTarget=obj.__renderTarget.concat(this);$.each(this,function(){prop.invisible.call(this,this.userData.dom.getAttribute("invisible"))});obj.__resize()});tmp=that=obj=waitRdr=srcWaiting=null;tmp_root=tmp_root.not(jq);$.each(tmp_list,function(e){tmp_list[e].length=0});if(isRoot){if(!loadLength){src_state=true;src_wait.forEach(function(e){e(jThree)});src_wait.length=0}else{src_state=false}return rootObj}else{return jq}}}();THREE.PerspectiveCamera.prototype.resize=function(e,t){this.aspect=e/t;this.updateProjectionMatrix()};THREE.OrthographicCamera.prototype.resize=function(e,t){var i=this.userData;if(i.__width&&i.__height)return;if(i.__width){i=i.__width*t/e;this.top=i;this.bottom=-i}else if(i.__height){i=i.__height*e/t;this.right=i;this.left=-i}else{i=50*t/e;this.top=i;this.bottom=-i;i=i*e/t;this.right=i;this.left=-i}this.updateProjectionMatrix()};function getReferent(e){var t=tmp_root.find(e);$.makeArray(rootObj.find(e),t);if(t.length){if(t.length>1){var i=[];$.each(t,function(){i.push(getObj(this))});return i}else{return getObj(t[0])}}}function getObj(e){if(e&&e.nodeType){e=THREE_obj[e.getAttribute("three")]}return e}function replaceObj(e,t){if(e.userData.clone){e.userData.clone.length=0;e.userData.original=null}t.userData=$.extend(e.userData,t.userData);THREE_obj[THREE_obj.indexOf(e)]=t}function removeObj(e,i){$.each($.merge([e],e.getElementsByTagName("*")),function(e){var t=getObj(this);if(e==0&&t instanceof THREE.Object3D&&!(t instanceof THREE.Scene)){t.parent.remove(t)}if(t&&t.userData&&!i){THREE_obj[this.getAttribute("three")]=t.userData.dom=null}})}function getFn(e){return new Function("a","b","c",e)}function getHash(e){return e?JSON.parse("{"+$.trim(e).replace(/([^\s;]+)?\s*:/g,'"$1":').replace(/:\s*([^;]+);+/g,':"$1",').replace(/\s+/g," ").replace(/:"(true|false)",/g,":$1,").replace(/:"(-?(\d+\.\d+|\d+))",/g,":$1,").replace(/\:"\{([^\:\}]*)\}"/g,(e,t)=>":{"+decodeURIComponent(t)+"}").slice(0,-1)+"}"):{}}function getArr(e){if(e){var i=$.trim(e).split(" ");return $.each(i,function(e,t){if(/^-?(\d*\.\d+|\d+)$/.test(t)){i[e]=parseFloat(t)}})}else if(e===0){return[0]}else{return[]}}function urlToExtension(e){return!/^\.[^\/^\.]/.test(e)&&e.split(".").pop().split("?")[0].toLowerCase()}function getHtmlObj(e){return/^html /.test(e)?$(e):importFrame.contents().find(e)}var prop={src:function(e){var t=getObj(this);if(t instanceof THREE.Texture){t.sourceFile=e;delete t.image.crossOrigin;if(/^(tga|TGA)/.test(e.split(".").pop())){var i=new THREE.TGA;i.open(e,function(){t.image.src=i.getDataURL();t.needsUpdate=true;i=null})}else{if(!/^data:image/.test(e)){t.image.crossOrigin="anonymous"}t.image.src=e}}else{var r=urlToExtension(e);var n=this.tagName.toLowerCase();if(jThree[n+"Hooks"][r]){this.setAttribute("type",r);var a=this;jThree[n+"Hooks"][r].call(this,e,function(e){if(e instanceof THREE.Geometry||e instanceof THREE.Material){replaceObj(getObj(a),e)}else{getObj(a)._srcObj=e;if(self.MMD_SA&&a.id){MMD_SA._j3_obj_by_id[a.id]=e}}a.setAttribute("loadStates","success");$.event.trigger("load",undefined,a);a=null},function(){a.setAttribute("loadStates","error");$.event.trigger("error",undefined,a);a=null});this.setAttribute("loadStates","loading")}else{this.setAttribute("loadStates","error");$.event.trigger("error",undefined,this)}}},html:function(e){if(!/^html /.test(e)&&importStates!=="success"){var t=this;importFrame.one("load",function(){prop.html.call(t,e);t=e=null});return}var i=getHtmlObj(e)[0];var r=getObj(this);r._htmlReset&&r._htmlReset();r._htmlReset=function(){jThree.update(r._htmlUpdate,false);i=r=null};r._htmlUpdate=function(){THREE.html2canvas(i,{onrendered:function(e){if(!r)return;r.image=e;r.needsUpdate=true}})};THREE.html2canvas(i,{onrendered:function(e){r.image=e;r.needsUpdate=true;$.event.trigger("load",undefined,r.dom())}});jThree.update(r._htmlUpdate,this.getAttribute("animation")==="true")},video:function(e){if(!/^html /.test(e)&&importStates!=="success"){var t=this;importFrame.one("load",function(){prop.video.call(t,e);t=e=null});return}var i=getHtmlObj(e);var r=i[0];r.crossOrigin="anonymous";var n=getObj(this);n.image=r;n._videoReset&&n._videoReset();function a(){n.needsUpdate=true}function o(){n.image.width=r.videoWidth;n.image.height=r.videoHeight;jThree.update(a)}function s(){jThree.update(a,false)}i.on("play",o).on("ended pause error",s);if(!r.paused&&!r.ended)o();n._videoReset=function(){i.off("play",o).off("ended pause error",s);jThree.update(a,false);i=r=n=a=null};$.event.trigger("load",undefined,this)},canvas:function(e){if(!/^html /.test(e)&&importStates!=="success"){var t=this;importFrame.one("load",function(){prop.canvas.call(t,e);t=e=null});return}var i=getObj(this);i._canvasReset&&i._canvasReset();i._canvasReset=function(){jThree.update(i._canvasUpdate,false);i=null};i._canvasUpdate=function(){i.needsUpdate=true};i.image=getHtmlObj(e)[0];i.needsUpdate=true;jThree.update(i._canvasUpdate,this.getAttribute("animation")==="true");$.event.trigger("load",undefined,this)},audio:function(){var o=0;return function(e){if(!window.AudioContext&&!window.webkitAudioContext)return;if(!/^html /.test(e)&&importStates!=="success"){var t=this;importFrame.one("load",function(){prop.audio.call(t,e);t=e=null});return}var i=getHtmlObj(e);var r=getObj(this);var n=getReferent(jThree("rdr").attr("camera")||"camera");!THREE.snd._AUDIO_CONTEXT&&THREE.snd.init();r._sndReset&&r._sndReset();var a=[];r._sndReset=function(){a.forEach(function(e){THREE.snd.MASTER.disconnectAudioUnit(e.id);THREE.snd.three.detach(e)});a=null};if(!THREE.snd.SOUND_ENVIRONMENT.cameras[n.id]){!function(){var e=n;THREE.snd.three.addCamera(e);jThree.update(function(){THREE.snd.three.update(e)})}()}i.each(function(){this.crossOrigin="anonymous";var e=o++;var t=new THREE.snd.BufferSoundNode(e,new THREE.snd.MediaElementAudioSource(e+.5,this));a.push(t);THREE.snd.MASTER.connectAudioUnit(t.id,t);THREE.snd.three.attach(r,t)})}}(),animation:function(e){var t=getObj(this);var i=t._htmlUpdate?t._htmlUpdate:t._canvasUpdate?t._canvasUpdate:false;i&&jThree.update(i,e==="true"||e===true)},invisible:function(e){e=getReferent(e);getObj(this).__invisible=!e||Array.isArray(e)?e:[e]},geo:function(){var c={};return function(e){var a=this;var t=urlToExtension(e);if(jThree.geoHooks[t]){var i=c[e]=c[e]||parseGOML('<geo src="'+e+'" />')}else{var i=tmp_root.find(e);if(!i.length)i=rootObj.find(e)}if(i.attr("src")){function r(){var e=getObj(a);var t=e.parent;!e.geometry.dom()&&e.geometry.dispose();e.geometry=getObj(this);if(t){var i=e.userData.scene;if(i)for(var r=i.__webglObjects,n=r.length-1;n>=0;n--){if(r[n].object===e){r.splice(n,1)}}t.remove(e);delete e.__webglActive;delete e.__webglInit;t.add(e)}$.event.trigger("load",undefined,a);o()}function o(e){$.event.remove(i,"load",r);$.event.remove(i,"error",o);e&&$.event.trigger("error",undefined,a);r=o=i=a=null}switch(i.attr("loadStates")){case"loading":i.load(r);i.error(o);break;case"success":r.call(i[0]);break;default:$.event.trigger("error",undefined,this);break}}else{var n=getObj(this);var s=n.parent;!n.geometry.dom()&&n.geometry.dispose();n.geometry=getObj(i[0]);if(s){var l=n.userData.scene;if(l)for(var h=l.__webglObjects,f=h.length-1;f>=0;f--){if(h[f].object===n){h.splice(f,1)}}s.remove(n);delete n.__webglActive;delete n.__webglInit;s.add(n)}}}}(),mtl:function(){var s={};return function(e){var t=this;var i=urlToExtension(e);if(jThree.mtlHooks[i]){var r=s[e]=s[e]||parseGOML('<mtl src="'+e+'" />')}else{var r=tmp_root.find(e);if(!r.length)r=rootObj.find(e)}if(r.attr("src")){function n(){var e=getObj(t);e.material.dispose();e.material=getObj(this).clone();if(e instanceof THREE.Sprite){e.material.useScreenCoordinates=false;e.material.scaleByViewport=false}$.each(e.material,function(){if(this instanceof THREE.Texture){this.needsUpdate=true}});$.event.trigger("load",undefined,t);a()}function a(e){$.event.remove(r,"load",n);$.event.remove(r,"error",a);e&&$.event.trigger("error",undefined,t);n=a=r=t=null}switch(r.attr("loadStates")){case"loading":r.load(n);r.error(a);break;case"success":n.call(r[0]);break;default:$.event.trigger("error",undefined,this);break}}else{var o=getObj(this);o.material.dispose();o.material=getObj(r[0]).clone();if(o instanceof THREE.Sprite){o.material.useScreenCoordinates=false;o.material.scaleByViewport=false}$.each(o.material,function(){if(this instanceof THREE.Texture){this.needsUpdate=true}})}}}(),model:function(){var r={};var h={};return function(e){var o=this;var t=urlToExtension(e);if(jThree.modelHooks[t]){var i=r[e]=r[e]||parseGOML('<model src="'+e+'" />')}else{var i=tmp_root.find(e);if(!i.length)i=rootObj.find(e)}function s(e){var t=getObj(o);var i=getObj(this)._srcObj;if(o.tagName!=="MMD"){i=i.clone();t._modelObj&&t.remove(t._modelObj);t._modelObj=i;getObj(o).add(i);$.event.trigger("load",undefined,o);o=t=null}else{var r=o.getAttribute("motion");var n;if(r){var a=urlToExtension(r);if(jThree.motionHooks[a]){n=h[r]=h[r]||parseGOML('<motion src="'+r+'" />')}else{n=tmp_root.find(r);if(!n.length)n=rootObj.find(r)}if(self.MMD_SA&&/^\#/.test(r)){n._id=r.replace(/^\#/,"")}}jThree.mmdHook.call(o,i,n,function(e){t._modelObj&&t.remove(t._modelObj);t._modelObj=e;getObj(o).add(e);$.event.trigger("load",undefined,o);o=t=null})}if(e){$.event.remove(this,"load",s);$.event.remove(this,"error",l)}}function l(){$.event.remove(this,"load",s);$.event.remove(this,"error",l);$.event.trigger("error",undefined,o);o=null}switch(i.attr("loadStates")){case"loading":i.load(s);i.error(l);break;case"success":s.call(i[0]);break;default:$.event.trigger("error",undefined,this);break}}}(),motion:function(){var r={};return function(e){if(this.tagName==="MMD")return;var t=urlToExtension(e);if(jThree.motionHooks[t]){var i=r[e]=r[e]||parseGOML('<motion src="'+e+'" />')}else{var i=tmp_root.find(e);if(!i.length)i=rootObj.find(e)}jThree.otherMmdHook.call(this,i)}}(),frame:function(e){if(e=="MMD_SA"){var a=getObj(this);animationFrame(a);(function(){var i,r,n=a,e=jThree(a),t;MMD_SA._renderer=a;t=function(e,t){i=e||MMD_SA_options.width;r=t||MMD_SA_options.height;MMD_SA.THREEX.renderer.setSize(i,r);if(n.__camera){MMD_SA.THREEX.camera.resize(i,r)}n.__renderTarget.forEach(function(e){if(e.__camera){e.__camera.resize(i,r)}})};e.resize(t).resize();n.__resize=t})();return}var a=getObj(this),t=$(e)[0];if(a.frameElement){t.insertBefore(a.frameElement[0],t.firstChild)}else{a.frameElement=$('<div style="position:relative;margin:0;padding:0;height:100%;"><iframe name="jthreeIframe" frameborder="0" scrolling="no" style="position:absolute;top:0;left:0;width: 100%; height: 100%; margin: 0; padding: 0; vertical-align: bottom;" /></div>');t.insertBefore(a.frameElement[0],t.firstChild);a.domElement.style.position="relative";a.frameElement.append(a.domElement);a.frameWindow=jthreeIframe;a.frameElement.find("iframe").attr("name","");animationFrame(a);(function(){var t,i,e=a,r=jThree(a);function n(){t=e.domElement.parentNode.clientWidth;i=e.domElement.parentNode.clientHeight;e.setSize(t,i);if(e.__camera){e.__camera.resize(t,i)}e.__renderTarget.forEach(function(e){if(e.__camera){e.__camera.resize(t,i)}})}r.resize(n).resize();$(a.frameWindow).resize(function(){r.resize()});e.__resize=n})()}},camera:function(e){var t=getReferent(e),i=getObj(this),r=i.__camera;i.__camera=t;if(i instanceof THREE.WebGLRenderTarget)return;var n=$(i.domElement);if(r){var a=r.userData.renderer;a.splice(a.indexOf(i),1);animationFrame(i,false);var o=r.userData.scene;if(o){var s=o.userData._events;s&&$.each(s,function(e){n.off(e!=="mousewheel"?e:"DOMMouseScroll mousewheel",canvasEvent)})}}if(t){animationFrame(i);t.userData.renderer.push(i);i.__resize&&i.__resize();var o=t.userData.scene;if(o){var s=o.userData._events;s&&$.each(s,function(e){n.on(e!=="mousewheel"?e:"DOMMouseScroll mousewheel",canvasEvent)})}}n=null},rendering:function(e){animationFrame(getObj(this),e==="true"||e===true)},fog:function(e){e=getArr(e);getObj(this).fog=new THREE[e.length===2?"FogExp2":"Fog"](e[0],e[1],e[2])}},light_type={};$.each(THREE,function(e){if(/.+?Light$/.test(e)){light_type[e.slice(0,3)]=e}});jThree.three=function(e){return getObj(e)};jThree.fn.three=function(e){return e!==undefined?getObj(this.get(e)):$.map(this,function(e){return getObj(e)})};var animationFrame=function(){var r=[],n=[],t,i,a,o=0,s=[],l,h;self.animationFrame_RAF=function(e){l=e-o;o=e;for(t=n.length;t;){n[--t](l,e)}for(t=r.length;t;){h=r[--t];for((i=h.__updateFn.length)&&(a=h.userData.dom);i;){h.__updateFn[--i].call(a,l,e)}for(i=h.__renderTarget.length;i;){a=h.__renderTarget[--i];a.__invisible&&a.__invisible.forEach(function(e){if(jThree.styleHooks.display.get(e)){s.push(e);jThree.styleHooks.display.set(e,false)}});h.render(a.__camera.userData.scene,a.__camera,a);s.forEach(function(e){jThree.styleHooks.display.set(e,true)});s.length=0}if(!self.MMD_SA||!MMD_SA.render(h))h.render(h.__camera.userData.scene,h.__camera)}};if(self.Animate_RAF){self.EV_animate_full=animationFrame_RAF;animationFrame_RAF(0)}else{(function(e){requestAnimationFrame(arguments.callee);animationFrame_RAF(e)})(0)}return function(e,t){if(typeof e==="function"){var i=n.indexOf(e);if(t===false){if(i!==-1){n.splice(i,1)}}else if(i===-1){n.unshift(e)}}else{var i=r.indexOf(e);if(t===false){hasRenderObj(e);if(i!==-1){r.splice(i,1)}}else if(i===-1&&hasRenderObj(e)){r.unshift(e)}}}}();jThree.fn.update=function(e,t){return this.each(function(){jThree.update(this,e,t)})};jThree.update=function(e,t,i){if(!t||t===true){animationFrame(e,t)}else if(i===false){var r;e=getObj(e);if(e.__updateFn&&(r=e.__updateFn.indexOf(t))!==-1){e.__updateFn.splice(r,1)}}else{e=getObj(e);if(e.__updateFn&&e.__updateFn.indexOf(t)===-1){e.__updateFn.unshift(t)}}};function hasRenderObj(e){return e.__renderable=e.__camera&&e.__camera.userData.scene}jThree.fn.attr=jThree.fn.prop=function(r,n){if(typeof r==="string"){if(n===undefined){return this[0].getAttribute(r)}this.each(function(e){var t=this.getAttribute(r),i=typeof n==="function"?n.call(this,e):n;if(/^data-/.test(r)){jThree.dataHooks[r.slice(5)]&&jThree.dataHooks[r.slice(5)].call(this,i)}else{prop[r]&&prop[r].call(this,i)}this.setAttribute(r,i);jThree.event.trigger($.Event("attrChange",{attrName:r,oldValue:t,newValue:i}),undefined,this)})}else if(typeof r==="object"){var i=this;$.each(r,function(e,t){i.attr(e,t)})}return this};jThree.fn.add=function(e,t){var i=typeof e==="string"?jThree(e,t):$.makeArray(e&&e.nodeType?[e]:e),r=$.merge(this.get(),i);return this.pushStack($.unique(r))};var axis_symbol=["x","y","z"],style_menu=["position","scale","up"];jThree.styleHooks={};function cssMethod(t,i){return function(e){return e&&(e instanceof jThree||e.nodeType)?this.css(t,e):this.css(t,Array.isArray(e)||e===undefined||i?e:arguments.length>1?arguments:/^qua/.test(t)?[e,e,e,e]:[e,e,e])}}$.each(axis_symbol,function(e,r){var t="lookAt"+r.toUpperCase();jThree.styleHooks[t]={get:function(e){return e._lookAt[r]},set:function(e,t){var i=e._lookAt;i[r]=t;e.lookAt(i)}};jThree.fn[t]=cssMethod(t,true);t="translate"+r.toUpperCase();jThree.styleHooks[t]={get:function(){return 0},set:function(e,t){e["translate"+r.toUpperCase()](t)}};jThree.fn[t]=cssMethod(t,true);t="rotate"+r.toUpperCase();jThree.styleHooks[t]={get:function(e){return e.rotate[r]},set:function(e,t){e.useQuaternion&&(e.useQuaternion=false);e.rotate[r]=t}};jThree.fn[t]=cssMethod(t,true);$.each(style_menu,function(e,i){t=i+r.toUpperCase();jThree.styleHooks[t]={get:function(e){return e[i][r]},set:function(e,t){e[i][r]=t}};jThree.fn[t]=cssMethod(t,true)})});axis_symbol.push("w");$.each(axis_symbol,function(e,r){var t="quaternion"+r.toUpperCase();jThree.styleHooks[t]={get:function(e){return e.quaternion[r]},set:function(e,t){!e.useQuaternion&&(e.useQuaternion=true);e.quaternion[r]=t}};jThree.fn[t]=cssMethod(t,true);t="qtAxisAngle"+r.toUpperCase();jThree.styleHooks[t]={get:function(e){return e.qtAxisAngle[r]},set:function(){var i=new THREE.Vector3;return function(e,t){!e.useQuaternion&&(e.useQuaternion=true);e.qtAxisAngle[r]=t;e.quaternion.setFromAxisAngle(i.copy(e.qtAxisAngle).normalize(),e.qtAxisAngle.w)}}()};jThree.fn[t]=cssMethod(t,true)});jThree.styleHooks.lookAt={get:function(e){var t=e._lookAt;return[t.x,t.y,t.z]},set:function(e,t){var i=e._lookAt;i.set(t[0],t[1],t[2]);e.lookAt(i)}};jThree.fn.lookAt=cssMethod("lookAt");jThree.styleHooks.translate={get:function(){return[0,0,0]},set:function(){var i=new THREE.Vector3;return function(e,t){e.position.add(i.set(t[0],t[1],t[2]).applyEuler(e.rotation,e.eulerOrder))}}()};jThree.fn.translate=cssMethod("translate");jThree.styleHooks.rotate={get:function(e){var t=e.rotate;return[t.x,t.y,t.z]},set:function(e,t){e.useQuaternion&&(e.useQuaternion=false);e.rotate.set(t[0],t[1],t[2])}};jThree.fn.rotate=cssMethod("rotate");jThree.styleHooks.quaternion={get:function(e){var t=e.quaternion;return[t.x,t.y,t.z,t.w]},set:function(e,t){!e.useQuaternion&&(e.useQuaternion=true);e.quaternion.set(t[0],t[1],t[2],t[3])}};jThree.fn.quaternion=cssMethod("quaternion");jThree.styleHooks.qtAxisAngle={get:function(e){var t=e.qtAxisAngle;return[t.x,t.y,t.z,t.w]},set:function(){var i=new THREE.Vector3;return function(e,t){!e.useQuaternion&&(e.useQuaternion=true);e.qtAxisAngle.set(t[0],t[1],t[2],t[3]);e.quaternion.setFromAxisAngle(i.copy(e.qtAxisAngle).normalize(),e.qtAxisAngle.w)}}()};jThree.fn.qtAxisAngle=cssMethod("qtAxisAngle");$.each(style_menu,function(e,i){jThree.styleHooks[i]={get:function(e){var t=e[i];return[t.x,t.y,t.z]},set:function(e,t){e[i].set(t[0],t[1],t[2])}};jThree.fn[i]=cssMethod(i)});$.extend(jThree.styleHooks,{axis:{get:function(e){return!e.userData.__axis?0:e.userData.__axis.geometry.vertices[1].x},set:function(e,t){var i=e.userData.__axis;if(i){e.remove(i)}if(t){i=new THREE.AxisHelper(t);e.userData.__axis=i;e.add(i)}}},display:{get:function(e){return e.userData.__display===false?false:true},set:function(e,t){if(t!==undefined){e.userData.__display=t=!!t}else{t=e.userData.__display===false||e.parent.visible===false?false:true}if(!t){e.traverse(function(e){if(e instanceof THREE.Bone)return false;e.visible=false})}else{e.traverse(function(e){if(e instanceof THREE.Bone)return false;e.visible=e.userData.__display===false||e.parent&&e.parent.visible===false?false:true})}}},opacity:{get:function(e){return e.userData.__opacity===undefined?1:e.userData.__opacity},set:function(e,t){if(t!==undefined){e.userData.__opacity=t}e.traverse(function(e){if(!e.material)return;if(e instanceof THREE.Bone)return false;e.material.opacity=(e.parent&&e.parent.material?e.parent.material.opacity:1)*(e.userData.__opacity===undefined?1:e.userData.__opacity)})}}});function objToLocal(e,t,i){if(i&&(i instanceof jThree||i.nodeType)){var r=getObj(i instanceof jThree?i[0]:i);if(/(position|lookAt)/.test(t)){var n=new THREE.Vector3;i=styleAdmin(r,"position");if(/(X|Y|Z)/.test(t)){var a=t.slice(-1).toLowerCase();n[a]=i[a];var o=e.parent.worldToLocal(r.parent.localToWorld(n));i=o[a]}else{n.set(i[0],i[1],i[2]);var o=e.parent.worldToLocal(r.parent.localToWorld(n));i=[o.x,o.y,o.z]}}else{i=styleAdmin(r,t)}}return i}function styleAdmin(e,t,i){i=objToLocal(e,t,i);if(!jThree.styleHooks[t]&&/^mtl/.test(t)){var n=t.charAt(3).toLowerCase()+t.slice(4);var r=e.material[n];if(typeof r==="number"||typeof r==="boolean"||typeof r==="string"){(function(){var i=n;jThree.styleHooks[t]={get:function(e){return e.material[i]},set:function(e,t){e.material[i]=t}}})()}else if(r instanceof THREE.Color){(function(){var r=n;jThree.styleHooks[t]={get:function(e){var t=e.material[r];var i=[t.r*255,t.g*255,t.b*255];i.color=true;return i},set:function(e,t){e.material[r].set(t)}}})()}else if(/(map|Map)$/.test(t)||r instanceof THREE.Texture){(function(){var r=n;jThree.styleHooks[t]={get:function(e){return e.material[r]&&e.material[r][r+"Selector"]},set:function(e,t){var i=getReferent(t);e.material[r]=i;e.material[r][r+"Selector"]=t;i.needsUpdate=true}}})()}else if(r instanceof THREE.Vector3||r instanceof THREE.Vector2){(function(){var i=n;jThree.styleHooks[t]={get:function(e){var t=e.material[i];return arguments.length===2?[t.x,t.y]:[t.x,t.y,t.z]},set:function(e,t){e.material[i].set(t[0],t[1],t[2])}}})()}}if(i===undefined){return jThree.styleHooks[t].get(e)}else{jThree.styleHooks[t].set(e,i)}}jThree.fn.extend({css:function(e,t){if(typeof t==="string"){t=getArr(t);if(t.length===1){t=t[0]}}if(typeof e==="string"){if(t===undefined)return styleAdmin(getObj(this[0]),e);this.each(function(){styleAdmin(getObj(this),e,t)})}else{var i;this.each(function(){i=getObj(this);$.each(e,function(e,t){styleAdmin(i,e,t)})});i=null}return this}});axis_symbol=style_menu=null;["intensity","distance","angle","exponent"].forEach(function(i){jThree.styleHooks["light"+i.charAt(0).toUpperCase()+i.slice(1)]={get:function(e){return e[i]},set:function(e,t){e[i]=t}}});["color","ground","sky"].forEach(function(r){jThree.styleHooks["light"+r.charAt(0).toUpperCase()+r.slice(1)]={get:function(e){var t=e[r];var i=[t.r*255,t.g*255,t.b*255];i.color=true;return i},set:function(e,t){e[r].set(t)}}});["width","height"].forEach(function(a){jThree.styleHooks["camera"+a.charAt(0).toUpperCase()+a.slice(1)]={get:function(e){return e instanceof THREE.OrthographicCamera?e.userData["__"+a]*2||(a=="width"?e.right-e.left:e.top-e.bottom):undefined},set:function(e,t){var i=a==="width"?{right:t/2,left:-t/2}:{top:t/2,bottom:-t/2};var r=e.right-e.left,n=e.top-e.bottom;e.userData["__"+a]=isNaN(i.right)?i.top:i.right;$.extend(e,i);e.resize(r,n)}}});["left","right","top","bottom","near","far","fov","aspect"].forEach(function(i){jThree.styleHooks["camera"+i.charAt(0).toUpperCase()+i.slice(1)]={get:function(e){return e instanceof THREE.Camera?e[i]:undefined},set:function(e,t){e[i]=t;e.updateProjectionMatrix()}}});function checkText(i){if(i instanceof jThree||i.nodeType)return i;if(typeof i==="string")return $(parseGOML(i));$.each(i,function(e,t){if(typeof t==="string"){i[e]=$(parseGOML(t))}});return i}function addToScene(t,e){t=getObj(t);if(e.nodeName==="#document-fragment"){$(e).children().each(function(){var e=getObj(this);if(e instanceof THREE.Object3D&&!(e instanceof THREE.Scene)){t.add(e)}})}else{var i=getObj(e);if(i instanceof THREE.Object3D&&!(i instanceof THREE.Scene)){t.add(i)}}return e}jThree.fn.extend({append:function(){return this.domManip(checkText(arguments),function(e){this.appendChild(addToScene(this,e))})},prepend:function(){return this.domManip(checkText(arguments),function(e){this.insertBefore(addToScene(this,e),this.firstChild)})},before:function(){return this.domManip(checkText(arguments),function(e){this.parentNode.insertBefore(addToScene(this.parentNode,e),this)})},after:function(){return this.domManip(checkText(arguments),function(e){this.parentNode.insertBefore(addToScene(this.parentNode,e),this.nextSibling)})},empty:function(){var e,t=0;for(;(e=this[t])!=null;t++){if(e.nodeType===1){$.cleanData($.merge([e],e.getElementsByTagName("*")));$.each(e.children,function(){removeObj(this,false)});e.textContent=""}}return this},remove:function(e,t){var i,r=e?$.filter(e,this):this,n=0;for(;(i=r[n])!=null;n++){if(!t&&i.nodeType===1){$.cleanData($.merge([i],i.getElementsByTagName("*")))}if(i.parentNode){i.parentNode.removeChild(i);removeObj(i,t)}}return this},replaceWith:function(){var r=$.map(this,function(e){return[e.nextElementSibling||e,e.parentNode]}),n=0;this.domManip(checkText(arguments),function(e){var t=r[n++],i=r[n++];if(i){i.insertBefore(addToScene(i,e),t);jThree(this).remove()}},true);return n?this:this.remove()}});$.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,o){jThree.fn[e]=function(e){var t,i=[],r=jThree(e),n=r.length-1,a=0;for(;a<=n;a++){t=a===n?this:this.clone(true);jThree(r[a])[o](t);Array.prototype.push.apply(i,t.get())}return this.pushStack(i)}});jThree.fn.extend({wrapAll:function(t){var e;if(typeof t==="function"){return this.each(function(e){jThree(this).wrapAll(t.call(this,e))})}if(this[0]){e=jThree(t).eq(0).clone(true);if(this[0].parentNode){e.insertBefore(this[0])}e.map(function(){var e=this;while(e.firstElementChild){e=e.firstElementChild}return e}).append(this)}return this},wrapInner:function(i){if(typeof i==="function"){return this.each(function(e){jThree(this).wrapInner(i.call(this,e))})}return this.each(function(){var e=jThree(this),t=e.contents().not("text");if(t.length){t.wrapAll(i)}else{e.append(i)}})},wrap:function(t){return this.each(function(e){jThree(this).wrapAll(typeof t==="function"?t.call(this,e):t)})},unwrap:function(){return this.parent().each(function(){if(this.nodeName!=="body"){jThree(this).replaceWith(jThree(this).children())}}).end()}});jThree._animate=[];var animate_id=0,AnimateObj=function(h,e,f,t,i){var c=f.duration>0?f.duration:false,r=!f.easing||f.easing==="linear"?false:jThree.easing[f.easing],u="return function(delta,elapsed){",n=animate_id++,a=jThree._animate[n]={},o={},s,d=this;if(e){u="var storage=jThree._animate["+n+"],"+"jthree=storage.jthree,"+"data=storage.data,"+"easing=storage.easing;"+u;$.each(e,function(i,e){s=styleAdmin(h,i);e=objToLocal(h,i,e);if(s.color){if(/^#/.test(e)){if(e.length===4){e=e.replace(/^#(.)(.)(.)/,"#$1$1$2$2$3$3")}e=+("0x"+e.slice(1))}else if(typeof e==="string"&&/ /.test(e)){e=getArr(e)}if(typeof e==="number"){e=[e>>16&255,e>>8&255,e&255]}}u+="jThree.styleHooks."+i+".set(jthree,";if(typeof s==="number"){if(typeof e==="string"){e=e.charAt(0)==="+"?s+ +e.slice(2):s-+e.slice(2)}if(c){if(/^translate/.test(i)){u+="delta*"+e/c}else{u+=(r?"easing(elapsed/"+c+",elapsed,0,1,"+c+")*"+(e-s):"elapsed*"+(e-s)/c)+(s!==0?"+"+s:"")}}else{u+=e}}else{var t=[];u+="[";if(typeof e==="string"){e=getArr(e)}$.each(e,function(e,t){if(typeof t==="string"){t=t.charAt(0)==="+"?s[e]+ +t.slice(2):s[e]-+t.slice(2)}if(c){if(i==="translate"){u+="delta*"+t/c}else{u+=(r?"easing(elapsed/"+c+",elapsed,0,1,"+c+")*"+(t-s[e]):"elapsed*"+(t-s[e])/c)+(s[e]!==0?"+"+s[e]:"");if(r)s.easing=r}}else{u+=t}u+=","});u=u.replace(/,$/,"")+"]";s=t}o[i]=s;u+=");"})}u+="return "+(f.tween&&c&&r?"easing(elapsed/"+c+",elapsed,0,1,"+c+")":c?"elapsed/"+c:"elapsed")+";};";a.jthree=h;a.data=o;a.easing=r;d.update=function(){var i=h,t=d,r=0,n=new Function(u)(),a=f.step,o=a?function(e,t){a.call(i,n(e,t))}:function(e,t){n(e,t)},s=c,l=s?function(e){if(s-e<0){r=s;t.update(0)}else if(s===e){t.stop()}}:function(){};t.gotoEnd=function(){o(s-r,s);t.stop()};return function(e){o(e,r+=e);l(r)}}();d.dequeue=t;d.queue=i;d.obj=h;d.id=n;d.storage=a;d.complete=f.complete||function(){}};AnimateObj.prototype.stop=function(){this.complete.call(this.storage.jthree.userData.dom);delete jThree._animate[this.id];animationFrame(this.update,false);this.obj.userData.__animate.splice(this.obj.userData.__animate.indexOf(this),1);this.dequeue()};function animate(t,i,r){if(!t)return;var n,e=function(e){if(r.start(t,i,r)===false){e();return}n=new AnimateObj(t,i,r,e,r.queue);t.userData.__animate.unshift(n);animationFrame(n.update);i=t=n=r=null};t.userData.__animate=t.userData.__animate||[];if(r.queue!==false){$(t.userData.dom).queue(e,r.queue)}else{e(function(){})}}function optionNormalize(e){if(e.queue===undefined)e.queue="fx";if(e.start===undefined)e.start=function(){};if(typeof e.duration==="string")switch(e.duration){case"slow":e.duration=600;break;case"fast":e.duration=200;break;default:e.duration=400;break}return e}jThree.fn.extend({animate:function(i,e,r,n){var a={};if(typeof arguments[1]==="object"){a=arguments[1]}$.each(arguments,function(e,t){if(e===1){if(typeof t==="function"){a.step=t}else if(typeof t!=="object"){a.duration=t;if(typeof r==="function"){a.complete=r}else{a.easing=r;a.complete=n}}return false}else if(typeof t!=="object"){i=false;if(typeof t==="function"){a.step=t}}});optionNormalize(a);this.each(function(){animate(getObj(this),i,a)});return this},stop:function(t,i){this.each(function(){var e=this;$.each(getObj(e).userData.__animate,function(){if(t&&this.queue){$.queue(e,this.queue,[])}if(i){this.gotoEnd()}else{this.stop()}})});return this},slideDown:function(e,t,i){return genFx(this,"slideDown",e,t,i)},slideUp:function(e,t,i){return genFx(this,"slideUp",e,t,i)},slideToggle:function(e,t,i){this.each(function(){genFx(this,getObj(this).visible?"slideUp":"slideDown",e,t,i)});return this},fadeOut:function(e,t,i){return genFx(this,"fadeOut",e,t,i)},fadeIn:function(e,t,i){return genFx(this,"fadeIn",e,t,i)},fadeToggle:function(e,t,i){this.each(function(){genFx(this,getObj(this).visible?"fadeOut":"fadeIn",e,t,i)});return this},fadeTo:function(e,t,i,r){if(typeof i==="function"){r=i;i=undefined}return this.animate({opacity:t},{easing:i,complete:r,duration:e,start:function(e,t,i){if(!e.visible)e.userData.__opacity=0;e.traverse(function(e){if(!e.material||e.visible)return;e.material.opacity=0});jThree.styleHooks.display.set(e,true)}})},show:function(e,t,i){return e===undefined?this.css("display",true):genFx(this,"show",e,t,i)},hide:function(e,t,i){return e===undefined?this.css("display",false):genFx(this,"hide",e,t,i)},toggle:function(e,t,i){this.each(function(){if(e===undefined){jThree.styleHooks.display.set(getObj(this),!getObj(this).visible)}else if(typeof e==="boolean"){jThree.styleHooks.display.set(getObj(this),e)}else{genFx(this,getObj(this).visible?"hide":"show",e,t,i)}});return this}});function genFx(e,t,i,r,n){if(typeof r==="function"){n=r;r=undefined}var a={duration:i||400,easing:r,complete:n},o={};switch(t){case"slideDown":a.start=function(i,e,r){if(i.visible)return false;e.scale=jThree.styleHooks.scale.get(i);i.scale.set(0,0,0);jThree.styleHooks.display.set(i,true);i.traverse(function(e){if(e===i)return;var t=jThree.styleHooks.position.get(e);e.position.set(0,0,0);animate(e,{position:t},optionNormalize({queue:false,duration:r.duration,easing:r.easing}))})};break;case"slideUp":a.start=function(i,e,r){if(!i.visible)return false;var t=r.complete,n=jThree.styleHooks.scale.get(i);o.scale=[0,0,0];r.complete=function(){jThree.styleHooks.display.set(i,false);jThree.styleHooks.scale.set(i,n);t&&t.call(this)};i.traverse(function(e){if(e===i)return;var t=jThree.styleHooks.position.get(e);animate(e,{position:[0,0,0]},optionNormalize({queue:false,duration:r.duration,easing:r.easing,complete:function(){jThree.styleHooks.position.set(e,t)}}))})};break;case"fadeOut":a.start=function(e,t,i){if(!e.visible)return false;var r=i.complete,n=jThree.styleHooks.opacity.get(e);o.opacity=0;i.complete=function(){jThree.styleHooks.display.set(e,false);jThree.styleHooks.opacity.set(e,n);r&&r.call(this)}};break;case"fadeIn":a.start=function(e,t,i){if(e.visible)return false;t.opacity=jThree.styleHooks.opacity.get(e);jThree.styleHooks.opacity.set(e,0);jThree.styleHooks.display.set(e,true)};break;case"hide":a.start=function(i,e,r){if(!i.visible)return false;var t=r.complete,n=jThree.styleHooks.opacity.get(i),a=jThree.styleHooks.scale.get(i);o.opacity=0;o.scale=[0,0,0];r.complete=function(){jThree.styleHooks.display.set(i,false);jThree.styleHooks.scale.set(i,a);jThree.styleHooks.opacity.set(i,n);t&&t.call(this)};i.traverse(function(e){if(e===i)return;var t=jThree.styleHooks.position.get(e);animate(e,{position:[0,0,0]},optionNormalize({queue:false,duration:r.duration,easing:r.easing,complete:function(){jThree.styleHooks.position.set(e,t)}}))})};break;case"show":a.start=function(i,e,r){if(i.visible)return false;e.opacity=jThree.styleHooks.opacity.get(i);jThree.styleHooks.opacity.set(i,0);e.scale=jThree.styleHooks.scale.get(i);i.scale.set(0,0,0);jThree.styleHooks.display.set(i,true);i.traverse(function(e){if(e===i)return;var t=jThree.styleHooks.position.get(e);e.position.set(0,0,0);animate(e,{position:t},optionNormalize({queue:false,duration:r.duration,easing:r.easing}))})};break}return e instanceof jThree?e.animate(o,a):animate(getObj(e),o,optionNormalize(a))}jThree.easing=Object.create($.easing);var projector=new THREE.Projector,pickingVector=new THREE.Vector3,eventReg=/^(currentTarget|data|delegateTarget|handleObj|jQuery\d+|target|timeStamp|type)$/;function canvasEvent(e){var i=e.data.renderer;if(!i.__renderable)return;i=projector.pickingRay(pickingVector.set(2*(e.offsetX===undefined?e.originalEvent.layerX:e.offsetX)/i.domElement.clientWidth-1,-2*(e.offsetY===undefined?e.originalEvent.layerY:e.offsetY)/i.domElement.clientHeight+1),i.__camera).intersectObjects(pickingObj(i),false)[0];if(i){$.each(e,function(e,t){if(!eventReg.test(e))i[e]=t});$(i.object.userData.dom||i.object.parent.userData.dom).trigger($.Event(e.type==="DOMMouseScroll"?"mousewheel":e.type,i))}}function pickingObj(e){var t=[];$.each(e.__camera.userData.scene.__webglObjects,function(){this.render&&t.push(this.object)});return t}THREE.Scene.prototype.eventChange=function(i,r){var n=this.userData._events=this.userData._events||{};var e=this;var a=[];var o=[];if(i){$.each(i,function(e){if(!n[e]){n[e]=[];a.push(e)}if(n[e].indexOf(r)!==-1)return;n[e].push(r)});$.each(n,function(e){var t=n[e].indexOf(r);if(i[e]||t===-1)return;if(n[e].length===1){delete n[e];o.push(e)}else{n[e].splice(t,1)}})}else{$.each(n,function(e){var t=n[e].indexOf(r);if(t===-1)return;if(n[e].length===1){delete n[e];o.push(e)}else{n[e].splice(t,1)}})}jThree("rdr").three().forEach(function(t){if(!t.__camera||t.__camera.userData.scene!==e)return;var i=$(t.domElement);a.forEach(function(e){i.on(e!=="mousewheel"?e:"DOMMouseScroll mousewheel",{renderer:t},canvasEvent)});o.forEach(function(e){i.off(e!=="mousewheel"?e:"DOMMouseScroll mousewheel",canvasEvent)});t=i=null});n=r=e=i=a=o=null};(function(){function e(){var e=$._data(this,"events");var t=jThree.three(this);if(this.tagName==="BODY"){var i=jThree("scene").three();$.each(i,function(){this.eventChange(e,t)})}else if(t instanceof THREE.Object3D){var i=this.tagName==="SCENE"?t:t.userData.scene;i.eventChange(e,t)}e=t=null}jThree.fn.on=function(){$.fn.on.apply(this,arguments);this.each(e);return this};jThree.fn.off=function(){$.fn.off.apply(this,arguments);this.each(e);return this}})();jThree.fn.mousewheel=function(e,t){return arguments.length>0?this.on("mousewheel",null,e,t):this.trigger("mousewheel")};jThree.fn.load=function(e,t,i){if(typeof e!=="string"){return $.fn.load.apply(this,arguments)}var r,n,a,o=this,s=e.indexOf(" ");if(s>=0){r=e.slice(s);e=e.slice(0,s)}if(typeof t==="function"){i=t;t=undefined}else if(t&&typeof t==="object"){n="POST"}if(o.length>0){$.ajax({url:e,type:n,dataType:"text",data:t}).done(function(e){a=arguments;o.empty().append(r?jThree(/<goml/.test(e)?e:"<obj>"+e+"</obj>").find(r):e)}).complete(i&&function(e,t){o.each(i,a||[e.responseText,t,e])})}return this};window.jThree=jThree}(window,jQuery);
jThree.MMD=jThree.mmd={_onLoop:false,_delta:0,_animate:function(_){jThree.MMD._delta=_=_*.001;if(self.MMD_SA){if(MMD_SA._rendered_once&&!MMD_SA._x_object_displayed_once){MMD_SA._x_object_displayed_once=true;MMD_SA_options.mesh_obj_all.forEach(function(e){var t=e._obj;if(!e.use_child_animation_texture)t.scale.x=t.scale.y=t.scale.z=e.scale;if(MMD_SA_options.Dungeon){e.visible=t.visible;return}e.visible=e.hidden_on_start&&!t.visible?false:t.scale.x>0;if(/^\#mikuPmx(\d+)$/.test(e.id)){var i=MMD_SA_options.model_para_obj_all[RegExp.$1];e.visible=!(i.hidden_on_start||MMD_SA_options.hidden_on_start)}if(e.visible)e.show(true);else e.hide(true)});if(MMD_SA_options.use_speech_bubble&&!MMD_SA_options.MMD_disabled){const U=MMD_SA.SpeechBubble;U._mesh.scale.x=U._mesh.scale.y=U._mesh.scale.z=1;if(!U.visible)MMD_SA.THREEX.mesh_obj.get("SpeechBubbleMESH").hide()}}MMD_SA_options.model_para_obj_all.forEach(function(e,t){if(e.scale)THREE.MMD.getModels()[t].mesh.scale.set(e.scale,e.scale,e.scale)});let t=MMD_SA_options.mesh_obj_by_id["CircularSpectrumMESH"];if(t){if(MMD_SA.music_mode||WallpaperEngine_CEF_mode&&MMD_SA.AudioFFT&&MMD_SA.AudioFFT._has_audio){if(MMD_SA.AudioFFT&&MMD_SA.AudioFFT._fft128){let e=MMD_SA_options.CircularSpectrum_position;if(!e){e=MMD_SA.center_view;e[1]+=10}if(MMD_SA_options.Dungeon){if(!t.pos_base)t.pos_base=t._obj.position.clone();if(!t.rot_base)t.rot_base={x:0,y:0,z:0};if(!t._pos_updated_){MMD_SA_options.Dungeon.character.pos_update();t._pos_updated_=true;t._obj.position.add(MMD_SA.TEMP_v3.fromArray(e))}}else{t._obj.position.fromArray(e)}const E1=t._obj.scale;E1.x=E1.y=E1.z=1;t.show();const w1=MMD_SA.AudioFFT._fft128;const T1=MMD_SA.AudioFFT._fft_last128;for(let i=0,e=w1.length;i<e;i++){let e=w1[i];let t=T1[i]||0;if(e>100)e=100;if(e<t-10)e=t-10;T1[i]=e;const T=MMD_SA.THREEX.mesh_obj.get_three("CircularSpectrum"+i+"MESH");T.material.opacity=MMD_SA_options.CircularSpectrum_opacity||.8;T.scale.y=.5+e/100*19.5}}}else{t.hide();if(MMD_SA_options.Dungeon)t._pos_updated_=undefined}}MMD_SA._rendered_once=true}if(self.MMD_SA&&!MMD_SA_options.MMD_disabled){if(MMD_SA._gravity_){var e;if(MMD_SA._gravity_factor<=0){MMD_SA._gravity_factor=null;MMD_SA._gravity_=null;e=MMD_SA.gravity}else{e=[];var L=MMD_SA.MMD.motionManager.para_SA.gravity||[0,-1,0];for(var i=0;i<3;i++)e[i]=MMD_SA._gravity_[i]*MMD_SA._gravity_factor+L[i]*(1-MMD_SA._gravity_factor);MMD_SA._gravity_factor-=1/60}THREE.MMD.setGravity(e[0]*9.8*10,e[1]*9.8*10,e[2]*9.8*10)}if(MMD_SA_options.use_JSARToolKit){var n=MMD_SA.AR_obj;if(n.startup_countdown>0){n.startup_countdown-=_;n.canvas.getContext("2d").fillRect(0,0,n.canvas.width,n.canvas.height)}else if(MMD_SA.AR_video){var t=MMD_SA_options.AR_para;var a=t.marker_base_id;var F=128;var r=[];if(!n._skip_AR_frame){var o;o=SL_webcam.getContext("2d");o.globalCompositeOperation="copy";o.drawImage(MMD_SA.AR_video,0,0,SL_webcam.width,SL_webcam.height);if(MMD_SA.matrix_rain)MMD_SA.matrix_rain._SA_draw();if(SL_webcam._WebGL_2D)SL_webcam._WebGL_2D.draw();var O=n.canvas;o=O.getContext("2d");o.globalCompositeOperation="copy";o.drawImage(MMD_SA.AR_video,0,0,n.canvas.width,n.canvas.height);O.changed=true;var z=n.markerCount=n.detector.detectMarkerLite(n.raster,F);for(var s=0;s<z;s++){var j=n.detector.getIdMarkerData(s);var l=-1;var V=j.packetLength;if(V<=4){l=0;for(var i=0;i<V;i++){l=l<<8|j.getPacketData(i)}}var d=n.markers[l];if(!d){d=n.markers[l]={m4:new THREE.Matrix4};d.transform=new NyARTransMatResult}n.resultMat=d.transform;n.detector.getTransformMatrix(s,n.resultMat);d.m4.setJsArMatrix(n.resultMat);if(l==a){d.active_counter=20*2;n._m4=d.m4;if(t._marker_base_transform){d.m4.multiply(t._marker_base_transform)}}else{d.active_counter=10*2}}}if(t.skip_alternate_AR_frame){n._skip_AR_frame=!n._skip_AR_frame}Object.keys(n.markers).forEach(function(e){var t=n.markers[e];t.active_counter--});var B;if(n._m4&&n.markers[a].active_counter<=0){n._m4=null;var K=t.marker_base_id_spare_list;for(var i=0,f=K.length;i<f;i++){var d=n.markers[K[i]];if(d&&d.active_counter>0&&d.m4_to_base){n._m4=d.m4.clone().multiply(d.m4_to_base);B=true;break}}}if(n._m4&&!B){var K=t.marker_base_id_spare_list;for(var i=0,f=K.length;i<f;i++){var d=n.markers[K[i]];if(d&&d.active_counter>0){d.m4_to_base=n._m4a.getInverse(n._m4b.getInverse(n.TEMP_m4.getInverse(d.m4).multiply(n._m4)))}}}if(n._m4){var h,m,G;var N=MMD_SA._trackball_camera.object;var W=n._m4;h=W.decompose();m=h[0];G=n.TEMP_v3.setEulerFromQuaternion(h[1].normalize());var X=G.x,q=G.y,Q=G.z;m.x=-m.x;m.y=-m.y;var Y=n._q1.setFromEuler(n.TEMP_v3.set(X-Math.PI/2,-Q,-q),"YZX");h[1]=Y.normalize();h[0].applyQuaternion(h[1]);N.matrix.identity();N.matrix.makeRotationFromQuaternion(h[1]);n.camera_position=h[0];N.matrix.setPosition(h[0]);N.matrixWorldNeedsUpdate=true;var $=n.markers[a];$.position=new THREE.Vector3(0,0,0);$.rotation=(new THREE.Quaternion).setFromEuler(n.TEMP_v3.set(-X+90/180*Math.PI,q,Q));$._camera_position=m.clone();if(h){r.push("camera("+n.markerCount+")"+(B?"(P)":"")+":"+parseInt(m.x)+","+parseInt(m.y)+","+parseInt(m.z)+"/"+parseInt(-X*180/Math.PI+90)+","+parseInt(q*180/Math.PI)+","+parseInt(Q*180/Math.PI))}Object.keys(n.markers).forEach(function(e){if(e==a)return;var t=n.markers[e];if(t.active_counter<=0)return;var i=n.TEMP_m4.getInverse(n._m4).multiply(t.m4).decompose();var o=i[0];t.position=new THREE.Vector3(o.x,-o.z,-o.y);t.rotation=i[1].normalize();r.push(e+":"+parseInt(t.position.x)+","+parseInt(t.position.y)+","+parseInt(t.position.z)+"/"+parseInt(n.TEMP_v3.setEulerFromQuaternion(t.rotation).z*180/Math.PI))})}else{r.push("(base marker not found)")}r=r.concat(MMD_SA._debug_msg);if(r.length){DEBUG_show(r.join("\n"));MMD_SA._debug_msg=[]}}else DEBUG_show("(video not available)")}var J=_;var p=MMD_SA.MMD;var u=Audio_BPM.vo;var Z=u.motion_by_song_name_mode;var c,M,v,A,g;c=p.motionManager;M=!Z&&c.para_SA.BPM||{};v=M.BPM||120;A=u.BPM_mode?u._sender.playbackRate:120/v;g=A*(M._playbackRate||1)*MMD_SA.playbackRate;jThree.MMD._delta=_=J*g;var y=THREE.MMD.getModels()[0];var e1=y.skin;MMD_SA._motion_time_=e1.time+_;var t1;if(!MMD_SA._force_motion_shuffle&&MMD_SA.motion_shuffle_started){let e={return_value:null};if(e1.time+_>c.lastFrame_/30){window.dispatchEvent(new CustomEvent("SA_MMD_model0_onmotionended",{detail:{result:e}}));if(!e.return_value){c.para_SA.onended&&c.para_SA.onended(true)}if(MMD_SA._freeze_onended){e1.time=c.lastFrame_/30-_-1/59/1e3;MMD_SA._freeze_onended=null}else{t1=true}}else{window.dispatchEvent(new CustomEvent("SA_MMD_model0_onmotionplaying",{detail:{result:e}}));if(!e.return_value){c.para_SA.onplaying&&c.para_SA.onplaying(0)}}}if(MMD_SA_options.custom_motion_shuffle)MMD_SA_options.custom_motion_shuffle();var i1=[];var S=[];for(var i=0,f=MMD_SA_options.model_para_obj_all.length;i<f;i++){i1[i]=true;S[i]=!MMD_SA.motion_shuffle_started||MMD_SA_options.model_para_obj_all[i]._motion_name_next}var x=Math.max(Math.min(e1.time+_-c.lastFrame_/30,.1),0);if(MMD_SA._force_motion_shuffle||S[0]||x){let o=!MMD_SA.motion_shuffle_started;p.frame_time_ref=0;if(!t1){let e={return_value:null};window.dispatchEvent(new CustomEvent("SA_MMD_model0_onmotionended",{detail:{result:e}}));if(!e.return_value){c.para_SA.onended&&c.para_SA.onended()}}let n=!MMD_SA.motion_shuffle_started;let a=c;let e=!MMD_SA.motion_shuffle_started;if(MMD_SA.motion_shuffle())e=true;MMD_SA_options.onmotionended&&MMD_SA_options.onmotionended(e);let t=MMD_SA_options.motion_shuffle||MMD_SA_options._motion_shuffle_list_default?MMD_SA_options.motion_shuffle_list[MMD_SA.motion_shuffle_index]:0;let r=MMD_SA_options.motion[t];if(MMD_SA._force_motion_shuffle)o=true;MMD_SA._force_motion_shuffle=null;J=1/59/1e3;let s;if(e){o=true;c=p.motionManager;M=!Z&&c.para_SA.BPM||{};v=M.BPM||120;A=u.BPM_mode?u._sender.playbackRate:120/v;g=A*(M._playbackRate||1)*MMD_SA.playbackRate;let e=c.para_SA;let t=a.para_SA;s=!n&&(t.motion_blending&&t.motion_blending.fadeout&&(!t.motion_blending.fadeout.condition||t.motion_blending.fadeout.condition(a,c))&&(!e.motion_blending||!e.motion_blending.fadein||!e.motion_blending.fadein.condition||e.motion_blending.fadein.condition(a,c))&&t.motion_blending.fadeout||e.motion_blending&&e.motion_blending.fadein&&(!e.motion_blending.fadein.condition||e.motion_blending.fadein.condition(a,c))&&(!t.motion_blending||!t.motion_blending.fadeout||!t.motion_blending.fadeout.condition||t.motion_blending.fadeout.condition(a,c))&&e.motion_blending.fadein);if(s){let e=Object.create(y.skin);e._is_skin=true;e._motion_index_MMD_SA_extra=0;e._is_MMD_SA_custom_animation=e._is_MMD_SA_animation=e._MMD_SA_disabled=e.freeze_onended=true;y.skin_MMD_SA_extra[0]=e;let t=MMD_SA_options.custom_action[0];t.blending_options=s;t._time_ini=RAF_timestamp;t._seek_time_=a.para_SA.loop_on_blending&&!a.para_SA.freeze_onended&&x&&x+(a.firstFrame_&&a.firstFrame_/30||0)||Math.min(e.time+_,a.lastFrame_/30-1/59/1e3)}let i=y._MMD_SA_cache_current=y._MMD_SA_cache[r.path];y.skin=i.skin;y.morph=i.morph;y.resetMotion(c.para_SA.initial_physics_reset!=null?!c.para_SA.initial_physics_reset:MMD_SA._ignore_physics_reset);MMD_SA.reset_skin(0);MMD_SA.reset_morph(0);THREE.MMD.adjustMotionDuration();MMD_SA_options.model_para_obj.onMotionChange&&MMD_SA_options.model_para_obj.onMotionChange();x=0}else{let e=c.para_SA.loopback_physics_reset==false||c.lastFrame_==c.lastFrame&&!c.firstFrame_&&!c.para_SA.loopback_fading;y.resetMotion(e||MMD_SA._ignore_physics_reset)}y.skin._loop_timestamp=RAF_timestamp;if(!s){y.skin_MMD_SA_extra[0]=y.morph_MMD_SA_extra[0]=MMD_SA.Animation_dummy}for(var i=1,f=MMD_SA_options.model_para_obj_all.length;i<f;i++){if(MMD_SA_options.model_para_obj_all[i].mirror_motion_from_first_model)S[i]=true}c.para_SA.onstart&&c.para_SA.onstart(e);if(o&&!c.para_SA.adjust_center_view_disabled){MMD_SA.reset_camera()}jThree.MMD._delta=_=J*g;y.playMotion();if(x||c.firstFrame_){y.seekMotion(x+(c.firstFrame_&&c.firstFrame_/30||0))}}else{x=0}for(var i=1,f=MMD_SA_options.model_para_obj_all.length;i<f;i++){if(!i1[i])continue;var D=THREE.MMD.getModels()[i];if(!D.skin)continue;var c,b;c=b=MMD_SA.motion[D.skin._motion_index];var E=MMD_SA_options.model_para_obj_all[i];var o1=E.is_OPC&&c.para_SA.BPM?c.lastFrame:c.lastFrame_;var w=Math.max(Math.min(D.skin.time+_-o1/30,.1),0);if(!S[i]){if(!w)continue;!c.para_SA.is_OPC&&c.para_SA.onended_NPC&&c.para_SA.onended_NPC(i)}else{w=0}var n1=false;var T;if(E._motion_name_next||S[i]&&E.mirror_motion_from_first_model){b=p.motionManager;w=x;var a1=E._motion_name_next||b.para_SA.multi_model_motion_list&&b.para_SA.multi_model_motion_list[i-1];E._motion_name_next=null;var r1=(a1&&MMD_SA_options.motion_para[a1]||b.para_SA)._path;var T=D._MMD_SA_cache[r1];n1=T&&T.skin._motion_index!=D.skin._motion_index}if(n1){D._MMD_SA_cache_current=T;D.skin=T.skin;D.morph=T.morph;c=MMD_SA.motion[T.skin._motion_index];if(!E.mirror_motion_from_first_model)b=c;D.resetMotion(c.para_SA.initial_physics_reset!=null?!c.para_SA.initial_physics_reset:MMD_SA._ignore_physics_reset);MMD_SA.reset_skin(i);MMD_SA.reset_morph(i);THREE.MMD.adjustMotionDuration();E.onMotionChange&&E.onMotionChange();if(c.para_SA.NPC_turns_to_you){var s1=D.mesh;var _1=THREE.MMD.getModels()[0].mesh;MMD_SA.TEMP_v3.set(0,Math.PI/2-Math.atan2(_1.position.z-s1.position.z,_1.position.x-s1.position.x),0);s1.quaternion.setFromEuler(MMD_SA.TEMP_v3)}}else{var l1=D.skin.time&&(c.para_SA.loopback_physics_reset==false||o1==c.lastFrame&&!(E._firstFrame_||c.firstFrame_)&&!c.para_SA.loopback_fading);D.resetMotion(l1||MMD_SA._ignore_physics_reset)}D.skin._loop_timestamp=RAF_timestamp;c.para_SA.onstart&&c.para_SA.onstart(n1);D.playMotion();if(w||(E._firstFrame_||b.firstFrame_)){D.seekMotion(w+((E._firstFrame_||b.firstFrame_)&&(E._firstFrame_||b.firstFrame_)/30||0))}E._firstFrame_=null}MMD_SA._ignore_physics_reset=null;var d1=window.performance?performance.now():Date.now();if(p.frame_time_ref){if(M._playbackRate){var f1=d1-p.frame_time_ref;if(f1>=M._playbackRate_countdown){var h1=M._playbackRate_countdown/f1;g=A*(M._playbackRate*h1+(1-h1));jThree.MMD._delta=_=J*g;M._playbackRate=null}else M._playbackRate_countdown-=f1}}else if(use_SVG_Clock||u.BPM_mode){var m1=M.beat_frame;if(m1!=null){var p1=(y.skin.time+_)*30;var u1=60/v;var c1=(p1-m1)/30;if(u.BPM_mode){var M1=u.audio_obj;c1-=(M1.currentTime-M1.beat_reference)*A}var k,P;k=P=c1/u1;k-=~~k;if(k<0)k++;if(k<.5)k=-k;else k=1-k;P=Math.round(P+k);if(P%2&&(!u.BPM_mode||M.match_even_beats_only)){if(k<0){k++;P++}else{k--;P--}}var v1="/"+(P%2?"odd":"even");var R=k*u1;if(!u.BPM_mode){R/=A;var A1=(new Date).getMilliseconds()/1e3;R+=A1;if(R>.5)R-=1;else if(R<-.5)R+=1;R*=A;k=R/u1}R/=A;if(Math.abs(R)>.05){var g1=Math.abs(k)>.5?2:1;M._playbackRate=1+R/g1;M._playbackRate_countdown=1e3*g1;var y1=Math.abs(~~(k*100)/100)+"beat"+v1;DEBUG_show("BPM sync("+(R>0?"+":"-")+y1+")",2)}else{}}}p.frame_time_ref=d1;if(MMD_SA.fadeout_opacity!=null){MMD_SA.fadeout_opacity-=_;let o=SL_2D_front.getContext("2d");if(MMD_SA.fadeout_opacity>0){let e,t,i;e=MMD_SA.fadeout_canvas.width;t=MMD_SA.fadeout_canvas.height;if(SL_2D_front.width!=e||SL_2D_front.height!=t){i=true;SL_2D_front.width=e;SL_2D_front.height=t}o.globalCompositeOperation="copy";o.globalAlpha=MMD_SA.fadeout_opacity;o.drawImage(MMD_SA.fadeout_canvas,0,0);if(use_WebGL_2D){if(SL_2D_front._WebGL_2D.canvas.style.display!="inline")SL_2D_front._WebGL_2D.canvas.style.display="inline";SL_2D_front._WebGL_2D.draw();if(i){SL_2D_front._WebGL_2D.canvas.style.width=SL.style.width;SL_2D_front._WebGL_2D.canvas.style.height=SL.style.height}}else{if(SL_2D_front.style.display!="inline")SL_2D_front.style.display="inline";if(i){SL_2D_front.style.width=SL.style.width;SL_2D_front.style.height=SL.style.height}}}else{MMD_SA.fadeout_opacity=null;o.globalCompositeOperation="copy";o.globalAlpha=1;o.clearRect(0,0,SL_2D_front.width,SL_2D_front.height);SL_2D_front.style.display="none";if(use_WebGL_2D){let e=SL_2D_front._WebGL_2D;e.gl.clear(e.gl.COLOR_BUFFER_BIT);e.canvas.style.display="none"}}}MMD_SA._playbackRate=g}if(!is_SA_child_animation&&MMD_SA_options.child_animation_as_texture){var S1;var C=0;for(var i=0;i<SA_child_animation_max;i++){var x1=SA_child_animation[i];if(!x1)continue;var D1=document.getElementById("Ichild_animation"+i);var b1,I;if(D1){b1=D1.contentWindow;I=b1.SL;if(!I)continue}else continue;if(!I._drawn_id||x1._SL_drawn_id!=I._drawn_id){x1._SL_drawn_id=I._drawn_id;S1=true}if(++C>=MMD_SA_options.child_animation_as_texture)break}if(S1){C=0;for(var i=0;i<SA_child_animation_max;i++){var x1=SA_child_animation[i];if(!x1)continue;var D1=document.getElementById("Ichild_animation"+i);var b1,I;if(D1){b1=D1.contentWindow;I=b1.SL;if(!I)continue}else continue;var H=jThree("import").contents().find("#j3_childAnimationCanvas"+C)[0];H._canvas_ready=true;H.width=MMD_SA_options.child_animation_width;H.height=MMD_SA_options.child_animation_height;var o=H.getContext("2d");o.globalCompositeOperation="copy";o.globalAlpha=MMD_SA_options.child_animation_opacity;try{o.drawImage(I._canvas_for_copy||I,0,0,H.width,H.height);jThree("#ChildAnimation"+C+"TXR").three(0).needsUpdate=true}catch(e){DEBUG_show(e.description)}if(++C>=MMD_SA_options.child_animation_as_texture)break}}}THREE.MMD.updateMotion(_);if(jThree.MMD._onLoop){if(THREE.MMD.motionLoop){jThree.MMD.onLoop&&jThree.MMD.onLoop()}else{THREE.MMD.pauseMotion();jThree.update(arguments.callee,false);jThree.MMD.complete&&jThree.MMD.complete()}jThree.MMD._onLoop=false}},play:function(e){if(e!==undefined)this.loop=e;THREE.MMD.playMotion(e);jThree.update(jThree.MMD._animate)},pause:function(){THREE.MMD.pauseMotion();jThree.update(jThree.MMD._animate,false)},reset:function(){THREE.MMD.resetMotion();jThree.update(jThree.MMD._animate,false)},setup:function(e){jThree.extend(jThree.MMD,e);return this},sync:function(e,t){jThree.MMD._delay=t||0;jQuery(e).on("play",jThree.MMD.play).on("pause ended",jThree.MMD.pause).on("timeupdate",function(){jThree.MMD.seek(this.currentTime+jThree.MMD._delay)})},_edgeScale:1,onLoop:null,onStop:null,_camera:true,get cameraMotion(){return this._camera},set cameraMotion(t){this._camera=t;THREE.MMD.getCameraMotion().forEach(function(e){e[t?"play":"pause"]()})},get edgeScale(){return this._edgeScale},set edgeScale(n){this._edgeScale=n;THREE.MMD.getModels().forEach(function(o){o.mesh.material.materials.forEach(function(e,t){var i=o.pmx.materials[t];if((i.drawFlags&16)!==0){e.mmdEdgeThick=i.edgeSize*n}})})},_shadowDark:.7,get shadowDark(){return this._shadowDark},set shadowDark(n){this._shadowDark=n;THREE.MMD.getModels().forEach(function(o){o.mesh.material.materials.forEach(function(e,t){var i=o.pmx.materials[t];if((i.drawFlags&8)!==0){e.mmdShadowDark=n}})})},_duration:0,get duration(){return this._duration},set duration(e){this._duration=e;THREE.MMD.adjustMotionDuration()},get groundLevel(){return jThree.MMD._ground.getY()},set groundLevel(e){jThree.MMD._ground.setY(e)},toon:["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAABlBMVEX////Nzc1XNMFjAAAAD0lEQVQI12OgNvgPBFQkAPcnP8G6A9XkAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAABlBMVEX////14eF2pXIGAAAAD0lEQVQI12OgNvgPBFQkAPcnP8G6A9XkAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAABlBMVEX///+ampo+MvaSAAAAD0lEQVQI12OgNvgPBFQkAPcnP8G6A9XkAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAABlBMVEX////47+sAKyXFAAAAD0lEQVQI12OgNvgPBFQkAPcnP8G6A9XkAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEX/////5t3/6N7/7eX/+fb/9PD//Pv/8Op5dFmOAAAAQklEQVQoz2MYBRQDtjQYgAq4gEAIiEiBCIYiAEjYjaEcBIrLoSA0lMEYDTAooQEGRQgtqAgTEEQD5AgoYQggAFgOAHEkIrrgwCawAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAflBMVEX/7WHDrAPErQT/7mT/7mn66Fj86VvizTLJswz/8of/8Hf/73L+7F7NtxLLtQ7/7mb///z//ez//OL/+9vs2ELk0Db//vX/+L7/723o1DzRvBjFrgX/+sz/+Lr/9qzw3Uj/+tL/97b/9Jf/85D/9Z//8X//6DHFrgb/+MD/5AUNrqVlAAAAwklEQVQ4y+XO226DMAwAUG/OutmhgyQQkgYYl162///BmaoV7UPFc9XzYlu2bMNrQrhS16hyRMxVCLlSgWrNmpkPvP8lDogKutb4Qbvajc5b6xpr92071qbvTMNMPfjCdzgVoulJkx2oNW4wtulqYl8YoIkVaq1lOcB8Sy4hjk4SDHTQd+8tcLokR1jxByuO8CKybDP7uLE5y84AyrKMsaqqz4VUMUZp/AjYbcW3+FrM5VbsBJxSen8kpXSCtxVPMfAPmVcPlflaGvEAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAC0lEQVQI12MY5AAAAKAAAfgHMzoAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAC0lEQVQI12MY5AAAAKAAAfgHMzoAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAC0lEQVQI12MY5AAAAKAAAfgHMzoAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAC0lEQVQI12MY5AAAAKAAAfgHMzoAAAAASUVORK5CYII="]};jThree.fn.MMD=jThree.fn.mmd=function(e,i){if(typeof e==="string"){if(e==="seek"){var t=this.three();t.forEach(function(e){if(e.__mmd){e.__mmd.seekMotion(i)}else if(e instanceof THREE.Light){var t=THREE.MMD.getLightMotion();t&&t.seek(i)}});THREE.MMD.getCameraMotion().forEach(function(e){if(t.indexOf(e.persepectiveCamera)!==-1){e.seek(i)}})}else if(e==="motion"){var o=this.three();THREE.MMD.getCameraMotion().forEach(function(e){if(o.indexOf(e.persepectiveCamera)!==-1){e[i?"play":"pause"]()}})}}else if(typeof e==="object"){var n=this;$.each(e,function(e,t){n.MMD(e,t)})}return this};(function(){var e,m,d,f,h,p,u,c,M,v,o,A,g,t,C,y,S,x,D,b,E,w,T,k,W,X,P=1/60,R;e=function(e,t){var i=new XMLHttpRequestZIP;i.onload=function(){if(1||i.status===200){t(i)}else{console.error(e,i.statusText)}i=null};i.open("GET",e,true);i.responseType="arraybuffer";i.send()};m=function(){this.count=0;this.callback=null};m.prototype.add=function(e){if(e){this.callback=e;this.count=0}this.count++};m.prototype.del=function(){this.count--;if(this.count===0&&this.callback){this.callback();this.callback=null}};d=function(e,t){this.dv=new DataView(e);this.offset=0;this.littleEndian=t};d.prototype.readInt8=function(){var e=this.offset;this.offset+=1;return this.dv.getInt8(e)};d.prototype.readUint8=function(){var e=this.offset;this.offset+=1;return this.dv.getUint8(e)};d.prototype.readInt16=function(){var e=this.offset;this.offset+=2;return this.dv.getInt16(e,this.littleEndian)};d.prototype.readUint16=function(){var e=this.offset;this.offset+=2;return this.dv.getUint16(e,this.littleEndian)};d.prototype.readInt32=function(){var e=this.offset;this.offset+=4;return this.dv.getInt32(e,this.littleEndian)};d.prototype.readUint32=function(){var e=this.offset;this.offset+=4;return this.dv.getUint32(e,this.littleEndian)};d.prototype.readFloat32=function(){var e=this.offset;this.offset+=4;return this.dv.getFloat32(e,this.littleEndian)};d.prototype.readBytes=function(e){var t=this.offset;this.offset+=e;return new Uint8Array(this.dv.buffer).subarray(t,this.offset)};h=function(e){e[2]*=-1;return e};p=function(e,t){var i;h(e);h(t);i=e[2];e[2]=t[2];t[2]=i};u=function(e){e[0]*=-1;e[1]*=-1;return e};c=function(e,t){var i;u(e);u(t);i=e[0];e[0]=t[0];t[0]=i;i=e[1];e[1]=t[1];t[1]=i};f={MAGIC:"IllegalMagicException",DATA:"IllegalDataException"};(function(){var v,A,i,g,y,S,o,t,x,n,a,r,s,_,D,l,b,E,w,T,k,P,R;v=function(e){d.call(this,e,true);if(this.readUint32()!==542657872){throw f.MAGIC}this.version=this.readFloat32();if(this.version!==2){throw f.DATA}if(this.readUint8()!==8){throw f.DATA}this.encode=this.readUint8();this.additionalUvCount=this.readUint8();this.vertexIndexSize=this.readUint8();this.textureIndexSize=this.readUint8();this.materialIndexSize=this.readUint8();this.boneIndexSize=this.readUint8();this.morphIndexSize=this.readUint8();this.rigidIndexSize=this.readUint8()};v.prototype=Object.create(d.prototype);v.prototype.constructor=v;v.prototype.readText=function(){var e=this.readInt32(),t,i;if(e===0){return""}t=[];if(this.encode===0){e/=2;while(e-- >0){t.push(this.readUint16())}}else{while(e>0){i=this.readUint8();if((i&240)===224){i&=15;i=i<<6|this.readUint8()&63;i=i<<6|this.readUint8()&63;e-=3}else if((i&224)===192){i&=31;i=i<<6|this.readUint8()&63;e-=2}else{e--}t.push(i)}}return String.fromCharCode.apply(undefined,t)};v.prototype.readIndex=function(e,t){var i;if(e===1){i=t?this.readUint8():this.readInt8()}else if(e===2){i=t?this.readUint16():this.readInt16()}else if(e===4){i=this.readInt32()}else{throw f.DATA}return i};v.prototype.readVertexIndex=function(){return this.readIndex(this.vertexIndexSize,true)};v.prototype.readTextureIndex=function(){return this.readIndex(this.textureIndexSize)};v.prototype.readMaterialIndex=function(){return this.readIndex(this.materialIndexSize)};v.prototype.readBoneIndex=function(){return this.readIndex(this.boneIndexSize)};v.prototype.readMorphIndex=function(){return this.readIndex(this.morphIndexSize)};v.prototype.readRigidIndex=function(){return this.readIndex(this.rigidIndexSize)};v.prototype.readVector=function(e,t){var i=[];while(e-- >0){i.push(this.readFloat32())}if(t)i=i.map(e=>e*MMD_SA._readVector_scale);return i};A=function(e){this.name=e.readText();this.nameEn=e.readText();this.comment=e.readText();this.commentEn=e.readText()};i=function(t){var e;this.type=t.readUint8();switch(this.type){case 0:this.bones=[i()];this.weights=[1];T++;break;case 1:this.bones=[i(),i()];e=t.readFloat32();this.weights=[e,1-e];k++;break;case 2:this.bones=[i(),i(),i(),i()];this.weights=[t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32()];P++;break;case 3:this.bones=[i(),i()];e=t.readFloat32();this.weights=[e,1-e];this.sdefC=t.readVector(3);this.sdefR0=t.readVector(3);this.sdefR1=t.readVector(3);R++;break;default:throw f.DATA}function i(){var e=t.readBoneIndex();if(e<0){e=0}return e}};g=function(e){var t;this.pos=h(e.readVector(3,true));this.normal=h(e.readVector(3));this.uv=e.readVector(2);this.additionalUvs=[];t=e.additionalUvCount;while(t-- >0){this.additionalUvs.push(e.readVector(4))}this.skin=new i(e);this.edgeScale=e.readFloat32()};y=function(e){this.path=e.readText(/\\/g,"/")};S=function(e){this.name=e.readText();this.nameEn=e.readText();this.diffuse=e.readVector(3);this.alpha=e.readFloat32();this.specular=e.readVector(3);this.power=e.readFloat32();this.ambient=e.readVector(3);this.drawFlags=e.readUint8();this.edgeColor=e.readVector(4);this.edgeSize=e.readFloat32();this.texture=e.readTextureIndex();this.sphereTexture=e.readTextureIndex();this.sphereMode=e.readUint8();this.sharedToon=e.readUint8();if(this.sharedToon===0){this.toonTexture=e.readTextureIndex()}else{this.toonTexture=e.readUint8()}this.memo=e.readText();this.indexCount=e.readInt32()};o=function(e){this.bone=e.readBoneIndex();if(e.readUint8()===1){this.limits=[e.readVector(3),e.readVector(3)];c(this.limits[0],this.limits[1])}};t=function(e){var t;this.effector=e.readBoneIndex();this.iteration=e.readInt32();this.control=e.readFloat32();this.links=[];t=e.readInt32();while(t-- >0){this.links.push(new o(e))}};x=function(e){this.name=e.readText();this.nameEn=e.readText();this.origin=h(e.readVector(3,true));this.parent=e.readBoneIndex();this.deformHierachy=e.readInt32();this.flags=e.readUint16();if((this.flags&1)!==0){this.end=e.readBoneIndex()}else{this.end=h(e.readVector(3))}if((this.flags&768)!==0){this.additionalTransform=[e.readBoneIndex(),e.readFloat32()]}if((this.flags&1024)!==0){this.fixedAxis=h(e.readVector(3))}if((this.flags&2048)!==0){this.localCoordinate=[h(e.readVector(3)),h(e.readVector(3))]}if((this.flags&4096)!==0){if(self.MMD_SA&&MMD_SA.use_afterPhysics!==false)MMD_SA.use_afterPhysics=true;this.afterPhysics=true}if((this.flags&8192)!==0){this.externalDeform=e.readInt32()}if((this.flags&32)!==0){this.IK=new t(e)}};n=function(e){this.target=e.readVertexIndex();this.offset=h(e.readVector(3,true))};a=function(e){this.target=e.readVertexIndex();this.uv=e.readVector(4)};r=function(e){this.target=e.readBoneIndex();this.pos=e.readVector(3,true);this.rot=e.readVector(4);if(this.pos[0]||this.pos[1]||this.pos[2]){this.pos_v3=new THREE.Vector3(this.pos[0],this.pos[1],-this.pos[2])}if(this.rot[0]||this.rot[1]||this.rot[2]){this.rot_q=new THREE.Quaternion(this.rot[0],this.rot[1],this.rot[2],this.rot[3]);this.rot_q=this.rot_q.setFromEuler(MMD_SA.TEMP_v3.setEulerFromQuaternion(this.rot_q).multiply(MMD_SA._v3a.set(-1,-1,1)),"YXZ")}};s=function(e){this.target=e.readMaterialIndex();this.operator=e.readUint8();this.diffuse=e.readVector(3);this.alpha=e.readFloat32();this.specular=e.readVector(3);this.power=e.readFloat32();this.ambient=e.readVector(3);this.edgeColor=e.readVector(4);this.edgeSize=e.readFloat32();this.texture=e.readVector(4);this.sphereTexture=e.readVector(4);this.toonTexture=e.readVector(4)};_=function(e){this.target=e.readMorphIndex();this.weight=e.readFloat32()};D=function(e,t){var i;this.name=e.readText();if(self.MMD_SA){var o=t.morph_translate;if(o&&o[this.name]){this.name=o[this.name]}}this.nameEn=e.readText();this.panel=e.readUint8();this.type=e.readUint8();this.items=[];i=e.readInt32();while(i-- >0){if(this.type===0){this.items.push(new _(e))}else if(this.type===1){this.items.push(new n(e))}else if(this.type===2){this.items.push(new r(e))}else if(this.type>=3&&this.type<=7){this.items.push(new a(e))}else if(this.type===8){this.items.push(new s(e))}else{throw f.DATA}}};l=function(e){this.type=e.readUint8();if(this.type===0){this.index=e.readBoneIndex()}else if(this.type===1){this.index=e.readMorphIndex()}else{throw f.DATA}};b=function(e){var t;this.name=e.readText();this.nameEn=e.readText();this.special=e.readUint8();this.items=[];t=e.readInt32();while(t-- >0){this.items.push(new l(e))}};E=function(e){this.name=e.readText();this.nameEn=e.readText();this.bone=e.readBoneIndex();this.group=e.readUint8();this.mask=e.readUint16();this.shape=e.readUint8();this.size=e.readVector(3,true);this.pos=h(e.readVector(3,true));this.rot=u(e.readVector(3));this.mass=e.readFloat32();this.posDamping=e.readFloat32();this.rotDamping=e.readFloat32();this.restitution=e.readFloat32();this.friction=e.readFloat32();this.type=e.readUint8()};w=function(e){this.name=e.readText();this.nameEn=e.readText();this.type=e.readUint8();this.rigidA=e.readRigidIndex();this.rigidB=e.readRigidIndex();this.pos=h(e.readVector(3,true));this.rot=u(e.readVector(3));this.posLower=e.readVector(3,true);this.posUpper=e.readVector(3,true);p(this.posLower,this.posUpper);this.rotLower=e.readVector(3);this.rotUpper=e.readVector(3);c(this.rotLower,this.rotUpper);this.posSpring=e.readVector(3,true);this.rotSpring=e.readVector(3)};M=function(){};M.prototype.parse=function(e){var t,i,n;var _=this;var a,o;if(self.MMD_SA){var r=decodeURIComponent(this.url_raw.replace(/^.+[\/\\]/,""));a=MMD_SA_options.model_para_obj_by_filename[r];this._model_index=this._model_index_default=a._model_index;MMD_SA._readVector_scale=(a.model_scale||1)*(MMD_SA_options.WebXR?MMD_SA_options.WebXR.model_scale||.9:1);if(/\#clone(\d+)\.pmx$/.test(r)){o=true;var s=r.replace(/\#clone(\d+)\.pmx$/,".pmx");var l=MMD_SA_options.model_para_obj_by_filename[s];var d=l._clone_parent.pmx;var f=Object.assign({},this);Object.assign(this,d,f);this.rigids=this.rigids.map(function(e){return Object.assign({},e)});this.rigid_index_by_bone=d.rigid_index_by_bone}else{t=new v(e);a._clone_parent={pmx:this}}}if(!o){this.vertices=[];this.indices=[];this.textures=[];this.materials=[];this.bones=[];this.morphs=[];this.frames=[];this.rigids=[];this.joints=[];T=k=P=R=0;this.info=new A(t);i=t.readInt32();while(i-- >0){this.vertices.push(new g(t))}i=t.readInt32();while(i-- >0){this.indices.push(t.readVertexIndex())}i=t.readInt32();while(i-- >0){this.textures.push(new y(t))}i=t.readInt32();while(i-- >0){this.materials.push(new S(t))}i=t.readInt32();while(i-- >0){this.bones.push(new x(t))}let e=self.MMD_SA&&(a.make_armIK||MMD_SA_options.make_armIK)&&this.bones.findIndex(e=>e.name=="")==-1;if(e){let r=this.bones.length;let s=this.bones.length;this.bones.forEach(e=>e.deformHierachy*=1.1);let e=this.bones.findIndex(e=>e.name=="")<this.bones.findIndex(e=>e.name=="")?["",""]:["",""];e.forEach(function(t){let e,i=[];let o,n;let a=_.bones.findIndex(e=>e.name==t+"");e=768|256;o=_.bones.find(e=>e.name==t+"");n=Object.assign({},o);n.name=n.nameEn=t+"+";n._index_IKAT=a-1+.1-32768;_.bones.push(n);o.flags|=e;o.additionalTransform=[r,1];o._index_IKAT=a+0-32768;i.unshift(r);r++;o=_.bones.find(e=>e.name==t+"");n=Object.assign({},o);n.name=n.nameEn=t+"+";n.parent=r-1;n._index_IKAT=a-1+.2-32768;_.bones.push(n);o.flags|=e;o.additionalTransform=[r,1];o._index_IKAT=a+1-32768;i.unshift(r);r++;o=_.bones.find(e=>e.name==t+"");n=Object.assign({},o);n.name=n.nameEn=t+"+";n.parent=r-1;n._index_IKAT=a-1+.3-32768;_.bones.push(n);n=Object.assign({},o);n.name=n.nameEn=t+"";n.parent=_.bones.findIndex(e=>e.name=="2");n._index_IKAT=a-1+.4-32768;n.IK={control:57.29578/180*Math.PI,effector:r,iteration:20,links:i.map(e=>({bone:e}))};n.flags|=32;_.bones.push(n);e=768|256;o.flags|=e;o.additionalTransform=[r,1];o._index_IKAT=a+2-32768;r+=2;for(let e=a;e<s;e++){_.bones[e].deformHierachy+=.01}})}if(a.skin_weight){let i={};let o=MMD_SA_options.skin_weight_mod||(MMD_SA_options.Dungeon?.5:1);Object.keys(a.skin_weight).forEach(function(t){let e=_.bones.findIndex(e=>e.name==t);if(e>=0)i[e]=a.skin_weight[t]*o});this.vertices.forEach(function(e){let n=e.skin;if(n.weights.length<=1)return;let a;let r=[];let s=n.weights.length;for(let o=0;o<s;o++){let e=i[n.bones[o]];if(e!=null){a=true;let t=n.weights[o]*(1-e);let i=1-n.weights[o];for(let e=0;e<s;e++){r[e]=(r[e]||0)+(e==o?-t:t*(n.weights[e]/i))}}}if(a){for(let e=0;e<s;e++){n.weights[e]+=r[e]}}})}i=t.readInt32();while(i-- >0){this.morphs.push(new D(t,a))}let o=this.morphs.find(e=>e.name=="");if(o&&self.MMD_SA&&MMD_SA_options.user_camera.ML_models.enabled){console.log("Use L/R");let e=Object.assign({},o);let t=Object.assign({},o);e.name=e.nameEn="L";t.name=t.nameEn="R";let i;if(o.type==1){e.items=o.items.filter(e=>_.vertices[e.target].pos[0]>0);t.items=o.items.filter(e=>_.vertices[e.target].pos[0]<0);i=true}if(i){this.morphs.push(e);this.morphs.push(t)}}i=t.readInt32();while(i-- >0){this.frames.push(new b(t))}i=t.readInt32();while(i-- >0){this.rigids.push(new E(t))}i=t.readInt32();while(i-- >0){this.joints.push(new w(t))}if(a&&a.physics_disabled){this.rigids=[];this.joints=[];console.log("Physics OFF: model-"+this._model_index)}n=this.bones;this.rigids.forEach(function(e){var t;if(e.bone>=0){t=n[e.bone].origin;e.ofs=[e.pos[0]-t[0],e.pos[1]-t[1],e.pos[2]-t[2]]}});this.rigids.forEach(function(e,t){e._index=t});this.rigid_index_by_bone={};this.rigids.forEach(function(e,t){_.rigid_index_by_bone[e.bone]=t})}if(self.MMD_SA&&a.morph_default&&!a.morph_default._is_empty){for(var h in a.morph_default){for(var m=0,p=this.morphs.length;m<p;m++){var u=this.morphs[m];if(h!=u.name)continue;var c={};if(u.type==0){u.items.forEach(function(e){if(_.morphs[e.target].type==2)_.morphs[e.target].items.forEach(function(e){c[_.bones[e.target].name]=true})});if(!c.length)continue}else if(u.type==2){u.items.forEach(function(e){c[_.bones[e.target].name]=true})}else continue;for(var M in c){if(!a.skin_default)a.skin_default={};a.skin_default._is_empty=null;if(!a.skin_default[M]){a.skin_default[M]={pos:{x:0,y:0,z:0}}}}break}}}};M.prototype.createMesh=function(c,e){var M,v,A,d,g,y,S,x,D,f;if(!this.vertices){console.error("not parsed");return}M=this;if(c.shadowDark===undefined){c.shadowDark=.3}if(c.edgeScale===undefined){c.edgeScale=1}if(c.textureAlias===undefined){c.textureAlias={}}var b,t;if(self.MMD_SA){b=MMD_SA_options.model_para_obj_all[this._model_index];var i=decodeURIComponent(this.url_raw.replace(/^.+[\/\\]/,""));if(/\#clone(\d+)\.pmx$/.test(i)){t=true;var o=i.replace(/\#clone(\d+)\.pmx$/,".pmx");var n=MMD_SA_options.model_para_obj_by_filename[o];v=n._clone_parent.geo;A=n._clone_parent.materials;this.morphs_index_by_name=v.morphs_index_by_name;e(new THREE.SkinnedMesh(v,new THREE.MeshFaceMaterial(A)));return}}v=new THREE.Geometry;A=[];if(!t){b._clone_parent.geo=v;b._clone_parent.materials=A}d=new m;d.add(function(){e(new THREE.SkinnedMesh(v,new THREE.MeshFaceMaterial(A)))});y=function(e){return new THREE.Vector3(e[0],e[1],e[2])};S=function(e){return new THREE.Vector2(e[0],e[1])};x=function(e){var t=new THREE.Color;t.r=e[0];t.g=e[1];t.b=e[2];return t};f={};var h=function(e,t){if(MMD_SA.use_webgl2)return;if(!t)return;var i=t._uv_bbox;var o=i.max.x-i.min.x;var n=i.max.y-i.min.y;if(o<=1&&n<=1)return;var a=e.image;var r,s;if(a.width>a.height){r=1;s=a.width/a.height}else{r=a.height/a.width;s=1}if(o<r*1.1&&n<s*1.1)return;var a=e.image;var _=a.width;var l=a.height;if((_&_-1)===0&&(l&l-1)===0)return;var d=Math.min(Math.pow(2,Math.round(Math.log2(a.width))),2048);var f=Math.min(Math.pow(2,Math.round(Math.log2(a.height))),2048);var h=e.image=document.createElement("canvas");h.width=d;h.height=f;h.getContext("2d").drawImage(a,0,0,d,f);console.log(t.name);console.log([d,f])};D=function(e,t,i,o){var n,a,r,s;n=e.split(".").pop().toLowerCase();for(a in c.textureAlias){if(a===n){n=c.textureAlias[a];e=e.slice(0,-a.length)+n;break}}if(f.hasOwnProperty(e)){return f[e]}s=function(){d.del();if(t)t()};d.add();if(n==="dds"){var _=!self.MMD_SA||!MMD_SA_options.flip_DDS||/^data:image/.test(e)?e:e.replace(/[^\/\\]+$/,"flipV/$&");r=THREE.ImageUtils.loadCompressedTexture(/^data:image/.test(e)?_:toFileProtocol(M.texturePath+_),undefined,function(e){e.hasTransparency=e.format!==THREE.RGB_S3TC_DXT1_Format;e.minFilter=e.magFilter=THREE.LinearFilter;d.del()},s)}else{var l=/^toon\d\d\.bmp$/.test(e)?System.Gadget.path+"\\MMD.js\\data\\":M.texturePath;r=THREE.ImageUtils.loadTexture(/^data:image/.test(e)?e:toFileProtocol(l+e),undefined,function(){var t=i;return function(e){h(e,t);d.del()}}(),s,o)}r.flipY=false;r.wrapS=r.wrapT=THREE.RepeatWrapping;f[e]=r;return r};this.vertices.forEach(function(e){var t;v.vertices.push(y(e.pos));t=e.skin;switch(t.type){case 0:v.skinWeights.push(new THREE.Vector4(t.weights[0],0,0,0));v.skinIndices.push(new THREE.Vector4(t.bones[0],0,0,0));break;case 1:case 3:v.skinWeights.push(new THREE.Vector4(t.weights[0],t.weights[1],0,0));v.skinIndices.push(new THREE.Vector4(t.bones[0],t.bones[1],0,0));break;case 2:v.skinWeights.push(new THREE.Vector4(t.weights[0],t.weights[1],t.weights[2],t.weights[3]));v.skinIndices.push(new THREE.Vector4(t.bones[0],t.bones[1],t.bones[2],t.bones[3]));break}});v.MMDmorphs=this.morphs;var a=v.morphs_index_by_name=this.morphs_index_by_name={};var r=v.morphs_weight_by_name=this.morphs_weight_by_name={};this.morphs.forEach(function(e,t){a[e.name]=t;r[e.name]=0});g=0;v.faceVertexUvs[0]=[];this.materials.forEach(function(e,t){var o,i,n,a,r,s,_,l,d;o=new C;o.name=e.name;o._xray_pass=self.MMD_SA&&MMD_SA_options._use_xray&&b.material_xray_pass&&b.material_xray_pass.test(o.name);var f=[];if(o._xray_pass){f.push({name:"xray_center",value:{type:"v3",value:new THREE.Vector3(999,999,999)}},{name:"xray_radius",value:{type:"f",value:Math.sqrt(MMD_SA_options._xray_radius*MMD_SA_options._xray_radius*3)}},{name:"xray_opacity",value:{type:"f",value:MMD_SA_options._xray_opacity}})}var h;h=MMD_SA_options.MME.self_overlay;f.push({name:"self_overlay_opacity",value:{type:"f",value:1}},{name:"self_overlay_brightness",value:{type:"f",value:1}},{name:"self_overlay_color_adjust",value:{type:"v3",value:new THREE.Vector3(1.5,1,1)}});h=MMD_SA_options.MME.HDR;f.push({name:"HDR_opacity",value:{type:"f",value:1}});h=MMD_SA_options.MME.serious_shader;f.push({name:"serious_shader_shadow_opacity",value:{type:"f",value:1}},{name:"OverBright",value:{type:"f",value:1}},{name:"ShadowDarkness",value:{type:"f",value:1}},{name:"ToonPower",value:{type:"f",value:1}},{name:"EyeLightPower",value:{type:"f",value:1}},{name:"serious_shader_mode",value:{type:"i",value:1}});if(MMD_SA.MME_shader_inline_switch_mode){["self_overlay","HDR","serious_shader"].forEach(function(e){h=MMD_SA_options.MME[e];f.push({name:e.toUpperCase(),value:{type:"i",value:1}})})}if(f.length){var m={};f.forEach(function(e){m[e.name]=e.value});o.uniforms=THREE.UniformsUtils.merge([o.uniforms,m])}var p=b.material_para||{};p=p[o.name]||p._default_||{};o.lights=true;o.skinning=true;o.ambient=x(p.ambient||e.ambient);o.color=x(p.diffuse||e.diffuse);o.specular=x(p.specular||e.specular);o.shininess=e.power;o.opacity=e.alpha;o.transparent=p.transparent!=null?p.transparent:true;if(p.side!=null){o.side=p.side}else if((e.drawFlags&1)!==0){o.side=THREE.DoubleSide}if((e.drawFlags&2)!==0&&p.castShadow!=false){o.castShadow=true;o.shadowMapCullFace=THREE.CullFaceNone}else{o.castShadow=false}if((e.drawFlags&8)!==0){o.mmdShadowDark=c.shadowDark}if((e.drawFlags&16)!==0){o.mmdEdgeThick=e.edgeSize*c.edgeScale*(b.edgeScale!=null?b.edgeScale:1);o.mmdEdgeColor=new THREE.Vector4(e.edgeColor[0],e.edgeColor[1],e.edgeColor[2],e.edgeColor[3])}if(e.texture>=0){o.map=D(M.textures[e.texture].path,function(){var i=o;return function(){var e=i.map.image=document.createElement("canvas");e.width=e.height=2;var t=e.getContext("2d");t.fillStyle="white";t.fillRect(0,0,2,2);i.map.needsUpdate=true}}(),o)}if(p.normalMap&&b.use_normalMap!==false){o.normalMap=D(p.normalMap,function(){var i=o;return function(){var e=i.map.image=document.createElement("canvas");e.width=e.height=2;var t=e.getContext("2d");t.fillStyle="white";t.fillRect(0,0,2,2);i.map.needsUpdate=true}}(),o,p.normalMap_resolution_limit?{texture_resolution_limit:p.normalMap_resolution_limit}:null);o.normalMap.wrapS=o.normalMap.wrapT=THREE.RepeatWrapping}a=null;if(e.sharedToon===0){if(e.toonTexture>=0){a=M.textures[e.toonTexture].path}}else{a=jThree.MMD.toon[e.toonTexture]}if(a){o.mmdToonMap=D(a,function(){var i=o;return function(){var e=i.mmdToonMap.image=document.createElement("canvas");e.width=e.height=2;var t=e.getContext("2d");t.fillStyle="white";t.fillRect(0,0,2,2);i.mmdToonMap.needsUpdate=true}}())}if(e.sphereMode>0&&e.sphereTexture>=0){o.mmdSphereMode=e.sphereMode;o.mmdSphereMap=D(M.textures[e.sphereTexture].path,function(){var i=o;return function(){var e=i.mmdSphereMap.image=document.createElement("canvas");e.width=e.height=2;var t=e.getContext("2d");t.fillStyle="black";t.fillRect(0,0,2,2);i.mmdSphereMap.needsUpdate=true}}())}o.setup();A.push(o);var u=o._uv_bbox={min:{x:0,y:0},max:{x:1,y:1},face_ini:g/3,face_end:(g+e.indexCount)/3};n=e.indexCount/3;if(!v._face_index_by_vertex){v._face_index_by_vertex=[]}while(n--){a=M.indices[g+2];r=M.indices[g+1];s=M.indices[g];i=new THREE.Face3(a,r,s);i.materialIndex=t;_=M.vertices[a];l=M.vertices[r];d=M.vertices[s];[a,r,s].forEach(function(e,t){if(!v._face_index_by_vertex[e])v._face_index_by_vertex[e]=[];v._face_index_by_vertex[e].push([v.faces.length,t])});v.faceVertexUvs[0].push(e.texture>=0?[S(_.uv),S(l.uv),S(d.uv)]:undefined);if(e.texture>=0&&!MMD_SA.use_webgl2){v.faceVertexUvs[0][g/3].forEach(function(e){if(e.x<u.min.x)u.min.x=e.x;else if(e.x>u.max.x)u.max.x=e.x;if(e.y<u.min.y)u.min.y=e.y;else if(e.y>u.max.y)u.max.y=e.y})}i.vertexNormals=[y(_.normal),y(l.normal),y(d.normal)];v.faces.push(i);g+=3}});v.MMDIKs=[];v.bones=[];this.bones.forEach(function(e,t){var i,o;if(e.IK){e.IK.target=t;v.MMDIKs.push(e.IK)}if(e.parent>=0){i=M.bones[e.parent].origin;i=[e.origin[0]-i[0],e.origin[1]-i[1],e.origin[2]-i[2]]}else{i=e.origin}o={};o.parent=e.parent;o.name=e.name;o.pos=i;o.rotq=[0,0,0,1];v.bones.push(o)});v.MMDjoints=this.joints;v.computeBoundingBox();v.boundingSphere=v.boundingBox.getBoundingSphere();self.MMD_SA&&MMD_SA_options.Dungeon&&MMD_SA_options.Dungeon.utils.adjust_boundingBox(v,b);console.log("boundingBox/Sphere-"+M._model_index,v.boundingBox,v.boundingSphere);d.del()};M.prototype.load=function(t,i){var o=this;this.url_raw=t;this._clone_index=-1;if(/\#clone(\d+)\.pmx$/.test(t)){t=t.replace(/\#clone(\d+)\.pmx$/,".pmx");this._clone_index=parseInt(RegExp.$1)}e(t,function(e){o.url=t;o.texturePath=/\//.test(t)?t.slice(0,t.lastIndexOf("/")+1):"";o.parse(e.response);i(o)})}})();g=function(e){var t,i;t={};for(i in e){if(e.hasOwnProperty(i)){t[i]=e[i]}}return t};(function(){var t,o,n,a,r,s,_,l;t=function(e){return e/30};o=function(e){e.sort(function(e,t){return e.time-t.time})};n=[86,111,99,97,108,111,105,100,32,77,111,116,105,111,110,32,68,97,116,97,32,48,48,48,50];a=function(e){var t,i;d.call(this,e,true);this.stringMap={};t=this.readBytes(30);for(i=0;i<n.length;i++){if(n[i]!==t[i]){throw f.MAGIC}}this.name=this.readCString(20)};a.prototype=Object.create(d.prototype);a.prototype.constructor=a;a.prototype.readCString=function(e){var t,i,o;t=this.readBytes(e);for(i=0;i<e;i++){if(t[i]===0){break}}o=String.fromCharCode.apply(undefined,THREE.MMD.Encoding.SJISToUNICODE(t.subarray(0,i)));if(this.stringMap.hasOwnProperty(o)){o=this.stringMap[o]}else{this.stringMap[o]=o}return o};a.prototype.readVector=function(e,t){var i=[];while(e-- >0){i.push(this.readFloat32())}if(t)i=i.map(e=>e*MMD_SA._readVector_scale);return i};r=function(e){this.name=e.readCString(15);this.time=t(e.readUint32());this.pos=h(e.readVector(3));this.rot=u(e.readVector(4));this.interp=e.readBytes(64).subarray(0,16)};s=function(e){this.name=e.readCString(15);this.time=t(e.readUint32());this.weight=e.readFloat32()};_=function(e){this.time=t(e.readUint32());this.distance=-e.readFloat32();this.target=h(e.readVector(3));this.rot=u(e.readVector(3));this.rot[0]*=-1;this.rot[1]*=-1;this.rot[2]*=-1;this.interp=e.readBytes(24);this.fov=e.readUint32();this.ortho=e.readInt8()};l=function(e){this.time=t(e.readUint32());this.color=e.readVector(3);this.dir=h(e.readVector(3))};v=function(){};v.prototype.parse=function(e){var t,i;t=new a(e);this.timeMax=0;this.boneKeys=[];this.morphKeys=[];this.cameraKeys=[];this.lightKeys=[];i=t.readUint32();while(i-- >0){this.boneKeys.push(new r(t))}o(this.boneKeys);i=this.boneKeys.length;if(i>0){this.timeMax=Math.max(this.timeMax,this.boneKeys[i-1].time)}i=t.readUint32();while(i-- >0){this.morphKeys.push(new s(t))}o(this.morphKeys);i=this.morphKeys.length;if(i>0){this.timeMax=Math.max(this.timeMax,this.morphKeys[i-1].time)}if(this.boneKeys.length||this.morphKeys.length){delete t.stringMap;return}i=t.readUint32();while(i-- >0){this.cameraKeys.push(new _(t))}o(this.cameraKeys);i=this.cameraKeys.length;if(i>0){this.timeMax=Math.max(this.timeMax,this.cameraKeys[i-1].time)}i=t.readUint32();while(i-- >0){this.lightKeys.push(new l(t))}o(this.lightKeys);i=this.lightKeys.length;if(i>0){this.timeMax=Math.max(this.timeMax,this.lightKeys[i-1].time)}delete t.stringMap};v.prototype.load=function(t,i){MMD_SA.vmd_by_filename[decodeURIComponent(t.replace(/^.+[\/\\]/,"").replace(/\.(vmd|bvh)$/i,""))]=this;if(/\.bvh$/i.test(t)){MMD_SA.BVHLoader().then(()=>{BVHLoader.VMD=v;BVHLoader.load(t).then(e=>{i(BVHLoader.toVMD(e))})});return}var o=this;e(toFileProtocol(t),function(e){o.url=t;o.parse(e.response);i(o)})};v.prototype.generateSkinAnimation=function(u,i){var c=self.MMD_SA&&MMD_SA_options.model_para_obj_all[u._model_index];var M=/\.vmd$/i.test(this.url);var n=self.MMD_SA&&MMD_SA_options.motion_para[decodeURIComponent(this.url.replace(/^.+[\/\\]/,"").replace(/\.(vmd|bvh)$/i,""))];var o=n&&n.adjustment_per_model&&(n.adjustment_per_model[c._filename]||n.adjustment_per_model[c._filename_cleaned]||n.adjustment_per_model._default_);o=o&&o.skin_default||{};var a=MMD_SA_options.model_para_obj_all.length>1&&n&&(n.model_index_list||n.model_name_RegExp);var s=this;var r,_,v;r=this.boneKeys;if(r.length===0){return null}var A=new RegExp("("+toRegExp(["",""],"|")+")$");var e=this.timeMax;if(n&&n.freeze_onended){n.duration=9999;n.random_range_disabled=true}_=n&&n.duration||this.timeMax;v=[];u.bones.forEach(function(l){if(i){if(!i.test(l.name)){v.push({keys:[]});return}}var e=c.skin_default[l.name];var d=self.MMD_SA&&(o[l.name]||e);if(d&&(d.motion_filter&&!d.motion_filter.test(decodeURIComponent(s.url))||d.model_filter&&!d.model_filter.test(c._filename))){d=null}if(d){var t;if(a&&l.name==""&&(!e||d!=e)&&d.pos_add){t=d.pos_add_absolute=d.pos_add;delete d.pos_add}else{t=d.pos_add_absolute||e&&e.pos_add_absolute}if(t){d=Object.assign({},d);d.pos_add=!d.pos_add?t:{x:d.pos_add.x+t.x,y:d.pos_add.y+t.y,z:d.pos_add.z+t.z}}if(d.rot_scale){if(typeof d.rot_scale=="number"){d.rot_scale={x:d.rot_scale,y:d.rot_scale,z:d.rot_scale}}}}var f,h;f=[];var m=MMD_SA_options.model_para_obj_all.length>1;var p=(c.model_scale||1)*(MMD_SA_options.WebXR?MMD_SA_options.WebXR.model_scale||.9:1);r.forEach(function(e){if(l.name===e.name){M&&MMD_SA.THREEX.utils.convert_A_pose_rotation_to_T_pose(l.name,e.rot);if(m&&d||p!=1){e=Object.assign({},e);e.rot=e.rot.slice();e.pos=e.pos.map(e=>e*p)}h=e;f.push(e);if(d){if(d.rot_slerp){d.rot_slerp._frame_=Math.round(e.time*30);var t=MMD_SA.TEMP_q.set(e.rot[0],e.rot[1],e.rot[2],e.rot[3]).toAxisAngle();e.rot=MMD_SA.TEMP_q.setFromAxisAngle(t[0],t[1]*d.rot_slerp).toArray()}if(d.rot_axis){d.rot_axis._frame_=Math.round(e.time*30);var i=new THREE.Vector3;var o;if(d.rot_axis.x){i.set(1,0,0);o=d.rot_axis.x}MMD_SA._q1.set(e.rot[0],e.rot[1],e.rot[2],e.rot[3]);i.applyQuaternion(MMD_SA._q1);e.rot=MMD_SA.TEMP_q.setFromAxisAngle(i,o*Math.PI/180).multiply(MMD_SA._q1).toArray()}if(d.rot_scale){d.rot_scale._frame_=Math.round(e.time*30);e.rot=MMD_SA.TEMP_q.setFromEuler(MMD_SA.TEMP_v3.setEulerFromQuaternion(MMD_SA._q1.set(e.rot[0],e.rot[1],e.rot[2],e.rot[3]),"YXZ").multiply(d.rot_scale),"YXZ").toArray()}if(d.rot_add){d.rot_add._frame_=Math.round(e.time*30);var n=d.rot_add;e.rot=MMD_SA.TEMP_q.set(e.rot[0],e.rot[1],e.rot[2],e.rot[3]).multiply(MMD_SA._q1.setFromEuler(MMD_SA.TEMP_v3.set(-n.x,n.y,-n.z).multiplyScalar(Math.PI/180),"YXZ")).toArray()}if(d.pos_scale){d.pos_scale._frame_=Math.round(e.time*30);var a=d.pos_scale;if(a.auto_adjust){var r=THREE.MMD.getModels()[u._model_index].mesh.bones_by_name;if(r[""]){var s=c._ref_length=c._ref_length||{};var _=s[e.name];if(!_)_=s[e.name]=u.bones[r[""]._index].origin[1]-(e.name.indexOf("")!=-1&&r[""]?u.bones[r[""]._index].origin[1]:0);e.pos[1]*=(_/a.auto_adjust.ref_length-1)*(a.auto_adjust.scale||1)+1}}else{e.pos[0]*=a.x;e.pos[1]*=a.y;e.pos[2]*=a.z}}if(d.pos_add){d.pos_add._frame_=Math.round(e.time*30);var a=d.pos_add;e.pos[0]+=a.x;e.pos[1]+=a.y;e.pos[2]+=-a.z}}}});if(self.MMD_SA){let n=d&&(d.pos_add||e&&e.pos_add||{x:0,y:0,z:0});let a=d&&(d.rot_add||e&&e.rot_add||{x:0,y:0,z:0});let r=["x","y","z"];if(d&&(d.keys||!f.length&&(d.pos||d.rot||d.pos_add||d.rot_add))){let e=d.keys?d.keys:[{pos:d.pos,rot:d.rot,time:d.time,interp:d.interp}];f=[];e.forEach(function(e){var t=e.pos;var i=e.rot;f.push({name:l.name,time:e.time||0,pos:(t?[t.x,t.y,-t.z]:[0,0,0]).map((e,t)=>e+n[r[t]]*(t==2?-1:1)),rot:MMD_SA.TEMP_q.setFromEuler(MMD_SA.TEMP_v3.fromArray((i?[-i.x,i.y,-i.z]:[0,0,0]).map((e,t)=>e*Math.PI/180+a[r[t]]*(t==1?1:-1))),"YXZ").toArray(),interp:new Uint8Array(e.interp||[20,20,20,20,20,20,20,20,107,107,107,107,107,107,107,107])});M&&MMD_SA.THREEX.utils.convert_A_pose_rotation_to_T_pose(l.name,f[f.length-1].rot)});h=f[f.length-1]}if(d&&d.keys_mod){d.keys_mod.forEach(function(t){var e=f.find(function(e){return Math.round(e.time*30)==t.frame});if(!e)return;var i=t.pos;var o=t.rot;if(i)e.pos=[i.x,i.y,-i.z].map((e,t)=>e+n[r[t]]*(t==2?-1:1));if(o){e.rot=MMD_SA.TEMP_q.setFromEuler(MMD_SA.TEMP_v3.fromArray([-o.x,o.y,-o.z].map((e,t)=>e*Math.PI/180+a[r[t]]*(t==1?1:-1))),"YXZ").toArray();M&&MMD_SA.THREEX.utils.convert_A_pose_rotation_to_T_pose(l.name,e.rot)}if(t.interp)e.interp=new Uint8Array(t.interp)})}if(h&&(f.length>1||h.time<_)&&/guitar|g_head|g_bridge|f_board|\u8155\uFF29\uFF2B/.test(l.name)){s.use_armIK=true}}if(h&&h.time<_){h=g(h);h.time=_;f.push(h)}if((!n||!n.IK_disabled||n.IK_disabled._IK_name_list)&&A.test(l.name)){let o;if(f.length<=1){o=true}else if(f.length==2){let e=f[f.length-1];let t=e.pos;let i=e.rot;if(t[0]==0&&t[1]==0&&t[2]==0&&i[0]==0&&i[1]==0&&i[2]==0)o=true}if(o){let e=decodeURIComponent(s.url.replace(/^.+[\/\\]/,"").replace(/\.(vmd|bvh)$/i,""));n=MMD_SA_options.motion_para[e]=MMD_SA_options.motion_para[e]||{};n.IK_disabled=n.IK_disabled||{test:function(e){return this._IK_name_list.indexOf(e)!=-1},_IK_name_list:[]};n.IK_disabled._IK_name_list.push(l.name)}}v.push({keys:f})});if(n&&n.IK_disabled&&n.IK_disabled._IK_name_list){n.IK_disabled._IK_name_list=n.IK_disabled._IK_name_list.filter(function(e){return e.indexOf("")!=-1?n.IK_disabled._IK_name_list.indexOf(e.charAt(0)+"")!=-1:true});if(n.IK_disabled._IK_name_list.length==0)delete n.IK_disabled;else console.log("IK disabled auto:",decodeURIComponent(s.url.replace(/^.+[\/\\]/,"").replace(/\.(vmd|bvh)$/i,"")))}return{_timeMax:e,duration:_,targets:v}};v.prototype.generateMorphAnimation=function(e,_){var l=self.MMD_SA&&MMD_SA_options.model_para_obj_all[e._model_index];var d,f,h;d=this.morphKeys;if(d.length===0){if(!self.MMD_SA||l.morph_default._is_empty){return null}}f=this.timeMax;h=[];var m=self.MMD_SA&&l.morph_filter;var p=this;var u=[];var t=self.MMD_SA&&MMD_SA_options.motion_para[decodeURIComponent(this.url.replace(/^.+[\/\\]/,"").replace(/\.(vmd|bvh)$/i,""))];var c=t&&t.adjustment_per_model&&(t.adjustment_per_model[l._filename]||t.adjustment_per_model[l._filename_cleaned]||t.adjustment_per_model._default_);c=c&&c.morph_default||{};f=t&&t.duration||f;var M=[];if(MMD_SA_options.auto_blink)M[e.morphs_index_by_name[""]]=true;e.morphs.forEach(function(e,t){if(e.type!=0)return;if(_&&!_.test(e.name)||m&&!m.test(e.name)){return}var i=self.MMD_SA&&(c[e.name]||l.morph_default[e.name]);if(i&&i.motion_filter&&!i.motion_filter.test(decodeURIComponent(p.url))){i=null}var o;if(M[t]||i&&(!i.weight_scale||i.weight||i.keys))o=true;else{for(var n=0,a=d.length;n<a;n++){var r=d[n];if(e.name===r.name){if(r.weight>0){o=true;break}}}}if(o){e.items.forEach(function(e){M[e.target]=true})}});e.morphs.forEach(function(t,i){if(_&&!_.test(t.name)||m&&!m.test(t.name)){return}var o,n;var a=0;var r=self.MMD_SA&&(c[t.name]||l.morph_default[t.name]);if(r&&r.motion_filter&&!r.motion_filter.test(decodeURIComponent(p.url))){r=null}if(1){o=[];var s=MMD_SA_options.model_para_obj_all.length>1;d.forEach(function(e){if(t.name===e.name){if(s){e=Object.assign({},e)}n=e;o.push(e);e.morph_type=t.type;e.morph_index=i;if(r&&r.weight_scale)e.weight*=r.weight_scale;a=Math.max(a,e.weight)}});if(!a||r&&r.keys){o=[];n=undefined;if(r&&(!r.weight_scale||r.weight||r.keys)){if(r.keys){r.keys.forEach(function(e){o.push({name:t.name,weight:e.weight,time:e.time,morph_type:t.type,morph_index:i})})}else{o.push({name:t.name,weight:r.weight===0?0:r.weight||1,time:r.time||0,morph_type:t.type,morph_index:i})}n=o[o.length-1]}else if(M[i]){o.push({name:t.name,weight:0,time:0,morph_type:t.type,morph_index:i});n=o[o.length-1]}}if(!n){return}if(n.time<f){n=g(n);n.time=f;o.push(n)}if(t.type!=1){u.push({keys:o})}else h.push({keys:o})}});h=h.concat(u);if(h.length===0){}return{duration:f,targets:h}};v.prototype.generateCameraAnimation=function(){var e,t,i,o;e=this.cameraKeys;if(e.length===0){return null}t=this.timeMax;i=[];e.forEach(function(e){o=e;i.push(e)});if(o&&o.time<t){o=g(o);o.time=t;i.push(o)}return{duration:t,keys:i}};v.prototype.generateLightAnimation=function(){var e,t,i,o;e=this.lightKeys;if(e.length===0){return null}t=this.timeMax;i=[];e.forEach(function(e){o=e;i.push(e)});if(o&&o.time<t){o=g(o);o.time=t;i.push(o)}return{duration:t,keys:i}}})();t={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,THREE.UniformsLib["uniTexture"],{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)},MMDShadow:{type:"f",value:0},mmdToonMap:{type:"t",value:null},mmdSphereMap:{type:"t",value:null},mmdEdgeThick:{type:"f",value:0},mmdEdgeColor:{type:"v4",value:new THREE.Vector4(0,0,0,1)},mmdShadowDark:{type:"f",value:0}}]),vertexShader:"#define MMD\n#define PHONG\nvarying vec3 vViewPosition;varying vec3 vNormal;\n#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;uniform vec4 offsetRepeat;\n#endif\n#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif\n#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nvarying vec3 vReflect;uniform float refractionRatio;uniform bool useRefract;\n#endif\n#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];uniform float pointLightDistance[ MAX_POINT_LIGHTS ];varying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n"+THREE.ShaderChunk["uniTexture_pars_vertex"]+"\n"+"#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined(USE_XRAY_PASS)\n"+"varying vec3 vWorldPosition;\n"+"#endif\n"+"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n"+"#ifdef USE_MORPHTARGETS\n#ifndef USE_MORPHNORMALS\n"+"uniform float morphTargetInfluences[ 8 ];\n#else\nuniform float morphTargetInfluences[ 4 ];\n"+"#endif\n#endif\n"+"#ifdef USE_SKINNING\n#ifdef BONE_TEXTURE\nuniform sampler2D boneTexture;mat4 getBoneMatrix( const in float i ) {float j = i * 4.0;float x = mod( j, N_BONE_PIXEL_X );float y = floor( j / N_BONE_PIXEL_X );const float dx = 1.0 / N_BONE_PIXEL_X;const float dy = 1.0 / N_BONE_PIXEL_Y;y = dy * ( y + 0.5 );vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );mat4 bone = mat4( v1, v2, v3, v4 );return bone;}\n#else\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];mat4 getBoneMatrix( const in float i ) {mat4 bone = boneGlobalMatrices[ int(i) ];return bone;}\n#endif\n#endif\n#ifdef USE_SHADOWMAP\n"+"varying vec3 normal_untransformed;"+"varying vec4 vShadowCoord[ MAX_SHADOWS ];uniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif\n#ifdef MMD\nuniform float mmdEdgeThick;\n#endif\n#ifdef MMD_SPHEREMAP\nvarying vec2 vUvSphere;\n#endif\n"+"void main() {\n"+"#ifdef USE_SKINNING\nmat4 skinMatrix;\n#ifdef MMD\nskinMatrix  = skinWeight.x * getBoneMatrix( skinIndex.x );if ( skinWeight.y > 0.0 ) {skinMatrix += skinWeight.y * getBoneMatrix( skinIndex.y );if ( skinWeight.z > 0.0 ) {skinMatrix += skinWeight.z * getBoneMatrix( skinIndex.z );skinMatrix += skinWeight.w * getBoneMatrix( skinIndex.w );}}\n#else\nskinMatrix =skinWeight.x * getBoneMatrix( skinIndex.x ) +skinWeight.y * getBoneMatrix( skinIndex.y );\n#endif\n#endif\nvec3 objectNormal = normal;\n"+"#ifdef USE_MORPHNORMALS\n"+function(){let t="";for(let e=0;e<4;e++)t+="objectNormal += ( morphNormal"+e+" - normal ) * morphTargetInfluences[ "+e+" ];\n";return t}()+"#endif\n"+"#ifdef USE_SKINNING\nobjectNormal.xyz = ( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n#ifdef FLIP_SIDED\nobjectNormal = -objectNormal;\n#endif\n"+"#ifdef USE_SHADOWMAP\n"+"  normal_untransformed = normalize(mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal);\n"+"#endif\n"+"vNormal = normalize( normalMatrix * objectNormal );vec3 objectPosition = position;\n"+"#ifdef USE_MORPHTARGETS\n"+function(){let t="";for(let e=0;e<8;e++)t+="objectPosition += ( morphTarget"+e+" - position ) * morphTargetInfluences[ "+e+" ];\n";return t}()+"#endif\n"+"#ifdef USE_UNI_TEXTURE\n"+"  vec3 uniTexture_pos = objectPosition;\n"+"#endif\n"+"#ifdef USE_SKINNING\nobjectPosition.xyz = ( skinMatrix * vec4( objectPosition, 1.0 ) ).xyz;\n#endif\nvec4 mvPosition = modelViewMatrix * vec4( objectPosition, 1.0 );gl_Position = projectionMatrix * mvPosition;\n"+"#ifdef MMD\n"+"if (mmdEdgeThick > 0.0) {\n"+"#ifdef USE_XRAY_PASS\n"+"vWorldPosition = (modelMatrix * vec4( objectPosition, 1.0 )).xyz;\n"+"#endif\n"+"vec2 offset;offset.x = vNormal.x * projectionMatrix[0][0] / projectionMatrix[1][1];offset.y = vNormal.y;gl_Position.xy += offset * gl_Position.w * mmdEdgeThick;return;}\n"+"#endif\n"+"vViewPosition = -mvPosition.xyz;\n#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\nvec4 worldPosition = modelMatrix * vec4( objectPosition, 1.0 );\n#endif\n#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nvec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;worldNormal = normalize( worldNormal );vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );if ( useRefract ) {vReflect = refract( cameraToVertex, worldNormal, refractionRatio );} else {vReflect = reflect( cameraToVertex, worldNormal );}\n#endif\n#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );vec3 lVector = lPosition.xyz - mvPosition.xyz;float lDistance = 1.0;if ( pointLightDistance[ i ] > 0.0 )lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );vPointLight[ i ] = vec4( lVector, lDistance );}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );vec3 lVector = lPosition.xyz - mvPosition.xyz;float lDistance = 1.0;if ( spotLightDistance[ i ] > 0.0 )lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );vSpotLight[ i ] = vec4( lVector, lDistance );}\n#endif\n#endif\n"+"#ifdef USE_UNI_TEXTURE\n"+["uniTexture_pos = uniTexture_pos - vec3(uniTexture_bs, -uniTexture_bs, uniTexture_bs) * 10.;","uniTexture_MatrixRain_opacity = (uniTexture_MatrixRain_height_limit.x > 0.0) ? clamp((1.0 - (uniTexture_MatrixRain_height_limit.y + uniTexture_bs - position.y) / (uniTexture_bs * 2.0) - uniTexture_MatrixRain_height_limit.x) / (uniTexture_MatrixRain_height_limit.x*0.25), 0.0, 1.0) : 1.0;","uniTexture_vUv = vec2(-length(uniTexture_pos.xz), length(uniTexture_pos.yz)) * 0.1 / uniTexture_scale;","#if !(MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined(USE_XRAY_PASS))","  vWorldPosition = worldPosition.xyz;","#endif"].join("\n")+"\n"+"#endif\n"+"#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined(USE_XRAY_PASS)\n"+"vWorldPosition = worldPosition.xyz;\n"+"#endif\n"+"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;}\n#endif\n#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif\n#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif\n#ifdef MMD_SPHEREMAP\nvUvSphere = vNormal.xy * 0.5 + 0.5;vUvSphere.y = 1.0 - vUvSphere.y;\n#endif\n#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif\n"+"}",fragmentShader:"#define MMD\nuniform vec3 diffuse;uniform float opacity;uniform vec3 ambient;uniform vec3 emissive;uniform vec3 specular;uniform float shininess;\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\nuniform sampler2D map;\n#endif\n#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;uniform sampler2D lightMap;\n#endif\n#ifdef USE_ENVMAP\nuniform float reflectivity;uniform samplerCube envMap;uniform float flipEnvMap;uniform int combine;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nuniform bool useRefract;uniform float refractionRatio;\n#else\nvarying vec3 vReflect;\n#endif\n#endif\n#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;uniform float fogFar;\n#endif\n#endif\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#else\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n"+THREE.ShaderChunk["uniTexture_pars_fragment"]+"\n"+"#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined(USE_XRAY_PASS)\n"+"varying vec3 vWorldPosition;\n"+"#endif\n"+"#ifdef USE_XRAY_PASS\n"+"uniform vec3 xray_center;\n"+"uniform float xray_radius;\n"+"uniform float xray_opacity;\n"+"#endif\n"+MMD_SA.MME_shader("HDR").fvar+MMD_SA.MME_shader("self_overlay").fvar+MMD_SA.MME_shader("serious_shader").fvar+"#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;varying vec3 vNormal;\n#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];uniform vec2 shadowMapSize[ MAX_SHADOWS ];uniform float shadowDarkness[ MAX_SHADOWS ];"+"uniform vec3 shadowBias[ MAX_SHADOWS ];"+"uniform vec3 shadowPara[ MAX_SHADOWS ];"+"varying vec3 normal_untransformed;"+"varying vec4 vShadowCoord[ MAX_SHADOWS ];float unpackDepth( const in vec4 rgba_depth ) {const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );float depth = dot( rgba_depth, bit_shift );return depth;}\n#endif\n#ifdef USE_BUMPMAP\nuniform sampler2D bumpMap;uniform float bumpScale;vec2 dHdxy_fwd() {vec2 dSTdx = dFdx( vUv );vec2 dSTdy = dFdy( vUv );float Hll = bumpScale * texture2D( bumpMap, vUv ).x;float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;return vec2( dBx, dBy );}vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {vec3 vSigmaX = dFdx( surf_pos );vec3 vSigmaY = dFdy( surf_pos );vec3 vN = surf_norm;vec3 R1 = cross( vSigmaY, vN );vec3 R2 = cross( vN, vSigmaX );float fDet = dot( vSigmaX, R1 );vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );return normalize( abs( fDet ) * surf_norm - vGrad );}\n#endif\n#ifdef USE_NORMALMAP\nuniform sampler2D normalMap;uniform vec2 normalScale;vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {vec3 q0 = dFdx( eye_pos.xyz );vec3 q1 = dFdy( eye_pos.xyz );vec2 st0 = dFdx( vUv.st );vec2 st1 = dFdy( vUv.st );vec3 S = normalize(  q0 * st1.t - q1 * st0.t );vec3 T = normalize( -q0 * st1.s + q1 * st0.s );vec3 N = normalize( surf_norm );vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;mapN.xy = normalScale * mapN.xy;mat3 tsn = mat3( S, T, N );return normalize( tsn * mapN );}\n#endif\n#ifdef USE_SPECULARMAP\nuniform sampler2D specularMap;\n#endif\n"+"#ifdef MMD\n"+"uniform float MMDShadow;"+"uniform float mmdEdgeThick;uniform vec4 mmdEdgeColor;uniform float mmdShadowDark;\n"+"#endif\n"+"#ifdef MMD_TOONMAP\nuniform sampler2D mmdToonMap;\n#endif\n#ifdef MMD_SPHEREMAP\nvarying vec2 vUvSphere;uniform sampler2D mmdSphereMap;\n#endif\n"+THREE.ShaderChunk["AT_depth_render_mode_pars_fragment"]+"\n"+["vec3 YCbCrtoRGB(float Y, float Cb, float Cr) {","    float R = Y - 0.000982 * Cb + 1.401845 * Cr;","    float G = Y - 0.345117 * Cb - 0.714291 * Cr;","    float B = Y + 1.771019 * Cb - 0.000154 * Cr;","    return vec3( R, G, B );","}"].join("\n")+"\n"+"void main() {\n"+THREE.ShaderChunk["AT_depth_render_mode_fragment"]+"\n"+"#ifdef MMD\nif (mmdEdgeThick > 0.0) {gl_FragColor = mmdEdgeColor;} else {\n#endif\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );vec4 texelColor;\n"+"#ifdef USE_MAP\n"+"texelColor = texture2D( map, vUv );\n"+"#ifdef GAMMA_INPUT\ntexelColor.xyz *= texelColor.xyz;\n#endif\n"+"gl_FragColor = gl_FragColor * texelColor;\n"+"#endif\n"+"#ifdef MMD_SPHEREMAP\n"+"texelColor = texture2D( mmdSphereMap, vUvSphere );\n"+"#ifdef GAMMA_INPUT\ntexelColor.xyz *= texelColor.xyz;\n#endif\n"+"#if MMD_SPHEREMAP == 1\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor.xyz = gl_FragColor.xyz + texelColor.xyz;\n#endif\n"+"#endif\n"+"vec4 ShadowColor;\n"+"float Y, Cb, Cr;\n"+"vec3 shadowColor = vec3( 1.0 );\n"+"#ifdef MAX_DIR_LIGHTS\n"+"float comp_list[MAX_DIR_LIGHTS];\n"+"#endif\n"+MMD_SA.MME_shader_branch("SERIOUS_SHADER",true)+"ShadowColor = vec4(gl_FragColor.rgb, 1.0);\n"+MMD_SA.MME_shader_branch("SERIOUS_SHADER",false)+"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif\nfloat specularStrength;\n#ifdef USE_SPECULARMAP\nvec4 texelSpecular = texture2D( specularMap, vUv );specularStrength = texelSpecular.r;\n#else\nspecularStrength = 1.0;\n#endif\nvec3 normal = vNormal;vec3 viewPosition = normalize( vViewPosition );\n#ifdef DOUBLE_SIDED\nnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#ifdef USE_NORMALMAP\nnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\nnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\nvec3 totalDiffuse = vec3( 0.0 );vec3 totalSpecular = vec3( 0.0 );\n#ifdef MMD\nvec3 totalToon = vec3( 0.0 );\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );vec3 lVector = lPosition.xyz + vViewPosition.xyz;float lDistance = 1.0;if ( pointLightDistance[ i ] > 0.0 )lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );lVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );float lDistance = vPointLight[ i ].w;\n#endif\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n#endif\n#ifdef MMD\n#ifdef MMD_TOONMAP\ntotalToon += (1.0 - totalToon) * texture2D( mmdToonMap, vec2( 0.0, 1.0 - ( 0.5 * dotProduct + 0.5 ) ) ).xyz;\n#else\ntotalToon += (1.0 - totalToon) * vec3( 1.0 );\n#endif\ntotalDiffuse += (1.0 - totalDiffuse) * diffuse * pointLightColor[ i ] * lDistance;\n#else\ntotalDiffuse += (1.0 - totalDiffuse) * diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\n#endif\nvec3 pointHalfVector = normalize( lVector + viewPosition );float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );float pointSpecularWeight = specularStrength * pow( pointDotNormalHalf, shininess );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );totalSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n#else\ntotalSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );vec3 lVector = lPosition.xyz + vViewPosition.xyz;float lDistance = 1.0;if ( spotLightDistance[ i ] > 0.0 )lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );lVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vSpotLight[ i ].xyz );float lDistance = vSpotLight[ i ].w;\n#endif\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );if ( spotEffect > spotLightAngleCos[ i ] ) {spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );float dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n#endif\n#ifdef MMD\n#ifdef MMD_TOONMAP\ntotalToon += (1.0 - totalToon) * texture2D( mmdToonMap, vec2( 0.0, 1.0 - ( 0.5 * dotProduct + 0.5 ) ) ).xyz;\n#else\ntotalToon += (1.0 - totalToon) * vec3( 1.0 );\n#endif\ntotalDiffuse += (1.0 - totalDiffuse) * diffuse * spotLightColor[ i ] * lDistance * spotEffect;\n#else\ntotalDiffuse += (1.0 - totalDiffuse) * diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\n#endif\nvec3 spotHalfVector = normalize( lVector + viewPosition );float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );float spotSpecularWeight = specularStrength * pow( spotDotNormalHalf, shininess );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );totalSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n#else\ntotalSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;\n#endif\n}}\n#endif\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );vec3 dirVector = normalize( lDirection.xyz );"+"float dotProduct = dot( normal, dirVector );\n"+MMD_SA.MME_shader_branch("SERIOUS_SHADER",true)+"comp_list[i] = dotProduct;\n"+MMD_SA.MME_shader_branch("SERIOUS_SHADER",false)+"#ifdef WRAP_AROUND\nfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n#endif\n#ifdef MMD\n#ifdef MMD_TOONMAP\ntotalToon += (1.0 - totalToon) * texture2D( mmdToonMap, vec2( 0.0, 1.0 - ( 0.5 * dotProduct + 0.5 ) ) ).xyz;\n#else\ntotalToon += (1.0 - totalToon) * vec3( 1.0 );\n#endif\ntotalDiffuse += (1.0 - totalDiffuse) * diffuse * directionalLightColor[ i ];\n#else\ntotalDiffuse += (1.0 - totalDiffuse) * diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n#endif\nvec3 dirHalfVector = normalize( dirVector + viewPosition );float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );float dirSpecularWeight = specularStrength * pow( dirDotNormalHalf, shininess );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );totalSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ntotalSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );vec3 lVector = normalize( lDirection.xyz );float dotProduct = dot( normal, lVector );float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n#ifdef MMD\n#ifdef MMD_TOONMAP\ntotalToon += (1.0 - totalToon) * texture2D( mmdToonMap, vec2( 0.0, 1.0 - hemiDiffuseWeight ) ).xyz;\n#else\ntotalToon += (1.0 - totalToon) * vec3( 1.0 );\n#endif\n#endif\nvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );totalDiffuse += (1.0 - totalDiffuse) * diffuse * hemiColor;vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;float hemiSpecularWeightSky = specularStrength * pow( hemiDotNormalHalfSky, shininess );vec3 lVectorGround = -lVector;vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;float hemiSpecularWeightGround = specularStrength * pow( hemiDotNormalHalfGround, shininess );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat dotProductGround = dot( normal, lVectorGround );float specularNormalization = ( shininess + 2.0001 ) / 8.0;vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );totalSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n#else\ntotalSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;\n#endif\n}\n#endif\n#ifdef MMD\ntotalSpecular = max( totalSpecular, 0.0 );\n#endif\n"+"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif\n#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif\n#ifdef USE_ENVMAP\nvec3 reflectVec;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );if ( useRefract ) {reflectVec = refract( cameraToVertex, normal, refractionRatio );} else {reflectVec = reflect( cameraToVertex, normal );}\n#else\nreflectVec = vReflect;\n#endif\n#ifdef DOUBLE_SIDED\nfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n#else\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n#endif\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );} else if ( combine == 2 ) {gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;} else {gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );}\n#endif\n"+"#ifdef USE_SHADOWMAP\n"+"#ifdef MMD\nif (mmdShadowDark > 0.0) {\n#endif\n#ifdef SHADOWMAP_DEBUG\nvec3 frustumColors[3];frustumColors[0] = vec3( 1.0, 0.5, 0.0 );frustumColors[1] = vec3( 0.0, 1.0, 0.8 );frustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n#endif\n#ifdef SHADOWMAP_CASCADE\nint inFrustumCount = 0;\n#endif\nfloat fDepth;"+"vec3 SP;"+"\n#pragma unroll_loop\n"+"for( int i = 0; i < MAX_SHADOWS; i ++ ) {//LOOP_START\n"+"SP = shadowPara[i];"+"vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );bool inFrustum = all( inFrustumVec );\n#ifdef SHADOWMAP_CASCADE\ninFrustumCount += int( inFrustum );bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n#else\nbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n#endif\nbool frustumTest = all( frustumTestVec );if ( frustumTest ) {"+"shadowCoord.z += shadowBias[ i ].x * clamp(abs(tan(acos(clamp(dot(directionalLightDirection[ int(SP.y) ], normal_untransformed), -1., 1.)))), shadowBias[ i ].y, shadowBias[ i ].z);\n"+"#ifdef MMD\nfloat darkness = mmdShadowDark;\n#else\nfloat darkness = shadowDarkness[ i ];\n#endif\n"+"#if defined( SHADOWMAP_TYPE_PCF )\nfloat shadow = 0.0;const float shadowDelta = 1.0 / 9.0;float xPixelOffset = 1.0 / shadowMapSize[ i ].x;float yPixelOffset = 1.0 / shadowMapSize[ i ].y;float dx0 = -1.25 * xPixelOffset;float dy0 = -1.25 * yPixelOffset;float dx1 = 1.25 * xPixelOffset;float dy1 = 1.25 * yPixelOffset;fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );if ( fDepth < shadowCoord.z ) shadow += shadowDelta;fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );if ( fDepth < shadowCoord.z ) shadow += shadowDelta;fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );if ( fDepth < shadowCoord.z ) shadow += shadowDelta;fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );if ( fDepth < shadowCoord.z ) shadow += shadowDelta;fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );if ( fDepth < shadowCoord.z ) shadow += shadowDelta;fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );if ( fDepth < shadowCoord.z ) shadow += shadowDelta;fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );if ( fDepth < shadowCoord.z ) shadow += shadowDelta;fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );if ( fDepth < shadowCoord.z ) shadow += shadowDelta;fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );if ( fDepth < shadowCoord.z ) shadow += shadowDelta;shadowColor = shadowColor * vec3( ( 1.0 - darkness * shadow ) );\n"+"#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\nfloat shadow = 0.0;float xPixelOffset = 1.0 / shadowMapSize[ i ].x;float yPixelOffset = 1.0 / shadowMapSize[ i ].y;float dx0 = -1.0 * xPixelOffset;float dy0 = -1.0 * yPixelOffset;float dx1 = 1.0 * xPixelOffset;float dy1 = 1.0 * yPixelOffset;mat3 shadowKernel;mat3 depthKernel;depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );vec3 shadowZ = vec3( shadowCoord.z );shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));shadowKernel[0] *= vec3(0.25);shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));shadowKernel[1] *= vec3(0.25);shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));shadowKernel[2] *= vec3(0.25);vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );vec4 shadowValues;shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );shadow = dot( shadowValues, vec4( 1.0 ) );shadowColor = shadowColor * vec3( ( 1.0 - darkness * shadow ) );\n"+"#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );float fDepth = unpackDepth( rgbaDepth );if ( fDepth < shadowCoord.z )shadowColor = shadowColor * vec3( 1.0 - darkness );\n#endif\n"+"}//LOOP_END\n#ifdef SHADOWMAP_DEBUG\n#ifdef SHADOWMAP_CASCADE\nif ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n#else\nif ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n#endif\n#endif\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\n"+MMD_SA.MME_shader_branch("SERIOUS_SHADER",true,true)+"Y  =  0.298912 * gl_FragColor.r + 0.586611 * gl_FragColor.g + 0.114478 * gl_FragColor.b;\n"+"Cb = -0.168736 * gl_FragColor.r - 0.331264 * gl_FragColor.g + 0.5      * gl_FragColor.b;\n"+"Cr =  0.5      * gl_FragColor.r - 0.418688 * gl_FragColor.g - 0.081312 * gl_FragColor.b;\n"+"shadowColor.x = mix(1.0-MMDShadow,1.0, shadowColor.x);\n"+"gl_FragColor.rgb = mix(clamp(YCbCrtoRGB(Y*shadowColor.x, Cb, Cr), vec3(0.),vec3(1.)), gl_FragColor.xyz*shadowColor.x, 0.5);\n"+MMD_SA.MME_shader_branch("SERIOUS_SHADER",false)+"#ifdef MMD\n}\n#endif\n"+"#endif\n"+MMD_SA.MME_shader("serious_shader").fshader+MMD_SA.MME_shader_branch("SERIOUS_SHADER",true,true)+"#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif\n#ifdef MMD_TOONMAP\ngl_FragColor.xyz *= totalToon;\n#endif\n"+MMD_SA.MME_shader_branch("SERIOUS_SHADER",false)+"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif\n#ifdef MMD\n}\n#endif\n"+"#ifdef USE_XRAY_PASS\n"+"float xray_distance = distance(vWorldPosition, xray_center);\n"+"if (xray_distance < xray_radius) {\n"+"  float xray_ratio = (1.0 - xray_distance/xray_radius) * 5.0;\n"+"  gl_FragColor.a *= mix(1.0, xray_opacity, ((xray_ratio>1.0)?1.0:xray_ratio));\n"+"}\n"+"#endif\n"+MMD_SA.MME_shader("HDR").fshader+MMD_SA.MME_shader("self_overlay").fshader+THREE.ShaderChunk["uniTexture_fragment"]+"\n"+"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif\n"+"}"};C=function(e){THREE.ShaderMaterial.call(this);this.color=new THREE.Color(16777215);this.ambient=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.specular=new THREE.Color(1118481);this.shininess=30;this.metal=false;this.perPixel=false;this.wrapAround=false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=null;this.lightMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.specularMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.castShadow=true;this.shadowMapCullFace=THREE.CullFaceFront;this.mmdToonMap=null;this.mmdSphereMap=null;this.mmdSphereMode=0;this.mmdEdgeColor=new THREE.Vector4(0,0,0,1);this.mmdEdgeThick=0;this.mmdShadowDark=0;this.passes=1;this.preRenderPass=null;this.postRenderPass=null;this.uniforms=THREE.UniformsUtils.clone(t.uniforms);this.vertexShader=t.vertexShader;this.fragmentShader=t.fragmentShader;this.setValues(e)};C.prototype=Object.create(THREE.ShaderMaterial.prototype);C.prototype.constructor=C;if(self.MMD_SA){C.prototype._passes=1;Object.defineProperty(C.prototype,"passes",{get:function(){return MMD_SA._mirror_rendering_?1:this._passes},set:function(e){this._passes=e}})}C.prototype._castShadow=true;Object.defineProperty(C.prototype,"castShadow",{get:function(){return this.opacity?this._castShadow:false},set:function(e){this._castShadow=e}});C.prototype.setup=function(){if(this.opacity<=0){this.passes=-1;this.preRenderPass=this.postRenderPass=null}else if(this.mmdEdgeThick>0){this.passes=2;this.preRenderPass=function(e,t){var i,o,n;i=e.context;if(t===0){if(this.side===THREE.DoubleSide){i.disable(i.CULL_FACE)}else{i.enable(i.CULL_FACE);i.cullFace(i.BACK)}o=0;n=false}else{i.enable(i.CULL_FACE);i.cullFace(i.FRONT);o=this.mmdEdgeThick*2/e.getViewportHeight();n=o<=0}i.uniform1f(this.program.uniforms.mmdEdgeThick,o);return n};this.postRenderPass=function(e,t){var i;i=e.context;i.enable(i.CULL_FACE);i.cullFace(i.BACK)}}else{this.passes=1;this.preRenderPass=function(e,t){var i;i=e.context;if(this.side===THREE.DoubleSide){i.disable(i.CULL_FACE)}else{i.enable(i.CULL_FACE);i.cullFace(i.BACK)}};this.postRenderPass=function(e,t){var i;i=e.context;i.enable(i.CULL_FACE);i.cullFace(i.BACK)}}if(this.mmdToonMap){this.defines.MMD_TOONMAP=""}else{delete this.defines.MMD_TOONMAP}if(this.mmdSphereMap){this.defines.MMD_SPHEREMAP=this.mmdSphereMode.toString()}else{delete this.defines.MMD_SPHEREMAP}if(this._xray_pass)this.defines.USE_XRAY_PASS="";this.needsUpdate=true};C.prototype.refreshUniforms=function(e){var r=this;var t=this.mesh;var i=this._original_value;var o=this.opacity;var s;var _;var l,d,f;var h=t._material_morph[this.name];if(h){if(!i){i=this._original_value={};i.opacity=this.opacity;i.mmdEdgeColor=this.mmdEdgeColor.clone();i.diffuse=[this.color.r,this.color.g,this.color.b];i.specular=[this.specular.r,this.specular.g,this.specular.b];i.ambient=[this.ambient.r,this.ambient.g,this.ambient.b]}s=i.opacity;_=i.mmdEdgeColor.w;l=i.diffuse.slice(0);d=i.specular.slice(0);f=i.ambient.slice(0);var n=Object.keys(h).sort(function(e,t){return e-t});n.forEach(function(e){var t=h[e];var i=t.weight;if(!i)return;if(i<0){i=0}if(!MMD_SA._mirror_rendering_){if(t.weight){t.weight=-1;r._render_once=true}else{t.weight=0}}var o=t.morph_obj;var n;if(o.operator==0){n=i*o.alpha+(1-i);s*=n;_*=n}else{n=i*o.alpha;s+=n;_+=n;if(o.diffuse.find(function(e){return!!e})){for(var a=0;a<3;a++)l[a]+=o.diffuse[a]*i}if(o.specular.find(function(e){return!!e})){for(var a=0;a<3;a++)d[a]+=o.specular[a]*i}if(o.ambient.find(function(e){return!!e})){for(var a=0;a<3;a++)f[a]+=o.ambient[a]*i}}if(s>1)s=1;else if(s<0)s=0;if(_>1)_=1;else if(_<0)_=0});this.opacity=s;this.mmdEdgeColor.w=_;this.color.setRGB(l[0],l[1],l[2]);this.specular.setRGB(d[0],d[1],d[2]);this.ambient.setRGB(f[0],f[1],f[2])}else{if(i){s=this.opacity=i.opacity;this.mmdEdgeColor.w=i.mmdEdgeColor.w;this.color.setRGB(i.diffuse[0],i.diffuse[1],i.diffuse[2]);this.specular.setRGB(i.specular[0],i.specular[1],i.specular[2]);this.ambient.setRGB(i.ambient[0],i.ambient[1],i.ambient[2])}else{s=o}}if(o==0){if(s>0){this.setup()}}else{if(s==0){this.setup()}}var a=this.uniforms;a.opacity.value=this.opacity;if(e.gammaInput){a.diffuse.value.copyGammaToLinear(this.color)}else{a.diffuse.value=this.color}a.map.value=this.map;a.lightMap.value=this.lightMap;a.specularMap.value=this.specularMap;if(this.bumpMap){a.bumpMap.value=this.bumpMap;a.bumpScale.value=this.bumpScale}if(this.normalMap){a.normalMap.value=this.normalMap;a.normalScale.value.copy(this.normalScale)}var m;if(this.map){m=this.map}else if(this.specularMap){m=this.specularMap}else if(this.normalMap){m=this.normalMap}else if(this.bumpMap){m=this.bumpMap}if(m!==undefined){var p=m.offset;var u=m.repeat;a.offsetRepeat.value.set(p.x,p.y,u.x,u.y)}a.envMap.value=this.envMap;a.flipEnvMap.value=this.envMap instanceof THREE.WebGLRenderTargetCube?1:-1;if(e.gammaInput){a.reflectivity.value=this.reflectivity}else{a.reflectivity.value=this.reflectivity}a.refractionRatio.value=this.refractionRatio;a.combine.value=this.combine;a.useRefract.value=this.envMap&&this.envMap.mapping instanceof THREE.CubeRefractionMapping;a.shininess.value=this.shininess;if(e.gammaInput){a.ambient.value.copyGammaToLinear(this.ambient);a.emissive.value.copyGammaToLinear(this.emissive);a.specular.value.copyGammaToLinear(this.specular)}else{a.ambient.value=this.ambient;a.emissive.value=this.emissive;a.specular.value=this.specular}if(this.wrapAround){a.wrapRGB.value.copy(this.wrapRGB)}if(this.mmdToonMap){a.mmdToonMap.value=this.mmdToonMap}if(this.mmdSphereMap){a.mmdSphereMap.value=this.mmdSphereMap}if(self.MMD_SA){var c=t._model_index;var M=THREE.MMD.getModels()[c];if(!this._MME_uniforms_updated_||c==0&&(MMD_SA._MME_uniforms_updated_&&MMD_SA._MME_uniforms_updated_>this._MME_uniforms_updated_)){var v=c==0?MMD_SA_options.MME:MMD_SA_options.model_para_obj_all[c].MME;var A;A=v.self_overlay;a.self_overlay_opacity.value=A.opacity||.5;a.self_overlay_brightness.value=A.brightness==null?.5:A.brightness;var g=A.color_adjust||[1.5,1,1];a.self_overlay_color_adjust.value.set(g[0],g[1],g[2]);A=v.HDR;a.HDR_opacity.value=A.opacity||.5;A=v.serious_shader;a.serious_shader_shadow_opacity.value=(A.shadow_opacity||.5)*Math.min(1,(A.material&&A.material[this.name]&&A.material[this.name].shadow_opacity_scale||1)*(MMD_SA_options.use_shadowMap?1+MMD_SA_options.shadow_darkness:1));a.OverBright.value=(A.OverBright||(A.type=="AdultShaderS2"?1.15:1.2))+MMD_SA_options.SeriousShader_OverBright_adjust;a.ShadowDarkness.value=A.ShadowDarkness||(A.type=="SeriousShader"?.6:1);a.ToonPower.value=A.ToonPower||(A.type=="SeriousShader"?1.5:A.type=="AdultShaderS2"?1.1:1);a.EyeLightPower.value=A.EyeLightPower||(A.type=="AdultShaderS2"?.7:2);a.serious_shader_mode.value=A.type=="AdultShaderS"?2:A.type=="AdultShaderS2"?1:0;if(MMD_SA.MME_shader_inline_switch_mode){["self_overlay","HDR","serious_shader"].forEach(function(e){A=v[e];a[e.toUpperCase()].value=A.enabled==null||A.enabled?1:0})}this._MME_uniforms_updated_=Date.now()}else if(c==0&&MMD_SA._MME_uniforms_updated_){DEBUG_show("(MMD shader updated)",2);MMD_SA._MME_uniforms_updated_=0}if(this._xray_pass){var y=MMD_SA_options.mesh_obj_by_id["XrayMESH"];if(y&&y.visible){a.xray_center.value.copy(y._obj.position);var S=(Date.now()-y._start_time)/1e3;a.xray_opacity.value=MMD_SA_options._xray_opacity+(1-MMD_SA_options._xray_opacity)*(1-(S>1?1:S))}else a.xray_center.value.set(999,999,999)}}a.MMDShadow.value=MMD_SA_options.shadow_darkness;a.mmdEdgeColor.value=this.mmdEdgeColor;a.mmdShadowDark.value=this.mmdShadowDark};(function(){var E,w,T,k,P,R,o,C,I;E=new THREE.Vector3;w=new THREE.Vector3;T=new THREE.Vector3;k=new THREE.Vector3;P=new THREE.Quaternion;R=new THREE.Matrix4;o=function(e){var t=e.matrix;if(e.visible){e.visible=false;t.makeRotationFromQuaternion(e.quaternion);t.setPosition(e.position)}return t};C=function(e,t,i){i.copy(t.position);while(t.parent!==e){t=t.parent;i.applyMatrix4(o(t))}};I=function(e,t,i){i.copy(o(t));while(t.parent!==e){t=t.parent;i.multiplyMatrices(o(t),i)}i.getInverse(i)};y=function(e){this.mesh=e};y.prototype.update=function(e){var t,i,o,n,a,r,s,_,l,d,f,h,m,p,u,c;t=this.mesh;o=t.bones;i=t.geometry.MMDIKs;var M,v,A,g;var y=[];var S=0;var x=i.length;var D=1;if(self.MMD_SA){M=THREE.MMD.getModels()[t._model_index];v=MMD_SA_options.model_para_obj_all[t._model_index];A=M.skin&&MMD_SA.motion[M.skin._motion_index];D=v.ik_iteration_factor||(MMD_SA_options.Dungeon&&t._model_index?MMD_SA_options.Dungeon_options.ik_iteration_factor||.5:1);g=A&&A.para_SA;if(e){S=e.ini;x=e.end||S}}for(n=S,a=x;n<=a;n++){r=t._IK_and_AddTrans[n].pmxBone.IK;h=o[r.target];if(A){if(g.IK_disabled&&g.IK_disabled.test(h.name)){continue}if(System._browser.camera.poseNet.IK_disabled_check(h.name)){continue}if(/\u8155\uFF29\uFF2B/.test(h.name)){let e=MMD_SA.vmd_by_filename[A.filename];if(!System._browser.camera.use_armIK&&e&&!e.use_armIK&&!g.use_armIK){continue}}}m=o[r.effector];C(t,h,E);d=r.iteration;d=Math.max(Math.floor(d*D),1);f=r.links.length;for(l=0;l<f;l++){s=r.links[l];p=o[s.bone];if(p.name.indexOf("")!=-1)p.quaternion.slerp(MMD_SA.TEMP_q.set(0,0,0,1),.5);y[l]=s.limits&&v&&v.IK_link_inverted&&v.IK_link_inverted.test(p.name)?-1:1}e:for(_=0;_<d;_++){var b=false;for(l=0;l<f;l++){s=r.links[l];p=o[s.bone];if(p.omitIK){break e}I(t,p,R);C(t,m,T);T.applyProjection(R).normalize();w.copy(E);w.applyProjection(R).normalize();u=w.dot(T);if(u>1){u=1}u=Math.acos(u);if(u<1e-5){continue}if(u>r.control){u=r.control}P.setFromAxisAngle(k.crossVectors(T,w).normalize(),u);p.quaternion.multiplyQuaternions(p.quaternion,P);if(s.limits){c=p.quaternion.w;p.quaternion.set(y[l]*Math.sqrt(1-c*c),0,0,c)}p.visible=true;b=true}if(!b){break}}}o.forEach(function(e){e.visible=true})}})();(function(){var L=self.MMD_SA&&MMD_SA.ammo_proxy;var e,t,i,o,F,r,s,O,z,j,V,B,K,G,N,c;if(window.Ammo){jThree._ammo_async_init_=[];jThree._ammo_async_init_.push(function(){e=new Ammo.btDefaultCollisionConfiguration;t=new Ammo.btCollisionDispatcher(e);i=new Ammo.btSequentialImpulseConstraintSolver;o=new Ammo.btDbvtBroadphase;k=new Ammo.btDiscreteDynamicsWorld(t,o,i,e);F=new Ammo.btTransform;r=new Ammo.btVector3;s=new Ammo.btQuaternion;W=function(e,t,i){r.setValue(e,t,i);return r};X=function(e,t,i,o){s.setValue(e,t,i,o);return s};self.MMD_SA&&L&&L.update_worker("TEST")})}O=new THREE.Vector3;z=new THREE.Vector3;j=new THREE.Vector3;V=new THREE.Quaternion;B=new THREE.Quaternion;K=new THREE.Quaternion;G=new THREE.Matrix4;N=new THREE.Matrix4;c=function(e,t){V.copy(t.q);G.makeRotationFromQuaternion(V);G.getInverse(G);O.set(e.pos[0]-t.pos[0],e.pos[1]-t.pos[1],e.pos[2]-t.pos[2]);return O.applyProjection(G)};S=function(e){this.create(e)};S.prototype.create=function(h){function f(e,t,i){switch(i){case"OR":if(!self.MMD_SA||!L)return e|t;e=e._v_index&&(Ammo_local?"L.":"")+e._v_index||e;t=t._v_index&&(Ammo_local?"L.":"")+t._v_index||t;if(L.use_text_command)return(typeof e==="string"?"v['"+e+"']":e)+"|"+(typeof t==="string"?"v['"+t+"']":t);return{L:e,R:t,op:"OR"}}}var m=h.MMDrigids,e=h.geometry.MMDjoints;this.mesh=h;var p=MMD_SA_options.model_para_obj_all[h._model_index];var u={};e.forEach(function(e){var t=m[e.rigidA],i=m[e.rigidB];if(t.type==0&&i.type>0)u[e.rigidA]=true});m.forEach(function(e,t){var i,o,n,a,r,s,_;e.q=new THREE.Quaternion;e.q.setFromEuler(new THREE.Vector3(e.rot[0],e.rot[1],e.rot[2]),"YXZ");var l=p.rigid_default&&(p.rigid_default[e.name]||p.rigid_default._all_)||{};if(l.type!=null){if(l.type==-1){e.type=0;e.size=[0,0,0]}else e.type=l.type}var d=self.MMD_SA&&p.rigid_filter;if(d&&!d.test(e.name)){e.type=0}if(e.bone>=0){i=h.bones[e.bone];if(e.type>0){i.omitIK=true}}else{if(e.type===2){e.type=1}}switch(e.shape){case 0:o=new Ammo.btSphereShape(e.size[0]);break;case 1:o=new Ammo.btBoxShape(W(e.size[0],e.size[1],e.size[2]));break;case 2:o=new Ammo.btCapsuleShape(e.size[0],e.size[1]);break;default:return}n=e.type===0?0:e.mass;a=new Ammo.btVector3(0,0,0);o.calculateLocalInertia(n,a);F.setIdentity();F.setOrigin(W(e.pos[0]+h.position.x,e.pos[1]+h.position.y,e.pos[2]+h.position.z));F.setRotation(X(e.q.x,e.q.y,e.q.z,e.q.w));r=new Ammo.btDefaultMotionState(F);s=new Ammo.btRigidBodyConstructionInfo(n,r,o,a);s.set_m_friction(e.friction);s.set_m_restitution(e.restitution);_=new Ammo.btRigidBody(s);if(e.type===0){_.setCollisionFlags(f(_.getCollisionFlags(),2,"OR"));if(!u[t])_.setActivationState(4)}_.setDamping(e.posDamping*(l.posDamping_scale||1),e.rotDamping*(l.rotDamping_scale||1));_.setSleepingThresholds(0,0);k.addRigidBody(_,1<<e.group,e.mask);Ammo.destroy(s);Ammo.destroy(a);e.body=_});e.forEach(function(e){var t,i,o,n,a,r,s=m[e.rigidA],_=m[e.rigidB],l=new Ammo.btTransform,d=new Ammo.btTransform;if(s.type!==0&&_.type===2){if(s.bone>0){a=h.bones[s.bone]}if(_.bone>0){r=h.bones[_.bone]}if(a&&r&&r.parent===a){if(0)_._skin_parent=a;else{_.type=1}}}l.setIdentity();t=c(e,s);l.setOrigin(W(t.x,t.y,t.z));i=X(-s.q.x,-s.q.y,-s.q.z,s.q.w);l.setRotation(i);d.setIdentity();t=c(e,_);d.setOrigin(W(t.x,t.y,t.z));i=X(-_.q.x,-_.q.y,-_.q.z,_.q.w);d.setRotation(i);var f=p.joint_default&&p.joint_default[e.name]||{};o=new Ammo.btGeneric6DofSpringConstraint(s.body,_.body,l,d,true);o.setLinearLowerLimit(W(e.posLower[0],e.posLower[1],e.posLower[2]));o.setLinearUpperLimit(W(e.posUpper[0],e.posUpper[1],e.posUpper[2]));o.setAngularLowerLimit(W(e.rotLower[0]*(f.rotLower_scale&&f.rotLower_scale[0]||1),e.rotLower[1]*(f.rotLower_scale&&f.rotLower_scale[1]||1),e.rotLower[2]*(f.rotLower_scale&&f.rotLower_scale[2]||1)));o.setAngularUpperLimit(W(e.rotUpper[0]*(f.rotUpper_scale&&f.rotUpper_scale[0]||1),e.rotUpper[1]*(f.rotUpper_scale&&f.rotUpper_scale[1]||1),e.rotUpper[2]*(f.rotUpper_scale&&f.rotUpper_scale[2]||1)));for(n=0;n<3;n++){if(e.posSpring[n]>0){o.enableSpring(n,true);o.setStiffness(n,e.posSpring[n]*(f.posSpring_scale&&f.posSpring_scale[n]||1))}if(e.rotSpring[n]>0){o.enableSpring(n+3,true);o.setStiffness(n+3,e.rotSpring[n])}}for(n=0;n<6;n++){if(!self.MMD_SA||o.setParam)o.setParam(2,R.STOP_ERP,n)}k.addConstraint(o,true);Ammo.destroy(l);Ammo.destroy(d);e.constraint=o});self.MMD_SA&&L&&L.update_worker()};S.prototype.dispose=function(){this.mesh.geometry.MMDjoints.forEach(function(e){k.removeConstraint(e.constraint);Ammo.destroy(e.constraint);delete e.constraint});this.mesh.MMDrigids.forEach(function(e){k.removeRigidBody(e.body);Ammo.destroy(e.body);delete e.body});self.MMD_SA&&L&&L.update_worker()};S.prototype.preSimulate=function(){var o;o=this.mesh;if(o.matrixWorld_physics)o.matrixWorld_physics.update();var n=o.matrixWorld_physics&&o.matrixWorld_physics.m4||o.matrixWorld;B.setFromRotationMatrix(n);var a=false;if(L){L.cache_by_model.set_enabled(o._model_index,!o._reset_rigid_body_physics_);a=L.use_optimized_command&&!L.use_text_command;a&&L.add_optimized_command({o:2,_btransform_v_index:F._v_index,_bv_v_index:r._v_index,_bq_v_index:s._v_index})}o.MMDrigids.forEach(function(e){var t,i;if((o._reset_rigid_body_physics_>0||e._reset_physics_&&(!L||!L.data_id_locked["stepSimulation"])||e.type===0)&&e.bone>=0){e._reset_physics_=null;t=o.bones[e.bone].skinMatrix;O.set(e.ofs[0],e.ofs[1],e.ofs[2]);O.applyMatrix4(t);O.applyMatrix4(n);V.setFromRotationMatrix(t);V.multiplyQuaternions(V,e.q);V.multiplyQuaternions(B,V);i=e.body;if(!a){F.setOrigin(W(O.x,O.y,O.z));F.setRotation(X(V.x,V.y,V.z,V.w));i.setCenterOfMassTransform(F);i.getMotionState().setWorldTransform(F)}else{L.add_optimized_command({o:3,body_v_index:i._v_index,_v:O,_q:V})}}})};S.prototype.postSimulate=function(){function n(e){for(var t=0,i=e.children.length;t<i;t++){var o=e.children[t];if(o instanceof THREE.Bone){if(o.pmxBone.afterPhysics){o.update(e.skinMatrix,false)}else n(o)}}}var D,e,t;D=this.mesh;var i=D._model_index;var b=self.MMD_SA&&L&&!Ammo_local;var E=D.matrixWorld_physics&&D.matrixWorld_physics.m4||D.matrixWorld;var w,T,k;var P=false;if(b){P=L.use_optimized_command&&!L.use_text_command;w=b&&L.cache_by_model.list[i];T=b&&L.cache_by_model_temp.list[i];k=b&&L.cache_by_model.get_enabled(i);L.cache_by_model_temp.set_matrixWorld(i,E);L.cache_by_model_temp.set_skin(i,D.bones,k)}N.getInverse(E);K.setFromRotationMatrix(N);var R,C;var I={};var o,H,a,r,s;var U;if(self.MMD_SA){o=THREE.MMD.getModels()[i];H=MMD_SA_options.model_para_obj_all[i];a=o.skin&&MMD_SA.motion[o.skin._motion_index].filename||"";r=MMD_SA_options.motion_para[a]||{};s=r.adjustment_per_model&&(r.adjustment_per_model[H._filename]||r.adjustment_per_model[H._filename_cleaned]||r.adjustment_per_model._default_)||r;U=H.skin_filter_by_motion&&(H.skin_filter_by_motion.find(function(e){return e.motion.test(a)})||{}).skin||s.skin_filter||r.skin_filter;R=H.bone_constraint;if(R){if(R.motion_filter&&!R.motion_filter.test(a)){R=null}}if(R){if(R.group_skip){for(var _ in R.group_skip){if(R.group_skip[_].motion_match.test(a))I[_]=true}}}if(D._reset_rigid_body_physics_>0){C=true;D._reset_rigid_body_physics_=Math.max(D._reset_rigid_body_physics_-Math.min(RAF_timestamp_delta/1e3*30,1),0)}}D.MMDrigids.forEach(function(t){var i,o,n,a,r;if(t.type!==0&&t.bone>=0){i=D.bones[t.bone].skinMatrix;if(t._skin_parent){D.bones[t.bone].update(t._skin_parent.skinMatrix,false)}}if(t.bone==-1)return;var s=D.bones[t.bone].name;var e=!C&&U&&!U.test(s)&&(!H.skin_weight||!H.skin_weight[s]);if(b&&C&&D._reset_rigid_body_physics_<=2){e=true}if(C||e){if(b&&e&&(t.type!==0&&t.bone>=0)){if(P&&!L.locked)L._locked=true;o=t.body.getCenterOfMassTransform();a=o.getRotation();a.x();a.y();a.z();a.w();if(P&&!L.locked){L._locked=false;L.add_optimized_command({o:5,body_v_index:t.body._v_index})}if(t.type===1){if(P&&!L.locked)L._locked=true;n=o.getOrigin();n.x();n.y();n.z();if(P&&!L.locked){L._locked=false;L.add_optimized_command({o:6,body_v_index:t.body._v_index})}}else{O.set(t.ofs[0],t.ofs[1],t.ofs[2]);O.applyMatrix4(i);O.applyMatrix4(E);if(!P){r=t.body;r.getMotionState().getWorldTransform(F);F.setOrigin(W(O.x,O.y,O.z));r.setCenterOfMassTransform(F);r.getMotionState().setWorldTransform(F)}else{L.add_optimized_command({o:4,body_v_index:t.body._v_index,_v:O})}}}}else if(t.type!==0&&t.bone>=0){if(t.type===2){j.getPositionFromMatrix(i)}if(P&&!L.locked)L._locked=true;o=t.body.getCenterOfMassTransform();a=o.getRotation();V.set(a.x(),a.y(),a.z(),a.w());if(P&&!L.locked){L._locked=false;L.add_optimized_command({o:5,body_v_index:t.body._v_index})}B.copy(t.q).conjugate();let e;if(b){if(!k){V.multiplyQuaternions(MMD_SA.TEMP_q.setFromRotationMatrix(D.matrixWorld),V.multiplyQuaternions(MMD_SA._q1.setFromRotationMatrix(i),t.q))}else{V.multiplyQuaternions(w.q_matrixWorld_inv,V);e=true}}if(!e)V.multiplyQuaternions(K,V);V.multiplyQuaternions(V,B);var _=R&&R[s];if(_){var l=_.rotation;var d=l._q;if(!d)d=l._q=new THREE.Quaternion;B.setFromRotationMatrix(G.extractRotation(i));d.copy(V).multiply(B.conjugate());O.setEulerFromQuaternion(d.normalize());var f,h;if(I[_.group||"ALL"]){h=true}var m=l.x;var p=l.y;var u=l.z;var c=45;if(!h&&m){var M=m[0][0]- -O.x;var v=-O.x-m[1][0];if(M>0){f=true;if(M>c||m[0][1]==true)h=true;else O.x=m[0].length==1?m[0][0]:m[0][1]}else if(v>0){f=true;if(v>c||m[1][1]==true)h=true;else O.x=m[1].length==1?m[1][0]:m[1][1]}O.x=-O.x}if(!h&&p){var A=p[0][0]-O.y;var g=O.y-p[1][0];if(A>0){f=true;if(A>c||p[0][1]==true)h=true;else O.y=p[0].length==1?p[0][0]:p[0][1]}else if(g>0){f=true;if(g>c||p[1][1]==true)h=true;else O.y=p[1].length==1?p[1][0]:p[1][1]}}if(!h&&u){var y=u[0][0]- -O.z;var S=-O.z-u[1][0];if(y>0){f=true;if(y>c||u[0][1]==true)h=true;else O.z=u[0].length==1?u[0][0]:u[0][1]}else if(S>0){f=true;if(S>c||u[1][1]==true)h=true;else O.z=u[1].length==1?u[1][0]:u[1][1]}O.z=-O.z}if(h){t._reset_physics_=true;return}if(f){B.conjugate();B.multiply(d.setFromEuler(O));V.copy(B);d.copy(B);B.setFromRotationMatrix(E);O.set(t.ofs[0],t.ofs[1],t.ofs[2]);O.applyMatrix4(i);O.applyMatrix4(E);V.setFromRotationMatrix(i);V.multiplyQuaternions(V,t.q);V.multiplyQuaternions(B,V);r=t.body;if(!P){F.setOrigin(W(O.x,O.y,O.z));F.setRotation(X(V.x,V.y,V.z,V.w));r.setCenterOfMassTransform(F);r.getMotionState().setWorldTransform(F)}else{L.add_optimized_command({o:3,body_v_index:r._v_index,_v:O,_q:V})}V.copy(d)}}var x=MMD_SA.TEMP_v3.getPositionFromMatrix(i);i.makeRotationFromQuaternion(V);if(t.type===1){if(P&&!L.locked)L._locked=true;n=o.getOrigin();O.set(n.x(),n.y(),n.z());if(P&&!L.locked){L._locked=false;L.add_optimized_command({o:6,body_v_index:t.body._v_index})}let e;if(b){if(!k){O.copy(MMD_SA._v3a.set(t.ofs[0],t.ofs[1],t.ofs[2]).applyMatrix4(i)).add(x).applyMatrix4(E)}else{O.applyProjection(w.matrixWorld_inv);e=true}}if(!e)O.applyProjection(N);z.set(t.ofs[0],t.ofs[1],t.ofs[2]).negate();z.applyMatrix4(i);O.add(z);i.setPosition(O);k&&i.setPosition(O.sub(MMD_SA._v3a_.getPositionFromMatrix(w.skin[t.bone])).add(MMD_SA._v3b_.getPositionFromMatrix(T._skin[t.bone])))}else{i.setPosition(j);O.set(t.ofs[0],t.ofs[1],t.ofs[2]);O.applyMatrix4(i);O.applyMatrix4(E);r=t.body;if(!P){r.getMotionState().getWorldTransform(F);F.setOrigin(W(O.x,O.y,O.z));r.setCenterOfMassTransform(F);r.getMotionState().setWorldTransform(F)}else{L.add_optimized_command({o:4,body_v_index:r._v_index,_v:O})}}}b&&L.register([a,n])});if(self.MMD_SA&&MMD_SA.use_afterPhysics){for(var l in D._bone_update_afterPhysics){var d=D.bones[l];if(d.parent instanceof THREE.Bone){G.multiplyMatrices(MMD_SA.TEMP_m4.getInverse(d.parent.skinMatrix),d.skinMatrix)}else{G.copy(d.skinMatrix)}d.position.getPositionFromMatrix(G);d.quaternion.setFromRotationMatrix(G)}o._update_IK_and_AddTrans(true);for(var f=0,h=D.children.length;f<h;f++){child=D.children[f];if(child instanceof THREE.Bone){if(child.pmxBone.afterPhysics){child.update(D.identityMatrix,false)}else n(child)}}}for(e=0,t=D.bones.length;e<t;e++){G.multiplyMatrices(D.bones[e].skinMatrix,D.boneInverses[e]);G.flattenToArrayOffset(D.boneMatrices,e*16)}if(D.useVertexTexture){D.boneTexture.needsUpdate=true}};S.prototype.reset=function(){var e;e=this.mesh;e.updateMatrixWorld(true);if(e.matrixWorld_physics)e.matrixWorld_physics.update();var i=e.matrixWorld_physics&&e.matrixWorld_physics.m4||e.matrixWorld;B.setFromRotationMatrix(i);e.MMDrigids.forEach(function(e){var t;O.set(e.pos[0],e.pos[1],e.pos[2]).applyMatrix4(i);V.multiplyQuaternions(B,e.q);t=e.body;t.getMotionState().getWorldTransform(F);F.setOrigin(W(O.x,O.y,O.z));F.setRotation(X(V.x,V.y,V.z,V.w));t.setWorldTransform(F)});self.MMD_SA&&L&&L.update_worker()}})();o=function(){var r,s,_,l,d,f,h,m=function(e){return((r*e+s)*e+_)*e},p=function(e){return((l*e+d)*e+f)*e},u=function(e){return(3*r*e+2*s)*e+_},c=function(e){var t,i,o,n,a,r;o=e;for(r=0;r<8;r++){n=m(o)-e;if(Math.abs(n)<h){return o}a=u(o);if(Math.abs(a)<1e-6){break}o-=n/a}t=0;i=1;o=e;if(o<t){return t}if(o>i){return i}while(t<i){n=m(o);if(Math.abs(n-e)<h){return o}if(e>n){t=o}else{i=o}o=(i-t)*.5+t}return o},e=function(e,t,i,o,n,a){h=a;_=3*t;s=3*(o-t)-_;r=1-_-s;f=3*i;d=3*(n-i)-f;l=1-f-d;return p(c(e))};return e}();A=function(e,t){if(!(e instanceof Array)){e=[e]}this.targets=e;this.duration=t;this.duration_default=t;this.loop=false;this.playing=false;this.minKeyDelta=0;this.reset()};A.prototype.reset=function(){this.time=0;this.targets.forEach(function(e){e.k=0})};A.prototype.seek=function(e,t){var i;i=e-this.time;if(i>=0){this.update(i,t)}else{this.reset();this.update(e,t)}};A.prototype.play=function(e){if(e!==undefined){this.loop=e}this.playing=true};A.prototype.pause=function(){this.playing=false};A.prototype.update=function(e,t){var a,r,s;if(!this.playing){return}a=this;r=this.time+e;this.time=r%this.duration;s=false;if(this.time<0)return;var _;var l={};var d=THREE.MMD.getModels()[this._model_index].pmx.morphs;var f=this._motion_index_MMD_SA_extra!=null?this._motion_index_MMD_SA_extra:this._motion_index-MMD_SA.custom_action_index;this.targets.forEach(function(e,t){var i,o,n;if(e.keys.length<2){if(e.keys.length==1&&a._is_MMD_SA_animation){i=e.keys[0];n=0;a.onupdate(i,i,n,t)}return}i=e.keys[e.k];o=e.keys[e.k+1];if(l[o.name]){return}if(o.morph_type==0){d[o.morph_index].items.forEach(function(e){l[d[e.target].name]=true})}if(o.time<=r){if(a.time<r){s=true;if(a.freeze_onended){s=false;if(a._is_MMD_SA_custom_animation&&a._is_skin&&!_){_=true;MMD_SA_options.custom_action[f].onFinish(a._model_index)}a.time=a.duration-1/59/1e3;n=1;if(!a._MMD_SA_animation_check||a._MMD_SA_animation_check(t)){a.onupdate(i,o,n,t);return}}else if(a.loop){jThree.MMD._onLoop=true;e.k=0;i=e.keys[e.k];o=e.keys[e.k+1];while(o.time<a.time){e.k++;i=e.keys[e.k];o=e.keys[e.k+1]}}else{a.time=o.time}}else{do{e.k++;i=e.keys[e.k];o=e.keys[e.k+1]}while(o.time<a.time)}}if(o.time-i.time<=a.minKeyDelta){n=0}else{if(a.time<i.time){n=0}else n=(a.time-i.time)/(o.time-i.time)}if(!a._MMD_SA_animation_check||a._MMD_SA_animation_check(t))a.onupdate(i,o,n,t)});if(a.freeze_onended&&(a._is_MMD_SA_custom_animation&&a._is_skin&&!_)&&r>a.duration){MMD_SA_options.custom_action[f].onFinish(a._model_index)}if(s){if(!this.loop){this.pause()}if(this.onended){this.onended(this)}}};A.prototype.adjustDuration=function(o){if(this.duration_default>o){o=this.duration_default;return}this.duration=o;this.targets.forEach(function(e){var t,i;t=e.keys;if(t.length<2){return}i=t[t.length-1];if(i.time<o){i=g(i);i.time=o;t.push(i)}})};x=function(e,t){var n,a;this.mesh=e;A.call(this,t.targets,t.duration);a=t.targets;n=e.geometry;var i=this;var r=[];var s=0;var _=[];var l=[];var d=0;var f=n.morphTargets?n.morphTargets.length:0;if(!n._morphTargets_index){n._morphTargets_index={}}n.MMDmorphs.forEach(function(e){if(e.type!=1){return}var t,i,o;o=d;if(o<a.length&&e.name===a[o].keys[0].name){d++;if(n._morphTargets_index[e.name]!=null){s++;_[n._morphTargets_index[e.name]]=a[o];return}n._morphTargets_index[e.name]=f++;l.push(a[o])}else{return}i=[];n.vertices.forEach(function(e){i.push(e.clone())});e.items.forEach(function(e){var t=i[e.target];t.x+=e.offset[0];t.y+=e.offset[1];t.z+=e.offset[2]});t={};t.name=e.name;t.vertices=i;r.push(t)});if(s){while(d<a.length){if(a[d].keys[0].morph_type!=1){l.push(a[d])}d++}n.morphTargets.forEach(function(e,t){if(!_[t])_[t]={keys:[{name:e.name,weight:0,morph_type:1}]}});this.targets=_.concat(l)}if(r.length){n.morphTargets=n.morphTargets?n.morphTargets.concat(r):r}if(n.morphTargets.length>0){n.morphTargetsNeedUpdate=true;e.updateMorphTargets();e.material.materials.forEach(function(e){e.morphTargets=true;e.needsUpdate=true})}};x.prototype=Object.create(A.prototype);x.prototype.constructor=x;x.prototype.onupdate=function(e,t,i,o){var n=this;var r=e.weight+(t.weight-e.weight)*i;var a=this.mesh;var s=a.geometry;var _=s.morphs_weight_by_name[e.name];s.morphs_weight_by_name[e.name]=r;if(e.morph_type==0){var l=e.morph_index;var d=s.MMDmorphs[l];d.items.forEach(function(e){var t=s.MMDmorphs[e.target];var i={name:t.name,weight:r*e.weight,morph_type:t.type,morph_index:e.target};n.onupdate(i,i,0,s._morphTargets_index[t.name]||0)})}else if(e.morph_type==2){var l=e.morph_index;var d=s.MMDmorphs[l];d.items.forEach(function(e){var t=a.bones[e.target].name;var i=a._bone_morph;i=i[t]=i[t]||{};i=i[l]=i[l]||{weight:0,pos_v3:new THREE.Vector3,rot_q:new THREE.Quaternion};if(i.weight>=Math.abs(r))return;i.weight=Math.abs(r);if(e.pos_v3){i.pos_v3.copy(e.pos_v3).multiplyScalar(r)}else i.pos_v3.set(0,0,0);if(e.rot_q){i.rot_q.set(0,0,0,1).slerp(e.rot_q,r)}else i.rot_q.set(0,0,0,1)})}else if(e.morph_type==8){var l=e.morph_index;var d=s.MMDmorphs[l];d.items.forEach(function(e){if(e.target==-1)return;var t=a.material.materials[e.target];t._render_once=true;var i=t.name;var o=a._material_morph[i];if(!o)o=a._material_morph[i]={};o[l]={weight:r,morph_obj:e}})}else if(e.morph_type>=3&&e.morph_type<=7){if(_==r)return;var l=e.morph_index;var d=s.MMDmorphs[l];if(!s._faceVertexUvs)s._faceVertexUvs=[[]];d.items.forEach(function(a,e){var t=a.target;var i=s._face_index_by_vertex[t];if(!i)return;i.forEach(function(e){var t=e[0];var i=s.faceVertexUvs[0][t];var o=s._faceVertexUvs[0][t];if(!o)o=s._faceVertexUvs[0][t]=[i[0].clone(),i[1].clone(),i[2].clone()];var n=e[1];i[n].x=o[n].x+a.uv[0]*r;i[n].y=o[n].y+a.uv[1]*r})});s.uvsNeedUpdate=true}else if(r>a.morphTargetInfluences[o]||e.override_weight)this.mesh.morphTargetInfluences[o]=r};(function(){var f,h,m;f=function(e,t,i,o){var n,a,r,s,_;n=e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3];if(n<0){i[0]=-t[0];i[1]=-t[1];i[2]=-t[2];i[3]=-t[3];n=-n}else{i[0]=t[0];i[1]=t[1];i[2]=t[2];i[3]=t[3]}if(Math.abs(n)>=1){i[0]=e[0];i[1]=e[1];i[2]=e[2];i[3]=e[3];return}a=Math.acos(n);r=Math.sqrt(1-n*n);if(Math.abs(r)<.001){i[0]=.5*(e[0]+i[0]);i[1]=.5*(e[1]+i[1]);i[2]=.5*(e[2]+i[2]);i[3]=.5*(e[3]+i[3]);return}s=Math.sin((1-o)*a)/r;_=Math.sin(o*a)/r;i[0]=e[0]*s+i[0]*_;i[1]=e[1]*s+i[1]*_;i[2]=e[2]*s+i[2]*_;i[3]=e[3]*s+i[3]*_};h=function(e,t,i){return o(e,t[i]/127,t[i+4]/127,t[i+8]/127,t[i+12]/127,1/128)};m=[0,0,0,1];D=function(e,t){this.mesh=e;A.call(this,t.targets,t.duration);this._timeMax=t._timeMax};D.prototype=Object.create(A.prototype);D.prototype.constructor=D;D.prototype.onupdate=function(){var _=new THREE.Vector3;var l=new THREE.Quaternion;var d={x:1,y:1,z:1};return function(e,t,i,o){var a=this.mesh.bones[o],r=this.mesh.geometry.bones[o],n;let s;if(self.MMD_SA){let e=MMD_SA_options.model_para_obj_all[this.mesh._model_index];let t;if(this._motion_index!=null&&MMD_SA.motion[this._motion_index]){t=MMD_SA.motion[this._motion_index].filename}else{let e=THREE.MMD.getModels()[this.mesh._model_index].skin;if(e){t=MMD_SA.motion[e._motion_index].filename}}s=MMD_SA_options.motion_para[t];let i=s&&s.adjustment_per_model&&(s.adjustment_per_model[e._filename]||s.adjustment_per_model[e._filename_cleaned]||s.adjustment_per_model._default_);i=i&&i.skin_default||{};let o=i[r.name]||e.skin_default[r.name];if(o&&o.gpos_add){let i=[];r.pos.forEach(function(e,t){i[t]=e+o.gpos_add[t]});r={name:r.name,pos:i}}}n=t.interp;_.x=r.pos[0]+e.pos[0]+(t.pos[0]-e.pos[0])*h(i,n,0);_.y=r.pos[1]+e.pos[1]+(t.pos[1]-e.pos[1])*h(i,n,1);_.z=r.pos[2]+e.pos[2]+(t.pos[2]-e.pos[2])*h(i,n,2);f(e.rot,t.rot,m,h(i,n,3));l.x=m[0];l.y=m[1];l.z=m[2];l.w=m[3];if(this._blending_ratio_==null){a.position.copy(_);a.quaternion.copy(l)}else{let o=this._blending_ratio_;let n=false;if(s&&s.bone_to_position){let t=r.name.indexOf("")!=-1?"":r.name;let i=s.bone_to_position.find(e=>e.name==t);if(i){let e=i.scale||d;a.position.x+=(_.x-a.position.x)*o*(1-e.x);a.position.y+=(_.y-a.position.y)*o*(1-e.y);a.position.z+=(_.z-a.position.z)*o*(1-e.z);n=true}}if(!n)a.position.lerp(_,o);a.quaternion.slerp(l,this._blending_ratio_)}}}();MMD_SA._skin_onupdate=D.prototype.onupdate})();(function(){var d,f,h,m,p,u;d=new THREE.Vector3;f=new THREE.Quaternion;h=new THREE.Vector3;m=new THREE.Vector3;p=new THREE.Quaternion;u=new THREE.Quaternion;b=function(e,n){var a;this.mesh=n;a=[];n.bones.forEach(function(e,t){var i,o;i=e.pmxBone.additionalTransform;if(i&&i[0]>=0&&i[1]!==0){o=n.bones[i[0]];o.basePosition=o.position.clone();o.baseQuaternion=o.quaternion.clone();o.baseSkinMatrix=o.skinMatrix.clone();a.push(e)}});a.sort(function(e,t){return e.pmxBone.deformHierachy-t.pmxBone.deformHierachy});this.hasGlobal=a.some(function(e){return(e.pmxBone.flags&128)!==0});this.hasGlobal=false;this.bones=a};b.prototype.update=function(e){var t;t=this.mesh;if(this.hasGlobal){t.updateMatrixWorld()}var i=0;var o=this.bones.length-1;if(e){i=e.ini;o=e.end||i}for(var n=i,a=o;n<=a;n++){var r=t._IK_and_AddTrans[n];var s,_,l;s=r.pmxBone.additionalTransform;_=t.bones[s[0]];if(false&&(r.pmxBone.flags&128)!==0){h.getPositionFromMatrix(_.skinMatrix);m.getPositionFromMatrix(_.baseSkinMatrix);d.subVectors(h,m);p.setFromRotationMatrix(_.skinMatrix);u.setFromRotationMatrix(_.baseSkinMatrix);f.multiplyQuaternions(u.conjugate(),p)}else{d.subVectors(_.position,_.basePosition);f.copy(_.quaternion)}l=s[1];if((r.pmxBone.flags&256)!==0){p.set(0,0,0,1);if(l>=0){p.slerp(f,l)}else{p.slerp(f.conjugate(),-l)}r.quaternion.multiplyQuaternions(r.quaternion,p)}if((r.pmxBone.flags&512)!==0){r.position.addVectors(r.position,d.multiplyScalar(l))}}}})();(function(){var f,h;f=function(e,t,i){i*=4;return o(e,t[i]/127,t[i+2]/127,t[i+1]/127,t[i+3]/127,1/128)};h=new THREE.Vector3;E=function(e,t){if(!(e instanceof THREE.PerspectiveCamera)){console.error("not PerspectiveCamera");return}this.persepectiveCamera=e;A.call(this,t,t.duration);this.minKeyDelta=R.minKeyDelta;this.offset=new THREE.Vector3;this.target=new THREE.Vector3};E.prototype=Object.create(A.prototype);E.prototype.constructor=E;E.prototype.play=function(e){A.prototype.play.call(this,e);this.persepectiveCamera.rotationAutoUpdate=false;this.persepectiveCamera.matrixAutoUpdate=false};E.prototype.pause=function(){A.prototype.pause.call(this);this.persepectiveCamera.rotationAutoUpdate=true;this.persepectiveCamera.matrixAutoUpdate=true};E.prototype.onupdate=function(e,t,i){var o=this.persepectiveCamera,n=t.interp,a,r,s,_,l,d;r=o.position;r.x=e.target[0]+(t.target[0]-e.target[0])*f(i,n,0);r.y=e.target[1]+(t.target[1]-e.target[1])*f(i,n,1);r.z=e.target[2]+(t.target[2]-e.target[2])*f(i,n,2);r.addVectors(r,this.offset);this.target.copy(r);a=f(i,n,3);s=o.rotation;s.x=e.rot[0]+(t.rot[0]-e.rot[0])*a;s.y=e.rot[1]+(t.rot[1]-e.rot[1])*a;s.z=e.rot[2]+(t.rot[2]-e.rot[2])*a;_=e.distance+(t.distance-e.distance)*f(i,n,4);l=o.fov;o.fov=e.fov+(t.fov-e.fov)*f(i,n,5);if(o.fov!==l){o.updateProjectionMatrix()}d=o.matrix;d.makeRotationFromEuler(s);r.add(h.getColumnFromMatrix(2,d).multiplyScalar(_));d.setPosition(r);o.up.copy(h.getColumnFromMatrix(1,d));o.matrixWorldNeedsUpdate=true}})();w=function(e,t){if(!(e instanceof THREE.DirectionalLight)){console.error("not DirectionalLight");return}this.directionalLight=e;A.call(this,t,t.duration);this.minKeyDelta=R.minKeyDelta};w.prototype=Object.create(A.prototype);w.prototype.constructor=w;w.prototype.onupdate=function(e,t,i){var o=this.directionalLight,n=o.color,a=o.position,r=o.target.position;n.r=e.color[0]+(t.color[0]-e.color[0])*i;n.g=e.color[1]+(t.color[1]-e.color[1])*i;n.b=e.color[2]+(t.color[2]-e.color[2])*i;a.x=0;a.y=0;a.z=0;r.x=e.dir[0]+(t.dir[0]-e.dir[0])*i;r.y=e.dir[1]+(t.dir[1]-e.dir[1])*i;r.z=e.dir[2]+(t.dir[2]-e.dir[2])*i};var I=function(e){var t,i,o;this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e){if(this.parent){this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}else{this.matrixWorld.copy(this.matrix)}this.matrixWorldNeedsUpdate=false;e=true}if(this._mesh_parent&&this._mesh_parent._RAF_timestamp_){if(this._mesh_parent._RAF_timestamp_==RAF_timestamp)return;this._mesh_parent._RAF_timestamp_=RAF_timestamp}for(t=0,i=this.children.length;t<i;t++){o=this.children[t];if(o instanceof THREE.Bone){if((this.matrixAutoUpdate||e)&&(!o.pmxBone||!o.pmxBone.afterPhysics))o.update(this.identityMatrix,false)}else{o.updateMatrixWorld(true)}}};(function(){function d(e){return e.bones.some(function(e){return!!e.additionalTransform})}T=function(e,t){this.init(e,t)};T.prototype.init=function(e,t){this.pmx=e;this.vmd=t;this.ik=null;this.physi=null;this.skin=null;this.morph=null;this.addTrans=null;this.mesh=null;this.simulateCallback=null;this.boundingCenterOffset=null;this._onmotionended=null;this._MMD_SA_cache=[]};T.prototype.load=function(e,i,o){var n;n=this;(new M).load(e,function(t){if(i){(new v).load(i,function(e){a(t,e)})}else{a(t)}});function a(e,t){T.call(n,e,t);o(n)}};T.prototype._update_IK_and_AddTrans=function(e,t){var i=this;var o=_IK_and_AddTrans=this.mesh._IK_and_AddTrans;var n;var a,r,s;if(t){let e=this.mesh.bones_by_name[t];o=e._IK_and_AddTrans;if(!o){let t=[e._index];o=_IK_and_AddTrans.filter(e=>{if(e.pmxBone.additionalTransform&&(!e.pmxBone.IK||e._additionalTransform_only)){if(t.indexOf(e.pmxBone.additionalTransform[0])!=-1){t.push(e._index);return true}}return false})}this.mesh._IK_and_AddTrans=o;a=0;s=o.length-1}else{if(e){a=this.mesh._IK_and_AddTrans_afterPhysics_index;s=o.length-1}else{a=0;s=(this.mesh._IK_and_AddTrans_afterPhysics_index||o.length)-1}}r=-1;for(var _=a;_<=s;_++){var l=o[_];if(n){if(l.pmxBone.IK&&!l._additionalTransform_only){r=_}else{i.ik.update({ini:a,end:r});n=false;a=r=_}}else{if(l.pmxBone.additionalTransform&&(!l.pmxBone.IK||l._additionalTransform_only)){r=_}else{if(r!=-1){i.addTrans.update({ini:a,end:r})}n=true;a=r=_}}if(_==s){if(n){i.ik.update({ini:a,end:r})}else{i.addTrans.update({ini:a,end:r})}}}this.mesh._IK_and_AddTrans=_IK_and_AddTrans};T.prototype.create=function(s,_){var l;l=this;var c,M,v,A;if(self.MMD_SA){c=document.createElement("canvas");M=c.getContext("2d");v=document.createElement("canvas");A=v.getContext("2d")}if(this.pmx){this.pmx.createMesh(s,function(p){function i(e){var t=e;var i=-1;while(t!==p){var o=l.pmx.rigid_index_by_bone[t._index];if(o!=null&&p.MMDrigids[o].type>0){i=t._index;break}t=t.parent}return i}p._bone_morph={};p.MMDrigids=l.pmx.rigids;var e;if(self.MMD_SA){p._model_index=p._model_index_default=l.pmx._model_index;p._material_morph={};e=self.MMD_SA&&MMD_SA_options.model_para_obj_all[p._model_index];p.bones_by_name={};p._IK_and_AddTrans=[];var a={};var r={};p.geometry.bones.forEach(function(e,t){var i=p.bones[t];p.bones_by_name[e.name]=i;i._index=t;var o=i.pmxBone=l.pmx.bones[t];if(o.IK){p._IK_and_AddTrans.push(i);var n=o.IK;a[n.effector]=true;n.links.forEach(function(e){a[e.bone]=true})}});if(p.bones_by_name[""].pmxBone.origin[1]==0&&p.bones_by_name[""]){let e=p.bones_by_name[""].pmxBone.origin[1];p.bones_by_name[""].pmxBone.origin[1]=e;let i=e-p.bones_by_name[""].parent.pmxBone.origin[1];let o=p.bones_by_name[""]._index;p.geometry.bones[o].pos[1]=i;p.geometry.bones.forEach(function(e,t){if(e.parent==o)e.pos[1]-=i})}p.geometry.bones.forEach(function(e,t){var i=p.bones[t];var o=i.pmxBone;var n=o.additionalTransform;if(n&&n[0]>=0&&n[1]!==0){if(o.IK){let e=Object.assign({},i);e._additionalTransform_only=true;p._IK_and_AddTrans.push(e)}else p._IK_and_AddTrans.push(i);if(n&&a[n[0]]){a[i._index]=r[i._index]=true}}});p._bone_update_afterPhysics={};p._IK_and_AddTrans.forEach(function(e){if(!e.pmxBone.afterPhysics)return;var t;if(e.pmxBone.IK){t=i(e);if(t!=-1)p._bone_update_afterPhysics[t]=true}else{t=i(e);if(t!=-1)p._bone_update_afterPhysics[t]=true;t=i(p.bones[e.pmxBone.additionalTransform[0]]);if(t!=-1)p._bone_update_afterPhysics[t]=true}});p._IK_and_AddTrans.sort(function(e,t){var i=e.pmxBone;var o=t.pmxBone;return(i.afterPhysics&&32768||0)+(i.additionalTransform&&(!i.IK||e._additionalTransform_only)&&8192||0)+i.deformHierachy*1024+(i._index_IKAT||e._index)-((o.afterPhysics&&32768||0)+(o.additionalTransform&&(!o.IK||t._additionalTransform_only)&&8192||0)+o.deformHierachy*1024+(o._index_IKAT||t._index))});if(MMD_SA.use_afterPhysics){p._IK_and_AddTrans.some(function(e,t){if(e.pmxBone.afterPhysics){p._IK_and_AddTrans_afterPhysics_index=t;console.log(p._model_index,"._IK_and_AddTrans_afterPhysics_index",t);return true}})}}var t,o;var u=0;if(self.MMD_SA){t=self.MMD_SA&&l.pmx._clone_index==-1;o=e.material_para=e.material_para||{}}p.material.materials.forEach(function(_,e){function l(e){return e>=0?e%1:e%1+1}_.mesh=p;if(self.MMD_SA){let n,a,r;let s=o[_.name]||o._default_&&Object.assign({},o._default_)||{};if(s.depthWrite!=null){_.depthWrite=s.depthWrite}let e=t&&s.transparent==null;if(e){if(_.opacity<1){s.transparent=true}else if(!_.map){s.transparent=false}else if(_.map instanceof THREE.CompressedTexture){s.transparent=true}else if(_.map.image.src&&/\.jpg$/i.test(_.map.image.src)&&!/\.jpga\.jpg$/i.test(_.map.image.src)){s.transparent=false}else{n=_.map.image;a=c.width=v.width=Math.ceil(n.width*.5);r=c.height=v.height=Math.ceil(n.height*.5);M.drawImage(n,0,0,a,r);let t=p.geometry.faceVertexUvs[0];A=v.getContext("2d");A.fillStyle="white";for(var d=_._uv_bbox.face_ini,f=_._uv_bbox.face_end;d<f;d++){let e=t[d];A.beginPath();A.moveTo(l(e[0].x)*a,l(e[0].y)*r);A.lineTo(l(e[1].x)*a,l(e[1].y)*r);A.lineTo(l(e[2].x)*a,l(e[2].y)*r);A.closePath();A.fill()}let e=M.getImageData(0,0,a,r).data;let i=A.getImageData(0,0,a,r).data;let o=false;for(var h=0,m=e.length;h<m;h+=4){if(e[h+3]<192){o=true;break}}s.transparent=o;e=i=undefined}if(s.transparent!=null)_.transparent=s.transparent}_._material_para=o[_.name]||o._default_||null;if(!_.transparent)u++}});console.log("model-"+p._model_index+":auto_detect_material_para-"+!!t+",opaque/total material count-"+u+"/"+p.material.materials.length);if(self.MMD_SA){c.width=c.height=v.width=v.height=0;c=M=v=A=undefined}var n;l.mesh=p;p.identityMatrix=null;p.useQuaternion=true;if(s.position){p.position.copy(s.position)}if(s.rotation){p.rotation.copy(s.rotation);p.useQuaternion=false}if(s.quaternion){p.quaternion.copy(s.quaternion);p.useQuaternion=true}l.boundingCenterOffset=p.geometry.boundingSphere.center.clone().sub(p.bones[0].position);if(p.geometry.MMDIKs.length){l.ik=new y(p)}else{l.ik=null}if(window.Ammo){l.physi=new S(p)}else{l.physi=null}if(l.vmd){n=l.vmd.generateSkinAnimation(l.pmx);if(n){l.skin=new D(p,n);l.skin.onended=function(e){if(e.loop){if(l.physi){l.physi.reset()}}l._onmotionended=l.onmotionended};if(l.physi){p.updateMatrixWorld=I}}else{l.skin=null}n=l.vmd.generateMorphAnimation(l.pmx);if(n){l.morph=new x(p,n)}else{l.morph=null}if(self.MMD_SA)l._MMD_SA_cache[toLocalPath(l.vmd.url)]={skin:l.skin,morph:l.morph}}else if(self.MMD_SA){p.updateMatrixWorld=I}if(d(l.pmx)){l.addTrans=new b(l.pmx,p)}else{l.addTrans=null}_(l);if(self.MMD_SA){if(e.hidden_before_start||e.hidden_on_start||MMD_SA_options.hidden_before_start||MMD_SA_options.hidden_on_start)p.scale.set(0,0,0)}})}};T.prototype.resetBones=function(){var e,o;e=this.mesh;if(e){o=e.bones;e.geometry.bones.forEach(function(e,t){var i;i=o[t];i.position.set(e.pos[0],e.pos[1],e.pos[2]);i.quaternion.set(e.rotq[0],e.rotq[1],e.rotq[2],e.rotq[3])})}};T.prototype.setupMotion_MMD_SA=function(e,t,i){if(!t)t={skin_jThree:true,morph_jThree:true};var o=t.skin_jThree?e.generateSkinAnimation(this.pmx,t.skin_jThree===true?null:t.skin_jThree):null;var n=t.morph_jThree?(e._morph_component||e).generateMorphAnimation(this.pmx,t.morph_jThree===true?null:t.morph_jThree):null;var a=o?new D(this.mesh,o):i?MMD_SA.Animation_dummy:null;var r=n?new x(this.mesh,n):i?MMD_SA.Animation_dummy:null;if(a){a._model_index=this._model_index;a._motion_index=e._index}if(r){r._model_index=this._model_index;r._motion_index=e._index}var s={skin:a,morph:r};if(r&&!i){r.target_index_by_name={};r.targets.forEach(function(e,t){r.target_index_by_name[e.keys[0].name]=t});if(""in r.target_index_by_name)s._blink_target_index=r.target_index_by_name[""]}return s};T.prototype._VMD=function(e,t){(new v).load(e,t)};T.prototype.resetMotion=function(e){this.resetBones();if(this.morph){this.morph.reset();if(this.morph_MMD_SA_extra){this.morph_MMD_SA_extra.forEach(function(e){if(!e.time||e._MMD_SA_disabled){e.reset()}})}}if(this.skin){this.skin.reset();if(this.skin_MMD_SA_extra){this.skin_MMD_SA_extra.forEach(function(e){if(!e.time||e._MMD_SA_disabled){e.reset()}})}}if(this.physi){if(e)return;if(self.MMD_SA){let t=(this._model_index>0?MMD_SA.motion[this.skin._motion_index]:MMD_SA.MMD.motionManager).para_SA;this.resetPhysics();if(this._model_index==0){let e=t.gravity||[0,-1,0];if(e[0]!=MMD_SA.gravity[0]||e[1]!=MMD_SA.gravity[1]||e[2]!=MMD_SA.gravity[2]){THREE.MMD.setGravity(e[0]*9.8*10,e[1]*9.8*10,e[2]*9.8*10);MMD_SA.gravity=e}}}this.physi.reset()}};T.prototype.resetPhysics=function(t){if(!self.MMD_SA)return;if(t===0){this.mesh._reset_rigid_body_physics_=0;return}if(t==null){let e=(this._model_index>0?MMD_SA.motion[this.skin._motion_index]:MMD_SA.MMD.motionManager).para_SA;t=e.reset_rigid_body_physics_step||MMD_SA_options.reset_rigid_body_physics_step}this.mesh._reset_rigid_body_physics_=Math.max(this.mesh._reset_rigid_body_physics_||0,t)};if(self.MMD_SA){Object.defineProperty(T.prototype,"visible",{get:function(){if(this._visible_RAF_timestamp==RAF_timestamp)return this._visible;var e;if(this.mesh.visible)e=true;else if(this._clone_cache){e=this._clone_cache.list.some(function(e){return e.visible})}else e=false;this._visible_RAF_timestamp=RAF_timestamp;this._visible=e;return e}})}else{T.prototype.visible=true}T.prototype.updateMotion=function(r,e){if(!this.visible)return;this.resetBones();var d=this.mesh;var s=this;var _;var t,l;var f,h;if(self.MMD_SA){_=self.MMD_SA&&MMD_SA.meter_motion_disabled;t=MMD_SA_options.model_para_obj_all[this._model_index];l=MMD_SA.motion[(this.skin||this.morph||{})._motion_index];l=l&&l.para_SA||{};d._bone_morph={};let e=(l.playbackRate_by_model_index&&l.playbackRate_by_model_index[this._model_index]||1)*(t._playbackRate||1);if(this._model_index==0)t._playbackRate_OPC_=MMD_SA._playbackRate*e;else if(t._playbackRate_OPC_)e=t._playbackRate_OPC_/MMD_SA._playbackRate;r*=e}if(this.morph){var a=false;if(self.MMD_SA){let e=d.morphTargetInfluences;if(e){if(this.morph.playing){for(var m=0,L=e.length;m<L;m++)e[m]=0}else if(l.auto_blink){e[this.morph.target_index_by_name[""]]=0;if(this.morph.target_index_by_name[""]!=null)e[this.morph.target_index_by_name[""]]=0}}}if(this.morph_MMD_SA_extra){this.morph_MMD_SA_extra.forEach(function(e,t){if(e._is_dummy||!e.targets.length)return;var i=e._motion_index_MMD_SA_extra!=null?e._motion_index_MMD_SA_extra:e._motion_index-MMD_SA.custom_action_index;if(i<MMD_SA_options.custom_action.length){var o=MMD_SA_options.custom_action[i];var n=o.frame=o.para_by_model_index[s._model_index].frame=e._MMD_SA_disabled?0:~~((e.time<e.duration?e.time:e.duration)*30);if(o.condition(false,e)){a=true;if(e._MMD_SA_disabled){e._MMD_SA_disabled=false;e.reset();e.play()}}else{if(!e._MMD_SA_disabled){e.pause();e._MMD_SA_disabled=true}}}if(!e._MMD_SA_disabled){e.update(r)}})}if(a){this.morph.time+=r}else this.morph.update(r,e);if(self.MMD_SA){if(!l.process_morphs||!l.process_morphs(this,this.morph)){t.process_morphs&&t.process_morphs(this,this.morph);window.dispatchEvent(new CustomEvent("SA_MMD_model"+this._model_index+"_process_morphs",{detail:{model:this,morph:this.morph}}))}}if(self.MMD_SA){if(l.morph_noise){l.morph_noise.forEach(function(e){if(!e._count){e._count=~~(e.time_range[0]+Math.random()*(e.time_range[1]-e.time_range[0]+1));e.morph_list.forEach(function(e){e._weight=e.weight_range[0]+Math.random()*(e.weight_range[1]-e.weight_range[0])})}e._count--;var r=s.morph.targets;e.morph_list.forEach(function(e){var t=e.name;var i=s.morph.target_index_by_name[t];var o=r[i];var n=o.keys[0];var a={name:t,weight:s.pmx.morphs_weight_by_name[t]+e._weight,morph_type:n.morph_type,morph_index:n.morph_index};s.morph.onupdate(a,a,0,i)})})}var F=t._custom_morph||MMD_SA._custom_morph;F.forEach(function(e){if(!e.condition||e.condition(s)){s.morph.onupdate(e.key,e.key,0,e.idx)}});t._custom_morph=null;MMD_SA._custom_morph=[]}if(self.MMD_SA&&MMD_SA_options.auto_blink&&!a&&this.pmx.morphs_index_by_name[""]!=null){let e=this.morph.targets;let t=this._MMD_SA_cache_current;let r=e[t._blink_target_index];if(this._blink_countdown==null)this._blink_countdown=-9999;if(l.auto_blink||l.auto_blink==null&&r.keys.length<=2&&!r.keys[0].weight&&!r.keys[r.keys.length-1].weight){let o,n="",a=t._blink_target_index;if(l.auto_blink&&this.morph.playing){o=this.pmx.morphs_weight_by_name[""];let e=this.pmx.morphs_weight_by_name[""];if(o&&e){o=null}else if(e){o=e;n="";a=this.morph.target_index_by_name[n]}}else{o=0}if(o==null){this._blink_countdown=null}else{let e=this._blink_countdown;let i=-1;let t=2;if(e<=-1-t*3){this._blink_countdown=~~(20*(Math.random()*4+4));i=o||0}else if(e<=-1-t*2)i=o+(1-o)*(Math.abs(t*3+e)+1)/(t+1);else if(e<=-1-t*1)i=1;else if(e<=-1)i=o+(1-o)*(Math.abs(1+e)+1)/(t+1);if(i>=0){let e=r.keys[0];let t={name:n,weight:i,morph_type:e.morph_type,morph_index:e.morph_index};this.morph.onupdate(t,t,0,a)}this._blink_countdown--}}}}if(this.skin){self.MMD_SA&&MMD_SA_options.Dungeon&&MMD_SA_options.Dungeon.SFX_check(this,l,this.skin,r);this.skin.update(r,e)}if(self.MMD_SA){if(!l.process_bones||!l.process_bones(this,this.skin)){t.process_bones&&t.process_bones(this,this.skin);window.dispatchEvent(new CustomEvent("SA_MMD_model"+this._model_index+"_process_bones",{detail:{model:this,skin:this.skin}}))}if(this._model_index>0){let e=MMD_SA.bone_to_position.call(this,l);if(e)d.position.add(d._bone_to_position_last.pos_delta_rotated)}}if(this.skin){if(this.skin_MMD_SA_extra){this.skin_MMD_SA_extra.forEach(function(e,t){if(e._is_dummy)return;var i=e._motion_index_MMD_SA_extra!=null?e._motion_index_MMD_SA_extra:e._motion_index-MMD_SA.custom_action_index;if(i<MMD_SA_options.custom_action.length){var o=MMD_SA_options.custom_action[i];var n=o.frame=o.para_by_model_index[s._model_index].frame=e._MMD_SA_disabled?0:~~((e.time<e.duration?e.time:e.duration)*30);if(o.condition(true,e)){if(o.meter_motion_disabled!=false)_=true;var a=o.look_at_screen_ratio;if(a!=null)f=a;h=h||o.look_at_mouse_disabled;if(e._MMD_SA_disabled){e._MMD_SA_disabled=false;e.reset();e.play()}}else{if(!e._MMD_SA_disabled){e.pause();e._MMD_SA_disabled=true}}}if(!e._MMD_SA_disabled){if(e._seek_time_!=null){e.seek(e._seek_time_);e._seek_time_=null}else e.update(r);e._blending_ratio_=null}})}if(self.MMD_SA){for(var i in d._bone_morph){var o=d._bone_morph[i];var n=d.bones_by_name[i];for(var p in o){n.position.add(o[p].pos_v3);n.quaternion.multiply(o[p].rot_q)}}}var u="";var c=null;if(self.MMD_SA){if(!t.is_object){c=MMD_SA.THREEX.get_model(this._model_index).get_bone_position_by_MMD_name(u)}if(this._model_index==0){MMD_SA._head_pos=c;MMD_SA.SpeechBubble.update_placement();if(MMD_SA_options.Dungeon){var M=MMD_SA_options.Dungeon.character.bb_translate;M&&M.update&&M.update()}}}var v;if(self.MMD_SA&&c&&d.bones_by_name[u]&&f!=0&&MMD_SA_options.look_at_screen_by_model(this)&&t.look_at_screen!=false){var A=MMD_SA.camera_position;if(l&&l.center_view_lookAt||MMD_SA_options.center_view_lookAt||MMD_SA_options.use_JSARToolKit&&MMD_SA.AR_obj._m4)v=true;else{var O=MMD_SA_options.camera_position.slice(0);var z=MMD_SA.center_view;var g=d.position.toArray();for(var m=0;m<3;m++)g[m]+=O[m]+z[m];var j=[A.x,A.y,A.z];for(var m=0;m<3;m++){if(Math.abs(g[m]-j[m])>.01){v=true;break}}}var V=!h&&MMD_SA_options.look_at_mouse||t.look_at_character!=null||t.look_at_target;if(v||V){var B=(MMD_SA_options.look_at_screen_parent_rotation||System._browser.camera.facemesh.enabled&&d.bones_by_name[""].quaternion||MMD_SA.get_bone_rotation_parent(d,u)).conjugate();var y=MMD_SA.face_camera(c,B);var S=l.look_at_screen_angle_x_limit||[Math.PI*.5,-Math.PI*.5];var x=l.look_at_screen_angle_y_limit||[Math.PI*.5,-Math.PI*.5];var D=f!=null?f:MMD_SA_options.look_at_screen_ratio;y.x=Math.min(Math.max(MMD_SA.normalize_angle(y.x*D),S[1]),S[0]);y.y=Math.min(Math.max(MMD_SA.normalize_angle(y.y*D),x[1]),x[0]);var b=MMD_SA.TEMP_v3.copy(A).sub(c);if(this._model_index==0){MMD_SA._rx=Math.atan2(-b.y,Math.sqrt(Math.pow(b.x,2)+Math.pow(b.z,2)));MMD_SA._ry=y.y;MMD_SA._rx_last=y.x;MMD_SA._ry_last=y.y}if(V){let a;if(t.look_at_character!=null){a=THREE.MMD.getModels()[t.look_at_character].mesh.position.clone();a.y+=15}else if(t.look_at_target){a=t.look_at_target()}else{let e=webkit_electron_mode?System._browser._electron_cursor_pos:{x:System._browser._WE_mouse_x,y:System._browser._WE_mouse_y};let t=webkit_electron_mode?System._browser._electron_window_pos.slice(0):[Lbody_host.style.posLeft,Lbody_host.style.posTop];if(is_SA_child_animation){var K=parent.SA_child_animation[SA_child_animation_id];t[0]+=K.x;t[1]+=K.y}let i=(e.y-t[1])/B_content_height-.5-(MMD_SA_options.camera_type=="Ort"?.5:0);a=new THREE.Vector3(((e.x-t[0])/B_content_width-.5)*640,-i*480,l.look_at_mouse_z||0).unproject(MMD_SA._trackball_camera.object);if(MMD_SA_options.camera_type=="Ort"){a.multiplyScalar(1/100)}let o=MMD_SA._trackball_camera.position0;let n=MMD_SA.center_view_lookAt;a.x+=o.x-d.position.x+n[0];a.z-=n[2]}if(!MMD_SA._mouse_pos_3D[this._model_index])MMD_SA._mouse_pos_3D[this._model_index]=a;else{["x","y","z"].forEach(function(e){var t=a[e]-MMD_SA._mouse_pos_3D[s._model_index][e];var i=5;if(Math.abs(t)>i)t=Math.sign(t)*i;MMD_SA._mouse_pos_3D[s._model_index][e]+=t})}MMD_SA._camera_position_=MMD_SA._mouse_pos_3D[this._model_index];y=MMD_SA.face_camera(c,B);MMD_SA._camera_position_=null;y.x=Math.min(Math.max(MMD_SA.normalize_angle(y.x*D),S[1]),S[0]);y.y=Math.min(Math.max(MMD_SA.normalize_angle(y.y*D),x[1]),x[0])}var G,N,E,w;E=S[y.x<0?1:0];w=x[y.y<0?1:0];G=Math.abs(y.x/E);N=Math.abs(y.y/w);var W=MMD_SA_options.look_at_screen_bone_list;for(var m=0,X=W.length;m<X;m++){let e=W[m];let t=d.bones_by_name[e.name];if(!t)continue;let i=e.weight_screen;let o=MMD_SA_options.model_para_obj.skin_default[e.name]&&MMD_SA_options.model_para_obj.skin_default[e.name].pos_scale;if(o)i*=Math.min(o.x,o.y,o.z);let n,a;if(e.weight_screen_pow!=null){n=E*Math.pow(G,e.weight_screen_pow);a=w*Math.pow(N,e.weight_screen_pow)}else{n=y.x;a=y.y}let r=e.weight_motion;let s=r+(1-D)*(1-r);let _=e.weight_screen_x!=null?e.weight_screen_x:1;let l=e.weight_screen_y!=null?e.weight_screen_y:1;MMD_SA.process_bone(t,MMD_SA.TEMP_v3.set(n*i*_,a*i*l,0),[s+(1-s)*(1-_),s+(1-s)*(1-l),1])}if(MMD_SA._update_with_look_at_screen_){var q=MMD_SA._update_with_look_at_screen_.bone_list;var Q=MMD_SA._update_with_look_at_screen_.parent_list;var T=MMD_SA.TEMP_q.set(0,0,0,1);for(var k=0,Y=Q.length;k<Y;k++){var $=d.bones_by_name[Q[k]];if($)T.multiply($.quaternion,T)}T.inverse();for(var k=0,Y=q.length;k<Y;k++){let t=q[k];let i;for(var P=0,J=t.name.length;P<J;P++){let e=d.bones_by_name[t.name[P]];if(e){if(!i){i=MMD_SA._q1.copy(T);let e=t.ratio;if(e<1){i.inverse();e=-e}i.slerp(MMD_SA._q2.set(0,0,0,1),1-e/3)}e.quaternion.multiply(i)}}}MMD_SA._update_with_look_at_screen_=null}}}if(!v&&this._model_index==0){MMD_SA._rx=MMD_SA._rx_last=0;MMD_SA._ry=MMD_SA._ry_last=0}if(self.MMD_SA&&this._model_index==0){var R=this;var C=MMD_SA_options.custom_action.length;if(!_&&self.EV_usage>9){var I=[];if(EV_usage<60)I.push(~~(EV_usage/10)-1);else I.push(4,~~(EV_usage/10-1));for(var m=0,Z=R.skin_MMD_SA_extra.length-C;m<Z;m++){var H=R.skin_MMD_SA_extra[m+C];var e1=false;for(var P=0,t1=I.length;P<t1;P++){if(m==I[P]){e1=true;break}}if(e1){if(H._MMD_SA_disabled){H._MMD_SA_disabled=false;H.reset();H.play()}}else{if(!H._MMD_SA_disabled){H.pause();H._MMD_SA_disabled=true}}}}else{for(var m=0,Z=R.skin_MMD_SA_extra.length-C;m<Z;m++){var H=R.skin_MMD_SA_extra[m+C];if(!H._MMD_SA_disabled){H.pause();H._MMD_SA_disabled=true}}}}}if(self.MMD_SA){var i1=t._custom_skin||MMD_SA._custom_skin;i1.forEach(function(e){if(!e.condition||e.condition(s)){MMD_SA._skin_onupdate.call({mesh:d},e.key,e.key,0,e.idx)}});t._custom_skin=null;MMD_SA._custom_skin=[];var U=l.adjustment_per_model&&(l.adjustment_per_model[t._filename]||l.adjustment_per_model[t._filename_cleaned]||l.adjustment_per_model._default_);if(U&&U.skin_default){for(var i in U.skin_default){var n=U.skin_default[i];if(n.pos_scale&&n.pos_scale.auto_adjust&&i.indexOf("")!=-1&&t._ref_length&&t._ref_length[i]){var o1=MMD_SA.get_bone_position(d,i);var n1=MMD_SA.get_bone_position(d,i.substring(0,2));var a1=n1.sub(o1).setY(0).multiplyScalar(1-((t._ref_length[i]/n.pos_scale.auto_adjust.ref_length-1)*(n.pos_scale.auto_adjust.scale||1)+1));d.bones_by_name[i].position.sub(a1)}}}}this._update_IK_and_AddTrans();if(self.MMD_SA){if(!l.process_bones_after_IK||!l.process_bones_after_IK(this,this.skin)){t.process_bones_after_IK&&t.process_bones_after_IK(this,this.skin);window.dispatchEvent(new CustomEvent("SA_MMD_model"+this._model_index+"_process_bones_after_IK",{detail:{model:this,skin:this.skin}}))}}if(self.MMD_SA){MMD_SA_options.model_para_obj_all.forEach(function(e,t){if(t==s._model_index)return;var i=e.bone_connection;if(!i||i.target_model_index!=s._model_index)return;var o=MMD_SA.get_bone_position(d,i.target_bone_name);var n=MMD_SA.get_bone_rotation(d,i.target_bone_name);if(i.position){o.add(MMD_SA.TEMP_v3.set(-i.position.x,i.position.y,-i.position.z).applyQuaternion(n))}if(i.rotation){if(!i.rotation._quaternion)i.rotation._quaternion=(new THREE.Quaternion).setFromEuler(MMD_SA.TEMP_v3.set(i.rotation.x*Math.PI/180,-i.rotation.y*Math.PI/180,i.rotation.z*Math.PI/180));n.multiply(i.rotation._quaternion)}e._custom_skin=[{key:{name:i.self_bone_name,pos:o.toArray(),rot:n.toArray(),interp:MMD_SA._skin_interp_default},idx:THREE.MMD.getModels()[t].mesh.bones_by_name[i.self_bone_name]._index}]})}this.checkCallback()};T.prototype.seekMotion=function(e,t){this.resetBones();if(this.morph){this.morph.seek(e,t)}if(this.skin){this.skin.seek(e,t)}this._update_IK_and_AddTrans();this.checkCallback()};T.prototype.playMotion=function(t){if(this.morph){this.morph.play(t);if(this.morph_MMD_SA_extra){this.morph_MMD_SA_extra.forEach(function(e){if(!e._MMD_SA_disabled)e.play(t)})}}if(this.skin){this.skin.play(t);if(this.skin_MMD_SA_extra){this.skin_MMD_SA_extra.forEach(function(e){if(!e._MMD_SA_disabled)e.play(t)})}}};T.prototype.pauseMotion=function(){if(this.morph){this.morph.pause();if(this.morph_MMD_SA_extra){this.morph_MMD_SA_extra.forEach(function(e){if(!e._MMD_SA_disabled)e.pause()})}}if(this.skin){this.skin.pause();if(this.skin_MMD_SA_extra){this.skin_MMD_SA_extra.forEach(function(e){if(!e._MMD_SA_disabled)e.pause()})}}};T.prototype.preSimulate=function(){if(this.physi){this.physi.preSimulate()}};T.prototype.postSimulate=function(){if(this.physi){this.physi.postSimulate()}};T.prototype.dispose=function(){if(this.physi){this.physi.dispose()}if(this.mesh){this.mesh.dispose()}this.init()};T.prototype.checkCallback=function(){if(this._onmotionended){this._onmotionended(this);this._onmotionended=null}}})();var H,U=[],L;(function(){var o,i,n,a,r,s,t,_,l,e;H=[];o=false;i=false;n=0;a=0;r=false;s=true;_={render:function(e){var t;if(!R.targetScene||R.targetScene===e){if(R.motionPlaying||r||s){r=false;t=n}else{t=0}R.simulate(t)}}};e=function(){if(l){l();l=undefined}};R={addModel:function(e){e._model_index=e.pmx._model_index;H.push(e)},removeModel:function(e){var t;t=H.indexOf(e);if(t>=0){H.splice(t,1)}},getModels:function(){return H},swapModels:function(a,r,e){[a,r].forEach(function(e){var t=H[e];var i=e==a?r:a;t._model_index=t.mesh._model_index=t.pmx._model_index=i;if(t.morph_MMD_SA_extra){t.morph_MMD_SA_extra.forEach(function(e){e._model_index=i})}if(t.skin_MMD_SA_extra){t.skin_MMD_SA_extra.forEach(function(e){e._model_index=i})}for(var o in t._MMD_SA_cache){var n=t._MMD_SA_cache[o];if(n.morph)n.morph._model_index=i;if(n.skin)n.skin._model_index=i}});var t,i;t=H[a];i=H[r];H[a]=i;H[r]=t;t=MMD_SA_options.model_para_obj_all[a];i=MMD_SA_options.model_para_obj_all[r];MMD_SA_options.model_para_obj_all[a]=i;MMD_SA_options.model_para_obj_all[r]=t;MMD_SA_options.model_para_obj_all[a]._model_index=a;MMD_SA_options.model_para_obj_all[r]._model_index=r;t=MMD_SA_options.mesh_obj_by_id["mikuPmx"+a];i=MMD_SA_options.mesh_obj_by_id["mikuPmx"+r];MMD_SA_options.mesh_obj_by_id["mikuPmx"+a]=i;MMD_SA_options.mesh_obj_by_id["mikuPmx"+r]=t;if(MMD_SA.ammo_proxy){["cache_by_model","cache_by_model_next","cache_by_model_temp"].forEach(function(e){t=MMD_SA.ammo_proxy[e].list[a];i=MMD_SA.ammo_proxy[e].list[r];MMD_SA.ammo_proxy[e].list[a]=i;MMD_SA.ammo_proxy[e].list[r]=t})}var o={};var n={};var s=["position","rotation","quaternion"];s.forEach(function(e){o[e]=H[a].mesh[e].clone();n[e]=H[r].mesh[e].clone()});e&&e(a,r);s.forEach(function(e){H[a].mesh[e].copy(n[e]);H[r].mesh[e].copy(o[e])});if(a==0){MMD_SA_options.model_para_obj=MMD_SA_options.model_para_obj_all[0];H[0].mesh.visible=true;H[0].mesh.children.forEach(function(e){e.visible=true})}},setupCameraMotion:function(e,i){var t=e.generateCameraAnimation(),o,n;U.forEach(function(e,t){if(e.persepectiveCamera===i)n=t});isFinite(n)&&U.splice(n,1);if(t){o=new E(i,t);U.push(o);o.vmd=e}},getCameraMotion:function(){return U},setupLightMotion:function(e,t){var i;i=e.generateLightAnimation();if(i){L=new w(t,i);L.vmd=e}else{L=undefined}},getLightMotion:function(){return L},adjustMotionDuration:function(){var t=jThree.MMD._duration;U.forEach(function(e){t=Math.max(t,e.duration)});if(L){t=Math.max(t,L.duration)}H.forEach(function(e){if(e._model_index>0)return;if(e.skin){t=Math.max(t,e.skin.duration_default)}if(e.morph){t=Math.max(t,e.morph.duration_default)}});U.forEach(function(e){e.adjustDuration(t)});if(L){L.adjustDuration(t)}H.forEach(function(e){if(e._model_index>0)return;if(e.skin){e.skin.adjustDuration(t)}if(e.morph){e.morph.adjustDuration(t)}})},resetMotion:function(){U.forEach(function(e){e.reset()});if(L){L.reset()}H.forEach(function(e){e.resetMotion()});a=0},updateMotion:function(t,i){n=t;if(!i&&!o){return}U.forEach(function(e){e.update(t,i)});if(L){L.update(t,i)}H.forEach(function(e){e.updateMotion(t,i)});window.dispatchEvent(new CustomEvent("SA_MMD_model_all_process_bones"));e();a+=t;window.dispatchEvent(new CustomEvent("SA_MMD_after_updateMotion"))},seekMotion:function(t,i){if(!i&&!o){return}U.forEach(function(e){e.seek(t,i)});if(L){L.seek(t,i)}H.forEach(function(e){e.seekMotion(t,i)});e();r=true;a=t},playMotion:function(e){var t;t=this;if(e!==undefined){i=e}U.forEach(function(e){e.play(i)});if(L){L.play(i)}H.forEach(function(e){e.playMotion(i)});if(H.length>0){H[0].onmotionended=function(e){if(i){a=0}else{t.pauseMotion()}l=R.onmotionended}}o=true},pauseMotion:function(e){s=e;U.forEach(function(e){e.pause()});if(L){L.pause()}H.forEach(function(e){e.pauseMotion()});o=false},adjustCameraOffset:function(e){var t,i,o;if(U){if(e){t=e.model;i=e.offset}else{if(H.length>0){t=H[0]}}if(t){o=t.mesh.geometry.boundingBox.size()}U.offset.set(0,0,0);if(o){U.offset.y=o.y-20}if(i){U.offset.addVectors(U.offset,i)}}},getWorld:function(){return k},setGravity:function(e,t,i){k.setGravity(W(e,t,i))},simulate:function(e,t){var i=e;self.MMD_SA&&MMD_SA.ammo_proxy&&MMD_SA.ammo_proxy.lock("stepSimulation");var o=performance.now();if(H.length===0){return}if(e<=0){}else{if(self.MMD_SA){if(MMD_SA._motionTime_last==THREE.MMD.motionTime)return;MMD_SA._motionTime_last=THREE.MMD.motionTime;e+=MMD_SA.ammo_proxy&&MMD_SA.ammo_proxy._timeStep||0}if(e<P){e=P}t=t||Math.ceil(e/P);if(self.MMD_SA){t=Math.min(Math.ceil(e/P),MMD_SA_options.model_para_obj.physics_maxSubSteps||MMD_SA_options.physics_maxSubSteps||9)}H.forEach(function(e){if(!e.visible)return;e.preSimulate()});k&&k.stepSimulation(e,t,P);H.forEach(function(e){if(!e.visible)return;e.postSimulate()});if(self.MMD_SA){if(MMD_SA.ammo_proxy){if(MMD_SA.ammo_proxy.update_worker("stepSimulation")){MMD_SA.ammo_proxy.cache_by_model_temp.transfer_to("cache_by_model_next");MMD_SA.ammo_proxy._timeStep=0}else{MMD_SA.ammo_proxy._timeStep+=i;MMD_SA.ammo_proxy.reset()}}MMD_SA.physicsHelper&&MMD_SA.physicsHelper.update()}}H.forEach(function(e){if(e.simulateCallback){e.simulateCallback()}})},init:function(e,t){R.targetScene=t;R.targetRenderer=e},targetScene:null,get targetRenderer(){return t},set targetRenderer(e){if(t!==e){t=e;if(e.renderPluginsPre.indexOf(_)===-1){e.renderPluginsPre.unshift(_)}}},get motionPlaying(){return o},get motionLoop(){return i},get motionDelta(){return n},get motionTime(){return a},onmotionended:null,minKeyDelta:1/30+1/60,STOP_ERP:.475,PMX:M,VMD:v,Model:T}})();THREE.MMD=R;THREE.Mesh.prototype.dispose=function(){if(this.material.materials){this.material.materials.forEach(function(e){t(e);e.dispose()})}else{t(this.material);this.material.dispose()}this.geometry.dispose();function t(e){var t,i;for(i in e){t=e[i];if(t instanceof THREE.Texture){t.dispose()}}}};jThree._ammo_async_init_.push(function(){window.Ammo&&R.setGravity(0,-9.8*10,0);if(window.Ammo){var e=new Ammo.btVector3,t=new Ammo.btTransform,i,o,n,a;e.setValue(0,1,0);i=new Ammo.btStaticPlaneShape(e,0);o=new Ammo.btVector3(0,0,0);i.calculateLocalInertia(0,o);t.setIdentity();n=new Ammo.btRigidBodyConstructionInfo(0,new Ammo.btDefaultMotionState(t),i,o);if(self.MMD_SA&&!MMD_SA_options.ground_physics_disabled){a=new Ammo.btRigidBody(n);k.addRigidBody(a);jThree.MMD._ground=a.getWorldTransform().getOrigin();if(MMD_SA_options.ground_y)jThree.MMD._ground.setY(MMD_SA_options.ground_y)}Ammo.destroy(n);Ammo.destroy(o);Ammo.destroy(t);Ammo.destroy(e)}self.MMD_SA&&MMD_SA.ammo_proxy&&MMD_SA.ammo_proxy.update_worker()});if(!self.MMD_SA||!MMD_SA_options.ammo_version||MMD_SA._ammo_async_loaded_){jThree._ammo_async_init_.forEach(function(e){e()});jThree._ammo_async_init_=[]}jThree.modelHooks.pmx=function(e,t){(new M).load(e,function(e){t(e);t=null})};jThree.motionHooks.vmd=function(e,t){(new v).load(e,function(e){t(e);t=null})};function l(){H.splice(this.__mmd,1)[0].dispose()}jThree.mmdHook=function(a,e,r){var s=jThree.three(this);var i;if(/(\d+)$/.test(this.getAttribute("model")))i=parseInt(RegExp.$1);if(!e){(function(){var e=i;MMD_SA.fn._model_creation_timerID[e]=setInterval(function(){if(!MMD_SA.fn._ready_for_model_creation[e])return;new THREE.MMD.Model(a).create(jThree.MMD,function(e){var t=e.mesh;s.__mmd=e;t.material.materials.forEach(function(e){e.fog=true;e.lights=true});s.addEventListener("removed",l);THREE.MMD.addModel(e);r(t);s=r=null;var i=MMD_SA_options.model_para_obj_all[a._model_index];var o=i.position_loading;if(!o){var n=i.skin_default[""];o=n&&(n.pos||n.pos_add||n.pos_add_absolute);if(o){if((o==n.pos||o==n.pos_add)&&n.pos_add_absolute){o={x:o.x+n.pos_add_absolute.x,y:o.y+n.pos_add_absolute.y,z:o.z+n.pos_add_absolute.z}}}}if(o){t.position.set(o.x,o.y,o.z)}});clearInterval(MMD_SA.fn._model_creation_timerID[e]);MMD_SA.fn._model_creation_timerID[e]=null;setTimeout("MMD_SA.fn.setupUI()",0)},500)})()}else{var o=this;function n(e){var t=jThree.three(this)._srcObj||(self.MMD_SA&&this._id?MMD_SA._j3_obj_by_id[this._id]:null);(function(){var e=i;MMD_SA.fn._model_creation_timerID[e]=setInterval(function(){if(!MMD_SA.fn._ready_for_model_creation[e])return;new THREE.MMD.Model(a,t).create(jThree.MMD,function(e){var t=e.mesh;s.__mmd=e;t.material.materials.forEach(function(e){e.fog=true;e.lights=true});s.addEventListener("removed",l);THREE.MMD.addModel(e);THREE.MMD.adjustMotionDuration();r(t);s=r=null;var i=MMD_SA_options.model_para_obj_all[a._model_index];var o=i.skin_default[""];var n=i.position_loading||o&&(o.pos||o.pos_add);if(n){t.position.set(n.x,n.y,n.z)}});clearInterval(MMD_SA.fn._model_creation_timerID[e]);MMD_SA.fn._model_creation_timerID[e]=null;setTimeout("MMD_SA.fn.setupUI()",0)},500)})();if(e){$.event.remove(this,"load",n);$.event.remove(this,"error",_)}o=null}function _(){$.event.remove(this,"load",n);$.event.remove(this,"error",_);$.event.trigger("error",undefined,o);o=s=r=null}switch(e.attr("loadStates")){case"loading":e.load(n);e.error(_);break;case"success":n.call(e);break;default:$.event.trigger("error",undefined,this);break}}};jThree.otherMmdHook=function(e){var n=this;function a(e){var t=THREE.MMD["setup"+(n.tagName==="CAMERA"?"Camera":"Light")+"Motion"],i=jThree.three(n),o=jThree.three(this)._srcObj;t(o,i);THREE.MMD.adjustMotionDuration();$.event.trigger("load",undefined,n);if(e){$.event.remove(this,"load",a);$.event.remove(this,"error",r)}n=null}function r(){$.event.remove(this,"load",a);$.event.remove(this,"error",r);$.event.trigger("error",undefined,n);n=null}switch(e.attr("loadStates")){case"loading":e.load(a);e.error(r);break;case"success":a.call(e[0]);break;default:if(this.tagName==="CAMERA"){var i=jThree.three(this);U.forEach(function(e,t){e.persepectiveCamera===i&&U.splice(t,1)});i=null}else{L=null}$.event.trigger("load",undefined,this);break}};jThree.MMD._simulate={render:function(){motionSeek=false;if(self.MMD_SA){R.simulate(R.motionPlaying||motionSeek?R.motionDelta/(MMD_SA._playbackRate*MMD_SA.playbackRate):0)}else R.simulate(R.motionPlaying||motionSeek?R.motionDelta:0)}};jThree.MMD.seek=THREE.MMD.seekMotion})();THREE.MMDPhysicsHelper=function(e){THREE.Object3D.call(this);this.root=e;this.matrix=e.matrixWorld.clone();this.matrixAutoUpdate=false;this.materials=[];this.materials.push(new THREE.MeshBasicMaterial({color:new THREE.Color(16746632),wireframe:true,depthTest:false,depthWrite:false,opacity:.25,transparent:true}));this.materials.push(new THREE.MeshBasicMaterial({color:new THREE.Color(8978312),wireframe:true,depthTest:false,depthWrite:false,opacity:.25,transparent:true}));this.materials.push(new THREE.MeshBasicMaterial({color:new THREE.Color(8947967),wireframe:true,depthTest:false,depthWrite:false,opacity:.25,transparent:true}));this._init();this.update()};THREE.MMDPhysicsHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.MMDPhysicsHelper.prototype.constructor=THREE.MMDPhysicsHelper;THREE.MMDPhysicsHelper.prototype._init=function(){var e=this.root;var t=e.MMDrigids;function i(e){switch(e.shape){case 0:return new THREE.SphereGeometry(e.size[0],16,8);case 1:return new THREE.CubeGeometry(e.size[0]*2,e.size[1]*2,e.size[2]*2,8,8,8);case 2:return o(e.size[0],e.size[1],16,8);default:return null}}function o(e,t,i,o){var n=new THREE.CylinderGeometry(e,e,t,i,o,true);return n}for(var n=0,a=t.length;n<a;n++){var r=t[n];let e=new THREE.Mesh(i(r),this.materials[r.type]);e.useQuaternion=true;this.add(e)}};THREE.MMDPhysicsHelper.prototype.update=function(){var e=this.root;var o=e.MMDrigids;var t=(new THREE.Matrix4).getInverse(e.matrixWorld);var i=new THREE.Vector3;var n=new THREE.Quaternion;var a=new THREE.Quaternion;function r(e){i.set(e.x(),e.y(),e.z());return i}function s(e){n.set(e.x(),e.y(),e.z(),e.w());a.setFromRotationMatrix(t);a.multiply(n);return a}for(var _=0,l=o.length;_<l;_++){let e=o[_].body;let t=this.children[_];let i=e.getCenterOfMassTransform();t.position.copy(r(i.getOrigin()));t.quaternion.copy(s(i.getRotation()))}this.matrix.copy(this.root.matrix);this.updateMatrix()};(function(){"use strict";var d="?".charCodeAt(0),t={SJISToUTF8:function(e){var t=[],i=e.length,o=0,n,a,r,s,_,l;for(;o<i;o++){if(161<=e[o]&&e[o]<=223){a=e[o]-64;r=188|a>>6&3;s=128|a&63;t[t.length]=239;t[t.length]=r;t[t.length]=s}else if(e[o]>=128){n=e[o]<<1;a=e[++o];if(a<159){if(n<319){n-=225}else{n-=97}if(a>126){a-=32}else{a-=31}}else{if(n<319){n-=224}else{n-=96}a-=126}n&=255;_=(n<<8)+a;if(f[_]===void 0){t[t.length]=d}else{l=f[_];if(l<65535){t[t.length]=l>>8&255;t[t.length]=l&255}else{t[t.length]=l>>16&255;t[t.length]=l>>8&255;t[t.length]=l&255}}}else{t[t.length]=e[o]}}return t},UTF8ToUNICODE:function(e){var t=[],i=0,o=e.length,n,a,r,s,_,l;while(i<o){a=e[i++];n=a>>4;if(0<=n&&n<=7){t[t.length]=a}else if(12<=n&&n<=13){r=e[i++];t[t.length]=(a&31)<<6|r&63}else if(n===14){r=e[i++];s=e[i++];t[t.length]=(a&15)<<12|(r&63)<<6|(s&63)<<0}else if(i+2<o){r=e[i++];s=e[i++];_=e[i++];t[t.length]=(a&7)<<18|(r&63)<<12|(s&63)<<6|(_&63)<<0}}return t},SJISToUNICODE:function(e){return t.UTF8ToUNICODE(t.SJISToUTF8(e))}},f={11553:14848416,11554:14848417,11555:14848418,11556:14848419,11557:14848420,11558:14848421,11559:14848422,11560:14848423,11561:14848424,11562:14848425,11563:14848426,11564:14848427,11565:14848428,11566:14848429,11567:14848430,11568:14848431,11569:14848432,11570:14848433,11571:14848434,11572:14848435,11573:14845344,11574:14845345,11575:14845346,11576:14845347,11577:14845348,11578:14845349,11579:14845350,11580:14845351,11581:14845352,11582:14845353,11584:14912905,11585:14912660,11586:14912674,11587:14912909,11588:14912664,11589:14912679,11590:14912643,11591:14912694,11592:14912913,11593:14912919,11594:14912653,11595:14912678,11596:14912675,11597:14912683,11598:14912906,11599:14912699,11600:14913180,11601:14913181,11602:14913182,11603:14913166,11604:14913167,11605:14913412,11606:14913185,11615:14912955,11616:14909597,11617:14909599,11618:14845078,11619:14913421,11620:14845089,11621:14912164,11622:14912165,11623:14912166,11624:14912167,11625:14912168,11626:14911665,11627:14911666,11628:14911673,11629:14912958,11630:14912957,11631:14912956,11635:14846126,11636:14846097,11640:14846111,11641:14846655,8481:14909568,8482:14909569,8483:14909570,8484:15711372,8485:15711374,8486:14910395,8487:15711386,8488:15711387,8489:15711391,8490:15711361,8491:14910107,8492:14910108,8493:49844,8494:15711616,8495:49832,8496:15711422,8497:15712163,8498:15711423,8499:14910397,8500:14910398,8501:14910109,8502:14910110,8503:14909571,8504:14990237,8505:14909573,8506:14909574,8507:14909575,8508:14910396,8509:14844053,8510:14844048,8511:15711375,8512:15711420,8513:15711646,8514:14844054,8515:15711644,8516:14844070,8517:14844069,8518:14844056,8519:14844057,8520:14844060,8521:14844061,8522:15711368,8523:15711369,8524:14909588,8525:14909589,8526:15711419,8527:15711421,8528:15711643,8529:15711645,8530:14909576,8531:14909577,8532:14909578,8533:14909579,8534:14909580,8535:14909581,8536:14909582,8537:14909583,8538:14909584,8539:14909585,8540:15711371,8541:15711373,8542:49841,8543:50071,8544:50103,8545:15711389,8546:14846368,8547:15711388,8548:15711390,8549:14846374,8550:14846375,8551:14846110,8552:14846132,8553:14850434,8554:14850432,8555:49840,8556:14844082,8557:14844083,8558:14845059,8559:15712165,8560:15711364,8561:15712160,8562:15712161,8563:15711365,8564:15711363,8565:15711366,8566:15711370,8567:15711392,8568:49831,8569:14850182,8570:14850181,8571:14849931,8572:14849935,8573:14849934,8574:14849927,8737:14849926,8738:14849697,8739:14849696,8740:14849715,8741:14849714,8742:14849725,8743:14849724,8744:14844091,8745:14909586,8746:14845586,8747:14845584,8748:14845585,8749:14845587,8750:14909587,8762:14846088,8763:14846091,8764:14846598,8765:14846599,8766:14846594,8767:14846595,8768:14846122,8769:14846121,8778:14846119,8779:14846120,8780:49836,8781:14845842,8782:14845844,8783:14846080,8784:14846083,8796:14846112,8797:14846629,8798:14847122,8799:14846082,8800:14846087,8801:14846369,8802:14846354,8803:14846378,8804:14846379,8805:14846106,8806:14846141,8807:14846109,8808:14846133,8809:14846123,8810:14846124,8818:14845099,8819:14844080,8820:14850479,8821:14850477,8822:14850474,8823:14844064,8824:14844065,8825:49846,8830:14849967,9008:15711376,9009:15711377,9010:15711378,9011:15711379,9012:15711380,9013:15711381,9014:15711382,9015:15711383,9016:15711384,9017:15711385,9025:15711393,9026:15711394,9027:15711395,9028:15711396,9029:15711397,9030:15711398,9031:15711399,9032:15711400,9033:15711401,9034:15711402,9035:15711403,9036:15711404,9037:15711405,9038:15711406,9039:15711407,9040:15711408,9041:15711409,9042:15711410,9043:15711411,9044:15711412,9045:15711413,9046:15711414,9047:15711415,9048:15711416,9049:15711417,9050:15711418,9057:15711617,9058:15711618,9059:15711619,9060:15711620,9061:15711621,9062:15711622,9063:15711623,9064:15711624,9065:15711625,9066:15711626,9067:15711627,9068:15711628,9069:15711629,9070:15711630,9071:15711631,9072:15711632,9073:15711633,9074:15711634,9075:15711635,9076:15711636,9077:15711637,9078:15711638,9079:15711639,9080:15711640,9081:15711641,9082:15711642,9249:14909825,9250:14909826,9251:14909827,9252:14909828,9253:14909829,9254:14909830,9255:14909831,9256:14909832,9257:14909833,9258:14909834,9259:14909835,9260:14909836,9261:14909837,9262:14909838,9263:14909839,9264:14909840,9265:14909841,9266:14909842,9267:14909843,9268:14909844,9269:14909845,9270:14909846,9271:14909847,9272:14909848,9273:14909849,9274:14909850,9275:14909851,9276:14909852,9277:14909853,9278:14909854,9279:14909855,9280:14909856,9281:14909857,9282:14909858,9283:14909859,9284:14909860,9285:14909861,9286:14909862,9287:14909863,9288:14909864,9289:14909865,9290:14909866,9291:14909867,9292:14909868,9293:14909869,9294:14909870,9295:14909871,9296:14909872,9297:14909873,9298:14909874,9299:14909875,9300:14909876,9301:14909877,9302:14909878,9303:14909879,9304:14909880,9305:14909881,9306:14909882,9307:14909883,9308:14909884,9309:14909885,9310:14909886,9311:14909887,9312:14910080,9313:14910081,9314:14910082,9315:14910083,9316:14910084,9317:14910085,9318:14910086,9319:14910087,9320:14910088,9321:14910089,9322:14910090,9323:14910091,9324:14910092,9325:14910093,9326:14910094,9327:14910095,9328:14910096,9329:14910097,9330:14910098,9331:14910099,9505:14910113,9506:14910114,9507:14910115,9508:14910116,9509:14910117,9510:14910118,9511:14910119,9512:14910120,9513:14910121,9514:14910122,9515:14910123,9516:14910124,9517:14910125,9518:14910126,9519:14910127,9520:14910128,9521:14910129,9522:14910130,9523:14910131,9524:14910132,9525:14910133,9526:14910134,9527:14910135,9528:14910136,9529:14910137,9530:14910138,9531:14910139,9532:14910140,9533:14910141,9534:14910142,9535:14910143,9536:14910336,9537:14910337,9538:14910338,9539:14910339,9540:14910340,9541:14910341,9542:14910342,9543:14910343,9544:14910344,9545:14910345,9546:14910346,9547:14910347,9548:14910348,9549:14910349,9550:14910350,9551:14910351,9552:14910352,9553:14910353,9554:14910354,9555:14910355,9556:14910356,9557:14910357,9558:14910358,9559:14910359,9560:14910360,9561:14910361,9562:14910362,9563:14910363,9564:14910364,9565:14910365,9566:14910366,9567:14910367,9568:14910368,9569:14910369,9570:14910370,9571:14910371,9572:14910372,9573:14910373,9574:14910374,9575:14910375,9576:14910376,9577:14910377,9578:14910378,9579:14910379,9580:14910380,9581:14910381,9582:14910382,9583:14910383,9584:14910384,9585:14910385,9586:14910386,9587:14910387,9588:14910388,9589:14910389,9590:14910390,9761:52881,9762:52882,9763:52883,9764:52884,9765:52885,9766:52886,9767:52887,9768:52888,9769:52889,9770:52890,9771:52891,9772:52892,9773:52893,9774:52894,9775:52895,9776:52896,9777:52897,9778:52899,9779:52900,9780:52901,9781:52902,9782:52903,9783:52904,9784:52905,9793:52913,9794:52914,9795:52915,9796:52916,9797:52917,9798:52918,9799:52919,9800:52920,9801:52921,9802:52922,9803:52923,9804:52924,9805:52925,9806:52926,9807:52927,9808:53120,9809:53121,9810:53123,9811:53124,9812:53125,9813:53126,9814:53127,9815:53128,9816:53129,10017:53392,10018:53393,10019:53394,10020:53395,10021:53396,10022:53397,10023:53377,10024:53398,10025:53399,10026:53400,10027:53401,10028:53402,10029:53403,10030:53404,10031:53405,10032:53406,10033:53407,10034:53408,10035:53409,10036:53410,10037:53411,10038:53412,10039:53413,10040:53414,10041:53415,10042:53416,10043:53417,10044:53418,10045:53419,10046:53420,10047:53421,10048:53422,10049:53423,10065:53424,10066:53425,10067:53426,10068:53427,10069:53428,10070:53429,10071:53649,10072:53430,10073:53431,10074:53432,10075:53433,10076:53434,10077:53435,10078:53436,10079:53437,10080:53438,10081:53439,10082:53632,10083:53633,10084:53634,10085:53635,10086:53636,10087:53637,10088:53638,10089:53639,10090:53640,10091:53641,10092:53642,10093:53643,10094:53644,10095:53645,10096:53646,10097:53647,10273:14849152,10274:14849154,10275:14849164,10276:14849168,10277:14849176,10278:14849172,10279:14849180,10280:14849196,10281:14849188,10282:14849204,10283:14849212,10284:14849153,10285:14849155,10286:14849167,10287:14849171,10288:14849179,10289:14849175,10290:14849187,10291:14849203,10292:14849195,10293:14849211,10294:14849419,10295:14849184,10296:14849199,10297:14849192,10298:14849207,10299:14849215,10300:14849181,10301:14849200,10302:14849189,10303:14849208,10304:14849410,12321:14989980,12322:15045782,12323:15050883,12324:15308991,12325:15045504,12326:15107227,12327:15109288,12328:15050678,12329:15302818,12330:15241653,12331:15240348,12332:15182224,12333:15106730,12334:15110049,12335:15120549,12336:15112109,12337:15241638,12338:15239846,12339:15314869,12340:15114899,12341:15047847,12342:15111841,12343:15108529,12344:15052443,12345:15050640,12346:15243707,12347:15311796,12348:15185314,12349:15185598,12350:15314574,12351:15108246,12352:15184543,12353:15246007,12354:15052425,12355:15055541,12356:15109257,12357:15112855,12358:15114632,12359:15308679,12360:15310477,12361:15113615,12362:14990245,12363:14990474,12364:14990733,12365:14991005,12366:15040905,12367:15047602,12368:15049911,12369:15050644,12370:15050881,12371:15052937,12372:15106975,12373:15107215,12374:15107504,12375:15112339,12376:15115397,12377:15172282,12378:15177103,12379:15177136,12380:15181755,12381:15185581,12382:15185839,12383:15238019,12384:15241358,12385:15245731,12386:15248514,12387:15303061,12388:15303098,12389:15043771,12390:14989973,12391:14989989,12392:15048607,12393:15237810,12394:15303553,12395:15180719,12396:14989440,12397:15049649,12398:15121058,12399:15302840,12400:15182002,12401:15240360,12402:15239819,12403:15315119,12404:15041921,12405:15044016,12406:15045309,12407:15045537,12408:15047584,12409:15050683,12410:15056021,12411:15311794,12412:15120299,12413:15238052,12414:15242413,12577:15309218,12578:15309232,12579:15309472,12580:15310779,12581:15044747,12582:15044531,12583:15052423,12584:15172495,12585:15187645,12586:15253378,12587:15309736,12588:15044015,12589:15316380,12590:15182522,12591:14989457,12592:15180435,12593:15239100,12594:15120550,12595:15046808,12596:15045764,12597:15117469,12598:15242394,12599:15315131,12600:15050661,12601:15044265,12602:15119782,12603:15176604,12604:15308431,12605:15047042,12606:14989969,12607:15303051,12608:15309746,12609:15240591,12610:15312012,12611:15044513,12612:15046326,12613:15051952,12614:15056305,12615:15112352,12616:15113139,12617:15114372,12618:15118520,12619:15119283,12620:15119529,12621:15176091,12622:15178632,12623:15182222,12624:15311028,12625:15240113,12626:15245723,12627:15247776,12628:15305645,12629:15120050,12630:15177387,12631:15178634,12632:15312773,12633:15106726,12634:15248513,12635:15251082,12636:15308466,12637:15115918,12638:15044269,12639:15042182,12640:15047826,12641:15048880,12642:15050116,12643:15052468,12644:15055798,12645:15106216,12646:15109801,12647:15110068,12648:15119039,12649:15121556,12650:15172238,12651:15172756,12652:15173017,12653:15173525,12654:15174847,12655:15186049,12656:15239606,12657:15240081,12658:15242903,12659:15303072,12660:15305115,12661:15316123,12662:15049129,12663:15111868,12664:15118746,12665:15176869,12666:15042489,12667:15049902,12668:15050149,12669:15056512,12670:15056796,12833:15108796,12834:15112122,12835:15116458,12836:15117479,12837:15118004,12838:15175307,12839:15187841,12840:15246742,12841:15316140,12842:15316110,12843:15317892,12844:15053473,12845:15118998,12846:15240635,12847:15041668,12848:15053195,12849:15107766,12850:15239046,12851:15114678,12852:15174049,12853:14989721,12854:14991290,12855:15044024,12856:15106473,12857:15120553,12858:15182223,12859:15310771,12860:14989451,12861:15043734,12862:14990254,12863:14990741,12864:14990525,12865:14991009,12866:14990771,12867:15043232,12868:15044527,12869:15046793,12870:15049871,12871:15051649,12872:15052470,12873:15052705,12874:15181713,12875:15112839,12876:15113884,12877:15113910,12878:15117708,12879:15119027,12880:15172011,12881:15175554,12882:15181453,12883:15181502,12884:15182012,12885:15183495,12886:15239857,12887:15240091,12888:15240324,12889:15240631,12890:15241135,12891:15241107,12892:15244710,12893:15248050,12894:15046825,12895:15250088,12896:15253414,12897:15303054,12898:15309982,12899:15243914,12900:14991236,12901:15053736,12902:15108241,12903:15174041,12904:15176891,12905:15239077,12906:15239869,12907:15244222,12908:15250304,12909:15309701,12910:15312019,12911:15312789,12912:14990219,12913:14990490,12914:15247267,12915:15047582,12916:15049098,12917:15049610,12918:15055803,12919:15056811,12920:15106218,12921:15106708,12922:15106466,12923:15107984,12924:15108242,12925:15109008,12926:15111353,13089:15314305,13090:15112614,13091:15114928,13092:15119799,13093:15172016,13094:15177100,13095:15178374,13096:15185333,13097:15239845,13098:15245241,13099:15308427,13100:15309454,13101:15250077,13102:15042481,13103:15043262,13104:15049878,13105:15045299,13106:15052467,13107:15053974,13108:15107496,13109:15115906,13110:15120047,13111:15180429,13112:15242123,13113:15245719,13114:15247794,13115:15306407,13116:15313592,13117:15119788,13118:15312552,13119:15244185,13120:15048355,13121:15114175,13122:15244174,13123:15304846,13124:15043203,13125:15047303,13126:15044740,13127:15055763,13128:15109025,13129:15110841,13130:15114428,13131:15114424,13132:15118011,13133:15175090,13134:15180474,13135:15182251,13136:15247002,13137:15247250,13138:15250859,13139:15252611,13140:15303597,13141:15308451,13142:15309460,13143:15310249,13144:15052198,13145:15053491,13146:15115709,13147:15311245,13148:15311246,13149:15109787,13150:15183008,13151:15116459,13152:15116735,13153:15114934,13154:15315085,13155:15121823,13156:15042994,13157:15046301,13158:15106480,13159:15109036,13160:15119547,13161:15120519,13162:15121297,13163:15241627,13164:15246480,13165:15252868,13166:14989460,13167:15315129,13168:15044534,13169:15115419,13170:15116474,13171:15310468,13172:15114410,13173:15041948,13174:15182723,13175:15241906,13176:15304604,13177:15306380,13178:15047067,13179:15316136,13180:15114402,13181:15240325,13182:15241393,13345:15184549,13346:15042696,13347:15240069,13348:15176614,13349:14989758,13350:14990979,13351:15042208,13352:15052690,13353:15042698,13354:15043480,13355:15043495,13356:15054779,13357:15046298,13358:15048874,13359:15050662,13360:15052428,13361:15052440,13362:15052699,13363:15055282,13364:15055289,13365:15106723,13366:15107231,13367:15107491,13368:15107774,13369:15110043,13370:15111586,13371:15114129,13372:15114643,13373:15115194,13374:15117502,13375:15117715,13376:15118743,13377:15121570,13378:15122071,13379:15121797,13380:15176368,13381:15176856,13382:15178659,13383:15178891,13384:15182783,13385:15183521,13386:15184033,13387:15185833,13388:15187126,13389:15187888,13390:15237789,13391:15239590,13392:15240862,13393:15247027,13394:15248268,13395:15250091,13396:15303300,13397:15307153,13398:15308435,13399:15308433,13400:15308450,13401:15309221,13402:15310739,13403:15312040,13404:15239320,13405:14989496,13406:15044779,13407:15053496,13408:15054732,13409:15175337,13410:15178124,13411:15178940,13412:15053481,13413:15187883,13414:15250571,13415:15309697,13416:15310993,13417:15311252,13418:15311256,13419:14990465,13420:14990478,13421:15044017,13422:15046300,13423:15047080,13424:15048634,13425:15050119,13426:15051913,13427:15052676,13428:15053456,13429:15054988,13430:15055294,13431:15056780,13432:15110062,13433:15113402,13434:15112087,13435:15112098,13436:15113375,13437:15115147,13438:15115140,13601:15116703,13602:15055024,13603:15118213,13604:15118487,13605:15118781,13606:15177151,13607:15181192,13608:15052195,13609:15181952,13610:15185024,13611:15056573,13612:15246991,13613:15247512,13614:15250100,13615:15250871,13616:15252364,13617:15252637,13618:15311778,13619:15313038,13620:15314108,13621:14989952,13622:15040957,13623:15041664,13624:15050387,13625:15052444,13626:15108271,13627:15108736,13628:15111084,13629:15117498,13630:15174304,13631:15177361,13632:15181191,13633:15187625,13634:15245243,13635:15248060,13636:15248816,13637:15109804,13638:15241098,13639:15310496,13640:15044745,13641:15044739,13642:15046315,13643:15114644,13644:15116696,13645:15247792,13646:15179943,13647:15113653,13648:15317901,13649:15044020,13650:15052450,13651:15238298,13652:15243664,13653:15302790,13654:14989464,13655:14989701,13656:14990215,13657:14990481,13658:15044490,13659:15044792,13660:15052462,13661:15056019,13662:15106213,13663:15111569,13664:15113405,13665:15118722,13666:15118770,13667:15119267,13668:15172024,13669:15175811,13670:15182262,13671:15182510,13672:15182984,13673:15185050,13674:15184830,13675:15185318,13676:15112103,13677:15174043,13678:15044283,13679:15053189,13680:15054760,13681:15109010,13682:15109024,13683:15109273,13684:15120544,13685:15243674,13686:15247537,13687:15251357,13688:15305656,13689:15121537,13690:15181478,13691:15314330,13692:14989992,13693:14989995,13694:14989996,13857:14991003,13858:14991008,13859:15041425,13860:15041927,13861:15182774,13862:15041969,13863:15042486,13864:15043988,13865:15043745,13866:15044031,13867:15044523,13868:15046316,13869:15049347,13870:15053729,13871:15056055,13872:15056266,13873:15106223,13874:15106448,13875:15106477,13876:15109279,13877:15111577,13878:15116683,13879:15119233,13880:15174530,13881:15174573,13882:15179695,13883:15238072,13884:15238277,13885:15239304,13886:15242638,13887:15303607,13888:15306657,13889:15310783,13890:15312279,13891:15313306,13892:14990256,13893:15042461,13894:15052973,13895:15112833,13896:15115693,13897:15053184,13898:15113138,13899:15115701,13900:15175305,13901:15114640,13902:15184513,13903:15041413,13904:15043492,13905:15048071,13906:15054782,13907:15305894,13908:15111844,13909:15117475,13910:15117501,13911:15175860,13912:15181441,13913:15181501,13914:15183243,13915:15185802,13916:15239865,13917:15241100,13918:15245759,13919:15246751,13920:15248569,13921:15253393,13922:15304593,13923:15044767,13924:15305344,13925:14989725,13926:15040694,13927:15044517,13928:15043770,13929:15174551,13930:15175318,13931:15179689,13932:15240102,13933:15252143,13934:15312774,13935:15312776,13936:15312786,13937:15041975,13938:15107226,13939:15243678,13940:15046320,13941:15182266,13942:15040950,13943:15052691,13944:15303047,13945:15309445,13946:14989490,13947:15117211,13948:15304615,13949:15053201,13950:15053192,14113:15109784,14114:15182495,14115:15118995,14116:15310260,14117:15252897,14118:15182506,14119:15173258,14120:15309448,14121:15184514,14122:15114391,14123:15186352,14124:15114641,14125:15306156,14126:15043506,14127:15044763,14128:15242923,14129:15247507,14130:15187620,14131:15252365,14132:15303585,14133:15044006,14134:15245960,14135:15181185,14136:14991234,14137:15041214,14138:15042705,14139:15041924,14140:15046035,14141:15047853,14142:15175594,14143:15048331,14144:15050129,14145:15056290,14146:15056516,14147:15106485,14148:15107510,14149:15107495,14150:15107753,14151:15109810,14152:15110330,14153:15111596,14154:15112623,14155:15114626,14156:15120531,14157:15177126,14158:15182013,14159:15184827,14160:15185292,14161:15185561,14162:15186315,14163:15187371,14164:15240334,14165:15240586,14166:15244173,14167:15247496,14168:15247779,14169:15248806,14170:15252413,14171:15311002,14172:15316623,14173:15239864,14174:15253390,14175:15314856,14176:15043207,14177:15108255,14178:15110787,14179:15122304,14180:15309465,14181:15114625,14182:15041169,14183:15117472,14184:15118778,14185:15121812,14186:15182260,14187:15185296,14188:15245696,14189:15247523,14190:15113352,14191:14990262,14192:15040697,14193:15040678,14194:15040933,14195:15041980,14196:15042744,14197:15042979,14198:15046311,14199:15047823,14200:15048837,14201:15051660,14202:15055802,14203:15107762,14204:15108024,14205:15109043,14206:15109554,14369:15115420,14370:15116457,14371:15174077,14372:15174316,14373:15174830,14374:15179924,14375:15180207,14376:15185337,14377:15178892,14378:15237801,14379:15246987,14380:15248537,14381:15250338,14382:15252370,14383:15303075,14384:15306165,14385:15309242,14386:15311253,14387:15313043,14388:15317432,14389:15041923,14390:15044255,14391:15044275,14392:15055291,14393:15056038,14394:15120539,14395:15121040,14396:15175300,14397:15175614,14398:15185283,14399:15239351,14400:15247488,14401:15248314,14402:15309200,14403:14989710,14404:15040651,14405:15044516,14406:15045052,14407:15047610,14408:15050641,14409:15052196,14410:15054769,14411:15055531,14412:15056039,14413:15108280,14414:15111557,14415:15113903,14416:15120790,14417:15174544,14418:15184778,14419:15246004,14420:15237793,14421:15238049,14422:15241136,14423:15243662,14424:15248007,14425:15251368,14426:15304887,14427:15309703,14428:15311271,14429:15318163,14430:14989972,14431:14989970,14432:14990477,14433:15043976,14434:15045001,14435:15044798,14436:15050927,14437:15056524,14438:15056545,14439:15106719,14440:15114919,14441:15116942,14442:15176090,14443:15180417,14444:15248030,14445:15248036,14446:15248823,14447:15304336,14448:14989726,14449:15314825,14450:14989988,14451:14990780,14452:14991023,14453:15040665,14454:15040662,14455:15041929,14456:15041964,14457:15043231,14458:15043257,14459:15043518,14460:15044250,14461:15044515,14462:15044753,14625:15044750,14626:15046281,14627:15048081,14628:15048354,14629:15050173,14630:15052180,14631:15052189,14632:15052431,14633:15054757,14634:15054759,14635:15054775,14636:15055288,14637:15055491,14638:15055514,14639:15055543,14640:15056024,14641:15106450,14642:15107468,14643:15108759,14644:15109016,14645:15109799,14646:15111355,14647:15112322,14648:15112579,14649:15113140,14650:15113645,14651:15114401,14652:15114903,14653:15116171,14654:15118751,14655:15119530,14656:15119785,14657:15120559,14658:15121053,14659:15176882,14660:15178375,14661:15180204,14662:15182015,14663:15184800,14664:15185029,14665:15185048,14666:15185310,14667:15185585,14668:15237269,14669:15237251,14670:15237807,14671:15237809,14672:15238548,14673:15238799,14674:15239338,14675:15240594,14676:15245708,14677:15245729,14678:15248539,14679:15250082,14680:15250364,14681:15303562,14682:15304117,14683:15305137,14684:15179967,14685:15305660,14686:15308452,14687:15309197,14688:15310981,14689:15312537,14690:15313816,14691:15316155,14692:15042971,14693:15043243,14694:15044535,14695:15044744,14696:15049621,14697:15109047,14698:15122336,14699:15249834,14700:15252895,14701:15317689,14702:15041931,14703:15042747,14704:15045002,14705:15047613,14706:15182208,14707:15304119,14708:15316384,14709:15317906,14710:15175044,14711:15121545,14712:15238576,14713:15176849,14714:15056829,14715:15106970,14716:15313576,14717:15174555,14718:15253180,14881:15117732,14882:15310979,14883:14990218,14884:15047600,14885:15048100,14886:15049406,14887:15051162,14888:15106472,14889:15107975,14890:15112335,14891:15112326,14892:15114425,14893:15114929,14894:15120311,14895:15177621,14896:15185082,14897:15239598,14898:15314306,14899:14989979,14900:14990736,14901:15044489,14902:15045766,14903:15054255,14904:15054758,14905:15054766,14906:15114171,14907:15119001,14908:15176115,14909:15179906,14910:15247760,14911:15306390,14912:15246239,14913:15048080,14914:15055527,14915:15109291,14916:15041205,14917:15041196,14918:15042189,14919:15113344,14920:15045513,14921:15049118,14922:15050427,14923:15052464,14924:15056297,14925:15108493,14926:15109793,14927:15114429,14928:15117747,14929:15120520,14930:15172029,14931:15304583,14932:15174272,14933:15179925,14934:15179942,14935:15181229,14936:15111822,14937:15185072,14938:15241116,14939:15246209,14940:15252617,14941:15309467,14942:15042980,14943:15047848,14944:15113616,14945:15187370,14946:15250081,14947:15042228,14948:15048066,14949:15308970,14950:15048890,14951:15115914,14952:15237812,14953:15045298,14954:15053966,14955:15048636,14956:15180437,14957:15316922,14958:14990748,14959:15042954,14960:15045259,14961:15110334,14962:15112360,14963:15113364,14964:15114165,14965:15182468,14966:15183254,14967:15185058,14968:15305903,14969:15114652,14970:15314605,14971:15183033,14972:15043737,14973:15042186,14974:15042743,15137:15052703,15138:15109046,15139:15110830,15140:15111078,15141:15113389,15142:15118010,15143:15242921,15144:15309713,15145:15178384,15146:15314838,15147:15109516,15148:15305862,15149:15314603,15150:15178431,15151:15112594,15152:14989449,15153:15041176,15154:15044482,15155:15053233,15156:15106984,15157:15110802,15158:15111587,15159:15114655,15160:15173542,15161:15175562,15162:15176867,15163:15183511,15164:15186562,15165:15243925,15166:15249027,15167:15250331,15168:15304120,15169:15312016,15170:15111852,15171:15112875,15172:15117963,15173:14990229,15174:14990228,15175:14990522,15176:14990783,15177:15042746,15178:15044536,15179:15044530,15180:15046563,15181:15047579,15182:15049643,15183:15050635,15184:15050633,15185:15050687,15186:15052176,15187:15053197,15188:15054978,15189:15055019,15190:15056791,15191:15106205,15192:15109255,15193:15111343,15194:15052188,15195:15111855,15196:15111869,15197:15112104,15198:15113885,15199:15117730,15200:15117755,15201:15118479,15202:15175045,15203:15181193,15204:15181697,15205:15184824,15206:15185049,15207:15185067,15208:15237794,15209:15238274,15210:15239091,15211:15246998,15212:15247774,15213:15247785,15214:15247782,15215:15248012,15216:15248302,15217:15250311,15218:15250332,15219:15309708,15220:15311804,15221:15117743,15222:14989963,15223:14990524,15224:14990989,15225:15041936,15226:15052183,15227:15052730,15228:15107464,15229:15109249,15230:15112578,15393:15117473,15394:15121291,15395:15119035,15396:15173822,15397:15176381,15398:15177620,15399:15180673,15400:15180986,15401:15237260,15402:15237299,15403:15239082,15404:15241876,15405:15253150,15406:15118736,15407:15317439,15408:15056015,15409:15248792,15410:15316139,15411:15182778,15412:15252408,15413:15052429,15414:15309739,15415:14989443,15416:15044529,15417:15048631,15418:15049905,15419:15051657,15420:15052452,15421:15106697,15422:15120831,15423:15121542,15424:15177406,15425:15250346,15426:15052447,15427:15242368,15428:15183776,15429:15040946,15430:15114164,15431:15239837,15432:15053217,15433:15242634,15434:15186078,15435:15239310,15436:15042201,15437:15052932,15438:15109544,15439:15250854,15440:15111836,15441:15173038,15442:15180990,15443:15185047,15444:15237253,15445:15248541,15446:15252362,15447:15303086,15448:15244167,15449:15303338,15450:15040671,15451:15043514,15452:15052986,15453:15113619,15454:15172028,15455:15173813,15456:15304076,15457:15304584,15458:15305899,15459:15240101,15460:15052674,15461:15056049,15462:15107001,15463:14989499,15464:15044502,15465:15052424,15466:15108491,15467:15113393,15468:15117962,15469:15174569,15470:15175584,15471:15181998,15472:15238571,15473:15251107,15474:15304082,15475:15312534,15476:15041682,15477:15044503,15478:15045034,15479:15052735,15480:15109768,15481:15116473,15482:15185580,15483:15309952,15484:15047578,15485:15044494,15486:15045032,15649:15052439,15650:15052977,15651:15054750,15652:14991278,15653:15107201,15654:15109054,15655:15119538,15656:15181696,15657:15181707,15658:15185282,15659:15186317,15660:15187858,15661:15239085,15662:15239327,15663:15241872,15664:15245702,15665:15246770,15666:15249040,15667:15251892,15668:15252655,15669:15302833,15670:15304075,15671:15304108,15672:15309702,15673:15304348,15674:14990208,15675:14990735,15676:15041925,15677:15043969,15678:15056531,15679:15108238,15680:15114132,15681:15118721,15682:15120523,15683:15175075,15684:15186086,15685:15304589,15686:15305347,15687:15044500,15688:15049881,15689:15052479,15690:15120273,15691:15181213,15692:15186094,15693:15184539,15694:15049150,15695:15173279,15696:15042490,15697:15245715,15698:15253424,15699:14991242,15700:15053755,15701:15112357,15702:15179436,15703:15182755,15704:15239324,15705:15312831,15706:15042438,15707:15056554,15708:15112108,15709:15115695,15710:15117961,15711:15120307,15712:15121046,15713:15121828,15714:15178686,15715:15185044,15716:15054753,15717:15303093,15718:15304327,15719:15310982,15720:15042470,15721:15042717,15722:15108480,15723:15112849,15724:15113113,15725:15120538,15726:15055542,15727:15185810,15728:15187378,15729:15113144,15730:15242927,15731:15243191,15732:15248312,15733:15043241,15734:15044505,15735:15050163,15736:15055503,15737:15056528,15738:15106453,15739:15305636,15740:15309220,15741:15041207,15742:15041695,15905:15043485,15906:15043744,15907:15043975,15908:15044524,15909:15045544,15910:15046022,15911:15045809,15912:15046807,15913:15050152,15914:15050430,15915:15050940,15916:15052469,15917:15052934,15918:15052943,15919:15052945,15920:15052954,15921:15055492,15922:15055498,15923:15055776,15924:15056304,15925:15108543,15926:15108740,15927:15109019,15928:15109772,15929:15109559,15930:15112327,15931:15112332,15932:15112365,15933:15112630,15934:15113662,15935:15114914,15936:15116447,15937:15116469,15938:15119036,15939:15120008,15940:15120521,15941:15120792,15942:15172796,15943:15172774,15944:15173031,15945:15177607,15946:15178881,15947:15180189,15948:15180929,15949:15181221,15950:15181744,15951:15182752,15952:15182993,15953:15184551,15954:15185081,15955:15237782,15956:15241110,15957:15241867,15958:15242633,15959:15245725,15960:15246259,15961:15247519,15962:15247548,15963:15247764,15964:15247795,15965:15249825,15966:15250334,15967:15304356,15968:15305126,15969:15306174,15970:15306904,15971:15309468,15972:15310488,15973:14989450,15974:14989448,15975:14989470,15976:14989719,15977:15042199,15978:15042992,15979:15048590,15980:15048884,15981:15049612,15982:15051938,15983:15055032,15984:15106949,15985:15111102,15986:15113633,15987:15113622,15988:15119748,15989:15174326,15990:15177139,15991:15182243,15992:15241912,15993:15248818,15994:15304376,15995:15305888,15996:15046833,15997:15048628,15998:15311806,16161:15109037,16162:15115405,16163:15117974,16164:15173549,16165:15186324,16166:15237559,16167:15239602,16168:15247270,16169:15311775,16170:15244693,16171:15253169,16172:15052987,16173:14990520,16174:14991265,16175:14991029,16176:15045767,16177:15050912,16178:15052701,16179:15052713,16180:15056771,16181:15107470,16182:15109295,16183:15111856,16184:15112587,16185:15115182,16186:15115931,16187:15119800,16188:15120305,16189:15176883,16190:15177401,16191:15178911,16192:15181214,16193:15181734,16194:15185075,16195:15239075,16196:15239855,16197:15242922,16198:15247018,16199:15247546,16200:15252139,16201:15253147,16202:15302834,16203:15304605,16204:15309959,16205:14990010,16206:14990209,16207:15042691,16208:15049141,16209:15049644,16210:15052939,16211:15176858,16212:15052989,16213:15238542,16214:15247498,16215:15253381,16216:15309219,16217:15310253,16218:15183013,16219:15248271,16220:15310984,16221:15304098,16222:15047603,16223:15044264,16224:15302807,16225:15044793,16226:15048322,16227:15055013,16228:15109800,16229:15118516,16230:15172234,16231:15179169,16232:15184523,16233:15187872,16234:15245744,16235:15303042,16236:15304084,16237:15305872,16238:15305880,16239:15309455,16240:15176094,16241:15313796,16242:15053959,16243:15054249,16244:15111600,16245:15113890,16246:15251112,16247:15309723,16248:15109550,16249:15113609,16250:15115417,16251:15241093,16252:15310999,16253:15309696,16254:15246270,16417:15122052,16418:15110586,16419:15052728,16420:14989462,16421:15171756,16422:15177117,16423:15112367,16424:15042436,16425:15042742,16426:15043490,16427:15050643,16428:15056513,16429:15106215,16430:15108240,16431:15111359,16432:15111604,16433:15112351,16434:15112628,16435:15115186,16436:15114390,16437:15117731,16438:15120517,16439:15174066,16440:15176863,16441:15178651,16442:15184574,16443:15237526,16444:15049648,16445:15246269,16446:15246783,16447:15248032,16448:15248019,16449:15248267,16450:15302813,16451:15304338,16452:15310226,16453:15310233,16454:15111817,16455:15181966,16456:15238278,16457:15309499,16458:15055021,16459:15106972,16460:15108250,16461:15111845,16462:15112340,16463:15113872,16464:15179699,16465:15182221,16466:15184269,16467:15186110,16468:15238282,16469:15250092,16470:15250852,16471:15251361,16472:15251871,16473:15180457,16474:15042695,16475:15109017,16476:15109797,16477:15110530,16478:15108760,16479:15247533,16480:15182467,16481:15183744,16482:15248044,16483:15309738,16484:15185334,16485:15239308,16486:15244681,16487:14990233,16488:15041928,16489:15043971,16490:15044e3,16491:15052451,16492:15052930,16493:15052950,16494:15054749,16495:15108262,16496:15108487,16497:15110832,16498:15114387,16499:15114420,16500:15119241,16501:15119749,16502:15119511,16503:15114131,16504:15121820,16505:15173006,16506:15173053,16507:15112075,16508:15182271,16509:15183533,16510:15185818,16673:15186314,16674:15187624,16675:15238586,16676:15239323,16677:15239353,16678:15242918,16679:15247790,16680:15250318,16681:15251381,16682:15303096,16683:15303095,16684:15305389,16685:15305361,16686:15308419,16687:15314606,16688:15042957,16689:15046276,16690:15121592,16691:15172790,16692:15041960,16693:15181445,16694:15186325,16695:15238835,16696:15184782,16697:15047052,16698:15049105,16699:15053480,16700:15109802,16701:15113150,16702:15113149,16703:15115674,16704:15174553,16705:15177359,16706:15177358,16707:15180942,16708:15181206,16709:15181727,16710:15184535,16711:15185056,16712:15185284,16713:15243399,16714:15247540,16715:15308987,16716:15303073,16717:15318176,16718:15041447,16719:15042997,16720:15044492,16721:15044514,16722:15040649,16723:15046314,16724:15049646,16725:15050127,16726:15173821,16727:15052427,16728:15053220,16729:15043741,16730:15106979,16731:15106995,16732:15109532,16733:15109763,16734:15109311,16735:15109819,16736:15111053,16737:15112105,16738:15113145,16739:15054755,16740:15116173,16741:15116221,16742:15121557,16743:15173541,16744:14989961,16745:15177641,16746:15178680,16747:15182483,16748:15184799,16749:15185807,16750:15185564,16751:15237537,16752:15240585,16753:15240600,16754:15241644,16755:15241916,16756:15243195,16757:15246213,16758:15250864,16759:15302785,16760:15303085,16761:15306391,16762:15309980,16763:15313042,16764:15041423,16765:15049367,16766:15107726,16929:15239059,16930:15242421,16931:15250568,16932:15302816,16933:14991235,16934:15040948,16935:15042951,16936:15044019,16937:15106479,16938:15109513,16939:15113631,16940:15120556,16941:15251123,16942:15302815,16943:14991255,16944:15053214,16945:15250314,16946:15112079,16947:15185562,16948:15043986,16949:15245974,16950:15041974,16951:15110019,16952:15052184,16953:15052203,16954:15052938,16955:15110285,16956:15113617,16957:15303068,16958:14990230,16959:15049882,16960:15049898,16961:15118768,16962:15247761,16963:15045822,16964:15048853,16965:15050405,16966:15106992,16967:15108499,16968:15114113,16969:15239349,16970:15115669,16971:15309184,16972:15312772,16973:15313064,16974:14990739,16975:15048838,16976:15052734,16977:15237264,16978:15053489,16979:15055023,16980:15056517,16981:15106208,16982:15107467,16983:15108276,16984:15113151,16985:15119280,16986:15121310,16987:15238030,16988:15238591,16989:15240084,16990:15245963,16991:15250104,16992:15302784,16993:15302830,16994:15309450,16995:15317915,16996:15314843,16997:14990243,16998:15044528,16999:15049895,17e3:15183020,17001:15304333,17002:15311244,17003:15316921,17004:15121309,17005:15171751,17006:15043987,17007:15046020,17008:15052421,17009:15108504,17010:15108766,17011:15109011,17012:15119010,17013:15122351,17014:15175842,17015:15247511,17016:15306936,17017:15122305,17018:15248318,17019:15240376,17020:15042471,17021:15244216,17022:15044522,17185:15044521,17186:14990726,17187:15303060,17188:15253168,17189:15050154,17190:15238321,17191:15054781,17192:15182762,17193:15253183,17194:15115162,17195:15249591,17196:15174584,17197:15315336,17198:15116477,17199:15248048,17200:14989497,17201:15043992,17202:15046790,17203:15048102,17204:15108997,17205:15109794,17206:15112102,17207:15117710,17208:15120289,17209:15120795,17210:15172269,17211:15179693,17212:15182767,17213:15183530,17214:15185595,17215:15237309,17216:15238022,17217:15244171,17218:15248021,17219:15306139,17220:15047587,17221:15049607,17222:15056062,17223:15111853,17224:15112854,17225:15116928,17226:15118005,17227:15176887,17228:15248263,17229:15040676,17230:15179685,17231:15047856,17232:15056027,17233:15106469,17234:15112634,17235:15118752,17236:15177652,17237:15181978,17238:15187374,17239:15239092,17240:15244440,17241:15303045,17242:15312563,17243:15183753,17244:15177116,17245:15182777,17246:15183249,17247:15242116,17248:15302800,17249:15181737,17250:15182482,17251:15240374,17252:15051681,17253:15179136,17254:14989485,17255:14990258,17256:15052441,17257:15056800,17258:15108797,17259:15112380,17260:15114161,17261:15119272,17262:15243691,17263:15245751,17264:15247547,17265:15304078,17266:15305651,17267:15312784,17268:15116439,17269:15171750,17270:15174826,17271:15240103,17272:15241623,17273:15250095,17274:14989441,17275:15041926,17276:15042443,17277:15046283,17278:15052725,17441:15054998,17442:15055027,17443:15055489,17444:15056020,17445:15056053,17446:15056299,17447:15056564,17448:15108018,17449:15109265,17450:15112866,17451:15113373,17452:15121838,17453:15174034,17454:15176890,17455:15178938,17456:15237556,17457:15238329,17458:15238584,17459:15244726,17460:15248063,17461:15248284,17462:15251077,17463:15251379,17464:15305370,17465:15308215,17466:15310978,17467:15315877,17468:15043461,17469:15109527,17470:15178676,17471:15113365,17472:15118984,17473:15175565,17474:15250307,17475:15306414,17476:15309235,17477:15119525,17478:15049372,17479:15115406,17480:15116172,17481:15253437,17482:15306394,17483:15177627,17484:15302810,17485:15049114,17486:15114370,17487:15109812,17488:15116219,17489:14990723,17490:15121580,17491:15114136,17492:15253179,17493:15242406,17494:15185588,17495:15306132,17496:15115455,17497:15121840,17498:15048106,17499:15049655,17500:15051948,17501:15185068,17502:15173802,17503:15044746,17504:15304611,17505:15316660,17506:14989997,17507:14990734,17508:15040924,17509:15040949,17510:15042947,17511:15250078,17512:15045e3,17513:15048868,17514:15052442,17515:15055005,17516:15055509,17517:15055533,17518:15055799,17519:15056031,17520:15106700,17521:15108789,17522:15109306,17523:15110032,17524:15114927,17525:15118720,17526:15180423,17527:15181454,17528:15181963,17529:15185824,17530:15239559,17531:15247490,17532:15248294,17533:15251844,17534:15302803,17697:15303352,17698:15303853,17699:15304600,17700:15318158,17701:15119269,17702:15110552,17703:15111074,17704:15111605,17705:15121332,17706:15178372,17707:15183003,17708:15303081,17709:15306641,17710:15121082,17711:15045554,17712:15056569,17713:15110820,17714:15252877,17715:15253421,17716:15305092,17717:15041976,17718:15049131,17719:15049897,17720:15053205,17721:15055511,17722:15120315,17723:15186575,17724:15176860,17725:15250108,17726:15252386,17727:15311259,17728:15172281,17729:14990493,17730:15118015,17731:15122097,17732:15176880,17733:15309755,17734:15041934,17735:15044752,17736:15048885,17737:15049111,17738:15050412,17739:15053216,17740:15056530,17741:15111831,17742:15113628,17743:15120545,17744:15178171,17745:15241119,17746:15250349,17747:15302804,17748:15303613,17749:15306125,17750:15179941,17751:15179962,17752:15043242,17753:15055526,17754:15047839,17755:15050164,17756:15106194,17757:15040658,17758:15041946,17759:15042220,17760:15042445,17761:15042688,17762:15045776,17763:15049108,17764:15049112,17765:15050135,17766:15052437,17767:15053750,17768:15054475,17769:15106748,17770:15108757,17771:15110317,17772:15113649,17773:15114627,17774:15114940,17775:15115167,17776:15178647,17777:15120280,17778:15120815,17779:15120027,17780:15172015,17781:15173512,17782:15056275,17783:15177624,17784:15181239,17785:15183241,17786:15183252,17787:15183250,17788:15184790,17789:15185329,17790:15042736,17953:15241635,17954:15242665,17955:15243172,17956:15247502,17957:15248516,17958:15249798,17959:15251599,17960:15302787,17961:15302799,17962:15306905,17963:15309238,17964:15311021,17965:15313072,17966:15308696,17967:15041421,17968:15043477,17969:15044748,17970:15048834,17971:15052942,17972:15107751,17973:15110814,17974:15119518,17975:15179443,17976:15182757,17977:15238068,17978:15241348,17979:15303059,17980:15305349,17981:15053728,17982:15316103,17983:15043775,17984:15056535,17985:15056563,17986:15120028,17987:15174073,17988:15179171,17989:15181503,17990:15183780,17991:15118226,17992:15174572,17993:15248045,17994:15114371,17995:15116705,17996:15042488,17997:15182465,17998:15115444,17999:15053194,18e3:15315894,18001:15240107,18002:15052677,18003:15304073,18004:15171742,18005:15047096,18006:15053231,18007:15106951,18008:15111590,18009:15118988,18010:15249818,18011:15303041,18012:15310995,18013:15045009,18014:15113095,18015:15304845,18016:15050120,18017:15303331,18018:15042181,18019:14989709,18020:15042474,18021:15242905,18022:15248526,18023:15171992,18024:15109562,18025:15306123,18026:15115682,18027:15312564,18028:15186052,18029:15177143,18030:15043991,18031:15115680,18032:15252383,18033:15309731,18034:15118749,18035:14989964,18036:15052988,18037:15056016,18038:15253417,18039:15043714,18040:15250321,18041:15237769,18042:15243705,18043:15055807,18044:15112101,18045:14989747,18046:15041957,18209:15050370,18210:15052991,18211:15310766,18212:14990267,18213:15050378,18214:15056781,18215:15248013,18216:15122337,18217:15181488,18218:15181218,18219:15052711,18220:15241649,18221:15174827,18222:15173297,18223:15055284,18224:15056821,18225:15109563,18226:15110810,18227:15173507,18228:15184536,18229:14989699,18230:15055804,18231:14989707,18232:15048604,18233:15047330,18234:15106729,18235:15122307,18236:15185037,18237:15238077,18238:15238323,18239:15238847,18240:15253170,18241:15246999,18242:15243940,18243:15054772,18244:15108746,18245:15110829,18246:15246983,18247:15113655,18248:15119266,18249:15119550,18250:15175862,18251:15179956,18252:15051142,18253:15187381,18254:15239853,18255:15312556,18256:14991283,18257:15055747,18258:15109021,18259:15109778,18260:15111575,18261:15113647,18262:15178627,18263:15174028,18264:15238028,18265:15237818,18266:15252649,18267:15304077,18268:15040653,18269:15048633,18270:15051410,18271:15114885,18272:15115699,18273:15173028,18274:15174589,18275:15250103,18276:15049650,18277:15250336,18278:15309226,18279:15302809,18280:15244735,18281:15181732,18282:15179687,18283:15241385,18284:14990511,18285:15042981,18286:15043994,18287:15109005,18288:15114127,18289:15119242,18290:15178173,18291:15183508,18292:15184533,18293:15239350,18294:15242884,18295:15253419,18296:15113117,18297:15121568,18298:15173766,18299:15186075,18300:15240875,18301:15312769,18302:15317670,18465:15042493,18466:15183537,18467:15180210,18468:15183544,18469:15237767,18470:15183240,18471:15117224,18472:15055265,18473:15237772,18474:15177105,18475:15177120,18476:15041963,18477:15305122,18478:15121036,18479:15178170,18480:15304343,18481:15313834,18482:14990480,18483:15187376,18484:15108764,18485:15183247,18486:15308453,18487:15315881,18488:15047098,18489:15049113,18490:15244196,18491:15309500,18492:14990516,18493:15042724,18494:15043978,18495:15044493,18496:15044507,18497:15054982,18498:15110316,18499:15111825,18500:15113663,18501:15118526,18502:15118734,18503:15174024,18504:15174319,18505:15175597,18506:15177108,18507:15186305,18508:15239340,18509:15243177,18510:15250089,18511:15183748,18512:15304582,18513:15173033,18514:15310994,18515:15311791,18516:15109309,18517:15112617,18518:15177130,18519:15178660,18520:15180688,18521:15242627,18522:15244206,18523:15043754,18524:15043985,18525:15044774,18526:15050371,18527:15055495,18528:15056316,18529:15106738,18530:15108489,18531:15108537,18532:15108779,18533:15111824,18534:15118228,18535:15119244,18536:15177394,18537:15178414,18538:15180433,18539:15181720,18540:15185803,18541:15187383,18542:15237797,18543:15245995,18544:15248057,18545:15250107,18546:15303103,18547:15310238,18548:15311771,18549:15116427,18550:15184056,18551:15041177,18552:15052990,18553:15056558,18554:15113863,18555:15118232,18556:15175861,18557:15178889,18558:15187598,18721:15318203,18722:15114122,18723:15181975,18724:15043769,18725:15177355,18726:15313837,18727:15056294,18728:15238813,18729:15241137,18730:15237784,18731:15056060,18732:15056773,18733:15177122,18734:15183238,18735:15302844,18736:15114663,18737:15050667,18738:15051419,18739:15185040,18740:15178174,18741:15248556,18742:14991285,18743:15056298,18744:15116441,18745:15118519,18746:15121538,18747:15176610,18748:15181224,18749:15245736,18750:15247765,18751:15249849,18752:15055775,18753:15110031,18754:15177605,18755:15181714,18756:15240087,18757:15305896,18758:15305650,18759:15241884,18760:15244205,18761:15315117,18762:15045505,18763:15056300,18764:15111820,18765:15119772,18766:15171733,18767:15250087,18768:15250323,18769:15311035,18770:15111567,18771:15176630,18772:14989453,18773:14990232,18774:15048608,18775:15049899,18776:15051174,18777:15052684,18778:15042216,18779:15054979,18780:15055516,18781:15106198,18782:15108534,18783:15111607,18784:15111847,18785:15112622,18786:15119790,18787:15173814,18788:15183014,18789:15238544,18790:15238810,18791:15239833,18792:15248796,18793:15250080,18794:15250342,18795:15250868,18796:15308956,18797:15309188,18798:14991022,18799:15110827,18800:15117734,18801:15239326,18802:15241633,18803:15242666,18804:15303592,18805:15052929,18806:15115667,18807:15311528,18808:15241658,18809:15242647,18810:14990479,18811:15042991,18812:15056553,18813:15055237,18814:15113357,18977:15181455,18978:15238585,18979:15246471,18980:15246982,18981:15120309,18982:15056023,18983:15108501,18984:15119032,18985:14990223,18986:15174057,18987:15314578,18988:15042694,18989:15044795,18990:15047092,18991:15049395,18992:15107748,18993:15108526,18994:15172762,18995:15050158,18996:15184521,18997:15184798,18998:15185051,18999:15309744,19e3:15111815,19001:15237534,19002:14989465,19003:14990773,19004:15041973,19005:15049088,19006:15055267,19007:15055283,19008:15056010,19009:15114116,19010:14989478,19011:15242429,19012:15308425,19013:15309211,19014:15184307,19015:15310977,19016:15041467,19017:15049601,19018:15178134,19019:15180455,19020:15042725,19021:15179429,19022:15242385,19023:15183494,19024:15040911,19025:15049865,19026:15174023,19027:15183751,19028:15185832,19029:15253178,19030:15253396,19031:15303053,19032:14991039,19033:15043465,19034:15050921,19035:15056001,19036:15310509,19037:14991261,19038:15239319,19039:15305642,19040:15047811,19041:15109525,19042:15117737,19043:15176875,19044:15246236,19045:15252628,19046:15182210,19047:15043487,19048:15049363,19049:15107477,19050:15108234,19051:15112878,19052:15118221,19053:15184063,19054:15241129,19055:15040675,19056:14991288,19057:15043717,19058:15044998,19059:15048881,19060:15050121,19061:15052445,19062:15053744,19063:15053743,19064:15053993,19065:15055510,19066:15108785,19067:15109543,19068:15111358,19069:15111865,19070:15113355,19233:15119253,19234:15119265,19235:15172537,19236:15179954,19237:15186091,19238:15238046,19239:15239859,19240:15241356,19241:15242156,19242:15244418,19243:15246482,19244:15247530,19245:15249802,19246:15303334,19247:15305618,19248:15311805,19249:15315891,19250:15316396,19251:14989711,19252:14989985,19253:15041165,19254:15042966,19255:15048074,19256:15050408,19257:15055037,19258:15056792,19259:15056793,19260:15108287,19261:15112884,19262:15113371,19263:15114128,19264:15115154,19265:15042194,19266:15185057,19267:15237802,19268:15238824,19269:15248512,19270:15250060,19271:15250111,19272:15305150,19273:15308978,19274:15044768,19275:15311020,19276:15043735,19277:15041429,19278:15043996,19279:15049384,19280:15110834,19281:15113396,19282:15174055,19283:15179174,19284:15182214,19285:15304614,19286:15043459,19287:15119009,19288:15117958,19289:15048832,19290:15055244,19291:15050132,19292:15113388,19293:15187899,19294:15042465,19295:15178630,19296:15110569,19297:15180712,19298:15314324,19299:15317691,19300:15048587,19301:15050425,19302:15112359,19303:15113882,19304:15118222,19305:15045545,19306:15116185,19307:15055253,19308:15238812,19309:15113877,19310:15314602,19311:15114174,19312:15315346,19313:15114653,19314:14989990,19315:14991267,19316:15044488,19317:15108793,19318:15113387,19319:15119019,19320:15253380,19321:14991021,19322:15186349,19323:15317695,19324:14989447,19325:15107490,19326:15121024,19489:15121579,19490:15242387,19491:15045043,19492:15113386,19493:15314309,19494:15054771,19495:15183509,19496:15053484,19497:15052678,19498:15244444,19499:15120778,19500:15242129,19501:15181972,19502:15238280,19503:15050393,19504:15184525,19505:15118481,19506:15178912,19507:15043481,19508:15049890,19509:15172769,19510:15174047,19511:15179675,19512:15309991,19513:15316385,19514:15115403,19515:15051199,19516:15050904,19517:15042213,19518:15044749,19519:15045053,19520:15112334,19521:15178655,19522:15253431,19523:15305368,19524:15315892,19525:15050666,19526:15174045,19527:15121285,19528:15041933,19529:15115145,19530:15185599,19531:15185836,19532:15310242,19533:15317690,19534:15110584,19535:15116449,19536:15240322,19537:15050372,19538:15052191,19539:15118235,19540:15174811,19541:15178674,19542:15185586,19543:15237271,19544:15241881,19545:15041714,19546:15113384,19547:15317913,19548:15178670,19549:15113634,19550:15043519,19551:15312005,19552:15052964,19553:15108283,19554:15184318,19555:15250096,19556:15046031,19557:15106742,19558:15185035,19559:15308416,19560:15043713,19561:14989727,19562:15042230,19563:15049884,19564:15173818,19565:15237302,19566:15304590,19567:15056037,19568:15179682,19569:15044228,19570:15056313,19571:15185028,19572:15242924,19573:15247539,19574:15252109,19575:15310230,19576:15114163,19577:15242926,19578:15307155,19579:15107209,19580:15107208,19581:15119033,19582:15178130,19745:15248301,19746:15252664,19747:15045807,19748:14990737,19749:15041706,19750:15043463,19751:15044491,19752:15052453,19753:15055293,19754:15106720,19755:15107714,19756:15110038,19757:15113353,19758:15114138,19759:15120807,19760:15120012,19761:15174838,19762:15174839,19763:15176881,19764:15181200,19765:15246229,19766:15248024,19767:15303050,19768:15303313,19769:15303605,19770:15309700,19771:15244941,19772:15049877,19773:14989960,19774:14990745,19775:14989454,19776:15248009,19777:15252671,19778:15310992,19779:15041197,19780:15055292,19781:15050390,19782:15052473,19783:15055544,19784:15110042,19785:15110074,19786:15111041,19787:15113116,19788:15115658,19789:15116184,19790:15119499,19791:15121078,19792:15173268,19793:15176872,19794:15182511,19795:15187594,19796:15237248,19797:15241609,19798:15242121,19799:15246977,19800:15248545,19801:15251594,19802:15303077,19803:15309245,19804:15312010,19805:15107518,19806:15108753,19807:15117490,19808:15118979,19809:15119796,19810:15187852,19811:15187900,19812:15120256,19813:15187589,19814:15244986,19815:15246264,19816:15113637,19817:15240881,19818:15311036,19819:15309751,19820:15119515,19821:15185313,19822:15241405,19823:15304106,19824:14989745,19825:15044021,19826:15054224,19827:15117444,19828:15122347,19829:15243149,19830:15243437,19831:15247015,19832:15042729,19833:15044751,19834:15053221,19835:15113614,19836:15114920,19837:15175814,19838:15176323,20001:15177634,20002:15246223,20003:15246241,20004:15304588,20005:15309730,20006:15309240,20007:15056523,20008:15175303,20009:15182731,20010:15241614,20011:15109792,20012:15177125,20013:15043209,20014:15119745,20015:15121052,20016:15175817,20017:15177113,20018:15180203,20019:15184530,20020:15309446,20021:15182748,20022:15318669,20023:14991030,20024:15107502,20025:15112069,20026:15243676,20027:14989958,20028:14989998,20029:15041434,20030:14989473,20031:15042444,20032:15052718,20033:15111833,20034:15114881,20035:15120060,20036:15174815,20037:15178114,20038:15179437,20039:15181980,20040:15184807,20041:15239599,20042:15248274,20043:15303100,20044:15304591,20045:15309237,20046:15311e3,20047:15043227,20048:15185809,20049:15040683,20050:15044248,20051:15113879,20052:15120267,20053:15173520,20054:15175859,20055:15239080,20056:15252650,20057:15309475,20058:15315351,20059:15317663,20060:15176096,20061:15049089,20062:15120025,20063:15185071,20064:15311262,20065:14990244,20066:14990518,20067:14990987,20068:15042231,20069:15043249,20070:15054522,20071:15106204,20072:15175346,20073:15180988,20074:15240083,20075:15304884,20076:15309495,20077:15309750,20078:15309962,20079:15317655,20080:15318434,20081:15112870,20082:15117748,20083:15042711,20084:15043235,20085:15172488,20086:15246210,20087:15055753,20088:15106443,20089:15107728,20090:15121571,20091:15173001,20092:15184062,20093:15185844,20094:15237551,20257:15242158,20258:15302819,20259:15305900,20260:15044994,20261:15314351,20262:15117203,20263:15172233,20264:15250306,20265:15251375,20266:15310002,20267:15043252,20268:15051137,20269:15055754,20270:15056004,20271:15113367,20272:15115708,20273:15115924,20274:15119786,20275:15121551,20276:15174050,20277:15174588,20278:15183789,20279:15237249,20280:15237566,20281:15244683,20282:15303566,20283:15041965,20284:15317651,20285:15181444,20286:15237771,20287:15305906,20288:15248278,20289:15040685,20290:15045260,20291:15247793,20292:15117738,20293:15250308,20294:15238279,20295:15106961,20296:15113888,20297:15316914,20298:14989977,20299:14989976,20300:15315088,20301:15247787,20302:15243137,20303:15242664,20304:15115392,20305:15120830,20306:15180439,20307:15238549,20513:15056012,20514:14989456,20515:14989461,20516:14989482,20517:14989489,20518:14989494,20519:14989500,20520:14989503,20521:14989698,20522:14989718,20523:14989720,20524:14989954,20525:14989957,20526:15249835,20527:14989962,20528:15239314,20529:15056013,20530:14989966,20531:14989982,20532:14989983,20533:14989984,20534:14989986,20535:1499e4,20536:14990003,20537:14990006,20538:14990222,20539:14990221,20540:14990212,20541:14990214,20542:14990210,20543:14990231,20544:14990238,20545:14990253,20546:14990239,20547:14990263,20548:14990473,20549:14990746,20550:14990512,20551:14990747,20552:14990749,20553:14990743,20554:14990727,20555:14990774,20556:14990984,20557:14990991,20558:14991e3,20559:14990779,20560:14990761,20561:14990768,20562:14990993,20563:14990767,20564:14990982,20565:14990998,20566:15041688,20567:14991252,20568:14991263,20569:14991246,20570:14991256,20571:14991259,20572:14991249,20573:14991258,20574:14991248,20575:14991268,20576:14991269,20577:15040666,20578:15040680,20579:15040660,20580:15040682,20581:15040677,20582:15040645,20583:14990492,20584:14991286,20585:15040673,20586:15040681,20587:15040684,20588:14991294,20589:14991279,20590:15040657,20591:15040646,20592:15040899,20593:15040903,20594:15113347,20595:15040917,20596:15040912,20597:15040904,20598:15040922,20599:15040918,20600:15040940,20601:15040952,20602:15041152,20603:15041178,20604:15041157,20605:15041204,20606:15041202,20769:15041417,20770:15041418,20771:15041203,20772:15041410,20773:15041430,20774:15041438,20775:15041445,20776:15041453,20777:15041443,20778:15041454,20779:15041465,20780:15041461,20781:15041673,20782:15041665,20783:15041666,20784:15041686,20785:15041685,20786:15041684,20787:15041690,20788:15041697,20789:15041722,20790:15041719,20791:15041724,20792:15041723,20793:15041727,20794:15041920,20795:15041938,20796:15041932,20797:15041940,20798:15041954,20799:15182776,20800:15041961,20801:15041962,20802:15041966,20803:15042176,20804:15042178,20805:15047576,20806:15042188,20807:15042185,20808:15042191,20809:15042193,20810:15042195,20811:15042197,20812:15042198,20813:15042212,20814:15042214,20815:15042210,20816:15042217,20817:15042218,20818:15042219,20819:15042227,20820:15042225,20821:15042226,20822:15042224,20823:15042229,20824:15042237,20825:15042437,20826:15042441,20827:15042459,20828:15042464,20829:15243669,20830:15042473,20831:15042477,20832:15042480,20833:15042485,20834:15042494,20835:15042692,20836:15042699,20837:15042708,20838:15042702,20839:15042727,20840:15042730,20841:15042734,20842:15042739,20843:15042745,20844:15042959,20845:15042948,20846:15042955,20847:15042956,20848:15042974,20849:15042964,20850:15042986,20851:15042996,20852:15042985,20853:15042995,20854:15043007,20855:15043005,20856:15043213,20857:15043220,20858:15043218,20859:15042993,20860:15043208,20861:15043217,20862:15253160,21025:15253159,21026:15043244,21027:15043245,21028:15043260,21029:15043253,21030:15043457,21031:15043469,21032:15043479,21033:15043486,21034:15043491,21035:15043494,21036:15311789,21037:15043488,21038:15043507,21039:15043509,21040:15043512,21041:15043513,21042:15043718,21043:15043720,21044:15176888,21045:15043725,21046:15043728,21047:15043727,21048:15043733,21049:15043738,21050:15043747,21051:15043759,21052:15043761,21053:15043763,21054:15043768,21055:15043968,21056:15043974,21057:15043973,21058:14989463,21059:15043977,21060:15043981,21061:15042454,21062:15043998,21063:15044009,21064:15044014,21065:15049880,21066:15044027,21067:15044023,21068:15044226,21069:15044246,21070:15044256,21071:15044262,21072:15044261,21073:15044270,21074:15044272,21075:15044278,21076:15044483,21077:15184018,21078:15309721,21079:15044511,21080:15113148,21081:15173550,21082:15044526,21083:15044520,21084:15044525,21085:15044538,21086:15044737,21087:15044797,21088:15044992,21089:15044780,21090:15044781,21091:15044796,21092:15044782,21093:15044790,21094:15044777,21095:15044765,21096:15045006,21097:15045263,21098:15045045,21099:15045262,21100:15045023,21101:15045041,21102:15045047,21103:15045040,21104:15045266,21105:15045051,21106:15045248,21107:15045046,21108:15045252,21109:15045264,21110:15045254,21111:15045511,21112:15045282,21113:15045304,21114:15045285,21115:15045292,21116:15045508,21117:15045512,21118:15045288,21281:15045291,21282:15045506,21283:15045284,21284:15045310,21285:15045308,21286:15045528,21287:15045541,21288:15045542,21289:15045775,21290:15045780,21291:15045565,21292:15045550,21293:15045549,21294:15045562,21295:15045538,21296:15045817,21297:15046016,21298:15046051,21299:15046028,21300:15045806,21301:15046044,21302:15046021,21303:15046038,21304:15046039,21305:15045816,21306:15045811,21307:15046045,21308:15046297,21309:15046272,21310:15045295,21311:15046282,21312:15046303,21313:15046075,21314:15046078,21315:15046296,21316:15046302,21317:15046318,21318:15046076,21319:15046275,21320:15046313,21321:15046279,21322:15046312,21323:15046554,21324:15046533,21325:15046559,21326:15046532,21327:15046556,21328:15046564,21329:15046548,21330:15046804,21331:15046583,21332:15046806,21333:15046590,21334:15046589,21335:15046811,21336:15046585,21337:15047054,21338:15047056,21339:15173535,21340:15046836,21341:15046838,21342:15046834,21343:15046840,21344:15047083,21345:15047076,21346:15046831,21347:15047084,21348:15047082,21349:15047302,21350:15047296,21351:15047306,21352:15047328,21353:15047316,21354:15047311,21355:15047333,21356:15047342,21357:15047350,21358:15047348,21359:15047554,21360:15047356,21361:15047553,21362:15047555,21363:15047552,21364:15047560,21365:15047566,21366:15047569,21367:15047571,21368:15047575,21369:15047598,21370:15047609,21371:15047808,21372:15047615,21373:15047812,21374:15047817,21537:15047816,21538:15047819,21539:15047821,21540:15047827,21541:15047832,21542:15047830,21543:15046535,21544:15047836,21545:15047846,21546:15047863,21547:15047864,21548:15048078,21549:15047867,21550:15048064,21551:15048079,21552:15048105,21553:15048576,21554:15048328,21555:15048097,21556:15048127,21557:15048329,21558:15048339,21559:15048352,21560:15048371,21561:15048356,21562:15048362,21563:15048368,21564:15048579,21565:15048582,21566:15048596,21567:15048594,21568:15048595,21569:15048842,21570:15048598,21571:15048611,21572:15048843,21573:15048857,21574:15048861,21575:15049138,21576:15048865,21577:15049122,21578:15049099,21579:15049136,21580:15118208,21581:15049106,21582:15048893,21583:15049145,21584:15049349,21585:15049401,21586:15049375,21587:15049387,21588:15049402,21589:15049630,21590:15049403,21591:15049400,21592:15049390,21593:15049605,21594:15049619,21595:15049617,21596:15049623,21597:15049625,21598:15049624,21599:15049637,21600:15049628,21601:15049636,21602:15049631,21603:15049647,21604:15049658,21605:15049657,21606:15049659,21607:15049660,21608:15049661,21609:15049858,21610:15049866,21611:15049872,21612:15049883,21613:15114918,21614:15049893,21615:15049900,21616:15049901,21617:15049906,21618:15049912,21619:15049918,21620:15182738,21621:15050133,21622:15050128,21623:15050126,21624:15050138,21625:15050136,21626:15050146,21627:15050144,21628:15050151,21629:15050156,21630:15050153,21793:15050168,21794:15050369,21795:15050397,21796:14990750,21797:14991019,21798:15050403,21799:15050418,21800:15050630,21801:15050664,21802:15050652,21803:15050381,21804:15050649,21805:15050650,21806:15050917,21807:15050911,21808:15050897,21809:15050908,21810:15050889,21811:15050906,21812:15051136,21813:15051180,21814:15051145,21815:15050933,21816:15050934,21817:15051170,21818:15051178,21819:15051418,21820:15051452,21821:15051454,21822:15051659,21823:15051650,21824:15051453,21825:15051683,21826:15051671,21827:15051686,21828:15051689,21829:15051670,21830:15051706,21831:15051707,21832:15051916,21833:15051915,21834:15051926,21835:15051954,21836:15051664,21837:15051946,21838:15051958,21839:15051966,21840:15052163,21841:15052165,21842:15052160,21843:15052177,21844:15052181,21845:15052186,21846:15052187,21847:15052197,21848:15052201,21849:15052208,21850:15052211,21851:15052213,21852:15052216,21853:15111816,21854:15052218,21855:15052416,21856:15052419,21857:15052454,21858:15052472,21859:15052675,21860:15052679,21861:15052681,21862:15052692,21863:15052688,21864:15052708,21865:15052710,21866:15052706,21867:15052702,21868:15052709,21869:15052715,21870:15052720,21871:15052726,21872:15052723,21873:15052933,21874:15052935,21875:15052936,21876:15052941,21877:15052947,21878:15052960,21879:15052962,21880:15052968,21881:15052984,21882:15052985,21883:15053185,21884:15053190,21885:15053198,21886:15053203,22049:15053200,22050:15053199,22051:15052209,22052:15053228,22053:15053230,22054:14989730,22055:15053238,22056:15053241,22057:15053452,22058:15053457,22059:15053460,22060:15050395,22061:15053483,22062:15053499,22063:15053494,22064:15053500,22065:15053495,22066:15053701,22067:15053502,22068:15053703,22069:15053721,22070:15053737,22071:15053757,22072:15053754,22073:15053741,22074:15054476,22075:15053738,22076:15053963,22077:15053973,22078:15053975,22079:15054236,22080:15053983,22081:15053979,22082:15053969,22083:15053972,22084:15053986,22085:15053978,22086:15053977,22087:15053976,22088:15054220,22089:15054226,22090:15054222,22091:15054219,22092:15054252,22093:15054259,22094:15054262,22095:15054471,22096:15054468,22097:15054466,22098:15054498,22099:15054493,22100:15054508,22101:15054510,22102:15054525,22103:15054480,22104:15054519,22105:15054524,22106:15054729,22107:15054733,22108:15054739,22109:15054738,22110:15054742,22111:15054747,22112:15054763,22113:15054770,22114:15054773,22115:15054987,22116:15055002,22117:15055001,22118:15054993,22119:15055003,22120:15055030,22121:15055031,22122:15055236,22123:15055235,22124:15055232,22125:15055246,22126:15055255,22127:15055252,22128:15055263,22129:15055266,22130:15055268,22131:15055239,22132:15055285,22133:15055286,22134:15055290,22135:15317692,22136:15055295,22137:15055520,22138:15055745,22139:15055746,22140:15055752,22141:15055760,22142:15055759,22305:15055766,22306:15055779,22307:15055773,22308:15055770,22309:15055771,22310:15055778,22311:15055777,22312:15055784,22313:15055785,22314:15055788,22315:15055793,22316:15055795,22317:15055792,22318:15055796,22319:15055800,22320:15055806,22321:15056003,22322:15056009,22323:15056285,22324:15056284,22325:15056011,22326:15056017,22327:15056022,22328:15056041,22329:15056045,22330:15056056,22331:15056257,22332:15056264,22333:15056268,22334:15056270,22335:15056047,22336:15056273,22337:15056278,22338:15056279,22339:15056281,22340:15056289,22341:15056301,22342:15056307,22343:15056311,22344:15056515,22345:15056514,22346:15056319,22347:15056522,22348:15056520,22349:15056529,22350:15056519,22351:15056542,22352:15056537,22353:15056536,22354:15056544,22355:15056552,22356:15056557,22357:15056572,22358:15056790,22359:15056827,22360:15056804,22361:15056824,22362:15056817,22363:15056797,22364:15106739,22365:15056831,22366:15106209,22367:15106464,22368:15106201,22369:15106192,22370:15106217,22371:15106190,22372:15106225,22373:15106203,22374:15106197,22375:15106219,22376:15106214,22377:15106191,22378:15106234,22379:15106458,22380:15106433,22381:15106474,22382:15106487,22383:15106463,22384:15106442,22385:15106438,22386:15106445,22387:15106467,22388:15106435,22389:15106468,22390:15106434,22391:15106476,22392:15106475,22393:15106457,22394:15106689,22395:15106701,22396:15106983,22397:15106691,22398:15106714,22561:15106692,22562:15106715,22563:15106710,22564:15106711,22565:15106706,22566:15106727,22567:15106699,22568:15106977,22569:15106744,22570:15106976,22571:15106963,22572:15106740,22573:15056816,22574:15106749,22575:15106950,22576:15106741,22577:15106968,22578:15107469,22579:15107221,22580:15107206,22581:15106998,22582:15106999,22583:15107200,22584:15106996,22585:15107002,22586:15107203,22587:15107233,22588:15107003,22589:15106993,22590:15107213,22591:15107214,22592:15107463,22593:15107262,22594:15107240,22595:15107239,22596:15107466,22597:15107263,22598:15107260,22599:15107244,22600:15107252,22601:15107261,22602:15107458,22603:15107460,22604:15107507,22605:15107511,22606:15107480,22607:15107481,22608:15107482,22609:15107499,22610:15107508,22611:15107503,22612:15107493,22613:15107505,22614:15107487,22615:15107485,22616:15107475,22617:15107509,22618:15107737,22619:15107734,22620:15107719,22621:15107756,22622:15107732,22623:15107738,22624:15107722,22625:15107729,22626:15107755,22627:15107758,22628:15107980,22629:15107978,22630:15107977,22631:15108023,22632:15107976,22633:15107971,22634:15107974,22635:15107770,22636:15107979,22637:15187385,22638:15107981,22639:15108006,22640:15108003,22641:15108022,22642:15108026,22643:15108020,22644:15108031,22645:15108029,22646:15108028,22647:15108030,22648:15108224,22649:15108232,22650:15108233,22651:15108237,22652:15108236,22653:15108244,22654:15108251,22817:15108254,22818:15108257,22819:15108266,22820:15108270,22821:15108272,22822:15108274,22823:15108275,22824:15108481,22825:15108494,22826:15108510,22827:15108515,22828:15108507,22829:15108512,22830:15108520,22831:15108540,22832:15108738,22833:15108745,22834:15108542,22835:15108754,22836:15108755,22837:15108758,22838:15109012,22839:15108739,22840:15108756,22841:15109015,22842:15109009,22843:15108795,22844:15109007,22845:15109055,22846:15108998,22847:15111060,22848:15109e3,22849:15109020,22850:15109004,22851:15109002,22852:15108994,22853:15108999,22854:15108763,22855:15109001,22856:15109260,22857:15109038,22858:15109041,22859:15109287,22860:15109250,22861:15109256,22862:15109039,22863:15109045,22864:15109520,22865:15109310,22866:15109517,22867:15110300,22868:15109519,22869:15109782,22870:15109774,22871:15109760,22872:15109803,22873:15109558,22874:15109795,22875:15109775,22876:15109769,22877:15109791,22878:15109813,22879:15109547,22880:15109545,22881:15109822,22882:15110057,22883:15110016,22884:15110022,22885:15110051,22886:15110025,22887:15110034,22888:15110070,22889:15110020,22890:15110294,22891:15110324,22892:15110278,22893:15110291,22894:15110310,22895:15110326,22896:15111325,22897:15110295,22898:15110312,22899:15110287,22900:15110567,22901:15110575,22902:15110582,22903:15110542,22904:15111338,22905:15110805,22906:15110803,22907:15110821,22908:15110825,22909:15110792,22910:15110844,23073:15111066,23074:15111058,23075:15111045,23076:15111047,23077:15110843,23078:15111064,23079:15111042,23080:15111089,23081:15111079,23082:15239305,23083:15111072,23084:15111073,23085:15108780,23086:15111075,23087:15111087,23088:15111340,23089:15111094,23090:15111092,23091:15111090,23092:15111098,23093:15111296,23094:15111101,23095:15111320,23096:15111324,23097:15111301,23098:15111332,23099:15111331,23100:15111339,23101:15111348,23102:15111349,23103:15111351,23104:15111350,23105:15111352,23106:15177099,23107:15111560,23108:15111574,23109:15111573,23110:15111565,23111:15111576,23112:15111582,23113:15111581,23114:15111602,23115:15111608,23116:15111810,23117:15111811,23118:15249034,23119:15111835,23120:15111839,23121:15111851,23122:15111863,23123:15112067,23124:15112070,23125:15112065,23126:15112068,23127:15112076,23128:15112082,23129:15112091,23130:15112089,23131:15112096,23132:15112097,23133:15112113,23134:15113650,23135:15112330,23136:15112323,23137:15112123,23138:15113651,23139:15112373,23140:15112374,23141:15112372,23142:15112348,23143:15112591,23144:15112580,23145:15112585,23146:15112577,23147:15112606,23148:15112605,23149:15112612,23150:15112615,23151:15112616,23152:15112607,23153:15112610,23154:15112624,23155:15112835,23156:15112840,23157:15112846,23158:15112841,23159:15112836,23160:15112856,23161:15112861,23162:15113089,23163:15112889,23164:15113097,23165:15112894,23166:15112892,23329:15113092,23330:15112888,23331:15113110,23332:15113114,23333:15113120,23334:15112383,23335:15113126,23336:15113129,23337:15113136,23338:15113141,23339:15113143,23340:15113359,23341:15113366,23342:15113374,23343:15113382,23344:15113383,23345:15310008,23346:15113390,23347:15113407,23348:15113398,23349:15113601,23350:15113400,23351:15113399,23352:15113606,23353:15113630,23354:15113632,23355:15113625,23356:15113635,23357:15113636,23358:15113865,23359:15113648,23360:15113897,23361:15113660,23362:15113642,23363:15113868,23364:15113867,23365:15113894,23366:15113889,23367:15113861,23368:15113911,23369:15114159,23370:15113908,23371:15114156,23372:15113907,23373:15114153,23374:15113912,23375:15114148,23376:15114142,23377:15114141,23378:15114146,23379:15114158,23380:15113913,23381:15114126,23382:15114118,23383:15114151,23384:15116956,23385:15114398,23386:15114630,23387:15114409,23388:15114624,23389:15114637,23390:15114418,23391:15114638,23392:15114931,23393:15114411,23394:15114649,23395:15114659,23396:15114679,23397:15114687,23398:15114911,23399:15114895,23400:15114925,23401:15114900,23402:15114909,23403:15114907,23404:15114883,23405:15116974,23406:15114937,23407:15114676,23408:15114933,23409:15114912,23410:15114938,23411:15115407,23412:15114893,23413:15114686,23414:15115393,23415:15115146,23416:15115400,23417:15115160,23418:15115426,23419:15115430,23420:15115169,23421:15115404,23422:15115149,23585:15115156,23586:15115175,23587:15115157,23588:15115446,23589:15115410,23590:15115396,23591:15115159,23592:15115171,23593:15115429,23594:15115193,23595:15115168,23596:15115183,23597:15115432,23598:15115434,23599:15115418,23600:15115427,23601:15115425,23602:15115142,23603:15115705,23604:15115703,23605:15115676,23606:15115704,23607:15115691,23608:15115668,23609:15115710,23610:15115694,23611:15115449,23612:15115700,23613:15115453,23614:15115673,23615:15115440,23616:15115681,23617:15115678,23618:15115677,23619:15115905,23620:15115690,23621:15115954,23622:15115950,23623:15116176,23624:15115967,23625:15116161,23626:15116179,23627:15115966,23628:15116174,23629:15052712,23630:15116170,23631:15116189,23632:15115963,23633:15116163,23634:15115943,23635:15116462,23636:15115921,23637:15115936,23638:15115932,23639:15115925,23640:15115956,23641:15116190,23642:15116200,23643:15116418,23644:15116443,23645:15116223,23646:15117450,23647:15116217,23648:15116210,23649:15116199,23650:15116421,23651:15115953,23652:15116446,23653:15116205,23654:15116436,23655:15116203,23656:15116426,23657:15116434,23658:15117185,23659:15116451,23660:15116435,23661:15116676,23662:15116428,23663:15116722,23664:15116470,23665:15116728,23666:15116679,23667:15116706,23668:15116697,23669:15116710,23670:15116680,23671:15116472,23672:15116450,23673:15116944,23674:15116941,23675:15116960,23676:15116932,23677:15116962,23678:15116963,23841:15116951,23842:15243415,23843:15116987,23844:15117187,23845:15117186,23846:15116984,23847:15116979,23848:15116972,23849:15117214,23850:15117201,23851:15117215,23852:15116970,23853:15117210,23854:15117226,23855:15117243,23856:15117445,23857:15243414,23858:15117242,23859:15117458,23860:15117462,23861:15314097,23862:15117471,23863:15117496,23864:15117495,23865:15178652,23866:15117497,23867:15311790,23868:15117703,23869:15117699,23870:15117705,23871:15117712,23872:15117721,23873:15117716,23874:15117723,23875:15117727,23876:15117729,23877:15117752,23878:15117753,23879:15117759,23880:15117952,23881:15117956,23882:15117955,23883:15117965,23884:15117976,23885:15117973,23886:15117982,23887:15117988,23888:15117994,23889:15117995,23890:15117999,23891:15118002,23892:15118001,23893:15118003,23894:15118007,23895:15118012,23896:15118214,23897:15118219,23898:15118227,23899:15118239,23900:15118252,23901:15118251,23902:15118259,23903:15118255,23904:15317694,23905:15118472,23906:15118483,23907:15118484,23908:15118491,23909:15118500,23910:15118499,23911:15118750,23912:15118741,23913:15118754,23914:15118762,23915:15118978,23916:15118989,23917:15119002,23918:15118977,23919:15119003,23920:15118782,23921:15118760,23922:15118771,23923:15118994,23924:15118992,23925:15119236,23926:15119281,23927:15119251,23928:15119037,23929:15119255,23930:15119237,23931:15119261,23932:15119022,23933:15119025,23934:15119038,24097:15119034,24098:15119259,24099:15119279,24100:15119257,24101:15119274,24102:15119519,24103:15245709,24104:15119542,24105:15119531,24106:15119549,24107:15119544,24108:15119513,24109:15119541,24110:15119539,24111:15119506,24112:15119500,24113:15119779,24114:15120019,24115:15119780,24116:15119770,24117:15119801,24118:15119769,24119:15120014,24120:15120021,24121:15122340,24122:15120005,24123:15120313,24124:15120533,24125:15120522,24126:15120053,24127:15120263,24128:15120294,24129:15120056,24130:15120262,24131:15120300,24132:15120286,24133:15120268,24134:15120296,24135:15120274,24136:15120261,24137:15120314,24138:15120281,24139:15120292,24140:15120277,24141:15120298,24142:15120302,24143:15120557,24144:15120814,24145:15120558,24146:15120537,24147:15120818,24148:15120799,24149:15120574,24150:15120547,24151:15120811,24152:15120555,24153:15120822,24154:15120781,24155:15120543,24156:15120771,24157:15120570,24158:15120782,24159:15120548,24160:15121343,24161:15120541,24162:15120568,24163:15121026,24164:15121066,24165:15121048,24166:15121289,24167:15121079,24168:15121299,24169:15121085,24170:15121071,24171:15121284,24172:15121074,24173:15121300,24174:15121301,24175:15121039,24176:15121061,24177:15121282,24178:15121055,24179:15121793,24180:15121553,24181:15171980,24182:15121324,24183:15121336,24184:15121342,24185:15121599,24186:15121330,24187:15121585,24188:15121327,24189:15121586,24190:15121292,24353:15121598,24354:15121555,24355:15121335,24356:15122054,24357:15121850,24358:15121848,24359:15122049,24360:15122048,24361:15121839,24362:15121819,24363:15122355,24364:15121837,24365:15122050,24366:15121852,24367:15121816,24368:15122062,24369:15122065,24370:15122306,24371:15121830,24372:15122099,24373:15122083,24374:15122081,24375:15122084,24376:15122105,24377:15122310,24378:15122090,24379:15122335,24380:15122325,24381:15122348,24382:15122324,24383:15122328,24384:15122353,24385:15122350,24386:15122331,24387:15171721,24388:15171723,24389:15122362,24390:15171729,24391:15171713,24392:15171727,24393:15122366,24394:15171739,24395:15171738,24396:15121844,24397:15171741,24398:15171736,24399:15171743,24400:15171760,24401:15171774,24402:15171762,24403:15171985,24404:15172003,24405:15172249,24406:15172242,24407:15172271,24408:15172529,24409:15172268,24410:15172280,24411:15172275,24412:15172270,24413:15172511,24414:15172491,24415:15172509,24416:15172505,24417:15172745,24418:15172541,24419:15172764,24420:15172761,24421:15173029,24422:15173013,24423:15173256,24424:15173030,24425:15173026,24426:15173004,24427:15173014,24428:15173036,24429:15173263,24430:15173563,24431:15173252,24432:15173269,24433:15173288,24434:15173292,24435:15173527,24436:15173305,24437:15173310,24438:15173522,24439:15173513,24440:15173524,24441:15173518,24442:15173536,24443:15173548,24444:15173543,24445:15173557,24446:15173564,24609:15173561,24610:15173567,24611:15173773,24612:15173776,24613:15173787,24614:15173800,24615:15173805,24616:15173804,24617:15173808,24618:15173810,24619:15173819,24620:15173820,24621:15173823,24622:15174016,24623:15174022,24624:15174027,24625:15174040,24626:15174068,24627:15174078,24628:15174274,24629:15174273,24630:15174279,24631:15174290,24632:15174294,24633:15174306,24634:15174311,24635:15174329,24636:15174322,24637:15174531,24638:15174534,24639:15174532,24640:15174542,24641:15174546,24642:15174562,24643:15174560,24644:15174561,24645:15174585,24646:15174583,24647:15040655,24648:15174807,24649:15174794,24650:15174812,24651:15174806,24652:15174813,24653:15174836,24654:15174831,24655:15174825,24656:15174821,24657:15174846,24658:15175054,24659:15175055,24660:15317912,24661:15175063,24662:15175082,24663:15175080,24664:15175088,24665:15175096,24666:15175093,24667:15175099,24668:15175098,24669:15175560,24670:15175347,24671:15175566,24672:15175355,24673:15175552,24674:15175589,24675:15175598,24676:15175582,24677:15176354,24678:15175813,24679:15176111,24680:15175845,24681:15175608,24682:15175858,24683:15175866,24684:15176085,24685:15175871,24686:15176095,24687:15176089,24688:15176065,24689:15176092,24690:15176105,24691:15176112,24692:15176099,24693:15176106,24694:15176118,24695:15176126,24696:15176331,24697:15176350,24698:15176359,24699:15176586,24700:15176591,24701:15176596,24702:15175601,24865:15176608,24866:15176611,24867:15176615,24868:15176617,24869:15176622,24870:15176626,24871:15176624,24872:15176625,24873:15176632,24874:15176631,24875:15176836,24876:15176835,24877:15176837,24878:15176844,24879:15176846,24880:15176845,24881:15176853,24882:15176851,24883:15176862,24884:15176870,24885:15176876,24886:15176892,24887:15177092,24888:15177101,24889:15177098,24890:15177097,24891:15177115,24892:15177094,24893:15177114,24894:15177129,24895:15177124,24896:15177127,24897:15177131,24898:15177133,24899:15177144,24900:15177142,24901:15177350,24902:15177351,24903:15177140,24904:15177354,24905:15177353,24906:15177346,24907:15177364,24908:15177370,24909:15177373,24910:15177381,24911:15177379,24912:15177602,24913:15177395,24914:15177603,24915:15177397,24916:15177405,24917:15177400,24918:15177404,24919:15177393,24920:15177613,24921:15177610,24922:15177618,24923:15177625,24924:15177635,24925:15177630,24926:15177662,24927:15177663,24928:15177660,24929:15177857,24930:15177648,24931:15177658,24932:15177650,24933:15177651,24934:15177867,24935:15177869,24936:15177865,24937:15177887,24938:15177895,24939:15177888,24940:15177889,24941:15177890,24942:15177892,24943:15177908,24944:15177904,24945:15177915,24946:15178119,24947:15178120,24948:15178118,24949:15178140,24950:15178136,24951:15178145,24952:15178146,24953:15178152,24954:15178153,24955:15178154,24956:15178151,24957:15178156,24958:15178160,25121:15178162,25122:15178166,25123:15178168,25124:15178172,25125:15178368,25126:15178371,25127:15178376,25128:15178379,25129:15178382,25130:15178390,25131:15178387,25132:15178393,25133:15178394,25134:15178416,25135:15178420,25136:15178424,25137:15178425,25138:15178426,25139:15178626,25140:15178637,25141:15178646,25142:15178642,25143:15178654,25144:15178657,25145:15178661,25146:15178663,25147:15178666,25148:15243439,25149:15178683,25150:15178888,25151:15178887,25152:15178884,25153:15178921,25154:15178916,25155:15178910,25156:15178917,25157:15178918,25158:15178907,25159:15178935,25160:15178936,25161:15179143,25162:15179162,25163:15179176,25164:15179179,25165:15179163,25166:15179173,25167:15179199,25168:15179198,25169:15179193,25170:15179406,25171:15179403,25172:15179409,25173:15179424,25174:15179422,25175:15179440,25176:15179446,25177:15179449,25178:15179455,25179:15179452,25180:15179453,25181:15179451,25182:15179655,25183:15179661,25184:15179671,25185:15179674,25186:15179676,25187:15179683,25188:15179694,25189:15179708,25190:15179916,25191:15179922,25192:15180966,25193:15179936,25194:15180970,25195:15180165,25196:15180430,25197:15180212,25198:15180422,25199:15180220,25200:15180442,25201:15180428,25202:15180451,25203:15180469,25204:15180458,25205:15180463,25206:15180689,25207:15180678,25208:15180683,25209:15180692,25210:15180478,25211:15180476,25212:15180677,25213:15180682,25214:15180716,25377:15180711,25378:15180698,25379:15180733,25380:15180724,25381:15180935,25382:15180946,25383:15180945,25384:15180953,25385:15180972,25386:15180971,25387:15181184,25388:15181216,25389:15181207,25390:15181215,25391:15181210,25392:15181205,25393:15181203,25394:15181242,25395:15181247,25396:15181450,25397:15181469,25398:15181479,25399:15318411,25400:15181482,25401:15181486,25402:15181491,25403:15181497,25404:15181498,25405:15181705,25406:15181717,25407:15181735,25408:15181740,25409:15181729,25410:15181731,25411:15181960,25412:15181965,25413:15181976,25414:15181977,25415:15181984,25416:15181983,25417:15181440,25418:15182001,25419:15182011,25420:15182014,25421:15182007,25422:15182211,25423:15182231,25424:15182217,25425:15182241,25426:15182242,25427:15182249,25428:15318685,25429:15182256,25430:15182265,25431:15182269,25432:15182472,25433:15182487,25434:15182485,25435:15182488,25436:15182486,25437:15182505,25438:15182728,25439:15182512,25440:15182518,25441:15182725,25442:15182724,25443:15182527,25444:15303299,25445:15182727,25446:15182730,25447:15182733,25448:15182735,25449:15182741,25450:15182739,25451:15182745,25452:15182746,25453:15182749,25454:15182753,25455:15182754,25456:15182758,25457:15182765,25458:15182768,25459:15182978,25460:15182991,25461:15182986,25462:15182982,25463:15183027,25464:15183e3,25465:15183001,25466:15183006,25467:15183029,25468:15183016,25469:15183030,25470:15183248,25633:15183290,25634:15182980,25635:15183245,25636:15182987,25637:15183244,25638:15183237,25639:15183285,25640:15183269,25641:15183284,25642:15183271,25643:15183280,25644:15183281,25645:15183276,25646:15183278,25647:15183517,25648:15183512,25649:15183519,25650:15183501,25651:15183516,25652:15183514,25653:15183499,25654:15183506,25655:15183503,25656:15183261,25657:15183513,25658:15183755,25659:15183745,25660:15183756,25661:15183759,25662:15183540,25663:15183750,25664:15183773,25665:15183785,25666:15184017,25667:15184020,25668:15183782,25669:15183781,25670:15184288,25671:15184e3,25672:15184007,25673:15184019,25674:15183795,25675:15183799,25676:15184023,25677:15184013,25678:15183798,25679:15184035,25680:15184039,25681:15184042,25682:15184031,25683:15184055,25684:15184043,25685:15184061,25686:15184268,25687:15184259,25688:15184276,25689:15184271,25690:15184256,25691:15184272,25692:15184280,25693:15184287,25694:15184292,25695:15184278,25696:15184293,25697:15184300,25698:15184309,25699:15184515,25700:15184528,25701:15184548,25702:15184557,25703:15184546,25704:15184555,25705:15184545,25706:15184552,25707:15184563,25708:15184562,25709:15184561,25710:15184558,25711:15184569,25712:15184573,25713:15184768,25714:15184773,25715:15184770,25716:15184792,25717:15184786,25718:15184796,25719:15184802,25720:15314107,25721:15184815,25722:15184818,25723:15184820,25724:15184822,25725:15184826,25726:15185030,25889:15185026,25890:15185052,25891:15185045,25892:15185034,25893:15185285,25894:15185291,25895:15185070,25896:15185074,25897:15185087,25898:15185077,25899:15185286,25900:15185331,25901:15185302,25902:15185294,25903:15185330,25904:15185320,25905:15185326,25906:15185295,25907:15185315,25908:15185555,25909:15185545,25910:15185307,25911:15185551,25912:15185341,25913:15185563,25914:15185594,25915:15185582,25916:15185571,25917:15185589,25918:15185799,25919:15185597,25920:15185579,25921:15186109,25922:15185570,25923:15185583,25924:15185820,25925:15185592,25926:15185567,25927:15185584,25928:15185816,25929:15185821,25930:15185828,25931:15185822,25932:15185851,25933:15185842,25934:15185825,25935:15186053,25936:15186058,25937:15186083,25938:15186081,25939:15186066,25940:15186097,25941:15186079,25942:15186057,25943:15186059,25944:15186082,25945:15186310,25946:15186342,25947:15186107,25948:15186101,25949:15186105,25950:15186307,25951:15186103,25952:15186098,25953:15186106,25954:15186343,25955:15186333,25956:15186326,25957:15186334,25958:15186329,25959:15186330,25960:15186361,25961:15186346,25962:15186345,25963:15186364,25964:15186363,25965:15186563,25966:15185813,25967:15186365,25968:15253166,25969:15186367,25970:15186568,25971:15186569,25972:15186572,25973:15186578,25974:15186576,25975:15186579,25976:15186580,25977:15186582,25978:15186574,25979:15186587,25980:15186588,25981:15187128,25982:15187130,26145:15187333,26146:15187340,26147:15187341,26148:15187342,26149:15187344,26150:15187345,26151:15187349,26152:15187348,26153:15187352,26154:15187359,26155:15187360,26156:15187368,26157:15187369,26158:15187367,26159:15187384,26160:15187586,26161:15187590,26162:15187587,26163:15187592,26164:15187591,26165:15187596,26166:15187604,26167:15187614,26168:15187613,26169:15187610,26170:15187619,26171:15187631,26172:15187634,26173:15187641,26174:15187630,26175:15187638,26176:15187640,26177:15248817,26178:15187845,26179:15187846,26180:15187850,26181:15187861,26182:15187860,26183:15187873,26184:15187878,26185:15187881,26186:15187891,26187:15187897,26188:15311772,26189:15237254,26190:15237252,26191:15237259,26192:15237266,26193:15237272,26194:15237273,26195:15237276,26196:15237281,26197:15237288,26198:15237311,26199:15237307,26200:15237514,26201:15237510,26202:15237522,26203:15237528,26204:15237530,26205:15237535,26206:15237538,26207:15237544,26208:15237555,26209:15237554,26210:15237552,26211:15237558,26212:15237561,26213:15237565,26214:15237567,26215:15237764,26216:15237766,26217:15237765,26218:15237787,26219:15237779,26220:15237786,26221:15237805,26222:15042192,26223:15237804,26224:15238043,26225:15238053,26226:15238041,26227:15238045,26228:15238020,26229:15238042,26230:15238038,26231:15238281,26232:15238063,26233:15238065,26234:15238299,26235:15238313,26236:15238307,26237:15238319,26238:15238539,26401:15309451,26402:15238534,26403:15238334,26404:15238547,26405:15238545,26406:15238076,26407:15238577,26408:15238574,26409:15238565,26410:15238566,26411:15238580,26412:15238787,26413:15238792,26414:15238794,26415:15238784,26416:15238786,26417:15238816,26418:15238805,26419:15238820,26420:15238819,26421:15238559,26422:15238803,26423:15238825,26424:15238832,26425:15238837,26426:15238846,26427:15238840,26428:15238845,26429:15239040,26430:15239042,26431:15238842,26432:15239049,26433:15239053,26434:15239057,26435:15239065,26436:15239064,26437:15239048,26438:15239066,26439:15239071,26440:15239072,26441:15239079,26442:15239098,26443:15239099,26444:15239102,26445:15239297,26446:15239298,26447:15239301,26448:15239303,26449:15239306,26450:15239309,26451:15239312,26452:15239318,26453:15239337,26454:15239339,26455:15239352,26456:15239347,26457:15239552,26458:15239577,26459:15239576,26460:15239581,26461:15239578,26462:15239583,26463:15239588,26464:15239586,26465:15239592,26466:15239594,26467:15239595,26468:15239342,26469:15239601,26470:15239607,26471:15239608,26472:15239614,26473:15239821,26474:15239826,26475:15239851,26476:15239839,26477:15239867,26478:15239852,26479:15240097,26480:15240099,26481:15240095,26482:15240082,26483:15240116,26484:15240115,26485:15240122,26486:15240851,26487:15240323,26488:15240123,26489:15240121,26490:15240094,26491:15240326,26492:15240092,26493:15240329,26494:15240089,26657:15240373,26658:15240372,26659:15240342,26660:15240370,26661:15240369,26662:15240576,26663:15240377,26664:15240592,26665:15240581,26666:15240367,26667:15240363,26668:15240343,26669:15240344,26670:15240837,26671:15240858,26672:15240874,26673:15240863,26674:15240866,26675:15240854,26676:15240355,26677:15240846,26678:15240839,26679:15240842,26680:15240636,26681:15240885,26682:15240627,26683:15240629,26684:15240864,26685:15240841,26686:15240872,26687:15241140,26688:15241363,26689:15241131,26690:15241102,26691:15241149,26692:15241347,26693:15241112,26694:15241355,26695:15241089,26696:15241143,26697:15241351,26698:15241120,26699:15241138,26700:15241357,26701:15241378,26702:15241376,26703:15240893,26704:15241400,26705:15242374,26706:15241147,26707:15241645,26708:15241386,26709:15241404,26710:15242650,26711:15241860,26712:15241655,26713:15241643,26714:15241901,26715:15241646,26716:15241858,26717:15241641,26718:15241606,26719:15241388,26720:15241647,26721:15241657,26722:15241397,26723:15242122,26724:15241634,26725:15241913,26726:15241919,26727:15241887,26728:15242137,26729:15242125,26730:15241915,26731:15242138,26732:15242128,26733:15242113,26734:15242118,26735:15242134,26736:15241889,26737:15242401,26738:15242175,26739:15242164,26740:15242391,26741:15242392,26742:15242412,26743:15242399,26744:15242389,26745:15242388,26746:15242172,26747:15242624,26748:15242659,26749:15242648,26750:15242632,26913:15242625,26914:15243394,26915:15242635,26916:15242645,26917:15242880,26918:15242916,26919:15242888,26920:15242897,26921:15242890,26922:15242920,26923:15242669,26924:15242900,26925:15242907,26926:15243178,26927:15242887,26928:15242908,26929:15242679,26930:15242686,26931:15242896,26932:15243145,26933:15242938,26934:15243151,26935:15242937,26936:15243152,26937:15243157,26938:15243165,26939:15243173,26940:15243164,26941:15243193,26942:15243402,26943:15243411,26944:15243403,26945:15243198,26946:15243194,26947:15243398,26948:15243426,26949:15243418,26950:15243440,26951:15243455,26952:15243661,26953:14989717,26954:15243668,26955:15243679,26956:15243687,26957:15243697,26958:15243923,26959:15243939,26960:15243945,26961:15243946,26962:15243915,26963:15243916,26964:15243958,26965:15243951,26966:15244164,26967:15244166,26968:15243952,26969:15244169,26970:15245475,26971:15243947,26972:15244180,26973:15244190,26974:15244201,26975:15244204,26976:15244191,26977:15244187,26978:15244207,26979:15244434,26980:15244422,26981:15244424,26982:15244416,26983:15244419,26984:15244219,26985:15244433,26986:15244425,26987:15244429,26988:15244217,26989:15244426,26990:15244468,26991:15244479,26992:15244471,26993:15244475,26994:15244453,26995:15244457,26996:15244442,26997:15244704,26998:15244703,26999:15244728,27e3:15244684,27001:15244686,27002:15244724,27003:15244695,27004:15244712,27005:15244718,27006:15244697,27169:15244691,27170:15244707,27171:15244714,27172:15245445,27173:15244962,27174:15244959,27175:15244930,27176:15244975,27177:15245195,27178:15244989,27179:15245184,27180:15245200,27181:15309718,27182:15244971,27183:15245188,27184:15244979,27185:15245191,27186:15245190,27187:15244987,27188:15245231,27189:15245234,27190:15245216,27191:15245455,27192:15245453,27193:15245246,27194:15245238,27195:15245239,27196:15245454,27197:15245202,27198:15245457,27199:15245462,27200:15245461,27201:15245474,27202:15245473,27203:15245489,27204:15245494,27205:15245497,27206:15245479,27207:15245499,27208:15245700,27209:15245698,27210:15245714,27211:15245721,27212:15245726,27213:15245730,27214:15245739,27215:15245953,27216:15245758,27217:15245982,27218:15245749,27219:15245757,27220:15246005,27221:15245746,27222:15245954,27223:15245975,27224:15245970,27225:15245998,27226:15245977,27227:15245986,27228:15245965,27229:15245988,27230:15246e3,27231:15246015,27232:15246001,27233:15246211,27234:15246212,27235:15246228,27236:15246232,27237:15246233,27238:15246237,27239:15246265,27240:15246466,27241:15246268,27242:15246260,27243:15246248,27244:15246258,27245:15246468,27246:15246476,27247:15246474,27248:15246483,27249:15246723,27250:15246494,27251:15246501,27252:15246506,27253:15246507,27254:15246721,27255:15246724,27256:15246523,27257:15246518,27258:15246520,27259:15246732,27260:15246493,27261:15246752,27262:15246750,27425:15246758,27426:15246756,27427:15246765,27428:15246762,27429:15246767,27430:15246772,27431:15246775,27432:15246782,27433:15246979,27434:15246984,27435:15246986,27436:15246995,27437:15247e3,27438:15247009,27439:15247017,27440:15247014,27441:15247020,27442:15247023,27443:15247026,27444:15247034,27445:15247037,27446:15247039,27447:15247232,27448:15247258,27449:15247260,27450:15247261,27451:15247271,27452:15247284,27453:15247288,27454:15247491,27455:15247510,27456:15247504,27457:15247500,27458:15247515,27459:15247517,27460:15247525,27461:15247542,27462:15247745,27463:15247771,27464:15247762,27465:15247750,27466:15247752,27467:15247804,27468:15247789,27469:15247788,27470:15247778,27471:15248005,27472:15248002,27473:15248004,27474:15248040,27475:15248033,27476:15248017,27477:15248037,27478:15248038,27479:15248026,27480:15248035,27481:15248260,27482:15248269,27483:15248258,27484:15248282,27485:15248299,27486:15248307,27487:15248295,27488:15248292,27489:15248305,27490:15248532,27491:15248288,27492:15248290,27493:15248311,27494:15248286,27495:15248283,27496:15248524,27497:15248519,27498:15248538,27499:15248289,27500:15248534,27501:15248528,27502:15248535,27503:15248544,27504:15248563,27505:15310507,27506:15248550,27507:15248555,27508:15248574,27509:15248552,27510:15248769,27511:15248780,27512:15248783,27513:15248782,27514:15248777,27515:15248790,27516:15248795,27517:15248794,27518:15248811,27681:15248799,27682:15248812,27683:15248815,27684:15248820,27685:15248829,27686:15249024,27687:15249036,27688:15249038,27689:15249042,27690:15249043,27691:15249046,27692:15249049,27693:15249050,27694:15249594,27695:15249793,27696:15249599,27697:15249800,27698:15249804,27699:15249806,27700:15249808,27701:15249813,27702:15249826,27703:15249836,27704:15249848,27705:15249850,27706:15250050,27707:15250057,27708:15250053,27709:15250058,27710:15250061,27711:15250062,27712:15250068,27713:15249852,27714:15250072,27715:15108253,27716:15250093,27717:15250090,27718:15250109,27719:15250098,27720:15250099,27721:15250094,27722:15250102,27723:15250312,27724:15250305,27725:15250340,27726:15250339,27727:15250330,27728:15250365,27729:15250362,27730:15250363,27731:15250564,27732:15250565,27733:15250570,27734:15250567,27735:15250575,27736:15250573,27737:15250576,27738:15318414,27739:15250579,27740:15250317,27741:15250580,27742:15250582,27743:15250855,27744:15250861,27745:15250865,27746:15250867,27747:15251073,27748:15251097,27749:15251330,27750:15251134,27751:15251130,27752:15251343,27753:15251354,27754:15251350,27755:15251340,27756:15251355,27757:15251339,27758:15251370,27759:15251371,27760:15251359,27761:15251363,27762:15251388,27763:15251592,27764:15251593,27765:15251391,27766:15251613,27767:15251614,27768:15251600,27769:15251615,27770:15251842,27771:15251637,27772:15251632,27773:15251636,27774:15251850,27937:15251847,27938:15251849,27939:15251852,27940:15251856,27941:15251848,27942:15251865,27943:15251876,27944:15251872,27945:15251626,27946:15251875,27947:15251861,27948:15251894,27949:15251890,27950:15251900,27951:15252097,27952:15252103,27953:15252101,27954:15252100,27955:15252107,27956:15252106,27957:15252115,27958:15252113,27959:15252116,27960:15252121,27961:15252138,27962:15252129,27963:15252140,27964:15252144,27965:15252358,27966:15252145,27967:15252158,27968:15252357,27969:15252360,27970:15252363,27971:15252379,27972:15252387,27973:15252412,27974:15252411,27975:15252395,27976:15252414,27977:15252618,27978:15252613,27979:15252629,27980:15252626,27981:15252633,27982:15252627,27983:15252636,27984:15252639,27985:15252635,27986:15252620,27987:15252646,27988:15252659,27989:15252667,27990:15252665,27991:15252869,27992:15252866,27993:15252670,27994:15252876,27995:15252873,27996:15252870,27997:15252878,27998:15252887,27999:15252892,28e3:15252898,28001:15252899,28002:15252900,28003:15253148,28004:15253151,28005:15253155,28006:15253165,28007:15253167,28008:15253175,28009:15253402,28010:15253413,28011:15253410,28012:15253418,28013:15253423,28014:15303303,28015:15253428,28016:15302789,28017:15253433,28018:15253434,28019:15302801,28020:15302805,28021:15302817,28022:15302797,28023:15302814,28024:15302806,28025:15302795,28026:15302823,28027:15302838,28028:15302837,28029:15302841,28030:15253432,28193:15303055,28194:15303056,28195:15303057,28196:15303058,28197:15302798,28198:15303049,28199:15302846,28200:15303062,28201:15303064,28202:15303070,28203:15303080,28204:15303087,28205:15303094,28206:15309480,28207:15303090,28208:15303298,28209:15303101,28210:15303297,28211:15303296,28212:15303306,28213:15303305,28214:15303311,28215:15303336,28216:15303343,28217:15303345,28218:15303349,28219:15303586,28220:15303588,28221:15108488,28222:15303579,28223:15303810,28224:15303826,28225:15303833,28226:15303858,28227:15303856,28228:15304074,28229:15304086,28230:15304088,28231:15304099,28232:15304101,28233:15304105,28234:15304115,28235:15304114,28236:15304331,28237:15304329,28238:15304322,28239:15304354,28240:15304363,28241:15304367,28242:15304362,28243:15304373,28244:15304372,28245:15304378,28246:15304576,28247:15304577,28248:15304585,28249:15304587,28250:15304592,28251:15304598,28252:15304607,28253:15304609,28254:15304603,28255:15304636,28256:15304629,28257:15304630,28258:15304862,28259:15304639,28260:15304852,28261:15304876,28262:15304853,28263:15304849,28264:15305118,28265:15305111,28266:15305093,28267:15305097,28268:15305124,28269:15305096,28270:15305365,28271:15304895,28272:15305099,28273:15305104,28274:15305372,28275:15305366,28276:15305363,28277:15305371,28278:15305114,28279:15305615,28280:15305401,28281:15305399,28282:15305641,28283:15305871,28284:15305658,28285:15306116,28286:15305902,28449:15305881,28450:15305890,28451:15305882,28452:15305891,28453:15305914,28454:15305909,28455:15305915,28456:15306140,28457:15306144,28458:15306172,28459:15306158,28460:15306134,28461:15306416,28462:15306412,28463:15306413,28464:15306388,28465:15306425,28466:15306646,28467:15306647,28468:15306664,28469:15306661,28470:15306648,28471:15306627,28472:15306653,28473:15306640,28474:15306632,28475:15306660,28476:15306906,28477:15306900,28478:15306899,28479:15306883,28480:15306887,28481:15306896,28482:15306934,28483:15306923,28484:15306933,28485:15306913,28486:15306938,28487:15307137,28488:15307154,28489:15307140,28490:15307163,28491:15307168,28492:15307170,28493:15307166,28494:15307178,28495:15304873,28496:15307184,28497:15307189,28498:15307191,28499:15307197,28500:15307162,28501:15307196,28502:15307198,28503:15307393,28504:15307199,28505:15308418,28506:15308423,28507:15308426,28508:15308436,28509:15308438,28510:15308440,28511:15308441,28512:15308448,28513:15308456,28514:15308455,28515:15308461,28516:15308476,28517:15308475,28518:15308473,28519:15308478,28520:15308682,28521:15122358,28522:15308675,28523:15308685,28524:15308684,28525:15308693,28526:15308692,28527:15308694,28528:15308700,28529:15308705,28530:15308709,28531:15308706,28532:15308961,28533:15308968,28534:15308974,28535:15308975,28536:15309186,28537:15309196,28538:15309199,28539:15309195,28540:15309239,28541:15309212,28542:15309214,28705:15309213,28706:15309215,28707:15309222,28708:15309234,28709:15309228,28710:15309453,28711:15309464,28712:15309461,28713:15309463,28714:15309482,28715:15309479,28716:15309489,28717:15309490,28718:15309488,28719:15309492,28720:15309494,28721:15309496,28722:15309497,28723:15309710,28724:15309707,28725:15309705,28726:15309709,28727:15246733,28728:15309724,28729:15309965,28730:15309717,28731:15309753,28732:15309956,28733:15309958,28734:15309960,28735:15309971,28736:15309966,28737:15309969,28738:15309967,28739:15309974,28740:15309977,28741:15309988,28742:15309994,28743:1531e4,28744:15310009,28745:15310013,28746:15310014,28747:15310212,28748:15310214,28749:15310216,28750:15310210,28751:15310217,28752:15310236,28753:15310240,28754:15310244,28755:15310246,28756:15310248,28757:15043474,28758:15310251,28759:15310257,28760:15310265,28761:15310469,28762:15310268,28763:15310465,28764:15310266,28765:15310470,28766:15310475,28767:15310479,28768:15310480,28769:15310492,28770:15310504,28771:15310502,28772:15310499,28773:15310515,28774:15310516,28775:15310723,28776:15310726,28777:15310728,28778:15310731,28779:15310748,28780:15310765,28781:15318415,28782:15310770,28783:15182751,28784:15310774,28785:15310773,28786:15310991,28787:15310988,28788:15311032,28789:15311012,28790:15311009,28791:15311031,28792:15311037,28793:15311238,28794:15311247,28795:15311243,28796:15311275,28797:15311279,28798:15311280,28961:15311281,28962:15311284,28963:15311283,28964:15311530,28965:15311535,28966:15311537,28967:15311542,28968:15311748,28969:15311747,28970:15311750,28971:15311785,28972:15311787,28973:15312003,28974:15312009,28975:15312018,28976:15312020,28977:15312024,28978:15312033,28979:15312029,28980:15312030,28981:15312036,28982:15312032,28983:15312044,28984:15312046,28985:15312061,28986:15312062,28987:15312258,28988:15312265,28989:15312261,28990:15312272,28991:15312267,28992:15312273,28993:15312274,28994:15312268,28995:15312277,28996:15312535,28997:15312536,28998:15312549,28999:15312557,29e3:15312558,29001:15312572,29002:15312799,29003:15312795,29004:15312797,29005:15312792,29006:15312785,29007:15312813,29008:15312814,29009:15312817,29010:15312818,29011:15312827,29012:15312824,29013:15313025,29014:15313039,29015:15313029,29016:15312802,29017:15313049,29018:15313067,29019:15313079,29020:15313285,29021:15313282,29022:15313280,29023:15313283,29024:15313086,29025:15313301,29026:15313293,29027:15313307,29028:15313303,29029:15313311,29030:15313314,29031:15313317,29032:15313316,29033:15313321,29034:15313323,29035:15313322,29036:15313581,29037:15313584,29038:15313596,29039:15313792,29040:15313807,29041:15313809,29042:15313811,29043:15313812,29044:15313822,29045:15313823,29046:15313826,29047:15313827,29048:15313830,29049:15313839,29050:15313835,29051:15313838,29052:15313844,29053:15313841,29054:15313847,29217:15313851,29218:15314054,29219:15314072,29220:15314074,29221:15314079,29222:15314082,29223:15314083,29224:15314085,29225:15314087,29226:15314088,29227:15314089,29228:15314090,29229:15314094,29230:15314095,29231:15314098,29232:15314308,29233:15314307,29234:15314319,29235:15314317,29236:15314318,29237:15314321,29238:15314328,29239:15314356,29240:15314579,29241:15314563,29242:15314577,29243:15314582,29244:15314583,29245:15314591,29246:15314592,29247:15314600,29248:15314612,29249:15314816,29250:15314826,29251:15314617,29252:15314822,29253:15314831,29254:15314833,29255:15314834,29256:15314851,29257:15314850,29258:15314852,29259:15314836,29260:15314849,29261:15315130,29262:15314866,29263:15314865,29264:15314864,29265:15315093,29266:15315092,29267:15315081,29268:15315091,29269:15315084,29270:15315078,29271:15315080,29272:15315090,29273:15315082,29274:15315076,29275:15315118,29276:15315099,29277:15315109,29278:15315108,29279:15315105,29280:15315120,29281:15315335,29282:15315122,29283:15315334,29284:15315134,29285:15315354,29286:15315360,29287:15315367,29288:15315382,29289:15315384,29290:15315879,29291:15315884,29292:15315888,29293:15316105,29294:15316104,29295:15315883,29296:15316099,29297:15316102,29298:15316138,29299:15316134,29300:15316655,29301:15316131,29302:15316127,29303:15316356,29304:15316117,29305:15316114,29306:15316353,29307:15316159,29308:15316158,29309:15316358,29310:15316360,29473:15316381,29474:15316382,29475:15316388,29476:15316369,29477:15316368,29478:15316377,29479:15316402,29480:15316617,29481:15316615,29482:15316651,29483:15316399,29484:15316410,29485:15316634,29486:15316644,29487:15316649,29488:15316658,29489:15316868,29490:15316865,29491:15316667,29492:15316664,29493:15316666,29494:15316870,29495:15316879,29496:15316866,29497:15316889,29498:15316883,29499:15316920,29500:15316902,29501:15316909,29502:15316911,29503:15316925,29504:15317146,29505:15317147,29506:15317150,29507:15317429,29508:15317433,29509:15317437,29510:15317633,29511:15317640,29512:15317643,29513:15317644,29514:15317650,29515:15317653,29516:15317649,29517:15317661,29518:15317669,29519:15317673,29520:15317688,29521:15317674,29522:15317677,29523:15310241,29524:15317900,29525:15317902,29526:15317903,29527:15317904,29528:15317908,29529:15317916,29530:15317918,29531:15317917,29532:15317920,29533:15317925,29534:15317928,29535:15317935,29536:15317940,29537:15317942,29538:15317943,29539:15317945,29540:15317947,29541:15317948,29542:15317949,29543:15318151,29544:15318152,29545:15178423,29546:15318165,29547:15318177,29548:15318188,29549:15318206,29550:15318410,29551:15318418,29552:15318420,29553:15318435,29554:15318431,29555:15318432,29556:15318433,29557:15318438,29558:15318439,29559:15318444,29560:15318442,29561:15318455,29562:15318450,29563:15318454,29564:15318677,29565:15318684,29566:15318688,29729:15048879,29730:15116167,29731:15303065,29732:15176100,29733:15042460,29734:15173273};THREE.MMD.Encoding=t})();

THREE.LineSegments=function(c,d){THREE.Line.call(this,c,d),this.type="LineSegments"},THREE.LineSegments.prototype=Object.assign(Object.create(THREE.Line.prototype),{constructor:THREE.LineSegments}),THREE.CameraHelper=function(c){function d(p,q,r){e(p,r),e(q,r)}function e(p,q){f.vertices.push(new THREE.Vector3),f.colors.push(new THREE.Color(q)),j[p]===void 0&&(j[p]=[]),j[p].push(f.vertices.length-1)}var f=new THREE.Geometry,g=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),j={},k=16755200,l=16711680,m=43775,o=3355443;d("n1","n2",k),d("n2","n4",k),d("n4","n3",k),d("n3","n1",k),d("f1","f2",k),d("f2","f4",k),d("f4","f3",k),d("f3","f1",k),d("n1","f1",k),d("n2","f2",k),d("n3","f3",k),d("n4","f4",k),d("p","n1",l),d("p","n2",l),d("p","n3",l),d("p","n4",l),d("u1","u2",m),d("u2","u3",m),d("u3","u1",m),d("c","t",16777215),d("p","c",o),d("cn1","cn2",o),d("cn3","cn4",o),d("cf1","cf2",o),d("cf3","cf4",o),THREE.LineSegments.call(this,f,g),this.camera=c,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=c.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=j,this.update()},THREE.CameraHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.CameraHelper.prototype.constructor=THREE.CameraHelper,THREE.CameraHelper.prototype.update=function(){function c(j,k,l,m){f.set(k,l,m).unproject(g);var n=e[j];if(n!==void 0)for(var o=0,p=n.length;o<p;o++)d.vertices[n[o]].copy(f)}var d,e,f=new THREE.Vector3,g=new THREE.Camera;return function(){d=this.geometry,e=this.pointMap;var k=1,l=1;g.projectionMatrix.copy(this.camera.projectionMatrix),c("c",0,0,-1),c("t",0,0,1),c("n1",-k,-l,-1),c("n2",k,-l,-1),c("n3",-k,l,-1),c("n4",k,l,-1),c("f1",-k,-l,1),c("f2",k,-l,1),c("f3",-k,l,1),c("f4",k,l,1),c("u1",0.7*k,1.1*l,-1),c("u2",0.7*-k,1.1*l,-1),c("u3",0,2*l,-1),c("cf1",-k,0,1),c("cf2",k,0,1),c("cf3",0,-l,1),c("cf4",0,l,1),c("cn1",-k,0,-1),c("cn2",k,0,-1),c("cn3",0,-l,-1),c("cn4",0,l,-1),d.verticesNeedUpdate=!0}}();
THREE.XLoader=function(t,e,r){const s=MMD_SA.THREEX.THREE;this.txrPath=/\//.test(t)?t.slice(0,t.lastIndexOf("/")+1):"";this.url=t;this.onload=e;this.onerror=r;this.mode=null;this.modeArr=[];this.uvIdx=[];this.txrs={};this.nArr=[];this.uvArr=[];this.vColors=[];this.vId={};this.txrLength=0;this.meshNormalsVector=[];this.gmt=new s.Geometry;this.mtrs=this.MeshFaceMaterial();var i=new XMLHttpRequestZIP;var a=this;i.onload=function(){if(1||i.status===200){if(i.responseType=="arraybuffer"){a.parse(a.shift_jis_decoder.decode(new Uint8Array(i.response)))}else a.parse(i.response)}else{a.onerror&&a.onerror(t,i.statusText)}a=i=null};i.onerror=function(){a.onerror&&a.onerror(t,i.statusText)};i.open("GET",t,true);if(!/\.zip/i.test(t)){i.responseType="arraybuffer"}else i.responseType="text";i.send()};THREE.XLoader.prototype={constructor:THREE.XLoader,MeshFaceMaterial:function(){return MMD_SA.THREEX.enabled?{materials:[]}:new THREE.MeshFaceMaterial},get mesh_material(){return MMD_SA.THREEX.enabled?this.mtrs.materials:this.mtrs},TextureLoader:function(t,e,r,s,i){const a=MMD_SA.THREEX.THREE;var n=new Image;if(i&&i.texture_resolution_limit)n._texture_resolution_limit=i.texture_resolution_limit;var o=new a.Texture(n,e);var h=new self.THREE.ImageLoader;h.addEventListener("load",function(t){o.image=t.content;o.needsUpdate=true;if(r)r(o)});h.addEventListener("error",function(t){if(s)s(t.message)});h.load(t,n);return o},parse:function(t){const e=MMD_SA.THREEX.THREE;var r=this;t.replace(/^xof[\s.]+?\r\n/,"").split("\r\n").forEach(function(t){r.decision(t)});if(this.uvArr.length){this.uvIdx.forEach(function(t){r.gmt.faceVertexUvs[0].push([r.uvArr[t[0]],r.uvArr[t[1]],r.uvArr[t[2]],r.uvArr[t[3]]])})}if(this.vColors.length){this.gmt.faces.forEach(function(t){t.vertexColors=[r.vColors[t.a],r.vColors[t.b],r.vColors[t.c]];isFinite(t.d)&&(t.vertexColors[3]=r.vColors[t.d])})}if(!MMD_SA.THREEX.enabled)this.gmt.computeCentroids();this.gmt.computeFaceNormals();this.gmt.computeVertexNormals();if(MMD_SA.THREEX.enabled){const s=this.gmt.toBufferGeometry();this.gmt.dispose();this.gmt=s}this.gmt.computeBoundingBox();this.gmt.boundingSphere=this.gmt.boundingBox.getBoundingSphere(new e.Sphere);console.log(toLocalPath(this.txrPath)+"\n"+JSON.stringify(this.gmt.boundingBox));!this.txrLength&&this.onload(new e.Mesh(this.gmt,this.mesh_material));this.mode=this.modeArr=this.uvIdx=this.txrs=this.nArr=this.uvArr=this.vColors=this.meshNormalsVector=this.vId=null},decision:function(t){if(!t||/^\s+$/.test(t))return;if(/{.+?}/.test(t)){if(/^\s*TextureFilename/.test(t)){this.TextureFilename(t.match(/{\s*(.+)?\s*}/)[1])}return}else if(/{/.test(t)){this.modeArr.push(this.mode);this.mode=t.match(/^\s*([a-zA-Z]+)/)[1];this.nArr.push(this.n);this.n=0;return}else if(/}/.test(t)){this.mode=this.modeArr.pop();this.n=this.nArr.pop();return}if(this.mode&&!/^(Header|template)$/.test(this.mode)){this.n++;this[this.mode]&&this[this.mode](t)}},toRgb:function(t,e,r){return"rgb("+Math.floor(t*100)+"%,"+Math.floor(e*100)+"%,"+Math.floor(r*100)+"%)"},Mesh:function(t){const e=MMD_SA.THREEX.THREE;t=t.split(";");if(t.length===2&&t[1]===""){return}else if(t.length===3||t[2]===""||t.length===2&&/,/.test(t[1])){var r=t[1].split(",");if(/3/.test(t[0])){this.gmt.faces.push(new e.Face3(+r[2],+r[1],+r[0]));this.uvIdx.push([+r[2],+r[1],+r[0]])}else{this.gmt.faces.push(new e.Face4(+r[3],+r[2],+r[1],+r[0]));this.uvIdx.push([+r[3],+r[2],+r[1],+r[0]])}}else{var s=t.join(";"),i=this.vId[s]=this.vId[s]||new e.Vector3(+t[0],+t[1],-t[2]);this.gmt.vertices.push(i)}},MeshNormals:function(t){const e=MMD_SA.THREEX.THREE;t=t.split(";");if(t.length===2){return}else if(t.length===3||t[2]===""){!this.faceN&&(this.faceN=this.n);var r=t[1].split(",");if(/3/.test(t[0])){this.gmt.faces[this.n-this.faceN].normal=this.meshNormalsVector[+r[0]]}else{this.gmt.faces[this.n-this.faceN].normal=this.meshNormalsVector[+r[0]]}}else{this.meshNormalsVector.push(new e.Vector3(+t[0],+t[1],-t[2]))}},MeshMaterialList:function(t){if(this.n<3)return;this.gmt.faces[this.n-3].materialIndex=+t.match(/[0-9]+/)[0]},Material:function(t){const e=MMD_SA.THREEX.THREE;t=t.split(";");const r=this.material_para[this.mtrs.materials.length]||this.material_para._default_||{};if(this.n===1){this.mtr=new e.MeshPhongMaterial({color:this.toRgb(t[0],t[1],t[2]),opacity:+t[3]});if(r.side==2)this.mtr.side=e.DoubleSide;if(r.transparent===false)this.mtr.transparent=false;if(r.opacity!=null)this.mtr.opacity=r.opacity;if(r.alphaTest!=null)this.mtr.alphaTest=r.alphaTest;this.transparency_check(r);if(MMD_SA.THREEX.enabled){const s=new e.Color;s.setStyle(r.ambient||"#FFF");this.mtr.color.setStyle(r.ambient||this.toRgb(t[0]*s.r,t[1]*s.g,t[2]*s.b))}else{this.mtr.base_color=[t[0],t[1],t[2]].join(",");this.mtr.color.setStyle("#FFF");this.mtr.ambient.setStyle(r.ambient||"#FFF")}this.mtrs.materials.push(this.mtr)}else if(this.n===2){this.mtr.shininess=+t[0]||5}else if(this.n===3){this.mtr.specular.setStyle("#000")}else if(this.n===4){const s=new e.Color;if(MMD_SA.THREEX.enabled)s.setStyle("#000");this.mtr.emissive.setStyle(this.toRgb(t[0]*s.r,t[1]*s.g,t[2]*s.b))}},transparency_check:function(){var r=0;var s=0;window.addEventListener("MMDStarted",function(){if(r)console.log("X object opaque/total material count:"+s+"/"+r)});return function(t,e){if(!e){r++;if(this.mtr.opacity==1)this.mtr.transparent=false;if(!this.mtr.transparent)s++;return}if(t.transparent===false||this.mtr.opacity==1&&/\.jpg$/i.test(e)&&!/\.jpga\.jpg$/i.test(e)){this.mtr.transparent=false}else{this.mtr.transparent=true;s--}}}(),shift_jis_decoder:new TextDecoder("shift-jis"),TextureFilename:function(s){const c=MMD_SA.THREEX.THREE;s=s.split('"')[1].split(/\\+/).join("/").split("*")[0];var e=this.material_para[this.mtrs.materials.length-1]||this.material_para._default_||{};var r=toFileProtocol(e.txrPath||this.txrPath);s=e.row||s;if(this.mtr.base_color){this.mtr.color.setArray(this.mtr.base_color.split(",").map(function(t){return parseFloat(t)*255}));delete this.mtr.base_color;this.mtr.ambient.setStyle(e.ambient||"#444")}if(this.txrs[s]){this.mtr.map=this.txrs[s];this.transparency_check(e,s);return}if(!FSO_OBJ.FileExists(toLocalPath(r+s))){console.error("Texture file not found ("+toLocalPath(r+s)+")");return}var p=this;this.txrLength++;if(MMD_SA_options.child_animation_as_texture&&MMD_SA_options.child_animation_as_texture_swap_list){let r=0;MMD_SA_options.child_animation_as_texture_swap_list.forEach(function(t,e){if(s.indexOf(t)==-1)return;p.mtr.map=p.txrs[s]=jThree("#ChildAnimation"+e+"TXR").three(0);r++});if(r){if(--p.txrLength==0)p.onload(new c.Mesh(p.gmt,p.mesh_material));return}}const i=/\.zip\#/i.test(toLocalPath(r));const t=s.replace(/\.(png|jpg|bmp|jpeg|tga)$/i,"_normal."+(e.use_normal_jpg?"jpg":"png"));const a=r+t;if(e.use_normal||(browser_native_mode||i?e.use_normal:FSO_OBJ.FileExists(toLocalPath(a)))){if(this.txrs[t]){this.mtr.normalMap=this.txrs[t];return}this.txrLength++;this.mtr.normalMap=this.txrs[t]=p.TextureLoader(r+t,undefined,function(){if(--p.txrLength)return;p.onload(new c.Mesh(p.gmt,p.mesh_material));p=null},function(){if(--p.txrLength)return;p.onerror(new c.Mesh(p.gmt,p.mesh_material));p=null});this.mtr.normalMap.wrapS=this.mtr.normalMap.wrapT=c.RepeatWrapping;console.log("Normal map",t)}const n=s.replace(/\.(png|jpg|bmp|jpeg|tga)$/i,"_specular."+(e.use_specular_jpg?"jpg":"png"));const o=r+n;if(e.use_specular||(browser_native_mode||i?e.use_specular:FSO_OBJ.FileExists(toLocalPath(o)))){if(this.txrs[n]){this.mtr.specularMap=this.txrs[n];return}this.txrLength++;this.mtr.specularMap=this.txrs[n]=p.TextureLoader(r+n,undefined,function(m){const u=s.replace(/\.(png|jpg|bmp|jpeg|tga)$/i,"_metalness."+(e.use_metalness_jpg?"jpg":"png"));const t=r+u;if(e.use_metalness||(browser_native_mode||i?e.use_metalness:FSO_OBJ.FileExists(toLocalPath(t)))){p.TextureLoader(r+u,undefined,function(t){let e=document.createElement("canvas");let r=e.width=m.image.width;let s=e.height=m.image.height;let i=e.getContext("2d");i.drawImage(m.image,0,0);let a=i.getImageData(0,0,r,s);let n=a.data;i.drawImage(t.image,0,0,t.image.width,t.image.height,0,0,r,s);let o=i.getImageData(0,0,r,s).data;for(var h=0,l=n.length;h<l;h+=4){n[h+1]=o[h+1]}i.putImageData(a,0,0);t.image=e;a=n=o=undefined;console.log("Metal map merged with specular map",u);if(--p.txrLength)return;p.onload(new c.Mesh(p.gmt,p.mesh_material));p=null});return}else if(!e.use_specular_as_metalness){let t=document.createElement("canvas");let e=t.width=m.image.width;let r=t.height=m.image.height;let s=t.getContext("2d");s.drawImage(m.image,0,0);let i=s.getImageData(0,0,e,r);let a=i.data;for(var n=0,o=a.length;n<o;n+=4){a[n+1]=a[n+2]=0}s.putImageData(i,0,0);m.image=t;i=a=undefined}if(--p.txrLength)return;p.onload(new c.Mesh(p.gmt,p.mesh_material));p=null},function(){if(--p.txrLength)return;p.onerror(new c.Mesh(p.gmt,p.mesh_material));p=null});this.mtr.specular.setStyle("rgb(100%,100%,100%)");this.mtr.specularMap.wrapS=this.mtr.specularMap.wrapT=c.RepeatWrapping;console.log("Specular map",n)}this.mtr.map=this.txrs[s]=this.TextureLoader(r+s,undefined,function(){if(--p.txrLength)return;p.onload(new c.Mesh(p.gmt,p.mesh_material));p=null},function(){if(--p.txrLength)return;p.onerror(new c.Mesh(p.gmt,p.mesh_material));p=null});this.mtr.map.wrapS=this.mtr.map.wrapT=c.RepeatWrapping;this.transparency_check(e,s)},MeshTextureCoords:function(t){const e=MMD_SA.THREEX.THREE;if(this.n===1)return;t=t.split(";");var r;t[1]=1-t[1];r=+t[0];t[0]=r;r=t[1];t[1]=r;this.uvArr.push(new e.Vector2(t[0],t[1]))},MeshVertexColors:function(t){return;if(this.n===1){this.mtrs.materials.forEach(function(t){this.vertexColors=THREE.VertexColors});return}t=t.split(";");this.vColors[+t[0]]=new THREE.Color(this.toRgb(t[1],t[2],t[3]))},_material_para:null,get material_para(){if(this._material_para)return this._material_para;this._material_para={};const t=toLocalPath(this.url).replace(/^.+[\/\\]/,"");const e=t.replace(/[\-\_]copy\d+\.x$/,".x").replace(/[\-\_]v\d+\.x$/,".x");const r=MMD_SA_options.model_para[t]||MMD_SA_options.model_para[e];this._material_para=r&&r.material_para||this._material_para;return this._material_para}};jThree.modelHooks.x=function(i,a,n){new THREE.XLoader(i,function(t){if(!a)return;var e=toLocalPath(i).replace(/^.+[\/\\]/,"");var r=e.replace(/[\-\_]copy\d+\.x$/,".x").replace(/[\-\_]v\d+\.x$/,".x");var s=MMD_SA_options.model_para[e]||MMD_SA_options.model_para[r];if(s&&s.instanced_drawing)t.instanced_drawing=s.instanced_drawing;a(t);a=n=null},function(){n();a=n=null})};
THREE.ShadowMapPlugin=function(){function a(x){t!==x&&(x===THREE.CullFaceNone?f.disable(f.CULL_FACE):(f.enable(f.CULL_FACE),x===THREE.CullFaceBack?f.cullFace(f.BACK):x===THREE.CullFaceFront?f.cullFace(f.FRONT):x===THREE.CullFaceFrontBack?f.cullFace(f.FRONT_AND_BACK):void 0),t=x)}function b(x,y){var z=new THREE.DirectionalLight;z.isVirtual=!0,z.onlyShadow=!0,z.castShadow=!0,z.shadowCameraNear=x.shadowCameraNear,z.shadowCameraFar=x.shadowCameraFar,z.shadowCameraLeft=x.shadowCameraLeft,z.shadowCameraRight=x.shadowCameraRight,z.shadowCameraBottom=x.shadowCameraBottom,z.shadowCameraTop=x.shadowCameraTop,z.shadowCameraVisible=x.shadowCameraVisible,z.shadowDarkness=x.shadowDarkness,z.shadowBias=x.shadowCascadeBias[y],z.shadowMapWidth=x.shadowCascadeWidth[y],z.shadowMapHeight=x.shadowCascadeHeight[y],z.shadowBias_range=x.shadowBias_range,z.pointsWorld=[],z.pointsFrustum=[];for(var A=z.pointsWorld,B=z.pointsFrustum,C=0;8>C;C++)A[C]=new THREE.Vector3,B[C]=new THREE.Vector3;var D=x.shadowCascadeNearZ[y],E=x.shadowCascadeFarZ[y];return B[0].set(-1,-1,D),B[1].set(1,-1,D),B[2].set(-1,1,D),B[3].set(1,1,D),B[4].set(-1,-1,E),B[5].set(1,-1,E),B[6].set(-1,1,E),B[7].set(1,1,E),z}function c(x,y){var z=x.shadowCascadeArray[y];z.position.copy(x.position),z.target.position.copy(x.target.position),z.lookAt(z.target.position),z.shadowCameraVisible=x.shadowCameraVisible,z.shadowDarkness=x.shadowDarkness,z.shadowBias=x.shadowCascadeBias[y];var A=x.shadowCascadeNearZ[y],B=x.shadowCascadeFarZ[y],C=z.pointsFrustum;C[0].z=A,C[1].z=A,C[2].z=A,C[3].z=A,C[4].z=B,C[5].z=B,C[6].z=B,C[7].z=B}function d(x,y){var z=y.shadowCamera,A=y.pointsFrustum,B=y.pointsWorld;u.set(Infinity,Infinity,Infinity),v.set(-Infinity,-Infinity,-Infinity);for(var D,C=0;8>C;C++)D=B[C],D.copy(A[C]),D.unproject(x),D.applyMatrix4(z.matrixWorldInverse),D.x<u.x&&(u.x=D.x),D.x>v.x&&(v.x=D.x),D.y<u.y&&(u.y=D.y),D.y>v.y&&(v.y=D.y),D.z<u.z&&(u.z=D.z),D.z>v.z&&(v.z=D.z);z.left=u.x,z.right=v.x,z.top=v.y,z.bottom=u.y,z.updateProjectionMatrix()}function e(x){var y;return y=x.object.material,y instanceof THREE.MeshFaceMaterial&&(y=y.materials[x.buffer.materialIndex]),y}var f,g,h,l,o,q,t,r=new THREE.Frustum,s=new THREE.Matrix4,u=new THREE.Vector3,v=new THREE.Vector3,w=new THREE.Vector3;this.init=function(x){f=x.context,g=x;var y=THREE.ShaderLib.depthRGBA,z=THREE.UniformsUtils.clone(y.uniforms);h=new THREE.ShaderMaterial({fragmentShader:y.fragmentShader,vertexShader:y.vertexShader,uniforms:z}),l=new THREE.ShaderMaterial({fragmentShader:y.fragmentShader,vertexShader:y.vertexShader,uniforms:z,morphTargets:!0}),o=new THREE.ShaderMaterial({fragmentShader:y.fragmentShader,vertexShader:y.vertexShader,uniforms:z,skinning:!0}),q=new THREE.ShaderMaterial({fragmentShader:y.fragmentShader,vertexShader:y.vertexShader,uniforms:z,morphTargets:!0,skinning:!0}),this._switch_material=function(){var A={},B;return function(C,D){B=null==C._model_index_default?-1:C._model_index_default;var E=A[B];return E||(E=A[B]={_depthMaterialMorphSkin:q.clone(),_depthMaterialSkin:o.clone()}),D?E._depthMaterialMorphSkin:E._depthMaterialSkin}}(),h._shadowPass=!0,l._shadowPass=!0,o._shadowPass=!0,q._shadowPass=!0},this.render=function(x,y){g.shadowMapEnabled&&g.shadowMapAutoUpdate&&this.update(x,y)},this.update=function(x,y){var z,A,B,C,D,E,F,G,H,I,J,K,L,M,N=[],O=0,P=null;f.clearColor(1,1,1,1),f.disable(f.BLEND),f.frontFace(f.CCW),a(g.shadowMapCullFace),g.setDepthTest(!0);var Q=-1;for(z=0,A=x.__lights.length;z<A;z++)if(L=x.__lights[z],L.isVirtual||(L instanceof THREE.DirectionalLight?(Q++,!L._shadowPara&&(L._shadowPara=new THREE.Vector3(0,Q,0))):!L._shadowPara&&(L._shadowPara=new THREE.Vector3(1,0,0))),!!L.castShadow)if(L instanceof THREE.DirectionalLight&&L.shadowCascade)for(D=0;D<L.shadowCascadeCount;D++){var R;L.shadowCascadeArray[D]?R=L.shadowCascadeArray[D]:(R=b(L,D),R.originalCamera=y,R._shadowPara=L._shadowPara.clone(),x.add(R),L.shadowCascadeArray[D]=R,console.log("Created virtualLight",R)),c(L,D),N[O]=R,O++}else{if(L.isVirtual)continue;N[O]=L,O++}var S={},T=[],U=[];for(let aa=0,ba=N.length;aa<ba;aa++)T[aa]=0,U[aa]=0;for(z=0,A=N.length;z<A;z++){if(L=N[z],!L.shadowMap){var V=THREE.LinearFilter;g.shadowMapType===THREE.PCFSoftShadowMap&&(V=THREE.NearestFilter);var W={minFilter:V,magFilter:V,format:THREE.RGBAFormat};L.shadowMap=new THREE.WebGLRenderTarget(L.shadowMapWidth,L.shadowMapHeight,W),L.shadowMapSize=new THREE.Vector2(L.shadowMapWidth,L.shadowMapHeight),L.shadowMatrix=new THREE.Matrix4}if(!L.shadowCamera){if(L instanceof THREE.SpotLight)L.shadowCamera=new THREE.PerspectiveCamera(L.shadowCameraFov,L.shadowMapWidth/L.shadowMapHeight,L.shadowCameraNear,L.shadowCameraFar);else if(L instanceof THREE.DirectionalLight)L.shadowCamera=new THREE.OrthographicCamera(L.shadowCameraLeft,L.shadowCameraRight,L.shadowCameraTop,L.shadowCameraBottom,L.shadowCameraNear,L.shadowCameraFar);else{console.error("Unsupported light type for shadow");continue}x.add(L.shadowCamera),!0===x.autoUpdate&&x.updateMatrixWorld()}for(L.shadowCameraVisible&&!L.cameraHelper&&(L.cameraHelper=new THREE.CameraHelper(L.shadowCamera),L.shadowCamera.add(L.cameraHelper)),L.isVirtual&&R.originalCamera==y&&d(y,L),E=L.shadowMap,F=L.shadowMatrix,G=L.shadowCamera,G.position.copy(L.position),G.lookAt(L.target.position),G.updateMatrixWorld(),G.matrixWorldInverse.getInverse(G.matrixWorld),L._shadowBias_range||(!L.shadowBias_range&&(L.shadowBias_range=[0.1,100]),L._shadowBias_range=new THREE.Vector3(0,L.shadowBias_range[0],L.shadowBias_range[1])),L._shadowBias_range.x=L.shadowBias,L.cameraHelper&&(L.cameraHelper.visible=L.shadowCameraVisible),L.shadowCameraVisible&&L.cameraHelper.update(),F.set(0.5,0,0,0.5,0,0.5,0,0.5,0,0,0.5,0.5,0,0,0,1),F.multiply(G.projectionMatrix),F.multiply(G.matrixWorldInverse),s.multiplyMatrices(G.projectionMatrix,G.matrixWorldInverse),r.setFromMatrix(s),g.setRenderTarget(E),g.clear(),M=x.__webglObjects,(B=0,C=M.length);B<C;B++)if(J=M[B],X=e(J),K=J.object,J.render=!1,K.visible&&K.castShadow&&(void 0===X.castShadow||X.castShadow)&&(!(K instanceof THREE.Mesh||K instanceof THREE.ParticleSystem)||!K.frustumCulled||r.intersectsOrContainsObject(K))){if(T[z]++,S[B]){U[z]++;continue}r._containing&&(S[B]=!0),K._modelViewMatrix.multiplyMatrices(G.matrixWorldInverse,K.matrixWorld),J.render=!0}var X,Y,Z;for(B=0,C=M.length;B<C;B++)J=M[B],J.render&&(K=J.object,H=J.buffer,X=e(J),void 0===X.shadowMapCullFace?a(g.shadowMapCullFace):a(X.shadowMapCullFace),Y=0<K.geometry.morphTargets.length&&X.morphTargets,Z=K instanceof THREE.SkinnedMesh&&X.skinning,I=K.customDepthMaterial?K.customDepthMaterial:Z?this._switch_material(K,Y):Y?l:h,H instanceof THREE.BufferGeometry?g.renderBufferDirect(G,x.__lights,P,I,H,K):g.renderBuffer(G,x.__lights,P,I,H,K));for(a(g.shadowMapCullFace),M=x.__webglObjectsImmediate,(B=0,C=M.length);B<C;B++)J=M[B],K=J.object,K.visible&&K.castShadow&&(K._modelViewMatrix.multiplyMatrices(G.matrixWorldInverse,K.matrixWorld),g.renderImmediateObject(G,x.__lights,P,h,K))}var $=g.getClearColor(),_=g.getClearAlpha();f.clearColor($.r,$.g,$.b,_),f.enable(f.BLEND),a(THREE.CullFaceBack)}};
THREE.ShaderLib.mirror={uniforms:{mirrorSampler:{type:"t",value:null},mirrorPosition:{type:"v3",value:new THREE.Vector3(0,0,0)},reflection_state:{type:"i",value:0},reflection_alpha:{type:"f",value:1},fade_radius:{type:"f",value:15},fade_min:{type:"f",value:1},fade_max:{type:"f",value:1},depth_render_mode:{type:"i",value:0},baseTexture:{type:"t",value:null},baseSpeed:{type:"f",value:0},noiseTexture:{type:"t",value:null},noiseScale:{type:"f",value:0},bumpScale:{type:"f",value:5},vUv_scale:{type:"v2",value:new THREE.Vector2(1,1)},time:{type:"f",value:0},nIntensity:{type:"f",value:0},sIntensity:{type:"f",value:0.5},sCount:{type:"f",value:512},textureMatrix:{type:"m4",value:new THREE.Matrix4}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 mirrorCoord;","varying vec3 vWorldPosition;","varying vec2 vUv;","uniform sampler2D noiseTexture;","uniform float time;","uniform float baseSpeed;","uniform float bumpScale;","void main() {","vUv = uv;","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","mirrorCoord = textureMatrix * worldPosition;","vec3 bumpedPosition = position;","vec4 mvPosition;","if (baseSpeed > 0.0) {","  vec2 uvTimeShift = vUv + vec2( 1.1, 1.9 ) * time * 0.15;","  vec4 bumpData = texture2D( noiseTexture, uvTimeShift );","  float displacement = (bumpData.g - 0.25) * bumpScale;","  bumpedPosition = bumpedPosition + normal * displacement;","}","mvPosition = modelViewMatrix * vec4( bumpedPosition, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform sampler2D mirrorSampler;","varying vec4 mirrorCoord;","varying vec3 vWorldPosition;","uniform vec3 mirrorPosition;","uniform int reflection_state;","uniform float reflection_alpha;","uniform float fade_radius;","uniform float fade_min;","uniform float fade_max;","uniform vec2 vUv_scale;","varying vec2 vUv;","uniform sampler2D baseTexture;","uniform float baseSpeed;","uniform sampler2D noiseTexture;","uniform float noiseScale;","uniform float time;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","vec4 FilmShader(vec4 cTextureScreen, vec2 vUv) {","float x = vUv.x * vUv.y * time *  1000.0;","x = mod( x, 13.0 ) * mod( x, 123.0 );","float dx = mod( x, 0.01 );","vec3 cResult = cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );","vec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );","cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","cResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );","return vec4( cResult, cTextureScreen.a );","}",THREE.ShaderChunk.AT_depth_render_mode_pars_fragment,"void main() {",THREE.ShaderChunk.AT_depth_render_mode_fragment,"vec4 color;","if (reflection_state == 0) {","  color = texture2DProj(mirrorSampler, mirrorCoord);","} else if (reflection_state == 1) {","  color = texture2D( mirrorSampler, vUv * vUv_scale + (1.0-vUv_scale)/2.0);","} else {","  color = vec4(0,0,0,0);","}","vec4 baseColor;","if (baseSpeed > 0.0) {","  vec2 uvTimeShift = vUv + vec2( -0.7, 1.5 ) * time * baseSpeed;","  vec4 noiseGeneratorTimeShift = texture2D( noiseTexture, uvTimeShift );","  vec2 uvNoiseTimeShift = vUv + noiseScale * vec2( noiseGeneratorTimeShift.r, noiseGeneratorTimeShift.b );","  baseColor = texture2D( baseTexture, uvNoiseTimeShift );","}","else {","  baseColor = texture2D( baseTexture, vUv );","}","color = vec4(mix(color.rgb, baseColor.rgb, baseColor.a * (1.0 - color.a*reflection_alpha)), baseColor.a + ((1.0-baseColor.a) * color.a*reflection_alpha));","if (nIntensity > 0.0) {","  color = FilmShader(color, vUv);","}","if ((fade_max < 1.0) || (fade_min < 1.0)) {","  if (fade_max != fade_min) {","    float fade_distance = distance(vWorldPosition, mirrorPosition);","    float fade_ratio = pow(fade_distance/fade_radius, 2.0);","    color.a *= mix(fade_max, fade_min, fade_ratio);","  } else {","    color.a *= fade_max;","  }","}","gl_FragColor = color;","}"].join("\n")},THREE.FlatMirror=function(a,b,d){function f(){self.MMD_SA&&MMD_SA.use_webgl2&&!is_mobile&&(this.texture._use_multisample=4),[this.texture,this.tempTexture].forEach(function(y){y.generateMipmaps=!1,y.minFilter=y.magFilter}),this.updateTextureMatrix(),this.render()}THREE.Object3D.call(this),this.name="flatMirror_"+this.id,d=d||{},this.matrixNeedsUpdate=!0;var g=void 0===d.textureWidth?512:d.textureWidth,h=void 0===d.textureHeight?512:d.textureHeight;this.clipBias=void 0===d.clipBias?0:d.clipBias,this.renderer=a,this.mirrorPlane=new THREE.Plane,this.normal=new THREE.Vector3(0,0,1),this.mirrorWorldPosition=new THREE.Vector3,this.cameraWorldPosition=new THREE.Vector3,this.rotationMatrix=new THREE.Matrix4,this.lookAtPosition=new THREE.Vector3(0,0,-1),this.clipPlane=new THREE.Vector4;var i=void 0!==d.debugMode&&d.debugMode;if(i){var j=new THREE.ArrowHelper(new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,0),10,16777088),k=new THREE.Geometry;k.vertices.push(new THREE.Vector3(-10,-10,0)),k.vertices.push(new THREE.Vector3(10,-10,0)),k.vertices.push(new THREE.Vector3(10,10,0)),k.vertices.push(new THREE.Vector3(-10,10,0)),k.vertices.push(k.vertices[0]);var l=new THREE.Line(k,new THREE.LineBasicMaterial({color:16777088}));this.add(j),this.add(l)}b instanceof THREE.PerspectiveCamera?this.camera=b:(this.camera=new THREE.PerspectiveCamera,console.log(this.name+": camera is not a Perspective Camera!")),this.textureMatrix=new THREE.Matrix4,this.mirrorCamera=this.camera.clone();var m={stencilBuffer:!1};this.texture=new THREE.WebGLRenderTarget(g,h,m),this.tempTexture=new THREE.WebGLRenderTarget(g,h,m);var n=THREE.ShaderLib.mirror,o=THREE.UniformsUtils.clone(n.uniforms);if(this.material=new THREE.ShaderMaterial({fragmentShader:n.fragmentShader,vertexShader:n.vertexShader,uniforms:o}),this.material.uniforms.mirrorSampler.value=this.texture,this.material.uniforms.textureMatrix.value=this.textureMatrix,self.MMD_SA){this.mirrorCamera.matrixAutoUpdate=!0,this.mirror_index=d.mirror_index,this.clip_y=d.clip_y;var p=MMD_SA.mirror_obj[this.mirror_index],r=this.material.uniforms;if(p.reflection_state||(this.mirrorCamera.fov*=1.75),r.baseTexture.value=/^\#/.test(p.baseTexture)?jThree(p.baseTexture).three(0):THREE.ImageUtils.loadTexture(toFileProtocol(p.baseTexture)),r.reflection_state.value=p.reflection_state||0,null!=p.reflection_alpha&&(r.reflection_alpha.value=p.reflection_alpha),null!=p.fade_radius&&(r.fade_radius.value=p.fade_radius),null!=p.fade_min&&(r.fade_min.value=p.fade_min),null!=p.fade_max&&(r.fade_max.value=p.fade_max),this.time_ref=performance.now(),r.time.value=p.time||0,null!=p.baseSpeed){r.baseSpeed.value=p.baseSpeed||0.5;var s=new THREE.ImageUtils.loadTexture(toFileProtocol(p.noiseTexture));s.wrapS=s.wrapT=THREE.RepeatWrapping,r.noiseTexture.value=s,r.noiseScale.value=p.noiseScale||0.5337,p.bumpScale||(p.bumpScale=5),r.bumpScale.value=p.bumpScale}null!=p.nIntensity&&(r.nIntensity.value=p.nIntensity,null!=p.sIntensity&&(r.sIntensity.value=p.sIntensity),null!=p.sCount&&(r.sCount.value=p.sCount))}var t=this;self.MMD_SA&&!MMD_SA.WebGL_initialized?window.addEventListener("WebGL_initialized",()=>{f.call(t,g,h)}):f.call(t,g,h)},THREE.FlatMirror.prototype=Object.create(THREE.Object3D.prototype),THREE.FlatMirror.prototype.renderWithMirror=function(a){this.updateTextureMatrix(),this.matrixNeedsUpdate=!1;var b=a.camera;a.camera=this.mirrorCamera,a.renderTemp(),a.material.uniforms.mirrorSampler.value=a.tempTexture,this.render(),this.matrixNeedsUpdate=!0,a.material.uniforms.mirrorSampler.value=a.texture,a.camera=b,a.updateTextureMatrix()},THREE.FlatMirror.prototype.updateTextureMatrix=function(){var a=new THREE.Vector4,b,d=new THREE.Vector3;return function(){function e(s){return s?0>s?-1:1:0}this.updateMatrixWorld(),this.camera.updateMatrixWorld(),this.mirrorWorldPosition.getPositionFromMatrix(this.matrixWorld),this.cameraWorldPosition.getPositionFromMatrix(this.camera.matrixWorld),this.rotationMatrix.extractRotation(this.matrixWorld),this.normal.set(0,0,1),this.normal.applyMatrix4(this.rotationMatrix);var f=self.MMD_SA&&jThree(this._mesh_id).three(0);if(!f||1!=f.material.uniforms.reflection_state.value){var g=this.mirrorWorldPosition.clone().sub(this.cameraWorldPosition),h=g.reflect(this.normal);h.add(this.mirrorWorldPosition),this.rotationMatrix.extractRotation(this.camera.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition);var i=this.mirrorWorldPosition.clone().sub(this.lookAtPosition),j=i.reflect(this.normal);j.add(this.mirrorWorldPosition),this.up.set(0,-1,0),this.up.applyMatrix4(this.rotationMatrix);var k=this.up.reflect(this.normal);this.mirrorCamera.position.copy(h),this.mirrorCamera.up=k,this.mirrorCamera.lookAt(j)}if(this.mirrorCamera.updateProjectionMatrix(),this.mirrorCamera.updateMatrixWorld(),this.mirrorCamera.matrixWorldInverse.getInverse(this.mirrorCamera.matrixWorld),this.textureMatrix.set(0.5,0,0,0.5,0,0.5,0,0.5,0,0,0.5,0.5,0,0,0,1),this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix),this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse),f){var l=MMD_SA.mirror_obj[this.mirror_index];null!=l.renderDepth&&(f.renderDepth=l.renderDepth,l.renderDepth=null);var m=f.material.uniforms;if(m.textureMatrix.value=this.textureMatrix,m.mirrorPosition.value=this.mirrorWorldPosition,!this._baseTexture_loaded){var n=m.baseTexture.value;n&&n.image&&(n.image.complete&&n.image.src||n.image._canvas_ready)&&(n.image._canvas_ready?n.needsUpdate=jThree(l.baseTexture).three(0).needsUpdate:(this._baseTexture_loaded=!0,n.needsUpdate=!0))}if(!this._noiseTexture_loaded){var n=m.noiseTexture.value;n&&n.image&&n.image.complete&&n.image.src&&(this._noiseTexture_loaded=!0,n.needsUpdate=!0)}if(!l.vUv_scale)if(l.plane){var o=Math.max(l.plane[0],l.plane[1]);l.vUv_scale=new THREE.Vector2(l.plane[0]/o,l.plane[1]/o)}else l.vUv_scale=new THREE.Vector2(1,1);m.vUv_scale.value=l.vUv_scale;var p=performance.now();m.time.value+=(p-this.time_ref)/1e3,this.time_ref=p}if(f&&1!=f.material.uniforms.reflection_state.value){d.copy(this.mirrorWorldPosition),null!=this.clip_y&&(d.y=this.clip_y),this.mirrorPlane.setFromNormalAndCoplanarPoint(this.normal,d),this.mirrorPlane.applyMatrix4(this.mirrorCamera.matrixWorldInverse),this.clipPlane.set(this.mirrorPlane.normal.x,this.mirrorPlane.normal.y,this.mirrorPlane.normal.z,this.mirrorPlane.constant);var r=this.mirrorCamera.projectionMatrix;a.x=(e(this.clipPlane.x)+r.elements[8])/r.elements[0],a.y=(e(this.clipPlane.y)+r.elements[9])/r.elements[5],a.z=-1,a.w=(1+r.elements[10])/r.elements[14],b=this.clipPlane.multiplyScalar(2/this.clipPlane.dot(a)),r.elements[2]=b.x,r.elements[6]=b.y,r.elements[10]=b.z+1-this.clipBias,r.elements[14]=b.w}}}(),THREE.FlatMirror.prototype.render=function(a){var b=self.MMD_SA&&jThree(this._mesh_id).three(0);if(!b||b.visible){this.matrixNeedsUpdate&&this.updateTextureMatrix(),this.matrixNeedsUpdate=!0;for(var d=this;void 0!==d.parent;)d=d.parent;if(b&&b.visible){var e,f,g,h,i={};if(e=b.material.uniforms.reflection_state,f=e.value,e.value=-1,self.MMD_SA&&(g=MMD_SA.mirror_obj[this.mirror_index],h=g.skip_reflection_list,!h&&(h=[this._mesh_id]),h.forEach(function(l){var m=/^\#(.+)$/.test(l)?MMD_SA_options.mesh_obj_by_id[RegExp.$1]:MMD_SA_options.x_object_by_name[l];m&&m.visible&&(i[l]=!0,m.hide())})),void 0!==d&&d instanceof THREE.Scene&&this.renderer.render(d,this.mirrorCamera,a||this.texture,!0),e.value=f,self.MMD_SA)for(var j in i){var k=/^\#(.+)$/.test(j)?MMD_SA_options.mesh_obj_by_id[RegExp.$1]:MMD_SA_options.x_object_by_name[j];k&&k.show()}}}},THREE.FlatMirror.prototype.renderTemp=function(){this.render(this.tempTexture)},THREE.MirrorMaterial=function(a){var b=jThree(a.camera).three(0),d=new THREE.FlatMirror(null,b,a);return MMD_SA._THREE_mirror.push(d),d.material._mirror=d,d._mesh_id=a.mesh,d._renderer_id=a.renderer,d.material},THREE.Math.isPowerOfTwo=function(a){return 0==(a&a-1)},THREE.Vector3.prototype.setFromMatrixPosition=THREE.Vector3.prototype.getPositionFromMatrix,THREE.PerspectiveCamera.prototype.clone=function(){var a=new THREE.PerspectiveCamera;return THREE.Camera.prototype.clone.call(this,a),a.zoom=this.zoom,a.fov=this.fov,a.aspect=this.aspect,a.near=this.near,a.far=this.far,a.projectionMatrix.copy(this.projectionMatrix),a};
THREE.TrackballControls=function(a,b){function c(F){m.enabled&&(F.preventDefault(),F.stopPropagation(),o===n.NONE&&(o=F.button),o!==n.ROTATE||m.noRotate?o!==n.ZOOM||m.noZoom?o===n.PAN&&!m.noPan&&(x=m.getMouseOnScreen(F.pageX,F.pageY,x),y.copy(x)):(t=m.getMouseOnScreen(F.pageX,F.pageY,t),u.copy(t)):(q=m.getMouseProjectionOnBall(F.pageX,F.pageY,q),r.copy(q),m.rotate_with_up_fixed&&A.copy(m.getMouseOnScreen_fixed_up(F.pageX,F.pageY,z))),document.addEventListener("mousemove",f,!1),document.addEventListener("mouseup",g,!1))}function f(F){m.enabled&&(F.preventDefault(),F.stopPropagation(),o!==n.ROTATE||m.noRotate?o!==n.ZOOM||m.noZoom?o===n.PAN&&!m.noPan&&(y=m.getMouseOnScreen(F.pageX,F.pageY,y)):u=m.getMouseOnScreen(F.pageX,F.pageY,u):(r=m.getMouseProjectionOnBall(F.pageX,F.pageY,r),m.rotate_with_up_fixed&&m.getMouseOnScreen_fixed_up(F.pageX,F.pageY,A)))}function g(F){m.enabled&&(F.preventDefault(),F.stopPropagation(),o=n.NONE,document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",g))}function h(F){if(m.enabled){F.preventDefault(),F.stopPropagation();var G=0;F.deltaY?G=F.deltaY/(0==F.deltaMode?40:1):F.wheelDelta?G=F.wheelDelta/40:F.detail&&(G=-F.detail/3),t.y+=0.01*G}}function j(F){if(!1!==m.enabled){for(var G=[],H=0;H<F.touches.length;H++)"Ljoystick"!=F.touches[H].target.id&&G.push(F.touches[H]);switch(G.length!=F.touches.length&&(F={touches:G}),F.touches.length){case 1:o=n.TOUCH_ROTATE,r.copy(m.getMouseProjectionOnBall(F.touches[0].pageX,F.touches[0].pageY,q)),m.rotate_with_up_fixed&&A.copy(m.getMouseOnScreen_fixed_up(F.touches[0].pageX,F.touches[0].pageY,z));break;case 2:o=n.TOUCH_ZOOM;var I=F.touches[0].pageX-F.touches[1].pageX,J=F.touches[0].pageY-F.touches[1].pageY;w=v=Math.sqrt(I*I+J*J);break;case 3:o=n.TOUCH_PAN,y.copy(m.getMouseOnScreen(F.touches[0].pageX,F.touches[0].pageY,x));break;default:o=n.NONE;}}}function k(F){if(!1!==m.enabled){F.preventDefault(),F.stopPropagation();for(var G=[],H=0;H<F.touches.length;H++)"Ljoystick"!=F.touches[H].target.id&&G.push(F.touches[H]);switch(G.length!=F.touches.length&&(F={touches:G}),F.touches.length){case 1:r=m.getMouseProjectionOnBall(F.touches[0].pageX,F.touches[0].pageY,r),m.rotate_with_up_fixed&&m.getMouseOnScreen_fixed_up(F.touches[0].pageX,F.touches[0].pageY,A);break;case 2:var I=F.touches[0].pageX-F.touches[1].pageX,J=F.touches[0].pageY-F.touches[1].pageY;w=Math.sqrt(I*I+J*J);break;case 3:y=m.getMouseOnScreen(F.touches[0].pageX,F.touches[0].pageY,y);break;default:o=n.NONE;}}}function l(F){if(!1!==m.enabled){for(var G=[],H=0;H<F.touches.length;H++)"Ljoystick"!=F.touches[H].target.id&&G.push(F.touches[H]);switch(G.length!=F.touches.length&&(F={touches:G}),F.touches.length){case 1:q.copy(m.getMouseProjectionOnBall(F.touches[0].pageX,F.touches[0].pageY,r)),m.rotate_with_up_fixed&&z.copy(m.getMouseOnScreen_fixed_up(F.touches[0].pageX,F.touches[0].pageY,z));break;case 2:v=w=0;break;case 3:x.copy(m.getMouseOnScreen(F.touches[0].pageX,F.touches[0].pageY,y));}o=n.NONE}}var m=this,n={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5};this.object=a,this.domElement=b===void 0?document:b,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=0.3,this.noRotate=this.noZoom=this.noPan=this.noRoll=!1,this.damping=0.2,this.minDistance=0,this.maxDistance=Infinity,this.target=a._lookAt,this.lastPosition=new THREE.Vector3,this._eye=new THREE.Vector3;var o=n.NONE,p=n.NONE,q=new THREE.Vector3,r=new THREE.Vector3,t=new THREE.Vector2,u=new THREE.Vector2,v=0,w=0,x=new THREE.Vector2,y=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this._fixed=!1,this.objectUp=new THREE.Vector3;var z=new THREE.Vector2,A=new THREE.Vector2,B=new THREE.Vector2;this.rotate_with_up_fixed=!1,this.getMouseOnScreen_fixed_up=function(F,G,H){return this.getMouseOnScreen(F,G,H||new THREE.Vector2)},this.rotateCamera=function(){function F(){if(O=P=null,!self.MMD_SA||!MMD_SA_options.trackball_camera_limit)return!1;var Q=MMD_SA_options.trackball_camera_limit;O=Q.max,P=Q.min,J.copy(this._eye).applyQuaternion(I);var R=Q.adjust&&Q.adjust(J);return R?R:O&&(J.x>O.x||J.y>O.y||J.z>O.z)||P&&(J.x<P.x||J.z<P.z)}function G(){if(!P||!(this._eye.y<P.y))return!1;let Q=this._eye.lengthSq(),R=this._eye.x*this._eye.x,S=this._eye.z*this._eye.z,T=(Q-P.y*P.y)/(R+S);return K.x=(0>this._eye.x?-1:1)*Math.sqrt(R*T),K.z=(0>this._eye.z?-1:1)*Math.sqrt(S*T),K.y=P.y,!0}var H=new THREE.Vector3,I=new THREE.Quaternion,J=new THREE.Vector3,K=new THREE.Vector3,L=new THREE.Vector3,M=new THREE.Vector3,N=new THREE.Quaternion,O,P;return function(){if(this.rotate_with_up_fixed){if(z.distanceToSquared(A)>this.EPS){J.subVectors(this.position0,this.target),L.set(0,J.y,-Math.sqrt(J.x*J.x+J.z*J.z));let R=Math.atan2(L.y,-L.z),S=1.9-R/(Math.PI/4),T=-1.9-R/(Math.PI/4);M.copy(B).add(A).sub(z),M.y=THREE.Math.clamp(M.y,T,S),I.setFromEuler(MMD_SA.TEMP_v3.set(45*M.y/180*Math.PI,180*-M.x/180*Math.PI,0),"YXZ"),K.copy(this._eye);let U=L.angleTo(J);N.setFromAxisAngle(H.set(0,1,0),U),I.multiplyQuaternions(N,I),this._eye.copy(L);let V=F.call(this);if(V)return this._eye.copy(K),void z.copy(A);this._eye.applyQuaternion(I),G.call(this)&&(this._eye.copy(K),z.y=A.y),B.add(A).sub(z),B.y=THREE.Math.clamp(B.y,T,S),z.add(M.copy(A).sub(z).multiplyScalar(this.damping))}return}var Q=q.angleTo(r);if(Q){if(H.crossVectors(q,r).normalize(),Q*=m.rotateSpeed,I.setFromAxisAngle(H,-Q),F.call(this))return void q.copy(r);if(this._eye.applyQuaternion(I),m._fixed||m.object.up.applyQuaternion(I),r.applyQuaternion(I),I.setFromAxisAngle(H,Q*(m.damping-1)),q.applyQuaternion(I),G.call(this)){let R=M.crossVectors(J,K).normalize(),S=J.angleTo(K);N.setFromAxisAngle(R,S),this._eye.applyQuaternion(N),m._fixed||m.object.up.applyQuaternion(N),r.applyQuaternion(N),q.applyQuaternion(N)}}}}();var C=function(){var F=new THREE.Vector3;return function(G,H){if(!self.MMD_SA||!MMD_SA_options.trackball_camera_limit)return void G.multiplyScalar(H);var I=MMD_SA_options.trackball_camera_limit,J=I.max,K=I.min,L=F.copy(G).multiplyScalar(H).length();J&&L>J.length||K&&L<K.length||I.adjust&&I.adjust(G)||(G.multiplyScalar(H),J&&(G.x>J.x&&(G.x=J.x),G.y>J.y&&(G.y=J.y),G.z>J.z&&(G.z=J.z)),K&&(G.x<K.x&&(G.x=K.x),G.y<K.y&&(G.y=K.y),G.z<K.z&&(G.z=K.z)))}}();this.zoomCamera=function(){if(o===n.TOUCH_ZOOM){var F=v/w;v=w,C(this._eye,F)}else{var F=1+(u.y-t.y)*this.zoomSpeed;1!=F&&0<F&&(C(this._eye,F),t.y+=(u.y-t.y)*this.damping)}},this.panCamera=function(){var F=new THREE.Vector2,G=new THREE.Vector3,H=new THREE.Vector3;return function(){F.copy(y).sub(x),F.lengthSq()&&(F.multiplyScalar(this._eye.length()*m.panSpeed),H.copy(this._eye).cross(m.object.up).setLength(F.x),H.add(G.copy(m.object.up).setLength(F.y)),m.object.position.add(H),m.target.add(H),x.add(F.subVectors(y,x).multiplyScalar(m.damping)))}}();var D=new THREE.Vector3,E=1;this.reset=function(){return self.MMD_SA&&(System._browser._wallpaper_mousedown=!1),D.set(0,0,0),E=1,z=new THREE.Vector2,A=new THREE.Vector2,B=new THREE.Vector2,q=new THREE.Vector3,r=new THREE.Vector3,o=p=n.NONE,this.object.position.copy(this.position0),this.object.up.copy(this.up0),this.object.lookAt(this.target0),this._eye.subVectors(this.object.position,this.target),this.lastPosition.copy(this.object.position),this},self.MMD_SA&&(this.SA_adjust=function(){var F=new THREE.Vector3,G=new THREE.Vector3,H=new THREE.Vector3,I=new THREE.Quaternion,J={filter:function(K){return K.no_camera_collision}};return function(K,L){F.copy(this.object.position);var M,N;K&&(K instanceof Array?(M=K[0],N=K[1]):M=N=K,this.object.position.sub(this.target).multiplyScalar(1/E).add(this.target).add(M),this.target.add(N),E=1),L&&D.add(L);var O=10,P=2,Q=1,R=2,S=0,T;(D.x||D.y||D.z)&&(T=I.setFromEuler(D));for(var U=10;U>=P;U--){H.copy(G.copy(this.object.position).sub(this.target).multiplyScalar(1/E*(S+U/O))),T&&G.applyQuaternion(T);var V={return_value:null};if(window.dispatchEvent(new CustomEvent("SA_camera_adjust",{detail:{rot_delta:D,pos_v3:G,result:V}})),!V.return_value){if(Q<R&&10>U&&(1<Q||U>P)){Q++,S+=U/O,O=Math.pow(10,Q),U=10,P=0;continue}(Q==R||1==Q&&(10==U||U==P))&&D.set(0,0,0),this.object.position.copy(G).add(this.target),E=S+U/O;break}1==Q&&U==P&&(this.object.position.copy(H).add(this.target),E=S+U/O)}var W=MMD_SA_options.Dungeon;if(W&&E>2/10){var X=!W.no_camera_collision&&W.check_ray_intersection(this.target,G.copy(this.object.position).sub(this.target),J);if(X){var Y=G.length()/E,Z=Math.max(X.nearest.distance/Y,2/10);this.object.position.sub(this.target).multiplyScalar(1/E*Z).add(this.target),E=Z}}N&&N.lengthSq()>0.01*0.01&&(MMD_SA._mouse_pos_3D=[]),this.object.updateMatrixWorld(),this.position0.add(this.object.position).sub(F)}}()),self.Animate_RAF?(Lbody_host.addEventListener("mousedown",function(F){0!==F.button||c(F)},!1),Lbody_host.addEventListener("wheel",h,!1),Lbody_host.addEventListener("touchstart",j,!1),Lbody_host.addEventListener("touchend",l,!1),Lbody_host.addEventListener("touchmove",k,!1),window.addEventListener("resize",function(){m.resize()})):(this.domElement.addEventListener("contextmenu",function(F){F.preventDefault()},!1),this.domElement.addEventListener("mousedown",c,!1),this.domElement.addEventListener("mousewheel",h,!1),this.domElement.addEventListener("DOMMouseScroll",h,!1),this.domElement.addEventListener("touchstart",j,!1),this.domElement.addEventListener("touchend",l,!1),this.domElement.addEventListener("touchmove",k,!1)),this.resize()},THREE.TrackballControls.prototype={constructor:THREE.TrackballControls,stop:function(){return this.enabled=!1,this},start:function(){return this.enabled=!0,this},setup:function(a){return jThree.extend(this,a),this},fixUp:function(a){this._fixed=a===void 0?!this._fixed:a},resize:function(){if(this.domElement===document)this.screen.left=this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{jThree.extend(this.screen,this.domElement.getBoundingClientRect());var a=this.domElement.ownerDocument.documentElement;this.screen.left+=window.pageXOffset-a.clientLeft,this.screen.top+=window.pageYOffset-a.clientTop}},getMouseOnScreen:function(a,b,c){return(c||new THREE.Vector2).set((a-this.screen.left)/this.screen.width,(b-this.screen.top)/this.screen.height)},getMouseProjectionOnBall:function(a,b,c){var f=new THREE.Vector3((a-0.5*this.screen.width-this.screen.left)/(.5*this.screen.width),(0.5*this.screen.height+this.screen.top-b)/(.5*this.screen.height),0),g=f.length();return this.noRoll?g<Math.SQRT1_2?f.z=Math.sqrt(1-g*g):f.z=.5/g:1<g?f.normalize():f.z=Math.sqrt(1-g*g),this._eye.copy(this.object.position).sub(this.target),c.copy(this.object.up).setLength(f.y),c.add(this.objectUp.copy(this.object.up).cross(this._eye).setLength(f.x)),c.add(this._eye.setLength(f.z)),c},checkDistances:function(){this.noZoom&&this.noPan||(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._eye.lengthSq()<this.minDistance*this.minDistance&&this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)))},EPS:1e-6,update:function(){this.enabled&&(this._eye.subVectors(this.object.position,this.target),!this.noRotate&&this.rotateCamera(),!this.noZoom&&this.zoomCamera(),!this.noPan&&this.panCamera(),this.object.position.addVectors(this.target,this._eye),this.checkDistances(),this.object.lookAt(this.target),this.lastPosition.distanceToSquared(this.object.position)>this.EPS&&this.lastPosition.copy(this.object.position))}},jThree.Trackball=function(a){var b=[];return jThree(isFinite(a)?"rdr:eq("+a+")":a||"rdr").each(function(){var c=new THREE.TrackballControls(jThree.three(jThree.getCamera(this)),jThree.getCanvas(this));jThree.update(this,function(){c.callback&&c.callback(),c.update()}),jThree(this).resize(function(){c.resize()}).on("attrChange",function(f){"camera"!==f.attrName||(c.object=jThree.three(jThree.getCamera(this)),c.target=c.object._lookAt)}),b.push(c)}),self.MMD_SA&&(MMD_SA._trackball_camera=b[0]),1<b.length?b:b[0]};
(function(){function a(){d.call(this),this.type='AudioListener',this.context=j.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0}function b(k){d.call(this),this.type='Audio',this.listener=k,this.context=k.context,this.gain=this.context.createGain(),this.gain.connect(k.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType='empty',this.filters=[]}function c(k){b.call(this,k),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}var d=THREE.Object3D,e=THREE.Vector3,f=THREE.Quaternion,g=THREE.Clock,h,j={getContext:function(){return void 0===h&&(h=new(window.AudioContext||window.webkitAudioContext)),h},setContext:function(k){h=k}};a.prototype=Object.assign(Object.create(d.prototype),{constructor:a,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(k){return null===this.filter?this.gain.disconnect(this.context.destination):(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)),this.filter=k,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(k){return this.gain.gain.setTargetAtTime(k,this.context.currentTime,0.01),this},updateMatrixWorld:function(){var k=new e,m=new f,n=new e,o=new e,p=new g;return function(r){d.prototype.updateMatrixWorld.call(this,r);var s=this.context.listener,t=this.up;if(this.timeDelta=p.getDelta(),this.matrixWorld.decompose(k,m,n),o.set(0,0,-1).applyQuaternion(m),s.positionX){var u=this.context.currentTime+this.timeDelta;s.positionX.linearRampToValueAtTime(k.x,u),s.positionY.linearRampToValueAtTime(k.y,u),s.positionZ.linearRampToValueAtTime(k.z,u),s.forwardX.linearRampToValueAtTime(o.x,u),s.forwardY.linearRampToValueAtTime(o.y,u),s.forwardZ.linearRampToValueAtTime(o.z,u),s.upX.linearRampToValueAtTime(t.x,u),s.upY.linearRampToValueAtTime(t.y,u),s.upZ.linearRampToValueAtTime(t.z,u)}else s.setPosition(k.x,k.y,k.z),s.setOrientation(o.x,o.y,o.z,t.x,t.y,t.z)}}()}),b.prototype=Object.assign(Object.create(d.prototype),{constructor:b,getOutput:function(){return this.gain},setNodeSource:function(k){return this.hasPlaybackControl=!1,this.sourceType='audioNode',this.source=k,this.connect(),this},setMediaElementSource:function(k){return this.hasPlaybackControl=!1,this.sourceType='mediaNode',this.source=this.context.createMediaElementSource(k),this.connect(),this},setBuffer:function(k){return this.buffer=k,this.sourceType='buffer',this.autoplay&&this.play(),this},play:function(){if(!0===this.isPlaying)return void console.warn('THREE.Audio: Audio is already playing.');if(!1===this.hasPlaybackControl)return void console.warn('THREE.Audio: this Audio has no playback control.');this._player&&this._player._dispatchEvent('playing');var k=this.context.createBufferSource();return k.buffer=this.buffer,k.detune.value=this.detune,k.loop=this.loop,k.onended=this.onEnded.bind(this),k.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,k.start(this.startTime,this.offset),this.isPlaying=!0,this.source=k,this.connect()},pause:function(){return!1===this.hasPlaybackControl?void console.warn('THREE.Audio: this Audio has no playback control.'):(!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this)},stop:function(){return!1===this.hasPlaybackControl?void console.warn('THREE.Audio: this Audio has no playback control.'):(this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this)},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var k=1,m=this.filters.length;k<m;k++)this.filters[k-1].connect(this.filters[k]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var k=1,m=this.filters.length;k<m;k++)this.filters[k-1].disconnect(this.filters[k]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(k){return k||(k=[]),!0===this.isPlaying?(this.disconnect(),this.filters=k,this.connect()):this.filters=k,this},setDetune:function(k){return this.detune=k,!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,0.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(k){return this.setFilters(k?[k]:[])},setPlaybackRate:function(k){return!1===this.hasPlaybackControl?void console.warn('THREE.Audio: this Audio has no playback control.'):(this.playbackRate=k,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,0.01),this)},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this._player&&this._player._dispatchEvent('ended'),this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn('THREE.Audio: this Audio has no playback control.'),!1):this.loop},setLoop:function(k){return!1===this.hasPlaybackControl?void console.warn('THREE.Audio: this Audio has no playback control.'):(this.loop=k,!0===this.isPlaying&&(this.source.loop=this.loop),this)},getVolume:function(){return this.gain.gain.value},setVolume:function(k){return this.gain.gain.setTargetAtTime(k,this.context.currentTime,0.01),this}}),c.prototype=Object.assign(Object.create(b.prototype),{constructor:c,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(k){return this.panner.refDistance=k,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(k){return this.panner.rolloffFactor=k,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(k){return this.panner.distanceModel=k,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(k){return this.panner.maxDistance=k,this},setDirectionalCone:function(k,m,n){return this.panner.coneInnerAngle=k,this.panner.coneOuterAngle=m,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(){var k=new e,m=new f,n=new e,o=new e;return function(q){if(d.prototype.updateMatrixWorld.call(this,q),!1!==this.isPlaying){this.matrixWorld.decompose(k,m,n),o.set(0,0,1).applyQuaternion(m);var r=this.panner;if(r.positionX){var s=this.context.currentTime+this.listener.timeDelta;r.positionX.linearRampToValueAtTime(k.x,s),r.positionY.linearRampToValueAtTime(k.y,s),r.positionZ.linearRampToValueAtTime(k.z,s),r.orientationX.linearRampToValueAtTime(o.x,s),r.orientationY.linearRampToValueAtTime(o.y,s),r.orientationZ.linearRampToValueAtTime(o.z,s)}else r.setPosition(k.x,k.y,k.z),r.setOrientation(o.x,o.y,o.z)}}}()}),THREE.AudioContext=j,THREE.AudioListener=a,THREE.Audio=b,THREE.PositionalAudio=c})();

MMD_SA.fn={length:1+1,load_length_extra:MMD_SA_options.load_length_extra||0,_ready_for_model_creation:[],_model_creation_timerID:[],setupUI:function(e){this.length++;var t=MMD_SA_options.motion.length+MMD_SA_options.x_object.length+1+this.load_length_extra;t+=MMD_SA_options.model_path_extra.length;if(this.length<t){DEBUG_show("("+parseInt(this.length/t*100)+"% loaded)")}else if(this.length==t){this._ready_for_model_creation[0]=true;DEBUG_show("(100% loaded, processing model...)")}else if(this.length==t+1){}else if(this.length<t+2+MMD_SA_options.model_path_extra.length*2){var n=parseInt((this.length-(t+2))/2)+1;this._ready_for_model_creation[n]=true;DEBUG_show("(100% loaded, processing extra model (#"+n+")...)")}else if(this.length==t+2+MMD_SA_options.model_path_extra.length*2){setTimeout(function(){MMD_SA.fn.init()},200);DEBUG_show("(MMD starting...)",2)}else{if(this.length>t+2){DEBUG_show("loading error(?)",0,1);console.log("loading error(?)",this.length+"/"+t)}}},x_object_init:function(){function a(e){if(!MMD_SA._x_object_displayed_once)return;if(!this.visible||e){this.visible=true;if(!/^\#mikuPmx/.test(this.id)){MMD_SA.THREEX.mesh_obj.get(this.id).show();return true}}}function o(e){if(!MMD_SA._x_object_displayed_once)return;if(this.visible||e){this.visible=false;if(!/^\#mikuPmx/.test(this.id)){MMD_SA.THREEX.mesh_obj.get(this.id).hide();return true}}}return function(){MMD_SA_options.x_object.forEach(function(t,e){MMD_SA_options.x_object_by_name[t.path.replace(/^.+[\/\\]/,"").replace(/\.x$/i,"")]=t;t.id=t.id||"#x_object"+e;t.show=a;t.hide=o;t._obj=MMD_SA.THREEX.mesh_obj.get_three(t.id);if(t.boundingBox_list!=null){var n=t._obj.children[0].geometry;n.boundingBox_list=[];t.boundingBox_list.forEach(function(e){if(e==null){n.boundingBox_list.push(n.boundingBox)}else{var t=(new THREE.Box3).set(e.min,e.max);t.oncollide=e.oncollide;t.onaway=e.onaway;n.boundingBox_list.push(t)}});if(t.bb_adjust){n.boundingBox_list.forEach(function(e){if(t.bb_adjust.min)e.min.add(t.bb_adjust.min)})}}if(t.scale==null)t.scale=t._obj.scale.x==0?0:1;t.visible=t.hidden_on_start?false:t._obj.scale.x>0});MMD_SA_options.mesh_obj.forEach(function(e,t){MMD_SA_options.mesh_obj_by_id[e.id]=MMD_SA_options.mesh_obj_by_id["#"+e.id]=e;e.id="#"+e.id;e.show=a;e.hide=o;if(/^\#mikuPmx(\d+)$/.test(e.id)){e._obj=THREE.MMD.getModels()[parseInt(RegExp.$1)].mesh;Object.defineProperty(e,"visible",{get:function(){return this._obj.visible},set:function(e){this._obj.visible=e}});if(e.scale==null)e.scale=1;e.visible=true}else{if(!e._obj)e._obj=MMD_SA.THREEX.mesh_obj.get_three(e.id);var n=e._obj.children.length?e._obj.children[0]:e._obj;if(e.castShadow){n.castShadow=true}if(e.receiveShadow){n.receiveShadow=true}if(e.scale==null)e.scale=e._obj.scale.x==0?0:1;e.visible=e.hidden_on_start?false:e._obj.scale.x>0}});MMD_SA_options.mesh_obj_all=MMD_SA_options.x_object.concat(MMD_SA_options.mesh_obj)}}(),init:function(){var a=jThree;this.x_object_init();var e=this;var t=THREE.MMD.getModels()[0];var n=[];t.pmx.materials.forEach(function(e){n.push(e.name)});MMD_SA._material_list=n;var o=[{path:MMD_SA_options.model_path_default}];for(var i in MMD_SA_options.MME_saved){var r=MMD_SA_options.MME_saved[i];if(r.path_full)o.push({path:toLocalPath(r.path_full)})}o.forEach(function(e){var t=e.path;if(!/^(\w+\:|\/)/.test(t))t=System.Gadget.path+toLocalPath("\\"+t);e.in_use=t==MMD_SA_options.model_path||MMD_SA_options.model_path_extra.indexOf(t)!=-1});MMD_SA._model_list=o;THREE.MMD.getModels().forEach(function(e){e.skin_MMD_SA_extra=[MMD_SA.Animation_dummy];e.morph_MMD_SA_extra=[MMD_SA.Animation_dummy]});MMD_SA.MMD={MotionManager:function(){this._model_index=0},setFrameNumber:function(){},play:function(){jThree.MMD.play()},pause:function(){jThree.MMD.pause()}};Object.defineProperty(MMD_SA.MMD.MotionManager.prototype,"lastFrame",{get:function(){var e=THREE.MMD.getModels()[this._model_index]._MMD_SA_cache[this.para_SA._path];return e.skin.duration*30}});Object.defineProperty(MMD_SA.MMD.MotionManager.prototype,"_timeMax",{get:function(){var e=THREE.MMD.getModels()[this._model_index]._MMD_SA_cache[this.para_SA._path];return e.skin._timeMax}});Object.defineProperty(MMD_SA.MMD.MotionManager.prototype,"lastFrame_",{get:function(){if(this._lastFrame_!=null)return this._lastFrame_;var e=MMD_SA.MMD.motionManager;return e.para_SA.multi_model_motion_list&&e.para_SA.multi_model_motion_list.indexOf(this.filename)!=-1?e._lastFrame_:this.lastFrame},set:function(e){this._lastFrame_=e}});Object.defineProperty(MMD_SA.MMD.MotionManager.prototype,"firstFrame_",{get:function(){if(this._firstFrame_!=null)return this._firstFrame_;var e=MMD_SA.MMD.motionManager;return e.para_SA.multi_model_motion_list&&e.para_SA.multi_model_motion_list.indexOf(this.filename)!=-1?e._firstFrame_:0},set:function(e){this._firstFrame_=e}});MMD_SA.motion=[];var m=MMD_SA_options.motion_shuffle_list_default&&MMD_SA_options.motion_shuffle_list_default[0]||0;for(var M=0,_=MMD_SA_options.motion.length;M<_;M++){var l=MMD_SA_options.motion[M];if(!l.path){MMD_SA.motion.push(new MMD_SA.MMD.MotionManager);continue}var c=decodeURIComponent(l.path.replace(/^.+[\/\\]/,"").replace(/\.(vmd|bvh)$/i,""));var d=MMD_SA_options.motion_para[c]||{};var u=MMD_SA.vmd_by_filename[c];u._index=M;if(l.is_vmd_component){MMD_SA.motion.push({});continue}if(l.morph_component_by_filename){u._morph_component=MMD_SA.vmd_by_filename[l.morph_component_by_filename];u._morph_component.url=u.url}THREE.MMD.getModels().forEach(function(e,t){var n,a,o,i,r;a=e._MMD_SA_cache[l.path];if(a){e._MMD_SA_cache_current=a;o=a.skin;i=a.morph;if(o){o._model_index=e._model_index;o._motion_index=M}if(i){i._model_index=e._model_index;i._motion_index=M}}else{r=MMD_SA_options.model_para_obj_all[t];n=l.jThree_para;var _=false;if(d.model_name_RegExp||d.model_index_list){if(d.model_name_RegExp)_=!d.model_name_RegExp.test(r._filename);if(d.model_index_list&&(!d.model_name_RegExp||_)){_=d.model_index_list.indexOf(t)==-1;if(_&&d.model_index_list.indexOf(0)!=-1&&r.is_PC_candidate)_=false}}else if(t>0&&!r.is_PC_candidate&&(n||!r.mirror_motion_from_first_model)){_=true}if(r.motion_name_default==c){_=false}if(_){if(t==MMD_SA_options.model_para_obj_all.length-1&&(!MMD_SA.motion.length||MMD_SA.motion[MMD_SA.motion.length-1].filename!=c))MMD_SA.motion.push({});return}a=e.setupMotion_MMD_SA(u,l.match,n);o=a.skin;i=a.morph;if(n){o._is_MMD_SA_custom_animation=i._is_MMD_SA_custom_animation=MMD_SA.custom_action_index&&M>=MMD_SA.custom_action_index&&M<MMD_SA.motion_number_meter_index;o._is_MMD_SA_animation=true;o._is_skin=true;o._MMD_SA_disabled=true;o.freeze_onended=true;if(e.skin_MMD_SA_extra){o._motion_index_extra=e.skin_MMD_SA_extra.length;e.skin_MMD_SA_extra.push(o)}i._is_MMD_SA_animation=true;i._is_morph=true;i._MMD_SA_disabled=true;i.freeze_onended=true;if(e.morph_MMD_SA_extra){i._motion_index_extra=e.morph_MMD_SA_extra.length;e.morph_MMD_SA_extra.push(i)}o._MMD_SA_animation_check=i._MMD_SA_animation_check=n.animation_check}}if(!n||o._is_MMD_SA_custom_animation){e._MMD_SA_cache[l.path]=a;if(!MMD_SA.motion.length||MMD_SA.motion[MMD_SA.motion.length-1].filename!=c){var s=new MMD_SA.MMD.MotionManager;s.filename=c;s.para_SA=d;s.para_SA._path=l.path;s._index=s.para_SA._index=MMD_SA.motion.length;s._model_index=t;MMD_SA.motion.push(s)}}if(!e.skin||M==m||r.motion_name_default==c){if(!r.motion_name_default){if(t==0){if(M==m)r.motion_name_default=c}else if(t>0&&!r.mirror_motion_from_first_model)r.motion_name_default=c}e._MMD_SA_cache_current=a;e.skin=o;e.morph=i;THREE.MMD.adjustMotionDuration()}})}MMD_SA.MMD.motionManager=MMD_SA.motion[0];if(MMD_SA_options.use_speech_bubble){MMD_SA.SpeechBubble.onload()}MMD_SA._tray_updatable=true;System._browser.update_tray();setTimeout(function(){MMD_SA.MMD_started=true;resize();a.MMD.cameraMotion=true;MMD_SA._head_pos=new THREE.Vector3(0,15,0);MMD_SA_options.model_para_obj.onMotionChange&&MMD_SA_options.model_para_obj.onMotionChange();var n=function(){var u=this;var p=this.mesh;var e=MMD_SA_options.Dungeon&&MMD_SA_options.Dungeon.accessory_list||MMD_SA_options.mesh_obj_all;e.forEach(function(e){var t=e.parent_bone;if(!t)return;var n=t.model_index||0;if(u._model_index!=n)return;if(MMD_SA_options.Dungeon){if(!p.visible||e.parent_bone.disabled){e._obj_proxy.hidden=true;e._obj_proxy.visible=false;return}e._obj_proxy.hidden=false;e._obj_proxy.visible=true}if(t.condition&&!t.condition(e,n))return;var a=MMD_SA.motion[u.skin._motion_index].para_SA;var o;o=a.adjustment_per_model&&(a.adjustment_per_model[MMD_SA_options.model_para_obj._filename]||a.adjustment_per_model[MMD_SA_options.model_para_obj._filename_cleaned]);o=o&&o.accessory_default&&o.accessory_default[e.path.replace(/^.+[\/\\]/,"")];if(o)t=o.parent_bone;var i=p.bones_by_name[t.name];if(!i)return;var r=e._obj;var _,s;var m;if(MMD_SA.THREEX.enabled){m=MMD_SA.THREEX.get_model(n);const l=m.get_bone_by_MMD_name(t.name);if(!l)return;l.matrixWorld.decompose(MMD_SA.THREEX.v1,MMD_SA.THREEX.q1,MMD_SA.THREEX.v2);_=MMD_SA.THREEX.v1.sub(m.mesh.position);s=MMD_SA.THREEX.q1;if(m.type=="VRM"){s.premultiply(MMD_SA.THREEX.q2.set(0,1,0,0));s.x*=-1;s.z*=-1}}else{r.useQuaternion=true;const c=i.skinMatrix.decompose();_=c[0];s=c[1]}r.position.copy(_);if(t.position){const d=MMD_SA.TEMP_v3.set(t.position.x,t.position.y,-t.position.z);r.position.add(d.applyQuaternion(s))}r.quaternion.copy(s);if(t.rotation){if(!t.rotation._quaternion){t.rotation._quaternion=(new THREE.Quaternion).setFromEuler(MMD_SA.TEMP_v3.set(-t.rotation.x,-t.rotation.y,t.rotation.z).multiplyScalar(Math.PI/180),"YXZ")}r.quaternion.multiply(t.rotation._quaternion)}var M=MMD_SA.TEMP_m4.makeFromPositionQuaternionScale(r.position,r.quaternion,r.scale).multiplyMatrices(p.matrixWorld,MMD_SA.TEMP_m4).decompose();r.position.copy(M[0]);r.quaternion.copy(M[1]);r.matrixAutoUpdate=false;r.updateMatrix()})};THREE.MMD.getModels().forEach(function(e,t){e.simulateCallback=n});var e=MMD_SA_options.MME.PostProcessingEffects;MMD_SA_options._PPE_enabled=e.enabled;if(MMD_SA_options.PPE_disabled_on_idle){if(MMD_SA_options._PPE_enabled){e.enabled=false}}MMD_SA.fadeout_opacity=.95;MMD_SA.fadeout_canvas.width=SL.width;MMD_SA.fadeout_canvas.height=SL.height;var t=MMD_SA.fadeout_canvas.getContext("2d");t.globalCompositeOperation="copy";t.globalAlpha=.01;t.fillRect(0,0,SL.width,SL.height);t.globalAlpha=1;MMD_SA_options.model_para_obj_all.forEach(function(e,t){var n=THREE.MMD.getModels()[t].mesh;if(e.position_loading||e.bone_connection||n.bones_by_name[""])n.position.set(0,0,0);if(e.scale)n.scale.set(e.scale,e.scale,e.scale)});THREE.MMD.getModels().forEach(function(){function n(e){this.mesh=e;this.m4=new THREE.Matrix4;this.pos=new THREE.Vector3;this.pos_world=new THREE.Vector3;this.reset()}n.prototype.reset=function(){this.pos.set(0,0,0);this.pos_world.set(0,0,0)};n.prototype.update=function(){this.m4.copy(this.mesh.matrixWorld);e.getPositionFromMatrix(this.m4);t.copy(e).sub(this.pos_world);t.multiplyScalar(MMD_SA_options.matrixWorld_physics_scale);this.pos.add(t);this.pos_world.copy(e);t.y+=this.mesh._model_index*25;this.m4.setPosition(t)};var e=new THREE.Vector3;var t=new THREE.Vector3;return function(e){let t=e.mesh;t.matrixWorld_physics=new n(t)}}());MMD_SA_options.onstart&&MMD_SA_options.onstart();window.dispatchEvent(new CustomEvent("MMDStarted"));MMD_SA.toggle_shadowMap();a.MMD.play(true);DEBUG_show("(MMD started)",2);if(MMD_SA.use_webgl2)DEBUG_show("Use WebGL2",2);if(MMD_SA.use_MSAA_FBO)DEBUG_show("Use MSAA FBO",2)},0);if(jThree.Trackball)jThree.trackball=jThree.Trackball;a.trackball();if(!returnBoolean("MMDTrackballCamera"))MMD_SA._trackball_camera.stop();MMD_SA_options.edgeScale=MMD_SA_options.model_para_obj.edgeScale>=0?MMD_SA_options.model_para_obj.edgeScale:MMD_SA_options.edgeScale>=0?MMD_SA_options.edgeScale:1;a.MMD.edgeScale=parseFloat(System.Gadget.Settings.readString("MMDEdgeScale")||Settings_default.MMDEdgeScale)*MMD_SA_options.edgeScale;jQuery("canvas").on("mousedown mousewheel DOMMouseScroll",function(){a.MMD.cameraMotion=false}).dblclick(function(){a.MMD.cameraMotion=true})}};(function(){MMD_SA.TEMP_q=new THREE.Quaternion;MMD_SA._q1=new THREE.Quaternion;MMD_SA._q2=new THREE.Quaternion;MMD_SA.TEMP_v3=new THREE.Vector3;MMD_SA._v3a=new THREE.Vector3;MMD_SA._v3b=new THREE.Vector3;MMD_SA.TEMP_m4=new THREE.Matrix4;MMD_SA._m4a=new THREE.Matrix4;MMD_SA._m4b=new THREE.Matrix4;MMD_SA.TEMP_b3=new THREE.Box3;MMD_SA._v3a_=new THREE.Vector3;MMD_SA._v3b_=new THREE.Vector3;MMD_SA.process_bone=function(e,t,n){var a=MMD_SA._v3a_.setEulerFromQuaternion(e.quaternion);if(n){a.x*=n[0];a.y*=n[1];a.z*=n[2]}if(t instanceof THREE.Quaternion)t=MMD_SA._v3b_.setEulerFromQuaternion(t);a.add(t);e.quaternion.setFromEuler(a)};MMD_SA.copy_first_bone_frame=function(e,t,n){if(!n)n=MMD_SA_options.motion[e].match;var o=n&&n.skin_jThree?n.skin_jThree:null;if(!t._is_skin)t=THREE.MMD.getModels()[0].skin_MMD_SA_extra[t._motion_index_extra];var i=t.mesh;t.targets.forEach(function(e){var t=e.keys[0];if(!t||o&&!o.test(t.name)||t.time){return}var n=i.bones_by_name[t.name];var a=i.geometry.bones[n._index];t.pos[0]=n.position.x-a.pos[0];t.pos[1]=n.position.y-a.pos[1];t.pos[2]=n.position.z-a.pos[2];t.rot=n.quaternion.toArray()})};MMD_SA.reset_skin=function(m){THREE.MMD.getModels().forEach(function(e,t){if(m!=null&&t!=m)return;var n=e.skin;if(!n||n._is_dummy){return}var a=n.mesh;var o=a.geometry;for(var i=0,r=a.bones.length;i<r;i++){var _=a.bones[i];var s=o.bones[i];_.position.set(s.pos[0],s.pos[1],s.pos[2]);_.quaternion.set(0,0,0,1)}})};MMD_SA.reset_morph=function(i){THREE.MMD.getModels().forEach(function(e,t){if(i!=null&&t!=i)return;var n=e.morph;if(n&&n._is_dummy){return}n=e.mesh.morphTargetInfluences;if(n){for(var a=0,o=n.length;a<o;a++)n[a]=0}})};MMD_SA._camera_y_offset_=0;MMD_SA.reset_camera=function(e){if(e){window.dispatchEvent(new CustomEvent("MMDCameraReset",{detail:{}}))}this._camera_y_offset_=0;var t=this.center_view;var n=this.center_view_lookAt;var a=THREE.MMD.getModels()[0].mesh.position;var o=MMD_SA_options.camera_position.slice();if(MMD_SA_options.use_random_camera&&returnBoolean("MMDRandomCamera")&&(MMD_SA.MMD.motionManager.para_SA.use_random_camera||Audio_BPM.vo.BPM_mode)){var i=MMD_SA_options.random_camera;o=MMD_SA.TEMP_v3.set(o[0]-a.x,o[1]-a.y,o[2]-a.z).multiplyScalar(i.distance[0]+Math.random()*(i.distance[1]-i.distance[0])).applyQuaternion(MMD_SA.TEMP_q.setFromEuler(MMD_SA._v3a.set((i.rotation.x[0]+Math.random()*(i.rotation.x[1]-i.rotation.x[0]))*Math.PI/180,(i.rotation.y[0]+Math.random()*(i.rotation.y[1]-i.rotation.y[0]))*Math.PI/180,(i.rotation.z[0]+Math.random()*(i.rotation.z[1]-i.rotation.z[0]))*Math.PI/180))).add(a).toArray()}var r=this._trackball_camera;r.position0.set(o[0]+t[0],o[1]+t[1],o[2]+t[2]);r.target0.set(a.x+n[0]+MMD_SA_options.camera_lookAt[0],a.y+n[1]+MMD_SA_options.camera_lookAt[1],a.z+n[2]+MMD_SA_options.camera_lookAt[2]);r.reset();MMD_SA._mouse_pos_3D=[];MMD_SA._trackball_camera.SA_adjust();MMD_SA._trackball_camera.rotate_with_up_fixed=MMD_SA_options.Dungeon&&MMD_SA_options.Dungeon.character.TPS_mode};MMD_SA.Animation_dummy={_is_dummy:true,_MMD_SA_disabled:true};MMD_SA.Animation_dummy.reset=MMD_SA.Animation_dummy.seek=MMD_SA.Animation_dummy.play=MMD_SA.Animation_dummy.pause=MMD_SA.Animation_dummy.update=MMD_SA.Animation_dummy.adjustDuration=MMD_SA.Animation_dummy.onupdate=function(){};THREE.Box3.prototype.intersectObject=function(){var le={};var z=new THREE.Vector3;var s=new THREE.Vector3;var m=new THREE.Vector3,M=new THREE.Vector3,l=new THREE.Vector3;var c=new THREE.Vector3,d=new THREE.Vector3,u=new THREE.Vector3;var p=new THREE.Vector3,f=new THREE.Vector3,h=new THREE.Vector3,x=new THREE.Vector3,E=new THREE.Vector3,y=new THREE.Vector3,b=new THREE.Vector3,v=new THREE.Vector3,D=new THREE.Vector3;var A=new THREE.Plane;le.isIntersectionAABBPlane=function(e,t){z.addVectors(e.max,e.min).multiplyScalar(.5);s.subVectors(e.max,z);var n=s.x*Math.abs(t.normal.x)+s.y*Math.abs(t.normal.y)+s.z*Math.abs(t.normal.z);var a=t.normal.dot(z)-t.constant;return Math.abs(a)<=n};le.isIntersectionTriangleAABB=function(e,t,n,a){var o,i,r,_;z.addVectors(a.max,a.min).multiplyScalar(.5);s.subVectors(a.max,z);m.subVectors(e,z);M.subVectors(t,z);l.subVectors(n,z);c.subVectors(M,m);d.subVectors(l,M);u.subVectors(m,l);p.set(0,-c.z,c.y);f.set(0,-d.z,d.y);h.set(0,-u.z,u.y);x.set(c.z,0,-c.x);E.set(d.z,0,-d.x);y.set(u.z,0,-u.x);b.set(-c.y,c.x,0);v.set(-d.y,d.x,0);D.set(-u.y,u.x,0);o=m.dot(p);i=M.dot(p);r=l.dot(p);_=s.y*Math.abs(c.z)+s.z*Math.abs(c.y);if(Math.max(-Math.max(o,i,r),Math.min(o,i,r))>_){return false}o=m.dot(f);i=M.dot(f);r=l.dot(f);_=s.y*Math.abs(d.z)+s.z*Math.abs(d.y);if(Math.max(-Math.max(o,i,r),Math.min(o,i,r))>_){return false}o=m.dot(h);i=M.dot(h);r=l.dot(h);_=s.y*Math.abs(u.z)+s.z*Math.abs(u.y);if(Math.max(-Math.max(o,i,r),Math.min(o,i,r))>_){return false}o=m.dot(x);i=M.dot(x);r=l.dot(x);_=s.x*Math.abs(c.z)+s.z*Math.abs(c.x);if(Math.max(-Math.max(o,i,r),Math.min(o,i,r))>_){return false}o=m.dot(E);i=M.dot(E);r=l.dot(E);_=s.x*Math.abs(d.z)+s.z*Math.abs(d.x);if(Math.max(-Math.max(o,i,r),Math.min(o,i,r))>_){return false}o=m.dot(y);i=M.dot(y);r=l.dot(y);_=s.x*Math.abs(u.z)+s.z*Math.abs(u.x);if(Math.max(-Math.max(o,i,r),Math.min(o,i,r))>_){return false}o=m.dot(b);i=M.dot(b);r=l.dot(b);_=s.x*Math.abs(c.y)+s.y*Math.abs(c.x);if(Math.max(-Math.max(o,i,r),Math.min(o,i,r))>_){return false}o=m.dot(v);i=M.dot(v);r=l.dot(v);_=s.x*Math.abs(d.y)+s.y*Math.abs(d.x);if(Math.max(-Math.max(o,i,r),Math.min(o,i,r))>_){return false}o=m.dot(D);i=M.dot(D);r=l.dot(D);_=s.x*Math.abs(u.y)+s.y*Math.abs(u.x);if(Math.max(-Math.max(o,i,r),Math.min(o,i,r))>_){return false}if(Math.max(m.x,M.x,l.x)<-s.x||Math.min(m.x,M.x,l.x)>s.x){return false}if(Math.max(m.y,M.y,l.y)<-s.y||Math.min(m.y,M.y,l.y)>s.y){return false}if(Math.max(m.z,M.z,l.z)<-s.z||Math.min(m.z,M.z,l.z)>s.z){return false}A.normal.copy(d).cross(c).normalize();A.constant=A.normal.dot(e);return le.isIntersectionAABBPlane(a,A)};var ce={_updated:false,reset:function(e){this.x_min={state:0,depth:[0,0],info:["",""]};this.x_max={state:0,depth:[0,0],info:["",""]};this.z_min={state:0,depth:[0,0],info:["",""]};this.z_max={state:0,depth:[0,0],info:["",""]};this.y_min={state:0,depth:[0,0],info:["",""]};this.y_max={state:0,depth:[0,0],info:["",""]};this.blocked={state:0,depth:[0,0],info:["",""]};this.depth_min=.1/e._obj.scale.length();this._updated=false},set_state:function(e,t,n){if(t>ce.depth_min&&this.depth[e-1]<t){this.depth[e-1]=t;if(this.state<e)this.state=e;this.info=n;if(this!=ce.y_min)ce._updated=true}}};var P=new THREE.Matrix4;var e=new THREE.Plane;var Te=new THREE.Ray;var de=new THREE.Box3;var j=new THREE.Box3;var ue=new THREE.Box3;var pe=new THREE.Box3;var fe=new THREE.Box3;var he=new THREE.Box3;var xe=new THREE.Box3;var Ee=new THREE.Box3;var Re=new THREE.Box3;var we=new THREE.Box3;var ge=new THREE.Vector3;var ye=new THREE.Vector3;var be=new THREE.Vector3;var ve=new THREE.Vector3;var De={x_min:new THREE.Plane,x_max:new THREE.Plane,z_min:new THREE.Plane,z_max:new THREE.Plane,y_min:new THREE.Plane,y_max:new THREE.Plane};var He={x_min:new THREE.Plane,x_max:new THREE.Plane,z_min:new THREE.Plane,z_max:new THREE.Plane,y_min:new THREE.Plane,y_max:new THREE.Plane};var ze={x_min:new THREE.Plane,x_max:new THREE.Plane,z_min:new THREE.Plane,z_max:new THREE.Plane,y_min:new THREE.Plane,y_max:new THREE.Plane};var Pe={x_min:new THREE.Plane,x_max:new THREE.Plane,z_min:new THREE.Plane,z_max:new THREE.Plane,y_min:new THREE.Plane,y_max:new THREE.Plane};var Ae=new THREE.Vector3;var Se=new THREE.Vector3;var je=new THREE.Vector3;var t=new THREE.Plane;var V;function k(e,t){return e.normal.y>t}function Ve(e,t,n,a,o,i,r,_){var s,m,M,l,c,d,u,p,f,h;M=n-e;l=a-t;c=r-o;d=_-i;f=M*d-c*l;if(f==0)return 0;var x=f>0;s=e-o;m=t-i;u=M*m-l*s;if(u<0==x)return 0;p=c*m-d*s;if(p<0==x)return 0;if(u>f==x||p>f==x)return 0;h=p/f;var E=e+h*M;var y=t+h*l;return[E,y]}return function(e,t){var _e=e.collision_by_mesh_face_grounded||k;var n=e._obj;var a=n.geometry?n:n.children[0];var o=a.geometry;var i=o.vertices;var r=a.material instanceof THREE.MeshFaceMaterial;var A=r===true?a.material.materials:null;var _=a.material.side;var s,m,M,l;P.getInverse(n.matrixWorld);de.copy(t).applyMatrix4(P);j.copy(this).applyMatrix4(P);var S=this==t?[de]:[j,de];var c=de.min.y>j.min.y?de:j;var $=c.min.y+(c.max.y-c.min.y)*.25;var se=c.center(z).y;var me=(de.min.y>j.min.y?j.min.y:de.min.y)-Math.max(de.max.x-de.min.x,de.max.z-de.min.z)*2;j.union(de);de.center(ge);j.center(ye);Te.set(Ae.copy(ye).setY(j.max.y),new THREE.Vector3(0,-1,0));fe.copy(de);fe.expandByVector(Ae.copy(fe.size(be)).multiplyScalar(-.25));fe.min.y=$;he.copy(j);he.expandByVector(Ae.copy(he.size(ve)).multiplyScalar(-.25));he.min.y=$;xe.copy(de);xe.expandByVector(Ae.copy(xe.size(be)).multiplyScalar(-.125));xe.min.y=$;Ee.copy(j);Ee.expandByVector(Ae.copy(Ee.size(ve)).multiplyScalar(-.125));Ee.min.y=$;var J=false;var Y=-999;ue.copy(de);pe.copy(pe);de.min.y=Math.min(o.boundingBox.min.y,de.min.y);j.min.y=Math.min(o.boundingBox.min.y,j.min.y);var K={};var Z={};var ee={};var Me={};var d=[de,j,ue,pe];var u=[K,Z,ee,Me];for(var p in De){switch(p){case"x_min":case"x_max":d.forEach(function(e,t){u[t][p]=[[[e.min.z,e.max.y],[e.max.z,e.max.y]],[[e.max.z,e.max.y],[e.max.z,e.min.y]],[[e.min.z,e.min.y],[e.max.z,e.min.y]],[[e.min.z,e.max.y],[e.min.z,e.min.y]]]});break;case"z_min":case"z_max":d.forEach(function(e,t){u[t][p]=[[[e.min.x,e.max.y],[e.max.x,e.max.y]],[[e.max.x,e.max.y],[e.max.x,e.min.y]],[[e.min.x,e.min.y],[e.max.x,e.min.y]],[[e.min.x,e.max.y],[e.min.x,e.min.y]]]});break;case"y_min":case"y_max":d.forEach(function(e,t){u[t][p]=[[[e.min.x,e.max.z],[e.max.x,e.max.z]],[[e.max.x,e.max.z],[e.max.x,e.min.z]],[[e.min.x,e.min.z],[e.max.x,e.min.z]],[[e.min.x,e.max.z],[e.min.x,e.min.z]]]});break}}var d=[de,j,ue,pe];[De,He,ze,Pe].forEach(function(e,t){var n=d[t];e.x_min.setFromNormalAndCoplanarPoint(Ae.set(-1,0,0),Se.set(n.min.x,0,0));e.x_max.setFromNormalAndCoplanarPoint(Ae.set(1,0,0),Se.set(n.max.x,0,0));e.z_min.setFromNormalAndCoplanarPoint(Ae.set(0,0,-1),Se.set(0,0,n.min.z));e.z_max.setFromNormalAndCoplanarPoint(Ae.set(0,0,1),Se.set(0,0,n.max.z));e.y_min.setFromNormalAndCoplanarPoint(Ae.set(0,-1,0),Se.set(0,n.min.y,0));e.y_max.setFromNormalAndCoplanarPoint(Ae.set(0,1,0),Se.set(0,n.max.y,0))});ce.reset(e);var T=e.collision_by_mesh_material_index_max||999;var f,h,x;if(e.collision_by_mesh_sort_range){f=e.collision_by_mesh_sort_range;h=e.mesh_sorted.index_list;x=0}else{f=0;h=o.faces;x=0}var te={};var ne=[];var ae={};var oe=-1;for(var E=x,R=h.length;E<R;E++){var ie;if(f===0){ie=E}else{ie=h[E]}var re=o.faces[ie];if(re.materialIndex>=T)break;var w=r===true?A[re.materialIndex]:a.material;if(w===undefined)continue;s=i[re.a];m=i[re.b];M=i[re.c];var _=w.side;if(_!==THREE.DoubleSide){var g=Ae.addVectors(s,m).add(M).multiplyScalar(1/3).sub(ye).normalize().dot(re.normal);if(!(_===THREE.FrontSide?g<0:g>0))continue}V=[];if(re instanceof THREE.Face3){V.push([s,m,M])}else if(re instanceof THREE.Face4){l=i[re.d];V.push([s,m,l],[m,M,l])}else continue;V.forEach(function(N){var W=0;S.some(function(e){if(!le.isIntersectionTriangleAABB(N[0],N[1],N[2],e)){return true}te[ie]={};var t,n,a,o,i,r,_,s,m,M;if(e==de){t=ue;n=fe;a=xe;o=K;i=ee;r=De;_=ze;s=ge;m=be;M=1;J=true}else{t=pe;n=he;a=Ee;o=Z;i=Me;r=He;_=Pe;s=ye;m=ve;M=2}var l;var c=0;var B=_e(re,.5);if(Te.intersectTriangle(N[2],N[0],N[1],false,Ae)){if(Ae.y>se){if(Ae.y>n.max.y){ce.set_state.call(ce.y_max,M,e.max.y-Ae.y)}else l=true}else if(c>=W){c=W=M;Y=Math.max(Y,Ae.y);if(Y==Ae.y){oe=ie}}}for(var d=0;d<2;d++){var u,p,f,h;if(d==1){u=e;p=r;f=o;h=Re}else{u=t;p=_;f=i;h=we}var x=[];var E=[];if(!l){N.some(function(e,t){if(u.containsPoint(e)){if(n.containsPoint(e)){l=true;return true}x.push(e.clone())}else E[t]=true})}if(l){ce.set_state.call(ce.blocked,M,1,ie);return}var y=[];if(E[0]||E[1])y.push(new THREE.Line3(N[0],N[1]));if(E[1]||E[2])y.push(new THREE.Line3(N[1],N[2]));if(E[2]||E[0])y.push(new THREE.Line3(N[2],N[0]));var b={x_min:[],x_max:[],z_min:[],z_max:[],y_min:[],y_max:[]};y.forEach(function(e){for(var t in p){var n=p[t].intersectLine(e);if(n)b[t].push(n)}});for(var v in b){var D=b[v];if(D.length<2){continue}var A=0;var S=[];D.forEach(function(e){var t;switch(v){case"x_min":case"x_max":t=e.y>=u.min.y&&e.y<=u.max.y&&e.z>=u.min.z&&e.z<=u.max.z;break;case"z_min":case"z_max":t=e.y>=u.min.y&&e.y<=u.max.y&&e.x>=u.min.x&&e.x<=u.max.x;break;case"y_min":case"y_max":t=e.z>=u.min.z&&e.z<=u.max.z&&e.x>=u.min.x&&e.x<=u.max.x;break}if(t){A++;S.push(e)}});if(A<2){var T;switch(v){case"x_min":case"x_max":T=[D[0].z,D[0].y,D[1].z,D[1].y];break;case"z_min":case"z_max":T=[D[0].x,D[0].y,D[1].x,D[1].y];break;case"y_min":case"y_max":T=[D[0].x,D[0].z,D[1].x,D[1].z];break}f[v].some(function(e){var t=Ve(e[0][0],e[0][1],e[1][0],e[1][1],T[0],T[1],T[2],T[3]);if(!t)return;var n;switch(v){case"x_min":n=new THREE.Vector3(u.min.x,t[1],t[0]);break;case"x_max":n=new THREE.Vector3(u.max.x,t[1],t[0]);break;case"z_min":n=new THREE.Vector3(t[0],t[1],u.min.z);break;case"z_max":n=new THREE.Vector3(t[0],t[1],u.max.z);break;case"y_min":n=new THREE.Vector3(t[0],u.min.y,t[1]);break;case"y_max":n=new THREE.Vector3(t[0],u.max.y,t[1]);break}S.push(n);return++A==2})}if(A==2)x.push(S[0],S[1])}if(!x.length){continue}var R=Ae.copy(x[0]);var w=Se.copy(x[0]);x.forEach(function(e){R.min(e);w.max(e)});h.set(R,w);if(u==e){if(B&&(!c&&M>=W)){if(h.max.y<$){c=W=M;Y=Math.max(Y,h.max.y);if(Y==h.max.y){oe=ie}}else if(h.min.y<$){c=W=M;Y=Math.max(Y,$);if(Y==$)oe=ie}}if(M==1){x.forEach(function(e){if(e.y>me&&(B||c)){var t=e.clone();ne.push(t);if(!ae[ie])ae[ie]=[];ae[ie].push(t)}})}}var F=je.copy(re.normal).multiplyScalar(Math.max(m.x,m.z)).negate();x.forEach(function(e){e.add(F);R.min(e);w.max(e)});h.set(R,w).intersect(u);var g=te[ie];g.abc=[re.a,re.b,re.c];g.bb_priority={};g.bb_priority[M]={_bb_contained:h.clone()};if(c)return;if(h.max.y<Y)return;var H;var z="";var P,q,j;var C,V,I;var O,Q,X;for(var L=0;L<2;L++){if(L==1){var U=0;for(var G in te){g=te[G];var k=g.abc;if(!k||G==ie||!g.bb_priority[M])continue;if(k.indexOf(re.a)==-1&&k.indexOf(re.b)==-1&&k.indexOf(re.c)==-1)continue;U++;h.union(g.bb_priority[M]._bb_contained)}if(!U)break}else{}H=h.center(Ae);P=H.x>n.min.x&&H.x<n.max.x;q=H.y>n.min.y&&H.y<n.max.y;j=H.z>n.min.z&&H.z<n.max.z;C=P||h.min.x>a.min.x&&h.min.x<a.max.x||h.max.x>a.min.x&&h.max.x<a.max.x;V=h.max.y>$;I=j||h.min.z>a.min.z&&h.min.z<a.max.z||h.max.z>a.min.z&&h.max.z<a.max.z;O=!P;Q=!q;X=!j;if(O&&V)ce.set_state.call(ce["x_"+(H.x>s.x?"max":"min")],M,h.max.x-h.min.x,z);if(C&&Q&&I)ce.set_state.call(ce["y_"+(H.y>s.y?"max":"min")],M,h.max.y-h.min.y,z);if(V&&X)ce.set_state.call(ce["z_"+(H.z>s.z?"max":"min")],M,h.max.z-h.min.z,z)}}})})}var H=0;for(var y in te)H++;var b=[];if(oe!=-1&&ae[oe]){var v=o.faces[oe];ne=ae[oe].slice();for(var y in ae){fh=te[y];var D=fh.abc;if(!D||y==oe)continue;if(D.indexOf(v.a)==-1&&D.indexOf(v.b)==-1&&D.indexOf(v.c)==-1)continue;b.push(y);ne=ne.concat(ae[y])}b.push(oe)}return{hit:[H,h.length],updated:ce._updated||Y>-999||J,blocked_side:ce,ground_y:Y,ground_face_index:oe,ground_face_connected:b,bb_static_collided:J,plane_pts:ne}}}();THREE.Ray.prototype.intersectTriangle=function(){var l=new THREE.Vector3;var c=new THREE.Vector3;var d=new THREE.Vector3;var u=new THREE.Vector3;return function e(t,n,a,o,i){c.subVectors(n,t);d.subVectors(a,t);u.crossVectors(c,d);var r=this.direction.dot(u);var _;if(r>0){if(o)return null;_=1}else if(r<0){_=-1;r=-r}else{return null}l.subVectors(this.origin,t);var s=_*this.direction.dot(d.crossVectors(l,d));if(s<0){return null}var m=_*this.direction.dot(c.cross(l));if(m<0){return null}if(s+m>r){return null}var M=-_*l.dot(u);if(M<0){return null}return this.at(M/r,i)}}();MMD_SA.bone_to_position=function(){var c=new THREE.Vector3;var d=new THREE.Vector3;var u=new THREE.Vector3;var p=new THREE.Vector3;function e(){this.by_bone_name=[];this.pos_delta=new THREE.Vector3;this.pos_delta_rotated=new THREE.Vector3;this.bone_pos_offset=new THREE.Vector3}e.prototype.init=function(e,t,n,a){var o=this.by_bone_name[t];if(!o){o=this.by_bone_name[t]={gbone:{position:(new THREE.Vector3).fromArray(e.geometry.bones[e.bones_by_name[t]._index].pos)},position:new THREE.Vector3,quaternion:new THREE.Quaternion,path:"",motion_time:0}}if(o.path!=n||o.motion_time>a){o.position.set(0,0,0);o.quaternion.set(0,0,0,1);o.path=n}o.motion_time=a;this.gbone=o.gbone;this.position=o.position;this.quaternion=o.quaternion};return function(s){var m=this;if(!m.skin)return null;var M=this.mesh;if(M._bone_to_position_last){M._bone_to_position_last.pos_delta.set(0,0,0);M._bone_to_position_last.pos_delta_rotated.set(0,0,0);M._bone_to_position_last.bone_pos_offset.set(0,0,0)}else M._bone_to_position_last=new e;if(!s.bone_to_position)return null;var l=s.adjustment_per_model&&(s.adjustment_per_model[MMD_SA_options.model_para_obj_all[this._model_index]._filename_cleaned]||s.adjustment_per_model._default_)||{};s.bone_to_position.forEach(function(e){var t=e.name;var n=e.scale||{x:1,y:1,z:1};var a=M.bones_by_name[t];var o=m.skin.time;var i=o*30;M._bone_to_position_last.init(M,t,s._path,o);if(!e.frame_range||e.frame_range.some(function(e){return i>=e[0]&&i<=e[1]})){c.copy(a.position).sub(M._bone_to_position_last.gbone.position).multiply(n)}else{c.set(0,0,0)}u.copy(c);var r;var _;if(l.skin_default){let e=l.skin_default[t]||{};r=e.rot_add||e.rot;if(!r&&!s.bone_to_position.some(function(e){return e.name==""})){e=l.skin_default[""]||{};r=e.rot_add||e.rot;_=!!r}if(r){u.applyEuler(p.copy(r).multiplyScalar(Math.PI/180))}}if(!e.position_disabled){d.copy(u).sub(M._bone_to_position_last.position);M._bone_to_position_last.position.copy(u)}else{d.set(0,0,0);u.set(0,0,0)}if(t==""){a.position.sub(c);M._bone_to_position_last.bone_pos_offset.add(c)}else{let e=_?c.applyEuler(p.copy(r).multiplyScalar(Math.PI/180)):c;M.bones_by_name[""].position.sub(e);M._bone_to_position_last.bone_pos_offset.add(e)}M._bone_to_position_last.pos_delta.add(d)});M._bone_to_position_last.pos_delta_rotated.copy(M._bone_to_position_last.pos_delta).applyQuaternion(M.quaternion);return M._bone_to_position_last.pos_delta}}();if(MMD_SA_options.use_JSARToolKit){var e;e=MMD_SA.AR_obj={startup_countdown:1,TEMP_v3:new THREE.Vector3,_v3a:new THREE.Vector3,TEMP_q:new THREE.Quaternion,_q1:new THREE.Quaternion,_q2:new THREE.Quaternion,_q3:new THREE.Quaternion,TEMP_m4:new THREE.Matrix4,_m4a:new THREE.Matrix4,_m4b:new THREE.Matrix4};var t=MMD_SA_options.AR_para;THREE.Camera.prototype.setJsArMatrix=function(e){var t=new Float32Array(16);e.copyCameraMatrix(t,10,1e4);return this.projectionMatrix.set(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])};THREE.Matrix4.prototype.setJsArMatrix=function(e){return this.set(e.m00,e.m01,-e.m02,e.m03,-e.m10,-e.m11,e.m12,-e.m13,e.m20,e.m21,-e.m22,e.m23,0,0,0,1)};e.canvas=document.createElement("canvas");e.canvas.width=t.video_width;e.canvas.height=t.video_height;e.raster=new NyARRgbRaster_Canvas2D(e.canvas);e.param=new FLARParam(e.canvas.width,e.canvas.height,49);e.detector=new FLARMultiIdMarkerDetector(e.param,t.marker_width);e.detector.setContinueMode(true);e.markers={};e.compensationMatrix=(new THREE.Matrix4).makeScale(1,1,-1);e.compensationMatrix.multiply((new THREE.Matrix4).makeRotationX(THREE.Math.degToRad(90)))}if(MMD_SA.use_jThree_v1)jThree.goml("index.goml");var n={extractPathBase:function(e){var t=e.split("/");t.pop();return t.length===0?"":t.join("/")+"/"},extractPathExt:function(e){var t=e.split(".").pop();if(t===e){return""}return t}}})();
